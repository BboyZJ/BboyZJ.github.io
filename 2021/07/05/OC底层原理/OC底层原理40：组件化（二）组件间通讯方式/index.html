<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="æˆ‘æ˜¯å°Jï¼Œå…³æ³¨æˆ‘">
    <meta name="author" content="å¼ å»º">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://www.bboyzj.cn/2021/07/05/ocåº•å±‚åŸç†/ocåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    <meta property="og:type" content="article">
    <meta property="og:title" content="OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼">
    <meta property="og:description" content="æˆ‘æ˜¯å°Jï¼Œå…³æ³¨æˆ‘">
    <meta property="og:url" content="https://www.bboyzj.cn2021/07/05/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼/">
    <meta property="og:image" content="/images/redefine-logo.svg">
    <meta property="og:site_name" content="BboyZJ">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼">
    <meta name="twitter:description" content="æˆ‘æ˜¯å°Jï¼Œå…³æ³¨æˆ‘">
    <meta name="twitter:image" content="/images/redefine-logo.svg">
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-logo.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-logo.svg">
    <meta name="theme-color" content="#005080">
    <link rel="shortcut icon" href="/BboyZJ.github.io/images/redefine-logo.svg">
    
    <title>
        
            OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼ -
        
        BboyZJ
    </title>
    
<link rel="stylesheet" href="/BboyZJ.github.io/css/style.css">

    
<link rel="stylesheet" href="/BboyZJ.github.io/assets/fonts.css">

    
    
    
    
    <script id="hexo-configurations">
    let REDEFINE = window.REDEFINE || {};
    REDEFINE.hexo_config = {"hostname":"www.bboyzj.cn","root":"/BboyZJ.github.io/","language":"en","path":"search.xml"};
    REDEFINE.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#005080","avatar":"/images/head_img.svg","favicon":"/images/redefine-logo.svg","article_img_align":"center","right_side_width":"210px","content_max_width":"1000px","nav_color":{"left":"#f78736","right":"#367df7","transparency":35},"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_image":{"light":"https://evan.beee.top/img/wallhaven-wqery6-light.webp","dark":"https://evan.beee.top/img/wallhaven-wqery6-dark.webp"},"title_color":{"light":"#fff","dark":"#d1d1b6"},"description":"å­¦æ— æ­¢å¢ƒ å­¦è€Œä¸æ€åˆ™ç½” æ€è€Œä¸å­¦åˆ™æ®†","custom_font":{"enable":false,"font_family":null,"font_url":null}},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":true},"code_block":{"copy":true,"style":"mac","custom_font":{"enable":false,"font_family":null,"font_url":null}},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"1.1.5","friend_links":{"columns":2},"home_article":{"date_format":"auto","category":{"enable":true,"limit":3},"tag":{"enable":true,"limit":3}},"plugins":{"aplayer":{"enable":false,"audio":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]}}};
    REDEFINE.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
    
    
<link rel="stylesheet" href="/BboyZJ.github.io/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/BboyZJ.github.io/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/BboyZJ.github.io/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/BboyZJ.github.io/fontawesome/regular.min.css">

    
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/BboyZJ.github.io/atom.xml" title="å¼ å»ºçš„åšå®¢" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="menu-wrapper">
    
    <div class="menu-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                BboyZJ
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="pc">
                <ul class="menu-list">
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/BboyZJ.github.io/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        é¦–é¡µ
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/BboyZJ.github.io/tags/"  >
                                    
                                        
                                            <i class="fa-regular fa-tags"></i>
                                        
                                        æ ‡ç­¾
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="menu-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/BboyZJ.github.io/categories/"  >
                                    
                                        
                                            <i class="fa-regular fa-categories"></i>
                                        
                                        åˆ†ç±»
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="menu-drawer">
        <ul class="drawer-menu-list">
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/BboyZJ.github.io/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                é¦–é¡µ
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/BboyZJ.github.io/tags/"  >
                             
                                
                                    <i class="fa-regular fa-tags"></i>
                                
                                æ ‡ç­¾
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-menu-item flex-center">
                        <a class="" 
                        href="/BboyZJ.github.io/categories/"  >
                             
                                
                                    <i class="fa-regular fa-categories"></i>
                                
                                åˆ†ç±»
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
            
                <div class="article-title">
                    <h1 class="article-title-regular">OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/BboyZJ.github.io/images/head_img.svg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">å¼ å»º</span>
                            
                                <span class="author-label">lol</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="pc">2021-07-05 14:50:58</span>
        <span class="mobile">2021-07-05 14:50</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="pc">2023-02-24 18:10:09</span>
            <span class="mobile">2023-02-24 18:10</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/BboyZJ.github.io/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/">OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/BboyZJ.github.io/tags/iOS-OC/">iOS-OC</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡ä¸»è¦è®²ç»„ä»¶åŒ–ä¹‹é—´æ˜¯å¦‚ä½• <code>é€šè®¯</code> çš„</p>
<h1 id="ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆ"><a href="#ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆ" class="headerlink" title="ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆ"></a>ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆ</h1><p>ç›®å‰çš„ä¸»æµæ–¹å¼æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><p><code>URL</code> è·¯ç”±</p>
</li>
<li><p><code>target-action</code></p>
</li>
<li><p><code>protocol</code> åŒ¹é…</p>
</li>
</ul>
<h1 id="URLè·¯ç”±"><a href="#URLè·¯ç”±" class="headerlink" title="URLè·¯ç”±"></a>URLè·¯ç”±</h1><p>ç›®å‰iOSä¸Šå¤§éƒ¨åˆ†è·¯ç”±å·¥å…·éƒ½æ˜¯åŸºäºURLåŒ¹é…çš„ï¼Œæˆ–è€…æ ¹æ®å‘½åçº¦å®šï¼Œç”¨runtimeæ–¹æ³•è¿›è¡ŒåŠ¨æ€è°ƒç”¨</p>
<p>è¿™äº›åŠ¨æ€åŒ–çš„æ–¹æ¡ˆçš„æœ‰ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯éœ€è¦ç»´æŠ¤ <code>å­—ç¬¦ä¸²è¡¨</code>ï¼Œæˆ–è€…ä¾èµ–äºå‘½åçº¦å®šï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶æš´éœ²å‡ºæ‰€æœ‰é—®é¢˜ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯</p>
<p>URLè·¯ç”±æ–¹å¼ä¸»è¦æ˜¯ä»¥è˜‘è‡è¡—ä¸ºä»£è¡¨çš„ <a class="link"   target="_blank" rel="noopener" href="https://www.jianshu.com/p/412b20d9a0f6" >MGJRouter <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>å…¶å®ç°æ€è·¯æ˜¯ï¼š</p>
<ul>
<li><p>Appå¯åŠ¨æ—¶å®ä¾‹åŒ–å„ç»„ä»¶æ¨¡å—ï¼Œç„¶åè¿™äº›ç»„ä»¶å‘ <code>ModuleManager</code> æ³¨å†Œ <code>Url</code>ï¼Œæœ‰äº›æ—¶å€™ä¸éœ€è¦å®ä¾‹åŒ–ï¼Œä½¿ç”¨classæ³¨å†Œ</p>
</li>
<li><p>å½“ç»„ä»¶Aéœ€è¦è°ƒç”¨ç»„ä»¶Bæ—¶ï¼Œå‘ <code>ModuleManager</code> ä¼ é€’URLï¼Œå‚æ•°è·ŸéšURLä»¥GETæ–¹å¼ä¼ é€’ï¼Œç±»ä¼¼openURLã€‚ç„¶åç”± <code>ModuleManager</code> è´Ÿè´£è°ƒåº¦ç»„ä»¶Bï¼Œæœ€åå®Œæˆä»»åŠ¡</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 1.æ³¨å†ŒæŸä¸ªURL</span><br><span class="line">MGJRouter.registerURLPattern(&quot;app://home&quot;) &#123; (info) in</span><br><span class="line">    print(&quot;info:\(info)&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 2.è°ƒç”¨è·¯ç”±</span><br><span class="line">MGJRouter.openURL(&quot;app://home&quot;)</span><br></pre></td></tr></table></figure></div>

<p><strong>URLè·¯ç”±çš„ä¼˜ç‚¹</strong></p>
<ul>
<li>æé«˜çš„åŠ¨æ€æ€§ï¼Œé€‚åˆç»å¸¸å¼€å±•è¿è¥æ´»åŠ¨çš„Appï¼Œä¾‹å¦‚ç”µå•†</li>
<li>æ–¹ä¾¿åœ°ç»Ÿä¸€ç®¡ç†å¤šå¹³å°çš„è·¯ç”±è§„åˆ™</li>
<li>æ˜“äºé€‚é…URL Scheme</li>
</ul>
<p><strong>URLè·¯ç”±çš„ç¼ºç‚¹</strong></p>
<ul>
<li><p>ä¼ å‚æ–¹å¼æœ‰é™ï¼Œå¹¶ä¸”æ— æ³•åˆ©ç”¨ç¼–è¯‘å™¨è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ï¼Œå› æ­¤æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²è½¬æ¢è€Œæ¥</p>
</li>
<li><p>åªé€‚ç”¨äºç•Œé¢æ¨¡å—ï¼Œä¸é€‚ç”¨äºé€šç”¨æ¨¡å—</p>
</li>
<li><p>å‚æ•°çš„æ ¼å¼ä¸æ˜ç¡®ï¼Œæ˜¯ä¸ªçµæ´»çš„ dictionaryï¼Œä¹Ÿéœ€è¦æœ‰ä¸ªåœ°æ–¹å¯ä»¥æŸ¥å‚æ•°æ ¼å¼</p>
</li>
<li><p>ä¸æ”¯æŒstoryboard</p>
</li>
<li><p>ä¾èµ–äºå­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œéš¾ä»¥ç®¡ç†ï¼Œè˜‘è‡è¡—åšäº†ä¸ªåå°ä¸“é—¨ç®¡ç†</p>
</li>
<li><p>æ— æ³•ä¿è¯æ‰€ä½¿ç”¨çš„æ¨¡å—ä¸€å®šå­˜åœ¨</p>
</li>
<li><p>è§£è€¦èƒ½åŠ›æœ‰é™ï¼Œurlçš„æ³¨å†Œã€å®ç°ã€ä½¿ç”¨å¿…é¡»ç”¨ç›¸åŒçš„å­—ç¬¦è§„åˆ™ï¼Œä¸€æ—¦ä»»ä½•ä¸€æ–¹ä½œå‡ºä¿®æ”¹éƒ½ä¼šå¯¼è‡´å…¶ä»–æ–¹çš„ä»£ç å¤±æ•ˆï¼Œå¹¶ä¸”é‡æ„éš¾åº¦å¤§</p>
</li>
</ul>
<p>é™¤äº† <code>MGJRouter</code>ï¼Œè¿˜æœ‰ä»¥ä¸‹è¿™äº›ä¸‰æ–¹æ¡†æ¶</p>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://github.com/clayallsopp/routable-ios" >routable-ios <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://www.jianshu.com/p/412b20d9a0f6" >JLRoutes <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li><a class="link"   target="_blank" rel="noopener" href="https://www.jianshu.com/p/412b20d9a0f6" >HHRouter <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<h1 id="target-action"><a href="#target-action" class="headerlink" title="target-action"></a>target-action</h1><p>è¿™ä¸ªæ–¹æ¡ˆæ˜¯åŸºäºOCçš„ <code>runtimeã€category</code> ç‰¹æ€§åŠ¨æ€è·å–æ¨¡å—ï¼Œä¾‹å¦‚é€šè¿‡ <code>NSClassFromString</code> è·å–ç±»å¹¶åˆ›å»ºå®ä¾‹ï¼Œé€šè¿‡ <code>performSelector + NSInvocation</code> åŠ¨æ€è°ƒç”¨æ–¹æ³•</p>
<p>å…¶ä¸»è¦çš„ä»£è¡¨æ¡†æ¶æ˜¯ <a class="link"   target="_blank" rel="noopener" href="https://www.jianshu.com/p/412b20d9a0f6" >casatwyçš„CTMediator <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>å…¶å®ç°æ€è·¯æ˜¯ï¼š</p>
<ul>
<li><p>åˆ©ç”¨ <code>åˆ†ç±»</code> ä¸ºè·¯ç”±æ·»åŠ æ–°æ¥å£ï¼Œåœ¨æ¥å£ä¸­ <code>é€šè¿‡å­—ç¬¦ä¸²è·å–å¯¹åº”çš„ç±»</code></p>
</li>
<li><p>é€šè¿‡ <code>runtime</code> åˆ›å»ºå®ä¾‹ï¼ŒåŠ¨æ€è°ƒç”¨å®ä¾‹çš„æ–¹æ³•</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//******* 1ã€åˆ†ç±»å®šä¹‰æ–°æ¥å£</span><br><span class="line">extension CTMediator&#123;</span><br><span class="line">    @objc func A_showHome()-&gt;UIViewController?&#123;</span><br><span class="line">        let params = [</span><br><span class="line">            kCTMediatorParamsKeySwiftTargetModuleName: &quot;ZJBase_Example&quot;</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        if let vc = self.performTarget(&quot;A&quot;, action: &quot;Extension_HomeViewController&quot;, params: params, shouldCacheTarget: false) as? UIViewController&#123;</span><br><span class="line">            return vc</span><br><span class="line">        &#125;</span><br><span class="line">        return nil</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//******* 2ã€æ¨¡å—æä¾›è€…æä¾›target-actionçš„è°ƒç”¨æ–¹å¼ï¼ˆå¯¹å¤–éœ€è¦åŠ ä¸Špublicå…³é”®å­—ï¼‰</span><br><span class="line">class Target_A: NSObject &#123;</span><br><span class="line">    </span><br><span class="line">    @objc func Action_Extension_HomeViewController(_ params: [String: Any])-&gt;UIViewController&#123;</span><br><span class="line">         </span><br><span class="line">        let home = HomeViewController()</span><br><span class="line">        return home</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//******* 3ã€ä½¿ç”¨</span><br><span class="line">if let vc = CTMediator.sharedInstance().A_showHome() &#123;</span><br><span class="line">            self.navigationController?.pushViewController(vc, animated: true)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></div>

<p>å…¶æ¨¡å—é—´çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25925248/162383654-d820d060-c93d-4162-bed3-2b8473670650.png"
                     
                ></p>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li><p>éœ€è¦åœ¨ <code>mediator</code> å’Œ <code>target</code> ä¸­é‡æ–°æ·»åŠ æ¯ä¸€ä¸ªæ¥å£ï¼Œæ¨¡å—åŒ–æ—¶ä»£ç è¾ƒä¸ºç¹ç</p>
</li>
<li><p>åœ¨ <code>category</code> ä¸­ä»ç„¶å¼•å…¥äº† <code>å­—ç¬¦ä¸²ç¼–ç </code>ï¼Œå†…éƒ¨ä½¿ç”¨å­—å…¸ä¼ å‚ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿå­˜åœ¨å’ŒURLè·¯ç”±ç›¸åŒçš„é—®é¢˜</p>
</li>
<li><p>æ— æ³•ä¿è¯ä½¿ç”¨çš„æ¨¡å—ä¸€å®šå­˜åœ¨ï¼Œtargetåœ¨ä¿®æ”¹åï¼Œä½¿ç”¨è€…åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯</p>
</li>
<li><p>å¯èƒ½ä¼šåˆ›å»ºè¿‡å¤šçš„ <code>target</code> ç±»</p>
</li>
</ul>
<p><strong>CTMediatoræºç åˆ†æ</strong></p>
<ul>
<li>é€šè¿‡åˆ†ç±»ä¸­è°ƒç”¨çš„ <code>performTarget</code> æ¥åˆ° <code>CTMediator</code> ä¸­çš„å…·ä½“å®ç°ï¼Œå³ <code>performTarget:action:params:shouldCacheTarget:</code>ï¼Œä¸»è¦æ˜¯é€šè¿‡ä¼ å…¥çš„nameï¼Œæ‰¾åˆ°å¯¹åº”çš„ <code>targetå’Œaction</code></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">- (id)performTarget:(NSString *)targetName action:(NSString *)actionName params:(NSDictionary *)params shouldCacheTarget:(BOOL)shouldCacheTarget</span><br><span class="line">&#123;</span><br><span class="line">    if (targetName == nil || actionName == nil) &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    //åœ¨swiftä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ä¼ å…¥å¯¹åº”é¡¹ç›®çš„targetåç§°ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°è§†å›¾æ§åˆ¶å™¨</span><br><span class="line">    NSString *swiftModuleName = params[kCTMediatorParamsKeySwiftTargetModuleName];</span><br><span class="line">    </span><br><span class="line">    // generate target ç”Ÿæˆtarget</span><br><span class="line">    NSString *targetClassString = nil;</span><br><span class="line">    if (swiftModuleName.length &gt; 0) &#123;</span><br><span class="line">        //swiftä¸­targetæ–‡ä»¶åæ‹¼æ¥</span><br><span class="line">        targetClassString = [NSString stringWithFormat:@&quot;%@.Target_%@&quot;, swiftModuleName, targetName];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        //OCä¸­targetæ–‡ä»¶åæ‹¼æ¥</span><br><span class="line">        targetClassString = [NSString stringWithFormat:@&quot;Target_%@&quot;, targetName];</span><br><span class="line">    &#125;</span><br><span class="line">    //ç¼“å­˜ä¸­æŸ¥æ‰¾target</span><br><span class="line">    NSObject *target = [self safeFetchCachedTarget:targetClassString];</span><br><span class="line">    //ç¼“å­˜ä¸­æ²¡æœ‰target</span><br><span class="line">    if (target == nil) &#123;</span><br><span class="line">        //é€šè¿‡å­—ç¬¦ä¸²è·å–å¯¹åº”çš„ç±»</span><br><span class="line">        Class targetClass = NSClassFromString(targetClassString);</span><br><span class="line">        //åˆ›å»ºå®ä¾‹</span><br><span class="line">        target = [[targetClass alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // generate action ç”Ÿæˆactionæ–¹æ³•åç§°</span><br><span class="line">    NSString *actionString = [NSString stringWithFormat:@&quot;Action_%@:&quot;, actionName];</span><br><span class="line">    //é€šè¿‡æ–¹æ³•åå­—ç¬¦ä¸²è·å–å¯¹åº”çš„sel</span><br><span class="line">    SEL action = NSSelectorFromString(actionString);</span><br><span class="line">    </span><br><span class="line">    if (target == nil) &#123;</span><br><span class="line">        // è¿™é‡Œæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ä¹‹ä¸€ï¼Œè¿™ä¸ªdemoåšå¾—æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å“åº”çš„targetï¼Œå°±ç›´æ¥returnäº†ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥äº‹å…ˆç»™ä¸€ä¸ªå›ºå®šçš„targetä¸“é—¨ç”¨äºåœ¨è¿™ä¸ªæ—¶å€™é¡¶ä¸Šï¼Œç„¶åå¤„ç†è¿™ç§è¯·æ±‚çš„</span><br><span class="line">        [self NoTargetActionResponseWithTargetString:targetClassString selectorString:actionString originParams:params];</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ˜¯å¦éœ€è¦ç¼“å­˜</span><br><span class="line">    if (shouldCacheTarget) &#123;</span><br><span class="line">        [self safeSetCachedTarget:target key:targetClassString];</span><br><span class="line">    &#125;</span><br><span class="line">    //æ˜¯å¦å“åº”sel</span><br><span class="line">    if ([target respondsToSelector:action]) &#123;</span><br><span class="line">        //åŠ¨æ€è°ƒç”¨æ–¹æ³•</span><br><span class="line">        return [self safePerformAction:action target:target params:params];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // è¿™é‡Œæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ï¼Œå¦‚æœæ— å“åº”ï¼Œåˆ™å°è¯•è°ƒç”¨å¯¹åº”targetçš„notFoundæ–¹æ³•ç»Ÿä¸€å¤„ç†</span><br><span class="line">        SEL action = NSSelectorFromString(@&quot;notFound:&quot;);</span><br><span class="line">        if ([target respondsToSelector:action]) &#123;</span><br><span class="line">            return [self safePerformAction:action target:target params:params];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // è¿™é‡Œä¹Ÿæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ï¼Œåœ¨notFoundéƒ½æ²¡æœ‰çš„æ—¶å€™ï¼Œè¿™ä¸ªdemoæ˜¯ç›´æ¥returnäº†ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç”¨å‰é¢æåˆ°çš„å›ºå®šçš„targeté¡¶ä¸Šçš„ã€‚</span><br><span class="line">            [self NoTargetActionResponseWithTargetString:targetClassString selectorString:actionString originParams:params];</span><br><span class="line">            @synchronized (self) &#123;</span><br><span class="line">                [self.cachedTarget removeObjectForKey:targetClassString];</span><br><span class="line">            &#125;</span><br><span class="line">            return nil;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>è¿›å…¥ <code>safePerformAction: target: params:</code> å®ç°ï¼Œä¸»è¦æ˜¯é€šè¿‡ <code>invocation</code> è¿›è¡Œ <code>å‚æ•°ä¼ é€’+æ¶ˆæ¯è½¬å‘</code></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (id)safePerformAction:(SEL)action target:(NSObject *)target params:(NSDictionary *)params</span><br><span class="line">&#123;</span><br><span class="line">    //è·å–æ–¹æ³•ç­¾å</span><br><span class="line">    NSMethodSignature* methodSig = [target methodSignatureForSelector:action];</span><br><span class="line">    if(methodSig == nil) &#123;</span><br><span class="line">        return nil;</span><br><span class="line">    &#125;</span><br><span class="line">    //è·å–æ–¹æ³•ç­¾åä¸­çš„è¿”å›ç±»å‹ï¼Œç„¶åæ ¹æ®è¿”å›å€¼å®Œæˆå‚æ•°ä¼ é€’</span><br><span class="line">    const char* retType = [methodSig methodReturnType];</span><br><span class="line">    //voidç±»å‹</span><br><span class="line">    if (strcmp(retType, @encode(void)) == 0) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    //...çœç•¥å…¶ä»–ç±»å‹çš„åˆ¤æ–­</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="protocol-class"><a href="#protocol-class" class="headerlink" title="protocol class"></a>protocol class</h1><p>protocolåŒ¹é…çš„ <code>å®ç°æ€è·¯</code> æ˜¯ï¼š</p>
<ul>
<li>å°† <code>protocol</code> å’Œå¯¹åº”çš„ <code>ç±»</code> è¿›è¡Œ <code>å­—å…¸åŒ¹é…</code></li>
<li>é€šè¿‡ç”¨ <code>protocol</code> è·å– <code>class</code>ï¼Œåœ¨ <code>åŠ¨æ€åˆ›å»ºå®ä¾‹</code></li>
</ul>
<p>protocolæ¯”è¾ƒå…¸å‹çš„ä¸‰æ–¹çŸ¿å»ºå°±æ˜¯ <a class="link"   target="_blank" rel="noopener" href="https://github.com/alibaba/BeeHive" >é˜¿é‡Œçš„BeeHive <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œ<code>BeeHive</code> å€Ÿé‰´äº†Spring Serviceã€Apache DSOçš„æ¶æ„ç†å¿µï¼Œ<code>é‡‡ç”¨AOP+æ‰©å±•Appå£°æ˜å‘¨æœŸAPI</code> å½¢å¼ï¼Œå°† <code>ä¸šåŠ¡åŠŸèƒ½ã€åŸºç¡€åŠŸèƒ½</code> æ¨¡å—ä»¥æ¨¡å—æ–¹å¼ä»¥è§£å†³å¤§å‹åº”ç”¨ä¸­çš„å¤æ‚é—®é¢˜ï¼Œå¹¶è®© <code>æ¨¡å—ä¹‹é—´ä»¥Serviceå½¢å¼è°ƒç”¨</code>ï¼Œå°†å¤æ‚é—®é¢˜åˆ‡åˆ†ï¼Œä»¥AOPæ–¹å¼æ¨¡å—åŒ–æœåŠ¡</p>
<p><strong>BeeHiveæ ¸å¿ƒæ€æƒ³</strong></p>
<ul>
<li>å„ä¸ªæ¨¡å—é—´è°ƒç”¨ä»ç›´æ¥è°ƒç”¨å¯¹åº”æ¨¡å—ï¼Œå˜æˆè°ƒç”¨ <code>Service</code> çš„å½¢å¼ï¼Œé¿å…äº†ç›´æ¥ä¾èµ–</li>
<li>Appå£°æ˜å‘¨æœŸçš„åˆ†å‘ï¼Œå°†è€¦åˆåœ¨AppDelegateä¸­é€»è¾‘æ‹†åˆ†ï¼Œä¹°ä¸ªæ¨¡å—ä»¥å¾®åº”ç”¨çš„å½¢å¼ç‹¬ç«‹å­˜åœ¨</li>
</ul>
<p>ç¤ºä¾‹å¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 1ã€æ³¨å†Œ</span><br><span class="line">[[BeeHive shareInstance] registerService:@protocol(HomeServiceProtocol) service:[BHViewController class]];</span><br><span class="line"></span><br><span class="line">// 2ã€ä½¿ç”¨</span><br><span class="line">#import &quot;BHService.h&quot;</span><br><span class="line"></span><br><span class="line">id&lt; HomeServiceProtocol &gt; homeVc = [[BeeHive shareInstance] createService:@protocol(HomeServiceProtocol)];</span><br></pre></td></tr></table></figure></div>

<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>åˆ©ç”¨æ¥å£è°ƒç”¨ï¼Œå®ç°äº†å‚æ•°ä¼ é€’æ—¶çš„ç±»å‹å®‰å…¨</li>
<li>ç›´æ¥ä½¿ç”¨æ¨¡å—çš„protocolæ¥å£ï¼Œæ— åºå†é‡å¤å°è£…</li>
</ul>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>ç”¨æ¡†æ¶æ¥åˆ›å»ºæ‰€æœ‰å¯¹è±¡ï¼Œåˆ›å»ºæ–¹å¼ä¸åŒï¼Œå³ä¸æ”¯æŒå¤–éƒ¨ä¼ å…¥å‚æ•°</li>
<li>ç”¨ OC runtime åˆ›å»ºå¯¹è±¡ï¼Œä¸æ”¯æŒswift</li>
<li>åªåšäº† protocol å’Œ class çš„åŒ¹é…ï¼Œä¸æ”¯æŒæ›´å¤æ‚çš„åˆ›å»ºæ–¹å¼å’Œä¾èµ–æ³¨å…¥</li>
<li>æ— æ³•ä¿è¯æ‰€ä½¿ç”¨çš„protocolä¸€å®šå­˜åœ¨å¯¹åº”çš„æ¨¡å—ï¼Œä¹Ÿæ— æ³•ç›´æ¥åˆ¤æ–­æŸä¸ªprotocolæ˜¯å¦èƒ½ç”¨äºè·å–æ¨¡å—</li>
</ul>
<p>é™¤äº† <code>BeeHive</code>ï¼Œè¿˜æœ‰ <a class="link"   target="_blank" rel="noopener" href="https://www.jianshu.com/p/412b20d9a0f6" >Swinject <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="BeeHiveæ¨¡å—æ³¨å†Œ"><a href="#BeeHiveæ¨¡å—æ³¨å†Œ" class="headerlink" title="BeeHiveæ¨¡å—æ³¨å†Œ"></a>BeeHiveæ¨¡å—æ³¨å†Œ</h1><p>åœ¨ <code>BeeHive</code> ä¸»è¦æ˜¯é€šè¿‡ <code>BHModuleManager</code> æ¥ç®¡ç†å„ä¸ªæ¨¡å—çš„ã€‚<code>BHModuleManager</code> ä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„æ¨¡å—ã€‚</p>
<p>BeeHiveæä¾›äº†ä¸‰ç§ä¸åŒçš„è°ƒç”¨å½¢å¼ï¼Œ<code>é™æ€plistï¼ŒåŠ¨æ€æ³¨å†Œï¼Œannotation</code>ã€‚Moduleã€Serviceä¹‹é—´æ²¡æœ‰å…³è”ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—å¯ä»¥å•ç‹¬å®ç°Moduleæˆ–è€…Serviceçš„åŠŸèƒ½ã€‚</p>
<ol>
<li>Annotationæ–¹å¼æ³¨å†Œ<br>è¿™ç§æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡ <code>BeeHiveMod</code> å®è¿›è¡Œ <code>Annotation</code> æ ‡è®°</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//***** ä½¿ç”¨</span><br><span class="line">BeeHiveMod(ShopModule)</span><br><span class="line"></span><br><span class="line">//***** BeeHiveModçš„å®å®šä¹‰</span><br><span class="line">#define BeeHiveMod(name) \</span><br><span class="line">class BeeHive; char * k##name##_mod BeeHiveDATA(BeehiveMods) = &quot;&quot;#name&quot;&quot;;</span><br><span class="line"></span><br><span class="line">//***** BeeHiveDATAçš„å®å®šä¹‰ </span><br><span class="line">#define BeeHiveDATA(sectname) __attribute((used, section(&quot;__DATA,&quot;#sectname&quot; &quot;)))</span><br><span class="line"></span><br><span class="line">//*****  å…¨éƒ¨è½¬æ¢å‡ºæ¥åä¸ºä¸‹é¢çš„æ ¼å¼</span><br><span class="line">char * kShopModule_mod __attribute((used, section(&quot;__DATA,&quot;&quot;BeehiveMods&quot;&quot; &quot;))) = &quot;&quot;&quot;ShopModule&quot;&quot;&quot;;</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œé’ˆå¯¹ <code>__attribute</code> éœ€è¦è¯´æ˜ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li><p>ç¬¬ä¸€ä¸ªå‚æ•° <code>used</code>ï¼šç”¨æ¥ä¿®é¥°å‡½æ•°ï¼Œè¢«usedä¿®é¥°ä»¥åï¼Œæ„å‘³ç€å³ä½¿å‡½æ•°æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåœ¨Releaseä¸‹ä¹Ÿä¸ä¼šè¢«ä¼˜åŒ–ã€‚å¦‚æœä¸åŠ è¿™ä¸ªä¿®é¥°ï¼Œé‚£ä¹ˆReleaseç¯å¢ƒé“¾æ¥å™¨ä¸‹ä¼šå»æ‰æ²¡æœ‰è¢«å¼•ç”¨çš„æ®µã€‚</p>
</li>
<li><p>é€šè¿‡ä½¿ç”¨ <code>__attribute__((section(&quot;name&quot;)))</code> æ¥æŒ‡æ˜å“ªä¸ªæ®µã€‚æ•°æ®åˆ™ç”¨<code>__attribute__((used))</code> æ¥æ ‡è®°ï¼Œé˜²æ­¢é“¾æ¥å™¨ä¼šä¼˜åŒ–åˆ é™¤æœªè¢«ä½¿ç”¨çš„æ®µï¼Œç„¶åå°†æ¨¡å—æ³¨å…¥åˆ° <code>__DATA</code> ä¸­</p>
</li>
<li><p>è¿›å…¥ <code>BHReadConfiguration</code> æ–¹æ³•ï¼Œä¸»è¦æ˜¯é€šè¿‡ <code>Mach-O</code> æ‰¾åˆ°å­˜å‚¨çš„æ•°æ®æ®µï¼Œå–å‡ºæ”¾å…¥æ•°ç»„ä¸­</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">NSArray&lt;NSString *&gt;* BHReadConfiguration(char *sectionName,const struct mach_header *mhp)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    NSMutableArray *configs = [NSMutableArray array];</span><br><span class="line">    unsigned long size = 0;</span><br><span class="line">#ifndef __LP64__</span><br><span class="line">    // æ‰¾åˆ°ä¹‹å‰å­˜å‚¨çš„æ•°æ®æ®µ(Moduleæ‰¾BeehiveModsæ®µ å’Œ Serviceæ‰¾BeehiveServicesæ®µ)çš„ä¸€ç‰‡å†…å­˜</span><br><span class="line">    uintptr_t *memory = (uintptr_t*)getsectiondata(mhp, SEG_DATA, sectionName, &amp;size);</span><br><span class="line">#else</span><br><span class="line">    const struct mach_header_64 *mhp64 = (const struct mach_header_64 *)mhp;</span><br><span class="line">    uintptr_t *memory = (uintptr_t*)getsectiondata(mhp64, SEG_DATA, sectionName, &amp;size);</span><br><span class="line">#endif</span><br><span class="line">    </span><br><span class="line">    unsigned long counter = size/sizeof(void*);</span><br><span class="line">    // æŠŠç‰¹æ®Šæ®µé‡Œé¢çš„æ•°æ®éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²å­˜å…¥æ•°ç»„ä¸­</span><br><span class="line">    for(int idx = 0; idx &lt; counter; ++idx)&#123;</span><br><span class="line">        char *string = (char*)memory[idx];</span><br><span class="line">        NSString *str = [NSString stringWithUTF8String:string];</span><br><span class="line">        if(!str)continue;</span><br><span class="line">        </span><br><span class="line">        BHLog(@&quot;config = %@&quot;, str);</span><br><span class="line">        if(str) [configs addObject:str];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return configs; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>è¯»å–æœ¬åœ°Plistæ–‡ä»¶</li>
</ol>
<ul>
<li>é¦–å…ˆï¼Œéœ€è¦è®¾ç½®å¥½è·¯å¾„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;; // å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist</span><br></pre></td></tr></table></figure></div>

<ul>
<li>åˆ›å»ºplistæ–‡ä»¶ï¼ŒPlistæ–‡ä»¶çš„æ ¼å¼ä¹Ÿæ˜¯æ•°ç»„ä¸­åŒ…å«å¤šä¸ªå­—å…¸ã€‚å­—å…¸é‡Œé¢æœ‰ä¸¤ä¸ªKeyï¼Œä¸€ä¸ªæ˜¯<code>@&quot;moduleLevel&quot;</code>ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>@&quot;moduleClass&quot;</code> ã€‚æ³¨æ„æ ¹çš„æ•°ç»„çš„åå­—å«<code>@â€œmoduleClassesâ€</code>ã€‚</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25925248/162383772-d61d99f3-78b3-4e26-b139-1474e1c6ff60.png"
                     
                ></p>
<ul>
<li>è¿›å…¥ <code>loadLocalModules</code> æ–¹æ³•ï¼Œä¸»è¦æ˜¯ä» <code>Plist</code> é‡Œé¢å–å‡ºæ•°ç»„ï¼Œç„¶åæŠŠæ•°ç»„åŠ å…¥åˆ°<code>BHModuleInfos</code> æ•°ç»„é‡Œé¢</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">//åˆå§‹åŒ–contextæ—¶ï¼ŒåŠ è½½Moduleså’ŒServices</span><br><span class="line">-(void)setContext:(BHContext *)context</span><br><span class="line">&#123;</span><br><span class="line">    _context = context;</span><br><span class="line">    </span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        [self loadStaticServices];</span><br><span class="line">        [self loadStaticModules];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">//åŠ è½½modules</span><br><span class="line">- (void)loadStaticModules</span><br><span class="line">&#123;</span><br><span class="line">    // è¯»å–æœ¬åœ°plistæ–‡ä»¶é‡Œé¢çš„Moduleï¼Œå¹¶æ³¨å†Œåˆ°BHModuleManagerçš„BHModuleInfosæ•°ç»„ä¸­</span><br><span class="line">    [[BHModuleManager sharedManager] loadLocalModules];</span><br><span class="line">    //æ³¨å†Œæ‰€æœ‰modulesï¼Œåœ¨å†…éƒ¨æ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œæ’åº</span><br><span class="line">    [[BHModuleManager sharedManager] registedAllModules];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (void)loadLocalModules</span><br><span class="line">&#123;</span><br><span class="line">    //plistæ–‡ä»¶è·¯å¾„</span><br><span class="line">    NSString *plistPath = [[NSBundle mainBundle] pathForResource:[BHContext shareInstance].moduleConfigName ofType:@&quot;plist&quot;];</span><br><span class="line">    //åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br><span class="line">    if (![[NSFileManager defaultManager] fileExistsAtPath:plistPath]) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    //è¯»å–æ•´ä¸ªæ–‡ä»¶[@&quot;moduleClasses&quot; : æ•°ç»„]</span><br><span class="line">    NSDictionary *moduleList = [[NSDictionary alloc] initWithContentsOfFile:plistPath];</span><br><span class="line">    //é€šè¿‡moduleClasses keyè¯»å– æ•°ç»„ [[@&quot;moduleClass&quot;:&quot;aaa&quot;, @&quot;moduleLevel&quot;: @&quot;bbb&quot;], [...]]</span><br><span class="line">    NSArray&lt;NSDictionary *&gt; *modulesArray = [moduleList objectForKey:kModuleArrayKey];</span><br><span class="line">    NSMutableDictionary&lt;NSString *, NSNumber *&gt; *moduleInfoByClass = @&#123;&#125;.mutableCopy;</span><br><span class="line">    //éå†æ•°ç»„</span><br><span class="line">    [self.BHModuleInfos enumerateObjectsUsingBlock:^(NSDictionary * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        [moduleInfoByClass setObject:@1 forKey:[obj objectForKey:kModuleInfoNameKey]];</span><br><span class="line">    &#125;];</span><br><span class="line">    [modulesArray enumerateObjectsUsingBlock:^(NSDictionary * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        if (!moduleInfoByClass[[obj objectForKey:kModuleInfoNameKey]]) &#123;</span><br><span class="line">            //å­˜å‚¨åˆ° BHModuleInfos ä¸­</span><br><span class="line">            [self.BHModuleInfos addObject:obj];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>loadæ–¹æ³•æ³¨å†Œ</li>
</ol>
<p>è¯¥æ–¹æ³• <code>æ³¨å†ŒModule</code> å°±æ˜¯åœ¨ <code>Load</code> æ–¹æ³•é‡Œé¢æ³¨å†ŒModuleçš„ç±»</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    [BeeHive registerDynamicModule:[self class]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>è¿›å…¥ <code>registerDynamicModule</code> å®ç°</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+ (void)registerDynamicModule:(Class)moduleClass</span><br><span class="line">&#123;</span><br><span class="line">    [[BHModuleManager sharedManager] registerDynamicModule:moduleClass];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (void)registerDynamicModule:(Class)moduleClass</span><br><span class="line">&#123;</span><br><span class="line">    [self registerDynamicModule:moduleClass shouldTriggerInitEvent:NO];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (void)registerDynamicModule:(Class)moduleClass</span><br><span class="line">       shouldTriggerInitEvent:(BOOL)shouldTriggerInitEvent</span><br><span class="line">&#123;</span><br><span class="line">    [self addModuleFromObject:moduleClass shouldTriggerInitEvent:shouldTriggerInitEvent];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å…¶åº•å±‚è¿˜æ˜¯åŒç¬¬ä¸€ç§æ–¹å¼ä¸€æ ·ï¼Œæœ€ç»ˆä¼šèµ°åˆ°<code>addModuleFromObject:shouldTriggerInitEvent:</code>æ–¹æ³•ä¸­</p>
<ul>
<li>loadæ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>BH_EXPORT_MODULE</code> å®ä»£æ›¿</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define BH_EXPORT_MODULE(isAsync) \</span><br><span class="line">+ (void)load &#123; [BeeHive registerDynamicModule:[self class]]; &#125; \</span><br><span class="line">-(BOOL)async &#123; return [[NSString stringWithUTF8String:#isAsync] boolValue];&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>BH_EXPORT_MODULE</code> å®é‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨ <code>æ˜¯å¦å¼‚æ­¥åŠ è½½Moduleæ¨¡å—</code>ï¼Œå¦‚æœæ˜¯<code>YES</code>å°±æ˜¯ <code>å¼‚æ­¥åŠ è½½</code>ï¼Œå¦‚æœæ˜¯ <code>NO</code> å°±æ˜¯ <code>åŒæ­¥åŠ è½½</code>ã€‚</p>
<ol start="2">
<li>BeeHive æ¨¡å—äº‹ä»¶</li>
</ol>
<p>BeeHiveä¼šç»™æ¯ä¸ªæ¨¡å—æä¾›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œç”¨äºä¸BeeHiveå®¿ä¸»ç¯å¢ƒè¿›è¡Œå¿…è¦ä¿¡æ¯äº¤äº’ï¼Œæ„ŸçŸ¥æ¨¡å—ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–ã€‚</p>
<p>BeeHiveå„ä¸ªæ¨¡å—ä¼šæ”¶åˆ°ä¸€äº›äº‹ä»¶ã€‚åœ¨ <code>BHModuleManager</code> ä¸­ï¼Œæ‰€æœ‰çš„äº‹ä»¶è¢«å®šä¹‰æˆäº†<code>BHModuleEventType</code> æšä¸¾ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­æœ‰2ä¸ªäº‹ä»¶å¾ˆç‰¹æ®Šï¼Œä¸€ä¸ªæ˜¯ <code>BHMInitEvent</code>ï¼Œä¸€ä¸ªæ˜¯ <code>BHMTearDownEvent</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, BHModuleEventType)</span><br><span class="line">&#123;</span><br><span class="line">    //è®¾ç½®Moduleæ¨¡å—</span><br><span class="line">    BHMSetupEvent = 0,</span><br><span class="line">    //ç”¨äºåˆå§‹åŒ–Moduleæ¨¡å—ï¼Œä¾‹å¦‚ç¯å¢ƒåˆ¤æ–­ï¼Œæ ¹æ®ä¸åŒç¯å¢ƒè¿›è¡Œä¸åŒåˆå§‹åŒ–</span><br><span class="line">    BHMInitEvent,</span><br><span class="line">    //ç”¨äºæ‹†é™¤Moduleæ¨¡å—</span><br><span class="line">    BHMTearDownEvent,</span><br><span class="line">    BHMSplashEvent,</span><br><span class="line">    BHMQuickActionEvent,</span><br><span class="line">    BHMWillResignActiveEvent,</span><br><span class="line">    BHMDidEnterBackgroundEvent,</span><br><span class="line">    BHMWillEnterForegroundEvent,</span><br><span class="line">    BHMDidBecomeActiveEvent,</span><br><span class="line">    BHMWillTerminateEvent,</span><br><span class="line">    BHMUnmountEvent,</span><br><span class="line">    BHMOpenURLEvent,</span><br><span class="line">    BHMDidReceiveMemoryWarningEvent,</span><br><span class="line">    BHMDidFailToRegisterForRemoteNotificationsEvent,</span><br><span class="line">    BHMDidRegisterForRemoteNotificationsEvent,</span><br><span class="line">    BHMDidReceiveRemoteNotificationEvent,</span><br><span class="line">    BHMDidReceiveLocalNotificationEvent,</span><br><span class="line">    BHMWillPresentNotificationEvent,</span><br><span class="line">    BHMDidReceiveNotificationResponseEvent,</span><br><span class="line">    BHMWillContinueUserActivityEvent,</span><br><span class="line">    BHMContinueUserActivityEvent,</span><br><span class="line">    BHMDidFailToContinueUserActivityEvent,</span><br><span class="line">    BHMDidUpdateUserActivityEvent,</span><br><span class="line">    BHMHandleWatchKitExtensionRequestEvent,</span><br><span class="line">    BHMDidCustomEvent = 1000</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>

<p>ä¸»è¦åˆ†ä¸ºä¸‰ç§</p>
<ul>
<li><code>ç³»ç»Ÿäº‹ä»¶</code>ï¼šä¸»è¦æ˜¯æŒ‡ <code>Applicationç”Ÿå‘½å‘¨æœŸäº‹ä»¶!</code></li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25925248/162383825-1e06fb75-8aa2-4044-8176-6d249e3064a4.png"
                     
                ></p>
<p>ä¸€èˆ¬çš„åšæ³•æ˜¯<code>AppDelegate</code>æ”¹ä¸º <code>ç»§æ‰¿è‡ªBHAppDelegate</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@interface TestAppDelegate : BHAppDelegate &lt;UIApplicationDelegate&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>åº”ç”¨äº‹ä»¶</code>ï¼šå®˜æ–¹ç»™å‡ºçš„æµç¨‹å›¾ï¼Œå…¶ä¸­ <code>modSetupã€modInit</code> ç­‰ï¼Œå¯ä»¥ç”¨äºç¼–ç å®ç°å„æ’ä»¶æ¨¡å—çš„è®¾ç½®ä¸åˆå§‹åŒ–ã€‚</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25925248/162383863-7f1e8d00-a2b1-48b2-a262-0e0840fda1dd.png"
                     
                ></p>
<ul>
<li>è‡ªå®šä¹‰äº‹ä»¶</li>
</ul>
<p>ä»¥ä¸Šæ‰€æœ‰çš„äº‹ä»¶éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨ <code>BHModuleManager</code> çš„ <code>triggerEvent:</code> æ¥å¤„ç†ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">- (void)triggerEvent:(NSInteger)eventType</span><br><span class="line">&#123;</span><br><span class="line">    [self triggerEvent:eventType withCustomParam:nil];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (void)triggerEvent:(NSInteger)eventType</span><br><span class="line">     withCustomParam:(NSDictionary *)customParam &#123;</span><br><span class="line">    [self handleModuleEvent:eventType forTarget:nil withCustomParam:customParam];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">#pragma mark - module protocol</span><br><span class="line">- (void)handleModuleEvent:(NSInteger)eventType</span><br><span class="line">                forTarget:(id&lt;BHModuleProtocol&gt;)target</span><br><span class="line">          withCustomParam:(NSDictionary *)customParam</span><br><span class="line">&#123;</span><br><span class="line">    switch (eventType) &#123;</span><br><span class="line">            //åˆå§‹åŒ–äº‹ä»¶</span><br><span class="line">        case BHMInitEvent:</span><br><span class="line">            //special</span><br><span class="line">            [self handleModulesInitEventForTarget:nil withCustomParam :customParam];</span><br><span class="line">            break;</span><br><span class="line">            //ææ„äº‹ä»¶</span><br><span class="line">        case BHMTearDownEvent:</span><br><span class="line">            //special</span><br><span class="line">            [self handleModulesTearDownEventForTarget:nil withCustomParam:customParam];</span><br><span class="line">            break;</span><br><span class="line">            //å…¶ä»–3ç±»äº‹ä»¶</span><br><span class="line">        default: &#123;</span><br><span class="line">            NSString *selectorStr = [self.BHSelectorByEvent objectForKey:@(eventType)];</span><br><span class="line">            [self handleModuleEvent:eventType forTarget:nil withSeletorStr:selectorStr andCustomParam:customParam];</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥å‘ç°ï¼Œé™¤å» <code>BHMInitEvent</code> åˆå§‹åŒ–äº‹ä»¶å’Œ <code>BHMTearDownEvent</code> æ‹†é™¤Moduleäº‹ä»¶è¿™ä¸¤ä¸ªç‰¹æ®Šäº‹ä»¶ä»¥å¤–ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯è°ƒç”¨çš„<code>handleModuleEvent:forTarget:withSeletorStr:andCustomParam:</code>æ–¹æ³•ï¼Œå…¶å†…éƒ¨å®ç°ä¸»è¦æ˜¯éå† <code>moduleInstances</code> å®ä¾‹æ•°ç»„ï¼Œè°ƒç”¨ <code>performSelector:withObject:</code> æ–¹æ³•å®ç°å¯¹åº”æ–¹æ³•è°ƒç”¨</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">- (void)handleModuleEvent:(NSInteger)eventType</span><br><span class="line">                forTarget:(id&lt;BHModuleProtocol&gt;)target</span><br><span class="line">           withSeletorStr:(NSString *)selectorStr</span><br><span class="line">           andCustomParam:(NSDictionary *)customParam</span><br><span class="line">&#123;</span><br><span class="line">    BHContext *context = [BHContext shareInstance].copy;</span><br><span class="line">    context.customParam = customParam;</span><br><span class="line">    context.customEvent = eventType;</span><br><span class="line">    if (!selectorStr.length) &#123;</span><br><span class="line">        selectorStr = [self.BHSelectorByEvent objectForKey:@(eventType)];</span><br><span class="line">    &#125;</span><br><span class="line">    SEL seletor = NSSelectorFromString(selectorStr);</span><br><span class="line">    if (!seletor) &#123;</span><br><span class="line">        selectorStr = [self.BHSelectorByEvent objectForKey:@(eventType)];</span><br><span class="line">        seletor = NSSelectorFromString(selectorStr);</span><br><span class="line">    &#125;</span><br><span class="line">    NSArray&lt;id&lt;BHModuleProtocol&gt;&gt; *moduleInstances;</span><br><span class="line">    if (target) &#123;</span><br><span class="line">        moduleInstances = @[target];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        moduleInstances = [self.BHModulesByEvent objectForKey:@(eventType)];</span><br><span class="line">    &#125;</span><br><span class="line">    //éå† moduleInstances å®ä¾‹æ•°ç»„ï¼Œè°ƒç”¨performSelector:withObject:æ–¹æ³•å®ç°å¯¹åº”æ–¹æ³•è°ƒç”¨</span><br><span class="line">    [moduleInstances enumerateObjectsUsingBlock:^(id&lt;BHModuleProtocol&gt; moduleInstance, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        if ([moduleInstance respondsToSelector:seletor]) &#123;</span><br><span class="line">#pragma clang diagnostic push</span><br><span class="line">#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot;</span><br><span class="line">            //è¿›è¡Œæ–¹æ³•è°ƒç”¨</span><br><span class="line">            [moduleInstance performSelector:seletor withObject:context];</span><br><span class="line">#pragma clang diagnostic pop</span><br><span class="line">            </span><br><span class="line">            [[BHTimeProfiler sharedTimeProfiler] recordEventTime:[NSString stringWithFormat:@&quot;%@ --- %@&quot;, [moduleInstance class], NSStringFromSelector(seletor)]];</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„:è¿™é‡Œæ‰€æœ‰çš„ <code>Module</code> å¿…é¡»æ˜¯éµå¾ª <code>BHModuleProtocol</code> çš„ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶åˆ°è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯ã€‚</p>
<ol start="3">
<li>BeeHiveæ¨¡å—è°ƒç”¨</li>
</ol>
<p>åœ¨BeeHiveä¸­æ˜¯é€šè¿‡ <code>BHServiceManager</code> æ¥ç®¡ç†å„ä¸ª <code>Protocol</code> çš„ã€‚<code>BHServiceManager</code> ä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„ <code>Protocol</code>ã€‚</p>
<p>æ³¨å†Œ <code>Protocol</code> çš„æ–¹å¼æ€»å…±æœ‰ä¸‰ç§ï¼Œå’Œæ³¨å†Œ <code>Module</code> æ˜¯ä¸€æ ·ä¸€ä¸€å¯¹åº”çš„</p>
<ul>
<li>Annotationæ–¹å¼æ³¨å†Œ</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//****** 1ã€é€šè¿‡BeeHiveServiceå®è¿›è¡ŒAnnotationæ ‡è®°</span><br><span class="line">BeeHiveService(HomeServiceProtocol,BHViewController)</span><br><span class="line"></span><br><span class="line">//****** 2ã€å®å®šä¹‰</span><br><span class="line">#define BeeHiveService(servicename,impl) \</span><br><span class="line">class BeeHive; char * k##servicename##_service BeeHiveDATA(BeehiveServices) = &quot;&#123; \&quot;&quot;#servicename&quot;\&quot; : \&quot;&quot;#impl&quot;\&quot;&#125;&quot;;</span><br><span class="line"></span><br><span class="line">//****** 3ã€è½¬æ¢åçš„æ ¼å¼ï¼Œä¹Ÿæ˜¯å°†å…¶å­˜å‚¨åˆ°ç‰¹æ®Šçš„æ®µ</span><br><span class="line">char * kHomeServiceProtocol_service __attribute((used, section(&quot;__DATA,&quot;&quot;BeehiveServices&quot;&quot; &quot;))) = &quot;&#123; \&quot;&quot;&quot;HomeServiceProtocol&quot;&quot;\&quot; : \&quot;&quot;&quot;BHViewController&quot;&quot;\&quot;&#125;&quot;;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>è¯»å–æœ¬åœ°plistæ–‡ä»¶</p>
</li>
<li><p>é¦–å…ˆåŒModuleä¸€æ ·ï¼Œéœ€è¦å…ˆè®¾ç½®å¥½è·¯å¾„</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[BHContext shareInstance].serviceConfigName = @&quot;BeeHive.bundle/BHService&quot;;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>è®¾ç½®plistæ–‡ä»¶</li>
</ul>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://user-images.githubusercontent.com/25925248/162383924-4e3279f9-dcfb-4328-839e-bef79af509a9.png"
                     
                ></p>
<ul>
<li>åŒæ ·ä¹Ÿæ˜¯åœ¨ <code>setContext</code> æ—¶æ³¨å†Œ <code>services</code></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//åŠ è½½services</span><br><span class="line">-(void)loadStaticServices</span><br><span class="line">&#123;</span><br><span class="line">    [BHServiceManager sharedManager].enableException = self.enableException;</span><br><span class="line">    </span><br><span class="line">    [[BHServiceManager sharedManager] registerLocalServices];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (void)registerLocalServices</span><br><span class="line">&#123;</span><br><span class="line">    NSString *serviceConfigName = [BHContext shareInstance].serviceConfigName;</span><br><span class="line">    //è·å–plistæ–‡ä»¶è·¯å¾„</span><br><span class="line">    NSString *plistPath = [[NSBundle mainBundle] pathForResource:serviceConfigName ofType:@&quot;plist&quot;];</span><br><span class="line">    if (!plistPath) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSArray *serviceList = [[NSArray alloc] initWithContentsOfFile:plistPath];</span><br><span class="line">    </span><br><span class="line">    [self.lock lock];</span><br><span class="line">    //éå†å¹¶å­˜å‚¨åˆ°allServicesDictä¸­</span><br><span class="line">    for (NSDictionary *dict in serviceList) &#123;</span><br><span class="line">        NSString *protocolKey = [dict objectForKey:@&quot;service&quot;];</span><br><span class="line">        NSString *protocolImplClass = [dict objectForKey:@&quot;impl&quot;];</span><br><span class="line">        if (protocolKey.length &gt; 0 &amp;&amp; protocolImplClass.length &gt; 0) &#123;</span><br><span class="line">            [self.allServicesDict addEntriesFromDictionary:@&#123;protocolKey:protocolImplClass&#125;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [self.lock unlock];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>loadæ–¹æ³•æ³¨å†Œ</li>
</ol>
<p>åœ¨ <code>Load</code> æ–¹æ³•é‡Œé¢æ³¨å†Œ <code>Protocol</code> åè®®ï¼Œä¸»è¦æ˜¯è°ƒç”¨ <code>BeeHive</code> é‡Œé¢çš„<code>registerService:service:</code> å®Œæˆ <code>protocol</code> çš„æ³¨å†Œ</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">   [[BeeHive shareInstance] registerService:@protocol(UserTrackServiceProtocol) service:[BHUserTrackViewController class]];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (void)registerService:(Protocol *)proto service:(Class) serviceClass</span><br><span class="line">&#123;</span><br><span class="line">    [[BHServiceManager sharedManager] registerService:proto implClass:serviceClass];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>åˆ°æ­¤ï¼Œä¸‰ç§æ–¹å¼å°±åˆ›å»ºå®Œæˆäº†</p>
<p><strong>Protocolçš„è·å–</strong></p>
<p><code>Protocol</code> ä¸ <code>Module</code> çš„åŒºåˆ«åœ¨äºï¼Œ<code>Protocol</code> æ¯” <code>Module</code> å¤šäº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å› <code>Protocolå®ä¾‹å¯¹è±¡</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">- (id)createService:(Protocol *)proto;</span><br><span class="line">&#123;</span><br><span class="line">    return [[BHServiceManager sharedManager] createService:proto];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (id)createService:(Protocol *)service</span><br><span class="line">&#123;</span><br><span class="line">    return [self createService:service withServiceName:nil];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName &#123;</span><br><span class="line">    return [self createService:service withServiceName:serviceName shouldCache:YES];</span><br><span class="line">&#125;</span><br><span class="line">ğŸ‘‡</span><br><span class="line">- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName shouldCache:(BOOL)shouldCache &#123;</span><br><span class="line">    if (!serviceName.length) &#123;</span><br><span class="line">        serviceName = NSStringFromProtocol(service);</span><br><span class="line">    &#125;</span><br><span class="line">    id implInstance = nil;</span><br><span class="line">    //åˆ¤æ–­protocolæ˜¯å¦å·²ç»æ³¨å†Œè¿‡</span><br><span class="line">    if (![self checkValidService:service]) &#123;</span><br><span class="line">        if (self.enableException) &#123;</span><br><span class="line">            @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;%@ protocol does not been registed&quot;, NSStringFromProtocol(service)] userInfo:nil];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSString *serviceStr = serviceName;</span><br><span class="line">    //å¦‚æœæœ‰ç¼“å­˜ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–</span><br><span class="line">    if (shouldCache) &#123;</span><br><span class="line">        id protocolImpl = [[BHContext shareInstance] getServiceInstanceFromServiceName:serviceStr];</span><br><span class="line">        if (protocolImpl) &#123;</span><br><span class="line">            return protocolImpl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //è·å–ç±»åï¼Œç„¶åå“åº”ä¸‹å±‚çš„æ–¹æ³•</span><br><span class="line">    Class implClass = [self serviceImplClass:service];</span><br><span class="line">    if ([[implClass class] respondsToSelector:@selector(singleton)]) &#123;</span><br><span class="line">        if ([[implClass class] singleton]) &#123;</span><br><span class="line">            if ([[implClass class] respondsToSelector:@selector(shareInstance)])</span><br><span class="line">                //åˆ›å»ºå•ä¾‹å¯¹è±¡</span><br><span class="line">                implInstance = [[implClass class] shareInstance];</span><br><span class="line">            else</span><br><span class="line">                //åˆ›å»ºå®ä¾‹å¯¹è±¡</span><br><span class="line">                implInstance = [[implClass alloc] init];</span><br><span class="line">            if (shouldCache) &#123;</span><br><span class="line">                //ç¼“å­˜</span><br><span class="line">                [[BHContext shareInstance] addServiceWithImplInstance:implInstance serviceName:serviceStr];</span><br><span class="line">                return implInstance;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return implInstance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return [[implClass alloc] init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>createService</code> ä¼šå…ˆæ£€æŸ¥Protocolåè®®æ˜¯å¦æ˜¯æ³¨å†Œè¿‡çš„ã€‚ç„¶åæ¥ç€å–å‡ºå­—å…¸é‡Œé¢å¯¹åº”çš„Classï¼Œå¦‚æœå®ç°äº† <code>shareInstance</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª <code>å•ä¾‹å¯¹è±¡</code>ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª <code>å®ä¾‹å¯¹è±¡</code>ã€‚å¦‚æœè¿˜å®ç°äº†singletonï¼Œå°±èƒ½è¿›ä¸€æ­¥çš„æŠŠ <code>implInstance</code> å’Œ<code>serviceStr</code> å¯¹åº”çš„åŠ åˆ° <code>BHContext</code> çš„ <code>servicesByName</code> å­—å…¸é‡Œé¢ <code>ç¼“å­˜</code> èµ·æ¥ã€‚è¿™æ ·å°±å¯ä»¥éšç€ä¸Šä¸‹æ–‡ä¼ é€’äº†</p>
<ul>
<li>è¿›å…¥ <code>serviceImplClass</code> å®ç°ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡º <code>protocol</code> å’Œ <code>ç±»</code> æ˜¯é€šè¿‡ <code>å­—å…¸</code> ç»‘å®šçš„ï¼Œ<code>protocol</code>ä½œä¸º<code>key</code>ï¼Œ<code>serviceImp</code>ï¼ˆç±»çš„åå­—ï¼‰ä½œä¸º<code>value</code></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (Class)serviceImplClass:(Protocol *)service</span><br><span class="line">&#123;</span><br><span class="line">    //é€šè¿‡å­—å…¸å°† åè®® å’Œ ç±» ç»‘å®šï¼Œå…¶ä¸­åè®®ä½œä¸ºkeyï¼ŒserviceImpï¼ˆç±»çš„åå­—ï¼‰ä½œä¸ºvalue</span><br><span class="line">    NSString *serviceImpl = [[self servicesDict] objectForKey:NSStringFromProtocol(service)];</span><br><span class="line">    if (serviceImpl.length &gt; 0) &#123;</span><br><span class="line">        return NSClassFromString(serviceImpl);</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="Module-amp-Protocol"><a href="#Module-amp-Protocol" class="headerlink" title="Module &amp; Protocol"></a>Module &amp; Protocol</h1><p>è¿™é‡Œç®€å•æ€»ç»“ä¸‹ï¼š</p>
<ul>
<li><p>å¯¹äº <code>Module</code>ï¼šæ•°ç»„å­˜å‚¨</p>
</li>
<li><p>å¯¹äº <code>Protocol</code>ï¼šé€šè¿‡å­—å…¸å°† <code>protocol</code> ä¸ <code>ç±»</code> è¿›è¡Œ <code>ç»‘å®š</code>ï¼Œ<code>key</code> ä¸º <code>protocol</code>ï¼Œ <code>value</code> ä¸º <code>serviceImp</code> å³ç±»å</p>
</li>
</ul>
<h1 id="è¾…åŠ©ç±»"><a href="#è¾…åŠ©ç±»" class="headerlink" title="è¾…åŠ©ç±»"></a>è¾…åŠ©ç±»</h1><ul>
<li><p><code>BHConfig</code> ç±»ï¼šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ª <code>NSMutableDictionary</code> ç±»å‹çš„ <code>config</code> å±æ€§ï¼Œè¯¥å±æ€§ç»´æŠ¤äº†ä¸€äº›åŠ¨æ€çš„ç¯å¢ƒå˜é‡ï¼Œä½œä¸º <code>BHContext</code> çš„è¡¥å……å­˜åœ¨</p>
</li>
<li><p><code>BHContext</code> ç±»ï¼šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ª <code>NSMutableDictionary</code> çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯ <code>modulesByName</code> å’Œ <code>servicesByName</code>ã€‚è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥ä¿å­˜ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ã€‚ä¾‹å¦‚åœ¨ <code>application:didFinishLaunchingWithOptions:</code> çš„æ—¶å€™ï¼Œå°±å¯ä»¥åˆå§‹åŒ–å¤§é‡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</p>
</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ä¿å­˜ä¿¡æ¯</span><br><span class="line">[BHContext shareInstance].application = application;</span><br><span class="line">[BHContext shareInstance].launchOptions = launchOptions;</span><br><span class="line">[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;;//å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist</span><br><span class="line">[BHContext shareInstance].serviceConfigName = @&quot;BeeHive.bundle/BHService&quot;;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p><code>BHTimeProfiler</code> ç±»ï¼šç”¨æ¥è¿›è¡Œè®¡ç®—æ—¶é—´æ€§èƒ½æ–¹é¢çš„Profiler</p>
</li>
<li><p><code>BHWatchDog</code> ç±»ï¼šç”¨æ¥å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œç›‘å¬ä¸»çº¿ç¨‹æ˜¯å¦å µå¡</p>
</li>
</ul>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li>Post titleï¼šOCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼</li>
        <li>Post authorï¼šå¼ å»º</li>
        <li>Create timeï¼š2021-07-05 14:50:58</li>
        <li>
            Post linkï¼šhttps://redefine.ohevan.com/2021/07/05/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼/
        </li>
        <li>
            Copyright Noticeï¼šAll articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/BboyZJ.github.io/tags/iOS-OC/">#iOS-OC</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/BboyZJ.github.io/2021/07/13/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A015%EF%BC%9ASDWebImage%E6%8E%A2%E7%B4%A2/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">OCå­¦ä¹ 15ï¼šSDWebImageæ¢ç´¢</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/BboyZJ.github.io/2021/06/22/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8639%EF%BC%9A%E7%BB%84%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E6%96%B9%E6%A1%88/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">OCåº•å±‚åŸç†39ï¼šç»„ä»¶åŒ–ï¼ˆä¸€ï¼‰æ–¹æ¡ˆ</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E5%8C%96%E9%80%9A%E8%AE%AF%E6%96%B9%E6%A1%88"><span class="nav-text">ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#URL%E8%B7%AF%E7%94%B1"><span class="nav-text">URLè·¯ç”±</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#target-action"><span class="nav-text">target-action</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#protocol-class"><span class="nav-text">protocol class</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BeeHive%E6%A8%A1%E5%9D%97%E6%B3%A8%E5%86%8C"><span class="nav-text">BeeHiveæ¨¡å—æ³¨å†Œ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Module-amp-Protocol"><span class="nav-text">Module &amp; Protocol</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BE%85%E5%8A%A9%E7%B1%BB"><span class="nav-text">è¾…åŠ©ç±»</span></a></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>



        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2019</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-regular fa-computer-classic"></i>&nbsp;&nbsp;<a href="/">å¼ å»º</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        VISITOR COUNT&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        TOTAL PAGE VIEWS&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a></span>
                <br> 
            <span class="theme-version-container">THEME&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v1.1.5</a>
        </div>
        
        
        
            <div id="start_time_div" style="display:none">
                2019/8/17 11:45:14
            </div>
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="unfolded-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="fa-regular fa-arrow-up"></i>
            </li>
        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="folded-tools-list">
        <li class="right-bottom-tools tool-toggle-show flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/BboyZJ.github.io/js/utils.js"></script>

<script src="/BboyZJ.github.io/js/main.js"></script>

<script src="/BboyZJ.github.io/js/layouts/menu-shrink.js"></script>

<script src="/BboyZJ.github.io/js/tools/go-top-bottom.js"></script>

<script src="/BboyZJ.github.io/js/tools/dark-light-toggle.js"></script>



    
<script src="/BboyZJ.github.io/js/tools/local-search.js"></script>




    
<script src="/BboyZJ.github.io/js/tools/code-block.js"></script>




    
<script src="/BboyZJ.github.io/js/layouts/lazyload.js"></script>




    
<script src="/BboyZJ.github.io/js/tools/runtime.js"></script>

    
<script src="/BboyZJ.github.io/js/layouts/odometer.min.js"></script>

    
<link rel="stylesheet" href="/BboyZJ.github.io/assets/odometer-theme-minimal.css">





<div class="post-scripts pjax">
    
        
<script src="/BboyZJ.github.io/js/tools/toc-toggle.js"></script>

<script src="/BboyZJ.github.io/js/libs/anime.min.js"></script>

<script src="/BboyZJ.github.io/js/layouts/toc.js"></script>

<script src="/BboyZJ.github.io/js/plugins/tabs.js"></script>

    
    
</div>


    
<script src="/BboyZJ.github.io/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            REDEFINE.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            REDEFINE.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            REDEFINE.refresh();
        });
    });
</script>




<script src="/BboyZJ.github.io/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
