{"meta":{"title":"å¼ å»ºçš„åšå®¢","subtitle":"æˆåŠŸçš„é“è·¯ä¸Šåªæœ‰è†æ£˜ï¼Œæ²¡æœ‰å¦é€”","description":"æˆ‘æ˜¯å°Jï¼Œå…³æ³¨æˆ‘","author":"å°J","url":"https://www.bboyzj.cn"},"pages":[{"title":"about","date":"2023-03-06T11:05:41.000Z","updated":"2023-03-06T11:05:41.514Z","comments":true,"path":"about/index.html","permalink":"https://www.bboyzj.cn/about/index.html","excerpt":"","text":""},{"title":"categories","date":"2023-03-01T04:01:29.000Z","updated":"2023-03-01T04:01:29.226Z","comments":true,"path":"categories/index.html","permalink":"https://www.bboyzj.cn/categories/index.html","excerpt":"","text":""},{"title":"link","date":"2023-03-06T11:05:48.000Z","updated":"2023-03-06T11:05:48.692Z","comments":true,"path":"link/index.html","permalink":"https://www.bboyzj.cn/link/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-03-01T03:07:03.000Z","updated":"2023-03-01T03:07:47.616Z","comments":true,"path":"tags/index.html","permalink":"https://www.bboyzj.cn/tags/index.html","excerpt":"","text":""},{"title":"tags","date":"2023-03-06T11:05:02.000Z","updated":"2023-03-06T11:05:02.715Z","comments":true,"path":"tags/index-1.html","permalink":"https://www.bboyzj.cn/tags/index-1.html","excerpt":"","text":""}],"posts":[{"title":"æ€§èƒ½ä¼˜åŒ–03ï¼šCrashæ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ","slug":"OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–03ï¼šCrashæ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ","date":"2023-03-08T21:32:04.000Z","updated":"2023-03-08T21:36:50.373Z","comments":true,"path":"2023/03/09/OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–03ï¼šCrashæ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/09/OC%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%9603%EF%BC%9ACrash%E6%A3%80%E6%B5%8B%E5%92%8C%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/","excerpt":"","text":"å‰è¨€æ£€æµ‹æ–¹å¼ä¼˜åŒ–æ–¹æ¡ˆ","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","permalink":"https://www.bboyzj.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 13ï¼šä¸Šä¼ App Storeæ‰€éœ€å„å›¾æ ‡å’Œå›¾ç‰‡å°ºå¯¸","slug":"OCå­¦ä¹ /OCå­¦ä¹ 13ï¼šä¸Šä¼ App-Storeæ‰€éœ€å„å›¾æ ‡å’Œå›¾ç‰‡å°ºå¯¸","date":"2023-03-08T19:13:37.000Z","updated":"2023-03-08T20:50:44.306Z","comments":true,"path":"2023/03/09/OCå­¦ä¹ /OCå­¦ä¹ 13ï¼šä¸Šä¼ App-Storeæ‰€éœ€å„å›¾æ ‡å’Œå›¾ç‰‡å°ºå¯¸/","link":"","permalink":"https://www.bboyzj.cn/2023/03/09/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A013%EF%BC%9A%E4%B8%8A%E4%BC%A0App-Store%E6%89%80%E9%9C%80%E5%90%84%E5%9B%BE%E6%A0%87%E5%92%8C%E5%9B%BE%E7%89%87%E5%B0%BA%E5%AF%B8/","excerpt":"","text":"App Icon å›¾æ ‡å°ºå¯¸ å‹å· åˆ†è¾¨ç‡ï¼ˆptï¼‰ åƒç´ ï¼ˆpxï¼‰ å›¾ç‰‡åç¼€ iPhone 20 40x40 2x iPhone 20 60x60 3x iPhone 29 58x58 2x iPhone 29 87x87 3x iPhone 40 80x80 2x iPhone 40 120x120 3x iPhone 60 120x120 2x iPhone 60 180x180 2x iPad 20 20x20 1x iPad 20 40x40 2x iPad 29 29x29 1x iPad 29 58x58 2x iPad 40 40x40 1x iPad 40 80x80 2x iPad 76 76x76 1x iPad 76 152x152 2x iPad 83.5 167x167 2x App Store 1024 1024x1024 1x App Store å¼•å¯¼é¡µå›¾ç‰‡å°ºå¯¸ å±å¹•å¤§å°ï¼ˆè‹±å¯¸ï¼‰ åƒç´ ï¼ˆpxï¼‰ 5.5 886x1920 6.5 1080x1920 12.9 1200x1600","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 12ï¼šHTTPçŠ¶æ€ç å¤§å…¨","slug":"OCå­¦ä¹ /OCå­¦ä¹ 12ï¼šHTTPçŠ¶æ€ç å¤§å…¨","date":"2023-03-08T19:12:49.000Z","updated":"2023-03-08T21:20:21.570Z","comments":true,"path":"2023/03/09/OCå­¦ä¹ /OCå­¦ä¹ 12ï¼šHTTPçŠ¶æ€ç å¤§å…¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/09/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A012%EF%BC%9AHTTP%E7%8A%B6%E6%80%81%E7%A0%81%E5%A4%A7%E5%85%A8/","excerpt":"","text":"å‰è¨€HTTPçŠ¶æ€ç ï¼ˆHTTP Status Codeï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºç½‘é¡µæœåŠ¡å™¨HTTPå“åº”çŠ¶æ€çš„3ä½æ•°å­—ä»£ç ã€‚ ç±»å‹æ‰€æœ‰çŠ¶æ€ç çš„ç¬¬ä¸€ä¸ªæ•°å­—ä»£è¡¨äº†å“åº”çš„äº”ç§çŠ¶æ€ä¹‹ä¸€ï¼Œå…¶åˆ†ç±»å¦‚ä¸‹ï¼š çŠ¶æ€ç  æè¿° 1xx ä¿¡æ¯ï¼Œè¡¨ç¤ºä¸´æ—¶å“åº”å¹¶éœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ 2xx æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç† 3xx è¡¨ç¤ºè¦å®Œæˆè¯·æ±‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æ“ä½œã€‚é€šå¸¸è¿™äº›ä»£ç ç”¨æ¥é‡å®šå‘ 4xx å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚ 5xx è¿™äº›çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨åœ¨å°è¯•å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿå†…éƒ¨é”™è¯¯ã€‚è¿™äº›é”™è¯¯å¯èƒ½æ˜¯æœåŠ¡å™¨æœ¬èº«çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯è¯·æ±‚å‡ºé”™ çŠ¶æ€ç è¯¦è§£ 1xxï¼š 100ï¼šï¼ˆç»§ç»­ï¼‰ è¯·æ±‚è€…åº”å½“ç»§ç»­æå‡ºè¯·æ±‚ã€‚ æœåŠ¡å™¨è¿”å›æ­¤ä»£ç è¡¨ç¤ºå·²æ”¶åˆ°è¯·æ±‚çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ­£åœ¨ç­‰å¾…å…¶ä½™éƒ¨åˆ†ã€‚ 101ï¼šï¼ˆåˆ‡æ¢åè®®ï¼‰ è¯·æ±‚è€…å·²è¦æ±‚æœåŠ¡å™¨åˆ‡æ¢åè®®ï¼ŒæœåŠ¡å™¨å·²ç¡®è®¤å¹¶å‡†å¤‡åˆ‡æ¢ã€‚ 102ï¼šç”±WebDAVï¼ˆRFC 2518ï¼‰æ‰©å±•çš„çŠ¶æ€ç ï¼Œä»£è¡¨å¤„ç†å°†è¢«ç»§ç»­æ‰§è¡Œã€‚ 2xxï¼š 200ï¼šï¼ˆæˆåŠŸï¼‰ æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ã€‚ é€šå¸¸ï¼Œè¿™è¡¨ç¤ºæœåŠ¡å™¨æä¾›äº†è¯·æ±‚çš„ç½‘é¡µã€‚ 201ï¼šï¼ˆå·²åˆ›å»ºï¼‰ è¯·æ±‚æˆåŠŸå¹¶ä¸”æœåŠ¡å™¨åˆ›å»ºäº†æ–°çš„èµ„æºã€‚ 202ï¼šï¼ˆå·²æ¥å—ï¼‰ æœåŠ¡å™¨å·²æ¥å—è¯·æ±‚ï¼Œä½†å°šæœªå¤„ç†ã€‚ 203ï¼šï¼ˆéæˆæƒä¿¡æ¯ï¼‰ æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†è¿”å›çš„ä¿¡æ¯å¯èƒ½æ¥è‡ªå¦ä¸€æ¥æºã€‚ 204ï¼šï¼ˆæ— å†…å®¹ï¼‰ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ 205ï¼šï¼ˆé‡ç½®å†…å®¹ï¼‰ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ 206ï¼šï¼ˆéƒ¨åˆ†å†…å®¹ï¼‰ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ† GET è¯·æ±‚ã€‚ 208ï¼šï¼ˆå·²ç»æŠ¥å‘Šï¼‰ä¸€ä¸ªDAVçš„ç»‘å®šæˆå‘˜è¢«å‰ä¸€ä¸ªè¯·æ±‚æšä¸¾ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«å†ä¸€æ¬¡åŒ…æ‹¬ã€‚ 226ï¼šï¼ˆIM Usedï¼‰æœåŠ¡å™¨å·²ç»æ»¡è¶³äº†è¯·æ±‚æ‰€è¦çš„èµ„æºï¼Œå¹¶ä¸”å“åº”æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®ä¾‹æ“ä½œåº”ç”¨äºå½“å‰å® 3xxï¼š 300ï¼šï¼ˆå¤šç§é€‰æ‹©ï¼‰ é’ˆå¯¹è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯æ‰§è¡Œå¤šç§æ“ä½œã€‚ æœåŠ¡å™¨å¯æ ¹æ®è¯·æ±‚è€… (user agent) é€‰æ‹©ä¸€é¡¹æ“ä½œï¼Œæˆ–æä¾›æ“ä½œåˆ—è¡¨ä¾›è¯·æ±‚è€…é€‰æ‹©ã€‚ 301ï¼šï¼ˆæ°¸ä¹…ç§»åŠ¨ï¼‰ è¯·æ±‚çš„ç½‘é¡µå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚ æœåŠ¡å™¨è¿”å›æ­¤å“åº”ï¼ˆå¯¹ GET æˆ– HEAD è¯·æ±‚çš„å“åº”ï¼‰æ—¶ï¼Œä¼šè‡ªåŠ¨å°†è¯·æ±‚è€…è½¬åˆ°æ–°ä½ç½®ã€‚ 302ï¼šï¼ˆä¸´æ—¶ç§»åŠ¨ï¼‰ æœåŠ¡å™¨ç›®å‰ä»ä¸åŒä½ç½®çš„ç½‘é¡µå“åº”è¯·æ±‚ï¼Œä½†è¯·æ±‚è€…åº”ç»§ç»­ä½¿ç”¨åŸæœ‰ä½ç½®æ¥è¿›è¡Œä»¥åçš„è¯·æ±‚ã€‚ 303ï¼šï¼ˆæŸ¥çœ‹å…¶ä»–ä½ç½®ï¼‰ è¯·æ±‚è€…åº”å½“å¯¹ä¸åŒçš„ä½ç½®ä½¿ç”¨å•ç‹¬çš„ GET è¯·æ±‚æ¥æ£€ç´¢å“åº”æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤ä»£ç ã€‚ 304ï¼šï¼ˆæœªä¿®æ”¹ï¼‰ è‡ªä»ä¸Šæ¬¡è¯·æ±‚åï¼Œè¯·æ±‚çš„ç½‘é¡µæœªä¿®æ”¹è¿‡ã€‚ æœåŠ¡å™¨è¿”å›æ­¤å“åº”æ—¶ï¼Œä¸ä¼šè¿”å›ç½‘é¡µå†…å®¹ã€‚ 305ï¼šï¼ˆä½¿ç”¨ä»£ç†ï¼‰ è¯·æ±‚è€…åªèƒ½ä½¿ç”¨ä»£ç†è®¿é—®è¯·æ±‚çš„ç½‘é¡µã€‚ å¦‚æœæœåŠ¡å™¨è¿”å›æ­¤å“åº”ï¼Œè¿˜è¡¨ç¤ºè¯·æ±‚è€…åº”ä½¿ç”¨ä»£ç†ã€‚ 307ï¼šï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰ æœåŠ¡å™¨ç›®å‰ä»ä¸åŒä½ç½®çš„ç½‘é¡µå“åº”è¯·æ±‚ï¼Œä½†è¯·æ±‚è€…åº”ç»§ç»­ä½¿ç”¨åŸæœ‰ä½ç½®æ¥è¿›è¡Œä»¥åçš„è¯·æ±‚ã€‚ 4xxï¼š 400:ï¼ˆé”™è¯¯è¯·æ±‚) æœåŠ¡å™¨ä¸ç†è§£è¯·æ±‚çš„è¯­æ³•ã€‚ 401ï¼š(æœªæˆæƒ) è¯·æ±‚è¦æ±‚èº«ä»½éªŒè¯ã€‚ å¯¹äºéœ€è¦ç™»å½•çš„ç½‘é¡µï¼ŒæœåŠ¡å™¨å¯èƒ½è¿”å›æ­¤å“åº”ã€‚ 402ï¼šè¯¥çŠ¶æ€ç æ˜¯ä¸ºäº†å°†æ¥å¯èƒ½çš„éœ€æ±‚è€Œé¢„ç•™çš„ã€‚ 403ï¼šï¼ˆç¦æ­¢) æœåŠ¡å™¨æ‹’ç»è¯·æ±‚ã€‚ 404ï¼šï¼ˆæœªæ‰¾åˆ°) æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„ç½‘é¡µã€‚ 405ï¼šï¼ˆæ–¹æ³•ç¦ç”¨) ç¦ç”¨è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ã€‚ 406ï¼šï¼ˆä¸æ¥å—) æ— æ³•ä½¿ç”¨è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å“åº”è¯·æ±‚çš„ç½‘é¡µã€‚ 407ï¼šï¼ˆéœ€è¦ä»£ç†æˆæƒ) æ­¤çŠ¶æ€ä»£ç ä¸ 401ï¼ˆæœªæˆæƒï¼‰ç±»ä¼¼ï¼Œä½†æŒ‡å®šè¯·æ±‚è€…åº”å½“æˆæƒä½¿ç”¨ä»£ç†ã€‚ 408ï¼šï¼ˆè¯·æ±‚è¶…æ—¶) æœåŠ¡å™¨ç­‰å€™è¯·æ±‚æ—¶å‘ç”Ÿè¶…æ—¶ã€‚ 409ï¼šï¼ˆå†²çª) æœåŠ¡å™¨åœ¨å®Œæˆè¯·æ±‚æ—¶å‘ç”Ÿå†²çªã€‚ æœåŠ¡å™¨å¿…é¡»åœ¨å“åº”ä¸­åŒ…å«æœ‰å…³å†²çªçš„ä¿¡æ¯ã€‚ 410ï¼šï¼ˆå·²åˆ é™¤) å¦‚æœè¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…åˆ é™¤ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ­¤å“åº”ã€‚ 411ï¼šï¼ˆéœ€è¦æœ‰æ•ˆé•¿åº¦) æœåŠ¡å™¨ä¸æ¥å—ä¸å«æœ‰æ•ˆå†…å®¹é•¿åº¦æ ‡å¤´å­—æ®µçš„è¯·æ±‚ã€‚ 412ï¼šï¼ˆæœªæ»¡è¶³å‰ææ¡ä»¶) æœåŠ¡å™¨æœªæ»¡è¶³è¯·æ±‚è€…åœ¨è¯·æ±‚ä¸­è®¾ç½®çš„å…¶ä¸­ä¸€ä¸ªå‰ææ¡ä»¶ã€‚ 413ï¼šï¼ˆè¯·æ±‚å®ä½“è¿‡å¤§) æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ï¼Œå› ä¸ºè¯·æ±‚å®ä½“è¿‡å¤§ï¼Œè¶…å‡ºæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€‚ 414ï¼šï¼ˆè¯·æ±‚çš„ URI è¿‡é•¿) è¯·æ±‚çš„ URIï¼ˆé€šå¸¸ä¸ºç½‘å€ï¼‰è¿‡é•¿ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ã€‚ 415ï¼šï¼ˆä¸æ”¯æŒçš„åª’ä½“ç±»å‹) è¯·æ±‚çš„æ ¼å¼ä¸å—è¯·æ±‚é¡µé¢çš„æ”¯æŒã€‚ 416ï¼šï¼ˆè¯·æ±‚èŒƒå›´ä¸ç¬¦åˆè¦æ±‚) å¦‚æœé¡µé¢æ— æ³•æä¾›è¯·æ±‚çš„èŒƒå›´ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å›æ­¤çŠ¶æ€ä»£ç ã€‚ 417ï¼šï¼ˆæœªæ»¡è¶³æœŸæœ›å€¼) æœåŠ¡å™¨æœªæ»¡è¶³â€æœŸæœ›â€è¯·æ±‚æ ‡å¤´å­—æ®µçš„è¦æ±‚ã€‚ 418ï¼šï¼ˆæˆ‘æ˜¯ä¸€ä¸ªèŒ¶å£¶ï¼‰è¿™ä¸ªä»£ç æ˜¯åœ¨1998å¹´ä½œä¸ºä¼ ç»Ÿçš„IETF April Foolsâ€˜ jokesè¢«å®šä¹‰çš„åœ¨RFC2324ï¼Œè¶…æ–‡æœ¬å’–å•¡ç½æ§åˆ¶åè®®ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¢«å®é™…çš„HTTPæœåŠ¡å™¨å®ç°ã€‚RFCæŒ‡å®šäº†è¿™ä¸ªä»£ç åº”è¯¥æ˜¯ç”±èŒ¶ç½è¿”å›ç»™é€Ÿæº¶å’–å•¡ã€‚ 419ï¼šï¼ˆè®¤è¯è¶…æ—¶ï¼‰å¹¶ä¸æ˜¯HTTPæ ‡æ³¨çš„ä¸€éƒ¨åˆ†ï¼Œ419è®¤è¯è¶…æ—¶è¡¨ç¤ºä»¥å‰çš„æœ‰æ•ˆè¯æ˜å·²ç»å¤±æ•ˆäº†ã€‚åŒæ—¶ä¹Ÿè¢«ç”¨äº401æœªè®¤è¯çš„æ›¿ä»£é€‰æ‹©ä¸ºäº†ä»å…¶å®ƒè¢«æ‹’ç»è®¿é—®çš„å·²è®¤è¯å®¢æˆ·ç«¯ä¸­æŒ‡å®šæœåŠ¡å™¨çš„èµ„æºã€‚ 420ï¼šï¼ˆæ–¹æ³•å¤±æ•ˆï¼‰ä¸æ˜¯HTTPçš„æ ‡å‡†ï¼Œä½†æ˜¯è¢«Springå®šä¹‰åœ¨HTTPçŠ¶æ€ç±»ä¸­å½“æ–¹æ³•å¤±æ—¶ä½¿ç”¨ã€‚è¿™ä¸ªçŠ¶æ€ç å·²ç»ä¸æ¨èåœ¨Springä¸­ä½¿ç”¨ã€‚ 420ï¼šï¼ˆæé«˜ä½ çš„è€å¿ƒï¼‰ä¹Ÿä¸æ˜¯HTTPæ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è¢«ç‰ˆæœ¬1çš„Twitteræœç´¢å’Œè¶‹åŠ¿APiè¿”å›å½“å®¢æˆ·ç«¯çš„é€Ÿç‡è¢«é™åˆ¶çš„æ—¶å€™ã€‚å…¶å®ƒçš„æœåŠ¡æä¾›å•†å¯èƒ½ä¼šä½¿ç”¨429å¤ªå¤šçš„è¯·æ±‚å“åº”ç æ¥ä»£æ›¿ã€‚ 421ï¼šä»å½“å‰å®¢æˆ·ç«¯æ‰€åœ¨çš„IPåœ°å€åˆ°æœåŠ¡å™¨çš„è¿æ¥æ•°è¶…è¿‡äº†æœåŠ¡å™¨è®¸å¯çš„æœ€å¤§èŒƒå›´ã€‚é€šå¸¸ï¼Œè¿™é‡Œçš„IPåœ°å€æŒ‡çš„æ˜¯ä»æœåŠ¡å™¨ä¸Šçœ‹åˆ°çš„å®¢æˆ·ç«¯åœ°å€ï¼ˆæ¯”å¦‚ç”¨æˆ·çš„ç½‘å…³æˆ–è€…ä»£ç†æœåŠ¡å™¨åœ°å€ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿æ¥æ•°çš„è®¡ç®—å¯èƒ½æ¶‰åŠåˆ°ä¸æ­¢ä¸€ä¸ªç»ˆç«¯ç”¨æˆ·ã€‚ 422ï¼šè¯·æ±‚æ ¼å¼æ­£ç¡®ï¼Œä½†æ˜¯ç”±äºå«æœ‰è¯­ä¹‰é”™è¯¯ï¼Œæ— æ³•å“åº”ã€‚ï¼ˆRFC 4918 WebDAVï¼‰423 Locked å½“å‰èµ„æºè¢«é”å®šã€‚ï¼ˆRFC 4918 WebDAVï¼‰ 424ï¼šç”±äºä¹‹å‰çš„æŸä¸ªè¯·æ±‚å‘ç”Ÿçš„é”™è¯¯ï¼Œå¯¼è‡´å½“å‰è¯·æ±‚å¤±è´¥ï¼Œä¾‹å¦‚ PROPPATCHã€‚ï¼ˆRFC 4918 WebDAVï¼‰ 425ï¼šåœ¨WebDav Advanced Collections è‰æ¡ˆä¸­å®šä¹‰ï¼Œä½†æ˜¯æœªå‡ºç°åœ¨ã€ŠWebDAV é¡ºåºé›†åè®®ã€‹ï¼ˆRFC 3658ï¼‰ä¸­ã€‚ 426ï¼šå®¢æˆ·ç«¯åº”å½“åˆ‡æ¢åˆ°TLS&#x2F;1.0ã€‚ï¼ˆRFC 2817ï¼‰ 428ï¼š(éœ€è¦å‰ç½®æ¡ä»¶)åŸå§‹æœåŠ¡å™¨éœ€è¦æœ‰æ¡ä»¶çš„è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯GETä¸€ä¸ªèµ„æºçš„çŠ¶æ€çš„æ—¶å€™ï¼ŒåŒæ—¶åˆPUTå›ç»™æœåŠ¡å™¨ï¼Œä¸æ­¤åŒæ—¶ç¬¬ä¸‰æ–¹ä¿®æ”¹çŠ¶æ€åˆ°æœåŠ¡å™¨ä¸Šçš„æ—¶å€™ï¼Œä¸ºäº†é¿å…ä¸¢å¤±æ›´æ–°çš„é—®é¢˜å‘ç”Ÿå°†ä¼šå¯¼è‡´å†²çªã€‚ 429ï¼šï¼ˆè¿‡å¤šè¯·æ±‚ï¼‰ç”¨æˆ·å·²ç»å‘é€äº†å¤ªå¤šçš„è¯·æ±‚åœ¨æŒ‡å®šçš„æ—¶é—´é‡Œã€‚ç”¨äºé™åˆ¶é€Ÿç‡ã€‚ 431ï¼šï¼ˆè¯·æ±‚å¤´éƒ¨å­—æ®µå¤ªå¤§ï¼‰æœåŠ¡å™¨ç”±äºä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚å¤´éƒ¨å­—æ®µæˆ–è€…æ˜¯å…¨éƒ¨çš„å­—æ®µå¤ªå¤§è€Œä¸æ„¿æ„å¤„ç†è¯·æ±‚ã€‚ 440ï¼šï¼ˆç™»é™†è¶…æ—¶ï¼ˆå¾®è½¯ï¼‰ï¼‰ä¸€ä¸ªå¾®è½¯çš„æ‰©å±•ï¼Œæ„å‘³ç€ä½ çš„ä¼šè¯å·²ç»è¶…æ—¶ã€‚ 444ï¼šï¼ˆæ— å“åº”ï¼‰è¢«ä½¿ç”¨åœ¨Nginxçš„æ—¥å¿—ä¸­è¡¨æ˜æœåŠ¡å™¨æ²¡æœ‰è¿”å›ä¿¡æ¯ç»™å®¢æˆ·ç«¯å¹¶ä¸”å…³é—­äº†è¿æ¥ï¼ˆåœ¨å¨æ…‘æ¶æ„è½¯ä»¶çš„æ—¶å€™æ¯”è¾ƒæœ‰ç”¨ï¼‰ã€‚ 449ï¼šï¼ˆé‡è¯•ï¼ˆå¾®è½¯ï¼‰ï¼‰ä¸€ä¸ªå¾®è½¯çš„æ‰©å±•ã€‚è¯·æ±‚åº”è¯¥åœ¨æ‰§è¡Œé€‚å½“çš„åŠ¨ä½œä¹‹åè¢«é‡è¯•ã€‚ 450ï¼šï¼ˆè¢«Windowså®¶é•¿æ§åˆ¶é˜»å¡ï¼ˆå¾®è½¯ï¼‰ï¼‰ä¸€ä¸ªå¾®è½¯çš„æ‰©å±•ã€‚è¿™ä¸ªé”™è¯¯æ˜¯å½“Windowså®¶é•¿æ§åˆ¶æ‰“å¼€å¹¶ä¸”é˜»å¡æŒ‡å®šç½‘é¡µçš„è®¿é—®çš„æ—¶å€™è¢«æŒ‡å®šã€‚ 451ï¼šï¼ˆç”±äºæ³•å¾‹åŸå› è€Œæ— æ•ˆï¼ˆå› ç‰¹ç½‘è‰ç¨¿ï¼‰ï¼‰è¢«å®šä¹‰åœ¨å› ç‰¹ç½‘è‰ç¨¿â€œä¸€ä¸ªæ–°çš„HTTPçŠ¶æ€ç ç”¨äºæ³•å¾‹é™åˆ¶çš„èµ„æºâ€ã€‚è¢«ç”¨äºå½“èµ„æºçš„è®¿é—®ç”±äºæ³•å¾‹åŸå› è¢«ç¦æ­¢çš„æ—¶å€™ã€‚ä¾‹å¦‚æ£€æŸ¥åˆ¶åº¦æˆ–è€…æ˜¯æ”¿åºœå¼ºåˆ¶è¦æ±‚ç¦æ­¢è®¿é—®ã€‚ä¸€ä¸ªä¾‹å­æ˜¯1953å¹´dystopiançš„å°è¯´Fahrenheit 451å°±æ˜¯ä¸€ä¸ªéæ³•çš„èµ„æºã€‚ 451ï¼šï¼ˆé‡å®šå‘ï¼ˆå¾®è½¯ï¼‰ï¼‰è¢«ç”¨åœ¨Exchange ActiveSyncä¸­å¦‚æœä¸€ä¸ªæ›´æœ‰æ•ˆçš„æœåŠ¡å™¨èƒ½å¤Ÿè¢«ä½¿ç”¨æˆ–è€…æ˜¯æœåŠ¡å™¨ä¸èƒ½è®¿é—®ç”¨æˆ·çš„é‚®ç®±ã€‚å®¢æˆ·ç«¯ä¼šå‡å®šé‡æ–°æ‰§è¡ŒHTTPè‡ªåŠ¨å‘ç°åè®®å»å¯»æ‰¾æ›´é€‚åˆçš„æœåŠ¡å™¨ã€‚ 494ï¼šï¼ˆè¯·æ±‚å¤´å¤ªå¤§ï¼ˆNginxï¼‰ï¼‰Nginxå†…ç½®ä»£ç å’Œ431ç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯è¢«æ›´æ—©åœ°å¼•å…¥åœ¨ç‰ˆæœ¬0.9.4ï¼ˆåœ¨2011å¹´1æœˆ21æ—¥ï¼‰ã€‚ 495ï¼šï¼ˆè¯ä¹¦é”™è¯¯ï¼ˆNginxï¼‰ï¼‰Nginxå†…ç½®çš„ä»£ç ï¼Œå½“ä½¿ç”¨SSLå®¢æˆ·ç«¯è¯ä¹¦çš„æ—¶å€™é”™è¯¯ä¼šå‡ºç°ä¸ºäº†åœ¨æ—¥å¿—é”™è¯¯ä¸­åŒºåˆ†å®ƒå’Œ4XXå’Œä¸€ä¸ªé”™è¯¯é¡µé¢çš„é‡å®šå‘ã€‚ã€‚ 496ï¼šï¼ˆæ²¡æœ‰è¯ä¹¦ï¼ˆNginxï¼‰ï¼‰Nginxå†…ç½®çš„ä»£ç ï¼Œå½“å®¢æˆ·ç«¯ä¸èƒ½æä¾›è¯ä¹¦åœ¨æ—¥å¿—ä¸­åˆ†è¾¨4XXå’Œä¸€ä¸ªé”™è¯¯é¡µé¢çš„é‡å®šå‘ã€‚ 497ï¼šï¼ˆHTTPåˆ°HTTPSï¼ˆNginxï¼‰ï¼‰Nginxå†…ç½®çš„ä»£ç ï¼Œè¢«ç”¨äºåŸå§‹çš„HTTPçš„è¯·æ±‚å‘é€ç»™HTTPSç«¯å£å»åˆ†è¾¨4XXåœ¨æ—¥å¿—ä¸­å’Œä¸€ä¸ªé”™è¯¯é¡µé¢çš„é‡å®šå‘ã€‚ 498ï¼šï¼ˆä»¤ç‰Œè¶…æ—¶æˆ–å¤±æ•ˆï¼ˆEsriï¼‰ï¼‰ç”±ArcGIS for Serverè¿”å›ã€‚è¿™ä¸ªä»£ç æ„å‘³ç€ä»¤ç‰Œçš„è¶…æ—¶æˆ–è€…æ˜¯å¤±æ•ˆã€‚ 499ï¼šï¼ˆå®¢æˆ·ç«¯å…³é—­è¯·æ±‚ï¼ˆNginxï¼‰ï¼‰è¢«ç”¨åœ¨Nginxæ—¥å¿—å»è¡¨æ˜ä¸€ä¸ªè¿æ¥å·²ç»è¢«å®¢æˆ·ç«¯å…³é—­å½“æœåŠ¡å™¨ä»ç„¶æ­£åœ¨å¤„ç†å®ƒçš„è¯·æ±‚ï¼Œæ˜¯çš„æœåŠ¡å™¨æ— æ³•è¿”è´§çŠ¶æ€ç ã€‚ 499ï¼šï¼ˆéœ€è¦ä»¤ç‰Œï¼ˆEsriï¼‰ï¼‰ç”±ArcGIS for Serverè¿”å›ã€‚æ„å‘³ç€éœ€è¦ä¸€ä¸ªä»¤ç‰Œï¼ˆå¦‚æœæ²¡æœ‰ä»¤ç‰Œè¢«æäº¤ï¼‰ã€‚ 5xxï¼š 500ï¼šï¼ˆæœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼‰ æœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚ 501ï¼šï¼ˆå°šæœªå®æ–½ï¼‰ æœåŠ¡å™¨ä¸å…·å¤‡å®Œæˆè¯·æ±‚çš„åŠŸèƒ½ã€‚ ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨æ— æ³•è¯†åˆ«è¯·æ±‚æ–¹æ³•æ—¶å¯èƒ½ä¼šè¿”å›æ­¤ä»£ç ã€‚ 502ï¼šï¼ˆé”™è¯¯ç½‘å…³ï¼‰ æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°æ— æ•ˆå“åº”ã€‚ 503ï¼šï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰ æœåŠ¡å™¨ç›®å‰æ— æ³•ä½¿ç”¨ï¼ˆç”±äºè¶…è½½æˆ–åœæœºç»´æŠ¤ï¼‰ã€‚ é€šå¸¸ï¼Œè¿™åªæ˜¯æš‚æ—¶çŠ¶æ€ã€‚ 504ï¼šï¼ˆç½‘å…³è¶…æ—¶ï¼‰ æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ã€‚ 505ï¼šï¼ˆHTTP ç‰ˆæœ¬ä¸å—æ”¯æŒï¼‰ æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­æ‰€ç”¨çš„ HTTP åè®®ç‰ˆæœ¬ã€‚ 506ï¼šç”±ã€Šé€æ˜å†…å®¹åå•†åè®®ã€‹ï¼ˆRFC 2295ï¼‰æ‰©å±•ï¼Œä»£è¡¨æœåŠ¡å™¨å­˜åœ¨å†…éƒ¨é…ç½®é”™è¯¯ï¼šè¢«è¯·æ±‚çš„åå•†å˜å…ƒèµ„æºè¢«é…ç½®ä¸ºåœ¨é€æ˜å†…å®¹åå•†ä¸­ä½¿ç”¨è‡ªå·±ï¼Œå› æ­¤åœ¨ä¸€ä¸ªåå•†å¤„ç†ä¸­ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é‡ç‚¹ã€‚ 507ï¼šæœåŠ¡å™¨æ— æ³•å­˜å‚¨å®Œæˆè¯·æ±‚æ‰€å¿…é¡»çš„å†…å®¹ã€‚è¿™ä¸ªçŠ¶å†µè¢«è®¤ä¸ºæ˜¯ä¸´æ—¶çš„ã€‚WebDAV (RFC 4918) 508ï¼šï¼ˆå‘ç°ç¯è·¯ï¼‰æœåŠ¡å™¨å‘ç°äº†ä¸€ä¸ªæ— é™çš„å¾ªç¯æ¡£å¤„ç†è¯·æ±‚çš„æ—¶å€™ã€‚ 509ï¼šæœåŠ¡å™¨è¾¾åˆ°å¸¦å®½é™åˆ¶ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå®˜æ–¹çš„çŠ¶æ€ç ï¼Œä½†æ˜¯ä»è¢«å¹¿æ³›ä½¿ç”¨ã€‚ 510ï¼šè·å–èµ„æºæ‰€éœ€è¦çš„ç­–ç•¥å¹¶æ²¡æœ‰æ²¡æ»¡è¶³ã€‚ï¼ˆRFC 2774ï¼‰ã€‚ 511ï¼šï¼ˆéœ€è¦ç½‘ç»œæˆæƒï¼‰å®¢æˆ·ç«¯éœ€è¦æˆæƒå»ç«çš„ç½‘ç»œçš„è®¿é—®æƒé™ã€‚ä¸€èˆ¬ç”¨äºä»£ç†äº¤äº’ä¸­è¢«ç”¨æ¥è¿›è¡Œç½‘ç»œçš„è®¿é—®æ§åˆ¶ã€‚ 520ï¼šï¼ˆæœªçŸ¥é”™è¯¯ï¼‰è¿™ä¸ªçŠ¶æ€ç ä¹Ÿæ²¡æœ‰è¢«æŒ‡å®šåœ¨ä»»ä½•RFCä¸­ï¼Œå¹¶ä¸”åªä¼šè¢«ä¸€äº›æœåŠ¡å™¨è¿”å›ï¼Œä¾‹å¦‚å¾®è½¯çš„Azureå’ŒCloudFlareæœåŠ¡å™¨:â€520é”™è¯¯ã€‚æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•è·å…¨éƒ¨çš„å“åº”å½“åŸå§‹æœåŠ¡å™¨è¿”å›ä¸€äº›æœªçŸ¥çš„æˆ–è€…ä¸€äº›ä¸èƒ½è¢«å¿å—æˆ–è€…è¢«è§£é‡Šçš„(åè®®è¿åæˆ–è€…ç©ºå“åº”)â€ã€‚ 598ï¼šï¼ˆç½‘ç»œè¯»å–è¶…æ—¶å¼‚å¸¸(æœªçŸ¥)ï¼‰è¿™ä¸ªçŠ¶æ€ç ä¹Ÿæ²¡æœ‰åœ¨ä»»ä½•RFCä¸­æŒ‡å®šï¼Œä½†æ˜¯è¢«ç”¨åœ¨å¾®è½¯çš„HTTPä»£ç†ä¸­å»æ ‡æ³¨ä¸€ä¸ªç½‘ç»œè¯»å–è¶…æ—¶åœ¨ä¸€ä¸ªå®¢æˆ·ç«¯ä¹‹å‰çš„ä»£ç†çš„åé¢ã€‚ 599ï¼šï¼ˆç½‘ç»œè¿æ¥è¶…æ—¶å¼‚å¸¸(æœªçŸ¥)ï¼‰è¿™ä¸ªçŠ¶æ€ç ä¹Ÿæ²¡æœ‰åœ¨ä»»ä½•RFCä¸­æŒ‡å®šï¼Œä½†æ˜¯è¢«ç”¨åœ¨å¾®è½¯çš„HTTPä»£ç†ä¸­å»æ ‡æ³¨ä¸€ä¸ªç½‘ç»œè¿æ¥è¶…æ—¶åœ¨ä¸€ä¸ªå®¢æˆ·ç«¯ä¹‹å‰çš„ä»£ç†çš„åé¢ã€‚","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 11ï¼šXcode å¸¸ç”¨çš„å¿«æ·é”®å¤§å…¨","slug":"OCå­¦ä¹ /OCå­¦ä¹ 11ï¼šXcode-å¸¸ç”¨çš„å¿«æ·é”®å¤§å…¨","date":"2023-03-08T19:12:11.000Z","updated":"2023-03-08T20:26:04.054Z","comments":true,"path":"2023/03/09/OCå­¦ä¹ /OCå­¦ä¹ 11ï¼šXcode-å¸¸ç”¨çš„å¿«æ·é”®å¤§å…¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/09/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A011%EF%BC%9AXcode-%E5%B8%B8%E7%94%A8%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%A4%A7%E5%85%A8/","excerpt":"","text":"é€šç”¨å¿«æ·é”® Command + A ï¼šå…¨é€‰Command + C ï¼šå¤åˆ¶Command + V ï¼šç²˜è´´Command + X ï¼šå‰ªåˆ‡Command + Z ï¼šæ’¤é”€Command + Shift + Z ï¼š æ’¤é”€åˆšæ‰çš„æ’¤é”€ æ–‡ä»¶å¿«æ·é”® Command + S ï¼šä¿å­˜Command + Shift + S ï¼šå¦å­˜ä¸º é¡¹ç›®å¿«æ·é”® Command + Shift + N ï¼šæ–°å»ºé¡¹ç›®Command + N ï¼šæ–°å»ºæ–‡ä»¶Command + O ï¼šæ‰“å¼€æ–‡ä»¶Command + D ï¼šå¿«é€Ÿå¤åˆ¶ä¸€æ®µä»£ç Optional + å•å‡» ï¼šæ˜¾ç¤ºæè¿°æ–‡ä»¶Command + å•å‡»ï¼šè·³è½¬å‡½æ•°Command + Optional + ä¸Š&#x2F;ä¸‹ç®­å¤´ ï¼šå¿«é€Ÿåˆ‡æ¢.hå’Œ.mæ–‡ä»¶ Command + 0 ï¼šæ˜¾ç¤º&#x2F;éšè—å¯¼èˆªå™¨é¢æ¿Command + Optional + 0 ï¼šæ˜¾ç¤º&#x2F;éšè—å·¥å…·é¢æ¿Command + Shift + o ï¼šå¿«é€Ÿæœç´¢ æ³¨é‡Šå¿«æ·é”® Command + Optional + &#x2F; ï¼šå¿«é€Ÿæ³¨é‡ŠCommand + &#x2F; ï¼šå•è¡Œæ³¨é‡Š æŠ˜å &#x2F;å±•å¼€å¿«æ·é”® Command + Optional + å·¦ç®­å¤´ ï¼šæŠ˜å ä»£ç Command + Optional + å³ç®­å¤´ ï¼šå±•å¼€ä»£ç  æ–‡å­—å¿«æ·é”® Command + - ï¼šç¼©å°æ–‡å­—Command + + ï¼šæ”¾å¤§æ–‡å­— è°ƒè¯•è¿è¡Œã€åœæ­¢ Command + B ï¼šç¼–è¯‘Command + R ï¼šè¿è¡ŒCommand + . ï¼šåœæ­¢Command + Shift + K ï¼šæ¸…ç† ç§»åŠ¨ä»£ç å— Command + [ ï¼šå·¦ç§»ä»£ç å—Command + ] ï¼šå³ç§»ä»£ç å— Command + Optional + [ ï¼šä¸Šç§»ä»£ç å—Command + Optional + ] ï¼šä¸‹ç§»ä»£ç å— ç§»åŠ¨å…‰æ ‡å¿«æ·é”® Command + å·¦&#x2F;å³ç®­å¤´ ï¼šå°†å…‰æ ‡ç§»åŠ¨è‡³è¡Œé¦–&#x2F;å°¾Command + ä¸Š&#x2F;ä¸‹ç®­å¤´ ï¼šå°†å…‰æ ‡ç§»åŠ¨è‡³æ–‡æ¡£è¡Œé¦–&#x2F;å°¾ Command + Shift + å·¦&#x2F;å³ç®­å¤´ ï¼šå‘å·¦&#x2F;å³é€‰æ‹©ä¸€ä¸ªå•è¯ Command + Shift + å·¦&#x2F;å³ç®­å¤´ ï¼šé€‰æ‹©åˆ°è¡Œé¦–&#x2F;å°¾ è°ƒè¯•å¿«æ·é”® Command + \\ ï¼šè®¾ç½®&#x2F;å–æ¶ˆæ–­ç‚¹ çª—å£å¿«æ·é”® Command + H ï¼šéšè—Command + M ï¼šæœ€å°åŒ–Command + P ï¼šæ‰“å°Command + Q ï¼šé€€å‡ºé¡¹ç›®Command + W ï¼šå…³é—­å½“å‰æ–‡ä»¶ çª—å£åˆ‡æ¢å¿«æ·é”® Command + Tab ï¼šç¨‹åºé—´åˆ‡æ¢Command + ~ ï¼šçª—å£é—´åˆ‡æ¢ å±å¹•å¿«æ·é”® Command + Shift + F3 ï¼šæˆªå›¾æ•´ä¸ªå±å¹•Command + Shift + F4 ï¼šæˆªå–æŒ‡å®šåŒºåŸŸ ç³»ç»Ÿå¿«æ·é”® Command + Optional + ESC ï¼šå¼ºåˆ¶é€€å‡ºç¨‹åºCommand + Space ï¼šåˆ‡æ¢è¯­è¨€Command + Shift + ï¼Ÿï¼šå¸®åŠ© ç¼–è¾‘å¿«æ·é”® Command + Delete ï¼šåˆ é™¤Command + Shift + Delete ï¼šæ¸…ç©ºåƒåœ¾æ¡¶Command + Shift + A ï¼šæ‰“å¼€åº”ç”¨ç¨‹åºç›®å½•Command + Shift + C ï¼šæ‰“å¼€ Computer ç›®å½•Command + Shift + H ï¼šæ‰“å¼€ Home ç›®å½•","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 10ï¼šiPhoneå„ç³»åˆ—å°ºå¯¸å¤§å…¨","slug":"OCå­¦ä¹ /OCå­¦ä¹ 10ï¼šiPhoneå„ç³»åˆ—å°ºå¯¸å¤§å…¨","date":"2023-03-08T19:11:14.000Z","updated":"2023-03-08T21:07:28.498Z","comments":true,"path":"2023/03/09/OCå­¦ä¹ /OCå­¦ä¹ 10ï¼šiPhoneå„ç³»åˆ—å°ºå¯¸å¤§å…¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/09/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A010%EF%BC%9AiPhone%E5%90%84%E7%B3%BB%E5%88%97%E5%B0%BA%E5%AF%B8%E5%A4%A7%E5%85%A8/","excerpt":"","text":"iPhoneæ‰‹æœºå°ºå¯¸å¤§å…¨ æœºå‹ å±å¹•å°ºå¯¸ ï¼ˆè‹±å¯¸ï¼‰ åˆ†è¾¨ç‡ï¼ˆptï¼‰ åƒç´ ï¼ˆpxï¼‰ å›¾ç‰‡åç¼€ å®‰å…¨åŒºåŸŸï¼ˆä¸Š&#x2F;ä¸‹ï¼‰ iPhone4&#x2F;4s 3.5 320x480 640x960 @2x iPhone5&#x2F;5c&#x2F;5s&#x2F;SE 4 320x568 640x1136 @2x iPhone6&#x2F;6s&#x2F;7&#x2F;8 4.7 375x667 750x1334 @2x iPhone6&#x2F;6s&#x2F;7&#x2F;8 Plus 5.5 414x736 1080x1920 @3x iPhoneX&#x2F;iPhoneXS&#x2F;11Pro 5.8 375x812 1125x2436 @3x 44&#x2F;34 iPhoneXR&#x2F;11 6.1 414x896 828x1792 @2x 48&#x2F;34 iPhoneXSMax&#x2F;11ProMax 6.5 414x896 1242x2688 @3x 47&#x2F;34 iPhone12miniï¼ˆ&gt;&#x3D;iOS14ï¼‰ iPhone13miniï¼ˆ&gt;&#x3D;iOS15ï¼‰ 5.4 360x780 1080x2340 @3x 47&#x2F;34 iPhone12&#x2F;12Pro iPhone13&#x2F;13Pro 6.1 390x844 1170x2532 @3x 47&#x2F;34 iPhone12&#x2F;13ProMax 6.7 428x926 1284x2778 @3x 47&#x2F;34 iPhone14 ï¼ˆ&gt;&#x3D;iOS16ï¼‰ 6.1 390x844 1170x2532 @3x 47&#x2F;34 iPhone14 Plus 6.7 428x926 1284x2778 @3x 47&#x2F;34 iPhone14 Pro 6.1 393x852 1179x2556 @3x 59&#x2F;34 iPhone14 Pro Max 6.7 430x932 1290x2796 @3x 59&#x2F;34","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 12ï¼šä¿®æ”¹é¡¹ç›®åç§°","slug":"OCå­¦ä¹ /OCå­¦ä¹ 08ï¼šä¿®æ”¹é¡¹ç›®åç§°çš„æµç¨‹","date":"2023-03-08T12:20:10.000Z","updated":"2023-03-09T07:11:19.120Z","comments":true,"path":"2023/03/08/OCå­¦ä¹ /OCå­¦ä¹ 08ï¼šä¿®æ”¹é¡¹ç›®åç§°çš„æµç¨‹/","link":"","permalink":"https://www.bboyzj.cn/2023/03/08/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A008%EF%BC%9A%E4%BF%AE%E6%94%B9%E9%A1%B9%E7%9B%AE%E5%90%8D%E7%A7%B0%E7%9A%84%E6%B5%81%E7%A8%8B/","excerpt":"","text":"å‰è¨€ å¦‚æœæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­é›†æˆä¸‰æ–¹åº“ SDwebImage æ—¶ï¼ŒæŠ¥é”™ Framework not found Pods_________ï¼Œè¯´æ˜ å·¥ç¨‹åç§°ç”¨æ±‰å­—äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ›´æ”¹é¡¹ç›®å åœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€æ±‚æƒ³æ›´æ”¹é¡¹ç›®å ä¿®æ”¹åç§°Xcode ä¿®æ”¹ å·¥ç¨‹å æ‰“å¼€ Xcode çš„ Show the File Inspectorï¼Œä¿®æ”¹ Name ä¸º FirstFrameDemo ä¿®æ”¹æˆ FirstFrameDemo ä¹‹åï¼Œå›è½¦ï¼Œ è¿™é‡Œ Xcode åˆ—ä¸¾äº†å¯ä»¥ä¸ºæˆ‘ä»¬åšçš„æ›´æ”¹çš„åç§° ç‚¹å‡» Rename -&gt; OKï¼ŒXcode ä¸ºæˆ‘ä»¬é‡å‘½åäº†ä¸€éƒ¨åˆ†ã€‚ å…³é—­é¡¹ç›®å·¥ç¨‹ï¼Œä¿®æ”¹é¡¹ç›®æ–‡ä»¶å¤¹åç§°ï¼ˆç”±åŸå·¥ç¨‹å -&gt; ä¿®æ”¹æˆæ–°çš„å·¥ç¨‹åï¼‰ ä¿®æ”¹å‰ï¼š ä¿®æ”¹åï¼š ä¿®æ”¹é¡¹ç›®æ–‡ä»¶åï¼ˆå³å‡»é€‰æ‹©åŒ…å†…å®¹ï¼‰ ç‚¹å‡» project.phxproj æ–‡ä»¶ï¼Œå°† è·å–è§†é¢‘çš„ç¬¬ä¸€å¸§ æ›¿æ¢æˆ FirstFrameDemo ï¼Œå…¨éƒ¨æ›¿æ¢ All -&gt; Done æ‰“å¼€é¡¹ç›® FirstFrameDemo.xcworkspace ï¼Œé¡¹ç›®å†…å…¨å±€æ›¿æ¢ è·å–è§†é¢‘çš„ç¬¬ä¸€å¸§ -&gt; FirstFrameDemo ä¿®æ”¹ Podfile æ–‡ä»¶ä¸­é¡¹ç›®åç§° æ‰“å¼€ç»ˆç«¯ï¼Œåˆ‡æ¢åˆ°å½“å‰é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ pos intall åˆ é™¤æ—§çš„ workspace æ–‡ä»¶ è‡³æ­¤é¡¹ç›®åå·²ç»å®Œå…¨ä¿®æ”¹å®Œæˆäº†","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 11ï¼šPchæ–‡ä»¶","slug":"OCå­¦ä¹ /OCå­¦ä¹ 09ï¼šPchæ–‡ä»¶","date":"2023-03-08T11:43:38.000Z","updated":"2023-03-08T18:54:39.914Z","comments":true,"path":"2023/03/08/OCå­¦ä¹ /OCå­¦ä¹ 09ï¼šPchæ–‡ä»¶/","link":"","permalink":"https://www.bboyzj.cn/2023/03/08/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A009%EF%BC%9APch%E6%96%87%E4%BB%B6/","excerpt":"","text":"","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 10ï¼šUITableViwç‚¹å‡»äº‹ä»¶å’Œé¡µé¢ä¸Šçš„æ‰‹åŠ¿å†²çªæ€ä¹ˆè§£å†³ï¼Ÿ","slug":"OCå­¦ä¹ /OCå­¦ä¹ 07ï¼šUITableViwç‚¹å‡»äº‹ä»¶å’Œé¡µé¢ä¸Šçš„æ‰‹åŠ¿å†²çªæ€ä¹ˆè§£å†³ï¼Ÿ","date":"2023-03-07T11:17:26.000Z","updated":"2023-03-08T11:41:42.465Z","comments":true,"path":"2023/03/07/OCå­¦ä¹ /OCå­¦ä¹ 07ï¼šUITableViwç‚¹å‡»äº‹ä»¶å’Œé¡µé¢ä¸Šçš„æ‰‹åŠ¿å†²çªæ€ä¹ˆè§£å†³ï¼Ÿ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/07/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A007%EF%BC%9AUITableViw%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6%E5%92%8C%E9%A1%B5%E9%9D%A2%E4%B8%8A%E7%9A%84%E6%89%8B%E5%8A%BF%E5%86%B2%E7%AA%81%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%EF%BC%9F/","excerpt":"","text":"ä¸¾ä¾‹è¯´æ˜ä¸‹é¢ä»¥ä¸€ä¸ªä¾‹å­è®²è§£ å›¾ä¸­ superView æœ‰ä¸¤ä¸ª subViewï¼Œåˆ†åˆ«æ˜¯ testView å’Œ testBtnã€‚æˆ‘ä»¬åœ¨ superView å’Œ testView éƒ½é‡è½½ touchsBegan:withEventã€touchsEnded:withEventã€ touchsMoved:withEventã€touchsCancelled:withEventæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ superView ä¸Šæ·»åŠ å•å‡»æ‰‹åŠ¿ UITapGestureRecognizerï¼Œactionåä¸ºtapActionï¼Œç»™testBtnç»‘å®šactionåä¸ºtestBtnClickedã€‚ ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š SuperView 1234567891011121314151617181920212223242526- (void)initUI&#123; UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapAction)]; [self addGestureRecognizer:tap]; [self addSubview:self.testView]; [self addSubview:self.testBtn];&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; superView touchs Began&quot;);&#125;- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; superView touchs Moved&quot;);&#125;- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; superView touchs Ended&quot;);&#125;- (void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; superView touchs Cancelled&quot;);&#125;- (void)tapAction &#123; NSLog(@&quot;=========&gt; single Tapped&quot;);&#125;- (void)clickBtn &#123; NSLog(@&quot;=========&gt; click btn&quot;);&#125; textView 12345678910111213//testView- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; testView touchs Began&quot;);&#125;- (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; testView touchs Moved&quot;);&#125;- (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; testView touchs Ended&quot;);&#125;- (void)touchesCancelled:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@&quot;=========&gt; testView touchs Cancelled&quot;);&#125; æƒ…æ™¯Oï¼šæ³¨é‡Š æ‰‹åŠ¿ ï¼Œåˆ†åˆ«ç‚¹å‡» superView å’Œ testViewï¼š 123452023-03-08 17:58:44.408166+0800 æ‰‹åŠ¿å†²çª[20427:1092257] =========&gt; superView touchs Began2023-03-08 17:58:44.544181+0800 æ‰‹åŠ¿å†²çª[20427:1092257] =========&gt; superView touchs Ended2023-03-08 17:58:54.666862+0800 æ‰‹åŠ¿å†²çª[20427:1092257] =========&gt; testView touchs Began2023-03-08 17:58:54.825938+0800 æ‰‹åŠ¿å†²çª[20427:1092257] =========&gt; testView touchs Ended æƒ…æ™¯Aï¼šå•å‡» superView ï¼Œè¾“å‡ºç»“æœï¼š 1232023-03-08 17:32:44.983101+0800 æ‰‹åŠ¿å†²çª[20227:1064772] =========&gt; superView touchs Began2023-03-08 17:32:45.043310+0800 æ‰‹åŠ¿å†²çª[20227:1064772] =========&gt; single Tapped2023-03-08 17:32:45.043538+0800 æ‰‹åŠ¿å†²çª[20227:1064772] =========&gt; superView touchs Cancelled æƒ…æ™¯Bï¼šå•å‡» testViewï¼Œè¾“å‡ºç»“æœï¼š 1232023-03-08 17:43:16.370199+0800 æ‰‹åŠ¿å†²çª[20326:1077469] =========&gt; testView touchs Began2023-03-08 17:43:16.430723+0800 æ‰‹åŠ¿å†²çª[20326:1077469] =========&gt; single Tapped2023-03-08 17:43:16.430939+0800 æ‰‹åŠ¿å†²çª[20326:1077469] =========&gt; testView touchs Cancelled æƒ…æ™¯Cï¼šå•å‡» testBtnï¼Œè¾“å‡ºç»“æœï¼š 12023-03-08 17:43:40.690096+0800 æ‰‹åŠ¿å†²çª[20326:1077469] =========&gt; click btn æƒ…æ™¯Dï¼šæŒ‰ä½ testViewï¼Œè¿‡3ç§’åæˆ–æ›´ä¹…é‡Šæ”¾ï¼Œè¾“å‡ºç»“æœï¼š 122023-03-08 17:43:50.678603+0800 æ‰‹åŠ¿å†²çª[20326:1077469] =========&gt; testView touchs Began2023-03-08 17:43:53.499119+0800 æ‰‹åŠ¿å†²çª[20326:1077469] =========&gt; testView touchs Ended æƒ…æ™¯ Oã€Aã€B åˆ†æå¼€å‘æ–‡æ¡£å¯çŸ¥ï¼š Gesture Recognizers Get the First Opportunity to Recognize a Touch. A window delays the delivery of touch objects to the view so that the gesture recognizer can analyze the touch first. During the delay, if the gesture recognizer recognizes a touch gesture, then the window never delivers the touch object to the view, and also cancels any touch objects it previously sent to the view that were part of that recognized sequence. Googleç¿»è¯‘ï¼š æ‰‹åŠ¿è¯†åˆ«å™¨è·å¾—è¯†åˆ«è§¦æ‘¸çš„ç¬¬ä¸€ä¸ªæœºä¼šã€‚ ä¸€ä¸ªçª—å£å»¶è¿Ÿå°†è§¦æ‘¸å¯¹è±¡ä¼ é€’åˆ°è§†å›¾ï¼Œä½¿å¾—æ‰‹åŠ¿è¯†åˆ«å™¨å¯ä»¥é¦–å…ˆåˆ†æè§¦æ‘¸ã€‚ åœ¨å»¶è¿ŸæœŸé—´ï¼Œå¦‚æœæ‰‹åŠ¿è¯†åˆ«å™¨è¯†åˆ«å‡ºè§¦æ‘¸æ‰‹åŠ¿ï¼Œåˆ™çª—å£ä¸ä¼šå°†è§¦æ‘¸å¯¹è±¡ä¼ é€’åˆ°è§†å›¾ï¼Œå¹¶ä¸”è¿˜å°†å…ˆå‰å‘é€åˆ°ä½œä¸ºè¯†åˆ«çš„åºåˆ—çš„ä¸€éƒ¨åˆ†çš„è§†å›¾çš„ä»»ä½•è§¦æ‘¸å¯¹è±¡å–æ¶ˆã€‚ è§¦æ‘¸äº‹ä»¶é¦–å…ˆä¼ é€’åˆ°æ‰‹åŠ¿ä¸Šï¼Œå¦‚æœæ‰‹åŠ¿è¯†åˆ«æˆåŠŸäº†ï¼Œå°±ä¼šå–æ¶ˆäº‹ä»¶çš„ç»§ç»­ä¼ é€’ï¼Œå¦åˆ™ï¼Œäº‹ä»¶è¿˜æ˜¯ä¼šè¢«å“åº”é“¾å¤„ç†ã€‚ç³»ç»Ÿç»´æŒäº†ä¸å“åº”é“¾å…³è”çš„æ‰€æœ‰æ‰‹åŠ¿ï¼Œäº‹ä»¶é¦–å…ˆä¼ é€’ç»™æ‰‹åŠ¿ï¼Œç„¶åæ‰ä¼ é€’ç»™å“åº”é“¾ã€‚è¿™æ ·æˆ‘ä»¬å°±è§£é‡ŠAå’ŒBçš„åœºæ™¯äº† æƒ…æ™¯ C åˆ†æï¼šiOS å¼€å‘æ–‡æ¡£é‡Œè¿™æ ·è¯´ï¼š In iOS 6.0 and later, default control actions prevent overlapping gesture recognizer behavior. For example, the default action for a button is a single tap. If you have a single tap gesture recognizer attached to a buttonâ€™s parent view, and the user taps the button, then the buttonâ€™s action method receives the touch event instead of the gesture recognizer. This applies only to gesture recognition that overlaps the default action for a control, which includes: A single finger single tap on a UIButton, UISwitch, UISegmentedControl, UIStepper,and UIPageControl.A single finger swipe on the knob of a UISlider, in a direction parallel to the slider.A single finger pan gesture on the knob of a UISwitch, in a direction parallel to the switch. Google ç¿»è¯‘ä¸ºï¼š åœ¨iOS 6.0åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤æ§åˆ¶æ“ä½œå¯é˜²æ­¢é‡å çš„æ‰‹åŠ¿è¯†åˆ«å™¨è¡Œä¸ºã€‚ ä¾‹å¦‚ï¼ŒæŒ‰é’®çš„é»˜è®¤æ“ä½œæ˜¯å•å‡»ã€‚ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå•å‡»æ‰‹åŠ¿è¯†åˆ«å™¨é™„åŠ åˆ°æŒ‰é’®çš„çˆ¶è§†å›¾ï¼Œå¹¶ä¸”ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œåˆ™æŒ‰é’®çš„åŠ¨ä½œæ–¹æ³•æ¥æ”¶è§¦æ‘¸äº‹ä»¶è€Œä¸æ˜¯æ‰‹åŠ¿è¯†åˆ«å™¨ã€‚ è¿™ä»…é€‚ç”¨äºä¸æ§ä»¶çš„é»˜è®¤æ“ä½œé‡å çš„æ‰‹åŠ¿è¯†åˆ«ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š å•ä¸ªæ‰‹æŒ‡å•å‡»UIButtonï¼ŒUISwitchï¼ŒUISegmentedControlï¼ŒUIStepperå’ŒUIPageControl.å•ä¸ªæ‰‹æŒ‡åœ¨UISliderçš„æ—‹é’®ä¸Šæ»‘åŠ¨ï¼Œåœ¨å¹³è¡Œäºæ»‘å—çš„æ–¹å‘ä¸Šã€‚åœ¨UISwitchçš„æ—‹é’®ä¸Šçš„å•ä¸ªæ‰‹æŒ‡å¹³ç§»æ‰‹åŠ¿ ä¸å¼€å…³å¹³è¡Œçš„æ–¹å‘ã€‚ å› æ­¤ï¼Œåœ¨æƒ…æ™¯Cï¼Œç‚¹å‡»testBtnçš„actionï¼ŒæŒ‰é’®è·å–äº†äº‹ä»¶å“åº”ï¼Œä¸ä¼šæŠŠäº‹ä»¶å“åº”ä¼ é€’ç»™çˆ¶è§†å›¾çš„supView æƒ…æ™¯ C åˆ†æï¼š é•¿æŒ‰testViewå·²ç»ä¸æ˜¯å•å‡»äº‹ä»¶äº†ï¼Œtapæ‰‹åŠ¿å°±ä¸ä¼šè¯†åˆ« å®é™…å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜ çˆ¶è§†å›¾ä¸Šå…ˆåæ·»åŠ äº†ä¸€ä¸ª UIGestureRecognizer å’Œä¸€ä¸ª UITableView æˆ‘ä»¬å‘ç°åœ¨ç‚¹å‡» UITableView çš„ cell çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è§¦å‘ -(void)tableView:(UITableView*)tableView didSelectRowAtIndexPath:(NSIndexPath*)indexPath; æ–¹æ³•ã€‚ åˆ†æç”±äº cell ç»§æ‰¿ cell -&gt; UIView -&gt; UIResponderï¼Œæ˜¯å¯ä»¥æ¥æ”¶å’Œå¤„ç†äº‹ä»¶çš„ï¼Œä½†æ˜¯æ·»åŠ äº† tap åä¼šå¯¼è‡´ cell å“åº”é“¾æ— æ³•æ­£å¸¸å“åº”ï¼Œå¯¼è‡´ æ‰‹åŠ¿å†²çª è§£å†³æ–¹æ³•åœ¨æˆ‘ä»¬ç‚¹å‡» cell çš„æ—¶å€™ï¼Œä¸è®©çˆ¶è§†å›¾çš„ æ‰‹åŠ¿ å¹²æ‰°å­è§†å›¾cellçš„ç‚¹å‡»äº‹ä»¶æˆ–è€…è¯´å“åº”é“¾æ­£å¸¸ä¼ é€’ï¼Œä¸€èˆ¬ä¼šé‡å†™ UIGestureRecognizerDelegate ä¸­çš„ - (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touchæ–¹æ³•ã€‚ 12345678910111213- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch&#123; // å¦‚æœæ˜¯UITableViewCellç±»æˆ–å­ç±»å“åº”äº‹ä»¶ if ([touch.view isKindOfClass:[UITableViewCell class]]) &#123; return YES; &#125; //é»˜è®¤éƒ½éœ€è¦å“åº” return NO;&#125;=========2023-03-08 18:19:39.851593+0800 æ‰‹åŠ¿å†²çª[20552:1111844] -[ParentV tableView:didSelectRowAtIndexPath:]2023-03-08 18:19:40.583123+0800 æ‰‹åŠ¿å†²çª[20552:1111844] -[ParentV tableView:didSelectRowAtIndexPath:]...","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 06ï¼šæˆªå–è§†é¢‘æ–‡ä»¶ç¬¬ä¸€å¸§çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ","slug":"OCå­¦ä¹ /OCå­¦ä¹ 06ï¼šæˆªå–è§†é¢‘æ–‡ä»¶ç¬¬ä¸€å¸§çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ","date":"2023-03-07T11:16:39.000Z","updated":"2023-03-08T18:53:13.543Z","comments":true,"path":"2023/03/07/OCå­¦ä¹ /OCå­¦ä¹ 06ï¼šæˆªå–è§†é¢‘æ–‡ä»¶ç¬¬ä¸€å¸§çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/07/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A006%EF%BC%9A%E6%88%AA%E5%8F%96%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E7%AC%AC%E4%B8%80%E5%B8%A7%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/","excerpt":"","text":"å‰è¨€iOS ä¸­è·å–è§†é¢‘ç¬¬ä¸€å¸§æœ‰ä¸¤ç§æ–¹å¼ ç¬¬ä¸€ç§ï¼šä½¿ç”¨AVFoundationè·å–å°†è€—æ—¶çš„æ“ä½œæ”¾åœ¨å¼‚æ­¥æ‰§è¡Œé˜Ÿåˆ— dispatch_asyncï¼Œé˜²æ­¢é€ æˆçº¿ç¨‹å µå¡ï¼Œåˆ·æ–°UIæ”¾åœ¨ ä¸»çº¿ç¨‹ 123456789101112- (UIImage *)getFirstFrameFromVideoWithUrl:(NSURL *)url&#123; AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:url options:nil]; AVAssetImageGenerator *assetGennerator = [[AVAssetImageGenerator alloc] initWithAsset:asset]; assetGennerator.appliesPreferredTrackTransform = YES; CMTime time = CMTimeMakeWithSeconds(0.0, 600); CMTime actualTime; NSError *error = nil; CGImageRef image = [assetGennerator copyCGImageAtTime:time actualTime:&amp;actualTime error:&amp;error]; UIImage *videoImg = [[UIImage alloc] initWithCGImage:image]; CGImageRelease(image); return videoImg;&#125; ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨SDWebImageè·å–ï¼Œå¹¶ç¼“å­˜å›¾ç‰‡123456789101112131415161718192021222324252627282930313233343536373839404142- (void)method2&#123; NSURL *url = [NSURL URLWithString:@&quot;https://klxxcdn.oss-cn-hangzhou.aliyuncs.com/histudy/hrm/media/bg1.mp4&quot;]; NSString *urlKey = url.absoluteString; // å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å›¾ç‰‡ SDImageCache *imgCache = [SDImageCache sharedImageCache]; UIImage *memoryImg = [imgCache imageFromCacheForKey:urlKey]; if (memoryImg) &#123; self.imgV.image = memoryImg; &#125;else &#123; // ä»ç£ç›˜ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰å›¾ç‰‡ UIImage *diskImg = [imgCache imageFromDiskCacheForKey:urlKey]; if (diskImg) &#123; self.imgV.image = diskImg; &#125;else &#123; // å¦‚æœéƒ½ä¸å­˜åœ¨ // å¼€å¯å¼‚æ­¥çº¿ç¨‹ä¸‹è½½å›¾ç‰‡ dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123; AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:url options:nil]; NSParameterAssert(asset); AVAssetImageGenerator *assetGenerator = [[AVAssetImageGenerator alloc] initWithAsset:asset]; assetGenerator.appliesPreferredTrackTransform = YES; assetGenerator.apertureMode = AVAssetImageGeneratorApertureModeEncodedPixels; CGImageRef thumbImgRef = NULL; CFTimeInterval thumbImgTime = 1; NSError *thumbImgError = nil; thumbImgRef = [assetGenerator copyCGImageAtTime:CMTimeMake(thumbImgTime, 60) actualTime:NULL error:&amp;thumbImgError]; if (!thumbImgRef)&#123; NSLog(@&quot;thumbImgError:%@&quot;,thumbImgError); &#125; UIImage *thumbImg = thumbImgRef ? [[UIImage alloc] initWithCGImage:thumbImgRef] : nil; // ä¸»çº¿ç¨‹æ˜¾ç¤ºUI dispatch_async(dispatch_get_main_queue(), ^&#123; SDImageCache *imgCache = [SDImageCache sharedImageCache]; [imgCache storeImage:thumbImg forKey:urlKey completion:^&#123; NSLog(@&quot;store Image success&quot;); &#125;]; self.imgV.image = thumbImg; &#125;); &#125;); &#125; &#125; &#125;","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 05ï¼šåˆ†ç±»å’Œæ‰©å±•","slug":"OCå­¦ä¹ /OCå­¦ä¹ 05ï¼šåˆ†ç±»å’Œæ‰©å±•","date":"2023-03-06T13:50:50.000Z","updated":"2023-03-08T19:02:49.668Z","comments":true,"path":"2023/03/06/OCå­¦ä¹ /OCå­¦ä¹ 05ï¼šåˆ†ç±»å’Œæ‰©å±•/","link":"","permalink":"https://www.bboyzj.cn/2023/03/06/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A005%EF%BC%9A%E5%88%86%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95/","excerpt":"","text":"åˆ†ç±» Category Category çš„ä¸»è¦ä½œç”¨æ˜¯ä¸º å·²ç»å­˜åœ¨çš„ç±»æ·»åŠ (æ‰©å±•)æ–¹æ³• å·²å­˜åœ¨çš„ç±»å¯ä»¥æ˜¯ ç³»ç»Ÿçš„ç±» æˆ– è‡ªå®šä¹‰çš„ç±» ä¸èƒ½å®šä¹‰ å˜é‡ï¼ˆæˆå‘˜å˜é‡æˆ–å®ä¾‹å˜é‡ï¼‰ ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å®šä¹‰ å±æ€§ï¼Œä½†æ˜¯ ä¸ä¼šå®ç° å®ƒçš„ set å’Œ get æ–¹æ³•ï¼Œéœ€è¦åˆ©ç”¨ runtime æœºåˆ¶å»å®ç°å®ƒçš„ set å’Œ get æ–¹æ³•ã€‚ åˆ†ç±»æ–‡ä»¶æœ‰ .h å’Œ .m ä¸¤ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å @interface ç±»å (åˆ†ç±»å) åˆ›å»º ç³»ç»Ÿ åˆ†ç±» command + n ç‚¹å‡» Objective-C File åˆ›å»ºå®Œæˆåä¼šç”Ÿæˆ ç³»ç»Ÿæ–‡ä»¶å+Category.h å’Œ ç³»ç»Ÿæ–‡ä»¶å+Category.m ä¸¤ä¸ªæ–‡ä»¶ åœ¨åˆ†ç±»ä¸­å¯ä»¥æ·»åŠ  å®ä¾‹æ–¹æ³•å’Œç±»æ–¹æ³• 123456789101112131415@interface UIViewController (Cate)- (void)sayHello;+ (void)sayBye;@end==============@implementation UIViewController (Cate)- (void)sayHello&#123; NSLog(@&quot;hello&quot;);&#125;+ (void)sayBye&#123; NSLog(@&quot;bye&quot;);&#125;@end åœ¨æœ¬ç±»ä¸­è°ƒç”¨ï¼Œéœ€è¦å¼•å…¥å¤´æ–‡ä»¶ æ–‡ä»¶å+Category.h 12345678 // åˆ†ç±»[self sayHello];[ViewController sayBye];======Category[30386:1690552] bye2023-03-06 22:06:37.369596+0800 Category[30386:1690552] hello2023-03-06 22:06:37.369794+0800 Category[30386:1690552] bye è‡ªå®šä¹‰çš„ç±» æ·»åŠ  åˆ†ç±» åˆ›å»ºæ–¹å¼ç±»ä¼¼ ä¸ç³»ç»Ÿç±»ç±»ä¼¼ï¼Œåœ¨ class ä¸­é€‰æ‹©è‡ªå®šä¹‰çš„ç±» Person å¯ä»¥åœ¨ åˆ†ç±»ä¸­å£°æ˜å¹¶å®ç° ä¸¤ä¸ªæ–¹æ³•ï¼Œåœ¨æœ¬ç±»ä¸­è°ƒç”¨ åˆ†ç±»ä¸­å£°æ˜å¹¶å®ç° 123456789101112131415@interface Person (Category)- (void)sayHello;+ (void)sayBye;@end---------@implementation Person (Category)- (void)sayHello&#123; NSLog(@&quot;%s&quot;,__func__);&#125;+ (void)sayBye&#123; NSLog(@&quot;%s&quot;,__func__);&#125;@end æœ¬ç±»ä¸­è°ƒç”¨ï¼Œç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœ 123456789101112131415@implementation Person- (instancetype)init&#123; self = [super init]; if (self) &#123; // æœ¬ç±»ä¸­è°ƒç”¨åˆ†ç±»æ·»åŠ çš„æ–¹æ³• [self sayHello]; [Person sayBye]; &#125; return self;&#125;@end============2023-03-07 08:14:34.439456+0800 Category[3555:114948] -[Person(Category) sayHello]2023-03-07 08:14:34.439626+0800 Category[3555:114948] +[Person(Category) sayBye] é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶æœ¬ç±»ä¸­å¯ä»¥è°ƒç”¨ï¼Œé‚£ä¹ˆåœ¨å…¶ä»–ç±»ä¸­æ˜¯å¦ä¹Ÿå¯ä»¥è°ƒç”¨å‘¢ï¼Ÿ å…¶ä»–ç±»ä¸­è°ƒç”¨ åˆ†ç±» æ–¹æ³•1234567891011121314// è‡ªå®šä¹‰çš„ç±»#import &quot;Person.h&quot;#import &quot;Person+Category.h&quot;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; // è‡ªå®šä¹‰çš„ç±» Person * p = [[Person alloc] init]; [p sayHello]; [Person sayBye];&#125;========2023-03-07 08:19:57.913133+0800 Category[3631:119871] -[Person(Category) sayHello]2023-03-07 08:19:57.913667+0800 Category[3631:119871] +[Person(Category) sayBye] ç”±æ‰“å°ç»“æœå¯çŸ¥ï¼Œåœ¨VCä¸­æ—¶å¯ä»¥è°ƒç”¨çš„ é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œå¦‚æœæœ¬ç±»ä¸­å’Œåˆ†ç±»ä¸­å‡å®ç°äº† åŒæ ·çš„æ–¹æ³• ä¼šè°ƒç”¨å“ªä¸ªï¼Ÿ åˆ†ç±»å’Œæœ¬ç±»å®ç°äº†åŒæ ·çš„æ–¹æ³• åœ¨ Person ç±»ä¸­å®ç°ä¸€ä¸ª sayHello 123- (void)sayHello&#123; NSLog(@&quot;%s&quot;,__func__);&#125; åœ¨ VC ä¸­è°ƒç”¨ sayHello 123456// è‡ªå®šä¹‰çš„ç±»Person * p = [[Person alloc] init];[p sayHello];============2023-03-07 08:24:09.821814+0800 Category[3670:122944] -[Person(Category) sayHello] ç”±æ‰“å°ç»“æœå¯çŸ¥ï¼Œè°ƒç”¨çš„æ˜¯ åˆ†ç±» çš„æ–¹æ³•ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¨æ–­ï¼Œæœ¬ç±»çš„æ–¹æ³•è¢«åˆ†ç±»æ›¿ä»£äº† æ‰©å±• Extension æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ç¼–è¯‘å™¨å’Œå¤´æ–‡ä»¶é‡Œçš„@interfaceä¸€çº§å®ç°æ–‡ä»¶é‡Œçš„@implementä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ç±»ï¼Œå®ƒä¼´éšç€ç±»çš„äº§ç”Ÿè€Œäº§ç”Ÿï¼Œäº¦éšä¹‹ä¸€èµ·æ¶ˆäº¡ ä½œç”¨ å£°æ˜ ç§æœ‰å±æ€§ã€ç§æœ‰æ–¹æ³•ã€ç§æœ‰æˆå‘˜å˜é‡ï¼Œæƒ³è¦è¢«è®¿é—® @public æ‰©å±•ä¸èƒ½ä¸ºç³»ç»Ÿç±»æ·»åŠ æ‰©å±•ï¼ˆå¿…é¡»æœ‰ä¸€ä¸ªç±»çš„æºç æ‰èƒ½æ·»åŠ ä¸€ä¸ªç±»çš„Extensionï¼‰ï¼Œæ‰€ä»¥ä½ æ— æ³•ä¸ºç³»ç»Ÿçš„ç±»æ·»åŠ Extension æˆå‘˜å˜é‡å’Œå®ä¾‹å˜é‡æ˜¯ ç§æœ‰çš„ï¼Œä¸èƒ½è¢«å¤–ç•Œè®¿é—®ï¼Œ å±æ€§å¯ä»¥è¢«å¤–ç•Œè®¿é—®ï¼Œç”±äºæ²¡æœ‰å®ç°è°ƒç”¨ä¼š carsh æ–¹æ³•å¯ä»¥è¢«å¤–ç•Œè®¿é—®ï¼Œç”±äºæ²¡æœ‰å®ç°setå’Œgetæ–¹æ³•ï¼Œè®¿é—®ä¼š carsh æ‰©å±•åªæœ‰ä¸€ä¸ª .h æ–‡ä»¶ï¼Œå› æ­¤ æ‰€æœ‰çš„éƒ½æ˜¯æ²¡åŠæ³•è°ƒç”¨ ä½¿ç”¨ åˆ›å»º Extension è‡ªå®šä¹‰ç±»ä¸­çš„ä»£ç  12345678910111213@interface Person : NSObject@end========#import &quot;Person.h&quot;#import &quot;Person+Extension.h&quot;@implementation Person- (void)sayHello&#123; NSLog(@&quot;%s hello&quot;,__func__);&#125;@end åœ¨ #import &quot;Person+Ext.h&quot; ä¸­å®ç°å¦‚ä¸‹ä»£ç  123456789@interface UIViewController ()&#123; NSString * name; @public int age;&#125;@property (nonatomic,copy)NSString * sex;- (void)sayHello;+ (void)sayBye;@end åœ¨ VC ä¸­è°ƒç”¨ 12345678910111213141516- (void)viewDidLoad &#123; [super viewDidLoad]; Person * p = [Person new]; // è°ƒç”¨æŠ¥é”™æˆ–å´©æºƒ// p-&gt;age = 30;// p-&gt;name = &quot;ZJ&quot;;// p.sex = @&quot;ç”·&quot;;// [Person sayBye]; [p sayHello];&#125;=======2023-03-06 22:35:02.277867+0800 Extension[30580:1704777] -[Person sayHello] hello å¦‚æœåªæœ‰å£°æ˜æ²¡æœ‰å®ç°ï¼Œåˆ™è°ƒç”¨ä¼š Crash åˆ†ç±» å’Œ æ‰©å±•çš„åŒºåˆ« category åœ¨è¿è¡Œæ—¶å†³è®®ã€‚extension åœ¨ç¼–è¯‘æ—¶å†³è®®ã€‚æ‰€ä»¥æ‰©å±•ä¸­çš„æ–¹æ³•æ²¡æœ‰è¢«å®ç°ç¼–è¯‘å™¨ä¼šæŠ¥è­¦å‘Šï¼Œåˆ†ç±»ä¸­æ²¡æœ‰è¢«å®ç°ç¼–è¯‘å™¨ä¸ä¼šè­¦å‘Š åˆ†ç±»åŸåˆ™ä¸Šåªèƒ½æ·»åŠ æ–¹æ³•ï¼Œä¸èƒ½æ·»åŠ å±æ€§ï¼ˆå› ä¸ºæ²¡æœ‰å®ç°å±æ€§çš„seterå’Œgetteræ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡runtimeæ·»åŠ ï¼‰ã€‚æ‰©å±•èƒ½æ·»åŠ æ–¹æ³•ã€å®ä¾‹å˜é‡ï¼Œé»˜è®¤æ˜¯@privateç±»å‹çš„ï¼Œä¸”åªèƒ½ä½œç”¨äºè‡ªèº«ç±» åˆ†ç±»æœ‰è‡ªå·±çš„å®ç°éƒ¨åˆ†ã€‚æ‰©å±•æ²¡æœ‰å®ç°éƒ¨åˆ†ï¼Œåªèƒ½ä¾æ‰˜å¯¹åº”çš„ç±»çš„å®ç°éƒ¨åˆ†ã€‚ åˆ†ç±»å¯ä»¥ä¸ºç³»ç»Ÿæ·»åŠ åˆ†ç±»ã€‚æ‰©å±•ä¸èƒ½ä¸ºç³»ç»Ÿæ·»åŠ åˆ†ç±»ã€‚","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 04ï¼šJSONå’ŒXMLæ•°æ®è§£æ","slug":"OCå­¦ä¹ /OCå­¦ä¹ 04ï¼šJSONå’ŒXMLæ•°æ®è§£æ","date":"2023-03-06T06:09:53.000Z","updated":"2023-03-07T12:01:51.659Z","comments":true,"path":"2023/03/06/OCå­¦ä¹ /OCå­¦ä¹ 04ï¼šJSONå’ŒXMLæ•°æ®è§£æ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/06/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A004%EF%BC%9AJSON%E5%92%8CXML%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90/","excerpt":"","text":"å‰è¨€ åœ¨ iOS å¼€å‘ä¸­ï¼Œå¸¸è§çš„æ•°æ®ä¼ è¾“æ ¼å¼æœ‰ä¸¤ç§ï¼šJSONå’ŒXMLã€‚ æœåŠ¡å™¨è¿”å›å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½æ˜¯ JSONæ ¼å¼æˆ–XMLæ ¼å¼ï¼ˆæ–‡ä»¶ä¸‹è½½é™¤å¤–ï¼‰ JSON ç”±äº ä½“ç§¯å°ã€ä¼ è¾“å¿«é€Ÿ ç­‰ä¼˜ç‚¹ï¼Œé€æ¸æˆä¸ºäº† ä¸»æµçš„æ•°æ®ä¼ è¾“æ ¼å¼ã€‚ JSONåœ¨ iOS ä¸­ï¼Œå¸¸è§è§£ææ–¹æ¡ˆæœ‰ä»¥ä¸‹å‡ ç§ï¼š ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼šJSONKitã€SBJsonã€TouchJSONï¼ˆæ€§èƒ½ä»å·¦åˆ°å³ï¼Œè¶Šæ¥è¶Šå·®ï¼‰ æ€§èƒ½æœ€å¥½çš„æ˜¯ä½¿ç”¨ è‹¹æœåŸç”Ÿçš„æ¡†æ¶ï¼š NSJSONSerialization JSONæ ¼å¼å¾ˆåƒOCä¸­çš„æ•°ç»„å’Œå­—å…¸ï¼Œkeyå¿…é¡»ç”¨åŒå¼•å· 1&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;age&quot;:22&#125;ã€[&#123;&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;age&quot;:22&#125;,&#123;&quot;name&quot;:&quot;æå››&quot;,&quot;age&quot;:22&#125;] JSONæ ¼å¼ JSON è½¬ OC ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¦è§£æçš„JSONæ•°æ®ï¼Œæ˜¯NSDataç±»å‹ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶æ•°æ® ç¬¬äºŒä¸ªå‚æ•°ï¼šè§£æJSONçš„å¯é€‰é…ç½®å‚æ•° NSJSONReadingMutableContainers è§£æå‡ºæ¥çš„å­—å…¸å’Œæ•°ç»„æ˜¯å¯å˜çš„ NSJSONReadingFragmentsAllowed è§£æå‡ºæ¥çš„å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²æ˜¯å¯å˜çš„ NSJSONReadingMutableLeaves è¢«è§£æçš„æ•°æ®å¦‚æœæ—¢ä¸æ˜¯å­—å…¸ä¹Ÿä¸æ˜¯æ•°ç»„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ª ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé”™è¯¯ä¿¡æ¯ 1NSDictionary * dict = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableContainers error:&amp;error]; OC è½¬ JSON ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¦è½¬æ¢æˆJSONæ•°æ®çš„OCå¯¹è±¡ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªå­—å…¸ ç¬¬äºŒä¸ªå‚æ•°ï¼šNSJSONWritingPrettyPrinted å¯¹è½¬æ¢ä¹‹åçš„JSONå¯¹è±¡è¿›è¡Œæ’ç‰ˆï¼Œæ— æ„ä¹‰ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé”™è¯¯ä¿¡æ¯ 1NSData *data = [NSJSONSerialization dataWithJSONObject:dic options:NSJSONWritingPrettyPrinted error:&amp;error]; XML XML å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œæ˜¯ä¸€ç§æ•°æ®äº¤äº’æ ¼å¼ï¼Œä¹Ÿå«XMLæ–‡æ¡£ XML è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ® æ„æˆå¸¸è§çš„XMLæ–‡æ¡£ç”±ä¸‰éƒ¨åˆ†ç»„æˆ æ–‡æ¡£å£°æ˜ åœ¨XMLæ–‡æ¡£æœ€å‰é¢ï¼Œå¿…é¡»ç¼–å†™ä¸€ä¸ªæ–‡æ¡£å£°æ˜ï¼Œç”¨æ¥å£°æ˜XMLæ–‡æ¡£çš„ç±»å‹ 12345// æœ€ç®€å•çš„å£°æ˜&lt;?xml version=&quot;1.0&quot; ?&gt;// ç”¨encodingå±æ€§è¯´æ˜æ–‡æ¡£çš„å­—ç¬¦ç¼–ç &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; å…ƒç´  ä¸€ä¸ªå…ƒç´ åŒ…æ‹¬äº† å¼€å§‹æ ‡ç­¾å’Œç»“æŸæ ‡ç­¾ï¼Œ æœ‰å†…å®¹çš„å…ƒç´  &lt;name&gt;Tom&lt;/name&gt;ï¼›æ²¡å†…å®¹çš„å…ƒç´  &lt;from&gt;&lt;/from&gt;ï¼Œå¯ç®€å†™æˆ &lt;from/&gt; å…ƒç´ å¯åµŒå¥—å…¶ä»–å…ƒç´ ï¼Œä¸å¯å‡ºç°äº¤å‰åµŒå¥— å±æ€§ ä¸€ä¸ªå…ƒç´ æœ€å¤šå¯ä»¥æ‹¥æœ‰å¤šä¸ªå±æ€§ï¼Œå±æ€§å€¼å¿…é¡»ç”¨åŒå¼•å· &quot; &quot; æˆ– å•å¼•å· &#39; &#39; æ‹¬ä½ ç¤ºä¾‹ 123456&lt;root&gt; &lt;person id=&quot;p1&quot;&gt; &lt;name&gt;Tom&lt;/name&gt; &lt;age&gt;24&lt;/age&gt; &lt;/person&gt;&lt;/root&gt; XML è§£æçš„æ–¹æ³•è¦æƒ³ä»XMLä¸­æå–ä¿¡æ¯ï¼Œå°±å¾—è§£æXMLï¼Œç›®å‰é’ˆå¯¹XMLçš„è§£ææœ‰ä¸¤ç§æ–¹å¼ï¼š SAXï¼šä»æ ¹å…ƒç´ å¼€å§‹ï¼ŒæŒ‰ç…§é¡ºåºä¸€ä¸ªå…ƒç´ ä¸€ä¸ªå…ƒç´ çš„å¾€ä¸‹è§£æï¼Œå¯ç”¨äºè§£æå¤§ã€å°æ–‡ä»¶ DOMï¼šä¸€æ¬¡æ€§å°†æ•´ä¸ªXMLæ–‡æ¡£åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œé€‚åˆè¾ƒå°çš„æ–‡ä»¶ iOS ä¸­è§£æ XML æœ‰ä¸¤ç§ï¼š è‹¹æœåŸç”Ÿï¼šä½¿ç”¨ NSXMLParseï¼ŒSAXæ–¹å¼è§£æï¼Œä½¿ç”¨ç®€ç­” ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼šlibxml2ã€GDataXML libxml2 çº¯ c è¯­éŸ³ï¼Œé»˜è®¤åŒ…å«åœ¨iOS SDKä¸­ï¼ŒåŒæ—¶æ”¯æŒDOMå’ŒSAXæ–¹å¼è§£æ GDataXMLDOM è§£æï¼Œç”± google åŸºäº libxml2 å¼€å‘ è§£æXMLå¤§æ–‡ä»¶å»ºè®®ç”¨ï¼šNSXMLParseã€libxml2è§£æXMLå°æ–‡ä»¶ä¸Šè¿°ä¸‰ç§éƒ½å¯ä»¥ NSXMLParse ä½¿ç”¨ æ·»åŠ NSXMLParserDelegateåè®® è·å–XMLæ–‡ä»¶ï¼Œåˆå§‹åŒ–NSXMLParserï¼Œå¹¶å¼€å¯è§£æ å®ç°åè®®ä¸­çš„æ–¹æ³• XMLElement æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374@interface XMLElement : NSObject// å…ƒç´ åç§°@property (nonatomic,strong)NSString *name;//å…ƒç´ èŠ‚ç‚¹æ–‡æœ¬@property (nonatomic,strong)NSMutableString *text;@property (nonatomic,strong)NSDictionary *attribute;@property (nonatomic,strong)XMLElement *parent;@property (nonatomic,strong)NSMutableArray&lt;XMLElement *&gt; *childElement;@endğŸ”½#import &quot;XMLElement.h&quot;@implementation XMLElement- (instancetype)init&#123; self = [super init]; if (self) &#123; _text=[[NSMutableString alloc]init]; &#125; return self;&#125;- (NSMutableArray&lt;XMLElement *&gt; *)childElement&#123; if (!_childElement) &#123; _childElement = [[NSMutableArray alloc]init]; &#125; return _childElement;&#125;- (NSString *)description&#123; NSDictionary *dic = [self convertToDic]; if ([NSJSONSerialization isValidJSONObject:dic]) &#123; NSError *error; NSData *jsonData=[NSJSONSerialization dataWithJSONObject:dic options:NSJSONWritingPrettyPrinted error:&amp;error]; if (error) &#123; return @&quot;&#123;&#125;&quot;; &#125; if (jsonData) &#123; @try &#123; NSString *jsonStr = [[NSString alloc]initWithData:jsonData encoding:NSUTF8StringEncoding]; return jsonStr; &#125; @catch (NSException *exception) &#123; &#125; &#125; &#125; return @&quot;&#123;&#125;&quot;; &#125;- (NSDictionary *)convertToDic&#123; NSMutableDictionary *dic = [[NSMutableDictionary alloc] init]; if (self.name) &#123; dic[self.name]=self.text; &#125; if (self.attribute &amp;&amp; self.attribute.count &gt; 0) &#123; [dic addEntriesFromDictionary:self.attribute]; &#125; if (self.childElement &amp;&amp; self.childElement.count &gt; 0) &#123; NSMutableArray *child=[[NSMutableArray alloc]init]; for (XMLElement *element in self.childElement) &#123; NSDictionary *childDic = [element convertToDic]; if (element.childElement &amp;&amp; element.childElement.count &gt; 0) &#123; [child addObject:childDic]; &#125;else&#123; [dic addEntriesFromDictionary:childDic]; &#125; &#125; if (child.count &gt; 0) &#123; dic[@&quot;child&quot;]=child; &#125; &#125; return dic;&#125;@end XMLParserManager æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112#import &lt;Foundation/Foundation.h&gt;#import &quot;XMLElement.h&quot;NS_ASSUME_NONNULL_BEGINtypedef void(^ParserXMLCompletion) (BOOL success, XMLElement * _Nullable data,NSError * _Nullable error);@interface XMLParserManager : NSObject@property(nonatomic,copy)ParserXMLCompletion completion;- (void)parserXMLWithUrl:(NSURL *)url completion:(ParserXMLCompletion)completion;@endğŸ”½#import &quot;XMLParserManager.h&quot;@interface XMLParserManager()&lt;NSXMLParserDelegate&gt;@property (nonatomic,strong)NSXMLParser *parser;@property (nonatomic,strong)XMLElement *rootElement;@property (nonatomic,strong)XMLElement *currentElement;@end@implementation XMLParserManager- (void)parserXMLWithUrl:(NSURL *)url completion:(ParserXMLCompletion)completion&#123; if (url) &#123; self.completion = completion; __weak typeof(self) weakSelf = self; NSInputStream *fileInput=[[NSInputStream alloc] initWithURL:url]; // åˆ›å»ºä¸€ä¸ªè§£æå™¨ _parser = [[NSXMLParser alloc] initWithStream:fileInput]; // è®¾ç½®ä»£ç† _parser.delegate = self; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT,0), ^&#123; __strong typeof(weakSelf) strongSelf = weakSelf; // å¼€å§‹è§£æ [strongSelf.parser parse]; // è§£æé”™è¯¯ if (weakSelf.parser.parserError) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; if (completion) &#123; completion(NO,nil,strongSelf.parser.parserError); &#125; &#125;); &#125; &#125;); &#125;&#125;// æ–‡æ¡£å¼€å§‹-(void)parserDidStartDocument:(NSXMLParser *)parser&#123; self.rootElement = nil; self.currentElement = nil;&#125;/* å¼€å§‹è§£ææŸä¸ªèŠ‚ç‚¹ parser xmlå¯¹è±¡ elementName æ ‡ç­¾ namespaceURI å‘½åæ§ä»¶æŒ‡å‘çš„é“¾æ¥ qName å‘½åæ§ä»¶åç§° attributeDict èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§ */-(void)parser:(NSXMLParser *)parser didStartElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName attributes:(NSDictionary&lt;NSString *,NSString *&gt; *)attributeDict&#123; if (!self.rootElement) &#123; self.rootElement = [[XMLElement alloc]init]; self.currentElement = self.rootElement; &#125;else&#123; XMLElement *element = [[XMLElement alloc]init]; // çˆ¶èŠ‚ç‚¹ element.parent = self.currentElement; // å½“å‰å…ƒç´ çš„å­èŠ‚ç‚¹ [self.currentElement.childElement addObject:element]; element.name = elementName; // æ›´æ¢å½“å‰å…ƒç´  self.currentElement = element; &#125; // å…ƒç´ åå’Œå±æ€§ self.currentElement.name = elementName; self.currentElement.attribute = attributeDict;&#125;// å½“è§£æå™¨æ‰¾åˆ°å¼€å§‹æ ‡è®°å’Œç»“æŸæ ‡è®°ä¹‹é—´çš„å­—ç¬¦æ—¶ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•è§£æå½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­—ç¬¦- (void)parser:(NSXMLParser *)parser foundCharacters:(NSString *)string&#123; // è·å–å½“å‰å…ƒç´ çš„å†…å®¹ [self.currentElement.text appendString:string];&#125;// ç»“æŸè§£æ-(void)parser:(NSXMLParser *)parser didEndElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName&#123; self.currentElement = self.currentElement.parent;&#125;// æ–‡æ¡£ç»“æŸ-(void)parserDidEndDocument:(NSXMLParser *)parser&#123; __weak typeof(self) weakSelf = self; if (self &amp;&amp; self.completion) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; __strong typeof(weakSelf) strongSelf = weakSelf; strongSelf.completion(YES, strongSelf.rootElement, nil); &#125;); &#125;&#125;// è§£æå¤±è´¥- (void)parser:(NSXMLParser *)parser validationErrorOccurred:(NSError *)validationError&#123; if (self.completion) &#123; __weak typeof(self) weakSelf = self; dispatch_async(dispatch_get_main_queue(), ^&#123; __strong typeof(weakSelf) strongSelf = weakSelf; strongSelf.completion(NO, nil,validationError); &#125;); &#125;&#125;@end VC è°ƒç”¨ 1234567891011121314151617181920212223242526272829303132#import &quot;ViewController.h&quot;#import &quot;XMLParserManager.h&quot;@interface ViewController ()@property (nonatomic,strong)XMLParserManager *manager;@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; &#125;-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; [self parserXML];&#125;-(void)parserXML&#123; NSString *path = [[NSBundle mainBundle]pathForResource:@&quot;xmlText&quot; ofType:@&quot;xml&quot;]; NSURL *url = [NSURL fileURLWithPath:path]; _manager=[[XMLParserManager alloc]init]; [_manager parserXMLWithUrl:url completion:^(BOOL success, XMLElement * _Nullable data, NSError * _Nullable error) &#123; if (success) &#123; NSLog(@&quot;%@&quot;,data); &#125;else&#123; NSLog(@&quot;error = %@&quot;,error); &#125; &#125;]; NSLog(@&quot;start == &quot;); &#125;@end GDataXML ä½¿ç”¨ GDataXMLDocumentï¼šxmlè§£æå…¥å£ GdataXMLElementï¼šä¿å­˜æŸ¥æ‰¾çš„æ•°æ® GdataXMLNodeï¼šä¿å­˜è§£æçš„æ•°æ® ç¬¬ä¸€æ­¥ï¼šé›†æˆ GDataXML-HTML 123456789target &#x27;XMLæ–‡ä»¶è§£æ&#x27; do # Comment the next line if you don&#x27;t want to use dynamic frameworks use_frameworks! pod &#x27;GDataXML-HTML&#x27;, &#x27;~&gt; 1.4.1&#x27; # Pods for XMLæ–‡ä»¶è§£æend ç¬¬äºŒæ­¥ï¼šé¡¹ç›®ä¸­é…ç½® pod å®‰è£… GDataXML é€‰ä¸­target -&gt; Build Settings -&gt; Link Binary With Librariedï¼Œæœç´¢æ·»åŠ  libxml2 Header Search Paths æ·»åŠ  /usr/include/libxml2 Other Linker Flags æ·»åŠ  -lxml2 å¼•å…¥å¤´æ–‡ä»¶ä½¿ç”¨ 123456789101112131415161718- (void)GDataParserXML&#123; // åŠ è½½xmlwenæ–‡ä»¶ NSString *path = [[NSBundle mainBundle]pathForResource:@&quot;xmlText&quot; ofType:@&quot;xml&quot;]; NSURL *url = [NSURL fileURLWithPath:path]; NSData *data = [NSData dataWithContentsOfURL:url]; NSError *error= nil; GDataXMLDocument *doc = [[GDataXMLDocument alloc] initWithData:data error:&amp;error]; // æ‹¿åˆ°æ ¹å…ƒç´ ï¼Œå¾—åˆ°æ ¹å…ƒç´ ä¸‹æ‰€æœ‰å­å­™å…ƒç´  NSArray * elementList =[doc.rootElement elementsForName:@&quot;book&quot;]; for (GDataXMLElement *element in elementList) &#123; NSString *title=((GDataXMLElement *)[[element elementsForName:@&quot;title&quot;] firstObject]).stringValue; NSString *author=((GDataXMLElement *)[[element elementsForName:@&quot;author&quot;] firstObject]).stringValue; NSString *year=((GDataXMLElement *)[[element elementsForName:@&quot;year&quot;] firstObject]).stringValue; NSString *price=((GDataXMLElement *)[[element elementsForName:@&quot;price&quot;] firstObject]).stringValue; NSLog(@&quot;title = %@ author = %@ year = %@ price = %@&quot;,title,author,year,price); &#125;&#125;","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"Swiftå­¦ä¹ 40ï¼šç±»&ç»“æ„ä½“&æšä¸¾ï¼šä¸‹æ ‡å’Œä¸‹æ ‡é‡è½½","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 40ï¼šç±»-ç»“æ„ä½“-æšä¸¾ï¼šä¸‹æ ‡å’Œä¸‹æ ‡é‡è½½","date":"2023-03-05T12:28:10.000Z","updated":"2023-03-09T07:24:58.590Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 40ï¼šç±»-ç»“æ„ä½“-æšä¸¾ï¼šä¸‹æ ‡å’Œä¸‹æ ‡é‡è½½/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A040%EF%BC%9A%E7%B1%BB-%E7%BB%93%E6%9E%84%E4%BD%93-%E6%9E%9A%E4%B8%BE%EF%BC%9A%E4%B8%8B%E6%A0%87%E5%92%8C%E4%B8%8B%E6%A0%87%E9%87%8D%E8%BD%BD/","excerpt":"","text":"ä¸‹æ ‡ ç±»ã€ç»“æ„ä½“å’Œæšä¸¾å¯ä»¥å®šä¹‰ ä¸‹æ ‡ï¼Œå®ƒå¯ä»¥ä½œä¸ºè®¿é—®é›†åˆã€åˆ—è¡¨æˆ–åºåˆ—å·æˆå‘˜å…ƒç´ çš„å¿«æ·æ–¹å¼ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹æ ‡é€šè¿‡ç´¢å¼•å€¼æ¥è®¾ç½®æˆ–æ£€ç´¢å€¼è€Œä¸éœ€è¦ä¸ºè®¾ç½®å’Œæ£€ç´¢åˆ†åˆ«ä½¿ç”¨å®ä¾‹æ–¹æ³• ä½ å¯ä»¥ä¸ºä¸€ä¸ªç±»å‹å®šä¹‰å¤šä¸ªä¸‹æ ‡ï¼Œå¹¶ä¸”ä¸‹æ ‡ä¼šåŸºäºä¼ å…¥çš„ç´¢å¼•å€¼çš„ç±»å‹é€‰æ‹©åˆé€‚çš„ä¸‹æ ‡é‡è½½ä½¿ç”¨ã€‚ä¸‹æ ‡æ²¡æœ‰é™åˆ¶å•ä¸ªç»´åº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªè¾“å…¥å½¢å‚æ¥å®šä¹‰ä¸‹æ ‡ä»¥æ»¡è¶³è‡ªå®šä¹‰ç±»å‹çš„éœ€æ±‚ ä¸‹æ ‡è¯­æ³• ä¸‹æ ‡è„šæœ¬å…è®¸ä½ é€šè¿‡åœ¨å®ä¾‹ååé¢çš„æ–¹æ‹¬å·å†…å†™ä¸€ä¸ªæˆ–å¤šä¸ªå€¼å¯¹è¯¥ç±»çš„å®ä¾‹è¿›è¡ŒæŸ¥è¯¢ã€‚å®ƒçš„è¯­æ³•ç±»ä¼¼äºå®ä¾‹æ–¹æ³•å’Œè®¡ç®—å±æ€§ã€‚ä½¿ç”¨å…³é”®å­— subscript æ¥å®šä¹‰ä¸‹æ ‡ï¼Œå¹¶ä¸”æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥å½¢å¼å‚æ•°å’Œè¿”å›ç±»å‹ï¼Œä¸å®ä¾‹æ–¹æ³•ä¸€æ ·ã€‚ä¸å®ä¾‹æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œä¸‹æ ‡å¯ä»¥æ˜¯è¯»å†™ä¹Ÿå¯ä»¥æ˜¯åªè¯»çš„ 1","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 39ï¼šä¸ºç±»&ç»“æ„ä½“&æšä¸¾æ·»åŠ å±æ€§å’Œæ–¹æ³•","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 39ï¼šä¸ºç±»-ç»“æ„ä½“-æšä¸¾æ·»åŠ å±æ€§å’Œæ–¹æ³•","date":"2023-03-05T10:25:21.000Z","updated":"2023-03-09T07:24:55.858Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 39ï¼šä¸ºç±»-ç»“æ„ä½“-æšä¸¾æ·»åŠ å±æ€§å’Œæ–¹æ³•/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A039%EF%BC%9A%E4%B8%BA%E7%B1%BB-%E7%BB%93%E6%9E%84%E4%BD%93-%E6%9E%9A%E4%B8%BE%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95/","excerpt":"","text":"ä¸ºç±»ã€ç»“æ„ä½“ã€æšä¸¾æ·»åŠ  å±æ€§å­˜å‚¨å±æ€§ å­˜å‚¨å±æ€§ æ˜¯ä¸€ä¸ªä½œä¸ºç‰¹å®šç±»å’Œç»“æ„ä½“å®ä¾‹ä¸€éƒ¨åˆ†çš„ å¸¸é‡æˆ–å˜é‡ã€‚å­˜å‚¨å±æ€§è¦ä¹ˆæ˜¯å˜é‡å­˜å‚¨å±æ€§ï¼ˆç”± var å…³é”®å­—å¼•å…¥ï¼‰ï¼Œè¦ä¹ˆæ˜¯å¸¸é‡å­˜å‚¨å±æ€§ï¼ˆç”± let å…³é”®å­—å¼•å…¥ï¼‰ 1234567// å­˜å‚¨å±æ€§class DataManager &#123; // å˜é‡å­˜å‚¨å±æ€§ var fileName = &quot;tex&quot; // å¸¸é‡å­˜å‚¨å±æ€§ let age = 10&#125; å¸¸é‡ç»“æ„ä½“å®ä¾‹çš„å­˜å‚¨å±æ€§ å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ª ç»“æ„ä½“çš„å®ä¾‹ å¹¶ä¸”æŠŠè¿™ä¸ª å®ä¾‹èµ‹å€¼ç»™å¸¸é‡ï¼Œä½  ä¸èƒ½ä¿®æ”¹ è¿™ä¸ªå®ä¾‹çš„å±æ€§ï¼Œå³ä½¿æ˜¯å£°æ˜ä¸ºå˜é‡çš„å±æ€§ å»¶è¿Ÿå­˜å‚¨å±æ€§ å»¶è¿Ÿå­˜å‚¨å±æ€§çš„åˆå§‹å€¼åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰è¿›è¡Œè®¡ç®—ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨å…¶å£°æ˜å‰é¢æ ‡æ³¨ lazy ä¿®é¥°è¯­ æ¥è¡¨ç¤ºä¸€ä¸ª å»¶è¿Ÿå­˜å‚¨å±æ€§ å¦‚æœè¢«æ ‡è®°ä¸º lazy ä¿®é¥°ç¬¦çš„å±æ€§åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®å¹¶ä¸”å±æ€§è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™æ— æ³•ä¿è¯å±æ€§åªåˆå§‹åŒ–ä¸€æ¬¡ã€‚ 12345// å­˜å‚¨å±æ€§class DataManager &#123; // å»¶è¿Ÿå­˜å‚¨å±æ€§ lazy var data = [String]()&#125; è®¡ç®—å±æ€§ é™¤äº†å­˜å‚¨å±æ€§ï¼Œç±»ã€ç»“æ„ä½“ã€æšä¸¾ è¿˜èƒ½å®šä¹‰ è®¡ç®—å±æ€§ï¼Œè€Œå®ƒå®é™…å¹¶ä¸æ˜¯å­˜å‚¨å€¼ã€‚ç›¸åï¼Œå®ƒæä¾›ä¸€ä¸ªè¯»å–å™¨å’Œä¸€ä¸ªå¯é€‰çš„è®¾ç½®å™¨æ¥é—´æ¥å¾—åˆ°å’Œè®¾ç½®å…¶å®ƒçš„å±æ€§å’Œå€¼ã€‚ç±»ä¼¼äº OC çš„ set/get æ–¹æ³•å»è®¾å€¼å’Œå–å€¼ 123456789101112131415161718192021222324252627// è®¡ç®—å±æ€§struct Point &#123; var x = 0.0,y = 0.0&#125;struct Size &#123; var width = 0.0,height = 0.0&#125;struct Rect &#123; // å­˜å‚¨å±æ€§ var origin = Point() var size = Size() // è®¡ç®—å±æ€§ï¼šå¯ä»¥é€šè¿‡origin å’Œ size è®¡ç®—å‡ºæ¥ var center: Point &#123; get &#123; let centerX = origin.x + size.width/2.0 let centerY = origin.y + size.height/2.0 return Point(x:centerX, y:centerY) &#125; set(newCenter) &#123; origin.x = newCenter.x - size.width/2.0 origin.y = newCenter.y - size.height/2.0 &#125; &#125;&#125;============= ç®€å†™ setter å¦‚æœä¸€ä¸ªè®¡ç®—å±æ€§çš„è®¾ç½®å™¨æ²¡æœ‰ä¸ºå°†è¦è¢«è®¾ç½®çš„å€¼å®šä¹‰ä¸€ä¸ªåå­—ï¼Œé‚£ä¹ˆå®ƒå°†è¢«é»˜è®¤å‘½åä¸º newValue 1234set &#123; origin.x = newValue.x - size.width/2.0 origin.y = newValue.y - size.height/2.0&#125; ç®€å†™ getter å¦‚æœæ•´ä¸ª getter çš„å‡½æ•°ä½“æ˜¯ä¸€ä¸ªå•ä¸€çš„è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆ getter éšå£«è¿”å›è¿™ä¸ªè¡¨è¾¾å¼ 1234// ç®€å†™ getget &#123; Point(x: origin.x + size.width/2.0,y: origin.y + size.height/2.0)&#125; åªè¯»è®¡ç®—å±æ€§ ä¸€ä¸ª æœ‰è¯»å–å™¨ ä½†æ˜¯ æ²¡æœ‰è®¾ç½®å™¨ çš„ è®¡ç®—å±æ€§ å°±æ˜¯æ‰€è°“çš„ åªè¯»è®¡ç®—å±æ€§ã€‚åªè¯»è®¡ç®—å±æ€§è¿”å›ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç‚¹è¯­æ³•è®¿é—®ï¼Œä½†æ˜¯ä¸èƒ½è¢«ä¿®æ”¹ä¸ºå¦ä¸€ä¸ªå€¼ ä½ å¿…é¡»ç”¨ varå…³é”®å­— å®šä¹‰è®¡ç®—å±æ€§ï¼ˆåŒ…æ‹¬åªè¯»è®¡ç®—å±æ€§ï¼‰ä¸ºå˜é‡å±æ€§ï¼Œå› ä¸ºå®ƒçš„å€¼ä¸æ˜¯å›ºå®šçš„ã€‚letå…³é”®å­— åªèƒ½ç”¨äºå¸¸é‡å±æ€§ï¼Œç”¨äºæ˜ç¡®å“ªäº›å€¼ä¸€æ—¦ä½œä¸ºå®ä¾‹åˆå§‹åŒ–å°±ä¸èƒ½æ›´æ”¹ 123456789101112// åªè¯»è®¡ç®—å±æ€§struct Rect &#123; // å­˜å‚¨å±æ€§ var origin = Point() var size = Size() // è®¡ç®—å±æ€§ï¼šå¯ä»¥é€šè¿‡origin å’Œ size è®¡ç®—å‡ºæ¥ var center: Point &#123; get &#123; return Point(x: origin.x + size.width/2.0,y: origin.y + size.height/2.0) &#125; &#125;&#125; å±æ€§è§‚å¯Ÿè€… willSet ä¼šåœ¨è¯¥å€¼è¢«å­˜å‚¨ä¹‹å‰è¢«è°ƒç”¨ didSet ä¼šåœ¨ä¸€ä¸ªæ–°å€¼è¢«å­˜å‚¨ä¹‹åè¢«è°ƒç”¨ å¦‚æœä½ å®ç°äº†ä¸€ä¸ª willSet è§‚å¯Ÿè€…ï¼Œæ–°çš„å±æ€§å€¼ä¼šä»¥å¸¸é‡å½¢å¼å‚æ•°ä¼ é€’ã€‚ä½ å¯ä»¥å†ä½ çš„ willSet å®ç°ä¸­ä¸ºè¿™ä¸ªå‚æ•°å®šä¹‰åå­—ã€‚å¦‚æœä½ æ²¡æœ‰ä¸ºå®ƒå‘½åï¼Œé‚£ä¹ˆå®ƒä¼šä½¿ç”¨é»˜è®¤å€¼çš„åå­— newValue å¦‚æœä½ å®ç°äº†ä¸€ä¸ª didSet è§‚å¯Ÿè€…ï¼Œä¸€ä¸ªåŒ…å«æ—§å±æ€§å€¼çš„å¸¸é‡å½¢å¼å‚æ•°å°†ä¼šè¢«ä¼ é€’ã€‚ä½ å¯ä»¥ä¸ºå®ƒå‘½åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼çš„å½¢å¼å‚æ•°å oldValueã€‚å¦‚æœä½ åœ¨å±æ€§è‡ªå·±çš„ disSet è§‚å¯Ÿè€…é‡Œç»™è‡ªå·±èµ‹å€¼ï¼Œä½ èµ‹å€¼çš„æ–°å€¼å°±ä¼šå–ä»£åˆšåˆšè®¾ç½®çš„å€¼ã€‚ 12345678910111213141516171819202122// å±æ€§è§‚å¯Ÿè€…class StepCounter &#123; var totalSteps: Int = 0 &#123; willSet(newValue) &#123; print(&quot;totalSteps to \\(newValue)&quot;) &#125; didSet &#123; if totalSteps &gt; oldValue &#123; print(&quot;add \\(totalSteps - oldValue) steps&quot;) &#125; &#125; &#125;&#125;let stepCounter = StepCounter()stepCounter.totalSteps = 100stepCounter.totalSteps = 200============totalSteps to 100add 100 stepstotalSteps to 200add 100 steps å…¨å±€å’Œå±€éƒ¨å˜é‡ è§‚å¯Ÿå±æ€§çš„èƒ½åŠ›åŒæ ·å¯¹å…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡æœ‰æ•ˆã€‚å…¨å±€å˜é‡ æ˜¯å®šä¹‰åœ¨ ä»»ä½•å‡½æ•°ã€æ–¹æ³•ã€é—­åŒ…æˆ–è€…ç±»å‹ç¯å¢ƒä¹‹å¤–çš„å˜é‡ã€‚å±€éƒ¨å˜é‡ æ˜¯å®šä¹‰åœ¨ å‡½æ•°ã€æ–¹æ³•æˆ–é—­åŒ…ç¯å¢ƒä¹‹ä¸­çš„å˜é‡ã€‚ 1234567891011121314// å…¨å±€å˜é‡var count: Int = 0 &#123; willSet &#123; print(&quot;will set count to \\(newValue)&quot;) &#125; didSet &#123; print(&quot;did change count from \\(oldValue) to \\(count)&quot;) &#125;&#125;count = 10==============will set count to 10did change count from 0 to 10 ç±»å‹å±æ€§ ä½¿ç”¨ static å…³é”®å­—æ¥å®šä¹‰ ç±»å‹å±æ€§ã€‚å¯¹äº ç±» çš„ ç±»å‹å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨ class å…³é”®å­—æ¥ å…è®¸å­ç±»é‡å†™çˆ¶ç±»çš„å®ç° 1234567891011// ç±»å‹å±æ€§class SomeClass &#123; static var storedProperty = &quot;some value&quot; static var computedProperty: Int &#123; return 27 &#125; // é‡å†™getæ–¹æ³• class var overrideComputedProperty: Int &#123; return 107 &#125;&#125; ä¸ºç±»ã€ç»“æ„ä½“ã€æšä¸¾æ·»åŠ  æ–¹æ³•å®ä¾‹æ–¹æ³• å®ä¾‹æ–¹æ³• æ˜¯å±äº ç‰¹å®šç±»å®ä¾‹ã€ç»“æ„ä½“å®ä¾‹æˆ–æšä¸¾å®ä¾‹çš„å‡½æ•°ã€‚ä»–ä»¬ä¸ºè¿™äº›å®ä¾‹æä¾›åŠŸèƒ½æ€§ï¼Œè¦ä¹ˆé€šè¿‡æä¾›è®¿é—®å’Œä¿®æ”¹å®ä¾‹å±æ€§çš„æ–¹æ³•ï¼Œè¦ä¹ˆé€šè¿‡æä¾›ä¸å®ä¾‹ç›®çš„ç›¸å…³çš„åŠŸèƒ½ æ¯ä¸€ä¸ªç±»çš„å®ä¾‹éƒ½éšå«ä¸€ä¸ªå«åš self çš„å±æ€§ï¼Œå®ƒå®Œå…¨ä¸å®ä¾‹æœ¬èº«ç›¸ç­‰ã€‚ä½ å¯ä»¥ç”¨ self å±æ€§åœ¨å½“å‰å®ä¾‹ä¸­è°ƒç”¨è‡ªèº«çš„æ–¹æ³• å®é™…ä¸Šï¼Œä½ ä¸éœ€è¦ç»å¸¸åœ¨ä»£ç ä¸­å†™ selfã€‚å¦‚æœä½ æ²¡æœ‰æ˜¾ç¤ºåœ°å†™å‡º selfï¼Œswift ä¼šåœ¨ä½ æ–¹æ³•ä¸­ä½¿ç”¨å·²çŸ¥å±æ€§æˆ–æ–¹æ³•çš„æ—¶å€™å‡å®šä½ è°ƒç”¨äº†å½“å‰å®ä¾‹ä¸­çš„å±æ€§æˆ–è€…æ–¹æ³• ä¾‹å¤–å°±æ˜¯å½“ä¸€ä¸ªå®ä¾‹æ–¹æ³•çš„å½¢å¼å‚æ•°åä¸å®ä¾‹ä¸­æŸä¸ªå±æ€§æ‹¥æœ‰ç›¸åŒçš„åå­—çš„æ—¶å€™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½¢å¼å‚æ•°åå…·æœ‰ä¼˜å…ˆæƒï¼Œå¹¶ä¸”è°ƒç”¨å±æ€§çš„æ—¶å€™ä½¿ç”¨æ›´åŠ ä¸¥è°¨çš„æ–¹å¼å°±å¾ˆæœ‰å¿…è¦äº†ã€‚ä½ å¯ä»¥ä½¿ç”¨ self å±æ€§æ¥ åŒºåˆ†å½¢å¼å‚æ•°åå’Œå±æ€§å 123456789101112struct Point &#123; var x = 0.0, y = 0.0 // å®ä¾‹æ–¹æ³• func pringInfo() &#123; print(&quot;x is \\(x),y is \\(y)&quot;) &#125;&#125;var p = Point(x: 2,y: 2)p.pringInfo()=======x is 2.0,y is 2.0 å®ä¾‹æ–¹æ³• self1234567891011121314struct Point &#123; var x = 0.0, y = 0.0 // å®ä¾‹æ–¹æ³• self func isToTheRightOf(x: Double) -&gt; Bool &#123; return self.x &gt; x &#125;&#125;let somePoint = Point(x: 2.0,y: 3.0)if somePoint.isToTheRightOf(x: 1.0) &#123; print(&quot;the point is x \\(somePoint.x)&quot;)&#125;=======the point is x 2.0 åœ¨å®ä¾‹æ–¹æ³•ä¸­ä¿®æ”¹å±æ€§ ç»“æ„ä½“å’Œæšä¸¾æ˜¯å€¼ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå€¼ç±»å‹å±æ€§ä¸èƒ½è¢«è‡ªèº«çš„å®ä¾‹æ–¹æ³•ä¿®æ”¹ ä½ å¯ä»¥é€‰æ‹©åœ¨ func å…³é”®å­—å‰æ”¾ä¸€ä¸ª mutating(å¼‚å˜æ–¹æ³•) å…³é”®å­—æ¥ æŒ‡å®šå¯ä»¥ä¿®æ”¹å±æ€§ 123456789101112131415// ä¿®æ”¹å±æ€§struct Point &#123; var x = 0.0, y = 0.0 // å¼‚å˜æ–¹æ³• mutating func moveBy(x deltaX: Double,y deltaY: Double) &#123; x += deltaX y += deltaY &#125;&#125;var somePoint = Point(x: 1.0, y: 3.0)somePoint.moveBy(x: 2.0,y: 2.0)print(&quot;\\(somePoint.x) \\(somePoint.y)&quot;)===========3.0 5.0 åœ¨ mutating æ–¹æ³•ä¸­èµ‹å€¼ç»™ self mutating æ–¹æ³•å¯ä»¥æŒ‡å®šæ•´ä¸ªå®ä¾‹ç»™éšå«çš„ self å±æ€§ 1234567891011121314// selfstruct Point &#123; var x = 0.0, y = 0.0 // å¼‚å˜æ–¹æ³• mutating func moveBy(x deltaX: Double,y deltaY: Double) &#123; self = Point(x:x+deltaX,y:y+deltaY) &#125;&#125;var somePoint = Point(x: 2.0, y: 4.0)somePoint.moveBy(x: 2.0,y: 2.0)print(&quot;\\(somePoint.x) \\(somePoint.y)&quot;)=======4.0 6.0 æšä¸¾çš„ mutating æ–¹æ³• æšä¸¾çš„ å¼‚å˜æ–¹æ³• å¯ä»¥è®¾ç½®éšå«çš„ self å±æ€§ä¸ºç›¸åŒæšä¸¾é‡Œçš„ä¸åŒæˆå‘˜ 1234567891011121314151617// æšä¸¾ mutating æ–¹æ³•enum StateSwitch &#123; case off,low,high mutating func next() &#123; switch self &#123; case .off: self = .low case .low: self = .high case .high: self = .off &#125; &#125;&#125;var light = StateSwitch.lowlight.next()light.next() ç±»å‹æ–¹æ³• é€šè¿‡åœ¨ func å…³é”®å­—å‰ç”¨ static å…³é”®å­—æ¥æ˜ç¡®ä¸€ä¸ªç±»å‹æ–¹æ³•ã€‚ç±»åŒæ ·å¯ä»¥ä½¿ç”¨ classå…³é”®å­— æ¥å…è®¸å­ç±»é‡å†™çˆ¶ç±»å¯¹ç±»å‹æ–¹æ³•çš„å®ç° 1234567891011121314151617181920// å®ä¾‹æ–¹æ³• selfstruct Point &#123; var x = 0.0, y = 0.0 func pringInfo() &#123; print(&quot;x is \\(x),y is \\(y)&quot;) &#125; // ç±»æ–¹æ³• static func printTypeInfo() &#123; print(&quot;A Point&quot;) &#125;&#125;var p = Point(x: 2,y: 2)p.pringInfo()// ç±»æ–¹æ³•ç”¨ç±»å‹è°ƒç”¨Point.printTypeInfo()=====x is 2.0,y is 2.0A Point","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 37ï¼šæ‰©å±•","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 42ï¼šæ‰©å±•","date":"2023-03-05T09:05:03.000Z","updated":"2023-03-09T07:25:08.710Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 42ï¼šæ‰©å±•/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A042%EF%BC%9A%E6%89%A9%E5%B1%95/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 37ï¼šåè®®","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 41ï¼šåè®®","date":"2023-03-05T09:04:54.000Z","updated":"2023-03-09T07:25:04.137Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 41ï¼šåè®®/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A041%EF%BC%9A%E5%8D%8F%E8%AE%AE/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 37ï¼šç±»","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 40ï¼šç±»","date":"2023-03-05T09:04:46.000Z","updated":"2023-03-09T07:25:02.507Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 40ï¼šç±»/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A040%EF%BC%9A%E7%B1%BB/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 37ï¼šç»“æ„ä½“","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 43ï¼šç»“æ„ä½“","date":"2023-03-05T09:04:39.000Z","updated":"2023-03-09T07:25:12.561Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 43ï¼šç»“æ„ä½“/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A043%EF%BC%9A%E7%BB%93%E6%9E%84%E4%BD%93/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 38ï¼šæšä¸¾","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 38ï¼šæšä¸¾","date":"2023-03-05T09:04:28.000Z","updated":"2023-03-09T07:24:53.507Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 38ï¼šæšä¸¾/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A038%EF%BC%9A%E6%9E%9A%E4%B8%BE/","excerpt":"","text":"å¢å¼ºçš„æšä¸¾æšä¸¾çš„è¯­æ³• ç”¨ enum å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªæšä¸¾ï¼Œç„¶åå°†å…¶æ‰€æœ‰çš„å®šä¹‰å†…å®¹æ”¾åœ¨ä¸€ä¸ªå¤§æ‹¬å· &#123;&#125; ä¸­ å¤šä¸ªæˆå‘˜å€¼å¯ä»¥å‡ºç°åœ¨åŒä¸€è¡Œä¸­ï¼Œç”¨é€—å·éš”å¼€ æ¯ä¸ªæšä¸¾éƒ½å®šä¹‰äº†ä¸€ä¸ªå…¨æ–°çš„ç±»å‹ã€‚æ­£å¦‚swiftä¸­å…¶å®ƒç±»å‹é‚£æ ·ï¼Œå®ƒçš„åç§°ï¼ˆä¾‹å¦‚ï¼š ComPï¼‰éœ€è¦é¦–å­—æ¯å¤§å†™ã€‚ç»™æšä¸¾ç±»å‹èµ·ä¸€ä¸ªå•æ•°çš„è€Œä¸æ˜¯å¤æ•°çš„åå­—ï¼Œä»è€Œä½¿å¾—ä»–ä»¬èƒ½å¤Ÿé¡¾åæ€ä¹‰ 123456789101112enum ComP &#123; case east case south case west case north&#125;æˆ–enum ComP2 &#123; case ease, south, west, north&#125; ä½¿ç”¨ Switch è¯­å¥æ¥åŒ¹é…æšä¸¾å€¼ ä½ å¯ä»¥ç”¨ switch è¯­å¥æ¥åŒ¹é…æ¯ä¸€ä¸ªå•ç‹¬çš„æšä¸¾å€¼ 1234567891011121314let directionToHead = ComP.southswitch directionToHead &#123;case .east: print(&quot;east&quot;)case .south: print(&quot;south&quot;)case .west: print(&quot;west&quot;)case .north: print(&quot;north&quot;)&#125;======south éå†æšä¸¾çš„ case æšä¸¾ä¹Ÿå¯ä»¥è¢«éå†ï¼Œéœ€è¦éµå®ˆ CaseIterable åè®®æ¥ å…è®¸æšä¸¾è¢«éå†ï¼Œå†™æ³•ï¼šåœ¨æšä¸¾ååé¢å†™ :CaseIterable 12345678910111213141516// éå†æšä¸¾enum ComP : CaseIterable&#123; case east case south case west case north&#125;for direction in ComP.allCases &#123; print(direction)&#125;=========eastsouthwestnorth æˆ–è€… 12345678// éå†æšä¸¾enum ComP2 : CaseIterable&#123; case east, south, west, north&#125;print(ComP2.allCases)=========[__lldb_expr_75.ComP2.east, __lldb_expr_75.ComP2.south, __lldb_expr_75.ComP2.west, __lldb_expr_75.ComP2.north] å…³è”å€¼ å¯ä»¥å®šä¹‰swiftæšä¸¾æ¥å­˜å‚¨ä»»æ„ç»™å®šç±»å‹çš„å…³è”å€¼ï¼Œå¦‚æœéœ€è¦çš„è¯ä¸åŒæšä¸¾æˆå‘˜å…³è”å€¼çš„ç±»å‹å¯ä»¥ä¸åŒ 12345678910111213// å…³è”å€¼enum Barcde &#123; case upc(Int,Int,Int,Int) // å…ƒç»„ case qrCode(String) // å…ƒç»„&#125;var productBarcode = Barcde.upc(5,111,33,245)print(productBarcode)productBarcode = .qrCode(&quot;aaaaaddddd&quot;)print(productBarcode)==============upc(5, 111, 33, 245)qrCode(&quot;aaaaaddddd&quot;) å…³è”å€¼ç»‘å®š12345678910// å…³è”å€¼ç»‘å®šswitch productBarcode &#123;case .upc(let a,let b,let c,let d): print(&quot;UPC: \\(a) \\(b) \\(c) \\(d)&quot;)case .qrCode(let codeString): print(&quot;QR Code: \\(codeString)&quot;)&#125;=========QR Code: aaaaaddddd åŸå§‹å€¼ æšä¸¾æˆå‘˜å¯ä»¥ç”¨ç›¸åŒç±»å‹çš„é»˜è®¤å€¼é¢„å…ˆå¡«å……ï¼ˆç§°ä¸ºåŸå§‹å€¼ï¼‰ 12345678// åŸå§‹å€¼enum carS: Character &#123; case tab = &quot;\\t&quot; case lineFeed = &quot;\\n&quot; case carrReturn = &quot;\\r&quot;&#125;let car = carS.tabprint(car.rawValue) é¢„è®¾åŸå§‹å€¼ å½“ä½ æ“ä½œå­˜å‚¨æ•´æ•°æˆ–å­—ç¬¦ä¸²åŸå§‹å€¼æšä¸¾çš„æ—¶å€™ï¼Œä½ ä¸å¿…æ˜¾ç¤ºåœ°ç»™æ¯ä¸€ä¸ªæˆå‘˜éƒ½åˆ†é…ä¸€ä¸ªåŸå§‹å€¼ã€‚å½“ä½ æ²¡æœ‰åˆ†é…æ—¶ï¼Œswiftå°†è‡ªåŠ¨ä¸ºä½ åˆ†é…å€¼ 12345678// é¢„è®¾åŸå§‹å€¼enum ComP: Int &#123; case ease = 4,south,west,north&#125;print(ComP.south.rawValue)========5 ä»åŸå§‹å€¼åˆå§‹åŒ– å½“ä½ ç”¨åŸå§‹å€¼å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ï¼Œé‚£ä¹ˆæšä¸¾å°±ä¼šè‡ªåŠ¨æ”¶åˆ°ä¸€ä¸ªå¯ä»¥æ¥å—åŸå§‹å€¼ç±»å‹çš„åˆå§‹åŒ–å™¨ï¼ˆå«åš rawValue çš„å½¢å¼å‚æ•°ï¼‰ç„¶åè¿”å›ä¸€ä¸ªæšä¸¾æˆå‘˜æˆ–è€… nilã€‚ä½ å¯ä»¥ç”¨è¿™ä¸ªåˆå§‹åŒ–å™¨æ¥å°è¯•åˆ›å»ºä¸€ä¸ªæšä¸¾çš„ æ–°å®ä¾‹ 1234567891011// åˆå§‹åŒ–å™¨enum ComP: Int &#123; case ease = 4,south,west,north&#125;let direction = ComP(rawValue: 6)print(direction)let direction2 = ComP(rawValue: 8)print(direction2)========Optional(__lldb_expr_82.ComP.west)nil é€’å½’æšä¸¾ é€’å½’æšä¸¾æ˜¯æ‹¥æœ‰å¦ä¸€ä¸ªæšä¸¾ä½œä¸ºæšä¸¾æˆå‘˜å…³è”å€¼çš„æšä¸¾ã€‚å½“ç¼–è¯‘å™¨æ“ä½œé€’å½’æšä¸¾æ—¶å¿…é¡»æ’å…¥ ç®€ä»‹å¯»å€å±‚ã€‚ä½ å¯ä»¥åœ¨å£°æ˜æšä¸¾æˆå‘˜ä¹‹å‰ä½¿ç”¨ indrect å…³é”®å­—æ¥æ˜ç¡®å®ƒæ˜¯é€’å½’çš„ å¦‚æœè¯´è¡¨è¾¾å¼ (5+4)*2 åœ¨ä¹˜æ³•å³ä¾§æœ‰ä¸€ä¸ªæ•°ä½†æœ‰å…¶ä»–è¡¨è¾¾å¼åœ¨ä¹˜æ³•çš„å·¦ä¾§ 123456789101112131415// é€’å½’æšä¸¾indirect enum ArExp &#123; case number(Int) case add(ArExp,ArExp) case mutiply(ArExp,ArExp)&#125;let firstExp = ArExp.number(5)let secondExp = ArExp.number(4)let addExp = ArExp.add(firstExp,secondExp)let thirdExp = ArExp.number(2)let mutipExp = ArExp.mutiply(addExp,thirdExp)print(mutipExp)=========mutiply(__lldb_expr_89.ArExp.add(__lldb_expr_89.ArExp.number(5), __lldb_expr_89.ArExp.number(4)), __lldb_expr_89.ArExp.number(2)) æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè¡¨è¾¾å¼ 1234567891011121314func eval(_ exp: ArExp) -&gt; Int &#123; switch exp &#123; case .number(let value): return value case .add(let first,let second): return eval(first) + eval(second) case .mutiply(let first,let second): return eval(first) * eval(second) &#125;&#125;print(eval(mutipExp))=========18","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 35ï¼šå¦‚ä½•ä½¿ç”¨swiftä¸­çš„é«˜é˜¶å‡½æ•°","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 35ï¼šå¦‚ä½•ä½¿ç”¨swiftä¸­çš„é«˜é˜¶å‡½æ•°","date":"2023-03-05T06:57:55.000Z","updated":"2023-03-09T07:24:44.454Z","comments":true,"path":"2023/03/05/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 35ï¼šå¦‚ä½•ä½¿ç”¨swiftä¸­çš„é«˜é˜¶å‡½æ•°/","link":"","permalink":"https://www.bboyzj.cn/2023/03/05/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A035%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8swift%E4%B8%AD%E7%9A%84%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/","excerpt":"","text":"map å¯¹äºæ¼”ç¤ºé›†åˆé‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œä»¥ä¸€ä¸ª å˜æ¢åçš„å…ƒç´ æ›¿æ¢å®ƒï¼Œå½¢æˆä¸€ä¸ªæ–°çš„é›†åˆ ç¤ºä¾‹ï¼š 123456// mapï¼šå°¾éšé—­åŒ…çš„å½¢å¼è¾“å‡ºlet nums = [1,2,3,4,5]print(nums.map &#123; $0 * 10 &#125;)========[10, 20, 30, 40, 50] filter å¯¹äºåŸå§‹é›†åˆé‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œé€šè¿‡åˆ¤å®šæ¥å°†å…¶ä¸¢å¼ƒæˆ–è€…æ”¾è¿›æ–°é›†åˆ ç¤ºä¾‹ï¼š 123456// filterï¼šå°¾éšé—­åŒ…çš„å½¢å¼è¾“å‡ºlet nums = [1,2,3,4,5]print(nums.filter &#123; $0 &gt; 3 &#125;)========[4, 5] reduce å¯¹äºåŸå§‹é›†åˆé‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œä½œç”¨äºå½“å‰ç´¯è®¡çš„ç»“æœä¸Š ç¤ºä¾‹ï¼š 123456// reduceï¼šå°¾éšé—­åŒ…çš„å½¢å¼è¾“å‡ºlet nums = [1,2]print(nums.reduce(10, &#123; $0 + $1 &#125;))=======13 flatMap å¯¹äºå…ƒç´ æ˜¯é›†åˆçš„é›†åˆï¼Œå¯ä»¥å¾—åˆ°å•çº§çš„é›†åˆ 123456789let results = [[1,2,3],[4,5,6]];let allResults = results.flatMap&#123; $0.map &#123; $0 &#125; &#125;let passMarks = results.flatMap&#123; $0.filter &#123; $0 &gt; 5 &#125; &#125;print(allResults)print(passMarks)===========[1, 2, 3, 4, 5, 6][6] compactMap è¿‡æ»¤ç©ºå€¼ 12345678910111213// compactMaplet keys: [String?] = [&quot;a&quot;,nil,&quot;b&quot;]let key = keys.map&#123; $0 &#125;print(key)let validNames = keys.compactMap&#123; $0 &#125;print(validNames)let counts = keys.compactMap&#123; $0?.count &#125;print(counts)==========[Optional(&quot;a&quot;), nil, Optional(&quot;b&quot;)][&quot;a&quot;, &quot;b&quot;][1, 1]","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"OCç»„ä»¶åŒ–06ï¼šGithub-Desktopç®¡ç†å·¥å…·ä½¿ç”¨","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–06ï¼šGithub-Desktopç®¡ç†å·¥å…·ä½¿ç”¨","date":"2023-03-04T15:47:00.000Z","updated":"2023-03-04T15:55:05.157Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–06ï¼šGithub-Desktopç®¡ç†å·¥å…·ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9606%EF%BC%9AGithub-Desktop%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€GitHub Desktop ç®€å•è¯´å°±æ˜¯ å›¾å½¢ç•Œé¢ ç‰ˆçš„ Gitï¼Œä¸éœ€è¦å‘½ä»¤è¡Œçš„æ“ä½œ é€šè¿‡ GitHubå®˜ç½‘ å¯ä»¥ä¸‹è½½ã€å®‰è£…ä½¿ç”¨ å‡†å¤‡å·¥ä½œ æ³¨å†Œä½ çš„ GitHub è´¦å·ï¼Œå·²æ³¨å†Œ GitHub è´¦å·çš„ï¼Œè·³è¿‡ åœ¨ GitHub Desktop ç™»å½•ä½ çš„è´¦å· åˆ›å»ºä»“åº“ï¼šFile -&gt; new repository åˆ›å»ºåˆ†æ”¯ï¼šbranch -&gt; new branch åˆ›å»ºä¸€ä¸ªå¼€å‘çš„åˆ†æ”¯ zj_feature å…‹éš†ä»“åº“åˆ° GitHub Desktop File -&gt; Clone Repository åˆ‡æ¢åˆ†æ”¯ ä¿®æ”¹å·¥ç¨‹ä»£ç ï¼Œå°† 0.2.0 ç‰ˆæœ¬ä»£ç å®Œæˆï¼Œå¹¶æäº¤åˆ°æ–°åˆ†æ”¯ zj_feature Summaryï¼šå¿…å¡« 0.2.0 Descriptionï¼šæè¿° 0.2.0 ç‰ˆæœ¬çš„å†…å®¹ Commit to zj_feature push origin åˆå¹¶åˆ†æ”¯ï¼š å…ˆåˆ‡æ¢åˆ° main ä¸»åˆ†æ”¯ åˆå¹¶åˆ†æ”¯ï¼šbranchèœå• -&gt; merge into current branch æäº¤ main åˆ†æ”¯ åˆ é™¤åˆ†æ”¯ï¼šèœå•branch -&gt; delete åˆ é™¤åˆ†æ”¯ ç‰ˆæœ¬å›æ»š è¿˜æœªæäº¤ä»£ç ï¼šæ–‡ä»¶å³é”® -&gt; Discard Changes æ”¾å¼ƒæ›´æ”¹ å·²ç»æäº¤ä»£ç ï¼šæ–‡ä»¶å³é”®é€‰æ‹© -&gt; Revert This Commit æ¢å¤åˆ°å½“å‰æäº¤ ä½¿ç”¨ æ‰“å¼€é¡¹ç›®ä»£ç ï¼šShow in Finder æ‰€æœ‰ æ–°å¢ä»£ç  å¯ä»¥åœ¨å·¥ç¨‹é¡¹ç›®ä¸­å®æ—¶ä¿®æ”¹ï¼Œå¹¶å¯ä»¥è¿è¡ŒæŸ¥çœ‹æ•ˆæœ åœ¨ GitHub Desktop ä¸Šå¯ä»¥çœ‹åˆ°å®æ—¶çš„ä¿®æ”¹ ä¿®æ”¹å®Œè®°å¾—ä¿®æ”¹ä¸€ä¸‹ç‰ˆæœ¬å· æäº¤ä»£ç åˆ° æœ¬åœ°mian åˆ†æ”¯ æäº¤ä»£ç åˆ° è¿œç¨‹main åˆ†æ”¯ ç»ˆç«¯æœç´¢ ZJWeakProxy åº“mac@bogon ~ % pod search ZJWeakProxy ã€é—®é¢˜ï¼šã€‘æœªæœç´¢åˆ°è‡ªå·±åˆ›å»ºçš„ç»„ä»¶åº“ è§£å†³æ–¹æ³•ï¼šæ›´æ–°æœ¬åœ°Podçš„ç´¢å¼•æ–‡ä»¶ 12mac@bogon ~ % rm ~/Library/Caches/CocoaPods/search_index.jsonmac@bogon ~ % pod repo update å¦‚æœè¿˜æ˜¯æœç´¢ä¸åˆ°ï¼š 12mac@bogon ~ % sudo gem install -n /usr/local/bin cocoapods --pre mac@bogon ~ % pod setup å†æ¬¡æœç´¢","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"OCç»„ä»¶åŒ–05ï¼šã€æ–¹æ¡ˆäºŒã€‘cocoapodsç»„ä»¶åŒ–","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–05ï¼šã€æ–¹æ¡ˆäºŒã€‘cocoapodsç»„ä»¶åŒ–","date":"2023-03-04T15:30:55.000Z","updated":"2023-03-04T15:45:45.042Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–05ï¼šã€æ–¹æ¡ˆäºŒã€‘cocoapodsç»„ä»¶åŒ–/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9605%EF%BC%9A%E3%80%90%E6%96%B9%E6%A1%88%E4%BA%8C%E3%80%91cocoapods%E7%BB%84%E4%BB%B6%E5%8C%96/","excerpt":"","text":"èƒŒæ™¯ éšç€å…¬å¸ä¸šåŠ¡çš„ä¸æ–­å‘å±•ï¼Œåº”ç”¨çš„ä»£ç ä½“ç§¯å°†ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸šåŠ¡ä»£ç è€¦åˆä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œä»£ç é‡ä¹Ÿæ˜¯æ€¥å‰§å¢åŠ  å¦‚æœä»…ä»…å®Œæˆä»£ç æ‹†åˆ†è¿˜ä¸è¶³ä»¥è§£å†³ä¸šåŠ¡ä¹‹é—´çš„ä»£ç è€¦åˆï¼Œè€Œç»„ä»¶åŒ–æ˜¯ä¸€ç§èƒ½å¤Ÿè§£å†³ä»£ç è€¦åˆã€ä¸šåŠ¡å·¥ç¨‹èƒ½å¤Ÿç‹¬ç«‹è¿è¡Œçš„æŠ€æœ¯ è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»è¿œç¨‹ç§æœ‰åº“çš„åˆ›å»ºå’Œç®¡ç†ä»¥åŠæœ¬åœ°ç´¢å¼•åº“çš„ä½¿ç”¨ æœ¬æ–‡ä»¥åˆ›å»º å…¬æœ‰åº“ ä¸ºä¾‹ æŸ¥çœ‹æœ¬åœ°ç´¢å¼•åº“ æˆ‘ä»¬ç”¨ cocoaPods çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯cocoaPodsè‡ªå¸¦çš„ç´¢å¼•åº“ç»ˆç«¯ä¸­ä½¿ç”¨å‘½ä»¤ $ pod repo 1234567891011cocoapods- Type: git (remotes/origin/master)- URL: https://github.com/CocoaPods/Specs.git- Path: /Users/mac/.cocoapods/repos/cocoapodstrunk- Type: CDN- URL: https://cdn.cocoapods.org/- Path: /Users/mac/.cocoapods/repos/trunk2 repos ç»„ä»¶åŒ–åˆ†ç±» å…¬æœ‰åº“ï¼šæ‰€æœ‰äººéƒ½èƒ½ä½¿ç”¨ ç§æœ‰åº“ï¼šå…¬å¸å†…éƒ¨æ‹¥æœ‰ç‰¹æ®Šæƒé™æ‰èƒ½ä½¿ç”¨ frameworkï¼šå…¬ç§éƒ½æœ‰ï¼ŒåŠ¨æ€åº“é™æ€åº“ã€‚åªèƒ½çœ‹åˆ°.hæ–‡ä»¶ã€‚ å‡†å¤‡å·¥ä½œ GitHub è´¦å·ä¸€ä¸ªï¼šä¸Šä¼ ç»„ä»¶å·¥ç¨‹ç”¨ å®‰è£… CocoaPodsï¼šåˆ›å»ºå¹¶éªŒè¯ pod ç”¨ å®‰è£… Git å‘½ä»¤è¡Œ ï¼šé¦–æ¬¡ä¸Šä¼ ç»„ä»¶å·¥ç¨‹ç”¨ å®‰è£… Github Desktop æˆ–è€… SourceTreeï¼šåç»­æ›´æ–°ç»„ä»¶ç”¨çš„ï¼ŒGitå‘½ä»¤ä½¿ç”¨ç†Ÿç»ƒè€…å¿½ç•¥æ­¤é¡¹ åˆ›å»ºå…¬æœ‰åº“ é¦–å…ˆåœ¨ Github åˆ›å»ºä¸€ä¸ªæ–°çš„ Repositoryï¼Œä½ çš„ pods æœ€ç»ˆè¦æ‰˜ç®¡åœ¨ Github å¹³å°ä¸Šçš„ï¼Œæ‰€ä»¥åœ¨ Github ä¸Šåˆ›å»ºä¸€ä¸ªç©ºçš„ Repository æ³¨æ„ï¼šåº“å = é¡¹ç›®å‰ç¼€ + ç»„ä»¶åç§° ï¼Œå¦‚ ZJWeakProxy &#x3D; è§£å†³å¾ªç¯å¼•ç”¨ç»„ä»¶åº“ åˆ›å»ºå®Œæˆåçš„ä¿¡æ¯å¦‚ä¸‹ï¼š æ³¨å†Œ cocoapods è´¦æˆ· å…ˆå®‰è£… cocoapodsï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œå¯ä»¥ç™¾åº¦æœç´¢è‡ªè¡Œå®‰è£… æƒ³è¦åˆ›å»ºä¸€ä¸ªå¼€æº pod åº“ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ³¨å†Œ cocoapodsè´¦æˆ·ï¼ŒåŸºäº cocoapods å·²ç»å®‰è£…å¥½çš„å‰æä¸‹ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ trunk å»æ³¨å†Œ cocopodsè´¦æˆ·ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œï¼š 12pod trunk register é‚®ç®±åœ°å€ &#x27;ç”¨æˆ·å&#x27; --verbosemac@bogon ~ % pod trunk register 13718004742@163.com &#x27;BboyZJ&#x27; --verbose é‚®ç®±åœ°å€ï¼šä¸€èˆ¬ä¼šä½¿ç”¨ GitHubé‚®ç®±ç”¨æˆ·åï¼šéšä¾¿ æ³¨å†Œä¹‹åï¼Œåœ¨é‚®ç®±ä¼šå—åˆ°ç¡®è®¤é‚®ä»¶ æ³¨å†ŒæˆåŠŸä¹‹åå¯ä»¥åœ¨ç»ˆç«¯ éªŒè¯æ˜¯å¦æ³¨å†ŒæˆåŠŸï¼š 123// éªŒè¯æ˜¯å¦æ³¨å†ŒæˆåŠŸmac@bogon ~ % pod trunk me æŸ¥çœ‹æ³¨å†Œä¿¡æ¯ï¼Œä»¥åå¯ä»¥ä½¿ç”¨è¯¥å¼€æºpodåº“å‘å¸ƒå·¥å…·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ­¤æ–¹å¼æŸ¥çœ‹å·²ç»å‘å¸ƒè¿‡çš„podsï¼š 123456789101112mac@bogon ~ % pod trunk me - Name: BboyZJ - Email: 13718004742@163.com - Since: October 20th, 2021 19:20 - Pods: - ZJSDKDemo - ZJSDK_iOS - Sessions: - October 20th, 2021 19:20 - March 31st, 2022 04:01. IP: 114.253.15.66 Description: imac - February 27th, 02:33 - July 5th, 02:37. IP: 114.252.233.188 åœ¨æœ¬åœ°åˆ›å»ºpodåº“ åˆ©ç”¨podå‘½ä»¤åˆ›å»ºåä¸º ZJWeakProxy çš„ pod åº“ æ³¨ï¼šè¿™ä¸ªåå­—è¦å’Œ GitHub åˆ›å»ºçš„ Repository åä¸€è‡´ 1234# cd åˆ°æ¡Œé¢æ–‡ä»¶å¤¹(ç»„ä»¶æ–‡ä»¶å¤¹)ZJComponentç›®å½•ä¸‹ï¼Œè¿™ä¸ªä¸å¼ºåˆ¶éšæ„mac@bogon ~ % cd ZJComponent # æ‰§è¡Œ pod lib create ZJWeakProxymac@bogon ~ % pod lib create ZJWeakProxy å‡ºç° fatal: unable to access â€˜https://github.com/CocoaPods/pod-template.git/ â€˜: HTTP&#x2F;2 stream 1 was not closed cleanly before end of the underlying stream æŠ¥é”™ åŸå› åˆ†æï¼šä¸€èˆ¬è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨çš„ SSL è¯ä¹¦æ²¡æœ‰ç»è¿‡ç¬¬ä¸‰æ–¹æœºæ„çš„ç­¾ç½²ï¼Œæ‰€ä»¥æ‰æŠ¥é”™ è§£å†³åŠæ³•ï¼šè§£é™¤ SSL éªŒè¯ï¼Œå†æ¬¡æ‰§è¡Œ 1mac@bogon ZJComponent % git config --global http.sslVerify false æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œä¼šé—®ä½ å‡ ä¸ªé—®é¢˜ï¼ŒæŒ‰éœ€æ±‚å¡«å†™å³å¯ 123456789101112131415161718# ä½ æƒ³ä½¿ç”¨å“ªä¸ªå¹³å°ï¼Ÿ1ã€What platform do you want to use?? [ iOS / macOS ]iOS# åº“è¯­è¨€é€‰æ‹©ï¼Ÿ2ã€What language do you want to use?? [ Swift / ObjC ]ObjC# æ˜¯å¦éœ€è¦ä¸€ä¸ªdemoå·¥ç¨‹ï¼Œç”¨äºè°ƒè¯•Podï¼Ÿ3ã€Would you like include a demo application with your library? [ Yes / No ]Yes# ä½ è¦ä½¿ç”¨å“ªä¸ªæµ‹è¯•æ¡†æ¶ï¼Ÿ4ã€Which testing frameworks will you use? [ Specta / Kiwi / None ]None# æ˜¯å¦è¦UIæµ‹è¯•ï¼Ÿ5ã€Would you like to do view based testing? [ Yes / No ]NO# ç±»åå‰ç¼€ï¼Ÿ6ã€What is your class prefix?ZJ åˆ°è¿™é‡Œ pod åº“å°±åˆ›å»ºå®Œæˆäº†ï¼Œå®ƒä¼šè‡ªå·±æ‰“å¼€åˆšæ‰åˆ›å»ºçš„podåº“ å·¥ç¨‹ç›®å½•ä»‹ç» ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ã€ç¬¬1éƒ¨åˆ†ã€‘ï¼šä¸»è¦æ˜¯ç”¨æ¥ç¼–è¾‘podç›¸å…³é…ç½®å…ƒæ•°æ®åŒºã€ç¬¬2éƒ¨åˆ†ã€‘ï¼šä¸»è¦æ˜¯ç”¨æ¥éªŒè¯podæ•ˆæœåŒºã€ç¬¬3éƒ¨åˆ†ã€‘ï¼šä¸»è¦æ˜¯ç”¨æ¥ æä¾›ç»™åˆ«äººä½¿ç”¨æš´éœ²å‡ºæ¥çš„podï¼ŒReplaceMeç©ºçš„å¯ä»¥åˆ é™¤ï¼Œæ˜¯æç¤ºæˆ‘ä»¬å¯ä»¥æ·»åŠ è‡ªå·±çš„ç±» é…ç½® podspec æœ¬åœ°ç´¢å¼•æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445Pod::Spec.new do |s| # åº“åç§° s.name = &#x27;ZJWeakProxy&#x27; # ç‰ˆæœ¬å· s.version = &#x27;0.1.0&#x27; # åº“ç®€çŸ­ä»‹ç» s.summary = &#x27;A short description of ZJWeakProxy.&#x27;# This description is used to generate tags and improve search results.# * Think: What does it do? Why did you write it? What is the focus?# * Try to keep it short, snappy and to the point.# * Write the description between the DESC delimiters below.# * Finally, don&#x27;t worry about the indent, CocoaPods strips it! # å¼€æºåº“æè¿° s.description = &lt;&lt;-DESCTODO: Add long description of the pod here. DESC # å¼€æºåº“åœ°å€ï¼Œæˆ–è€…æ˜¯åšå®¢ã€ç¤¾äº¤åœ°å€ç­‰ s.homepage = &#x27;https://github.com/BboyZJ/ZJWeakProxy&#x27; # s.screenshots = &#x27;www.example.com/screenshots_1&#x27;, &#x27;www.example.com/screenshots_2&#x27; # å¼€æºåè®® s.license = &#123; :type =&gt; &#x27;MIT&#x27;, :file =&gt; &#x27;LICENSE&#x27; &#125; # å¼€æºåº“ä½œè€… s.author = &#123; &#x27;BboyZJ&#x27; =&gt; &#x27;13718004742@163.com&#x27; &#125; # å¼€æºåº“èµ„æºæ–‡ä»¶ s.source = &#123; :git =&gt; &#x27;https://github.com/BBoyZJ/ZJWeakProxy.git&#x27;, :tag =&gt; s.version.to_s &#125; # ç¤¾äº¤ç½‘å€ # s.social_media_url = &#x27;https://twitter.com/&lt;TWITTER_USERNAME&gt;&#x27; # å¼€æºåº“æœ€ä½æ”¯æŒ s.ios.deployment_target = &#x27;10.0&#x27; # å¼€æºåº“æºæ–‡ä»¶ s.source_files = &#x27;ZJWeakProxy/Classes/**/*&#x27; # æ·»åŠ å›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶ # s.resource_bundles = &#123; # &#x27;ZJWeakProxy&#x27; =&gt; [&#x27;ZJWeakProxy/Assets/*.png&#x27;] # &#125; # s.public_header_files = &#x27;Pod/Classes/**/*.h&#x27; # ä¾èµ–ç³»ç»Ÿåº“ å¤šä¸ªç”¨é€—å·éš”å¼€ # s.frameworks = &#x27;UIKit&#x27;, &#x27;MapKit&#x27; # å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–åº“ # s.dependency &#x27;AFNetworking&#x27;, &#x27;~&gt; 2.3&#x27;end ã€s.dependencyã€‘ï¼šè®¾ç½®ä¾èµ–ä¸‰æ–¹åº“æˆ–å…¶ä»–ç»„ä»¶ï¼Œå¤šä¸ªåº“å¯ä»¥åˆ†å¼€å†™å¤šæ¬¡ éœ€è¦æ³¨æ„å¦‚å›¾ï¼š Readme ä¸»è¦æ˜¯ä»‹ç»è¿™ä¸ªç»„ä»¶çš„ç”¨é€”å’Œä½¿ç”¨ï¼Œå¯ä»¥éšæ—¶ç¼–è¾‘ã€‚ç›®å‰å°±ç¡®è®¤ä¸€ä¸‹è‡ªå·±çš„åå­—å’Œé‚®ç®±å°±å¯ä»¥äº† åè®®æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ç¡®è®¤ä¸€ä¸‹è‡ªå·±çš„åå­—å’Œé‚®ç®±å°±å¯ä»¥äº† æ·»åŠ è‡ªå·±çš„ç±» æ‰“å¼€podåº“ç›®å½•ï¼Œåˆ é™¤ReplaceMe åˆ›å»º ZJWeakProxy ç®€å•ç±»ï¼Œå£°æ˜ä¸€ä¸ªæ‰“å°å‡½æ•°ï¼Œæ–¹ä¾¿åç»­æµ‹è¯• æ³¨ï¼šåˆ›å»ºç±»æ–‡ä»¶ä¸€å®šè¦æ”¾åˆ° Classes ç›®å½•ä¸‹ .h æ–‡ä»¶ä¸‹ 12345#import &quot;ZJWeakProxy.h&quot;@interface ZJWeakProxy : NSProxy- (void)printZJWeakProxy;@end .m æ–‡ä»¶ä¸‹ 1234567#import &quot;ZJWeakProxy.h&quot;@implementation ZJWeakProxy- (void)printZJWeakProxy&#123; NSLog(@&quot;%s&quot;,__func__);&#125;@end æ­¤æ—¶ cd åˆ° Example è·¯å¾„ä¸‹æ‰§è¡Œ pod install å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å°†åˆšåˆšæ·»åŠ çš„åº“æ–‡ä»¶å¼•å…¥åˆ°å·¥ç¨‹ä¸­ 12mac@bogon ~ % cd /Users/mac/Desktop/ZJComponent/ZJWeakProxy/Example mac@bogon Example % pod install å¦‚æœæˆåŠŸä¼šåœ¨Podsä¸­çœ‹åˆ°ï¼š å¯ä»¥åˆ°é¡¹ç›®ä¸­å¯¼å…¥å¤´æ–‡ä»¶ç®€å•ä½¿ç”¨ä¸€ä¸‹ è¯æ˜æ˜¯å¯ç”¨çš„ ã€æ³¨ã€‘ï¼šCocoaPods å·¥å…·çš„å¦å¤–ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ï¼Œå¤šä¸ªç»„ä»¶ä¾èµ–åŒä¸€ä¸ªç»„ä»¶æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®ä½ æ£€æµ‹å®‰è£…ï¼Œè€Œ ä¸ä¼šé‡å¤å¯¼å…¥ã€‚ é¡¹ç›®ä¸Šä¼ ä¸å‘å¸ƒ cdåˆ°ä½ çš„é¡¹ç›®è·¯å¾„ä¸‹ï¼Œå°†é¡¹ç›®ä¸Šä¼ åˆ°GitHubä¸­ï¼ˆå³åˆšåˆšåˆ›å»ºçš„ZJWeakProxyå…¬æœ‰åº“ä¸­ï¼‰ï¼Œä¾æ¬¡ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤è¡Œï¼Œä¸è¦é—æ¼ 123456789101112# cd åˆ° ç»„ä»¶ZJWeakProxyè·¯å¾„ä¸‹mac@bogon Example % cd /Users/mac/Desktop/ZJComponent/ZJWeakProxy# æ·»åŠ githubé¡¹ç›®è·¯å¾„mac@bogon ZJWeakProxy % git remote add origin https://github.com/BboyZ/ZJWeakProxy.git# æ·»åŠ æ–‡ä»¶mac@bogon ZJWeakProxy % git add .# å°†æš‚å­˜åŒºé‡Œçš„æ”¹åŠ¨æäº¤åˆ°æœ¬åœ°çš„ç‰ˆæœ¬åº“mac@bogon ZJWeakProxy % git commit -m &quot;first commit&quot;# åˆ›å»ºåˆ†æ”¯mainmac@bogon ZJWeakProxy % git branch -M main# æäº¤ç‰ˆæœ¬å·å¹¶pushåˆ°mainåˆ†æ”¯mac@bogon ZJWeakProxy % git push -u origin main åœ¨æ‰§è¡Œ git push -u origin main æ—¶ï¼Œå¦‚æœé‡åˆ°éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼š 12Username for &#x27;https://github.com&#x27;: BboyZJPassword for &#x27;https://BboyZJ@github.com&#x27;: ã€æ³¨æ„ã€‘ï¼šè¿™ä¸ª å¯†ç  ä¸æ˜¯ä½  GitHub çš„ç™»å½•å¯†ç ï¼Œè€Œæ˜¯éœ€è¦ç”Ÿæˆä¸€ä¸ª access tokens ç”Ÿæˆ access token éœ€è¦åœ¨ GitHub ä¸ªäººè®¾ç½®é¡µ -&gt; Settings -&gt; Developer Settings -&gt; Personal access tokens ä¸­åˆ›å»ºä¸€ä¸ª token Generate new token ç”Ÿæˆæ–°çš„ token è®¾ç½® token çš„æœ‰æ•ˆæœŸ æŒ‰éœ€è®¾ç½®ï¼Œè®¿é—®æƒé™ç­‰ é€‰æ‹©è¦æˆäºˆä»¤ç‰Œtokençš„èŒƒå›´æˆ–æƒé™ è¦ä½¿ç”¨tokenä»å‘½ä»¤è¡Œè®¿é—®ä»“åº“ï¼Œè¯·é€‰æ‹©repo è¦ä½¿ç”¨tokenä»å‘½ä»¤è¡Œåˆ é™¤ä»“åº“ï¼Œè¯·é€‰æ‹©delete_repo å…¶ä»–æ ¹æ®éœ€è¦è¿›è¡Œå‹¾é€‰ ç‚¹å‡» Generate token ç”Ÿæˆ token ghp_VcqgAmF...ZPJ2IGxu0 ã€æ³¨ã€‘ï¼šè®°å¾—æŠŠè¿™ä¸ª token ä¿å­˜ä¸‹æ¥ï¼Œå› ä¸ºä¸‹æ¬¡å†åˆ·æ–°è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œä½ ä¼šçœ‹ä¸åˆ°äº† åœ¨å‘½ä»¤è¡Œè¾“å…¥å®Œ token å¯†ç  123456789101112Username for &#x27;https://github.com&#x27;: BboyZJPassword for &#x27;https://BboyZJ@github.com&#x27;: Enumerating objects: 91, done.Counting objects: 100% (91/91), done.Delta compression using up to 4 threadsCompressing objects: 100% (83/83), done.Writing objects: 100% (91/91), 29.35 KiB | 2.45 MiB/s, done.Total 91 (delta 23), reused 0 (delta 0), pack-reused 0remote: Resolving deltas: 100% (23/23), done.To https://github.com/BboyZJ/ZJWeakProxy.git * [new branch] main -&gt; mainbranch &#x27;main&#x27; set up to track &#x27;origin/main&#x27;. ç”±ä¸Šé¢çœ‹ä»£è¡¨ä¸Šä¼ æˆåŠŸäº† æ‰“å¼€æµè§ˆå™¨ https://github.com/BboyZJ/ZJWeakProxy ï¼Œå°±å¯ä»¥çœ‹åˆ°ä½ çš„podåº“å·²ç»pushä¸Šå»äº† æ‰“ tag å¹¶å‘å¸ƒåˆ° Cocoapodsè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå°†æœ¬åœ°çš„ä»“åº“å…³è”å¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å‘å¸ƒä¸€ä¸ªå¯ç”¨çš„ç»„ä»¶ é¦–å…ˆæˆ‘ä»¬è¦ç»™å½“å‰é¡¹ç›®æ‰“ä¸€ä¸ª tag ç‰ˆæœ¬å·ï¼Œåœ¨ podspec ä¸­ï¼š 1s.version = &#x27;0.1.0&#x27; æŒ‡å®šçš„ç‰ˆæœ¬å·æ˜¯ 0.1.0 ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åŒæ ·æ‰“ä¸ª 0.1.0 çš„ tag 1234// æ‰“ tag mac@bogon ZJWeakProxy % git tag 0.1.0// æ¨é€åˆ°è¿œç¨‹mac@bogon ZJWeakProxy % git push --tags æ‰“ tag é»˜è®¤åœ¨å½“å‰åˆ†æ”¯ä¸Šï¼Œè¿™é‡Œåªæœ‰ master ï¼Œæ‰€ä»¥ä¸ç”¨åˆ‡æ¢åˆ†æ”¯ å‘å¸ƒåˆ° cocoapods æˆ‘ä»¬åˆ›å»ºçš„é¡¹ç›®ä»¥åŠæ ‡ç­¾ç‰ˆæœ¬å·éƒ½æ˜¯æ²¿ç”¨äº† podspec æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥ç›´æ¥éªŒè¯ podspec æ–‡ä»¶ä¿¡æ¯æ˜¯å¦å¯ä»¥é€šè¿‡éªŒè¯ï¼Œpodspec æ–‡ä»¶çš„ç‰ˆæœ¬å·ä¸€å®šè¦å’Œ tag ä¿æŒä¸€è‡´ 1mac@bogon ZJWeakProxy % pod spec link å¦‚æœé€šè¿‡éªŒè¯ï¼Œé‚£ä¹ˆä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„æç¤ºï¼Œç»¿è‰²çš„ passed validation é¦–å…ˆè¦é€šè¿‡ trunk æ³¨å†Œç”Ÿæˆä¸€æ¡ä¼šè¯ï¼š 12// pod trunk register é‚®ç®± ç”¨æˆ·å æè¿°mac@bogon ZJWeakProxy % pod trunk register 13718004742@163.com BboyZJ --description=ZJWeakProxyç»„ä»¶ ç„¶åå»é‚®ç®±è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æˆåŠŸä¼šå‡ºç°ä¸‹é¢é¡µé¢ï¼š ç°åœ¨ï¼Œå°±å¯ä»¥å°† podspec æäº¤ç»™ CocoaPods äº†ã€‚è¿™ä¸ªæ–‡ä»¶å°†æ˜¯åˆ«äººæœç´¢ä½ çš„ç»„ä»¶çš„ç´¢å¼•ã€‚ 1mac@bogon ZJWeakProxy % pod trunk push ZJWeakProxy.podspec --allow-warnings pod search ç»„ä»¶å ä¸Šä¼ å®Œæˆä¹‹åï¼Œæ¥å¯ä»¥é€šè¿‡ pod search ZJWeakProxy æœç´¢åˆ°è‡ªå·±çš„ç»„ä»¶äº†ï¼Œå¦‚æœæœç´¢ä¸åˆ°ï¼Œåˆ é™¤æœ¬åœ°çš„æœç´¢æ–‡ä»¶ï¼Œå‘½ä»¤ ï¼š 1mac@bogon ZJWeakProxy % rm ~/Library/Caches/CocoaPods/search_index.json é‡æ–° search äº§ç”Ÿæ–°çš„æœç´¢æ–‡ä»¶ï¼Œå‘å¸ƒæ–°ç‰ˆæœ¬åˆ™éœ€è¦æ‰“æ–°çš„ tagï¼Œé‡æ–°ç¼–è¾‘ podspec æ–‡ä»¶ï¼Œç„¶åå†æ¬¡æäº¤ç»™ CocoaPodsã€‚ é›†æˆåˆ°å®¿ä¸»å·¥ç¨‹ç»è¿‡ä¸Šé¢çš„æ“ä½œæˆ‘ä»¬å·²ç»å®Œæˆäº†ç»„ä»¶çš„åˆ›å»ºå’Œå‘å¸ƒï¼Œä¹Ÿæ”¯æŒäº† Cocoapods çš„é›†æˆã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦å°†è¯¥ç»„ä»¶é›†æˆåˆ°å®¿ä¸»å·¥ç¨‹ä¸­å»ï¼Œä½¿ç”¨æ–¹å¼å’Œé›†æˆä¸‰æ–¹åº“æ˜¯ä¸€æ ·çš„ã€‚ æ–°å»ºä¸ªå¸¦ pod çš„é¡¹ç›® Demoï¼ŒæŠŠæˆ‘ä»¬åšå¥½çš„ ZJWeakProxy åŠ å…¥ podfile æ–‡ä»¶ 12345678910111213# Uncomment the next line to define a global platform for your projectplatform :ios, &#x27;10.0&#x27;target &#x27;ZJWeakProxy-Demo&#x27; do # Comment the next line if you don&#x27;t want to use dynamic frameworks use_frameworks! # ZJWeakProxy pod &#x27;ZJWeakProxy&#x27;,:git =&gt;&quot;https://github.com/BboyZJ/ZJWeakProxy.git&quot; # Pods for ZJWeakProxy-Demoend æ‰§è¡Œ pod install mac@bogon ZJWeakProxy-Demo % pod install ã€é—®é¢˜1ã€‘å®‰è£…æŠ¥é”™ï¼š[!] Unable to find a specification for ZJWeakProxy è§£å†³åŠæ³•ï¼š mac@bogon ZJWeakProxy-Demo % pod repo update --verbose ã€é—®é¢˜2ã€‘ï¼šHTTP&#x2F;2 stream 1 was not closed cleanly before end of the underlying stream è§£å†³åŠæ³•ï¼šæ›´æ”¹é»˜è®¤é€šä¿¡åè®® mac@bogon ZJWeakProxy-Demo % git config --global http.version HTTP/1.1 å¼•å…¥å¤´æ–‡ä»¶å¹¶æ‰“å°ç»“æœ ç‰ˆæœ¬æ›´æ–°ä¸ç»´æŠ¤ ç°åœ¨çš„ ZJWeakProxy åº“å·²ç»åœ¨GitHubä¸Šæ‰˜ç®¡äº†ï¼Œä»¥åç»´æŠ¤è¿™ä¸ªé¡¹ç›®å°±å¯ä»¥äº†ï¼ˆå¼€å§‹æœ¬åœ°åˆ›å»ºçš„ZJWeakProxyé¡¹ç›®å°±å¯ä»¥åˆ é™¤äº†ï¼‰ï¼Œç®¡ç†GitHubä»“åº“ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œ git clone https://github.com/BboyZJ/ZJWeakProxy ä¹Ÿå¯ä»¥ä½¿ç”¨ GitHub Desktop ä¸‹è½½ GitHub Desktop ç™»å½•ä½ çš„ç”¨æˆ·åå’Œå¯†ç ï¼ŒFile -&gt; Responsitory å…¶å® GitHub Desktop æ›´åŠ å¯è§†åŒ–ä¸€äº›ï¼Œä¸Šé¢Historyå°±æ˜¯åˆšæ‰gitå‘½ä»¤è¡Œçš„è®°å½• æ€»ç»“ç»ˆäºå†™å®Œäº†ï¼Œå“‡å“¦ğŸ˜®ï¼","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"OCç»„ä»¶åŒ–04ï¼šã€æ–¹æ¡ˆä¸€ã€‘æœ¬åœ°ç»„ä»¶åŒ–","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–04ï¼šã€æ–¹æ¡ˆä¸€ã€‘æœ¬åœ°ç»„ä»¶åŒ–","date":"2023-03-04T15:27:35.000Z","updated":"2023-03-04T15:31:43.723Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–04ï¼šã€æ–¹æ¡ˆä¸€ã€‘æœ¬åœ°ç»„ä»¶åŒ–/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9604%EF%BC%9A%E3%80%90%E6%96%B9%E6%A1%88%E4%B8%80%E3%80%91%E6%9C%AC%E5%9C%B0%E7%BB%84%E4%BB%B6%E5%8C%96/","excerpt":"","text":"å‰è¨€ æœ¬åœ°ç»„ä»¶åŒ–ï¼šä¸»è¦æ˜¯é€šè¿‡åœ¨ å·¥ç¨‹ä¸­åˆ›å»ºlibraryï¼Œåˆ©ç”¨ cocoapods çš„ workspec è¿›è¡Œæœ¬åœ°ç®¡ç†ï¼Œä¸éœ€è¦å°†é¡¹ç›®ä¸Šä¼ gitï¼Œè€Œæ˜¯ç›´æ¥åœ¨æœ¬é¡¹ç›®ä¸­ä»¥ framework çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ åˆ›å»ºä¸»å·¥ç¨‹ é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º Modularization çš„å·¥ç¨‹ é›†æˆ cocoapodsï¼Œè¿›è¡Œæœ¬åœ°ç®¡ç† 1234zhangjian@zhangjiandeMBP ~ % cd /Users/zhangjian/Desktop/Modularization zhangjian@zhangjiandeMBP Modularization % pod initIgnoring ffi-1.13.1 because its extensions are not built. Try: gem pristine ffi --version 1.13.1zhangjian@zhangjiandeMBP Modularization % pod install åˆ›å»ºç»„ä»¶å‡è®¾æœ‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å— ä¸»å·¥ç¨‹ï¼šæ‰¿è½½ä¸»è¦çš„è¡¨å±‚ä¸šåŠ¡ä»£ç  Coreï¼šç‹¬ç«‹å­˜åœ¨ï¼Œåº”ç”¨åŠ å¯†ã€æ¥å£è¯·æ±‚ç­‰æ•æ„Ÿä»£ç  Baseï¼šåŸºç±»å°è£…ï¼Œæ‹“å±•ï¼ŒåŸºæœ¬çš„æ•°æ®å¤„ç† Serviceï¼šæœåŠ¡å±‚ï¼Œå°è£…ä¸šåŠ¡å·¥å…·ç±»ï¼Œä¾‹å¦‚ç½‘ç»œå±‚æœåŠ¡ã€æŒä¹…åŒ–æœåŠ¡ç­‰ Podsï¼šä¸‰æ–¹ä¾èµ– å…¶ä¸­ï¼Œå„ä¸ªæ¨¡å—é—´çš„å…³ç³»å¦‚ä¸‹å›¾ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¿›è¡Œæ¨¡å—çš„åˆ›å»ºï¼Œä»¥ Core æ¨¡å—ä¸ºä¾‹ï¼š é€‰æ‹© File -&gt; new -&gt; project -&gt; iOS -&gt; Frameworkï¼Œæ–°å»ºä¸€ä¸ª ZJCore æ¨¡å— é€‰æ‹©æ­£ç¡®çš„ Group å’Œ WorkSpaceï¼ˆè¿™é‡Œæ³¨æ„ï¼šåˆ›å»ºçš„ library æœ€å¥½æ”¾åœ¨ ä¸»å·¥ç¨‹æ ¹ç›®å½•ä¸‹ï¼Œå¦åˆ™åç»­çš„ podfile æ‰§è¡Œ pod install ä¼šæŠ¥é”™ï¼‰ åˆ›å»ºæˆåŠŸåï¼Œçœ‹åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š å°†åˆ›å»ºçš„ library çš„ Build Settings -&gt; Mach-O Type ä¿®æ”¹ä¸ºé™æ€åº“ Static Library ä¸»å·¥ç¨‹è°ƒç”¨Library åœ¨ ZJCore ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä»£ç  1234567@interface ZJCoreSetting : NSObject// å£°æ˜å±æ€§@property (nonatomic,copy)NSString * name;@end@implementation ZJCoreSetting@end åœ¨ Build Phases -&gt; Headers -&gt; Public ä¸­å°†æ–°å»ºçš„æ–‡ä»¶æ‹–æ‹½åˆ° Puclic ä¸­ï¼Œè¿™æ ·ä¸»å·¥ç¨‹æ‰èƒ½è®¿é—®è¯¥æ–‡ä»¶ åœ¨ZJCoreæ–‡ä»¶ä¸­æ·»åŠ å¼•ç”¨ åœ¨ä¸»å·¥ç¨‹ä¸­ï¼Œé€‰æ‹© target -&gt; Frameworks,Libraries,and Embedded Content -&gt; + å· -&gt; æ·»åŠ  ZJCoreï¼Œåªéœ€è¦buildä¸»å·¥ç¨‹ï¼Œlibraryèƒ½å¤Ÿè‡ªåŠ¨è”ç¼– ä½¿ç”¨é¦–å…ˆ #import &lt;ZJCore/ZJCoreSetting.h&gt;ï¼Œç„¶åä½¿ç”¨ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­libraryä¹‹é—´çš„äº’ç›¸è°ƒç”¨ï¼Œä¸ä¸»å·¥ç¨‹è°ƒç”¨libraryç±»ä¼¼ï¼Œä¸»éœ€è¦æ·»åŠ ä¾èµ–ã€æš´éœ²headerå³å¯","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"OCç»„ä»¶åŒ–03ï¼šé¢å‘åè®®Protocol Classçš„ä½¿ç”¨","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–03ï¼šé¢å‘åè®®Protocol-Classçš„ä½¿ç”¨","date":"2023-03-04T08:16:42.000Z","updated":"2023-03-04T14:56:27.815Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–03ï¼šé¢å‘åè®®Protocol-Classçš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9603%EF%BC%9A%E9%9D%A2%E5%90%91%E5%8D%8F%E8%AE%AEProtocol-Class%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"é¢å‘åè®® Protocol Class åœ¨ URL Schemeè·¯ç”± å’Œ target-action æ–¹æ¡ˆä¸­ï¼Œéƒ½å­˜åœ¨ ç¡¬ç¼–ç ã€å‚æ•°ä¸æ˜ç¡®é—®é¢˜ï¼šURL ã€Target_ ã€ Action_ çš„ç¡¬ç¼–ç ï¼Œå‚æ•°éƒ½æ˜¯é€šè¿‡å­—å…¸çš„å½¢å¼ä¼ é€’ï¼Œç±»å‹ä¸æ˜ç¡®ã€‚ é¢å‘æ¥å£ çš„æ–¹å¼èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚ å®ç°æ–¹å¼ ä¸­é—´ä»¶å…ˆæ³¨å†Œ Protocol å’Œ Class å¯¹åº”å…³ç³»ï¼Œå°† protocol å’Œ å¯¹åº”çš„ç±» è¿›è¡Œ å­—å…¸ åŒ¹é… ä¸­é—´ä»¶è¿”å› Protocol å¯¹åº”çš„ Classï¼Œç„¶ååŠ¨æ€åˆ›å»ºå®ä¾‹ ä¼˜ç‚¹ é¢å‘åè®®ç¼–ç¨‹ å®‰å…¨æ€§é«˜ æ¨¡å—è§£è€¦ ç¼ºç‚¹ æ— æ³•å¤šç«¯é€šç”¨ éœ€è¦è¿›è¡Œåè®®çš„æ³¨å†Œ ç¤ºä¾‹ åˆ›å»º ZJProtocol.h åè®®ç±»æ–‡ä»¶ 12345678910// å°†å„ä¸ªæ¨¡å—çš„åè®®ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ ï¼Œåœ¨å„ä¸ªæ¨¡å—ä¸­ä¾èµ–è¿™ä¸ªæ–‡ä»¶ï¼Œå®ç°å…¶åè®®@protocol OneMoudleProtocol &lt;NSObject&gt;@required // è¿”å›æ¨¡å—one+ (UIViewController *)oneMoudleVC;@end@protocol OneDetailMoudleProtocol &lt;NSObject&gt;@required+ (UIViewController *)oneDetailMoudleVCWithParas:(NSDictionary *)paras;@end åˆ›å»º ZJMediator åè®®ç®¡ç†ç±» ZJMediator.h æ–‡ä»¶ä¸‹ï¼š 12345678@interface ZJMediator : NSObject// å•ä¾‹+ (instancetype)shareManager;// æ³¨å†Œç»‘å®š- (void)registerProtocol:(Protocol *)protocol class:(Class)cls;// è·å–ç±»- (Class)classFromProtocol:(Protocol *)protocol;@end ZJMediator.m æ–‡ä»¶ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132#import &quot;ZJMediator.h&quot;@interface ZJMediator ()@property (nonatomic,strong)NSMutableDictionary * protocolCache;@end@implementation ZJMediator+ (instancetype)shareManager&#123; static ZJMediator * mediator; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; mediator = [[ZJMediator alloc] init]; &#125;); return mediator;&#125;// æ³¨å†Œç»‘å®š- (void)registerProtocol:(Protocol *)protocol class:(Class)cls&#123; if (protocol &amp;&amp; cls) &#123; [self.protocolCache setObject:cls forKey:NSStringFromProtocol(protocol)]; &#125;&#125;// è·å–ç±»- (Class)classFromProtocol:(Protocol *)protocol&#123; return [self.protocolCache objectForKey:NSStringFromProtocol(protocol)];&#125;// æ‡’åŠ è½½- (NSMutableDictionary *)protocolCache&#123; if (!_protocolCache) &#123; _protocolCache = @&#123;&#125;.mutableCopy; &#125; return _protocolCache;&#125;@end åˆ›å»º OneDetailMoudleEntry æ¨¡å— 123456789101112131415161718#import &quot;OneDetailMoudleEntry.h&quot;#import &quot;ZJOneDetailViewController.h&quot;@interface OneDetailMoudleEntry ()&lt;OneDetailMoudleProtocol&gt;@end@implementation OneDetailMoudleEntry+ (void)load&#123; [[ZJMediator shareManager] registerProtocol:@protocol(OneDetailMoudleProtocol) class:[self class]];&#125;// ç»§æ‰¿+ (UIViewController *)WithParas:(NSDictionary *)paras&#123; ZJOneDetailViewController * detailVC = [[ZJOneDetailViewController alloc] init]; detailVC.name = paras[@&quot;name&quot;]; detailVC.age = params[@&quot;age&quot;]; return detailVC;&#125;@end åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ 1234567//ä¸‹ä¸€é¡µçš„ç‚¹å‡»äº‹ä»¶- (void)next:(UIButton *)sender&#123; Class cls = [[ZJMediator shareManager] classFromProtocol:@protocol(OneDetailMoudleProtocol)]; UIViewController * detailVC = [cls oneDetailMoudleVCWithParas:@&#123;@&quot;name&quot;:@&quot;ZJ&quot;,@&quot;age&quot;:30&#125;]; [self.navigationController pushViewController:detailVC animated:YES];&#125;","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"OCç»„ä»¶åŒ–03ï¼šåŸºäºRuntTimeçš„target-actionçš„ä½¿ç”¨","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–03ï¼šåŸºäºRuntTimeçš„target-actionçš„ä½¿ç”¨","date":"2023-03-04T08:16:13.000Z","updated":"2023-03-04T15:12:11.241Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–03ï¼šåŸºäºRuntTimeçš„target-actionçš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9603%EF%BC%9A%E5%9F%BA%E4%BA%8ERuntTime%E7%9A%84target-action%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€target action æ˜¯åˆ©ç”¨ Runtime çš„ performSelector:withObject: æ–¹æ³•è°ƒç”¨ï¼Œæ— éœ€æ³¨å†Œ ä¼˜ç¼º ä¼˜ç‚¹ï¼šæ— éœ€æ³¨å†Œè·¯ç”±ï¼Œé¿å…äº†loadé‡Œæ³¨å†Œå½±å“å¯åŠ¨é€Ÿåº¦ ä¸ç”¨ç»´æŠ¤å…¨å±€è·¯ç”±è¡¨ï¼Œé¿å…äº†æŸ¥æ‰¾å¯¹åº”è·¯ç”± ç»Ÿä¸€äº†è·¯ç”±å…¥å£ è¿›è¡Œäº†ä¸€å®šçš„å®‰å…¨å¤„ç† ç¼ºç‚¹ ç¼ºç‚¹ï¼šä¸èƒ½å¤šç«¯ä½¿ç”¨åŒä¸€å¥—è·¯ç”±H5ï¼ŒAndroid å¢åŠ äº†æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨è·å–targetï¼Œselæ—¶å­˜åœ¨ä¸€å®šçš„ç¡¬ç¼–ç  ç¤ºä¾‹ï¼š","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"OCç»„ä»¶åŒ–02ï¼šåŸºäºURL Schemeçš„ä½¿ç”¨","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–02ï¼šåŸºäºURL-Schemeçš„ä½¿ç”¨","date":"2023-03-04T08:15:30.000Z","updated":"2023-03-04T15:02:44.049Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–02ï¼šåŸºäºURL-Schemeçš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9602%EF%BC%9A%E5%9F%BA%E4%BA%8EURL-Scheme%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"URL Scheme è·¯ç”± ä½¿ URL Scheme å¤„ç†æœ¬åœ°çš„è·³è½¬ é€šè¿‡ä¸­é—´å±‚è¿›è¡Œæ³¨å†Œ &amp; è°ƒç”¨ï¼ˆloadæ–¹æ³•é‡Œé¢æŠŠè¢«è°ƒç”¨è€…æ³¨å†Œåˆ°ä¸­é—´å±‚ï¼‰ å‘½åè§„èŒƒ12//åè®®://ä¸»æœºå[:ç«¯å£]/è·¯å¾„/[?å‚æ•°]#fragment@&quot;lstest://lsapp:11111/china/ls.com?a=1&amp;b=2&quot; lstestï¼šåè®®å lsappï¼šä¸»æœºåï¼Œä¸ºäº†åŒºåˆ† ä¸åŒçš„app ç«¯å£å·ï¼šå¯ä»¥å°†ç«¯å£å·ä½œä¸º æ¨¡å—ID china&#x2F;ls.comï¼šè·¯å¾„ï¼Œå¯ä»¥æ˜¯è·³è½¬åˆ°æ¨¡å—çš„ æŒ‡å®šé¡µé¢ a&#x3D;1&amp;b&#x3D;2ï¼šå‚æ•°ï¼Œè·³è½¬çš„å‚æ•° è§£æ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå®ç°ç®€å• ç¼ºç‚¹ï¼šå­˜åœ¨ç¡¬ç¼–ç é—®é¢˜ï¼Œå‚æ•°éƒ½æ˜¯é€šè¿‡å­—å…¸çš„å½¢å¼ä¼ é€’ï¼Œç±»å‹ä¸æ˜ç¡® URL Scheme è·¯ç”±ç¤ºä¾‹æ€è·¯ï¼šBç»„ä»¶ä½¿ç”¨URLå°†Blockæ³¨å†Œç»™è·¯ç”±ï¼Œè·¯ç”±ä»¥URLä¸ºkeyï¼Œå°†Blockå­˜å‚¨èµ·æ¥ã€‚ Aç»„ä»¶é€šè¿‡URLè°ƒç”¨è·¯ç”±çš„æ–¹æ³•ï¼Œæ‰¾åˆ°å¯¹åº”çš„Blockï¼Œå®Œæˆå¯¹Açš„è°ƒç”¨ åˆ›å»ºè·¯ç”± 123456789101112131415161718192021222324252627282930313233#import &quot;ZJRouter.h&quot;@interface ZJRouter ()@property (strong,nonatomic)NSMutableDictionary * blockDic;@end@implementation ZJRouter// å‚æ•° @&#123;@&quot;&quot;:...&#125;+ (instancetype)shareInstance&#123; static ZJRouter * router = nil; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; router = [[self alloc] init]; router.blockDic = @&#123;&#125;.mutableCopy; &#125;); return router;&#125;// æ³¨å†Œ- (void)registerUrl:(NSString *)url block:(ZJRouterBlock)block&#123; if (!url || !block) return; if (block) &#123; self.blockDic[url] = [block copy]; &#125;&#125;// æ‰§è¡Œ- (void)excuteBlockWithUrl:(NSString *)key params:(NSDictionary *)params&#123; if (!key) return; ZJRouterBlock block = self.blockDic[key]; if (!block) return; block(params);&#125;@end B ç»„ä»¶ä¸­æ³¨å†Œ 12345+ (void)load &#123; [[ZJRouter shareInstance] registerUrl:@&quot;A:aTestAction&quot; block:^(NSDictionary * _Nonnull dic) &#123; NSLog(@&quot;dic:%@&quot;,dic); &#125;];&#125; A ç»„ä»¶ä¸­è°ƒç”¨ 1[[ZJRouter shareInstance] excuteBlockWithUrl:@&quot;A:aTestAction&quot; params:@&#123;@&quot;text&quot;:@&quot;æ–‡å­—&quot;&#125;];","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"OCç»„ä»¶åŒ–01ï¼šç»„ä»¶åŒ–ä»‹ç»","slug":"OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–01ï¼šç»„ä»¶åŒ–ä»‹ç»","date":"2023-03-04T06:05:40.000Z","updated":"2023-03-04T15:26:25.315Z","comments":true,"path":"2023/03/04/OCç»„ä»¶åŒ–/OCç»„ä»¶åŒ–01ï¼šç»„ä»¶åŒ–ä»‹ç»/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/OC%E7%BB%84%E4%BB%B6%E5%8C%96/OC%E7%BB%84%E4%BB%B6%E5%8C%9601%EF%BC%9A%E7%BB%84%E4%BB%B6%E5%8C%96%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"ä»€ä¹ˆç»„ä»¶åŒ– ç»„ä»¶åŒ–å…¶å®å°±æ˜¯ å°†æ¨¡å—å•ç‹¬æŠ½ç¦»ã€åˆ†å±‚ï¼Œå¹¶æŒ‡å®šæ¨¡å—é—´çš„ é€šè®¯ æ–¹å¼ï¼Œä»è€Œå®ç° è§£è€¦ çš„ä¸€ç§æ–¹å¼ï¼Œä¸»è¦è¿ç”¨ä¸å›¢é˜Ÿå¼€å‘ ç»„ä»¶åŒ–å¼€å‘å°±æ˜¯å°†ä¸€ä¸ªè‡ƒè‚¿çš„ã€å•ä¸€çš„é¡¹ç›®ï¼Œæ ¹æ® åŠŸèƒ½/ä¸šåŠ¡/æŠ€æœ¯ ç­‰è¿›è¡Œæ‹†åˆ†ï¼Œå½¢æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„åŠŸèƒ½ç»„ä»¶ï¼Œç„¶åå€ŸåŠ© Cocoapods ç®¡ç†å·¥å…·å°†å…¶ä»»æ„ç»„åˆï¼Œé›†æˆä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ã€‚ ä½ å¯ä»¥å°† AFNetworkingã€SDWebImageã€Buglyã€MLeaksFinder ç­‰ä¸‰æ–¹åº“ç†è§£ä¸ºå·¥ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå±äº åŸºç¡€ç»„ä»¶æ¨¡å—ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†é¡¹ç›®åˆ’åˆ†å¤šä¸ªç‹¬ç«‹åŠŸèƒ½æ¨¡å—ï¼Œå†é›†æˆä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ã€‚ ä¸ºä»€ä¹ˆè¦ç»„ä»¶åŒ–ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹å››ä¸ªåŸå›  æ¨¡å—é—´è§£è€¦ æ¨¡å—é‡ç”¨ æé«˜å›¢é˜Ÿåä½œå¼€å‘æ•ˆç‡ å•å…ƒæµ‹è¯• å½“é¡¹ç›®å› ä¸ºå„ç§éœ€æ±‚ï¼Œæ¨¡å—è¶Šæ¥è¶Šå¤šæ—¶ï¼Œå¦‚æœæ­¤æ—¶çš„å„ä¸ªæ¨¡å—ä¹‹é—´æ˜¯äº’ç›¸è°ƒç”¨çš„ï¼Œå³ ä½ ä¸­æœ‰æˆ‘ï¼Œæˆ‘ä¸­æœ‰ä½  è¿™ç§æƒ…å†µæ—¶ï¼Œä¼šé€ æˆ é«˜è€¦åˆ çš„æƒ…å†µï¼Œä¸€æ—¦æˆ‘ä»¬éœ€è¦å¯¹æŸä¸€æ¨¡å—ä»£ç è¿›è¡Œ ä¿®æ”¹ æ—¶ï¼Œå°±ä¼š ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå¯¼è‡´é¡¹ç›®éš¾ä»¥ç»´æŠ¤ å…¶é—®é¢˜ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š ä¿®æ”¹æŸä¸ªåŠŸèƒ½æ—¶ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹å…¶ä»–æ¨¡å—çš„ä»£ç ï¼Œå› ä¸ºåœ¨å…¶ä»–æ¨¡å—ä¸­æœ‰è¯¥æ¨¡å—çš„å¼•ç”¨ï¼Œå¯ä»¥ç†è§£ä¸º é«˜è€¦åˆå¯¼è‡´ä»£ç ä¿®æ”¹å›°éš¾ æ¨¡å—å¯¹å¤–æ¥å£ä¸æ˜ç¡®ï¼Œç”šè‡³æš´éœ²äº†æœ¬ä¸è¯¥æš´éœ²çš„ç§æœ‰æ¥å£ï¼Œä¿®æ”¹æ—¶è´¹æ—¶è´¹åŠ›ã€‚å¯ä»¥ç†è§£ä¸º æ¥å£ä¸å›ºå®šå¯¼è‡´çš„æ¥å£æ··ä¹± é«˜è€¦åˆä»£ç äº§ç”Ÿçš„åæœå°±æ˜¯ä¼šå½±å“å›¢é˜Ÿå…¶ä»–æˆå‘˜çš„å¼€å‘ï¼Œäº§ç”Ÿ ä»£ç å†²çª å½“æ¨¡å—éœ€è¦é‡ç”¨åˆ°å…¶ä»–é¡¹ç›®æ—¶ï¼Œéš¾ä»¥å•ç‹¬æŠ½ç¦» æ¨¡å—é—´è€¦åˆçš„å¿Œå£å¯¼è‡´æ¥å£å’Œä¾èµ–å…³ç³»æ··ä¹±ï¼Œæ— æ³•è¿›è¡Œå•å…ƒæµ‹è¯• æ‰€ä»¥ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨æ›´è§„èŒƒçš„æ–¹å¼æ¥ é™ä½æ¨¡å— é—´çš„ è€¦åˆåº¦ï¼Œè¿™å°±æ˜¯ ç»„ä»¶åŒ–ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸º æ¨¡å—åŒ– ä½†æ˜¯ï¼Œè¿™é‡Œè¿˜éœ€è¦è¯´æ˜ä¸€ç‚¹ï¼Œå› ä¸ºç»„ä»¶åŒ–ä¹Ÿæ˜¯éœ€è¦ä¸€å®šæˆæœ¬çš„ï¼Œéœ€è¦èŠ±è´¹æ—¶é—´è®¾è®¡æ¥å£ã€åˆ†ç¦»ä»£ç ç­‰ï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡¹ç›®éƒ½éœ€è¦ç»„ä»¶åŒ–ã€‚å¦‚æœä½ çš„é¡¹ç›®æœ‰ä»¥ä¸‹è¿™äº›ç‰¹å¾å°± ä¸éœ€è¦ç»„ä»¶åŒ–ï¼š é¡¹ç›®è¾ƒå°ï¼Œæ¨¡å—é—´äº¤äº’ç®€å•ï¼Œè€¦åˆå°‘ é¡¹ç›®æ²¡æœ‰è¢«å¤šä¸ªå¤–éƒ¨æ¨¡å—å¼•ç”¨ï¼Œåªæ˜¯ä¸€ä¸ªå•ç‹¬çš„å°æ¨¡å— æ¨¡å—ä¸éœ€è¦é‡ç”¨ï¼Œä»£ç ä¹Ÿå¾ˆå°‘è¢«ä¿®æ”¹ å›¢é˜Ÿè§„æ¨¡å¾ˆå° ä¸éœ€è¦ç¼–å†™å•å…ƒæµ‹è¯• å¦‚æœä½ çš„æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼Œè¯´æ˜ä½ å°±å¿…é¡»è¦ è€ƒè™‘è¿›è¡Œç»„ä»¶åŒ– äº†ï¼š æ¨¡å—é€»è¾‘å¤æ‚ï¼Œå¤šä¸ªæ¨¡å—ä¹‹é—´é¢‘ç¹äº’ç›¸å¼•ç”¨ é¡¹ç›®è§„æ¨¡é€æ¸å˜å¤§ï¼Œä¿®æ”¹ä»£ç å˜çš„è¶Šæ¥è¶Šå›°éš¾ï¼ˆè¿™é‡Œå¯ä»¥ç†è§£ä¸ºï¼šä¿®æ”¹ä¸€å¤„ä»£ç ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹å…¶ä»–å¤šä¸ªåœ°æ–¹ï¼‰ å›¢é˜Ÿäººæ•°å˜å¤šï¼Œæäº¤ä»£ç ç»å¸¸å’Œå…¶ä»–æˆå‘˜å†²çª é¡¹ç›®ç¼–è¯‘è€—æ—¶è¾ƒå¤§ æ¨¡å—çš„å•å…ƒæµ‹è¯•ç»å¸¸ç”±äºå…¶ä»–æ¨¡å—çš„ä¿®æ”¹è€Œå¤±è´¥ ç»„ä»¶åŒ–æ–¹æ¡ˆç»„ä»¶åŒ–æ–¹æ¡ˆçš„8æ¡æŒ‡æ ‡ï¼š ä¸€ä¸ªé¡¹ç›®ç»è¿‡ç»„ä»¶åŒ–åå¦‚ä½•æ¥è¯„åˆ¤ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ª æ ‡å‡†ï¼š æ¨¡å—ä¹‹é—´æ²¡æœ‰è€¦åˆï¼Œæ¨¡å—å†…éƒ¨çš„ä¿®æ”¹ä¸ä¼šå½±å“å…¶ä»–æ¨¡å— æ¨¡å—å¯ä»¥å•ç‹¬ç¼–è¯‘ æ¨¡å—é—´æ•°æ®ä¼ é€’æ˜ç¡® æ¨¡å—å¯¹å¤–æ¥å£æ¸…æ™°ä¸”æ˜“ç»´æŠ¤ å½“æ¨¡å—æ¥å£æ”¹å˜æ—¶ï¼Œæ­¤æ¨¡å—çš„å¤–éƒ¨ä»£ç èƒ½å¤Ÿè¢«é«˜æ•ˆé‡æ„ å°½é‡ç”¨æœ€å°‘çš„ä¿®æ”¹å’Œä»£ç ï¼Œè®©ç°æœ‰é¡¹ç›®å®ç°æ¨¡å—åŒ– æ”¯æŒOCå’ŒSwiftï¼Œä»¥åŠæ··ç¼– å‰4æ¡ä¸»è¦ç”¨äº è¡¡é‡ä¸€ä¸ªæ¨¡å—æ˜¯å¦çœŸæ­£è§£è€¦ï¼Œå4æ¡ä¸»è¦ç”¨äºè¡¡é‡åœ¨é¡¹ç›®ä¸­ å®è·µä¸­çš„æ˜“ç”¨ç¨‹åº ç»„ä»¶åŒ–åŸåˆ™ ä¸€ä¸ªé¡¹ç›®ä¸»è¦åˆ†ä¸º3å±‚ï¼šä¸šåŠ¡å±‚ã€é€šç”¨å±‚ ä»¥åŠ åŸºç¡€å±‚ï¼Œåœ¨è¿›è¡Œç»„ä»¶åŒ–æ—¶ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ åªèƒ½ä¸Šå±‚å¯¹ä¸‹å±‚ä¾èµ–ï¼Œä¸èƒ½ä¸‹å±‚å¯¹ä¸Šå±‚ä¾èµ–ï¼Œå› ä¸ºä¸‹å±‚æ˜¯å¯¹ä¸Šå±‚çš„æŠ½è±¡ é¡¹ç›®å…¬å…±ä»£ç èµ„æºä¸‹æ²‰ æ¨ªå‘çš„ä¾èµ–å°½é‡å‡å°‘ï¼Œæœ€å¥½ä¸‹å±‚è‡³é€šç”¨æ¨¡å—ï¼Œæˆ–è€…åŸºç¡€æ¨¡å— ç»„ä»¶åŒ–å’Œéç»„ä»¶åŒ–åŒºåˆ«ç»„ä»¶åŒ–èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å°†å¤§éƒ¨åˆ†é¡¹ç›®æ‹†è§£æˆæ•°ä¸ªå°ç»„ä»¶ï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨ç»„ä»¶æ‰€ä¾èµ–çš„å…¶ä»–ç»„ä»¶ï¼Œè€Œæ— éœ€å…³å¿ƒå®Œæ•´é¡¹ç›®çš„å…¶ä»–éƒ¨åˆ†ï¼Œæ¯ä¸ªç»„ä»¶å¯ä»¥è‡ªå·±é‡‡å–æ‰€ä¹ æƒ¯çš„æ¶æ„æ¨¡å¼ï¼šMVCã€MVVMç­‰ï¼Œå°±è¡Œå¼€å‘ä¸€æ¬¾ä¸ªäººç‹¬ç«‹çš„Appé‚£æ ·è‡ªç”± éç»„ä»¶åŒ–ï¼š ä»£ç é«˜è€¦åˆåº¦ã€é«˜ä¾èµ– é¡¹ç›®å¤æ‚ã€è‡ƒè‚¿ã€ç¼–è¯‘æ—¶é—´è¿‡é•¿ï¼ˆå½±å“è°ƒè¯•ï¼‰ éš¾ä»¥èåˆã€é›†æˆå…¶ä»–äº§å“ â€¦ ç»„ä»¶åŒ–ï¼š ä»£ç å¤ç”¨æ€§æé«˜ï¼Œå¯æ–¹ä¾¿é›†æˆåˆ°å…¶ä»–é¡¹ç›® é¡¹ç›®å¯é…ç½®ï¼Œæ–¹ä¾¿é›†æˆå’ŒåŠŸèƒ½å›é€€ æ–¹ä¾¿ç»„ä»¶å¹¶è¡Œå¼€å‘ å¯æ–¹ä¾¿å•å…ƒæµ‹è¯• â€¦ ç»„ä»¶åŒ–åˆ†å±‚é¡¹ç›®ç»„ä»¶åŒ–ï¼Œæœ€éš¾çš„å°±æ˜¯ ç²’åº¦ é—®é¢˜ï¼Œéœ€è¦å¼€å‘è€…æ ¹æ®è‡ªå·±çš„ç»éªŒæŠŠæ§ã€‚è¿™é‡Œç»™å‡ºä¸ªäººè®¤ä¸ºçš„å±‚æ¬¡åˆ’åˆ†ï¼š ã€åŸºç¡€ç»„ä»¶ã€‘ï¼šå®å®šä¹‰&#x2F;å¸¸é‡&#x2F;è‡ªå®šä¹‰å·¥å…·ç±»ï¼Œå¦‚å¸¸ç”¨çš„è‡ªå®šä¹‰åˆ†ç±»ã€åŠŸèƒ½ç»„ä»¶ã€‘ï¼šé¡¹ç›®ä¸­å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå¦‚åœ°å›¾&#x2F;æ¶ˆæ¯æ¨é€&#x2F;åˆ†äº«&#x2F;ç™»å½•ç­‰ã€ä¸šåŠ¡ç»„ä»¶ã€‘ï¼šé¡¹ç›®ä¸­çš„æ¨¡å—&#x2F;ä¸šåŠ¡ï¼Œå¦‚æ–‡ç« è¯¦æƒ…&#x2F;ä¸ªäººä¸­å¿ƒç­‰ã€ä¸­é—´ç»„ä»¶ã€‘ï¼šè´Ÿè´£é¡¹ç›®ä¸­çš„è·¯ç”±&#x2F;æ¶ˆæ¯é€šçŸ¥&#x2F;ä¼ å‚&#x2F;å›è°ƒç­‰ã€å®¿ä¸»å·¥ç¨‹ã€‘ï¼šé¡¹ç›®å®¹å™¨ï¼Œç”¨æ¥é›†æˆç»„ä»¶ï¼Œè°ƒæ•´å„ä¸ªç»„ä»¶ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’å®¹å™¨ ä¸­é—´å±‚å‡ ç§æ–¹æ¡ˆåœ¨ç»„ä»¶åŒ–ä¸­ï¼Œä¸­é—´å±‚æ˜¯å„ä¸ªç»„ä»¶çš„é€šä¿¡æ¡¥æ¢ï¼Œä¸­é—´å±‚åœ¨ç»„ä»¶åŒ–è¿‡ç¨‹ä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ã€‚ ä¸­é—´å±‚çš„ä¸‰ç§æ–¹å¼ï¼š åŸºäº URL Scheme çš„ è·¯ç”± åŸºäº Runtime çš„ target-action é¢å‘æ¥å£ çš„ Protocol - Class åŸºäº URL Scheme çš„ä¸‰æ–¹åº“iOS ä¸­æ”¯æŒçš„ URL Scheme è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨ åº”ç”¨ä¹‹é—´ã€åº”ç”¨å†…éƒ¨ä¼ é€’æ¶ˆæ¯ã€‚ JLRoutes routable-ios HHRouter å…·ä½“æ€ä¹ˆä½¿ç”¨ï¼Œå¯ä»¥è‡ªè¡Œå»æ¢ç´¢ åŸºäº Runtime çš„ target-actionç›¸æ¯” url scheme çš„æå‰æ³¨å†Œã€å®ç°æœåŠ¡ï¼ŒCTMediator å€ŸåŠ© OC è¿è¡Œæ—¶çš„ç‰¹æ€§ï¼Œç°å®ç»„ä»¶ä¹‹é—´æœåŠ¡çš„è‡ªåŠ¨å‘ç°ï¼Œæ— éœ€æå‰æ³¨å†Œå³å¯å®ç°ç»„ä»¶é—´çš„è°ƒç”¨ï¼Œå› æ­¤ï¼Œè¿™ç§æ–¹æ¡ˆçš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§ã€æ‰©å±•æ€§ç›¸å¯¹è¾ƒé«˜ã€‚ CTMediator é¢å‘æ¥å£ Protocol - Class Protocol - Class é¢å‘æ¥å£çš„æ–¹æ¡ˆé€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥ç®¡ç†æ¥å£åè®®çš„ç±»ï¼ˆProtocolManagerï¼‰ï¼Œä¸€ä¸ªæ˜¯å…·ä½“çš„æ¥å£åè®®ï¼ˆComponentProtocolï¼‰ ç»„ä»¶åŒ–çš„æ ¸å¿ƒå·¥å…· ç»„ä»¶åŒ–å·¥ç¨‹ï¼Œéœ€è¦ä¸€ä¸ªå®¿ä¸»å·¥ç¨‹ï¼Œè´Ÿè´£é›†æˆæ‰€æœ‰çš„ç»„ä»¶ã€‚æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„å·¥ç¨‹ï¼Œé€šè¿‡ Git ç§æœ‰ä»“åº“æ¥ç®¡ç†ã€‚ æ‰€æœ‰ç»„ä»¶éƒ½ä¸Šä¼ åˆ° Git ä»“åº“å¹¶æ”¯æŒ cocoapods é›†æˆã€‚ä¸»å·¥ç¨‹é€šè¿‡é…ç½® Podfile æ–‡ä»¶ï¼Œç„¶åä¸€é”® pod update å³å¯ã€‚ä½¿ç”¨ Cocoapods æ¥ç®¡ç†ç»„ä»¶ä¸»è¦å› ä¸ºå…¶æœ¬èº«åŠŸèƒ½å¼ºå¤§ï¼Œæ–¹ä¾¿çš„é›†æˆæ•´ä¸ªé¡¹ç›®ï¼Œè§£æ”¾å¯¹ä¾èµ–åº“çš„ç®¡ç†ã€‚ä½¿ç”¨ç»„ä»¶åŒ–çš„é›†æˆæ–¹å¼ï¼Œå¯ä»¥å¾ˆå¥½çš„é¿å…ä¼ ç»Ÿé¡¹ç›®ä¸­çš„ä»£ç å†²çªé—®é¢˜ã€‚ ç»„ä»¶åŒ–çš„æ ¸å¿ƒå·¥å…·å°±æ˜¯ CocoaPods ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†ç»„ä»¶é¡¹ç›®ä¸Šä¼ åˆ° Giteeç äº‘ æˆ–è€… Gitlabæç‹ï¼Œç¼–å†™é¡¹ç›®çš„ podSpec æ–‡ä»¶è®©ç»„ä»¶æ”¯æŒ CocoaPods é›†æˆå³å¯ã€‚","categories":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}],"tags":[{"name":"ç»„ä»¶åŒ–å¼€å‘","slug":"ç»„ä»¶åŒ–å¼€å‘","permalink":"https://www.bboyzj.cn/tags/%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/"}],"keywords":[{"name":"Component","slug":"Component","permalink":"https://www.bboyzj.cn/categories/Component/"}]},{"title":"Swiftå­¦ä¹ 37ï¼šå¯¹è±¡","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 37ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹","date":"2023-03-03T16:37:01.000Z","updated":"2023-03-09T07:24:50.160Z","comments":true,"path":"2023/03/04/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 37ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹/","link":"","permalink":"https://www.bboyzj.cn/2023/03/04/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A037%EF%BC%9A%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/","excerpt":"","text":"swifté¢å‘å¯¹è±¡æ¦‚è¿°é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ ç»§æ‰¿ å°è£… å¤šæ€ åŸºæœ¬å•å…ƒ æšä¸¾ ç»“æ„ä½“ ç±» åè®® æ‰©å±• é¢å‘å¯¹è±¡æ¦‚è¿° ä»æ•´ä½“åŠŸèƒ½ä¸Šçœ‹ swift çš„æšä¸¾ã€ç»“æ„ä½“ã€ç±»ä¸‰è€…å…·æœ‰å®Œå…¨å¹³ç­‰çš„åœ°ä½ swift çš„ç±»ã€ç»“æ„ä½“ã€æšä¸¾ä¸­éƒ½å¯ä»¥å®šä¹‰ï¼ˆå±æ€§ã€æ–¹æ³•ã€ä¸‹æ ‡ã€æ„é€ ä½“ã€åµŒå¥—ç±»å‹ï¼‰ åœ¨swiftä¸­ï¼Œæšä¸¾å’Œç»“æ„ä½“ æ˜¯ å€¼ç±»å‹ï¼Œç±» æ˜¯ å¼•ç”¨ç±»å‹ ç±»å’Œç»“æ„ä½“çš„ç›¸ä¼¼ç‚¹ å®šä¹‰å±æ€§ç”¨æ¥å­˜å‚¨å€¼ å®šä¹‰æ–¹æ³•ç”¨æ¥æä¾›åŠŸèƒ½ å®šä¹‰ä¸‹æ ‡è„šæœ¬ç”¨æ¥å…è®¸ä½¿ç”¨ä¸‹æ ‡è¯­æ³•è®¿é—®å€¼ å®šä¹‰åˆå§‹åŒ–å™¨ç”¨æ¥åˆå§‹åŒ–çŠ¶æ€ å¯ä»¥è¢«æ‰©å±•æ¥é»˜è®¤æ‰€æ²¡æœ‰çš„åŠŸèƒ½ éµå¾ªåè®®æ¥é’ˆå¯¹ç‰¹å®šç±»å‹æä¾›æ ‡å‡†åŠŸèƒ½ ç±»å’Œç»“æ„ä½“ä¸åŒç‚¹ ç»§æ‰¿å…è®¸ä¸€ä¸ªç±»ç»§æ‰¿å¦ä¸€ä¸ªç±»çš„ç‰¹æ€§ ç±»å‹è½¬æ¢å…è®¸ä½ å†è¿è¡Œæ£€æŸ¥å’Œè§£é‡Šä¸€ä¸ªç±»å®ä¾‹çš„ç±»å‹ ååˆå§‹åŒ–å™¨å…è®¸ä¸€ä¸ªç±»å®ä¾‹é‡Šæ”¾ä»»ä½•å…¶è¢«åˆ†é…çš„èµ„æº å¼•ç”¨è®¡æ•°å™¨å…è®¸ä¸æ­¢ä¸€ä¸ªç±»å¯¹å®ä¾‹çš„å¼•ç”¨","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 36ï¼šå‡½æ•°å¼ç¼–ç¨‹","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 36ï¼šå‡½æ•°å¼ç¼–ç¨‹","date":"2023-03-03T14:56:24.000Z","updated":"2023-03-09T07:24:47.862Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 36ï¼šå‡½æ•°å¼ç¼–ç¨‹/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A036%EF%BC%9A%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/","excerpt":"","text":"èŒƒå¼è½¬æ¢-å‡½æ•°å¼è¯»å…¥ä¸€ä¸ªæ–‡æœ¬ï¼Œç¡®å®šæ‰€æœ‰å•è¯çš„ä½¿ç”¨é¢‘ç‡å¹¶ä»é«˜åˆ°ä½æ’åºï¼Œæ‰“å°å‡ºæ‰€æœ‰å•è¯åŠå…¶é¢‘ç‡çš„æ’åºåˆ—è¡¨ å‘½ä»¤å¼ç¼–ç¨‹ é£æ ¼å°å°è¿«ä½¿æˆ‘ä»¬å‡ºäºæ€§èƒ½è€ƒè™‘ï¼ŒæŠŠä¸åŒçš„ä»»åŠ¡äº¤ç»‡èµ·æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿç”¨ä¸€æ¬¡å¾ªç¯æ¥å®Œæˆå¤šä¸ªä»»åŠ¡ 123456789101112131415161718192021222324252627282930let words = &quot;&quot;&quot;This rectangle defines the size and position of the view in its superviewâ€™s coordinate system.&quot;&quot;&quot;let NON_WORDS = [&quot;e&quot;,&quot;of&quot;,&quot;end&quot;,&quot;on&quot;]func wordFrep(words: String) -&gt; [String:Int] &#123; var wordDict: [String:Int] = [:] // åˆ†å‰²æˆä¸€ä¸ªæ•°ç»„ let wordList = words.split(separator: &quot; &quot;) // éå†æ•°ç»„ for word in wordList &#123; // æ•°ç»„æ¯ä¸ªå…ƒç´ è½¬å°å†™ let lowercaseWord = word.lowercased() // ä¸åŒ…å«å…ƒç´  if !NON_WORDS.contains(lowercaseWord) &#123; // æœ‰count if let count = wordDict[lowercaseWord] &#123; wordDict[lowercaseWord] = count + 1 &#125;else &#123; // æ— count wordDict[lowercaseWord] = 1 &#125; &#125; &#125; return wordDict&#125;print(wordFrep(words:words))============[&quot;and&quot;: 1, &quot;superviewâ€™s&quot;: 1, &quot;system.&quot;: 1, &quot;view&quot;: 1, &quot;defines&quot;: 1, &quot;its&quot;: 1, &quot;coordinate&quot;: 1, &quot;in&quot;: 1, &quot;the&quot;: 2, &quot;rectangle&quot;: 1, &quot;this&quot;: 1, &quot;size&quot;: 1, &quot;position&quot;: 1] è€Œ å‡½æ•°å¼ç¼–ç¨‹ ç”¨ map()ã€filter() è¿™äº›é«˜çº§å‡½æ•°æŠŠæˆ‘ä»¬è§£æ³•å‡ºæ¥ï¼Œè®©æˆ‘ä»¬ç«™åœ¨æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šå»è€ƒè™‘é—®é¢˜ï¼ŒæŠŠé—®é¢˜çœ‹çš„æ›´æ¸…æ¥š 1234567891011121314151617// å‡½æ•°å¼å†™æ³•func wordFrep2(words: String) -&gt; [String:Int] &#123; var wordDict: [String:Int] = [:] // åˆ†å‰²æˆä¸€ä¸ªæ•°ç»„ let wordList = words.split(separator: &quot; &quot;) // mapï¼šå°¾éšé—­åŒ…çš„æ–¹å¼ wordList.map &#123; $0.lowercased() &#125; .filter &#123; !NON_WORDS.contains( $0 ) &#125; .forEach &#123; wordDict[$0] = (wordDict[$0] ?? 0) + 1 &#125; return wordDict&#125;print(wordFrep2(words:words))=============[&quot;view&quot;: 1, &quot;its&quot;: 1, &quot;and&quot;: 1, &quot;defines&quot;: 1, &quot;in&quot;: 1, &quot;the&quot;: 2, &quot;size&quot;: 1, &quot;this&quot;: 1, &quot;position&quot;: 1, &quot;coordinate&quot;: 1, &quot;superviewâ€™s&quot;: 1, &quot;system.&quot;: 1, &quot;rectangle&quot;: 1] å‡½æ•°å¼ç¼–ç¨‹-ç®€æ´ å‡½æ•°å¼ç¼–ç¨‹ç®€æ´ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ é€šè¿‡ å°è£…ä¸ç¡®å®šå› ç´  æ¥ä½¿ä»£ç èƒ½å¤Ÿè¢«äººç†è§£ï¼Œå‡½æ•°å¼ç¼–ç¨‹ é€šè¿‡ å°½é‡å‡å°‘å°‘ä¸ç¡®å®šå› ç´  æ¥ä½¿ä»£ç èƒ½å¤Ÿè¢«äººç†è§£ åœ¨é¢å‘å¯¹è±¡çš„å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€é‡Œï¼Œé‡ç”¨çš„å•å…ƒæ˜¯ç±»å’Œç±»ä¹‹é—´æ²Ÿé€šç”¨çš„æ¶ˆæ¯ å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€å®ç°é‡ç”¨çš„æ€è·¯å¾ˆä¸ä¸€æ ·ã€‚å‡½æ•°å¼è¯­è¨€æå€¡åœ¨æœ‰é™çš„å‡ ç§å…³é”®æ•°æ®ç»“æœï¼ˆå¦‚ï¼šlistã€setã€mapï¼‰ä¸Šè¿ç”¨é’ˆå¯¹è¿™äº›æ•°æ®ç»“æ„é«˜åº¦ä¼˜åŒ–è¿‡çš„æ“ä½œï¼Œä»¥æ­¤æ„å»ºæˆåŸºæœ¬çš„è¿è½¬æœºæ„ã€‚å¼€å‘è€…å†æ ¹æ®å…·ä½“ç”¨é€”ï¼Œæ’å…¥è‡ªå·±çš„æ•°æ®ç»“æ„å’Œé«˜é˜¶å‡½æ•°å»è°ƒæ•´æœºæ„çš„è¿è½¬æ–¹å¼ æ¯”èµ·ä»¥ä¸ºåˆ›å»ºæ–°çš„ç±»ç»“æ„ä½“ç³»ï¼ŒæŠŠå°è£…çš„å…ƒç´ é™ä½åˆ°å‡½æ•°çº§åˆ«ï¼Œæ›´æœ‰åˆ©è¾¾åˆ°ç»†ç²’åº¦çš„ã€åŸºç¡€å±‚é¢çš„é‡ç”¨ å‡½æ•°å¼ç¨‹åºå‘˜å–œæ¬¢ç”¨å°‘æ•°å‡ ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œå›´ç»•å®ƒä»¬å»å»ºç«‹ä¸€å¥—å……åˆ†ä¼˜åŒ–çš„è¿è½¬æœºæ„ã€‚é¢å‘å¯¹è±¡ç¨‹åºå‘˜å–œæ¬¢ä¸æ–­çš„åˆ›å»ºæ–°çš„æ•°æ®ç»“æ„å’Œé™„å±çš„æ“ä½œï¼Œå› ä¸ºå‹å€’ä¸€åˆ‡çš„é¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼å°±æ˜¯å»ºç«‹æ–°çš„ç±»å’Œç±»é—´çš„æ¶ˆæ¯ã€‚æŠŠæ‰€æœ‰çš„æ•°æ®ç»“æ„å°è£…æˆç±»ï¼Œä¸€æ–¹é¢å‹åˆ¶äº†æ–¹æ³•å±‚é¢çš„é‡ç”¨ï¼Œå¦ä¸€æ–¹é¢é¼“åŠ±äº†å¤§ç²’åº¦çš„æ¡†æ¶å¼é‡ç”¨ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„ç¨‹åºç»“æ„æ–¹ä¾¿æˆ‘ä»¬åœ¨æ¯”è¾ƒç»†å°çš„å±‚é¢ä¸Šé‡ç”¨ä»£ç  ä¸šåŠ¡éœ€æ±‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåå­—åˆ—è¡¨ï¼Œå…¶ä¸­ä¸€äº›æ¡ç›®ç”±å•ä¸ªå­—ç¬¦ç»„æˆã€‚ç°åœ¨çš„ä»»åŠ¡æ˜¯ï¼Œå°†é™¤å»å•å­—ç¬¦æ¡ç›®ä¹‹å¤–çš„åˆ—è¡¨å†…å®¹ï¼Œæ”¾åœ¨ä¸€ä¸ªé€—å·åˆ†å‰²çš„å­—ç¬¦ä¸²é‡Œè¿”å›ï¼Œä¸”æ¯ä¸ªåå­—çš„é¦–å­—æ¯éƒ½è¦å¤§å†™ å‘½ä»¤å¼è§£æ³• å‘½ä»¤å¼ç¼–ç¨‹æ˜¯æŒ‰ç…§ ç¨‹åºæ˜¯ä¸€ç³»åˆ—æ”¹å˜çŠ¶æ€çš„å‘½å æ¥å»ºæ¨¡çš„ä¸€ç§ç¼–ç¨‹é£æ ¼ã€‚ä¼ ç»Ÿçš„ for å¾ªç¯æ˜¯å‘½ä»¤å¼é£æ ¼çš„å¥å·ä¾‹å­ 12345678910111213141516let names = [&quot;neal&quot;,&quot;s&quot;,&quot;stu&quot;,&quot;h&quot;,&quot;rich&quot;]func cleanNames(names: Array&lt;String&gt;) -&gt; String &#123; var cleanedNames = &quot;&quot; for name in names &#123; if name.count &gt; 1 &#123; cleanedNames += name.capitalized + &quot;,&quot; &#125; &#125; // å»æ‰æœ€åä¸€ä¸ª, cleanedNames.remove(at: cleanedNames.index(before: cleanedNames.endIndex)) return cleanedNames&#125;print(cleanNames(names: names))==========Neal,Stu,Rich å‡½æ•°å¼è§£æ³• å‡½æ•°å¼ç¼–ç¨‹å°†ç¨‹åºæè¿°ä¸º è¡¨è¾¾å¼å’Œå˜æ¢ï¼Œä»¥æ•°å­¦æ–¹ç¨‹çš„å½¢å¼å»ºç«‹æ¨¡å‹ï¼Œå¹¶ä¸”å°½é‡é¿å…å¯å˜çš„çŠ¶æ€ã€‚ 12345678910111213141516// å‡½æ•°å¼è§£æ³•let names = [&quot;neal&quot;,&quot;s&quot;,&quot;stu&quot;,&quot;h&quot;,&quot;rich&quot;]// è¿‡æ»¤let cleanedNames = names.filter &#123; $0.count &gt; 1 &#125;print(cleanedNames)// é¦–å­—æ¯å¤§å†™let cleanedNames2 = cleanedNames.map &#123; $0.capitalized &#125;print(cleanedNames2)// æ‹¼æ¥let cleanedNames3 = cleanedNames2.joined(separator: &quot;,&quot;)print(cleanedNames3)=========[&quot;neal&quot;, &quot;stu&quot;, &quot;rich&quot;][&quot;Neal&quot;, &quot;Stu&quot;, &quot;Rich&quot;]Neal,Stu,Rich ä¸Šé¢çš„æ–¹å¼è¿˜å¯ä»¥ç®€å†™ï¼š 12345678// ç®€å†™let cleanedName = names.filter &#123; $0.count &gt; 1 &#125; .map &#123; $0.capitalized &#125; .joined(separator: &quot;,&quot;)print(cleanedName)========Neal,Stu,Rich å…·æœ‰æ™®éæ„ä¹‰çš„åŸºæœ¬æ„é€ å•å…ƒ ç­›é€‰ï¼šfilter æ˜ å°„ï¼šmap æŠ˜å &#x2F;åŒ–çº¦ï¼šfoldLeft/reduce ç­‰ swift çš„åŠ£åŠ¿-å¹¶è¡Œ ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ 123456789101112131415161718192021222324252627282930// å‡½æ•°å¼let names = [&quot;neal&quot;,&quot;s&quot;,&quot;stu&quot;,&quot;h&quot;,&quot;rich&quot;,&quot;ff&quot;,&quot;sag&quot;]let cleanedName = names.filter &#123; $0.count &gt; 1 &#125; .map &#123; $0.capitalized &#125; .joined(separator: &quot;,&quot;)print(cleanedName)// æ•°ç»„çš„æ‰©å±•extension Array where Element : Any &#123; // å‡½æ•° public func currentMap&lt;T&gt;(_ transform: (Element) -&gt; T) -&gt; [T] &#123; let n = self.count if n == 0 &#123; return [] &#125; var result = Array&lt;T&gt;() // åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ result.reserveCapacity(n) DispatchQueue.concurrentPerform(iterations: n) &#123; i in result.append(transform(self[i])) &#125; return result &#125;&#125;// å¹¶è¡Œå†™æ³•let cleanedName2 = names.filter &#123; $0.count &gt; 1 &#125; .currentMap &#123; $0.capitalized &#125; .joined(separator: &quot;,&quot;)print(cleanedName2)========Neal,Stu,Rich,Ff,SagStu,Neal,Rich,Ff,Sag æœ‰ç»“æœå¯çŸ¥ï¼šæ‰“å°çš„é¡ºåºä¸åŒï¼Œæˆ–è€…ä¼šå°‘ï¼Œè¯´æ˜çº¿ç¨‹ä¸å®‰å…¨","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 34ï¼šé—­åŒ…","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 34ï¼šé—­åŒ…","date":"2023-03-03T14:56:01.000Z","updated":"2023-03-09T07:24:41.820Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 34ï¼šé—­åŒ…/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A034%EF%BC%9A%E9%97%AD%E5%8C%85/","excerpt":"","text":"é—­åŒ…å’Œé—­åŒ…è¡¨è¾¾å¼é—­åŒ…çš„æ¦‚å¿µ é—­åŒ…æ˜¯å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­è¢« ä¼ é€’å’Œå¼•ç”¨ çš„åŠŸèƒ½æ€§ç‹¬ç«‹ä»£ç å— é—­åŒ…èƒ½å¤Ÿ è¡¥è·å’Œå­˜å‚¨ å®šä¹‰ä¸Šä¸‹æ–‡çš„ä»»ä½• å¸¸é‡å’Œå˜é‡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é—­åˆå¹¶åŒ…è£¹å“ªäº›å¸¸é‡å’Œå˜é‡ï¼Œå› æ­¤æˆä¸º é—­åŒ…ï¼ŒSwiftèƒ½å¤Ÿä¸ºä½ å¤„ç†æ‰€æœ‰å…³äºè¡¥è·çš„å†…å­˜ç®¡ç†æ“ä½œ å…¨å±€å’Œå†…åµŒå‡½æ•°ï¼Œå®é™…ä¸Šæ˜¯ ç‰¹æ®Šçš„é—­åŒ…ã€‚é—­åŒ…ç¬¦åˆä»¥ä¸‹ä¸‰ç§å½¢å¼çš„ä¸€ç§ å…¨å±€å‡½æ•°æ—¶ä¸€ä¸ªæœ‰åå­—ä½†ä¸ä¼šè¡¥è·ä»»ä½•å€¼çš„é—­åŒ… å†…åµŒå‡½æ•°æ—¶ä¸€ä¸ªæœ‰åå­—ä¸”èƒ½ä»å…¶ä¸Šä¸‹å±‚å‡½æ•°è¡¥è·å€¼çš„é—­åŒ… é—­åŒ…è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªè½»é‡çº§è¯­æ³•æ‰€å†™çš„å¯ ä»¥è¡¥è·å…¶ä¸Šä¸‹æ–‡ä¸­å¸¸é‡å’Œå˜é‡å€¼ çš„æ²¡æœ‰åå­—çš„é—­åŒ… é—­åŒ…è¡¨è¾¾å¼ é—­åŒ…è¡¨è¾¾å¼æ˜¯ä¸€ç§åœ¨ç®€çŸ­è¡Œå†…å°±èƒ½å†™å®Œé—­åŒ…çš„è¯­æ³• é—­åŒ…è¡¨è¾¾å¼ä» sorted å‡½æ•°è¯´èµ· swiftæ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªå«åš sorted(by:) çš„æ–¹æ³•ï¼Œä¼šæ ¹æ®ä½ æä¾›çš„ æ’åºé—­åŒ… å°†å·²ç»æ•°ç»„æ’åºï¼Œè¿”å›ä¸€ä¸ªå·²æ’å¥½åºçš„æ–°æ•°ç»„ï¼ŒåŸæ•°ç»„ä¸ä¼šè¢« sorted(by:) æ–¹æ³•ä¿®æ”¹ æ­£åºæ’åˆ— 1var newname = name.sorted() é€†åºæ’åˆ— 123456789let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]func backward(_ s1:String,_ s2:String) -&gt; Bool &#123; return s1 &gt; s2&#125;var newname = name.sorted(by: backward)print(&quot;\\(name) , \\(newname)&quot;)======[&quot;a&quot;, &quot;bb&quot;, &quot;c&quot;, &quot;ddd&quot;] , [&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] é—­åŒ…è¡¨è¾¾å¼è¯­æ³• é—­åŒ…è¡¨è¾¾å¼è¯­æ³•èƒ½å¤Ÿä½¿ç”¨ å¸¸é‡å½¢å¼å‚æ•°ã€å˜é‡å½¢å¼å‚æ•°å’Œè¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°ï¼Œä½†ä¸èƒ½æä¾›é»˜è®¤å€¼ã€‚ å¯å˜å½¢å¼å‚æ•°ä¹Ÿèƒ½ä½¿ç”¨ï¼Œéœ€è¦åœ¨å½¢å¼å‚æ•°åˆ—è¡¨çš„æœ€åé¢ä½¿ç”¨ å…ƒç»„ä¹Ÿå¯è¢«ç”¨æ¥ä½œä¸ºå½¢å¼å‚æ•°å’Œè¿”å›ç±»å‹ 123&#123; (parameters) -&gt; (return type) in statements&#125; å°†ä¹‹å‰ backward(::) å‡½æ•°æ”¹ä¸ºé—­åŒ…è¡¨è¾¾å¼ 12345678let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]var newname = name.sorted(by: &#123; (s1: String,s2: String) -&gt; Bool in return s1 &gt; s2&#125;)print(&quot;\\(name) , \\(newname)&quot;)===========[&quot;a&quot;, &quot;bb&quot;, &quot;c&quot;, &quot;ddd&quot;] , [&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] ä»è¯­å¢ƒä¸­æ¨æ–­ç±»å‹ æ’åºé—­åŒ…ä¸ºå®é™…å‚æ•°æ¥ä¼ é€’ç»™å‡½æ•°ï¼Œswiftèƒ½æ¨æ–­å®ƒçš„å½¢å¼å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹ å¯ä»¥çœç•¥ å½¢å¼å‚æ•°ã€æ‹¬å·ã€è¿”å›ç®­å¤´ 123456let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]var newname = name.sorted(by: &#123; s1,s2 in return s1 &gt; s2 &#125;)print(&quot;\\(newname)&quot;)========[&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] ä½†è¡¨è¾¾å¼é—­åŒ…éšå£«è¿”å› ä½†è¡¨è¾¾å¼é—­åŒ…èƒ½å¤Ÿé€šè¿‡ä»å®ƒä»¬å£°æ˜ä¸­åˆ æ‰ return å…³é”®å­—æ¥éšå£«è¿”å›å®ƒä»¬å•ä¸ªè¡¨è¾¾å¼çš„ç»“æœ 123456let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]var newname = name.sorted(by: &#123; s1,s2 in s1 &gt; s2 &#125;)print(&quot;\\(newname)&quot;)=======[&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] ç®€å†™å®é™…å‚æ•°å swift è‡ªåŠ¨å¯¹è¡Œå†…é—­åŒ…æä¾›ç®€å†™å®é™…å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ $0,$1,$2 ç­‰åå­—æ¥å¼•ç”¨é—­åŒ…çš„ å®é™…å‚æ•° 123456let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]var newname = name.sorted(by: &#123; $0 &gt; $1 &#125;)print(&quot;\\(newname)&quot;)==========[&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] è¿ç®—ç¬¦å‡½æ•° swift çš„ string ç±»å‹å®šä¹‰äº†å…³äºå¤§äºå· &gt; çš„ç‰¹å®šç±»å‹å­—ç¬¦ä¸²å®ç°ï¼Œè®©å…¶ä½œä¸ºä¸€ä¸ªæœ‰ä¸¤ä¸ª string ç±»å‹å½¢å¼å‚æ•°çš„å‡½æ•°å¹¶è¿”å›ä¸€ä¸ª bool ç±»å‹çš„å€¼ã€‚æ­£å¥½ soreted(by:) æ–¹æ³•çš„å½¢å¼å‚æ•°éœ€è¦çš„å‡½æ•°ç›¸åŒ¹é…ã€‚å› æ­¤ä½ å¯ä»¥ç®€å•çš„ä¼ å…¥ä¸€ä¸ª &gt; 123456let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]var newname = name.sorted(by: &gt;)print(&quot;\\(newname)&quot;)=======[&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] å°¾éšé—­åŒ… å¦‚æœä½ éœ€è¦ä¸€ä¸ª å¾ˆé•¿çš„é—­åŒ…è¡¨è¾¾å¼ ä½œä¸º å‡½æ•°æœ€åä¸€ä¸ªå®é™…å‚æ•° ä¼ é€’ç»™å‡½æ•°ï¼Œä½¿ç”¨å°¾éšé—­åŒ…å°†å¢å¼ºå‡½æ•°çš„å¯è¯»æ€§ã€‚ å°¾éšé—­åŒ… æ˜¯ä¸€ä¸ªè¢« å†™åœ¨å‡½æ•°å½¢å¼å‚æ•°çš„æ‹¬å·åé¢ çš„é—­åŒ…è¡¨è¾¾å¼ 123456let name = [&quot;a&quot;,&quot;bb&quot;,&quot;c&quot;,&quot;ddd&quot;]var newname = name.sorted&#123; $0 &gt; $1&#125;print(&quot;\\(newname)&quot;)=======[&quot;ddd&quot;, &quot;c&quot;, &quot;bb&quot;, &quot;a&quot;] é—­åŒ…æ•è·å€¼æ•è·å€¼ ä¸€ä¸ªé—­åŒ…èƒ½å¤Ÿ ä»ä¸Šä¸‹æ–‡æ•è·å·²è¢«å®šä¹‰çš„å¸¸é‡å’Œå˜é‡ã€‚å³ä½¿å®šä¹‰è¿™äº›å¸¸é‡å’Œå˜é‡çš„åŸä½œç”¨åŸŸå·²ç»ä¸å­˜åœ¨ï¼Œé—­åŒ…ä»èƒ½åœ¨å…¶å‡½æ•°ä½“å†…å¼•ç”¨å’Œä¿®æ”¹è¿™äº›å€¼ 1234567891011func makeIncrementor(forIncrement amount: Int) -&gt; () -&gt; Int &#123; var runningTotal = 0 func incrementor() -&gt; Int &#123; runningTotal += amount return runningTotal &#125; return incrementor&#125;======= ä½œä¸ºä¸€ç§ä¼˜åŒ–ï¼Œå¦‚æœä¸€ä¸ªå€¼æ²¡æœ‰æ”¹å˜æˆ–åœ¨é—­åŒ…å¤–é¢ï¼Œswiftå¯èƒ½ä¼šä½¿ç”¨è¿™ä¸ªå€¼çš„ æ‹·è´ è€Œ ä¸æ˜¯æ•è· å¦‚æœ runningTotal æ²¡æœ‰åœ¨é—­åŒ…é‡Œä½¿ç”¨æˆ–æ”¹å˜ï¼Œåˆ™æ˜¯ æ‹·è´ swiftä¹Ÿå¤„ç†äº†å˜é‡çš„å†…å­˜ç®¡ç†æ“ä½œï¼Œå½“å˜é‡ä¸å†éœ€è¦æ—¶ä¼šè¢«é‡Šæ”¾ é—­åŒ…æ˜¯å¼•ç”¨ç±»å‹ åœ¨swiftä¸­ï¼Œå‡½æ•°å’Œé—­åŒ…éƒ½æ˜¯å¼•ç”¨ç±»å‹ æ— è®ºæ˜¯ä»€ä¹ˆæ—¶å€™èµ‹å€¼ç»™ å‡½æ•°æˆ–é—­åŒ… ä¸€ä¸ª å¸¸é‡æˆ–å˜é‡ï¼Œå®é™…ä¸Šéƒ½æ˜¯å°†å¸¸é‡å’Œå˜é‡è®¾ç½®ä¸ºå¯¹å‡½æ•°å’Œé—­åŒ…çš„ å¼•ç”¨ å¦‚æœä½ åˆ†é…äº†ä¸€ä¸ªé—­åŒ…ç»™ç±»å®ä¾‹çš„å±æ€§ï¼Œå¹¶ä¸”é—­åŒ…é€šè¿‡å¼•ç”¨è¯¥å®ä¾‹æˆ–è€…å®ƒçš„æˆå‘˜æ¥æ•è·å®ä¾‹ï¼Œä½ å°†åœ¨é—­åŒ…å’Œå®ä¾‹é—´ä¼šäº§ç”Ÿ å¾ªç¯å¼•ç”¨ é€ƒé€¸é—­åŒ… å½“é—­åŒ…ä½œä¸ºä¸€ä¸ªå®é™…å‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒä¼šåœ¨ å‡½æ•°è¿”å›ä¹‹åè°ƒç”¨ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ª é—­åŒ…é€ƒé€¸äº†ã€‚å½“ä½ å£°æ˜ä¸€ä¸ªæ¥æ”¶é—­åŒ…ä½œä¸ºå½¢å¼å‚æ•°çš„å‡½æ•°æ—¶ï¼Œ ä½ å¯ä»¥åœ¨å½¢å¼å‚æ•°å‰åŠ  @escaping æ¥æ˜ç¡®é—­åŒ…æ˜¯å…è®¸é€ƒé€¸çš„ é—­åŒ…å¯ä»¥é€ƒé€¸çš„ä¸€ç§æ–¹æ³•æ˜¯ è¢«å­˜å‚¨åœ¨å®šä¹‰å‡½æ•°å¤–çš„å˜é‡é‡Œã€‚æ¯”å¦‚è¯´ï¼Œå¾ˆå¤šå‡½æ•°æ¥æ”¶é—­åŒ…å®é™…å‚æ•°æ¥ä½œä¸ºå¯åŠ¨å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒã€‚å‡½æ•°åœ¨å¯åŠ¨ä»»åŠ¡åè¿”å›ï¼Œä½†æ˜¯é—­åŒ…è¦ç›´åˆ°ä»»åŠ¡å®Œæˆâ€”é—­åŒ…éœ€è¦é€ƒé€¸ï¼Œä»¥ä¾¿ç¨åè°ƒç”¨ã€‚ä¸€èˆ¬æ˜¯ç½‘ç»œè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥ä½¿ç”¨ é€ƒé€¸é—­åŒ… è®©é—­åŒ… @escaping ä½ å¿…é¡»åœ¨é—­åŒ…ä¸­æ˜¾ç¤ºçš„ä½¿ç”¨ self è‡ªåŠ¨é—­åŒ… é€šè¿‡ @autoclosure æ ‡å¿—æ ‡è®°å®ƒçš„å½¢å¼æ˜¯ä½¿ç”¨äº†è‡ªåŠ¨é—­åŒ…ã€‚ç°åœ¨ä½ è°ƒç”¨å‡½æ•°å°±åƒå®ƒæ¥å—äº†ä¸€ä¸ª String ç±»å‹çš„å®é™…å‚æ•°è€Œä¸æ˜¯é—­åŒ…ã€‚å®é™…å‚æ•°è‡ªåŠ¨åœ°è½¬æ¢ä¸ºé—­åŒ…ã€‚ å¯ä»¥å°†ä¸€ä¸ª è¡¨è¾¾å¼ ç›´æ¥ä¼ é€’ç»™ @autoclosureè‡ªåŠ¨é—­åŒ… è‡ªåŠ¨é—­åŒ…æ˜¯ä¸€ç§è‡ªåŠ¨åˆ›å»ºçš„ç”¨æ¥æŠŠä½œä¸ºå®é™…å‚æ•°ä¼ é€’ç»™å‡½æ•°çš„è¡¨è¾¾å¼çš„é—­åŒ…ã€‚å®ƒä¸æ¥å—ä»»ä½•å®é™…å‚æ•°ï¼Œå¹¶ä¸”å½“å®ƒè¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šè¿”å›å†…éƒ¨æ‰“åŒ…çš„è¡¨è¾¾å¼çš„å€¼ã€‚è¿™ä¸ªè¯­æ³•çš„å¥½å¤„åœ¨äºé€šè¿‡å†™æ™®é€šè¡¨è¾¾å¼ä»£æ›¿æ˜¾ç¤ºé—­åŒ…è€Œä½¿ä½  çœç•¥ åŒ…å›´ å‡½æ•°å½¢å¼å‚æ•° çš„æ‹¬å·() è‡ªåŠ¨é—­åŒ…å…è®¸ä½  å»¶è¿Ÿæ‰§è¡Œï¼Œå› æ­¤é—­åŒ…å†…éƒ¨çš„ä»£ç ç›´åˆ°ä½ è°ƒç”¨æ—¶æ‰ä¼šè¿è¡Œã€‚å¯¹äºæœ‰å‰¯ä½œç”¨æˆ–è€…å ç”¨èµ„æºçš„ä»£ç æ¥è¯´å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å…è®¸ä½ æ§åˆ¶ä»£ç ä½•æ—¶æ‰è¿›è¡Œæ±‚å€¼ 12345678910111213141516// è‡ªåŠ¨é—­åŒ…var custom = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;];print(custom.count)let customPro = &#123; custom.remove(at: 0)&#125;print(custom.count)// è°ƒç”¨æ‰æ±‚å€¼print(&quot;new \\(customPro())&quot;)print(custom.count)=======44new a3 è‡ªåŠ¨ + é€ƒé€¸ å¦‚æœä½ æƒ³è¦è‡ªåŠ¨é—­åŒ…å…è®¸é€ƒé€¸ï¼Œå°±åŒæ—¶ä½¿ç”¨ @autoclosure å’Œ @escaping æ ‡å¿— 1234567891011// è‡ªåŠ¨+é€ƒé€¸var names = [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;]var providers:[() -&gt; String] = []func collectCustomsProviders(provider: @escaping () -&gt; String) &#123; providers.append(provider )&#125;// è¡¨è¾¾å¼ name.remove(at:0) StringcollectCustomsProviders(provider:names.remove(at: 0))=========æŠ¥é”™ ä¸èƒ½ç›´æ¥ç»™ é—­åŒ… ä¼ é€’è¡¨è¾¾å¼ï¼Œéœ€è¦æ·»åŠ  @autoclosure æ­£ç¡®çš„å†™æ³• 1234567891011121314151617181920212223// è‡ªåŠ¨+é€ƒé€¸var names = [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;]var providers:[() -&gt; String] = []func collectCustomsProviders(provider: @autoclosure @escaping () -&gt; String) &#123; providers.append(provider )&#125;// è¡¨è¾¾å¼ name.remove(at:0) StringcollectCustomsProviders(provider:names.remove(at: 0))collectCustomsProviders(provider:names.remove(at: 0))// å®é™…ä¸Šé€ƒé€¸é—­åŒ…print(names.count)for provide in providers &#123; print(provide())&#125;print(names.count)========4122","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 33ï¼šå‡½æ•°","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 33ï¼šå‡½æ•°","date":"2023-03-03T14:54:55.000Z","updated":"2023-03-09T07:24:39.654Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 33ï¼šå‡½æ•°/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A033%EF%BC%9A%E5%87%BD%E6%95%B0/","excerpt":"","text":"Swiftä¸­å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨å‡½æ•°åŸºæœ¬æ¦‚å¿µ å‡½æ•°æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä»£ç å—ï¼Œç”¨æ¥æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚é€šè¿‡ç»™å‡½æ•°ä¸€ä¸ªåå­—æ¥å®šä¹‰å®ƒçš„åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨éœ€è¦çš„æ—¶å€™ï¼Œé€šè¿‡è¿™ä¸ªåå­—æ¥ è°ƒç”¨ å‡½æ•°æ‰§è¡Œå®ƒçš„ä»»åŠ¡ Swiftç»Ÿä¸€çš„å‡½æ•°è¯­æ³•ååˆ†çµæ´»ã€‚å¯ä»¥ä»ç®€å•çš„æ— å½¢å¼å‚æ•°åˆ°å¤æ‚çš„æ¯ä¸ªå½¢å¼å‚æ•°éƒ½å¸¦æœ‰å±€éƒ¨å’Œå¤–éƒ¨å½¢å¼å‚æ•°åã€‚å½¢å¼å‚æ•°æä¾›ä¸€ä¸ªé»˜è®¤å€¼æ¥ç®€åŒ–å‡½æ•°çš„è°ƒç”¨ï¼Œå¯è¢«å½“åšè¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°è¢«ä¼ é€’ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œæˆæ—¶ä¿®æ”¹ä¼ é€’è¿›æ¥çš„å˜é‡ã€‚ Swiftä¸­æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ç±»å‹ï¼Œç”±å‡½æ•°çš„å½¢å¼å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹ç»„æˆ ã€‚å¯ä»¥åƒswiftä¸­å…¶å®ƒç±»å‹æ¥ä½¿ç”¨å®ƒã€‚å¯ä»¥å°†å‡½æ•°å½“ä¸€ä¸ªå½¢å¼å‚æ•°ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ã€‚ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è¿”å›å¦ä¸€ä¸ªå‡½æ•°ã€‚åŒæ—¶ä¹Ÿå¯ä»¥å†™åœ¨å…¶ä»–å‡½æ•°å†…éƒ¨åœ¨å†…åµŒèŒƒå›´å°è£…æœ‰ç”¨çš„åŠŸèƒ½ã€‚ å‡½æ•°æ˜¯ å¼•ç”¨ç±»å‹ çš„ï¼Œä¸æ˜¯å€¼ç±»å‹çš„ å®šä¹‰å’Œè°ƒç”¨å‡½æ•° å½“ä½ å®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå¯ä»¥ é€‰æ‹©å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå½¢å¼å‚æ•°ç±»å‹ï¼Œä¹Ÿå¯ä»¥å®šä¹‰è¿”å›ç±»å‹ æ¯ä¸ªå‡½æ•°éƒ½æœ‰å‡½æ•°åï¼Œè—è§†æ‰§è¡Œçš„ä»»åŠ¡ã€‚ ä½¿ç”¨å‡½æ•°å¯é€šè¿‡ å‡½æ•°å å¹¶ä¸” ä¼ å…¥ å‡½æ•°çš„ å®é™…å‚æ•° ï¼ˆå³å½¢å¼å‚æ•°ç±»å‹çš„è¾“å…¥å€¼ ï¼‰æ¥ è°ƒç”¨å‡½æ•°ã€‚ å®é™…å‚æ•°é¡ºåºå¿…é¡»ç¬¦åˆå½¢å¼å‚æ•°çš„åˆ—è¡¨é¡ºåº æ— å½¢å¼å‚æ•°çš„å‡½æ•° å‡½æ•°ä¸è¦æ±‚å¿…é¡»ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥æ²¡æœ‰å½¢å¼å‚æ•° å‡½æ•°å®šä¹‰éœ€è¦åœ¨åå­—çš„åé¢åŠ ä¸€ä¸ªåœ†æ‹¬å·ï¼Œå³ä½¿æ²¡æœ‰å½¢å¼å‚æ•°ä¹Ÿå¾—åŠ  è°ƒç”¨å‡½æ•°çš„æ—¶å€™ä¹Ÿè¦åœ¨å‡½æ•°çš„åå­—åé¢åŠ ä¸€ä¸ªåœ†æ‹¬å· å¤šå½¢å¼å‚æ•°çš„å‡½æ•° å‡½æ•°å¯ä»¥è¾“å…¥å¤šä¸ªå½¢å¼å‚æ•°ï¼Œå†™åœ¨åœ†æ‹¬å·å†…ï¼Œç”¨é€—å·åˆ†å‰² 123func manyPara(a:Int,b:Int) &#123; pring(&quot;\\(a) \\(b)&quot;)&#125; æ— è¿”å›å€¼çš„å‡½æ•° å‡½æ•°å®šä¹‰å¯ä»¥æ²¡æœ‰è¿”å›ç±»å‹ï¼Œå³æ²¡æœ‰è¿”å›ç®­å¤´ -&gt; æˆ–è¿”å›ç±»å‹ ä¸¥æ ¼ä¸Šï¼Œå‡½æ•°è¿˜æ˜¯æœ‰ä¸€ä¸ªè¿”å›ç±»å‹çš„ï¼Œå°½ç®¡æ²¡æœ‰å®šä¹‰è¿”å›å€¼ï¼Œå®é™…ä¸Šè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ voidã€‚å®ƒæ˜¯ä¸€ä¸ªç©ºçš„å…ƒç»„ï¼Œä½œç”¨ç›¸å½“äºæ²¡æœ‰å…ƒç´ çš„å…ƒç»„ï¼Œå†™ä½œ() 123func manyTuple() -&gt; void &#123; return nil&#125; å¤šè¿”å›å€¼çš„å‡½æ•° å¯ä»¥è®©å‡½æ•°è¿”å›å¤šä¸ªå€¼ä½œä¸ºä¸€ä¸ªå¤åˆçš„è¿”å›å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨å…ƒç»„ç±»å‹ä½œä¸ºè¿”å›ç±»å‹ 123func manyTuple() -&gt; (a:Int,b:String) &#123; return (1,&quot;aaa&quot;)&#125; å¯é€‰å…ƒç»„è¿”å›ç±»å‹ å¦‚æœåœ¨å‡½æ•°è¿”å›ç±»å‹ä¸­å…ƒç»„å¯èƒ½ æ²¡æœ‰å€¼ï¼Œå¯ä»¥ç”¨å¯é€‰å…ƒç»„è¯´æ˜å…ƒç»„å¯èƒ½æ˜¯ nil å†™æ³•æ˜¯å¯é€‰å…ƒç»„åœ†æ‹¬å·åé¢åŠ ä¸€ä¸ªé—®å· ï¼Ÿï¼Œä¾‹å¦‚ (Int,Int)? æˆ– (String,Int,Bool)? ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223// è¿”å›å…ƒç»„func minMax(arr: [Int]) -&gt; (min:Int,max:Int)? &#123; if arr.isEmpty &#123; return nil &#125; var minValue = arr[0] var maxValue = arr[0] for value in arr &#123; if value &lt; minValue &#123; minValue = value &#125; if value &gt; maxValue &#123; maxValue = value &#125; &#125; return (minValue,maxValue)&#125;// ç»‘å®šif let minMaxValue = minMax(arr: [1,3,4,2,5]) &#123; print(&quot;min is \\(minMaxValue.min),max is \\(minMaxValue.max)&quot;)&#125; ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 1min is 1,max is 5 éšå£«è¿”å›å‡½æ•° å¦‚æœæ•´ä¸ªå‡½æ•°ä½“æ˜¯ä¸€ä¸ªå•ä¸€çš„è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆå‡½æ•°éšå£«è¿”å›è¿™ä¸ªè¡¨è¾¾å¼ 1234func greet(person: String) -&gt; String&#123; &quot;Hello,&quot; + person + &quot;!&quot;&#125;print(&quot;\\(greet(person: &quot;World&quot;))&quot;) æ‰“å°ç»“æœ 1Hello,World! Swiftå½¢å¼å‚æ•°å’Œè¿”å›å€¼å®å‚æ ‡ç­¾å’Œå½¢å‚å æ¯ä¸€ä¸ªå‡½æ•°çš„å½¢å¼å‚æ•°éƒ½åŒ…å«å®é™…å‚æ•°æ ‡ç­¾å’Œå½¢å¼å‚æ•°åã€‚ å½¢å¼å‚æ•°å¿…é¡»æœ‰å”¯ä¸€çš„åå­—ï¼Œæœ‰åŠ©äºä»£ç æ˜“è¯» 1234func someFunc(firstParamName:Int,secondParamName:Int)&#123; // å½¢å¼å‚æ•° firstParamName secondParamName&#125;someFunc(firstParamName: 1, secondParamName: 2) æŒ‡å®šå®é™…å‚æ•°æ ‡ç­¾ å½¢å¼å‚æ•°åä¹‹å‰å†™å®é™…å‚æ•°æ ‡ç­¾ï¼Œç”¨ ç©ºæ ¼ åˆ†å‰² å¦‚æœä½ ä¸º å½¢å¼å‚æ•° å®šä¹‰äº† å®é™…å‚æ•°æ ‡ç­¾ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™å¿…é¡»ä½¿ç”¨ å®é™…å‚æ•°æ ‡ç­¾ å®é™…å‚æ•°æ ‡ç­¾èƒ½å¤Ÿè®©å‡½æ•°çš„è°ƒç”¨æ›´åŠ æ˜ç¡®ï¼Œæ›´åƒè‡ªç„¶è¯­è¨€ï¼Œæ›´å¯è¯»ï¼Œæ›´æ¸…æ™°è¡¨è¾¾ä½ çš„æ„å›¾ 12345// å®é™…å‚æ•°æ ‡ç­¾ homefunc greet(person: String, from home: String) -&gt; String &#123; return &quot;Hello \\(person)! my home is \\(home)&quot;&#125;print(greet(person: &quot;ZJ&quot;,from: &quot;BeiJing&quot;)) æ‰“å°ç»“æœï¼š 1Hello ZJ! my home is BeiJing çœç•¥å®é™…å‚æ•°æ ‡ç­¾ å¯ä»¥åˆ©ç”¨ä¸‹åˆ’çº¿ _ æ›¿ä»£æ˜¾ç¤ºçš„å®é™…å‚æ•°æ ‡ç­¾ 1234func greet(_ person: String, _ home: String) -&gt; String &#123; return &quot;Hello \\(person)! my home is \\(home)&quot;&#125;print(greet(person: &quot;ZJ&quot;,from: &quot;BeiJing&quot;)) é»˜è®¤å½¢å¼å‚æ•°å€¼ å¯ä»¥åœ¨å½¢å¼å‚æ•°ç±»å‹åï¼Œç»™ç±»å‹å®šä¹‰ä¸€ä¸ªé»˜è®¤å€¼ å¦‚æœå®šä¹‰äº†é»˜è®¤å€¼ï¼Œä½ å°±å¯ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™çœç•¥è¿™ä¸ªå½¢å¼å‚æ•° 123456789func someFunc(paramDefault: Int = 10) &#123; print(&quot;\\(paramDefault)&quot;)&#125;someFunc(paramDefault: 6)someFunc()===========610 å¯å˜å½¢å¼å‚æ•° ä¸€ä¸ªå¯å˜çš„å½¢å¼å‚æ•°å¯ä»¥æ¥å—é›¶æˆ–å¤šä¸ªç‰¹å®šç±»å‹çš„å€¼ã€‚ é€šè¿‡åœ¨å½¢å¼å‚æ•°ç±»å‹ååæ’å…¥ä¸‰ä¸ªç‚¹ç¬¦å· ... æ¥ä¹¦å†™å¯å˜å½¢å¼å‚æ•°ã€‚ ä¼ å…¥åˆ°å¯å˜å‚æ•°ä¸­çš„å€¼åœ¨å‡½æ•°çš„ä¸»ä½“ä¸­è¢«å½“åšæ˜¯å¯¹åº”ç±»å‹çš„ æ•°ç»„ã€‚ 1234567891011func changeFunc(_ numbers: Double...) -&gt; Double &#123; var total: Double = 0 for number in numbers &#123; total += number &#125; return total / Double(numbers.count)&#125;changeFunc(1,2,3,4,5)=============3 è¾“å…¥è¾“å‡ºå½¢å¼å‚æ•° å¯å˜å½¢å¼å‚æ•°åªèƒ½åœ¨å‡½æ•°çš„å†…éƒ¨åšæ”¹å˜ã€‚å¦‚æœä½ æƒ³å‡½æ•°èƒ½ä¿®æ”¹ä¸€ä¸ªå½¢å¼å‚æ•°çš„å€¼ï¼Œè€Œä¸”è¿™äº›æ”¹å˜åœ¨å‡½æ•°ç»“æŸä¹‹åä¾ç„¶ç”Ÿæ•ˆï¼Œé‚£ä¹ˆå°±éœ€è¦å°†å½¢å¼å‚æ•°å®šä¹‰ä¸ºè¾“å…¥è¾“å‡ºå½¢å¼å‚æ•° è¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°ï¼šåœ¨å½¢å¼å‚æ•°å‰è¾¹åŠ  inout å…³é”®å­—ã€‚ åªèƒ½æŠŠ å˜é‡ ä½œä¸ºè¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°çš„ å®é™…å‚æ•°ï¼Œåœ¨å°†å˜é‡ä½œä¸ºå®é™…å‚æ•°ä¼ å…¥ç»™è¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°æ—¶ï¼Œåœ¨å®ƒå‰è¾¹æ·»åŠ ä¸€ä¸ªç¬¦å· &amp; æ¥æ˜ç¡®å¯ä»¥è¢«å‡½æ•°ä¿®æ”¹ è¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ï¼Œå¯å˜å½¢å¼å‚æ•°ä¸èƒ½è¢«æ ‡è®°ä¸º inout 12345678910111213// è¾“å…¥è¾“å‡ºå½¢å¼å‚æ•°func swapTwoInt(_ a: inout Int, _ b: inout Int) &#123; let temp = a a = b b = temp&#125;var one = 10var two = 20swapTwoInt(&amp;one,&amp;two)print(&quot;\\(one) \\(two)&quot;)=========20 10 å‡½æ•°ç±»å‹å’Œå†…åµŒå‡½æ•°å‡½æ•°ç±»å‹ æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„å‡½æ•°ç±»å‹ï¼Œå®ƒç”±å½¢å¼å‚æ•°ç±»å‹ï¼Œè¿”å›ç±»å‹ç»„æˆ 12345678func addTwo(_ a:Int,_ b:Int) -&gt; Int &#123; return a + b&#125;let c = addTwo(1,2)print(&quot;\\(c)&quot;)========3 å’Œ (Int,Int) -&gt; Int ç›¸å…³ ä½¿ç”¨å‡½æ•°ç±»å‹ ä½ å¯ä»¥åƒä½¿ç”¨Swiftä¸­çš„å…¶ä»–ç±»å‹ä¸€æ ·ä½¿ç”¨å‡½æ•°ç±»å‹ã€‚ä¾‹å¦‚ï¼šä½ å¯ä¸€ä¸ªå¸¸é‡æˆ–å˜é‡å®šä¹‰ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå¹¶ä¸”æœªå˜é‡æŒ‡å®šä¸€ä¸ªç›¸åº”çš„å‡½æ•° 12345678func addTwo(_ a:inout Int,_ b:inout Int) -&gt; Int &#123; return a + b&#125;var mathFunc:(inout Int,inout Int) -&gt; Int = addTwoprint(mathFunc(2,3))============5 å‡½æ•°ç±»å‹ä½œä¸ºå½¢å¼å‚æ•°ç±»å‹ ä½ å¯ä»¥å°† å‡½æ•° ä½œä¸º å…¶ä»–å‡½æ•°çš„å½¢å¼å‚æ•° 12345678910func addTwo(_ a:Int,_ b:Int) -&gt; Int &#123; return a + b&#125;func printResult(_ mathFunc:(Int,Int) -&gt; Int,_ a:Int,_ b:Int) &#123; print(&quot;Result:\\(mathFunc(a,b))&quot;)&#125;printResult(addTwo,2,3)==========5 å‡½æ•°ç±»å‹ä½œä¸ºè¿”å›ç±»å‹ å¯ä»¥åˆ©ç”¨å‡½æ•°çš„ç±»å‹ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹ã€‚å†™æ³•åœ¨å‡½æ•°çš„è¿”å›ç®­å¤´åå†™ä¸€ä¸ªå®Œæ•´çš„å‡½æ•°ç±»å‹ 123456func backF(_ input:Int) -&gt; Int&#123; return input - 1&#125;func chooseFunc(back: Bool) -&gt; (Int) -&gt; Int &#123; return backF&#125; å†…åµŒå‡½æ•° å¯ä»¥åœ¨å‡½æ•°å†…å®šä¹‰å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚è¿™å°±æ˜¯å†…åµŒå‡½æ•° å†…åµŒå‡½æ•°é»˜è®¤æ˜¯è¢«éšè—èµ·æ¥çš„ï¼Œä½†ä»ç„¶å¯ä»¥é€šè¿‡åŒ…è£¹ä»–ä»¬çš„å‡½æ•°æ¥è°ƒç”¨ä»–ä»¬ã€‚ åŒ…è£¹çš„å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›å®ƒå†…éƒ¨çš„ä¸€ä¸ªå†…åµŒå‡½æ•°æ¥åœ¨å¦å¤–çš„è¿”å›é‡Œä½¿ç”¨ 1234567891011121314func chooseFunc(back: Bool) -&gt; (Int) -&gt; Int &#123; func stepForward(step:Int) -&gt; Int &#123; return step + 1&#125; func stepBackward(step:Int) -&gt; Int &#123; return step - 1&#125; return back ? stepBackward : stepForward&#125;var current = -4let stepFunc = chooseFunc(back: current &gt; 0)while current != 0 &#123; current = stepFunc(current)&#125;print(current)=======0","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 32ï¼šDictionaryå­—å…¸åº•å±‚å®ç°æ¢ç´¢","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 32ï¼šDictionaryå­—å…¸åº•å±‚å®ç°æ¢ç´¢","date":"2023-03-03T14:54:19.000Z","updated":"2023-03-09T07:24:35.724Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 32ï¼šDictionaryå­—å…¸åº•å±‚å®ç°æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A032%EF%BC%9ADictionary%E5%AD%97%E5%85%B8%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 32ï¼šDictionaryå­—å…¸","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 32ï¼šDictionaryå­—å…¸","date":"2023-03-03T14:54:00.000Z","updated":"2023-03-09T07:24:33.560Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 32ï¼šDictionaryå­—å…¸/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A032%EF%BC%9ADictionary%E5%AD%97%E5%85%B8/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 31ï¼šSetåº•å±‚å®ç°æ¢ç©¶","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 31ï¼šSetåº•å±‚å®ç°æ¢ç©¶","date":"2023-03-03T14:53:34.000Z","updated":"2023-03-09T07:24:31.511Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 31ï¼šSetåº•å±‚å®ç°æ¢ç©¶/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A031%EF%BC%9ASet%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%8E%A2%E7%A9%B6/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 30ï¼šSeté›†åˆ","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 30ï¼šSeté›†åˆ","date":"2023-03-03T14:52:43.000Z","updated":"2023-03-09T07:24:27.936Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 30ï¼šSeté›†åˆ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A030%EF%BC%9ASet%E9%9B%86%E5%90%88/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 29ï¼šå¦‚ä½•ç”¨æ•°ç»„æ¥å®ç°æ ˆå’Œé˜Ÿåˆ—","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 29ï¼šå¦‚ä½•ç”¨æ•°ç»„æ¥å®ç°æ ˆå’Œé˜Ÿåˆ—","date":"2023-03-03T14:51:03.000Z","updated":"2023-03-09T07:24:25.385Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 29ï¼šå¦‚ä½•ç”¨æ•°ç»„æ¥å®ç°æ ˆå’Œé˜Ÿåˆ—/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A029%EF%BC%9A%E5%A6%82%E4%BD%95%E7%94%A8%E6%95%B0%E7%BB%84%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 28ï¼šæ•°ç»„çš„åº•å±‚å®ç°","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 28ï¼šæ•°ç»„çš„åº•å±‚å®ç°","date":"2023-03-03T14:50:24.000Z","updated":"2023-03-09T07:24:23.130Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 28ï¼šæ•°ç»„çš„åº•å±‚å®ç°/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A028%EF%BC%9A%E6%95%B0%E7%BB%84%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 27ï¼šè®¿é—®å’Œæ“ä½œæ•°ç»„","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 27ï¼šè®¿é—®å’Œæ“ä½œæ•°ç»„","date":"2023-03-03T14:49:55.000Z","updated":"2023-03-09T07:24:11.998Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 27ï¼šè®¿é—®å’Œæ“ä½œæ•°ç»„/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A027%EF%BC%9A%E8%AE%BF%E9%97%AE%E5%92%8C%E6%93%8D%E4%BD%9C%E6%95%B0%E7%BB%84/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 26ï¼šåˆ›å»ºæ•°ç»„çš„å‡ ç§æ–¹å¼","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 26ï¼šåˆ›å»ºæ•°ç»„çš„å‡ ç§æ–¹å¼","date":"2023-03-03T14:49:30.000Z","updated":"2023-03-09T07:24:19.626Z","comments":true,"path":"2023/03/03/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 26ï¼šåˆ›å»ºæ•°ç»„çš„å‡ ç§æ–¹å¼/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A026%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/","excerpt":"","text":"","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"OCä¸‰æ–¹æ¡†æ¶01ï¼šbuglyæœé›†Crash","slug":"æ€§èƒ½ä¼˜åŒ–03.1ï¼šbuglyæœé›†Crash","date":"2023-03-03T08:17:48.000Z","updated":"2023-03-08T23:00:23.065Z","comments":true,"path":"2023/03/03/æ€§èƒ½ä¼˜åŒ–03.1ï¼šbuglyæœé›†Crash/","link":"","permalink":"https://www.bboyzj.cn/2023/03/03/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%9603.1%EF%BC%9Abugly%E6%90%9C%E9%9B%86Crash/","excerpt":"","text":"Bugly ä»‹ç»ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿå¹¶å‡†ç¡®çš„å®šä½ç”¨æˆ· App å‘ç”Ÿ Crash çš„ä»£ç ä½ç½®ï¼ŒBugly ä½¿ç”¨ ç¬¦å·è¡¨æ–‡ä»¶ å¯¹å‘ç”Ÿ Crash çš„ç¨‹åº å †æ ˆ è¿›è¡Œ è§£æå’Œè¿˜åŸ ä¸¾ä¾‹ï¼š Bugly ä¸Šä¼ æ–¹å¼ Bugly å·²ä¸å†æ”¯æŒç›´æ¥ä¸Šä¼ dSYMæ–‡ä»¶ï¼Œéœ€è¦ ä¸‹è½½å·¥å…·åŒ…æ‰‹åŠ¨ä¸Šä¼  æœ¬æ–‡ä¸»è¦ä»‹ç» ä¸‹è½½å·¥å…·åŒ…æ‰‹åŠ¨ä¸Šä¼  å®‰è£…javaè¿è¡Œç¯å¢ƒ ç»ˆç«¯æŸ¥çœ‹æ˜¯å¦å·²å®‰è£… 1234zhangjian@zhangjiandeMBP ~ % java -versionjava version &quot;1.8.0_291&quot;Java(TM) SE Runtime Environment (build 1.8.0_291-b10)Java HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode) ä¸Šé¢çš„æ˜¾ç¤ºè¡¨ç¤ºå·²å®‰è£… æœªå®‰è£…çš„æƒ…å†µå¦‚ä¸‹ï¼š åˆ° Javaå®˜ç½‘ ä¸‹è½½ jdkï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹è½½å®Œæˆä¹‹åæ‰“å¼€ dmgï¼Œå®‰è£…ã€ä¸€è·¯ä¸‹ä¸€æ­¥å³å¯å®‰è£…æˆåŠŸã€‚ åœ¨ç»ˆç«¯è¾“å…¥ java -version å¯ä»¥æŸ¥çœ‹ java ç‰ˆæœ¬ï¼Œå¦‚æœè¾“å‡ºä¿¡æ¯å’Œä¸Šé¢ç±»ä¼¼ï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸ è·å– dSYM æ–‡ä»¶ ä»€ä¹ˆæ˜¯ dSYM æ–‡ä»¶ï¼Ÿ åœ¨ iOS å¹³å°ä¸­ï¼ŒdSYMæ–‡ä»¶æ˜¯æŒ‡ å…·æœ‰è°ƒè¯•ä¿¡æ¯çš„ç›®æ ‡æ–‡ä»¶ï¼Œæ–‡ä»¶åé€šå¸¸ä¸º xxx.app.dSYM ã€æ³¨ã€‘ï¼šä¸ºäº†æ–¹ä¾¿æ‰¾å› Crash å¯¹åº”çš„ dSYMæ–‡ä»¶ å’Œ è¿˜åŸå †æ ˆï¼Œå»ºè®®æ¯æ¬¡ æ„å»ºæˆ–å‘å¸ƒAppç‰ˆæœ¬ æ—¶ï¼Œå¤‡ä»½å¥½ dSYMæ–‡ä»¶ è·å– dSYM æ–¹å¼ æˆ‘ä»¬å¯ä»¥é…ç½® Edit Scheme -&gt; Archives æ‰“åŒ… Debug å’Œ Release ä¸¤ç§ç¯å¢ƒï¼Œå»è·å– dSYMæ–‡ä»¶ï¼Œæœ¬æ–‡ä»¥ Release å‘å¸ƒç¯å¢ƒä¸ºä¾‹ é…ç½®æ‰“åŒ…ç¯å¢ƒ Release Show in Finder -&gt; æ˜¾ç¤ºåŒ…å†…å®¹ï¼Œæ‰¾åˆ° dSYMæ–‡ä»¶ æœ€åï¼Œåœ¨æ¡Œé¢æˆ–ä»»æ„ä½ç½®ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å¦‚ appdSYM ï¼Œå°† xxx.app.dSYM æ‹·è´è¿›æ¥ è‡³æ­¤ï¼Œè·å– dSYMæ–‡ä»¶ å®Œæˆ å·¥å…·æ‰‹åŠ¨ä¸Šä¼ ç¬¦å·è¡¨ ä¸‹è½½ Bugly iOS ç¬¦å·è¡¨ ä¸Šä¼ å·¥å…·ï¼Œå¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„æ˜¯ buglySymboliOS.jar æ–‡ä»¶ï¼Œå•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–°å»ºçš„ç©ºæ–‡ä»¶å¤¹å¦‚ buglySymboliOS é‡Œé¢ ä¸‹è½½åå¾—åˆ° buglyqq-upload-symbol æ–‡ä»¶ï¼Œè§£å‹é‡Œé¢ jaråŒ…ï¼Œå¾—åˆ° buglySymboliOS.jar åŒ… é€šè¿‡ç»ˆç«¯å‘½ä»¤è¡Œä¸Šä¼  1java -jar buglyqq-upload-symbol.jar -appid c4f4e4dc67 -appkey cb791b15-dbe1-44d9-bd33-b3fe558b773b -bundleid cn.epod.srsf -version 1.6.2 -platform IOS -inputSymbol /Users/mac/Desktop/appdSYM/ä¸­å›¾äº‘ä¹¦æˆ¿.app.dSYM ã€å‚æ•°è¯´æ˜ã€‘ï¼š -addid ï¼šåœ¨ bugly ä¸Šå¯¹åº”çš„ appid c4f4e4dc67-appkey ï¼šåœ¨ bugly ä¸Šå¯¹åº”çš„ appkey-bundleid ï¼š iOSå¹³å°çš„ bundle id cn.epod.srsf-version ï¼šç‰ˆæœ¬å· 1.6.2-platform ï¼šå¹³å°ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰IOS Android-inputSymbol ï¼šdSYMè°ƒè¯•æ–‡ä»¶ &#x2F;Users&#x2F;mac&#x2F;Desktop&#x2F;appdSYM&#x2F;ä¸­å›¾äº‘ä¹¦æˆ¿.app.dSYM é¡¹ç›®ä¸­ä½¿ç”¨ é¡¹ç›®éœ€è¦é›†æˆcocoapodsä¸‰æ–¹ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç”¨cocoapodsé›†æˆ Bugly SDK 12345678910111213141516171819202122232425platform :ios, &#x27;9.0&#x27;# å¿½ç•¥æ‰€æœ‰è­¦å‘Šinhibit_all_warnings!target &#x27;SRSF&#x27; do # Comment the next line if you don&#x27;t want to use dynamic frameworks use_frameworks! # Pods for SRSF # å®˜æ–¹æç¤ºï¼šä¸‰æ–¹åŠ¨æ€åº“æœ€å¥½æœ€å¤šæ˜¯6ä¸ª # Bugly pod &#x27;Bugly&#x27; target &#x27;SRSFTests&#x27; do inherit! :search_paths # Pods for testing end target &#x27;SRSFUITests&#x27; do # Pods for testing endend ä½¿ç”¨ 1234567#pragma mark -Bugly- (void)startBugly&#123; BuglyConfig * config = [[BuglyConfig alloc] init]; config.debugMode = YES; // Debugä¿¡æ¯å¼€å…³ config.reportLogLevel = BuglyLogLevelWarn; // è®¾ç½®ä¸ºBuglyLogLevelWarnï¼Œåˆ™åœ¨å´©æºƒæ—¶ä¼šä¸ŠæŠ¥Warnã€Erroræ¥å£æ‰“å°çš„æ—¥å¿— [Bugly startWithAppId:@&quot;AppId&quot; config:config];&#125;","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-ä¸‰æ–¹æ¡†æ¶","slug":"OC-ä¸‰æ–¹æ¡†æ¶","permalink":"https://www.bboyzj.cn/tags/OC-%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"æ€§èƒ½ä¼˜åŒ–02ï¼šå¡é¡¿æ£€æµ‹","slug":"OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–02ï¼šå¡é¡¿æ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ","date":"2023-03-02T15:32:46.000Z","updated":"2023-03-08T21:34:00.621Z","comments":true,"path":"2023/03/02/OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–02ï¼šå¡é¡¿æ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/02/OC%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%9602%EF%BC%9A%E5%8D%A1%E9%A1%BF%E6%A3%80%E6%B5%8B%E5%92%8C%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/","excerpt":"","text":"","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","permalink":"https://www.bboyzj.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"æ€§èƒ½ä¼˜åŒ–01ï¼šå†…å­˜æ³„æ¼æ£€æµ‹","slug":"OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–01ï¼šå†…å­˜æ³„æ¼æ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ","date":"2023-03-02T15:32:21.000Z","updated":"2023-03-08T21:33:57.542Z","comments":true,"path":"2023/03/02/OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–01ï¼šå†…å­˜æ³„æ¼æ£€æµ‹å’Œä¼˜åŒ–æ–¹æ¡ˆ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/02/OC%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%9601%EF%BC%9A%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%92%8C%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/","excerpt":"","text":"","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"æ€§èƒ½ä¼˜åŒ–","slug":"æ€§èƒ½ä¼˜åŒ–","permalink":"https://www.bboyzj.cn/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 03ï¼šå†…å­˜ç®¡ç†","slug":"OCå­¦ä¹ /OCå­¦ä¹ 03ï¼šå†…å­˜ç®¡ç†","date":"2023-03-02T10:51:48.000Z","updated":"2023-03-03T08:09:37.000Z","comments":true,"path":"2023/03/02/OCå­¦ä¹ /OCå­¦ä¹ 03ï¼šå†…å­˜ç®¡ç†/","link":"","permalink":"https://www.bboyzj.cn/2023/03/02/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A003%EF%BC%9A%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦ä»‹ç» å†…å­˜çš„äº”å¤§åŒº ã€å‡½æ•°æ ˆ å’Œ å†…å­˜ç®¡ç† å†…å­˜äº”å¤§åŒºåœ¨iOSä¸­ï¼Œå†…å­˜ä¸»è¦åˆ†ä¸º æ ˆåŒºã€å †åŒºã€å…¨å±€åŒºã€å¸¸é‡åŒºã€ä»£ç åŒº äº”ä¸ªåŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ ˆåŒºå®šä¹‰ æ ˆæ˜¯ ç³»ç»Ÿæ•°æ®ç»“æ„ï¼Œå…¶å¯¹åº”çš„ è¿›ç¨‹æˆ–è€…çº¿ç¨‹æ˜¯å”¯ä¸€çš„ æ ˆæ˜¯ å‘ä½åœ°å€æ‰©å±• çš„æ•°æ®ç»“æ„ æ ˆæ˜¯ä¸€å— è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œéµå¾ª å…ˆè¿›åå‡ºï¼ˆFILOï¼‰ åŸåˆ™ æ ˆåŒºä¸€èˆ¬åœ¨ è¿è¡Œæ—¶ åˆ†é… å­˜å‚¨ æ ˆåŒºæ˜¯ç”± ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å¹¶é‡Šæ”¾çš„ï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ å±€éƒ¨å˜é‡ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚å‡½æ•°çš„éšè—å‚æ•°ï¼ˆid self, SEL _cmdï¼‰ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå› ä¸ºæ ˆæ˜¯ç”± ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å¹¶é‡Šæ”¾ çš„ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥ å¿«é€Ÿé«˜æ•ˆ ç¡®å®šï¼šæ ˆçš„ å†…å­˜å¤§å°æœ‰é™åˆ¶ï¼Œæ•°æ®ä¸çµæ´» iOSä¸»çº¿ç¨‹å¤§å°æ˜¯1MB å…¶ä»–çº¿ç¨‹æ˜¯ 512KB MAC åªæœ‰ 8MB ä»¥ä¸Šå†…å­˜å¤§å°çš„è¯´æ˜ï¼Œåœ¨Threading Programming Guide ä¸­æœ‰ç›¸å…³è¯´æ˜ï¼Œå¦‚ä¸‹å›¾ï¼š å †åŒºå®šä¹‰ å †æ˜¯ å‘é«˜åœ°å€æ‰©å±• çš„æ•°æ®ç»“æ„ å †æ˜¯ ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œç±»ä¼¼äº é“¾è¡¨ç»“æ„ï¼ˆä¾¿äºå¢åˆ ï¼Œä¸ä¾¿äºæŸ¥è¯¢ï¼‰ï¼Œéµå¾ª å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰åŸåˆ™ å †çš„ åœ°å€ç©ºé—´ åœ¨iOSä¸­æ˜¯æ˜¯åŠ¨æ€çš„ å †åŒºçš„åˆ†é…ä¸€èˆ¬æ˜¯ä»¥åœ¨ è¿è¡Œæ—¶åˆ†é… å­˜å‚¨ å †åŒºæ˜¯ ç”±ç¨‹åºå‘˜åŠ¨æ€åˆ†é…å’Œé‡Šæ”¾ çš„ï¼Œå¦‚æœç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸåï¼Œå¯èƒ½ç”±æ“ä½œç³»ç»Ÿå›æ”¶ï¼Œä¸»è¦ç”¨äºå­˜æ”¾ï¼š OC ä¸­ä½¿ç”¨ alloc ã€ new å¼€è¾Ÿç©ºé—´åˆ›å»º å¯¹è±¡ ï¼Œæˆ–è€… blockç»è¿‡copyå C è¯­è¨€ä¸­ä½¿ç”¨ mallocã€callocã€realloc åˆ†é…çš„ç©ºé—´ï¼Œéœ€è¦ free é‡Šæ”¾ ä¸€èˆ¬ä¸€ä¸ª new/alloc å°±è¦å¯¹åº”ä¸€ä¸ª releaseï¼Œåœ¨ ARC ä¸‹ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ¨åˆé€‚ä½ç½®ä¸º OC å¯¹è±¡æ·»åŠ  release æ“ä½œï¼Œä¼šåœ¨å½“å‰ çº¿ç¨‹Runloopé€€å‡ºæˆ–ä¼‘çœ æ—¶é”€æ¯è¿™äº›å¯¹è±¡ã€‚MRC åˆ™éœ€ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šçµæ´»æ–¹ä¾¿ï¼Œæ•°æ®é€‚åº”é¢å¹¿æ³› ç¼ºç‚¹ï¼šéœ€ æ‰‹åŠ¨ç®¡ç†ã€é€Ÿåº¦æ…¢ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ å½“éœ€è¦è®¿é—®å †ä¸­æ•°æ®æ—¶ï¼Œä¸€èˆ¬éœ€è¦ å…ˆé€šè¿‡å¯¹è±¡è¯»å–åˆ°æ ˆåŒºçš„æŒ‡é’ˆåœ°å€ï¼Œç„¶åé€šè¿‡ æŒ‡é’ˆåœ°å€è®¿é—®å †åŒº å…¨å±€åŒºï¼ˆé™æ€åŒºï¼Œå³.bss &amp; .dataï¼‰å…¨å±€åŒºæ˜¯ ç¼–è¯‘æ—¶åˆ†é… çš„å†…å­˜ç©ºé—´ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ­¤å†…å­˜ä¸­çš„æ•°æ®ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ï¼Œä¸»è¦å­˜æ”¾ï¼š æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå³BSSåŒºï¼ˆ.bssï¼‰ å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå³DATAåŒºï¼ˆ.dataï¼‰ å…¶ä¸­ï¼Œå…¨å±€å˜é‡ æ˜¯æŒ‡å˜é‡å€¼å¯ä»¥åœ¨ è¿è¡Œæ—¶è¢«åŠ¨æ€ä¿®æ”¹ï¼Œè€Œ é™æ€å˜é‡ æ˜¯ static ä¿®é¥°çš„å˜é‡ï¼ŒåŒ…å« é™æ€å±€éƒ¨å˜é‡ å’Œ é™æ€å…¨å±€å˜é‡ å¸¸é‡åŒºï¼ˆå³.rodataï¼‰å¸¸é‡åŒºæ˜¯ ç¼–è¯‘æ—¶åˆ†é… çš„å†…å­˜ç©ºé—´ï¼Œåœ¨ ç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ï¼Œä¸»è¦å­˜æ”¾ï¼š å·²ç»ä½¿ç”¨äº†çš„ï¼Œä¸”æ²¡æœ‰æŒ‡å‘çš„ å­—ç¬¦ä¸²å¸¸é‡ å­—ç¬¦ä¸²å¸¸é‡å› ä¸ºå¯èƒ½åœ¨ç¨‹åºä¸­è¢«å¤šæ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±ä¼šæå‰åˆ†é…å†…å­˜ ä»£ç åŒºï¼ˆå³.textï¼‰ä»£ç åŒºæ˜¯ ç”±ç¼–è¯‘æ—¶åˆ†é…ï¼Œä¸»è¦ç”¨äºå­˜æ”¾ ç¨‹åºè¿è¡Œæ—¶çš„ä»£ç ï¼Œä»£ç ä¼šè¢«ç¼–è¯‘æˆ äºŒè¿›åˆ¶å­˜è¿›å†…å­˜ çš„ å†…å­˜äº”å¤§åŒºéªŒè¯è¿è¡Œä¸‹é¢çš„ä¸€æ®µä»£ç ï¼Œçœ‹çœ‹å˜é‡åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•åˆ†é…çš„ï¼š 1234567891011121314int a = 10; // å…¨å±€åŒºï¼ˆå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼‰char * b; // å…¨å±€åŒº(æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡)- (void)test&#123; NSInteger i = 123; // æ ˆåŒºï¼ˆå±€éƒ¨å˜é‡ï¼‰ NSLog(@&quot;içš„å†…å­˜åœ°å€ï¼š%p&quot;, &amp;i); NSString *string = @&quot;ZJ&quot;; // å¸¸é‡åŒºï¼ˆå­—ç¬¦ä¸²å¸¸é‡ï¼‰ NSLog(@&quot;stringçš„å†…å­˜åœ°å€ï¼š%p&quot;, string); NSLog(@&quot;&amp;stringçš„å†…å­˜åœ°å€ï¼š%p&quot;, &amp;string); NSObject *obj = [[NSObject alloc] init]; // å †åŒºï¼ˆallocå¯¹è±¡ï¼‰ NSLog(@&quot;objçš„å†…å­˜åœ°å€ï¼š%p&quot;, obj); NSLog(@&quot;&amp;objçš„å†…å­˜åœ°å€ï¼š%p&quot;, &amp;obj); &#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123452022-03-11 14:34:25.438913+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] içš„å†…å­˜åœ°å€ï¼š0x16f6f5a182022-03-11 14:34:25.438976+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] stringçš„å†…å­˜åœ°å€ï¼š0x1007100982022-03-11 14:34:25.438997+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] &amp;stringçš„å†…å­˜åœ°å€ï¼š0x16f6f5a102022-03-11 14:34:25.439014+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] objçš„å†…å­˜åœ°å€ï¼š0x280fa0bc02022-03-11 14:34:25.439031+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] &amp;objçš„å†…å­˜åœ°å€ï¼š0x16f6f5a08 å¯¹äº å±€éƒ¨å˜é‡iï¼Œ å­˜æ”¾åœ¨æ ˆåŒº å¯¹äº å­—ç¬¦ä¸²å¯¹è±¡stringï¼Œåˆ†åˆ«æ‰“å°äº† stringå¾—å¯¹è±¡åœ°å€ å’Œ stringå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ stringçš„ å¯¹è±¡åœ°å€ æ˜¯æ˜¯å­˜æ”¾åœ¨ å¸¸é‡åŒº string å¯¹è±¡çš„æŒ‡é’ˆåœ°å€ï¼Œæ˜¯å­˜æ”¾åœ¨ æ ˆåŒº å¯¹äº allocåˆ›å»ºçš„å¯¹è±¡objï¼Œåˆ†åˆ«æ‰“å°äº† objå¾—å¯¹è±¡åœ°å€ å’Œ objå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ objçš„ å¯¹è±¡åœ°å€ æ˜¯å­˜æ”¾åœ¨ å †åŒº obj å¯¹è±¡çš„æŒ‡é’ˆåœ°å€ æ˜¯å­˜æ”¾åœ¨ æ ˆåŒº å‡½æ•°æ ˆ å‡½æ•°æ ˆ åˆç§°ä¸º æ ˆåŒºï¼Œåœ¨å†…å­˜ä¸­ä»é«˜åœ°å€å¾€ä½åœ°å€åˆ†é…ï¼Œä¸å †åŒºç›¸å¯¹ï¼Œå…·ä½“å›¾ç¤ºè¯·çœ‹ä¸Šé¢ æ ˆå¸§ æ˜¯æŒ‡ å‡½æ•°ï¼ˆè¿è¡Œä¸­ä¸”æœªå®Œæˆï¼‰å ç”¨çš„ä¸€å—ç‹¬ç«‹çš„è¿ç»­å†…å­˜åŒºåŸŸ åº”ç”¨ä¸­æ–°åˆ›å»ºçš„ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸“ç”¨çš„æ ˆç©ºé—´ï¼Œæ ˆå¯ä»¥åœ¨çº¿ç¨‹æœŸé—´è‡ªç”±ä½¿ç”¨ï¼Œè€Œçº¿ç¨‹ä¸­æœ‰åƒåƒä¸‡ä¸‡çš„å‡½æ•°è°ƒç”¨ï¼Œè¿™äº›å‡½æ•° å…±äº« è¿›ç¨‹çš„è¿™ä¸ª æ ˆç©ºé—´ã€‚æ¯ä¸ªå‡½æ•°æ‰€ä½¿ç”¨çš„æ ˆç©ºé—´æ˜¯ä¸€ä¸ªæ ˆå¸§ï¼Œæ‰€æœ‰æ ˆå¸§å°±ç»„æˆäº†è¿™ä¸ªçº¿ç¨‹å®Œæˆçš„æ ˆ å‡½æ•°è°ƒç”¨æ˜¯å‘ç”Ÿåœ¨æ ˆä¸Š çš„ï¼Œæ¯ä¸ª å‡½æ•°çš„ç›¸å…³ä¿¡æ¯ï¼ˆä¾‹å¦‚å±€éƒ¨å˜é‡ã€è°ƒç”¨è®°å½•ç­‰ï¼‰éƒ½ å­˜å‚¨åœ¨ä¸€ä¸ªæ ˆå¸§ ä¸­ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ å‡½æ•°è°ƒç”¨ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªä¸å…¶ç›¸å…³çš„æ ˆå¸§ï¼Œç„¶åå°†å…¶ æ ˆå¸§å‹å…¥å‡½æ•°æ ˆï¼Œè€Œå½“å‡½æ•° æ‰§è¡Œç»“æŸï¼Œåˆ™å°†æ­¤å‡½æ•°å¯¹åº”çš„ æ ˆå¸§å‡ºæ ˆå¹¶é‡Šæ”¾æ‰ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ç»å…¸å›¾- ARMçš„æ ˆå¸§å¸ƒå±€æ–¹å¼ å…¶ä¸­ main stack frame ä¸ºè°ƒç”¨å‡½æ•°çš„æ ˆå¸§ func1 stack frame ä¸ºå½“å‰ å½“å‰å‡½æ•°ï¼ˆè¢«è°ƒç”¨è€…ï¼‰çš„æ ˆå¸§ æ ˆåº• åœ¨ é«˜ åœ°å€ï¼Œæ ˆå‘ä¸‹å¢é•¿ FP å°±æ˜¯ æ ˆåŸºå€ï¼Œå®ƒæŒ‡å‘å‡½æ•°çš„ æ ˆå¸§èµ·å§‹åœ°å€ SP åˆ™æ˜¯å‡½æ•°çš„ æ ˆæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ æ ˆé¡¶ çš„ä½ç½® ARMå‹æ ˆ çš„ é¡ºåº å¾ˆæ˜¯è§„åˆ™ï¼ˆä¹Ÿæ¯”è¾ƒå®¹æ˜“è¢«é»‘å®¢æ”»ç ´ï¼‰ï¼Œä¾æ¬¡ä¸º å½“å‰å‡½æ•°æŒ‡é’ˆPCã€è¿”å›æŒ‡é’ˆLRã€æ ˆæŒ‡é’ˆSPã€æ ˆåŸºå€FPã€ä¼ å…¥å‚æ•°ä¸ªæ•°åŠæŒ‡é’ˆã€æœ¬åœ°å˜é‡ å’Œ ä¸´æ—¶å˜é‡ã€‚å¦‚æœå‡½æ•°å‡†å¤‡è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œè·³è½¬ä¹‹å‰ä¸´æ—¶å˜é‡åŒºå…ˆè¦ä¿å­˜å¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•° ARM ä¹Ÿå¯ä»¥ ç”¨æ ˆåŸºå€å’Œæ ˆæŒ‡é’ˆæ˜ç¡®æ ‡ç¤ºæ ˆå¸§çš„ä½ç½®ï¼Œæ ˆæŒ‡é’ˆSPä¸€ç›´ç§»åŠ¨ï¼ŒARMçš„ç‰¹ç‚¹æ˜¯ï¼Œä¸¤ä¸ªæ ˆç©ºé—´å†…çš„åœ°å€ï¼ˆSP+FPï¼‰å‰é¢ï¼Œå¿…ç„¶æœ‰ä¸¤ä¸ªä»£ç åœ°å€ï¼ˆPC+LPï¼‰æ˜ç¡®æ ‡ç¤ºç€è°ƒç”¨å‡½æ•°ä½ç½®å†…çš„æŸä¸ªåœ°å€ å †æ ˆæº¢å‡ºä¸€èˆ¬æƒ…å†µä¸‹åº”ç”¨ç¨‹åºæ˜¯ä¸éœ€è¦è€ƒè™‘å †å’Œæ ˆçš„å¤§å°çš„ï¼Œä½†æ˜¯äº‹å®ä¸Šå †å’Œæ ˆä¸æ˜¯æ— ä¸Šé™çš„ï¼Œè¿‡å¤šçš„é€’å½’ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼Œè¿‡å¤šçš„allocå˜é‡ä¼šå¯¼è‡´å †æº¢å‡º æ‰€ä»¥ é¢„é˜²å †æ ˆæº¢å‡º çš„æ–¹æ³•ï¼š é¿å…å±‚æ¬¡è¿‡æ·± çš„ é€’å½’ è°ƒç”¨ ä¸è¦ä½¿ç”¨è¿‡å¤šçš„å±€éƒ¨å˜é‡ï¼Œæ§åˆ¶å±€éƒ¨å˜é‡çš„å¤§å° é¿å…åˆ†é… å ç”¨ç©ºé—´ å¤ªå¤§çš„å¯¹è±¡ï¼Œå¹¶ åŠæ—¶é‡Šæ”¾ å®åœ¨ä¸è¡Œï¼Œé€‚å½“çš„æƒ…æ™¯ä¸‹ è°ƒç”¨ç³»ç»ŸAPIä¿®æ”¹çº¿ç¨‹çš„å †æ ˆå¤§å° æ ˆå¸§ç¤ºä¾‹æè¿°ä¸‹é¢ä»£ç çš„æ ˆå¸§å˜åŒ– æ ˆå¸§ç¨‹åºç¤ºä¾‹ 1234567891011int Add(int x,int y) &#123; int z = 0; z = x + y; return z;&#125;int main() &#123; int a = 10; int b = 20; int ret = Add(a, b);&#125; ç¨‹åºæ‰§è¡Œæ—¶ï¼Œæ ˆåŒºä¸­æ ˆå¸§çš„å˜åŒ–å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å†…å­˜ç®¡ç†æ¦‚è¿° åœ¨iOSä¸­å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½å¬è¯´è¿‡å†…å­˜ç®¡ç†ã€‚iOSçš„å†…å­˜ç®¡ç†ä¸€èˆ¬æŒ‡çš„æ˜¯OCå¯¹è±¡çš„å†…å­˜ç®¡ç†ï¼Œå› ä¸ºOCå¯¹è±¡åˆ†é…åœ¨å †å†…å­˜ï¼Œå †å†…å­˜éœ€è¦ç¨‹åºå‘˜è‡ªå·±å»åŠ¨æ€åˆ†é…å’Œå›æ”¶ï¼›åŸºç¡€æ•°æ®ç±»å‹(éOCå¯¹è±¡)åˆ™åˆ†é…åœ¨æ ˆå†…å­˜ä¸­ï¼Œè¶…è¿‡ä½œç”¨åŸŸå°±ä¼šç”±ç³»ç»Ÿæ£€æµ‹å›æ”¶ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹å†…å­˜ç®¡ç†å¾—ä¸åˆ°ä½ï¼Œå°±æœ‰å¯èƒ½é€ æˆå†…å­˜æ³„éœ²ã€‚ æˆ‘ä»¬é€šå¸¸è®²çš„å†…å­˜ç®¡ç†ï¼Œå®é™…ä¸Šä»å‘å±•çš„è§’åº¦æ¥è¯´ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šMRCå’ŒARCã€‚ MRCæŒ‡çš„æ˜¯ æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å»ç¼–å†™å†…å­˜ç®¡ç†çš„ä»£ç ï¼› ARCæŒ‡çš„æ˜¯ è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåœ¨æ­¤å†…å­˜ç®¡ç†æ¨¡å¼ä¸‹ç”±LLVMç¼–è¯‘å™¨å’ŒOCè¿è¡Œæ—¶åº“ç”Ÿæˆç›¸åº”å†…å­˜ç®¡ç†çš„ä»£ç ã€‚ å¼•ç”¨è®¡æ•° åœ¨ OC ä¸­ï¼Œä½¿ç”¨ å¼•ç”¨è®¡æ•° æ¥ è¿›è¡Œå†…å­˜ç®¡ç†ã€‚ æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªä¸å…¶ç›¸å¯¹åº”çš„å¼•ç”¨è®¡æ•°å™¨ï¼Œå½“æŒæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å°±ä¼šé€’å¢ï¼›å½“è¿™ä¸ªå¯¹è±¡çš„æŸä¸ªæŒæœ‰è¢«é‡Šæ”¾ï¼Œè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å°±ä¼šé€’å‡ã€‚å½“è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¼šè¢«ç³»ç»Ÿå›æ”¶ã€‚ å½“ä¸€ä¸ªå¯¹è±¡ä½¿ç”¨å®Œæ²¡æœ‰é‡Šæ”¾ï¼Œæ­¤æ—¶å…¶å¼•ç”¨è®¡æ•°æ°¸è¿œå¤§äº1ã€‚è¯¥å¯¹è±¡å°±ä¼šä¸€ç›´å ç”¨å…¶åˆ†é…åœ¨å †å†…å­˜çš„ç©ºé—´ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚å†…å­˜æ³„éœ²åˆ°ä¸€å®šç¨‹åº¦æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚ MRC ç®€ä»‹ å…¨ç§° Manual Reference Countingï¼Œç®¡ç†é€šè¿‡ä½¿ç”¨ retain, release, ä»¥åŠ autorelease çš„æ¶ˆæ¯å‘é€æ¥å®ç°ã€‚ retain: æŒæœ‰ï¼ˆæ‹¥æœ‰ï¼‰å¯¹è±¡ï¼Œå¯¹è±¡å¼•ç”¨æ•°åŠ  1 release: é‡Šæ”¾å¯¹è±¡ï¼Œå¯¹è±¡å¼•ç”¨æ•°å‡ 1 autorelease: é€šçŸ¥ç³»ç»Ÿï¼Œåœ¨ @autoreleasepool ä»£ç å—ç»“æŸæ—¶ï¼Œå¯¹å¯¹è±¡è°ƒç”¨ release ç®¡ç†åŸåˆ™ è‡ªå·±åˆ›å»ºçš„å¯¹è±¡ï¼Œè‡ªå·±è·å¾—æ‹¥æœ‰æƒ åœ¨è‹¹æœè§„å®šä¸­ï¼Œä½¿ç”¨ alloc/new/copy/mutableCopy åˆ›å»ºè¿”å›çš„å¯¹è±¡å½’è°ƒç”¨è€…æ‰€æœ‰ï¼Œä¾‹å¦‚ä»¥ä¸‹ 1234/* NSMutableArrayç±»å¯¹è±¡A */NSMutableArray *array = [[NSMutableArray alloc] init]; NSLog(@&quot;%p&quot;, array);[array release]; // é‡Šæ”¾ ç”±äºå¯¹è±¡ A ç”± alloc ç”Ÿæˆï¼Œç¬¦åˆè‹¹æœè§„å®šï¼ŒæŒ‡é’ˆå˜é‡arrayæŒ‡å‘å¹¶æŒæœ‰å¯¹è±¡Aï¼Œå¼•ç”¨è®¡æ•°å™¨ä¼šåŠ  1ã€‚å¦å¤–ï¼Œarrayåœ¨ä½¿ç”¨å®Œå¯¹è±¡Aåéœ€è¦å¯¹å…¶è¿›è¡Œé‡Šæ”¾ã€‚å½“è°ƒç”¨releaseåï¼Œé‡Šæ”¾äº†å…¶å¯¹å¯¹è±¡Açš„å¼•ç”¨ï¼Œè®¡æ•°å™¨å‡1ã€‚å¯¹è±¡Aæ­¤æ—¶å¼•ç”¨è®¡æ•°å€¼ä¸ºé›¶ï¼Œæ‰€ä»¥å¯¹è±¡Aè¢«å›æ”¶ã€‚ä¸èƒ½è®¿é—®å·²ç»è¢«å›æ”¶çš„å¯¹è±¡ï¼Œä¼šå‘ç”Ÿå´©æºƒã€‚ åˆ«äººåˆ›å»ºçš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ retain æ¥è·å¾—æ‹¥æœ‰æƒ 123456789// ä¾‹å¦‚å·²æœ‰ fooArray, é€šè¿‡ array æ–¹æ³•è·å¾—å…¶å¼•ç”¨NSArray *bar = [fooArray array];// ä¸å¯ä»¥ç›´æ¥è°ƒç”¨ releaseï¼Œå› ä¸ºæ²¡æœ‰æ‹¥æœ‰æƒ// [bar release];// éœ€è¦å…ˆ retain æ¥è·å¾—æ‹¥æœ‰æƒï¼Œç„¶åæ‰èƒ½é‡Šæ”¾[bar retain];[bar release]; ä½ æ‰€æ‹¥æœ‰çš„å¯¹è±¡ä¸å†éœ€è¦ä½¿ç”¨æ—¶ï¼Œå¿…é¡»å°†å…¶é‡Šæ”¾ ä¸èƒ½é‡Šæ”¾ä½ ä¸æ‹¥æœ‰çš„å¯¹è±¡ retain retainå’Œå±æ€§ æˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§æ¥ä¿å­˜å¯¹è±¡ï¼Œå¦‚æœä¸€ä¸ªå±æ€§ä¸ºå¼ºå¼•ç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å±æ€§çš„å®ä¾‹å˜é‡å’Œå­˜å–æ–¹æ³•æ¥å¯¹æŸä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚æŸä¸ªå±æ€§çš„setteræ–¹æ³•å¦‚ä¸‹ï¼š 12345678910- (void)setPerson:(Person *)person &#123; [person retain]; [_person release]; _person = person; &#125; æˆ‘ä»¬é€šè¿‡ retainæ–°å€¼ï¼Œreleaseæ—§å€¼ï¼Œå†ç»™å®ä¾‹å˜é‡æ›´æ–°å€¼ã€‚ éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šéœ€è¦å…ˆretainæ–°å€¼ï¼Œå†releaseæ—§å€¼ã€‚å› ä¸ºå¦‚æœæ–°æ—§å€¼æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„è¯ï¼Œå…ˆreleaseå°±æœ‰å¯èƒ½å¯¼è‡´è¯¥å¯¹è±¡è¢«ç³»ç»Ÿå›æ”¶ï¼Œå†å»retainå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930#import &quot;ViewController.h&quot;#import &quot;Person.h&quot;@interface ViewController ()@property (nonatomic, strong)Person *person;@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; // å®ä¾‹å˜é‡æŒæœ‰Personç±»å¯¹è±¡(På¯¹è±¡)ã€‚è¿™æ ·èµ‹å€¼ä¸ä¼šè°ƒç”¨setæ–¹æ³• _person = [[Person alloc] init]; // è°ƒç”¨setæ–¹æ³• self.person = _person; &#125;- (void)setPerson:(Person *)person &#123; // releaseé‡Šæ”¾å¯¹På¯¹è±¡çš„å¼•ç”¨ï¼ŒPå¯¹è±¡å¼•ç”¨è®¡æ•°å€¼å˜ä¸ºé›¶ï¼Œåˆ™På¯¹è±¡è¢«ç³»ç»Ÿå›æ”¶ [_person release]; // ç”±äºPå¯¹è±¡å·²ç»è¢«å›æ”¶ï¼Œå†å»retainå°±å®¹æ˜“å‡ºé—®é¢˜ [person retain]; _person = person;&#125;@end ç”±äºPå¯¹è±¡è¢«å›æ”¶ï¼Œå¯¹åº”å…¶æ‰€åˆ†é…çš„å†…å­˜è¢«ç½®äº å¯ç”¨å†…å­˜æ±  ä¸­ã€‚å¦‚æœè¯¥å†…å­˜æœªè¢«è¦†å†™ï¼Œé‚£ä¹ˆPå¯¹è±¡ä¾ç„¶æœ‰æ•ˆï¼›å¦‚æœå†…å­˜è¢«è¦†å†™ï¼Œé‚£ä¹ˆå®ä¾‹å˜é‡_personå°±ä¼šæŒ‡å‘ä¸€ä¸ªè¢«è¦†å†™çš„æœªçŸ¥å¯¹è±¡çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆå®ä¾‹å˜é‡å°±å˜æˆä¸€ä¸ª æ‚¬æŒ‚æŒ‡é’ˆã€‚ retainå’Œæ•°ç»„ å¦‚æœæˆ‘ä»¬æŠŠä¸€ä¸ªå¯¹è±¡åŠ å…¥åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé‚£ä¹ˆè¯¥æ•°ç»„çš„addObjectæ–¹æ³•ä¼šå¯¹è¯¥å¯¹è±¡è°ƒç”¨retainæ–¹æ³•ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š 12345678// personè·å¾—å¹¶æŒæœ‰På¯¹è±¡ï¼ŒPå¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º1Person *person = [[Person alloc] init]; // Personç±»å¯¹è±¡ç”Ÿæˆçš„På¯¹è±¡ NSMutableArray *array = [NSMutableArray array]; // personè¢«åŠ å…¥åˆ°æ•°ç»„ï¼Œå¯¹è±¡På¼•ç”¨è®¡æ•°å€¼ä¸º2[array addObject:person]; æ­¤æ—¶ï¼Œå¯¹è±¡Pè¢«personå’Œarrayä¸¤ä¸ªå˜é‡åŒæ—¶æŒæœ‰ã€‚ release è‡ªå·±æŒæœ‰çš„å¯¹è±¡è‡ªå·±é‡Šæ”¾ å½“æˆ‘ä»¬æŒæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœåœ¨ä¸éœ€è¦ç»§ç»­ä½¿ç”¨è¯¥å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œé‡Šæ”¾(release)ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š 12345678// arrayè·å¾—å¹¶æŒæœ‰NSArrayç±»å¯¹è±¡NSArray *array = [[NSArray alloc] init]; // å½“ä¸å†éœ€è¦ä½¿ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œéœ€è¦é‡Šæ”¾[array release]; // objè·å¾—ä½†ä¸æŒæœ‰è¯¥å¯¹è±¡id obj = [NSArray array]; éè‡ªå·±æŒæœ‰çš„å¯¹è±¡ä¸è¦é‡Šæ”¾ å½“æˆ‘ä»¬ä¸æŒæœ‰æŸä¸ªå¯¹è±¡ï¼Œå´å¯¹è¯¥å¯¹è±¡è¿›è¡Œé‡Šæ”¾ï¼Œåº”ç”¨ç¨‹åºå°±ä¼šå´©æºƒã€‚ 12345678// è·å¾—å¹¶æŒæœ‰Aå¯¹è±¡Person *p = [[Person alloc] init]; // Personç±»å¯¹è±¡A // å¯¹è±¡Aå¼•ç”¨è®¡æ•°ä¸ºé›¶ï¼Œæ‰€ä»¥å¯¹è±¡Aè¢«å›æ”¶[p release];// é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡[p release]; å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½è®¿é—®æŸä¸ªå·²ç»è¢«é‡Šæ”¾çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰€å çš„å †ç©ºé—´å¦‚æœè¢«è¦†å†™å°±ä¼šå‘ç”Ÿå´©æºƒçš„æƒ…å†µã€‚ autorelease autorelease æŒ‡çš„æ˜¯è‡ªåŠ¨é‡Šæ”¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¶åˆ° autorelease çš„æ—¶å€™ï¼Œè¯¥ å¯¹è±¡å°±ä¼šè¢«æ³¨å†Œåˆ°å½“å‰å¤„äºæ ˆé¡¶çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆautorelease poolï¼‰ã€‚å¦‚æœæ²¡æœ‰ä¸»åŠ¨ç”Ÿæˆè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œåˆ™å½“å‰è‡ªåŠ¨é‡Šæ”¾æ± å¯¹åº”çš„æ˜¯ä¸»è¿è¡Œå¾ªç¯çš„è‡ªåŠ¨é‡Šæ”¾æ± ã€‚åœ¨å½“å‰çº¿ç¨‹çš„RunLoopè¿›å…¥ä¼‘çœ å‰ï¼Œå°±ä¼šå¯¹è¢«æ³¨å†Œåˆ°è¯¥è‡ªåŠ¨é‡Šæ”¾æ± çš„æ‰€æœ‰å¯¹è±¡è¿›è¡Œä¸€æ¬¡releaseæ“ä½œã€‚ autoreleaseå’Œreleaseçš„åŒºåˆ«æ˜¯ï¼š releaseï¼šæ˜¯é©¬ä¸Šé‡Šæ”¾å¯¹æŸä¸ªå¯¹è±¡çš„å¼ºå¼•ç”¨ï¼› autoreleaseï¼šæ˜¯å»¶è¿Ÿé‡Šæ”¾æŸä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ 12345678910111213141516171819202122232425&#123; // å¤–éƒ¨è°ƒç”¨ Person *p = [Person person]; NSLog(@&quot;%p&quot;, p); //ä½¿ç”¨æ— é¡»retain // æŒæœ‰åˆ™éœ€è¦retain [p retain]; _person = p; [_person release];&#125;// Personç±»å†…éƒ¨å®šä¹‰+ (id)person &#123; //åˆ›å»ºçš„Personç±»å¯¹è±¡ç”±personè·å¾—å¹¶æŒæœ‰ Person *person = [[Person alloc] init]; // [person release]; // å°† person å¯¹è±¡æ”¾å…¥è‡ªåŠ¨é‡Šæ”¾æ±  [person autorelease]; return person;&#125; åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œä»æ–¹æ³•åpersonçŸ¥é“ï¼Œåˆ›å»ºçš„å¯¹è±¡ç”±pæŒ‡é’ˆå˜é‡è·å¾—ä½†ä¸æŒæœ‰ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œpersonè·å¾—å¹¶æŒæœ‰äº†Personç±»å¯¹è±¡ï¼Œæ‰€è¿”å›çš„personå¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ 1ã€‚æ¢å¥è¯è¯´ï¼Œè°ƒç”¨è€…éœ€è¦é¢å¤–å¤„ç†è¿™å¤šå‡ºæ¥çš„ä¸€ä¸ªæŒæœ‰æ“ä½œã€‚å¦å¤–ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨å‡½æ•°å†…éƒ¨è°ƒç”¨releaseï¼Œä¸ç„¶å¯¹è±¡è¿˜æ²¡è¿”å›å°±å·²ç»è¢«ç³»ç»Ÿå›æ”¶ã€‚è¿™æ—¶å€™ä½¿ç”¨autoreleaseå°±èƒ½å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ åªè¦æŠŠè¦è¿”å›çš„å¯¹è±¡è°ƒç”¨autoreleaseæ–¹æ³•ï¼Œæ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± å°±èƒ½å»¶é•¿personå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿å…¶åœ¨ autorelease poolé”€æ¯(drain)å‰ä¾ç„¶èƒ½å¤Ÿå­˜æ´»ã€‚ å¦å¤–ï¼Œpersonå¯¹è±¡åœ¨è¿”å›æ—¶è°ƒç”¨äº† autoreleaseæ–¹æ³•ã€‚è¯¥å¯¹è±¡å·²ç»åœ¨è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹è±¡pï¼Œæ— é¡»å†é€šè¿‡[p retain]è®¿é—®ï¼›ä¸è¿‡ï¼Œå¦‚æœè¦ç”¨å®ä¾‹å˜é‡æŒæœ‰è¯¥å¯¹è±¡ï¼Œåˆ™éœ€è¦å¯¹å˜é‡pè¿›è¡Œä¸€æ¬¡retainæ“ä½œï¼Œå®ä¾‹å˜é‡ä½¿ç”¨å®Œè¯¥å¯¹è±¡éœ€è¦é‡Šæ”¾è¯¥å¯¹è±¡ã€‚ autorelease pool autorelease pool å’Œ RunLoop(è¿è¡Œå¾ªç¯) å½“åº”ç”¨ç¨‹åºå¯åŠ¨ï¼Œç³»ç»Ÿé»˜è®¤ä¼š å¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ ä¸»çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹ä¹Ÿæœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„è‡ªåŠ¨é‡Šæ”¾æ± ã€‚ æ¯æ¡çº¿ç¨‹éƒ½åŒ…å«ä¸€ä¸ªä¸å…¶å¯¹åº”çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå½“æŸæ¡çº¿ç¨‹è¢«ç»ˆæ­¢çš„æ—¶å€™ï¼Œå¯¹åº”è¯¥çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¼šè¢«é”€æ¯ã€‚åŒæ—¶ï¼Œå¤„äºè¯¥è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡å°†ä¼šè¿›è¡Œä¸€æ¬¡ release æ“ä½œã€‚ ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸¸è§çš„ ARC ä¸‹çš„ main.h æ–‡ä»¶ï¼š 12345int main(int argc, char * argv[]) &#123; @autoreleasepool &#123; return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); &#125;&#125; è¯¥è‡ªåŠ¨é‡Šæ”¾æ± ç”¨æ¥é‡Šæ”¾åœ¨ä¸»çº¿ç¨‹ä¸‹æ³¨å†Œåˆ°è¯¥è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ å¼€å¯ä¸€æ¡å­çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨è¯¥çº¿ç¨‹ å¼€å¯RunLoop çš„æ—¶å€™ï¼Œéœ€è¦ä¸ºå…¶å¢åŠ ä¸€ä¸ªautorelease poolï¼Œè¿™æ ·æœ‰åŠ©äºä¿è¯å†…å­˜çš„å®‰å…¨ã€‚ autorelease poolå’Œé™ä½å†…å­˜å³°å€¼ å½“æˆ‘ä»¬æ‰§è¡Œä¸€äº›å¤æ‚çš„æ“ä½œï¼Œç‰¹åˆ«æ˜¯å¦‚æœè¿™äº›å¤æ‚çš„æ“ä½œè¦è¢«å¾ªç¯æ‰§è¡Œï¼Œé‚£ä¹ˆä¸­é—´ä¼šå…ä¸äº†ä¼šäº§ç”Ÿä¸€äº›ä¸´æ—¶å˜é‡ã€‚å½“è¢«åŠ åˆ°ä¸»çº¿ç¨‹è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡è¶Šæ¥è¶Šæ¥å¤šï¼Œå´æ²¡æœ‰å¾—åˆ°åŠæ—¶é‡Šæ”¾ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚ä»¥ä¸‹ä¾‹å­æ‰€ç¤ºï¼š 123456789101112for (int i = 0; i &lt; largeNumber; i++) &#123; // åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ±  NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init]; // äº§ç”Ÿè®¸å¤šè¢«æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± çš„ä¸´æ—¶å¯¹è±¡ id obj = [Person personWithComplexOperation]; // é‡Šæ”¾æ± ä¸­å¯¹è±¡ [pool drain]; &#125; å¦‚ä¸Šè¿°ä¾‹å­æ‰€ç¤ºï¼Œæˆ‘ä»¬æ‰§è¡Œçš„å¾ªç¯æ¬¡æ•°æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°å­—ã€‚å¹¶ä¸”è°ƒç”¨personWithComplexOperationæ–¹æ³•çš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿè®¸å¤šä¸´æ—¶å¯¹è±¡ï¼Œæ‰€äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡æœ‰å¯èƒ½ä¼šè¢«æ³¨å†Œåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚æˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸå‰æŠŠè¯¥è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡æ‰§è¡Œreleaseæ“ä½œé‡Šæ”¾æ‰ï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆåœ°é™ä½å†…å­˜çš„å³°å€¼äº†ã€‚ ARC æ¦‚è¿° Automatic Reference Countingï¼Œè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼Œå³ ARCï¼ŒWWDC2011 å’Œ iOS5 æ‰€å¼•å…¥çš„æœ€å¤§çš„å˜é©å’Œæœ€æ¿€åŠ¨äººå¿ƒçš„å˜åŒ–ã€‚ARCæ˜¯æ–°çš„LLVM 3.0ç¼–è¯‘å™¨çš„ä¸€é¡¹ç‰¹æ€§ï¼Œä½¿ç”¨ARCï¼Œå¯ä»¥è¯´ä¸¾è§£å†³äº†å¹¿å¤§iOSå¼€å‘è€…æ‰€æ†æ¨çš„æ‰‹åŠ¨å†…å­˜ç®¡ç†çš„éº»çƒ¦ã€‚ æ­¤å¤„çš„ A å°±æ˜¯ automaticã€‚å…¶å® ARC åªæ˜¯æ¯” MRC å¤šäº†ä¸€æ­¥ï¼Œå°±æ˜¯åœ¨ ç¼–è¯‘æ—¶ç¼–è¯‘å™¨è‡ªåŠ¨å¸®å¼€å‘è€…æ·»åŠ  retain, release ä»¥åŠ autorelease çš„è°ƒç”¨ï¼Œåº•å±‚çš„å†…å­˜ç®¡ç†æœºåˆ¶è¿˜æ˜¯å’Œ MRC ä¸€æ ·ã€‚ åœ¨ ARC æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸åœ¨å¯¹è±¡å˜é‡çš„å£°æ˜é‡Œç”¨ å±æ€§æ ‡è®°ç¬¦ æ¥æŒ‡å¼• ARC æœºåˆ¶æ¥ç®¡ç†æˆ‘ä»¬çš„å¯¹è±¡å˜é‡ï¼Œå®ƒä»¬æ˜¯ï¼šstrong, retain, weak, copy, assignã€‚é»˜è®¤æ ‡è®°æ˜¯ strong æ ‡è®°ç¬¦çš„åŒºåˆ« strong: é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ å¼ºå¼•ç”¨ï¼Œå¯¹åº” MRC ä¸‹çš„ retainï¼Œå³å¼•ç”¨æ•°åŠ  1 retain: åŒ strong weak: å¼±å¼•ç”¨ï¼Œä¸å¢åŠ å¼•ç”¨æ•°ï¼Œå¼•ç”¨çš„å¯¹è±¡è¢«é‡Šæ”¾åå˜ä¸º nil copy: å¯¹å¯¹è±¡è¿›è¡Œ copy åå†èµ‹å€¼ï¼Œå› æ­¤å¯¹è±¡å¿…é¡»éµå¾ª NSCopying åè®®ã€‚å¦‚ï¼š 123@property(copy)Foo *foo;...self.foo = bar; // ç›¸å½“äº self.foo = [bar copy]; assign: ä¸€èˆ¬ç”¨äºåŸå§‹æ•°æ®ç±»å‹ï¼ˆprimitive typeï¼‰çš„èµ‹å€¼ã€‚å¯ä»¥ç”¨äºå¯¹è±¡ï¼Œæ•ˆæœç›¸å½“äº weakï¼Œå¯æ˜¯æœ‰ä¸€ä¸ªå‘æ˜¯å½“å¯¹è±¡è¢«é‡Šæ”¾åï¼Œassign å±æ€§çš„å˜é‡ä¸ä¼šå˜æˆ nilï¼Œè€Œæ˜¯æˆä¸º é‡æŒ‡é’ˆï¼ˆdangling pointerï¼‰ï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨åœ¨å¯¹è±¡ä¸Šã€‚ å€ŸåŠ©ä»¥ä¸Šçš„å±æ€§æ ‡è®°ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡å£°æ˜çš„æ—¶å€™é›†ä¸­åˆ¶å®šå®ƒä»¬çš„å†…å­˜ç®¡ç†ç­–ç•¥ï¼Œæ¸…æ™°æ˜äº†ã€‚ ARCçš„åˆ¤æ–­åŸåˆ™ ARCåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦éœ€è¦é‡Šæ”¾ä¸æ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æ¥è¿›è¡Œåˆ¤æ–­çš„ï¼Œè€Œæ˜¯é€šè¿‡å¼ºæŒ‡é’ˆæ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯å¼ºæŒ‡é’ˆ? å¼ºæŒ‡é’ˆ é»˜è®¤æ‰€æœ‰å¯¹è±¡çš„æŒ‡é’ˆå˜é‡éƒ½æ˜¯å¼ºæŒ‡é’ˆ è¢«__strongä¿®é¥°çš„æŒ‡é’ˆ 12Person *p1 = [[Person alloc] init];__strong Person *p2 = [[Person alloc] init]; å¼±æŒ‡é’ˆ è¢« __weak ä¿®é¥°çš„æŒ‡é’ˆ 1__weak Person *p = [[Person alloc] init]; ARCå¦‚ä½•é€šè¿‡å¼ºæŒ‡é’ˆæ¥åˆ¤æ–­ï¼Ÿ åªè¦è¿˜æœ‰ä¸€ä¸ªå¼ºæŒ‡é’ˆå˜é‡æŒ‡å‘å¯¹è±¡ï¼Œå¯¹è±¡å°±ä¼šä¿æŒåœ¨å†…å­˜ä¸­ ARCçš„ä½¿ç”¨ 123456int main(int argc, const char * argv[]) &#123; // ä¸ç”¨å†™release, mainå‡½æ•°æ‰§è¡Œå®Œæ¯•åpä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ Person *p = [[Person alloc] init]; return 0;&#125; ARCçš„æ³¨æ„ç‚¹ ä¸å…è®¸è°ƒç”¨å¯¹è±¡çš„ releaseæ–¹æ³• ä¸å…è®¸è°ƒç”¨ autoreleaseæ–¹æ³• é‡å†™çˆ¶ç±»çš„deallocæ–¹æ³•æ—¶ï¼Œä¸èƒ½å†è°ƒç”¨ [super dealloc]; ARCä¸‹å•å¯¹è±¡å†…å­˜ç®¡ç† å±€éƒ¨å˜é‡é‡Šæ”¾å¯¹è±¡éšä¹‹è¢«é‡Šæ”¾ 12345678int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; Person *p = [[Person alloc] init]; &#125; // æ‰§è¡Œåˆ°è¿™ä¸€è¡Œå±€éƒ¨å˜é‡pé‡Šæ”¾ // ç”±äºæ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘å¯¹è±¡, æ‰€ä»¥å¯¹è±¡ä¹Ÿé‡Šæ”¾ return 0;&#125; æ¸…ç©ºæŒ‡é’ˆå¯¹è±¡éšä¹‹è¢«é‡Šæ”¾ 12345678int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; Person *p = [[Person alloc] init]; p = nil; // æ‰§è¡Œåˆ°è¿™ä¸€è¡Œ, ç”±äºæ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘å¯¹è±¡, æ‰€ä»¥å¯¹è±¡è¢«é‡Šæ”¾ &#125; return 0;&#125; é»˜è®¤æ¸…ç©ºæ‰€æœ‰æŒ‡é’ˆéƒ½æ˜¯å¼ºæŒ‡é’ˆ 123456789int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // p1å’Œp2éƒ½æ˜¯å¼ºæŒ‡é’ˆ Person *p1 = [[Person alloc] init]; __strong Person *p2 = [[Person alloc] init]; &#125; return 0;&#125; å¼±æŒ‡é’ˆéœ€è¦æ˜ç¡®è¯´æ˜ æ³¨æ„: åƒä¸‡ä¸è¦ä½¿ç”¨å¼±æŒ‡é’ˆä¿å­˜æ–°åˆ›å»ºçš„å¯¹è±¡ 12345678int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // pæ˜¯å¼±æŒ‡é’ˆ, å¯¹è±¡ä¼šè¢«ç«‹å³é‡Šæ”¾ __weak Person *p1 = [[Person alloc] init]; NSLog(@&quot;%@&quot;,p); &#125; return 0;&#125; æ‰“å°ç»“æœï¼š 12020-07-31 18:02:51.021697+0800 iOS-OCä¹‹ARC[2134:984503] (null) ARCä¸‹å¤šå¯¹è±¡å†…å­˜ç®¡ç† ARCå’ŒMRCä¸€æ ·, æƒ³æ‹¥æœ‰æŸä¸ªå¯¹è±¡å¿…é¡»ç”¨å¼ºæŒ‡é’ˆä¿å­˜å¯¹è±¡, ä½†æ˜¯ä¸éœ€è¦åœ¨deallocæ–¹æ³•ä¸­release 1234567@interface Person : NSObject// MRCå†™æ³•//@property (nonatomic, retain) Dog *dog;// ARCå†™æ³•@property (nonatomic, strong) Dog *dog;@end è‡ªåŠ¨é‡Šæ”¾æ±  æ¦‚è¿° AutoreleasePoolï¼ˆè‡ªåŠ¨é‡Šæ”¾æ± ï¼‰æ˜¯ OC ä¸­çš„ä¸€ç§ å†…å­˜è‡ªåŠ¨å›æ”¶æœºåˆ¶ã€‚ å½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ autorelease æ¶ˆæ¯æ—¶ï¼Œä¼šå°†å¯¹è±¡åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè€Œæ˜¯ç­‰åˆ° runloopä¼‘çœ æˆ–è¶…å‡ºautoreleasepoolä½œç”¨åŸŸ ä¹‹åè¿›è¡Œ é‡Šæ”¾ã€‚ MRC ä¸‹ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ±  åœ¨MRCç¯å¢ƒä¸­ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± éœ€è¦ç”¨åˆ° NSAutoreleasePool å¯¹è±¡ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå°±ç›¸å½“äºCè¯­è¨€å˜é‡çš„ä½œç”¨åŸŸã€‚å¯¹äºæ‰€æœ‰è°ƒç”¨è¿‡ autoreleaseæ–¹æ³•çš„å¯¹è±¡ï¼Œåœ¨åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡æ—¶ï¼Œéƒ½å°†è°ƒç”¨releaseå®ä¾‹æ–¹æ³•ã€‚ç”¨æºä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š 12345678910111213// MRCç¯å¢ƒä¸‹çš„æµ‹è¯•ï¼š// ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆå¹¶æŒæœ‰é‡Šæ”¾æ± NSAutoreleasePoolå¯¹è±¡;NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];// ç¬¬äºŒæ­¥ï¼šè°ƒç”¨å¯¹è±¡çš„autoreleaseå®ä¾‹æ–¹æ³•;id obj = [[NSObject alloc] init];[obj autorelease];// ç¬¬ä¸‰æ­¥ï¼šåºŸå¼ƒNSAutoreleasePoolå¯¹è±¡;[pool drain]; // å‘poolç®¡ç†çš„æ‰€æœ‰å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œç›¸å½“äº[obj release]// objå·²ç»é‡Šæ”¾ï¼Œå†æ¬¡è°ƒç”¨ä¼šå´©æºƒ(Thread 1: EXC_BAD_ACCESS (code=EXC_I386_GPFLT))NSLog(@&quot;æ‰“å°objï¼š%@&quot;, obj); ARC ä¸‹ä½¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ±  ARCç¯å¢ƒä¸èƒ½ä½¿ç”¨NSAutoreleasePoolç±»ä¹Ÿä¸èƒ½è°ƒç”¨autoreleaseæ–¹æ³•ï¼Œä»£æ›¿å®ƒä»¬å®ç°å¯¹è±¡è‡ªåŠ¨é‡Šæ”¾çš„æ˜¯ @autoreleasepoolå—ã€‚ 12345// ARCç¯å¢ƒä¸‹çš„æµ‹è¯•ï¼š@autoreleasepool &#123; id obj = [[NSObject alloc] init]; NSLog(@&quot;æ‰“å°objï¼š%@&quot;, obj); &#125; ARC ä¸‹ AutoReleasePool å†…éƒ¨å®ç°ä½¿ç”¨@autoreleasepool{}æˆ‘ä»¬åœ¨mainå‡½æ•°ä¸­å†™å…¥è‡ªåŠ¨é‡Šæ”¾æ± ç›¸å…³çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š 123456int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125; ä¸ºäº†æ¢ç©¶é‡Šæ”¾æ± çš„åº•å±‚å®ç°ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯ä½¿ç”¨ clang -rewrite-objc + æ–‡ä»¶åå‘½ä»¤å°†ä¸Šè¿°OCä»£ç è½¬åŒ–ä¸º C++ æºç ï¼š 123456789int main(int argc, const char * argv[]) &#123; /* @autoreleasepool */ &#123; __AtAutoreleasePool __autoreleasepool; NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_3f_crl5bnj956d806cp7d3ctqhm0000gn_T_main_d37e0d_mi_0); &#125; // å¤§æ‹¬å·å¯¹åº”é‡Šæ”¾æ± çš„ä½œç”¨åŸŸ return 0;&#125; åœ¨ç»è¿‡ç¼–è¯‘å™¨ clang å‘½ä»¤è½¬åŒ–åï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ‰€è°“çš„ @autoreleasePoolå—ï¼Œå…¶å®å¯¹åº”ç€__AtAutoreleasePoolçš„ç»“æ„ä½“ã€‚ åˆ†æç»“æ„ä½“ __AtAutoreleasePool çš„å…·ä½“å®ç°åœ¨æºç ä¸­æ‰¾åˆ° __AtAutoreleasePoolç»“æ„ä½“ çš„å®ç°ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 12345678extern &quot;C&quot; __declspec(dllimport) void * objc_autoreleasePoolPush(void);extern &quot;C&quot; __declspec(dllimport) void objc_autoreleasePoolPop(void *);struct __AtAutoreleasePool &#123; __AtAutoreleasePool() &#123;atautoreleasepoolobj = objc_autoreleasePoolPush();&#125; ~__AtAutoreleasePool() &#123;objc_autoreleasePoolPop(atautoreleasepoolobj);&#125; void * atautoreleasepoolobj;&#125;; __AtAutoreleasePoolç»“æ„ä½“åŒ…å«äº†ï¼šæ„é€ å‡½æ•°ã€ææ„å‡½æ•°å’Œä¸€ä¸ªå¯¹è±¡ï¼› æ„é€ å‡½æ•°å†…éƒ¨è°ƒç”¨ï¼šobjc_autoreleasePoolPush() æ–¹æ³•ï¼Œè¿”å›å¯¹è±¡atautoreleasepoolobj ææ„å‡½æ•°å†…éƒ¨è°ƒç”¨ï¼šobjc_autoreleasePoolPop() æ–¹æ³•ï¼Œä¼ å…¥å¯¹è±¡atautoreleasepoolobj åˆ†æmainå‡½æ•°ä¸­ __autoreleasepoolç»“æ„ä½“å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯è¿™æ ·çš„ï¼š __autoreleasepoolæ˜¯ä¸€ä¸ªè‡ªåŠ¨å˜é‡ï¼Œå…¶æ„é€ å‡½æ•°æ˜¯åœ¨ç¨‹åºæ‰§è¡Œåˆ°å£°æ˜è¿™ä¸ªå¯¹è±¡çš„ä½ç½®æ—¶è°ƒç”¨çš„ï¼Œè€Œå…¶ææ„å‡½æ•°åˆ™æ˜¯åœ¨ç¨‹åºæ‰§è¡Œåˆ°ç¦»å¼€è¿™ä¸ªå¯¹è±¡çš„ä½œç”¨åŸŸæ—¶è°ƒç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢mainå‡½æ•°çš„ä»£ç ç®€åŒ–å¦‚ä¸‹ï¼š 12345678int main(int argc, const char * argv[]) &#123; /* @autoreleasepool */ &#123; void *atautoreleasepoolobj = objc_autoreleasePoolPush(); NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_kb_06b822gn59df4d1zt99361xw0000gn_T_main_d39a79_mi_0); objc_autoreleasePoolPop(atautoreleasepoolobj); &#125; return 0;&#125; objc_autoreleasePoolPush ä¸ objc_autoreleasePoolPopè¿›ä¸€æ­¥è§‚å¯Ÿè‡ªåŠ¨é‡Šæ”¾æ± æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°çš„å®ç°ï¼Œå…¶å®å®ƒä»¬éƒ½åªæ˜¯å¯¹AutoreleasePoolPage å¯¹åº”é™æ€æ–¹æ³• push å’Œ pop çš„å°è£…ï¼š 1234567void *objc_autoreleasePoolPush(void) &#123; return AutoreleasePoolPage::push();&#125;void objc_autoreleasePoolPop(void *ctxt) &#123; AutoreleasePoolPage::pop(ctxt);&#125; ç†è§£ AutoreleasePoolPageAutoreleasePoolPage æ˜¯ä¸€ä¸ª C++ ä¸­çš„ç±»ï¼Œæ‰“å¼€Runtimeçš„æºç å·¥ç¨‹ï¼Œåœ¨NSObject.mmæ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°å®ƒçš„å®šä¹‰ï¼Œæ‘˜å–å…¶ä¸­çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021class AutoreleasePoolPage &#123;# define EMPTY_POOL_PLACEHOLDER ((id*)1) // ç©ºæ± å ä½# define POOL_BOUNDARY nil // å³å“¨å…µå¯¹è±¡ static pthread_key_t const key = AUTORELEASE_POOL_KEY; static uint8_t const SCRIBBLE = 0xA3; // 0xA3A3A3A3 after releasing static size_t const SIZE = #if PROTECT_AUTORELEASEPOOL PAGE_MAX_SIZE; // must be multiple of vm page size#else PAGE_MAX_SIZE; // size and alignment, power of 2#endif static size_t const COUNT = SIZE / sizeof(id); magic_t const magic; // æ ¡éªŒAutoreleasePagePoolPageç»“æ„æ˜¯å¦å®Œæ•´ id *next; // æŒ‡å‘æ–°åŠ å…¥çš„autoreleaseå¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å‘begin() pthread_t const thread; // å½“å‰æ‰€åœ¨çº¿ç¨‹ï¼ŒAutoreleasePoolæ˜¯å’Œçº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ AutoreleasePoolPage * const parent; // æŒ‡å‘çˆ¶èŠ‚ç‚¹pageï¼Œç¬¬ä¸€ä¸ªç»“ç‚¹çš„parentå€¼ä¸ºnil AutoreleasePoolPage *child; // æŒ‡å‘å­èŠ‚ç‚¹pageï¼Œæœ€åä¸€ä¸ªç»“ç‚¹çš„childå€¼ä¸ºnil uint32_t const depth; // é“¾è¡¨æ·±åº¦ï¼ŒèŠ‚ç‚¹ä¸ªæ•° uint32_t hiwat; // æ•°æ®å®¹çº³çš„ä¸€ä¸ªä¸Šé™ //......&#125;; AutoreleasePoolPage ä¸­æ‹¥æœ‰ parent å’Œ child æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ä¸Šä¸€ä¸ªå’Œä¸‹ä¸€ä¸ª pageï¼›å½“å‰ä¸€ä¸ªpageçš„ç©ºé—´è¢«å æ»¡(æ¯ä¸ªAutorelePoolPageçš„å¤§å°ä¸º4096å­—èŠ‚)æ—¶ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªAutorelePoolPageå¯¹è±¡å¹¶è¿æ¥åˆ°é“¾è¡¨ä¸­ï¼Œåæ¥çš„Autoreleaseå¯¹è±¡ä¹Ÿä¼šæ·»åŠ åˆ°æ–°çš„pageä¸­ï¼›å¦å¤–ï¼Œå½“next&#x3D;&#x3D; begin()æ—¶ï¼Œè¡¨ç¤ºAutoreleasePoolPageä¸ºç©ºï¼›å½“next &#x3D;&#x3D; end()ï¼Œè¡¨ç¤ºAutoreleasePoolPageå·²æ»¡ã€‚ ç†è§£ å“¨å…µå¯¹è±¡(POOL_BOUNDARY)çš„ä½œç”¨ï¼Œè€Œå®ƒçš„ä½œç”¨äº‹å®ä¸Šä¹Ÿå°±æ˜¯ä¸ºäº† èµ·åˆ°ä¸€ä¸ªæ ‡è¯†çš„ä½œç”¨ã€‚ æ¯å½“è‡ªåŠ¨é‡Šæ”¾æ± åˆå§‹åŒ–è°ƒç”¨ objc_autoreleasePoolPush æ–¹æ³•æ—¶ï¼Œæ€»ä¼šé€šè¿‡ AutoreleasePoolPage çš„ push æ–¹æ³•ï¼Œå°† POOL_BOUNDARY æ”¾åˆ°å½“å‰ page çš„æ ˆé¡¶ï¼Œå¹¶ä¸”è¿”å›è¿™ä¸ªå¯¹è±¡ atautoreleasepoolobjï¼› è€Œåœ¨è‡ªåŠ¨é‡Šæ”¾æ± é‡Šæ”¾è°ƒç”¨ objc_autoreleasePoolPop æ–¹æ³•æ—¶ï¼Œåˆä¼šå°† atautoreleasepoolobjå¯¹è±¡ ä»¥å‚æ•°ä¼ å…¥ï¼Œè¿™æ ·è‡ªåŠ¨é‡Šæ”¾æ± å°±ä¼šå‘é‡Šæ”¾æ± ä¸­å¯¹è±¡å‘é€releaseæ¶ˆæ¯ï¼Œç›´è‡³æ‰¾åˆ°ç¬¬ä¸€ä¸ªè¾¹ç•Œå¯¹è±¡ä¸ºæ­¢ã€‚ ç†è§£ objc_autoreleasePoolPush æ–¹æ³•ç»è¿‡å‰é¢çš„åˆ†æï¼Œobjc_autoreleasePoolPush æœ€ç»ˆè°ƒç”¨çš„æ˜¯ AutoreleasePoolPage çš„ push æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546static inline void *push() &#123; return autoreleaseFast(POOL_BOUNDARY);&#125;static inline id *autoreleaseFast(id obj)&#123; AutoreleasePoolPage *page = hotPage(); if (page &amp;&amp; !page-&gt;full()) &#123; return page-&gt;add(obj); &#125; else if (page) &#123; return autoreleaseFullPage(obj, page); &#125; else &#123;1. return autoreleaseNoPage(obj); &#125;&#125;// å‹æ ˆæ“ä½œï¼šå°†å¯¹è±¡åŠ å…¥AutoreleaseNoPageå¹¶ç§»åŠ¨æ ˆé¡¶çš„æŒ‡é’ˆid *add(id obj) &#123; id *ret = next; *next = obj; next++; return ret;&#125;// å½“å‰hotPageå·²æ»¡æ—¶è°ƒç”¨static id *autoreleaseFullPage(id obj, AutoreleasePoolPage *page) &#123; do &#123; if (page-&gt;child) page = page-&gt;child; else page = new AutoreleasePoolPage(page); &#125; while (page-&gt;full()); setHotPage(page); return page-&gt;add(obj);&#125;// å½“å‰hotpageä¸å­˜åœ¨æ—¶è°ƒç”¨static id *autoreleaseNoPage(id obj) &#123; AutoreleasePoolPage *page = new AutoreleasePoolPage(nil); setHotPage(page); if (obj != POOL_SENTINEL) &#123; page-&gt;add(POOL_SENTINEL); &#125; return page-&gt;add(obj);&#125; è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œæ¯æ¬¡è°ƒç”¨ push å…¶å®å°±æ˜¯ åˆ›å»ºä¸€ä¸ªæ–°çš„AutoreleasePoolPageï¼Œåœ¨å¯¹åº”çš„AutoreleasePoolPageä¸­æ’å…¥ä¸€ä¸ª POOL_BOUNDARY ï¼Œå¹¶ä¸”è¿”å›æ’å…¥çš„ POOL_BOUNDARY çš„å†…å­˜åœ°å€ã€‚è‡ªåŠ¨é‡Šæ”¾æ± æœ€ç»ˆéƒ½ä¼šé€šè¿‡ page-&gt;add(obj) æ–¹æ³• å°†å¯¹è±¡æ·»åŠ åˆ°pageä¸­ï¼Œè€Œè¿™ä¸€è¿‡ç¨‹è¢«åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š * å½“å‰pageå­˜åœ¨ä¸”ä¸æ»¡ï¼Œè°ƒç”¨ `page-&gt;add(obj)` æ–¹æ³•å°† `å¯¹è±¡` æ·»åŠ è‡³pageçš„æ ˆä¸­ï¼Œå³nextæŒ‡å‘çš„ä½ç½® * å½“å‰pageå­˜åœ¨ä½†æ˜¯å·²æ»¡ï¼Œè°ƒç”¨ autoreleaseFullPage åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ pageï¼Œè°ƒç”¨page-&gt;add(obj)æ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³pageçš„æ ˆä¸­ * å½“å‰pageä¸å­˜åœ¨æ—¶ï¼Œè°ƒç”¨ autoreleaseNoPage åˆ›å»ºä¸€ä¸ª hotPageï¼Œå†è°ƒç”¨page-&gt;add(obj) æ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³pageçš„æ ˆä¸­ ç†è§£ objc_autoreleasePoolPop æ–¹æ³• AutoreleasePool çš„é‡Šæ”¾è°ƒç”¨çš„æ˜¯ objc_autoreleasePoolPop æ–¹æ³•ï¼Œæ­¤æ—¶éœ€è¦ä¼ å…¥ atautoreleasepoolobj å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚ åŒç†ï¼Œæˆ‘ä»¬æ‰¾åˆ° objc_autoreleasePoolPop æœ€ç»ˆè°ƒç”¨çš„æ–¹æ³•ï¼Œå³ AutoreleasePoolPage çš„popæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041static inline void pop(void *token) // POOL_BOUNDARYçš„åœ°å€&#123; AutoreleasePoolPage *page; id *stop; page = pageForPointer(token); // é€šè¿‡POOL_BOUNDARYæ‰¾åˆ°å¯¹åº”çš„page stop = (id *)token; if (DebugPoolAllocation &amp;&amp; *stop != POOL_SENTINEL) &#123; // This check is not valid with DebugPoolAllocation off // after an autorelease with a pool page but no pool in place. _objc_fatal(&quot;invalid or prematurely-freed autorelease pool %p; &quot;, token); &#125; if (PrintPoolHiwat) printHiwat(); // è®°å½•æœ€é«˜æ°´ä½æ ‡è®° page-&gt;releaseUntil(stop); // å‘æ ˆä¸­çš„å¯¹è±¡å‘é€releaseæ¶ˆæ¯ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªå“¨å…µå¯¹è±¡ // memory: delete empty children // åˆ é™¤ç©ºæ‰çš„èŠ‚ç‚¹ if (DebugPoolAllocation &amp;&amp; page-&gt;empty()) &#123; // special case: delete everything during page-per-pool debugging AutoreleasePoolPage *parent = page-&gt;parent; page-&gt;kill(); setHotPage(parent); &#125; else if (DebugMissingPools &amp;&amp; page-&gt;empty() &amp;&amp; !page-&gt;parent) &#123; // special case: delete everything for pop(top) // when debugging missing autorelease pools page-&gt;kill(); setHotPage(nil); &#125; else if (page-&gt;child) &#123; // hysteresis: keep one empty child if page is more than half full if (page-&gt;lessThanHalfFull()) &#123; page-&gt;child-&gt;kill(); &#125; else if (page-&gt;child-&gt;child) &#123; page-&gt;child-&gt;child-&gt;kill(); &#125; &#125;&#125; ã€æ€»ç»“ã€‘ã€ç»“æ„ã€‘ï¼š è‡ªåŠ¨é‡Šæ”¾æ± çš„å‹æ ˆå’Œå‡ºæ ˆï¼Œé€šè¿‡ç»“æ„ä½“çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°å®ç°ï¼š å‹æ ˆï¼šè°ƒç”¨ objc_autoreleasePoolPush() å‡½æ•°ï¼Œå†…éƒ¨è°ƒç”¨çš„æ˜¯ AutoreleasePoolPage çš„ push() æ–¹æ³•ï¼Œè¿”å› atautoreleasepoolobj å¯¹è±¡ å‡ºæ ˆï¼šè°ƒç”¨ objc_autoreleasePololPop() å‡½æ•°ï¼Œå†…éƒ¨è°ƒç”¨çš„æ˜¯ AutoreleasePoolPage çš„ pop() æ–¹æ³•ï¼Œä¼ å…¥ atautoreleasepoolobj å¯¹è±¡ ã€å®¹é‡ã€‘ï¼š æ± é¡µå¤§å°ä¸º4096å­—èŠ‚ï¼Œæ¯ä¸€é¡µéƒ½åŒ…å«56å­—èŠ‚çš„æˆå‘˜å˜é‡ï¼Œä½†ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œåªä¼šå‹æ ˆä¸€ä¸ªå“¨å…µå¯¹è±¡ï¼Œå 8å­—èŠ‚ ã€åŸç†ã€‘ï¼š è‡ªåŠ¨é‡Šæ”¾æ± çš„æœ¬è´¨æ˜¯ __AtAutoreleasePool ç»“æ„ä½“ï¼ŒåŒ…å«æ„é€ å‡½æ•°å’Œææ„å‡½æ•° ç»“æ„ä½“å£°æ˜ï¼Œè§¦å‘æ„é€ å‡½æ•°ï¼Œè°ƒç”¨ objc_autoreleasePoolPush() å‡½æ•°ï¼Œå¯¹è±¡å‹æ ˆ å¦‚æœå­˜åœ¨pageï¼Œå¹¶ä¸”æ²¡æœ‰å­˜æ»¡ï¼Œè°ƒç”¨addå‡½æ•° å°†å¯¹è±¡å‹æ ˆ å¦‚æœå­˜åœ¨pageï¼Œä½†å­˜å‚¨å·²æ»¡ï¼Œè°ƒç”¨autoreleaseFullPageå‡½æ•° éå†é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªç©ºç™½çš„å­é¡µé¢ å¯¹å…¶è¿›è¡Œåˆ›å»ºæ–°é¡µ è®¾ç½®ä¸ºçƒ­é¡µé¢ æ·»åŠ å¯¹è±¡ å¦åˆ™ï¼Œä¸å­˜åœ¨pageï¼Œè°ƒç”¨autoreleaseNoPageå‡½æ•° é€šè¿‡çˆ¶ç±»AutoreleasePoolPageDataè¿›è¡Œåˆå§‹åŒ– beginï¼šè·å–å¯¹è±¡å‹æ ˆçš„èµ·å§‹ä½ç½® objc_thread_selfï¼šé€šè¿‡tlsè·å–å½“å‰çº¿ç¨‹ é“¾æ¥åŒå‘é“¾è¡¨ è®¾ç½®ä¸ºçƒ­é¡µé¢ pushExtraBoundaryä¸ºYESï¼Œå“¨å…µå¯¹è±¡å‹æ ˆ å¯¹è±¡å‹æ ˆ ç»“æ„ä½“å‡ºä½œç”¨åŸŸï¼Œè§¦å‘ææ„å‡½æ•°ï¼Œè°ƒç”¨ objc_autoreleasePoolPop() å‡½æ•°ï¼Œå¯¹è±¡å‡ºæ ˆ è°ƒç”¨popPageå‡½æ•°ï¼Œä¼ å…¥stopä¸ºå“¨å…µå¯¹è±¡çš„ä½ç½® å½“å‰é¡µä¸­å¯¹è±¡å‡ºæ ˆï¼Œåˆ°stopä½ç½®åœæ­¢ è°ƒç”¨killå‡½æ•°ï¼Œé”€æ¯å½“å‰é¡µé¢ AutoreleasePoolåœ¨ä¸»çº¿ç¨‹ä¸Šçš„é‡Šæ”¾æ—¶æœº åˆ†æä¸»çº¿ç¨‹RunLoopç®¡ç†è‡ªåŠ¨é‡Šæ”¾æ± å¹¶é‡Šæ”¾å¯¹è±¡çš„è¯¦ç»†è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨å¦‚ä¸‹Demoä¸­çš„ä¸»çº¿ç¨‹ä¸­è®¾ç½®æ–­ç‚¹ï¼Œå¹¶æ‰§è¡Œlldbå‘½ä»¤ï¼špo [NSRunLoop currentRunLoop]ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š æˆ‘ä»¬çœ‹åˆ°ä¸»çº¿ç¨‹RunLoopä¸­æœ‰ä¸¤ä¸ªä¸è‡ªåŠ¨é‡Šæ”¾æ± ç›¸å…³çš„Observer,å¯¹åº”CFRunLoopActivityçš„ç±»å‹å¦‚ä¸‹: 123456789typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), //0x1ï¼Œå¯åŠ¨Runloopå¾ªç¯ kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), //0xa0ï¼Œå³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), kCFRunLoopExit = (1UL &lt;&lt; 7), //0xa0ï¼Œé€€å‡ºRunLoopå¾ªç¯ kCFRunLoopAllActivities = 0x0FFFFFFFU &#125;; ç»“åˆRunLoopç›‘å¬çš„äº‹ä»¶ç±»å‹ï¼Œåˆ†æä¸»çº¿ç¨‹ä¸Šè‡ªåŠ¨é‡Šæ”¾æ± çš„ä½¿ç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š Appå¯åŠ¨åï¼Œè‹¹æœåœ¨ä¸»çº¿ç¨‹RunLoopé‡Œæ³¨å†Œäº†ä¸¤ä¸ª Observerï¼Œå…¶å›è°ƒéƒ½æ˜¯ _wrapRunLoopWithAutoreleasePoolHandler(); ç¬¬ä¸€ä¸ªObserverç›‘è§†çš„äº‹ä»¶ Entry(å³å°†è¿›å…¥Loop)ï¼Œå…¶å›è°ƒå†…ä¼šè°ƒç”¨ _objc_autoreleasePoolPush() åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚ ç¬¬äºŒä¸ªObserverç›‘è§†äº†ä¸¤ä¸ªäº‹ä»¶ : BeforeWaiting(å‡†å¤‡è¿›å…¥ä¼‘çœ ) æ—¶è°ƒç”¨ _objc_autoreleasePoolPop() å’Œ_objc_autoreleasePoolPush() é‡Šæ”¾æ—§çš„æ± å¹¶åˆ›å»ºæ–°æ± ï¼› Exit(å³å°†é€€å‡ºLoop) æ—¶è°ƒç”¨ _objc_autoreleasePoolPop() æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ã€‚ åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œé€šå¸¸æ˜¯å†™åœ¨è¯¸å¦‚äº‹ä»¶å›è°ƒã€Timerå›è°ƒå†…çš„ã€‚è¿™äº›å›è°ƒä¼šè¢« RunLoopåˆ›å»ºå¥½çš„AutoreleasePoolç¯ç»•ç€ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œå¼€å‘è€…ä¹Ÿä¸å¿…æ˜¾ç¤ºåˆ›å»ºAutoreleasePooläº†; ä¹‹åçš„æ—¶æœº ç¨‹åºå¯åŠ¨åˆ°åŠ è½½å®Œæˆåï¼Œä¸»çº¿ç¨‹å¯¹åº”çš„RunLoopä¼šåœä¸‹æ¥ç­‰å¾…ç”¨æˆ·äº¤äº’ ç”¨æˆ·çš„æ¯ä¸€æ¬¡äº¤äº’éƒ½ä¼šå¯åŠ¨ä¸€æ¬¡è¿è¡Œå¾ªç¯ï¼Œæ¥å¤„ç†ç”¨æˆ·æ‰€æœ‰çš„ç‚¹å‡»äº‹ä»¶ã€è§¦æ‘¸äº‹ä»¶ã€‚ RunLoopæ£€æµ‹åˆ°äº‹ä»¶åï¼Œå°±ä¼šåˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ; æ‰€æœ‰çš„å»¶è¿Ÿé‡Šæ”¾å¯¹è±¡éƒ½ä¼šè¢«æ·»åŠ åˆ°è¿™ä¸ªæ± å­ä¸­; åœ¨ä¸€æ¬¡å®Œæ•´çš„è¿è¡Œå¾ªç¯ç»“æŸä¹‹å‰ï¼Œä¼šå‘æ± ä¸­æ‰€æœ‰å¯¹è±¡å‘é€releaseæ¶ˆæ¯ï¼Œç„¶åè‡ªåŠ¨é‡Šæ”¾æ± è¢«é”€æ¯; AutoreleasePoolå­çº¿ç¨‹ä¸Šçš„é‡Šæ”¾æ—¶æœºå­çº¿ç¨‹é»˜è®¤ä¸å¼€å¯RunLoopï¼Œé‚£ä¹ˆå…¶ä¸­çš„å»¶æ—¶å¯¹è±¡è¯¥å¦‚ä½•é‡Šæ”¾å‘¢ï¼Ÿå…¶å®è¿™ä¾ç„¶è¦ä»Threadå’ŒAutoreleasePoolçš„å…³ç³»æ¥è€ƒè™‘ï¼š å°±æ˜¯è¯´ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šç»´æŠ¤è‡ªå·±çš„ Autoreleasepoolæ ˆï¼Œæ‰€ä»¥å­çº¿ç¨‹è™½ç„¶é»˜è®¤æ²¡æœ‰å¼€å¯RunLoopï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨AutoreleasePoolï¼Œåœ¨ å­çº¿ç¨‹é€€å‡º çš„æ—¶å€™ä¼šå»é‡Šæ”¾autoreleaseå¯¹è±¡ã€‚ å‰é¢è®²åˆ°è¿‡ï¼ŒARCä¼šæ ¹æ®ä¸€äº›æƒ…å†µè¿›è¡Œä¼˜åŒ–ï¼Œæ·»åŠ __autoreleasingä¿®é¥°ç¬¦ï¼Œå…¶å®è¿™å°±ç›¸å½“äºå¯¹éœ€è¦å»¶æ—¶é‡Šæ”¾çš„å¯¹è±¡è°ƒç”¨äº†autoreleaseæ–¹æ³•ã€‚ä»æºç åˆ†æçš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœå­çº¿ç¨‹ä¸­æ²¡æœ‰åˆ›å»ºAutoreleasePool ï¼Œè€Œä¸€æ—¦äº§ç”Ÿäº†Autoreleaseå¯¹è±¡ï¼Œå°±ä¼šè°ƒç”¨autoreleaseNoPageæ–¹æ³•è‡ªåŠ¨åˆ›å»ºhotpageï¼Œå¹¶å°†å¯¹è±¡åŠ å…¥åˆ°å…¶æ ˆä¸­ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå­çº¿ç¨‹ä¸­å³ä½¿æˆ‘ä»¬ä¸æ‰‹åŠ¨æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ã€‚ AutoreleasePooléœ€è¦æ‰‹åŠ¨æ·»åŠ çš„æƒ…å†µ å°½ç®¡ARCå·²ç»åšäº†è¯¸å¤šä¼˜åŒ–ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨åˆ›å»º AutoreleasePoolï¼Œè€Œå…¶ä¸­çš„å»¶æ—¶å¯¹è±¡å°†åœ¨å½“å‰é‡Šæ”¾æ± çš„ä½œç”¨åŸŸç»“æŸæ—¶é‡Šæ”¾ã€‚è‹¹æœæ–‡æ¡£ä¸­è¯´æ˜äº†ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦æ‰‹åŠ¨æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± ï¼š ç¼–å†™çš„ä¸æ˜¯åŸºäºUIæ¡†æ¶çš„ç¨‹åºï¼Œä¾‹å¦‚å‘½ä»¤è¡Œå·¥å…·ï¼› é€šè¿‡å¾ªç¯æ–¹å¼åˆ›å»ºå¤§é‡ä¸´æ—¶å¯¹è±¡ï¼› ä½¿ç”¨éCocoaç¨‹åºåˆ›å»ºçš„å­çº¿ç¨‹ï¼› è€Œåœ¨ARCç¯å¢ƒä¸‹çš„å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸é‡åˆ°çš„ä¹Ÿæ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š 1234567- (void)viewDidLoad &#123; [super viewDidLoad]; for (int i = 0; i &lt; 1000000; i++) &#123; NSObject *obj = [[NSObject alloc] init]; NSLog(@&quot;æ‰“å°objï¼š%@&quot;, obj); &#125; &#125; ä¸Šè¿°ä»£ç ä¸­ï¼Œobjå› ä¸ºç¦»å¼€ä½œç”¨åŸŸæ‰€ä»¥ä¼šè¢«åŠ å…¥æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œè€Œè¿™ä¸ªé‡Šæ”¾æ± å°±æ˜¯ä¸»çº¿ç¨‹ä¸Šçš„RunLoopç®¡ç†çš„ï¼›å› ä¸ºforå¾ªç¯åœ¨å½“å‰çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼ŒRunloopä¹Ÿå°±æ²¡æœ‰å®Œæˆå½“å‰è¿™ä¸€æ¬¡çš„è¿­ä»£ï¼Œæ‰€ä»¥å¯¼è‡´å¤§é‡å¯¹è±¡è¢«å»¶æ—¶é‡Šæ”¾ã€‚é‡Šæ”¾æ± ä¸­çš„å¯¹è±¡å°†ä¼šåœ¨viewDidAppearæ–¹æ³•æ‰§è¡Œå‰å°±è¢«é”€æ¯ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±æœ‰å¿…è¦é€šè¿‡æ‰‹åŠ¨å¹²é¢„çš„æ–¹å¼åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ï¼›ä¼˜åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š 123456789- (void)viewDidLoad &#123; [super viewDidLoad]; for (int i = 0; i &lt; 1000000; i++) &#123; @autoreleasepool&#123; NSObject *obj = [[NSObject alloc] init]; NSLog(@&quot;æ‰“å°objï¼š%@&quot;, obj); &#125; &#125; &#125;","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCå­¦ä¹ 02ï¼šæ–‡ä»¶å¯¼å…¥#include,#import,@classåŒºåˆ«","slug":"OCå­¦ä¹ /OCå­¦ä¹ 02ï¼šæ–‡ä»¶å¯¼å…¥#include,#import,@classåŒºåˆ«","date":"2023-03-02T08:39:08.000Z","updated":"2023-03-02T10:13:48.926Z","comments":true,"path":"2023/03/02/OCå­¦ä¹ /OCå­¦ä¹ 02ï¼šæ–‡ä»¶å¯¼å…¥#include,#import,@classåŒºåˆ«/","link":"","permalink":"https://www.bboyzj.cn/2023/03/02/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A002%EF%BC%9A%E6%96%87%E4%BB%B6%E5%AF%BC%E5%85%A5#include,#import,@class%E5%8C%BA%E5%88%AB/","excerpt":"","text":"å‰è¨€ #include ã€ #import å’Œ @class éƒ½æ˜¯ç”¨æ¥ åŒ…å«å¤´æ–‡ä»¶ C/C++ åªèƒ½ç”¨ #include åŒ…å«å¤´æ–‡ä»¶ï¼Œæ²¡æœ‰ #import å’Œ @class OC ä¸­ #include ã€ #import å’Œ @class éƒ½å¯ä»¥ç”¨ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸‰ç§åŒ…å«å¤´æ–‡ä»¶æ–¹å¼åœ¨ OC ä¸­æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ includeã€import #include ä¼šé‡å¤å¯¼å…¥å¤´æ–‡ä»¶ï¼Œé‡å¤å¯¼å…¥ä¼šæŠ¥é‡å¤å®šä¹‰çš„é”™è¯¯ï¼›#import ä¸ä¼šé‡å¤å¯¼å…¥å¤´æ–‡ä»¶ï¼Œå…è®¸äº¤å‰ç¼–è¯‘ #include &lt;xxx.h&gt; æˆ– #import &lt;xxx.h&gt; ï¼šç”¨äºå¯¼å…¥ ç³»ç»Ÿè‡ªå¸¦æ–‡ä»¶ï¼Œåœ¨ ç³»ç»Ÿæ–‡ä»¶ç›®å½•ä¸‹æŸ¥æ‰¾ #include â€œxxx.hâ€ æˆ– #import â€œxxx.hâ€ ï¼šç”¨äºå¯¼å…¥ ç”¨æˆ·è‡ªå®šä¹‰çš„æ–‡ä»¶ï¼ŒæŸ¥æ‰¾é¡ºåºï¼šç”¨æˆ·æ–‡ä»¶ç›®å½• -&gt; å®‰è£…æ–‡ä»¶ç›®å½• -&gt; ç³»ç»Ÿæ–‡ä»¶ç›®å½•ï¼Œæ‰€ä»¥ â€œxxx.hâ€ ä¸€èˆ¬ç”¨æ¥å¯¼å…¥ç”¨æˆ·è‡ªå®šä¹‰çš„æ–‡ä»¶ class @class XXXClassName ï¼š ç”¨äºå£°æ˜ä¸€ä¸ªç±»ï¼Œç”¨äºè§£å†³äº’ç›¸å¼•ç”¨çš„é—®é¢˜ï¼ˆAå¼•ç”¨Bï¼ŒBå¼•ç”¨Aï¼‰ include ç¤ºä¾‹ Aæ–‡ä»¶å¯¼å…¥ä¸¤æ¬¡Bæ–‡ä»¶ï¼šæŠ¥é‡å¤å®šä¹‰é”™è¯¯ 12345678910#import &lt;UIKit/UIKit.h&gt;// include ä¸å…è®¸é‡å¤å¯¼å…¥ä¸¤æ¬¡#include &quot;VB.h&quot;#include &quot;VB.h&quot;NS_ASSUME_NONNULL_BEGIN@interface VA : UIView@end command + b ç¼–è¯‘æŠ¥é”™ï¼š Aå¼•ç”¨Bï¼ŒBå¼•ç”¨Cï¼ŒAå†å¼•ç”¨Cï¼šåŒæ · æŠ¥é‡å¤å®šä¹‰é”™è¯¯ï¼Œç›¸å½“äºAå¼•ç”¨äº†ä¸¤æ¬¡C import ç¤ºä¾‹ å¯¼å…¥ä¸¤æ¬¡Aæ–‡ä»¶ï¼Œä¸æŠ¥é”™ 123// å¯¼å…¥ä¸¤æ¬¡Aæ–‡ä»¶#import &quot;A.h&quot;#import &quot;A.h&quot; class ä½¿ç”¨åœºæ™¯ Aç±»å¼•ç”¨Bç±»ï¼ŒBç±»å¼•ç”¨Aï¼šäº’ç›¸å¼•ç”¨æŠ¥é”™ A.hæ–‡ä»¶ 12345#import &lt;UIKit/UIKit.h&gt;#import &quot;B.h&quot;@interface A : UIView@property (nonatomic,strong)B * b;@end B.hæ–‡ä»¶ 12345#import &lt;UIKit/UIKit.h&gt;#import &quot;A.h&quot;@interface B : UIView@property (nonatomic,strong)A * a;@end å¯ä»¥ç”¨ @class æ–¹å¼è¿›è¡Œå¼•ç”¨ï¼Œä¸€ä¸ªç”¨@classæˆ–è€…ä¸¤ä¸ªéƒ½ç”¨ @class 1234//#import &quot;A.h&quot;// classå£°æ˜A@class A;","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"Blog-05ï¼šPicgo+Giteeå›¾åºŠ","slug":"Blogæ­å»º/Blog-05ï¼šPicgo-Giteeå›¾åºŠ","date":"2023-03-01T11:25:22.000Z","updated":"2023-03-02T16:23:50.879Z","comments":true,"path":"2023/03/01/Blogæ­å»º/Blog-05ï¼šPicgo-Giteeå›¾åºŠ/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/Blog%E6%90%AD%E5%BB%BA/Blog-05%EF%BC%9APicgo-Gitee%E5%9B%BE%E5%BA%8A/","excerpt":"","text":"èƒŒæ™¯æœ€è¿‘å‘ç°ä¸Šä¼ åˆ° GitHub ä¸Šçš„å›¾ç‰‡å¤§éƒ¨åˆ†ä¸èƒ½ä½¿ç”¨äº†ï¼Œç„¶åä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯ DNS çš„é—®é¢˜ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»ç½‘ä¸Šæ‰¾æ‰¾ï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç» Picgo + Gitee åšå›¾åºŠã€‚ Picgo ä»‹ç»picgo æ˜¯ä¸€æ¬¾åŠŸèƒ½å®ç”¨ã€æ“ä½œç®€æ·çš„å›¾åºŠå·¥å…·ï¼Œå›¾åºŠå·¥å…·ç®€å•æ¥è¯´å°±æ˜¯æœ¬åœ°å›¾ç‰‡ä¸Šä¼ è‡ªåŠ¨è½¬æ¢æˆé“¾æ¥çš„ä¸€æ¬¾å·¥å…·ã€‚ picgo æœ¬ä½“æ”¯æŒå¦‚ä¸‹å›¾åºŠï¼š ä¸ƒç‰›å›¾åºŠ v1.0 è…¾è®¯äº‘ COS v4\\v5 ç‰ˆæœ¬ v1.1 &amp; v1.5.0 åˆæ‹äº‘ v1.2.0 GitHub v1.5.0 SM.MS V2 v2.3.0-beta.0 é˜¿é‡Œäº‘ OSS v1.6.0 Imgur v1.6.0 Tips: æœ¬ä½“ä¸å†å¢åŠ é»˜è®¤çš„å›¾åºŠæ”¯æŒã€‚ä½ å¯ä»¥è‡ªè¡Œå¼€å‘ç¬¬ä¸‰æ–¹å›¾åºŠæ’ä»¶ã€‚ ç‰¹è‰²åŠŸèƒ½ æ”¯æŒæ‹–æ‹½å›¾ç‰‡ä¸Šä¼  æ”¯æŒå¿«æ·é”®ä¸Šä¼ å‰ªè´´æ¿é‡Œç¬¬ä¸€å¼ å›¾ç‰‡ Windows å’Œ macOS æ”¯æŒå³é”®å›¾ç‰‡æ–‡ä»¶é€šè¿‡èœå•ä¸Šä¼  (v2.1.0+) ä¸Šä¼ å›¾ç‰‡åè‡ªåŠ¨å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿ æ”¯æŒè‡ªå®šä¹‰å¤åˆ¶åˆ°å‰ªè´´æ¿çš„é“¾æ¥æ ¼å¼ æ”¯æŒä¿®æ”¹å¿«æ·é”®ï¼Œé»˜è®¤å¿«é€Ÿä¸Šä¼ å¿«æ·é”®ï¼šcommand+shift+pï¼ˆmacOSï¼‰ | control+shift+pï¼ˆWindows\\Linuxï¼‰ æ”¯æŒæ’ä»¶ç³»ç»Ÿï¼Œå·²æœ‰æ’ä»¶æ”¯æŒ Giteeã€é’äº‘ç­‰ç¬¬ä¸‰æ–¹å›¾åºŠ Tips: è¯·ç¡®ä¿ä½ å®‰è£…äº† Node.jsï¼Œ å¹¶ä¸”ç‰ˆæœ¬ &gt;&#x3D; 8ã€‚ é»˜è®¤ä¸Šä¼ å›¾åºŠä¸º SM.MSã€‚picgo ä¸Šä¼ ä¹‹åï¼Œä¼šè‡ªåŠ¨å°†ä¸Šä¼ æˆåŠŸçš„ URLå¤åˆ¶åˆ°ä½ çš„å‰ªè´´æ¿ï¼Œæ”¯æŒ5ç§å¤åˆ¶æ ¼å¼ã€‚ Miniçª—å£åªæ”¯æŒWindowsï¼ˆåœ†å½¢ï¼‰å’ŒLinuxï¼ˆæ–¹å½¢ï¼‰ï¼ŒmacOSå¯ä»¥ä½¿ç”¨é¡¶éƒ¨æ å›¾æ ‡ã€‚ï¼ˆå› ä¸ºWindowså’ŒLinuxçš„ä»»åŠ¡æ ä¸æ”¯æŒæ‹–æ‹½äº‹ä»¶ï¼‰ å‡†å¤‡ nodejs ç¯å¢ƒ picgo å®¢æˆ·ç«¯ picgo çš„ Gitee ä¸Šä¼ æ’ä»¶ gitã€Gitee è´¦å·å’Œä¸€ä¸ªå…¬å¼€ä»“åº“ å®‰è£… nodejså®˜ç½‘ å®‰è£… ç‚¹å‡»é“¾æ¥ä¸‹è½½å®‰è£… nodejsï¼Œå®‰è£…å®Œæˆåï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ 12345mac@bogon ~ % node -vv18.14.2mac@bogon ~ % npm -vmac@bogon ~ % npm -v9.5.0 å®‰è£… picgo å®¢æˆ·ç«¯ picgoå®‰è£…é“¾æ¥ å¦‚æœç”µè„‘æ˜¯ Intel å°±é€‰ x64ï¼Œå¦‚æœç”µè„‘æ˜¯ M1 å°±é€‰ arm64 å®‰è£… git Mac é»˜è®¤æ˜¯å·²ç»å®‰è£…å¥½äº† git æ³¨å†Œ&#x2F;ç™»å½• Gitee è´¦å· Gitee é¦–é¡µæŒ‰è¦æ±‚è‡ªè¡Œæ³¨å†Œ&#x2F;ç™»å½•å³å¯ æ–°å»ºä¸€ä¸ª Gitee ä»“åº“ ä»“åº“åï¼šéšæ„ï¼Œå¦‚ Picgoç§æœ‰åˆ›å»º å°†ä»“åº“ å¼€æº ç”±äºåˆ›å»ºä»“åº“çš„æ—¶å€™åªèƒ½ ç§æœ‰ï¼Œæ‰€ä»¥æ­¤æ­¥é…ç½® å¼€æº æ“ä½œå¦‚ä¸‹ï¼š è¿›å…¥ä»“åº“ -&gt; ç®¡ç† -&gt; åŸºæœ¬ä¿¡æ¯ -&gt; å¼€æºï¼ˆç©ºä»“åº“ä¸å…è®¸ï¼‰ -&gt; ä¿å­˜ ç”Ÿæˆ Token Token ç”¨äº picgo æ“ä½œ Gitee repositoryï¼š ç‚¹å‡»å¤´åƒ -&gt; è®¾ç½® -&gt; ç§äººä»¤ç‰Œ -&gt; ç”Ÿæˆæ–°ä»¤ç‰Œ -&gt; æäº¤ å¤åˆ¶ä½ ç”Ÿæˆçš„ä»¤ç‰Œï¼Œåªæ˜¾ç¤ºä¸€æ¬¡ï¼Œå†æ¬¡åˆ·æ–°åˆ™çœ‹ä¸è§äº†ï¼Œå› æ­¤ä½ è¦ä¿å­˜å¥½ é…ç½® picgo å¯åŠ¨ picgo -&gt; æ’ä»¶è®¾ç½® -&gt; æœç´¢ Gitee -&gt; ç‚¹å‡»æ’ä»¶å›¾æ ‡ å®‰è£… å³å¯ï¼Œæœ¬æ–‡ä½¿ç”¨ gitee 2.0.5 æ’ä»¶æ¥è¿›è¡Œæ¼”ç¤º Tipsï¼š æ’ä»¶è£…å®Œåï¼Œé‡å¯ç”Ÿæ•ˆ é…ç½® Gitee æ’ä»¶è¿›å…¥ å›¾åºŠè®¾ç½® -&gt; giteeï¼Œ ä¾æ¬¡å¡«å…¥ç›¸å…³é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼Œå¡«å†™å¦‚ä¸‹ï¼š repoï¼š ç”¨æˆ·å&#x2F;ä»“åº“åï¼ˆå¿…å¡«ï¼‰ï¼Œ bboy-zhang-jian/picgo path: ä¸Šä¼ è·¯å¾„ï¼Œä»“åº“é‡Œçš„å›¾ç‰‡ä¿å­˜è·¯å¾„ï¼ˆéå¿…å¡«ï¼‰ token: ç§äººä»¤ç‰Œï¼ˆå¿…å¡«ï¼‰ï¼Œåˆšæ‰ä¿å­˜çš„ token message: æäº¤æ¶ˆæ¯ï¼ˆéå¿…å¡«ï¼‰ path: ä¸Šä¼ è·¯å¾„ï¼Œä»“åº“é‡Œçš„å›¾ç‰‡ä¿å­˜è·¯å¾„ï¼ˆéå¿…å¡«ï¼‰ customPath: å®šåˆ¶è·¯å¾„ï¼ˆéå¿…å¡«ï¼‰ customUrl: å›¾ç‰‡å®šåˆ¶URLï¼ˆéå¿…å¡«ï¼‰ å°†ä»“åº“å¼€æºå¤´åƒ -&gt; ä»“åº“ -&gt; ç®¡ç† -&gt; å…¬å¼€ -&gt; ä»“åº“å…¬å¼€é¡»çŸ¥å…¨éƒ¨ å‹¾é€‰ ä¸Šä¼ å›¾ç‰‡ å°†å›¾ç‰‡æ‹–åŠ¨åˆ° ä¸Šä¼ åŒº é‡Œ å¿«æ·é”® Ctrl + shift + p ERROR Plugin load failed: hexo-renderer-scss1mac@bogon Blog % npm install hexo-renderer-scss å‡ºç° Error: Cannot find module â€˜node-sassâ€™1mac@bogon Blog % npm install node-sass ä¸ç”¨ç®¡äº†ï¼Œç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}],"tags":[{"name":"åšå®¢æ­å»º","slug":"åšå®¢æ­å»º","permalink":"https://www.bboyzj.cn/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"}],"keywords":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}]},{"title":"OCå­¦ä¹ 01ï¼šäº‹ä»¶ä¼ é€’é“¾å’Œå“åº”é“¾","slug":"OCå­¦ä¹ /OCå­¦ä¹ 01ï¼šäº‹ä»¶ä¼ é€’é“¾å’Œå“åº”é“¾","date":"2023-03-01T09:30:34.000Z","updated":"2023-03-02T08:54:15.933Z","comments":true,"path":"2023/03/01/OCå­¦ä¹ /OCå­¦ä¹ 01ï¼šäº‹ä»¶ä¼ é€’é“¾å’Œå“åº”é“¾/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A001%EF%BC%9A%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E9%93%BE%E5%92%8C%E5%93%8D%E5%BA%94%E9%93%BE/","excerpt":"","text":"å‰è¨€åœ¨ iOS ä¸­åªæœ‰ç»§æ‰¿ UIResponder çš„ å¯¹è±¡ æ‰èƒ½å¤Ÿæ¥æ”¶å¹¶å¤„ç†äº‹ä»¶ï¼ŒUIResponder æ˜¯æ‰€æœ‰å“åº”å¯¹è±¡çš„ åŸºç±»ã€‚ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š UIApplication -&gt; UIResponder -&gt; NSObject UIViewController -&gt; UIResponder -&gt; NSObject UIWindow -&gt; UIViww -&gt; UIResponder -&gt; NSObject UIButton -&gt; UIControl -&gt; UIView -&gt; UIResponder -&gt; NSObject UIView -&gt; UIResponder -&gt; NSObject äº‹ä»¶é“¾ ä¼ é€’é“¾ï¼šç”±ç³»ç»Ÿå‘ç¦»ç”¨æˆ·æœ€è¿‘çš„viewä¼ é€’ã€‚é¡ºåºï¼šAppdelegate -&gt; UIApplication -&gt; UIWindow -&gt; RootViewController -&gt; subViews å“åº”é“¾ï¼šç”±ç¦»ç”¨æˆ·æœ€è¿‘çš„viewå‘ç³»ç»Ÿä¼ é€’ã€‚é¡ºåºï¼š superViews â€“&gt; RootViewController â€“&gt; UIWindow â€“&gt; UIApplication â€“&gt; AppDelegate ä¼ é€’é“¾ äº‹ä»¶ä¼ é€’çš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³• 1234// è¿”å›å“ªä¸ªè§†å›¾è¿›è¡Œäº‹ä»¶å“åº”- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event; // åˆ¤æ–­æŸä¸€ä¸ªç‚¹å‡»çš„ä½ç½®æ˜¯å¦åœ¨è§†å›¾èŒƒå›´å†…- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event; å…¶ä¸­ UIView ä¸æ¥å—äº‹ä»¶å¤„ç†çš„æƒ…å†µæœ‰ hidden &#x3D; YES è§†å›¾è¢«éšè— userInteractionEnabled &#x3D; NO ä¸æ¥å—å“åº”äº‹ä»¶ alpha &lt;&#x3D; 0.01,é€æ˜è§†å›¾ä¸æ¥æ”¶å“åº”äº‹ä»¶ å­è§†å›¾è¶…å‡ºçˆ¶è§†å›¾èŒƒå›´ éœ€å“åº”è§†å›¾è¢«å…¶ä»–è§†å›¾ç›–ä½ æ˜¯å¦é‡å†™äº†å…¶çˆ¶è§†å›¾ä»¥åŠè‡ªèº«çš„hitTestæ–¹æ³• æ˜¯å¦é‡å†™äº†å…¶çˆ¶è§†å›¾ä»¥åŠè‡ªèº«çš„pointInsideæ–¹æ³• æµç¨‹æè¿° å½“iOSç¨‹åºå‘ç”Ÿè§¦æ‘¸äº‹ä»¶åï¼Œç³»ç»Ÿä¼šåˆ©ç”¨ Runloop å°†äº‹ä»¶åŠ å…¥åˆ° UIApplication çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ UIApplication åˆ†å‘è§¦æ‘¸äº‹ä»¶åˆ° UIWindow ç„¶å UIWindow ä¾æ¬¡å‘ä¸‹åˆ†å‘ç»™ UIView UIView è°ƒç”¨ hitTest:withEvent: æ–¹æ³•è¿”å›ä¸€ä¸ªæœ€ç»ˆå“åº”çš„è§†å›¾ åœ¨ hitTest:withEvent: æ–¹æ³•ä¸­å°±ä¼šå»è°ƒç”¨ pointInside: withEvent: å»åˆ¤æ–­å½“å‰ç‚¹å‡»çš„ point æ˜¯å¦åœ¨ UIView èŒƒå›´å†…ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±ä¼šå» é€†åºéå† å®ƒçš„å­è§†å›¾æ¥æŸ¥æ‰¾æœ€ç»ˆå“åº”çš„ å­è§†å›¾ éå†çš„æ–¹å¼æ˜¯ä½¿ç”¨ å€’åº çš„æ–¹å¼æ¥éå†å­è§†å›¾ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åæ·»åŠ çš„å­è§†å›¾ä¼šæœ€å…ˆéå†ï¼Œåœ¨æ¯ä¸€ä¸ªè§†å›¾ä¸­éƒ½ä¼šå»è°ƒç”¨å®ƒçš„ hitTest:withEvent: æ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ª é€’å½’è°ƒç”¨ æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªå“åº”è§†å›¾ï¼Œå¦‚æœè¿”å›è§†å›¾æœ‰å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªè§†å›¾å°±ä½œä¸ºæœ€ç»ˆå“åº”è§†å›¾ï¼Œç»“æŸæ•´ä¸ªäº‹ä»¶ä¼ é€’ï¼›å¦‚æœæ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆå°±ä¼šå°†UIViewä½œä¸ºå“åº”è€… å“åº”é“¾å“åº”è€…é“¾çš„äº‹ä»¶ä¼ é€’è¿‡ç¨‹ å¦‚æœ view çš„æ§åˆ¶å™¨å­˜åœ¨ï¼Œå°±ä¼ é€’ç»™æ§åˆ¶å™¨å¤„ç†ï¼›å¦‚æœæ§åˆ¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™ä¼ é€’ç»™å®ƒçš„ çˆ¶è§†å›¾ åœ¨è§†å›¾å±‚æ¬¡ç»“æ„çš„æœ€é¡¶å±‚ï¼Œå¦‚æœä¹Ÿä¸èƒ½å¤„ç†æ”¶åˆ°çš„äº‹ä»¶ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™ UIWindow å¯¹è±¡è¿›è¡Œå¤„ç† å¦‚æœ UIWindow å¯¹è±¡ä¹Ÿä¸å¤„ç†ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™ UIApplication å¯¹è±¡ å¦‚æœ UIApplication ä¹Ÿä¸èƒ½å¤„ç†è¯¥äº‹ä»¶ï¼Œåˆ™å°†è¯¥äº‹ä»¶ä¸¢å¼ƒ é¢è¯•é¢˜ å®ç°ä¸€ä¸ªæŒ‰é’®çš„ç‚¹å‡»èŒƒå›´æ‰©å¤§æ•ˆæœ æ€è·¯ï¼šè‡ªå®šä¹‰ä¸€ä¸ªæŒ‰é’®ï¼Œé‡å†™ poinstInSide æ–¹æ³•ï¼Œå¢å¤§å†…è¾¹è·ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„bounds 1234567891011#import &quot;ZJBtn.h&quot;@implementation ZJBtn- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event&#123; // å½“å‰btnå¤§å° CGRect btnBounds = self.bounds; // æ‰©å¤§æŒ‰é’®çš„ç‚¹å‡»èŒƒå›´ï¼Œå¢å¤§å†…è¾¹è· btnBounds = CGRectInset(btnBounds, -50, -50); // è‹¥ç‚¹å‡»çš„ç‚¹åœ¨æ–°çš„boundsé‡Œï¼Œè¿”å›YES return CGRectContainsPoint(btnBounds, point);&#125;@end å­è§†å›¾è¶…è¿‡çˆ¶è§†å›¾éƒ¨åˆ†ä»ç„¶èƒ½å“åº” æ€è·¯ï¼šæ­£å¸¸æƒ…å†µä¸‹å­è§†å›¾è¶…å‡ºéƒ¨åˆ†æ˜¯ä¸èƒ½å“åº”äº‹ä»¶çš„ï¼Œéœ€é‡å†™ hitTest:withEvent æ–¹æ³•ï¼ŒæŒ‡å®š å­è§†å›¾ å¯ç‚¹å‡» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#import &quot;VA.h&quot;@interface VA ()@property (nonatomic,strong)UIButton * btn;@end@implementation VA- (instancetype)initWithFrame:(CGRect)frame&#123; self = [super initWithFrame:frame]; if (self) &#123; [self addSubview:self.btn]; &#125; return self;&#125;- (void)clickBtn&#123; NSLog(@&quot;%s&quot;,__func__);&#125;- (UIButton *)btn&#123; if (!_btn) &#123; _btn = [[UIButton alloc] initWithFrame:CGRectMake(-50, 20, self.frame.size.width + 100, 100)]; _btn.backgroundColor = [UIColor blueColor]; [_btn addTarget:self action:@selector(clickBtn) forControlEvents:UIControlEventTouchUpInside]; &#125; return _btn;&#125;/* å­è§†å›¾è¶…è¿‡çˆ¶è§†å›¾éƒ¨åˆ†ï¼Œéœ€è¦ç‚¹å‡»è¶…å‡ºèŒƒå›´çš„éƒ¨åˆ†ä¹Ÿæœ‰ç›¸åº” */- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123; // åˆ¤æ–­btnèƒ½å¦æ¥æ”¶äº‹ä»¶ if (self.btn.userInteractionEnabled == NO || self.btn.hidden == YES || self.btn.alpha &lt;= 0.01) &#123; return nil; &#125; // æŠŠå½“å‰ç‚¹è½¬æ¢æˆbtnåæ ‡ç³»ä¸Šçš„ç‚¹ CGPoint btnP = [self convertPoint:point toView:self.btn]; // å½“è§¦æ‘¸ç‚¹åœ¨btnä¸Šæ—¶ï¼Œæ‰è®©æŒ‰é’®ç›¸åº”äº‹ä»¶ if ([self.btn pointInside:btnP withEvent:event]) &#123; NSLog(@&quot;%@&quot;,NSStringFromCGPoint(btnP)); return self.btn; &#125; NSLog(@&quot;çˆ¶è§†å›¾ç›¸åº”&quot;); return [super hitTest:point withEvent:event];&#125;@end","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"iOSé¢è¯•é¢˜ï¼šSwift","slug":"é¢è¯•é¢˜/iOSé¢è¯•é¢˜ï¼šSwift","date":"2023-03-01T08:57:50.000Z","updated":"2023-03-05T23:34:26.569Z","comments":true,"path":"2023/03/01/é¢è¯•é¢˜/iOSé¢è¯•é¢˜ï¼šSwift/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/%E9%9D%A2%E8%AF%95%E9%A2%98/iOS%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9ASwift/","excerpt":"","text":"swift å’Œ oc çš„åŒºåˆ«ï¼Ÿ swift æ˜¯é™æ€è¯­è¨€ï¼Œæœ‰ç±»å‹åˆ¤æ–­ã€‚OC æ˜¯åŠ¨æ€è¯­è¨€ã€‚ swift å¯ä»¥é¢å‘ å‡½æ•°ã€åè®®ã€å¯¹è±¡ ç¼–ç¨‹ï¼›ocä»¥é¢å‘ å¯¹è±¡ ç¼–ç¨‹ä¸ºä¸»ï¼Œå¯ä»¥å¼•å…¥ Reactive Cocoaç±»åº“ æ¥è¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹ Swift æ˜¯ ç±»å‹å®‰å…¨ çš„è¯­è¨€ã€‚OC ä¸æ˜¯ç±»å‹å®‰å…¨çš„è¯­è¨€ã€‚ Swift å¤§éƒ¨åˆ†éƒ½æ˜¯ å€¼ç±»å‹ï¼Œå°‘éƒ¨åˆ†æ˜¯ å¼•ç”¨ç±»å‹ã€‚OC æœ‰çš„æ˜¯ å€¼ç±»å‹ï¼Œæœ‰çš„æ˜¯ æŒ‡é’ˆç±»å‹ã€‚ swiftç±»å‹ï¼ŸSwiift å€¼ç±»å‹ å’Œ å¼•ç”¨ç±»å‹çš„åŒºåˆ«ï¼Ÿç‰¹ç‚¹ï¼Ÿ swiftçš„ç±»å‹åˆ†ä¸º å€¼ç±»å‹ å’Œ å¼•ç”¨ç±»å‹ã€‚ å€¼ç±»å‹ï¼šåœ¨swiftä¸­å®šä¹‰çš„å¾ˆå¤šç±»å‹éƒ½æ˜¯å€¼ç±»å‹ï¼šå¦‚ structã€enumã€Intã€Floatã€Boolã€Stringã€Arrayã€Dictionaryã€String ç­‰éƒ½æ˜¯ å€¼ç±»å‹ã€‚ å¼•ç”¨ç±»å‹ï¼š classç±»å‹ã€closureé—­åŒ…ã€å‡½æ•° ä¸ºå¼•ç”¨ç±»å‹ åŒºåˆ« å€¼ç±»å‹ï¼šä¼ é€’å’Œèµ‹å€¼ æ—¶æ˜¯ä¸€ä¸ª å‰¯æœ¬ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå½±å“ æºæ•°æ® å¼•ç”¨ç±»å‹ï¼šä¼ é€’å’Œèµ‹å€¼ æ˜¯ æœ¬èº«ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå½±å“æºæ•°æ® å¸¸ç”¨çš„å…³é”®å­— finalï¼š åªèƒ½ç”¨äº ç±» ä¸­ï¼Œä¿®é¥°çš„ æ–¹æ³•ã€å±æ€§ï¼Œä¸èƒ½è¢«é‡å†™ final ä¿®é¥°çš„ç±»ï¼Œä¸èƒ½è¢«ç»§æ‰¿ inoutï¼šè¾“å…¥è¾“å‡ºå½¢å¼å‚æ•° å°†å‡½æ•°çš„å‚æ•°ç”± å€¼ç±»å‹ è½¬ä¸º å¼•ç”¨ç±»å‹ mutatingï¼šå¼‚å˜æ–¹æ³• é»˜è®¤æƒ…å†µä¸‹ç»“æ„ä½“å’Œæšä¸¾ï¼Œä¸å…è®¸ä¿®æ”¹å±æ€§ï¼Œå¯ä»¥åœ¨ func å‰åŠ  mutating æŒ‡å®šå¯ä»¥ä¿®æ”¹å±æ€§ #available ç”¨æ¥åˆ¤æ–­å¹³å°å’Œæ“ä½œç³»ç»Ÿ @available ç”¨äºä¿®é¥° æ–¹æ³•ã€å±æ€§ã€åè®®ã€æ‰©å±•ï¼Œç”¨æ¥è¡¨è¾¾å®ƒçš„å¯ç”¨æ€§ é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿé—­åŒ…ä½œç”¨ï¼Ÿ å¯ä»¥ä¼ é€’å’Œå¼•ç”¨çš„ä»£ç å— å¯ä»¥æ•è·å’Œå­˜å‚¨ä¸Šä¸‹æ–‡çš„å¸¸é‡å’Œå˜é‡ å…¨å±€å‡½æ•°å’Œå†…åµŒå‡½æ•°æ—¶ ç‰¹æ®Šçš„é—­åŒ… é—­åŒ…çš„ç±»å‹å‡½æ•°å’Œé—­åŒ…éƒ½æ˜¯ å¼•ç”¨ç±»å‹ å°¾éšé—­åŒ…ï¼šé—­åŒ…ä½œä¸ºå‡½æ•°æœ€åä¸€ä¸ªå‚æ•° é€ƒé€¸é—­åŒ…ï¼šå‡½æ•°è¿”å›ä¹‹åè°ƒç”¨ @escaping è‡ªåŠ¨é—­åŒ…ï¼šå»¶è¿Ÿæ‰§è¡Œ @autoclosure å±æ€§è§‚å¯Ÿè€… willSetï¼šä¼šåœ¨è¯¥å€¼è¢«å­˜å‚¨ä¹‹å‰è¢«è°ƒç”¨ï¼ŒnewValue didSetï¼šä¼šåœ¨ä¸€ä¸ªæ–°å€¼è¢«å­˜å‚¨ä¹‹åè¢«è°ƒç”¨ï¼ŒoldValue ä»€ä¹ˆæ˜¯æ‰©å±•ï¼Ÿä½œç”¨ï¼Ÿ æ‰©å±•å°±æ˜¯å‘ä¸€ä¸ª å·²æœ‰ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾ æ·»åŠ æ–°åŠŸèƒ½ æ‰©å±•å¯ä»¥å‘ä¸€ä¸ª ç±»å‹ æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä¸èƒ½é‡å†™å·²æœ‰çš„åŠŸèƒ½ æ·»åŠ  å±æ€§ï¼ˆå­˜å‚¨ã€è®¡ç®—ï¼‰ï¼Œæ–¹æ³•ï¼ˆå®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ï¼‰ï¼Œæ„é€ å™¨ï¼Œä¸‹æ ‡è„šæœ¬ï¼ŒåµŒå¥—ç±»å‹ï¼Œåè®®ç­‰ã€‚ ä»€ä¹ˆæ˜¯åè®®ï¼Ÿä½œç”¨ï¼Ÿ åè®®è§„å®šäº† ç”¨æ¥å®ç°æŸä¸€ç‰¹å®šåŠŸèƒ½æ‰€å¿…é¡»çš„æ–¹æ³•å’Œå±æ€§ ç±»ã€ç»“æ„ä½“ã€æšä¸¾ éƒ½å¯ä»¥éµå¾ªåè®®ï¼Œæä¾›å…·ä½“çš„å®ç°æ¥å®Œæˆåè®®å®šä¹‰çš„æ–¹æ³•å’ŒåŠŸèƒ½ åè®®ç”¨äºæŒ‡å®šç‰¹å®šçš„ å®ä¾‹å±æ€§æˆ–ç±»å±æ€§ï¼Œè€Œä¸ç”¨æŒ‡å®šæ˜¯ å­˜å‚¨å±æ€§æˆ–è®¡ç®—å±æ€§ï¼Œå¿…é¡»æŒ‡å®šæ˜¯åªè¯»è¿˜æ˜¯å¯è¯»å¯å†™ å¸¸ç”¨çš„ä¸‰æ–¹æ¡†æ¶ Alamofireï¼šç½‘ç»œåŠ è½½ SwiftyJSONï¼šJSONè§£æ R.swiftï¼šä½¿ç”¨èµ„æºæ–‡ä»¶ Snapkitï¼šè‡ªåŠ¨å¸ƒå±€ MonkeyKingï¼šå°†å†…å®¹åˆ†äº«åˆ°ç¤¾äº¤å¹³å° Kingfisherï¼šç½‘ç»œå›¾ç‰‡åŠ è½½å’Œç¼“å­˜","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-é¢è¯•é¢˜","slug":"Swift-é¢è¯•é¢˜","permalink":"https://www.bboyzj.cn/tags/Swift-%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"iOSé¢è¯•é¢˜ï¼šOC","slug":"é¢è¯•é¢˜/iOSé¢è¯•é¢˜ï¼šOC","date":"2023-03-01T08:57:33.000Z","updated":"2023-03-08T08:18:47.952Z","comments":true,"path":"2023/03/01/é¢è¯•é¢˜/iOSé¢è¯•é¢˜ï¼šOC/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/%E9%9D%A2%E8%AF%95%E9%A2%98/iOS%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9AOC/","excerpt":"","text":"OCç®—æ³•1. å†’æ³¡æ’åº1ï¼‰ä¾æ¬¡æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªå…ƒç´ ï¼Œé¡ºåºé”™è¯¯åˆ™äº¤æ¢ä½ç½®ï¼›éœ€è¦ä¸¤å±‚å¾ªç¯ï¼Œå¤–å±‚å¾ªç¯æ§åˆ¶è¶Ÿæ•°ï¼Œå†…å±‚å¾ªç¯æ§åˆ¶æ¯”è¾ƒæ¬¡æ•° 2ï¼‰ä¾‹å­ï¼š 123456789101112NSMutableArray * arr = [NSMutableArray arrayWithArray:@[@&quot;1&quot;,@&quot;3&quot;,@&quot;2&quot;,@&quot;5&quot;,@&quot;4&quot;]]; // å¤–å¾ªç¯æ§åˆ¶æ’åºè¶Ÿæ•°,è¿›è¡Œ array.count-1 è¶Ÿ for (int i = 0; i &lt; arr.count; i ++) &#123; // è®°å½•æ˜¯å¦è¿›è¡Œäº†äº¤æ¢ï¼Œå¦‚æœæ²¡æœ‰äº¤æ¢ï¼Œæ•°ç»„é¡ºåºä¸ºé¡ºåºï¼Œåˆ™ç›´æ¥è·³å‡ºå¤–å±‚å¾ªç¯ç»“æŸæ’åº for (int j = 0; j &lt; arr.count - i - 1; j++) &#123; // ç›¸é‚»å…ƒç´ æ¯”è¾ƒï¼Œè‹¥é€†åºåˆ™äº¤æ¢ if ([arr[j] intValue] &gt; [arr[j + 1] intValue]) &#123; [arr exchangeObjectAtIndex:j withObjectAtIndex:j + 1]; &#125; &#125; &#125; 2. é€‰æ‹©æ’åº1ï¼‰ä»ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å…¶ä»–å…ƒç´ æ¯”è¾ƒæ‰¾åˆ°æœ€å°å€¼ï¼Œé‡å¤æ“ä½œï¼Œç›´åˆ°æœ€åä¸€ä½ç»“æŸï¼›éœ€è¦ä¸¤å±‚å¾ªç¯ï¼Œå¤–å±‚å¾ªç¯è¶Ÿæ•°ï¼Œé‡Œå±‚å¾ªç¯æ¯”è¾ƒæ¬¡æ•° 2ï¼‰ä¾‹å­ 1234567891011NSMutableArray * arr = [NSMutableArray arrayWithObjects:@&quot;2&quot;,@&quot;1&quot;,@&quot;5&quot;,@&quot;3&quot;, nil];// å¤–å¾ªç¯æ§åˆ¶æ’åºè¶Ÿæ•°,è¿›è¡Œ array.count-1 è¶Ÿfor (int i = 0; i &lt; arr.count; i ++) &#123; // é‡Œå¾ªç¯è·æ¯”è¾ƒæ¢ä½ for (int j = i + 1; j &lt; arr.count; j ++) &#123; if ([arr[i] intValue] &gt; [arr[j] intValue]) &#123; [arr exchangeObjectAtIndex:i withObjectAtIndex:j]; &#125; &#125;&#125;NSLog(@&quot;arr:%@&quot;,arr); 3. ç›´æ¥æ’å…¥æ’åº1ï¼‰ å§‹ç»ˆå®šä¹‰ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º å·²æ’åº çš„ï¼Œå°†å‰©ä½™å…ƒç´ å®šä¹‰ä¸º æœªæ’åº é€ä¸ªæ’å…¥åˆ° å·²æ’åº çš„æ’åˆ—ä¸­ï¼›ä¸æ–­çš„ç§»åŠ¨æ•°æ®ï¼Œç©ºå‡ºä¸€ä¸ªé€‚å½“çš„ä½ç½®ï¼ŒæŠŠå¾…æ’å…¥çš„å…ƒç´ æ”¾åˆ°é‡Œé¢å» 2ï¼‰ä¾‹å­ 12345678910111213141516171819NSMutableArray * arr = @[@2,@1,@3,@5,@4].mutableCopy;// æ’å…¥æ’åºçš„åŸç†ï¼šå§‹ç»ˆå®šä¹‰ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæœ‰åºçš„ï¼Œå°†å…ƒç´ é€ä¸ªæ’å…¥åˆ°æœ‰åºçš„æ’åˆ—ä¸­// å…¶ç‰¹ç‚¹æ˜¯ï¼šä¸æ–­çš„ç§»åŠ¨æ•°æ®ï¼Œç©ºå‡ºä¸€ä¸ªé€‚å½“çš„ä½ç½®ï¼ŒæŠŠå¾…æ’å…¥çš„å…ƒç´ æ”¾åˆ°é‡Œé¢å»for(int i = 0;i &lt; arr.count;i++)&#123; // å¾…æ’åºå€¼ NSNumber * temp = arr[i]; // å·²æ’åºä¸‹æ ‡ int j = i - 1; // å¾…æ’åºä¸å·²æ’åºæ¯”è¾ƒï¼Œä»åå‘å‰æ¯”è¾ƒ while (j &gt;= 0 &amp;&amp; [arr[j] integerValue] &gt; [temp integerValue]) &#123; // å¦‚æœå·²æ’åºçš„ &gt; å¾…æ’åºçš„ å¾€åç§»åŠ¨ä¸€ä¸ªä½ç½® [arr replaceObjectAtIndex:(j + 1) withObject:arr[j]]; j --; &#125; // ç©ºå‡ºæ¥çš„ä½ç½®æ’å…¥æ–°å…ƒç´  [arr replaceObjectAtIndex:(j + 1) withObject:temp]; NSLog(@&quot;arr:%@&quot;,arr);&#125; æ‰“å°ç»“æœï¼š 12345672022-12-13 10:26:19.242271+0800 æ’å…¥æ’åº[4184:77845] arr:( 1, 2, 3, 4, 5) 4. å¸Œå°”æ’åº1ï¼‰å¸Œå°”æ’åºç›¸å½“äº ç›´æ¥æ’å…¥æ’åºåŠ å¼ºç‰ˆï¼Œå¼•å…¥äº† å¢é‡ çš„æ¦‚å¿µï¼›ç›´åˆ°å¢é‡ä¸º 1 æ—¶ï¼Œå†è¿›è¡Œç›´æ¥æ’å…¥æ’åº 2ï¼‰ä¾‹å­ 1234567891011121314151617181920212223NSMutableArray * arr = @[@7,@3,@8,@5,@2,@6,@1,@4].mutableCopy;// å…¶å®é—´éš”å€¼è®¾å€¼ä¸ºæ€»æ•°çš„ä¸€åŠint gap = arr.count/2;// ç›´åˆ°é—´éš”å°äº1æ—¶ç»“æŸwhile (gap &gt;= 1) &#123; // i å¾…æ’å…ƒç´ ï¼Œä»¥ æ­¥è· gap ä»åå‘å‰æ‰«æ for(int i = 0;i &lt; arr.count;i++)&#123; // å¾…æ’å…ƒç´  NSNumber * temp = arr[i]; // å½“å‰ä½ç½® int j = i; // è·³è·ƒå¼æ¯”è¾ƒ while (j &gt;= gap &amp;&amp; [arr[j - gap] integerValue] &gt; [temp integerValue] ) &#123; [arr replaceObjectAtIndex:j withObject:arr[j - gap]]; j -= gap; &#125; // ç©ºå‡ºæ¥ä½ç½®ï¼Œæ’å…¥å¾…æ’åº [arr replaceObjectAtIndex:j withObject:temp]; &#125; // æ”¹å˜æ­¥é•¿ gap = gap/2;&#125;NSLog(@&quot;arr:%@&quot;,arr); æ‰“å°ç»“æœï¼š 123456789102022-12-13 10:22:41.910840+0800 æ’å…¥æ’åº[4124:74568] arr:( 1, 2, 3, 4, 5, 6, 7, 8) 5. æ–æ³¢é‚£å¥‘æ•°åˆ—1ï¼‰ä¹Ÿå°±æ˜¯ å…”å­æ•°åˆ—ï¼Œå½“å‰æ•°æ˜¯å‰ä¸¤ä¸ªæ•°åˆ—ä¹‹å’Œ 2ï¼‰ä¾‹å­ 12345678910111213141516- (void)viewDidLoad &#123; [super viewDidLoad]; NSInteger num = 10; NSInteger total = [self getTotalNum:num]; NSLog(@&quot;total:%ld&quot;,total);&#125;- (NSInteger)getTotalNum:(NSInteger)num&#123; if(num == 0)&#123; return 0; &#125; if(num == 1)&#123; return 1; &#125; return [self getTotalNum:num-2] + [self getTotalNum:num-1];&#125; æ‰“å°ç»“æœï¼š 12022-12-13 10:28:32.672554+0800 æ–æ³¢é‚£å¥‘æ•°åˆ—[4285:80606] total:89 6. äºŒåˆ†æŸ¥æ‰¾1ï¼‰æœ‰åºçš„æ•°ç»„ï¼Œå°†æ•°ç»„åˆ†å‰²æˆä¸¤ä»½ï¼Œåˆ©ç”¨æŸ¥æ‰¾çš„å€¼è·Ÿä¸­é—´å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæŸ¥æ‰¾çš„å€¼å¤§äºä¸­é—´å€¼ï¼Œå°±åœ¨æ•°ç»„çš„å³è¾¹è¿›è¡ŒæŸ¥æ‰¾ï¼›å¦‚æœæŸ¥æ‰¾çš„å€¼å°äºä¸­é—´å€¼ï¼Œå°±åœ¨æ•°ç»„çš„å·¦è¾¹è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æ­¤å¾ªç¯çš„æ‰§è¡Œä¸‹å»ï¼Œæœ€ç»ˆæ‰¾åˆ°ç¬¦åˆçš„å€¼ã€‚ 2ï¼‰ä¾‹å­ 123456789101112131415161718192021222324NSArray * arr = @[@(1),@(3),@(5),@(6),@(8),@(10)];int key = [@(5) intValue];int min = 0;int max = arr.count - 1;int mid;while (min &lt;= max) &#123; // è®¡ç®—ä¸­é—´ä¸‹æ ‡ mid = (min + max) / 2; // å¦‚æœç›®æ ‡å€¼ &gt; ä¸­é—´ä¸‹æ ‡çš„ä¸­é—´å€¼ if (key &gt; [arr[mid] intValue]) &#123; //æœ€å°å˜ä¸ºä¸­é—´ä¸‹æ ‡+1 min = mid + 1; &#125; // å¦‚æœç›®æ ‡å€¼ &lt; ä¸­é—´ä¸‹æ ‡çš„ä¸­é—´å€¼ else if (key &lt; [arr[mid] intValue])&#123; //æœ€å¤§å˜ä¸ºä¸­é—´ä¸‹æ ‡-1 max = max - 1; &#125; // å¦åˆ™ï¼Œæ­£å¥½ else &#123; NSLog(@&quot;key:%d&quot;,mid); break; &#125;&#125; æ‰“å°ç»“æœï¼š 12022-12-13 10:33:18.661324+0800 äºŒåˆ†æŸ¥æ‰¾[4607:86953] key:2 7. é€’å½’ç®—æ³•é€’å½’æ±‚å’Œ1+2+..+n? 1234567891011121314- (void)viewDidLoad &#123; [super viewDidLoad]; int sum = [self sum:4]; NSLog(@&quot;sum:%d&quot;,sum);&#125;- (int)sum:(int)n&#123; if (n == 1) &#123; return 1; &#125;else &#123; return [self sum:n-1] + n; &#125;&#125; é“¾è¡¨OCæ•°æ®ç»“æ„01ï¼šé“¾è¡¨çš„æ¢ç´¢ äºŒå‰æ ‘OCæ•°æ®ç»“æ„02ï¼šäºŒå‰æ ‘æ¢ç´¢ OCå¸¸è§çš„é¢è¯•é¢˜ä»€ä¹ˆæ˜¯é‡æŒ‡é’ˆï¼Ÿæ˜¯ä¸€ä¸ªæ²¡æœ‰æŒ‡å‘ ä»»ä½•å†…å­˜ çš„ æŒ‡é’ˆï¼Œå°è¯•ä½¿ç”¨å®ƒä¼šå¯¼è‡´ åº”ç”¨ç¨‹åºå´©æºƒ ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿä¸€ä¸ª å¯¹è±¡ æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œä¼š å†…å­˜æ³„æ¼ï¼Œå†…å­˜æ³„æ¼ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå ç”¨çš„å†…å­˜ä¼šè¶Šæ¥è¶Šå¤§ï¼Œç›´åˆ°åº”ç”¨ç¨‹åºæ— å†…å­˜å¯ç”¨æ—¶ï¼Œä¼šå¯¼è‡´ åº”ç”¨ç¨‹åºå´©æºƒ iOS å…³é”®è¯æœ‰å“ªäº›ï¼Ÿå„æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ é‡ç‚¹ readwrite å¯è¯»å¯å†™ ç‰¹æ€§ï¼ŒåŒæ—¶ç”Ÿæˆgetæ–¹æ³•å’Œsetæ–¹æ³•çš„å£°æ˜å’Œå®ç° readonly åªè¯» ç‰¹æ€§ï¼Œåªä¼šç”Ÿæˆgetæ–¹æ³•çš„å£°æ˜å’Œå®ç°ï¼Œä¸å¸Œæœ›å±æ€§åœ¨ç±»å¤–æ”¹å˜ retain æŒæœ‰ ç‰¹æ€§ï¼Œretaincount ä¼š +1,ç”¨äº MRC nonatomic éåŸå­ ç‰¹æ€§ atomic åŸå­ ç‰¹æ€§ï¼Œé»˜è®¤å±æ€§ atomicä¸æ˜¯ç»å¯¹çº¿ç¨‹å®‰å…¨çš„ï¼Œåªæ˜¯å¯¹ setter/getter æ–¹æ³•ä½¿ç”¨äº† è‡ªæ—‹é”(spinlock_t)ï¼Œå†…éƒ¨ä½¿ç”¨ äº’æ–¥é”(os_unfair_lock)ï¼Œä¿è¯äº† è¯»/å†™ å®‰å…¨ã€‚ atomicå¹¶ä¸èƒ½ä¿è¯ æ•´ä¸ªå¯¹è±¡ æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦å¯¹ æ•´ä¸ªå¯¹è±¡ è¿›è¡Œ åŠ é” æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š * NSLockï¼ˆäº’æ–¥é”ï¼‰ * dispathch_semaphoreï¼ˆä¿¡å·é‡ï¼‰ * @synchronizedï¼ˆäº’æ–¥é€’å½’é”ï¼‰ assign å¯ä»¥ä¿®é¥° åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ã€‚ é€šå¸¸ç”¨äºä¿®é¥° åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚Intã€CGFloatã€Doubleç­‰ï¼Œè¿™æ˜¯å› ä¸º åŸºæœ¬æ•°æ®ç±»å‹æ”¾åœ¨æ ˆåŒºï¼Œæ ˆç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œæ ˆå…ˆè¿›åå‡ºï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å‡ºæ ˆåï¼Œassignä¿®é¥°çš„åŸºæœ¬æ•°æ®ç±»å‹å°±ä¸å­˜åœ¨äº†ï¼Œä¸ä¼šå‡ºç° é‡æŒ‡é’ˆ ä¿®é¥°å¯¹è±¡ï¼Œå¦‚NSStringã€å®ä¾‹å¯¹è±¡ç­‰ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¼šå¢åŠ ï¼Œä½† assign ä¿®é¥°å¯¹è±¡é‡Šæ”¾åï¼ŒæŒ‡é’ˆ ä¸ä¼šè¢«ç³»ç»Ÿç½®ä¸ºnilï¼Œä¼šäº§ç”Ÿ é‡æŒ‡é’ˆ æˆ– EXC_BAD_ACCESS é”™è¯¯ã€‚ strong å¼ºå¼•ç”¨ï¼Œåªä¿®é¥°å¯¹è±¡ï¼Œå±æ€§é»˜è®¤ä¿®é¥°ç¬¦ æŒ‡å‘å¹¶æŒæœ‰è¯¥å¯¹è±¡ï¼Œå…¶ä¿®é¥°çš„å¯¹è±¡å¼•ç”¨è®¡æ•°ä¼š +1ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¸º 0 åˆ™ä¸ä¼šè¢«é”€æ¯ï¼Œéœ€è¦å°†å…¶ç½®ä¸º nil å¯ä»¥é”€æ¯ã€‚å¦åˆ™ä¼šå‡ºç° å†…å­˜æ³„æ¼ã€‚ weak å¼±å¼•ç”¨ï¼Œåªä¿®é¥°å¯¹è±¡ã€‚ æŒ‡å‘ä½†å¹¶ä¸æ‹¥æœ‰è¯¥å¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°ä¸å¢åŠ ã€‚è¯¥å¯¹è±¡è‡ªåŠ¨åœ¨å†…å­˜ä¸­é”€æ¯ã€‚ copy ç”¨äºä¿®é¥° ä¸å¯å˜çš„å¯¹è±¡ã€‚ æ¯”å¦‚NSStringã€NSDictionaryã€NSArrayç­‰ã€‚ æµ…æ‹·è´å’Œæ·±æ‹·è´ é‡ç‚¹ æµ…æ‹·è´ æµ…æ‹·è´ï¼Œæ‹·è´äº†ä¸€ä¸ªæ–°çš„æŒ‡é’ˆï¼Œä¸åŸå¯¹è±¡æŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œå¼•ç”¨è®¡æ•° + 1ï¼›(A,CopyA &#x3D; [A copy]ï¼ŒA å˜åŒ–ï¼ŒCopyA çš„å€¼ä¹Ÿå˜åŒ–) æ·±æ‹·è´ æ·±æ‹·è´ï¼Œæ‹·è´äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒæŒ‡å‘æ–°çš„å†…å­˜ï¼Œæ–°å¯¹è±¡çš„ å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œæºå¯¹è±¡å¼•ç”¨è®¡æ•°ä¸å˜ï¼›(A,MutableA &#x3D; [A mutbleCopy]ï¼ŒA å˜åŒ–ï¼ŒMutableA çš„å€¼ä¸å˜)ã€‚ NSString&#x2F;NSArray&#x2F;NSDictionaryå’ŒNSMutableString&#x2F;NSMutableArray&#x2F;NSMutableDictionary è¿›è¡Œcopyå’ŒmutableCopyåŒºåˆ«ï¼Ÿé‡ç‚¹ å¯¹äºä¸å¯å˜NSString&#x2F;NSArray&#x2F;NSDictionaryï¼Œcopyæµ…æ‹·è´(å…ƒç´ ï¼šæµ…æ‹·è´)ï¼ŒmutableCopyæ·±æ‹·è´(å…ƒç´ ï¼šæµ…æ‹·è´) å¯¹äºå¯å˜NSMutableString&#x2F;NSMutableArray&#x2F;NSMutableDictionaryï¼Œcopyæ·±æ‹·è´(å…ƒç´ ï¼šæµ…æ‹·è´)ï¼ŒmutableCopyæ·±æ‹·è´(å…ƒç´ ï¼šæµ…æ‹·è´) è‡ªå®šä¹‰å¯¹è±¡çš„copyå’ŒmutableCopyï¼Ÿ é‡ç‚¹ copyå’ŒmutableCopyéƒ½æ˜¯æ·±æ‹·è´(å±æ€§ï¼šæµ…æ‹·è´ï¼‰ å±æ€§ç”¨copyè¿˜æ˜¯strongï¼Ÿ é‡ç‚¹ å¯¹äºä¸å¯å˜å±æ€§ï¼Œæ¨èç”¨copyï¼Œç›®çš„æ˜¯ä¸ºäº† è®©æœ¬å±æ€§ä¸å—å¤–ç•Œå½±å“ï¼Œæ— è®ºç»™æˆ‘ä¼ å…¥å¯å˜è¿˜æ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œæˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬ï¼Œè¢«setæ—¶ï¼Œæ”¹å˜çš„æ˜¯è¿™ä¸ªå‰¯æœ¬ã€‚ å¯¹äºå¯å˜å±æ€§ï¼Œæ¨èç”¨strongï¼Œå› ä¸ºcopyä¿®é¥°åï¼Œä¼šå˜æˆä¸å¯å˜å¯¹è±¡ï¼Œå†è°ƒç”¨å¯å˜å¯¹è±¡å‡½æ•°æ—¶ä¼š crash ä¸€ä¸ªAPPæ˜¯å¦‚ä½•å”¤é†’å¦ä¸€ä¸ªAPPçš„ï¼Ÿ é‡ç‚¹URL Schemeï¼šiOSæœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å°† è‡ªèº«ç»‘å®š åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„ URL Scheme ä¸Šï¼Œè¯¥ scheme ç”¨äºä» æµè§ˆå™¨æˆ–å…¶ä»–åº”ç”¨ä¸­å¯åŠ¨æœ¬åº”ç”¨ã€‚ å•ä¾‹çš„å†™æ³•å’Œä½œç”¨ï¼Ÿ é‡ç‚¹å•ä¾‹æ¨¡å¼çš„ä½œç”¨ï¼šå¯ä»¥ä¿è¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªç±»åªè¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œä¾›å¤–ç•Œè®¿é—®ï¼›staticä¿è¯ç±»åªåˆ†é…ä¸€æ¬¡å†…å­˜ï¼›dispatch_onceæ–¹æ³•ä¿è¯è°ƒç”¨ä¸€æ¬¡ï¼Œå¹¶è‡ªåŠ¨åŠ é”ï¼Œçº¿ç¨‹å®‰å…¨ 123456789101112static id _instance = nil; // å®šä¹‰staticå…¨å±€å˜é‡ï¼Œä¿è¯åªåˆ†é…ä¸€æ¬¡å†…å­˜+ (id)shareInstance&#123; return [[self alloc] init];&#125;+ (id)copyWithZone:(struct _NSZone *)zone&#123; static dispatch_once_t onceToken; // å£°æ˜ä¸€ä¸ªé™æ€çš„GcDå•æ¬¡ä»»åŠ¡ // ä¿è¯åªæ‰§è¡Œä¸€æ¬¡ dispatch_once(&amp;onceToken,^&#123; // _instance = [super allocWithZone:zone]; &#125;); return p;&#125; è¿™ä¹ˆå†™å¯ä»¥ä¿è¯ä¸‹é¢ä¸¤ç§æ–¹å¼è¿”å›åŒä¸€ä¸ªå®ä¾‹ï¼š 123Single * p1 = [Single shareInstance];Single * p2 = [[Single alloc] init];NSLog(@&quot;%d&quot;,p1==p2); // 1 å¸¸ç”¨çš„æ•°æ®å­˜å‚¨æ–¹å¼æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Ÿ plistï¼šplistæ–‡ä»¶æ˜¯å°†æŸäº›ç‰¹å®šçš„ç±»ï¼Œé€šè¿‡ XMLæ–‡ä»¶ çš„æ–¹å¼ä¿å­˜åœ¨ç›®å½•ä¸­ã€‚ NSUserdefaultï¼šå½’æ¡£ æ•°æ®åº“ï¼šé€‚åˆå‚¨å­˜æ•°æ®é‡è¾ƒå¤§çš„æ•°æ®,ä¸€èˆ¬ä½¿ç”¨FMDBå’ŒCoreDataæ¥å®ç°. Keychainï¼šç”¨äº æœ¬åœ°é‡è¦æ•°æ®çš„å­˜å‚¨ï¼Œå°†æ•°æ®åŠ å¯†åå­˜å‚¨åœ¨æœ¬åœ°ã€‚å¦‚ï¼šå¯†ç ,ç§˜é’¥,åºåˆ—å· ç­‰,å½“ä½  åˆ é™¤APPåKeychainå­˜å‚¨çš„æ•°æ®ä¸ä¼šåˆ é™¤ï¼Œæ‰€ä»¥åœ¨é‡è£…Appåï¼ŒKeychainé‡Œçš„æ•°æ®è¿˜èƒ½ä½¿ç”¨ã€‚ æ²™ç›’å†™å…¥ï¼šå­˜å‚¨éæœºå¯†æ•°æ® Applicationï¼šå­˜æ”¾ç¨‹åºæºæ–‡ä»¶ï¼Œä¸Šæ¶å‰ç»è¿‡æ•°å­—ç­¾åï¼Œä¸Šæ¶åä¸å¯ä¿®æ”¹ã€‚ Documents: ä¿å­˜åº”â½¤è¿è¡Œæ—¶ç”Ÿæˆçš„éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ã€‚iTunes åŒæ­¥è®¾å¤‡æ—¶ä¼š å¤‡ä»½ è¯¥ç›®å½•ã€‚ tmp: ä¿å­˜åº”â½¤è¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶æ•°æ®ï¼Œä½¿â½¤å®Œæ¯•åå†å°†ç›¸åº”çš„æ–‡ä»¶ä»è¯¥ç›®å½•åˆ é™¤ã€‚iTunes åŒæ­¥è®¾å¤‡æ—¶ ä¸ä¼šå¤‡ä»½ è¯¥ç›®å½•ã€‚ Library&#x2F;Caches: ä¿å­˜åº”ç”¨è¿è¡Œæ—¶â½£æˆçš„éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ã€‚ iTunes åŒæ­¥è®¾å¤‡æ—¶ ä¸ä¼šå¤‡ä»½ è¯¥ç›®å½•ã€‚ Library&#x2F;Preference: ä¿å­˜åº”ç”¨çš„æ‰€æœ‰åå¥½è®¾ç½®ã€‚iTunes åŒæ­¥è®¾å¤‡æ—¶ä¼š å¤‡ä»½ è¯¥ç›®å½•ã€‚ åŠ å¯†æ–¹å¼æœ‰å“ªäº›ï¼Ÿå„è‡ªçš„åŠ å¯†ç®—æ³•å“ªäº›ï¼Ÿ å¯¹ç§°åŠ å¯†ï¼šåˆç§°å…¬å¼€å¯†é’¥åŠ å¯†ï¼ŒåŠ å¯†å’Œè§£å¯† éƒ½ä¼šç”¨åˆ° åŒä¸€ä¸ªå¯†é’¥ã€‚å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰ DESã€3DESã€AESã€Blowfishã€IDEAã€RC5ã€RC6ã€‚ éå¯¹ç§°åŠ å¯†ï¼šéå¯¹ç§°åŠ å¯†åˆç§° å…±äº«å¯†é’¥åŠ å¯†ï¼Œä½¿ç”¨ ä¸€å¯¹éå¯¹ç§°çš„å¯†é’¥ï¼Œä¸€æŠŠå«åš ç§æœ‰å¯†é’¥ï¼Œå¦ä¸€æŠŠå«åš å…¬æœ‰å¯†é’¥ï¼›å…¬é’¥åŠ å¯†åªèƒ½ç”¨ç§é’¥æ¥è§£å¯†ï¼Œç§é’¥åŠ å¯†åªèƒ½ç”¨å…¬é’¥æ¥è§£å¯†ã€‚å¸¸è§çš„æœ‰ï¼šRSAã€ElGamalã€èƒŒåŒ…ç®—æ³•ã€Rabinï¼ˆRSAçš„ç‰¹ä¾‹ï¼‰ã€è¿ªè²ï¼èµ«å°”æ›¼å¯†é’¥äº¤æ¢åè®®ä¸­çš„å…¬é’¥åŠ å¯†ç®—æ³•ã€æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ã€‚ æˆå‘˜å˜é‡å’Œå®ä¾‹å˜é‡åŒºåˆ«ï¼Ÿ æˆå‘˜å˜é‡ï¼šåœ¨æ–‡ä»¶ä¸­@interfaceä¸‹{}å†…çš„å‡ç»Ÿç§°ä¸º æˆå‘˜å˜é‡ å®ä¾‹å˜é‡ï¼šå®ä¾‹å˜é‡æ˜¯ ç±»å®šä¹‰ çš„å˜é‡ åŒºåˆ«ï¼š å»é™¤åŸºæœ¬æ•°æ®ç±»å‹int,floatâ€¦ç­‰ï¼Œå…¶ä»–ç±»å‹çš„å˜é‡å‡å«åš å®ä¾‹å˜é‡ æˆå‘˜å˜é‡ = å®ä¾‹å˜é‡ + åŸºæœ¬æ•°æ®ç±»å‹ @property çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„? @property &#x3D; _ivar + getter + setter; propertyï¼ˆå±æ€§ï¼‰&#x3D; _ivarï¼ˆå®ä¾‹å˜é‡ï¼‰+ setterï¼ˆå­˜æ–¹æ³•ï¼‰+ getterï¼ˆå–æ–¹æ³•ï¼‰ å±æ€§å¼•ç”¨self.nameä¸_nameçš„åŒºåˆ«ï¼Ÿ self.nameæ˜¯å¯¹å±æ€§çš„è®¿é—®ï¼Œ&#x3D; å·¦ä¾§æ˜¯è°ƒç”¨setteræ–¹æ³•ï¼Œ&#x3D; å³ä¾§æ˜¯è°ƒç”¨getteræ–¹æ³•ï¼Œå¯ä»¥åœ¨ç±»å¤–ä½¿ç”¨ï¼Œ_nameä¸èƒ½åœ¨ç±»å¤–ä½¿ç”¨ã€‚ _nameæ˜¯å¯¹ å±€éƒ¨å˜é‡ çš„è®¿é—®ï¼Œç›´æ¥è°ƒç”¨å˜é‡ï¼Œä¸é€šè¿‡getteræ–¹æ³• frame å’Œ bounds åŒºåˆ«ï¼Ÿ frameï¼šå‚è€ƒç³»æ˜¯çˆ¶è§†å›¾åæ ‡ boundsï¼šå‚è€ƒç³»æ˜¯è‡ªèº«åæ ‡ å¸¸è§çš„çŠ¶æ€ç ï¼Ÿ 2xx æˆåŠŸï¼š200è¡¨ç¤ºè¯·æ±‚æ­£å¸¸ã€‚ 3xx é‡å®šå‘ï¼š302æ˜¯è¯·æ±‚é‡å®šå‘ã€‚è§£å†³æ–¹æ³• NSURLConnetion å’Œ NSURLSession è¿›è¡Œæ‹¦æˆª 4xx å®¢æˆ·ç«¯é”™è¯¯ï¼š400å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼Œ404Not Found æ‰¾ä¸åˆ°&#x2F;è¯·æ±‚å¤±è´¥ 5xx æœåŠ¡å™¨é”™è¯¯ï¼š500 Internal Server Error æœåŠ¡å™¨çš„å†…éƒ¨é”™è¯¯ HTTPSå’ŒHTTPçš„åŒºåˆ«ï¼Ÿ é‡ç‚¹ HTTPï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜æ–‡ä¼ è¾“ï¼›ç«¯å£å·80ï¼›å“åº”é€Ÿåº¦å¿«ï¼ˆä½¿ç”¨TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦äº¤æ¢3ä¸ªåŒ…ï¼‰ï¼› HTTPSï¼šæ˜¯ç”± HTTP+SSL&#x2F;TLS åŠ å¯†ä¼ è¾“ï¼›ç«¯å£å·443ï¼›å“åº”é€Ÿåº¦æ…¢ï¼ˆé™¤äº†ä½¿ç”¨TCPä¸‰ä¸ªåŒ…ï¼Œè¿˜è¦åŠ ä¸ŠSSLæ¡æ‰‹çš„9ä¸ªåŒ…ï¼‰ï¼›éœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ TCP å’Œ UDP åŒºåˆ«? é‡ç‚¹ éƒ½æ˜¯ ä¼ è¾“å±‚ åè®® TCPåè®®æ˜¯ é¢å‘è¿æ¥çš„å¯é çš„ä¼ è¾“å±‚åè®®ã€‚UDPåè®®æ˜¯ é¢å‘éè¿æ¥çš„ä¼ è¾“å±‚åè®® TCPéœ€è¦ å»ºç«‹è¿æ¥å’Œæ–­å¼€è¿æ¥ã€‚UDPä¸éœ€è¦è¿æ¥ã€‚ TCPä¼  è¾“æ•°æ®æ²¡æœ‰å¤§å°é™åˆ¶ã€‚UDP ä¼ è¾“æ•°æ®æœ‰å¤§å°é™åˆ¶ã€‚ TCPä¼š å¤„ç†æ•°æ®ä¸¢åŒ…é‡å‘ã€‚UDPä¸ä¼šå¤„ç†ã€‚ HTTPå’ŒsocketåŒºåˆ«ï¼Ÿ é‡ç‚¹ HTTP åº”ç”¨å±‚åè®®ï¼›socket ä¸å±äºåè®®èŒƒç•´ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¥å£ï¼ˆAPIï¼‰ï¼Œæ˜¯å¯¹TCP&#x2F;IPåè®®çš„å°è£… HTTP æ˜¯åŸºäº è¯·æ±‚-å“åº” å½¢å¼ çŸ­è¿æ¥ï¼Œå³å®¢æˆ·ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”åç«‹å³ æ–­å¼€è¿æ¥ï¼›socket æ˜¯åŸºäºTCPåè®®çš„ é•¿é“¾æ¥ï¼Œç†è®ºä¸Š å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸€æ—¦å»ºç«‹è¿æ¥å°†ä¸ä¼šä¸»åŠ¨æ–­å¼€ HTTP ä¼ è¾“æ…¢ï¼Œæ•°æ®é‡å¤§ï¼Œå®‰å…¨å·®ï¼›socket æ•°æ®å¯è‡ªå®šä¹‰ï¼Œæ•°æ®é‡å°ï¼Œå®‰å…¨æ€§é«˜ï¼Œé€‚åˆä¿¡æ¯å®æ—¶äº¤äº’ï¼ˆæ¨é€ã€èŠå¤©ç­‰ï¼‰ staitc å’Œ const çš„åŒºåˆ«ï¼Ÿ é‡ç‚¹ constï¼šè¡¨ç¤º åªè¯» çš„æ„æ€ const æ”¾åœ¨ ç±»å‹ å‰ï¼šå¯ä»¥æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘ï¼Œå¯ä»¥æ”¹å˜æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ const æ”¾åœ¨ å˜é‡ å‰ï¼šä¸å¯ä»¥æ”¹å˜æŒ‡é’ˆçš„æŒ‡å‘ï¼Œä¸å¯ä»¥æ”¹å˜æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ staticï¼š é™æ€å˜é‡ï¼Œå¯ä¿®é¥° å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ï¼Œå¯ä¿®é¥°æ–¹æ³• static å¯ä¿®é¥° å±€éƒ¨/å…¨å±€å˜é‡ï¼Œç§°ä¸º å±€éƒ¨é™æ€å˜é‡å’Œå…¨å±€é™æ€å˜é‡ï¼Œåªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œåªåˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œç”Ÿå‘½å‘¨æœŸè¢«æ”¹å˜ï¼Œä¸å†æ˜¯ä½œç”¨åŸŸå†… static ä¿®é¥°çš„ æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸åŒæ–‡ä»¶ä¸‹é‡åï¼Œäº’ä¸å½±å“è¿è¡Œ é€šç”¨é“¾æ¥ï¼ˆUniversal Linksï¼‰é‡ç‚¹ æœåŠ¡ç«¯é…ç½® HTTPS è¯ä¹¦ å’Œæ·»åŠ  apple-app-site-association åœ°å€å…³è”æ–‡ä»¶ ç§»åŠ¨ç«¯åœ¨plistæ·»åŠ  Associated Domains å…³è”åŸŸæƒé™ ç®€è¿°GETå’ŒPOSTè¯·æ±‚çš„åŒºåˆ«ï¼Ÿ é‡ç‚¹ GET ä¼ è¾“æ•°æ® æœ‰ç¼“å­˜ï¼›POST ä¼ è¾“æ•°æ® æ²¡æœ‰ç¼“å­˜ GETçš„ å‚æ•° æ”¾åœ¨ URL çš„åé¢ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°ç”¨ ? å·æ‹¼æ¥ï¼Œåé¢çš„ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹ï¼Œç›´åˆ°æœ€åä¸€ä¸ªï¼Œç”¨ &amp; åˆ†å‰²ï¼›POSTçš„ å‚æ•° æ”¾åœ¨ è¯·æ±‚ä½“ é‡Œé¢ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°ç”¨ , å·æ‹¼æ¥ï¼Œåé¢ä»ç¬¬äºŒå¼€å§‹ï¼Œç›´åˆ°æœ€åç”¨ &amp; åˆ†å‰²; GETä¸€èˆ¬ç”¨äº è·å–æ•°æ®ï¼›POSTä¸€èˆ¬ç”¨äº å‘æœåŠ¡å™¨æäº¤æ•°æ® GET çš„å‚æ•°æ˜¯æš´æ¼åœ¨ åœ°å€æ  çš„ï¼Œä¸å®‰å…¨ï¼›POST çš„å‚æ•°éšè—åœ¨ è¯·æ±‚ä½“ é‡Œé¢ï¼Œç›¸å¯¹å®‰å…¨ä¸€ç‚¹; iOSä¸­å‡ ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ é‡ç‚¹ ä»£ç†æ¨¡å¼ ä¸€å¯¹ä¸€çš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªç±»çš„æŸäº›åŠŸèƒ½éœ€è¦ç”±åˆ«çš„ç±»æ¥å®ç°ï¼Œä½†æ˜¯åˆä¸ç¡®å®šå…·ä½“ä¼šæ˜¯å“ªä¸ªç±»å®ç°ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ KVOæœºåˆ¶ å’Œ Notificationé€šçŸ¥æœºåˆ¶ å•ä¾‹æ¨¡å¼ ä¿è¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªç±»åªè¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œä¾›å¤–ç•Œè®¿é—® å·¥å‚æ¨¡å¼ é€šè¿‡ä¸€ä¸ªç±»æ–¹æ³•ï¼Œæ ¹æ®å·²æœ‰æ¨¡æ¿æ‰¹é‡ç”Ÿäº§å¯¹è±¡ã€‚ MVCæ¨¡å¼ Modelå³æ•°æ®æ¨¡å‹ viewå³è§†å›¾ controllerå³æ§åˆ¶å™¨ RunLoopæ˜¯ä»€ä¹ˆï¼Ÿ é‡ç‚¹ æ¦‚å¿µ RunLoop åˆå« è¿è¡Œå¾ªç¯ï¼Œå†…éƒ¨å°±æ˜¯ä¸€ä¸ª do-whileå¾ªç¯ï¼Œåœ¨è¿™ä¸ªå¾ªç¯å†…éƒ¨ä¸æ–­ å¤„ç†å„ç§ä»»åŠ¡ï¼Œä¿è¯ç¨‹åºæŒç»­è¿è¡Œã€‚ ç›®çš„ RunLoopå­˜åœ¨çš„ç›®çš„ï¼š å°±æ˜¯å½“çº¿ç¨‹ä¸­æœ‰ä»»åŠ¡çš„æ—¶å€™ï¼Œä¿è¯çº¿ç¨‹å¹²æ´»ï¼Œå½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡çš„æ—¶å€™ï¼Œè®©çº¿ç¨‹ç¡çœ ï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼ŒèŠ‚çœCPUèµ„æºï¼Œè¯¥åšäº‹çš„æ—¶å€™åšäº‹ï¼Œè¯¥ä¼‘æ¯çš„æ—¶å€™ä¼‘æ¯ RunLoopçš„ä½œç”¨ï¼Ÿ é‡ç‚¹ ä¿æŒç¨‹åºæŒç»­è¿è¡Œã€‚ Appä¸€å¯åŠ¨å°±ä¼šå¼€å¯ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹åœ¨å¼€å¯çš„æ—¶å€™å°±ä¼šå¼€å¯ä¸»çº¿ç¨‹å¯¹åº”çš„RunLoopï¼ŒRunLoopèƒ½ä¿è¯çº¿ç¨‹ä¸è¢«é”€æ¯ï¼Œä¸»çº¿ç¨‹ä¸é”€æ¯ï¼Œç¨‹åºå°±ä¼šæŒç»­è¿è¡Œã€‚ å¤„ç†Appä¸­å„ç±»äº‹ä»¶ã€‚ äº‹ä»¶å“åº”ã€æ‰‹åŠ¿è¯†åˆ«ã€ç•Œé¢åˆ·æ–°ã€AutoreleasePoolè‡ªåŠ¨é‡Šæ”¾æ± ã€NSTimerç­‰äº‹ä»¶å¤„ç†ã€‚ èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚ å¦‚æ¦‚è¿°æ‰€è¿°ï¼Œå½“çº¿ç¨‹ä¸­æœ‰ä»»åŠ¡çš„æ—¶å€™ï¼Œä¿è¯çº¿ç¨‹å¹²æ´»ï¼Œå½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡çš„æ—¶å€™ï¼Œè®©çº¿ç¨‹ç¡çœ ï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼ŒèŠ‚çœèµ„æºï¼Œè¯¥åšäº‹çš„æ—¶å€™åšäº‹ï¼Œè¯¥ä¼‘æ¯çš„æ—¶å€™ä¼‘æ¯ã€‚ å¯ä»¥ç”¨Runloopå®ç°ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ é‡ç‚¹ tableView æ»šåŠ¨æ—¶å›¾ç‰‡ä¸åŠ è½½ SDWebImage + Runloopï¼Œå›¾ç‰‡å»¶è¿ŸåŠ è½½ï¼Œæ»‘åŠ¨ä¸åŠ è½½å›¾ç‰‡ çº¿ç¨‹ä¿æ´» å¾€ runloop ä¸­æ·»åŠ  [[NSPort alloc] init] äº‹ä»¶ï¼Œ è§£å†³NSTimeråœ¨æ»‘åŠ¨æ—¶åœæ­¢å·¥ä½œçš„é—®é¢˜ default æ¨¡å¼æ”¹ä¸º common æ¨¡å¼ æ£€æµ‹å¡é¡¿ displaylink + runloop è¿›è¡Œå¡é¡¿æ£€æµ‹ï¼Œå°†æ•°å€¼å’Œé¡µé¢ç»‘å®šä¸Šä¼ åˆ°æœåŠ¡å™¨ RunLoopæ¥æ”¶å‡ ç§è¾“å…¥æºï¼Œç³»ç»Ÿé»˜è®¤å®šä¹‰äº†å‡ ç§æ¨¡å¼ï¼Ÿ é‡ç‚¹ è¾“å…¥æºæœ‰ä¸¤ç§åŸºäº ç«¯å£ çš„è¾“å…¥æºï¼ˆportï¼‰è‡ªå®šä¹‰ çš„è¾“å…¥æºï¼ˆcustomï¼‰ ç³»ç»Ÿå®šä¹‰çš„RunLoopæ¨¡å¼æœ‰äº”ç§ï¼Œæœ€å¸¸ç”¨çš„æœ‰ä¸‰ç§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šNSDefaultRunLoopModeé»˜è®¤æ¨¡å¼ï¼Œä¸»çº¿ç¨‹ä¸­é»˜è®¤æ˜¯NSDefaultRunLoopModeUITrackingRunLoopModeè§†å›¾æ»šåŠ¨æ¨¡å¼ï¼ŒRunLoopä¼šå¤„äºè¯¥æ¨¡å¼ä¸‹NSRunLoopCommonModeså¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„Modeï¼Œæ˜¯ä¸€ä¸ªå ä½ç”¨çš„â€œModeâ€ï¼Œé»˜è®¤åŒ…å«äº†NSDefaultRunLoopModeå’ŒUITrackingRunLoopModeä¸¤ç§æ¨¡å¼ RunLoopå’Œçº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»ï¼ŸRunloopçš„mode? Runloopçš„ä½œç”¨ï¼Ÿ é‡ç‚¹ æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªrunloopï¼Œä¸»çº¿ç¨‹çš„runloopé»˜è®¤å¯åŠ¨ã€‚å­çº¿ç¨‹çš„runloopé»˜è®¤ä¸å¯åŠ¨ modeï¼šä¸»è¦ç”¨æ¥æŒ‡å®šäº‹ä»¶åœ¨è¿è¡Œæ—¶å¾ªç¯çš„ä¼˜å…ˆçº§ ä½œç”¨ï¼šä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œã€éšæ—¶å¤„ç†å„ç§äº‹ä»¶ã€èŠ‚çœcpuèµ„æº(æ²¡äº‹ä»¶ä¼‘æ¯é‡Šæ”¾èµ„æº)ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚ æ€ä¹ˆç†è§£Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€ã€‚ é‡ç‚¹ä¸»è¦æ˜¯ å°†æ•°æ®ç±»å‹çš„ç¡®å®šå’Œå‡½æ•°çš„è°ƒç”¨ç”±ç¼–è¯‘æ—¶æ¨è¿Ÿåˆ°äº†è¿è¡Œæ—¶ã€‚è¿™ä¸ªé—®é¢˜å…¶å®æµ…æ¶‰åŠåˆ°ä¸¤ä¸ªæ¦‚å¿µï¼Œè¿è¡Œæ—¶å’Œå¤šæ€ã€‚ è¿è¡Œæ—¶ï¼šç®€å•æ¥è¯´ï¼Œè¿è¡Œæ—¶æœºåˆ¶ä½¿æˆ‘ä»¬ ç›´åˆ°è¿è¡Œæ—¶æ‰å»ç¡®å®šæ•°æ®ç±»å‹å’Œè¦è°ƒç”¨çš„å‡½æ•°ã€‚ å¤šæ€ï¼šä¸åŒå¯¹è±¡ä»¥è‡ªå·±çš„æ–¹å¼å“åº”ç›¸åŒçš„æ¶ˆæ¯çš„èƒ½åŠ› å«åšå¤šæ€ã€‚ runtimeé¡¹ç›®ä¸­å…·ä½“åº”ç”¨ï¼Ÿ é‡ç‚¹ æ–¹æ³•äº¤æ¢ã€‚ ç»™ åˆ†ç±»æ·»åŠ å±æ€§ã€‚ åŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚ å­—å…¸è½¬æ¨¡å‹ã€‚ æ•°ç»„è¶Šç•Œã€‚ åŠ¨æ€è·å–æˆå‘˜å±æ€§ã€æˆå‘˜å˜é‡ã€å®ä¾‹æ–¹æ³• KVCæ˜¯ä»€ä¹ˆï¼Ÿé‡ç‚¹KVC å…¨ç¨‹ Key Value Codingï¼Œä¸­æ–‡ é”®å€¼ç¼–ç ï¼Œæ˜¯ç”± NSKeyValueCoding éæ­£å¼åè®®å¯åŠ¨çš„ä¸€ç§æœºåˆ¶ï¼Œå¯¹è±¡ é‡‡ç”¨è¯¥åè®®æ¥ é—´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚ 12345- (nullable id)valueForKey:(NSString *)key; - (nullable id)valueForKeyPath:(NSString *)keyPath; - (void)setValue:(nullable id)value forKey:(NSString *)key;- (void)setValue:(nullable id)value forKeyPath:(NSString *)keyPath; KVCåº•å±‚åŸç†ï¼š KVOæ˜¯ä»€ä¹ˆï¼Ÿé‡ç‚¹KVO å…¨ç¨‹ Key Value Observingï¼Œä¸­æ–‡ é”®å€¼è§‚å¯Ÿï¼Œå®ƒ ç”¨äºç›‘å¬å®ä¾‹å¯¹è±¡å±æ€§çš„å˜åŒ–ã€‚ KVOçš„å®ç°åŸç†ï¼Ÿ(KVOçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ) é‡ç‚¹å½“ä¸€ä¸ª å®ä¾‹å¯¹è±¡ çš„ å±æ€§æ³¨å†Œäº†KVOï¼Œå®ä¾‹å¯¹è±¡ isaæŒ‡é’ˆ çš„æŒ‡å‘åœ¨æ³¨å†ŒKVOè§‚å¯Ÿè€…ä¹‹åï¼Œç”± åŸæœ‰ç±» æ”¹ä¸º ä¸­é—´ç±»(NSKVONotifing_ç±»å)ï¼›ä¸­é—´ç±» é‡å†™äº† å±æ€§setteræ–¹æ³•ã€classã€deallocã€_isKVOA æ–¹æ³•ï¼›dealloc æ–¹æ³•ä¸­ï¼Œç§»é™¤ KVO è§‚å¯Ÿè€…ä¹‹åï¼Œå®ä¾‹å¯¹è±¡isa æŒ‡å‘ç”± ä¸­é—´ç±» æ›´æ”¹ä¸º åŸæœ‰ç±»;ä¸­é—´ç±» ä»åˆ›å»ºåå°± ä¸€ç›´å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šè¢«é”€æ¯ã€‚ KVOå®é™…åº”ç”¨ é‡ç‚¹ è§‚å¯Ÿ å®ä¾‹å¯¹è±¡ çš„ å±æ€§ å˜åŒ– è§‚å¯Ÿ å®ä¾‹å¯¹è±¡ çš„ å®¹å™¨ å˜åŒ– è§‚å¯Ÿå®¹å™¨ç”¨ï¼š mutableArrayValueForKey KVOåº•å±‚åŸç†ï¼š categoryå’Œextensionçš„ä½œç”¨ï¼Ÿåˆ†ä¸¤ç±»å’Œæ‰©å±•çš„åŒºåˆ«ï¼Ÿåˆ†ç±»çš„ç»“æ„ä½“é‡Œé¢æœ‰ä»€ä¹ˆï¼Ÿé‡ç‚¹ category åŸåˆ™ä¸Šå®ƒ åªèƒ½å¢åŠ æ–¹æ³•ï¼Œä¸èƒ½å¢åŠ æˆå‘˜ï¼ˆå®ä¾‹ï¼‰å˜é‡ã€‚å¯ä»¥æ·»åŠ å±æ€§ï¼Œä½†æ˜¯ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå®ä¾‹å˜é‡_nameå’Œsetterå’Œgetteræ–¹æ³•ã€‚å¯ä»¥æ·»åŠ æ–¹æ³• æ‰©å±• ä¸»è¦ç”¨æ¥ä¸ºä¸€ä¸ªç±»æ·»åŠ é¢å¤–çš„åŸæ¥æ²¡æœ‰çš„ å®ä¾‹å˜é‡ã€æ–¹æ³•å’Œå±æ€§ã€‚extensionå¸¸ç”¨çš„å½¢å¼å¹¶ä¸æ˜¯ä»¥ä¸€ä¸ªå•ç‹¬çš„.hæ–‡ä»¶å­˜åœ¨ï¼Œè€Œæ˜¯å¯„ç”Ÿåœ¨ç±»çš„.mæ–‡ä»¶ä¸­ã€‚ ç±»æ‰©å±•ä¸­ï¼š 123456@interface Person ()&#123; int age; //å®ä¾‹å˜é‡&#125;@property (nonatomic,copy)NSString * name;//å±æ€§- (void)run;//æ–¹æ³•@end iOSå¼€å‘ä¸­æœ‰å¤šå°‘ç±»å‹çš„çº¿ç¨‹ï¼Ÿ é‡ç‚¹ pthread ä¸€å¥—ç”¨äº C çš„å¤šçº¿ç¨‹ APIã€é€‚ç”¨äº Unix / Linux / Windows ç­‰ç³»ç»Ÿã€è·¨å¹³å°ã€å¯ç§»æ¤ã€ä½¿ç”¨éš¾åº¦å¤§ NSThread ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡ã€ç®€å•æ˜“ç”¨ï¼Œå¯ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡ GCD æ—¨åœ¨æ›¿ä»£NSThreadç­‰çº¿ç¨‹æŠ€æœ¯ã€å……åˆ†åˆ©ç”¨è®¾å¤‡çš„ å¤šæ ¸ã€åŸºäº C çš„åº•å±‚çš„ API NSOperation NSOperation æ˜¯åŸºäº GCD ä¹‹ä¸Šçš„æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œ NSOpetation éœ€è¦é…åˆ NSOpetationQueue æ¥å®ç°å¤šçº¿ç¨‹ æ ¹æ®è‹¥â¼²ä¸ªurlå¼‚æ­¥åŠ è½½å¤šå¼ å›¾â½šï¼Œç„¶ååœ¨éƒ½ä¸‹è½½å®Œæˆååˆæˆâ¼€å¼ æ•´å›¾ï¼ŸGCDå¦‚ä½•å®ç°ï¼Ÿ é‡ç‚¹dispatch_group_t + dispatch_group_enter + dispatch_group_leave + dispatch_group_notify 10ä¸ªç½‘ç»œè¯·æ±‚é¡ºåºå›è°ƒ? GCDå¦‚ä½•å®ç°ï¼Ÿé‡ç‚¹dispatch_group_t + dispatch_semaphore_tï¼šä¿¡å·é‡ï¼ˆdispatch_semaphore_wait + dispatch_group_leaveï¼‰ GCDå’ŒNSOperationçš„åŒºåˆ«ï¼Ÿ é‡ç‚¹ GCDæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œè€Œä¸”ç”±äºé˜Ÿåˆ—ä¸­æ‰§è¡Œçš„æ˜¯ç”±blockæ„æˆçš„ä»»åŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®ç»“æ„ï¼Œå†™èµ·æ¥æ›´æ–¹ä¾¿ GCDåªæ”¯æŒFIFOçš„é˜Ÿåˆ—ï¼Œè€Œ NSOperationQueueå¯ä»¥é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ•°ï¼Œè®¾ç½®ä¼˜å…ˆçº§ï¼Œæ·»åŠ ä¾èµ–å…³ç³»ç­‰è°ƒæ•´æ‰§è¡Œé¡ºåº NSOperationQueueç”šè‡³å¯ä»¥è·¨é˜Ÿåˆ—è®¾ç½®ä¾èµ–å…³ç³»ï¼Œä½†æ˜¯GCDåªèƒ½é€šè¿‡è®¾ç½®ä¸²è¡Œé˜Ÿåˆ—ï¼Œæˆ–è€…åœ¨é˜Ÿåˆ—å†…æ·»åŠ barrier(dispatch_barrier_async)ä»»åŠ¡ï¼Œæ‰èƒ½æ§åˆ¶æ‰§è¡Œé¡ºåº,è¾ƒä¸ºå¤æ‚ NSOperationQueueå› ä¸ºé¢å‘å¯¹è±¡ï¼Œæ‰€ä»¥ æ”¯æŒKVOï¼Œå¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ã€æ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰ å…·ä½“çš„åº•å±‚çœ‹ OCåº•å±‚åŸç†27ï¼šGCDä¹‹ NSThread &amp; GCD &amp; NSOperation ä»€ä¹ˆæ˜¯Blockï¼Ÿ é‡ç‚¹Block æ˜¯å°† å‡½æ•°åŠå…¶ä¸Šä¸‹æ–‡å°è£…èµ·æ¥çš„å¯¹è±¡ Blockçš„æœ¬è´¨ é‡ç‚¹ block çš„ æœ¬è´¨ æ˜¯ å¯¹è±¡ã€å‡½æ•°ã€ç»“æ„ä½“ï¼Œç”±äºblockå‡½æ•°æ²¡æœ‰åç§°ï¼Œä¹Ÿè¢«ç§°ä¸º åŒ¿åå‡½æ•° Blockçš„åˆ†ç±»ï¼Ÿ é‡ç‚¹ åˆ†ä¸º å…¨å±€Block(_NSConcreteGlobalBlock)ã€æ ˆBlock(_NSConcreteStackBlock)ã€å †Block(_NSConcreteMallocBlock) ä¸‰ç§å½¢å¼ã€‚ å…¶ä¸­ æ ˆBlockå­˜å‚¨åœ¨æ ˆ(stack)åŒºï¼Œå †Blockå­˜å‚¨åœ¨å †(heap)åŒºï¼Œå…¨å±€Blockå­˜å‚¨åœ¨å·²åˆå§‹åŒ–æ•°æ®(.data)åŒºã€‚ å †ï¼šåŠ¨æ€åˆ†é…å†…å­˜ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±ç”³è¯·ï¼Œç¨‹åºå‘˜è‡ªå·±ç®¡ç† æ ˆï¼šè‡ªåŠ¨åˆ†é…å†…å­˜ï¼Œè‡ªåŠ¨é”€æ¯ï¼Œå…ˆå…¥åå‡ºï¼Œæ ˆä¸Šçš„å†…å®¹å­˜åœ¨è‡ªåŠ¨é”€æ¯çš„æƒ…å†µ å…·ä½“çœ‹åº•å±‚åŸç† OCåº•å±‚åŸç†30ï¼šBlockåº•å±‚åŸç† å¾ªç¯å¼•ç”¨çš„å‡ ç§æƒ…å†µå’Œè§£å†³æ–¹å¼ï¼Ÿ é‡ç‚¹ Block åŸå› ï¼š self å¼ºå¼•ç”¨äº† blockï¼Œè€Œ block å†…éƒ¨åˆè°ƒç”¨äº† selfè§£å†³ï¼š ä½¿ç”¨ Weak-Strong Dance Delegate åŸå› ï¼šå§”æ‰˜è€…å’Œè¢«å§”æ‰˜äººä¹‹é—´çš„ç›¸äº’å¼ºå¼•ç”¨é—®é¢˜ strongè§£å†³ï¼šç”¨ weak è¿›è¡Œå¼±å¼•ç”¨ æˆ–è€… é€šè¿‡ä¸­é—´å¯¹è±¡(ä»£ç†å¯¹è±¡)çš„æ–¹å¼æ¥è§£å†³(æ•ˆç‡æ›´åŠ é«˜çš„ä¸­é—´å¯¹è±¡NSProxyï¼šä¸éœ€è¦è¿›è¡Œå‘é€æ¶ˆæ¯å’ŒåŠ¨æ€è§£æï¼Œç›´æ¥è¿›è¡Œæ¶ˆæ¯è½¬å‘) NSTimer åŸå› ï¼šself â†’ timer â†’ self(target) çš„å¾ªç¯æŒæœ‰é“¾è§£å†³ï¼šåœ¨é€‚å½“çš„æ—¶æœºé”€æ¯ 12[_timer invalidate];_timer = nil; OC å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Ÿ é‡ç‚¹ æ‰‹åŠ¨å†…å­˜ç®¡ç† MRC è‡ªåŠ¨å†…å­˜ç®¡ç† ARC LLVM + Runtime ä¼šä¸ºæˆ‘ä»¬ä»£ç è‡ªåŠ¨æ’å…¥ retain å’Œ release ä»¥åŠ autoreleaseç­‰ä»£ç ,ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç®¡ç† è‡ªåŠ¨é‡Šæ”¾æ±  è‡ªåŠ¨é‡Šæ”¾æ± åŸç† é‡ç‚¹ è‡ªåŠ¨é‡Šæ”¾æ± çš„æœ¬è´¨æ˜¯ __AtAutoreleasePool ç»“æ„ä½“ï¼ŒåŒ…å«æ„é€ å‡½æ•°å’Œææ„å‡½æ•° ç»“æ„ä½“å£°æ˜ï¼Œè§¦å‘æ„é€ å‡½æ•°ï¼Œè°ƒç”¨ objc_autoreleasePoolPush() å‡½æ•°ï¼Œå¯¹è±¡å‹æ ˆ ç»“æ„ä½“å‡ºä½œç”¨åŸŸï¼Œè§¦å‘ææ„å‡½æ•°ï¼Œè°ƒç”¨ objc_autoreleasePoolPop() å‡½æ•°ï¼Œå¯¹è±¡å‡ºæ ˆ å†…å­˜ä¼˜åŒ– é‡ç‚¹ cellå¤ç”¨ ç»˜åˆ¶çš„è¯ï¼šç”¨CAShaperLayerï¼Œæ¸²æŸ“å¿«ï¼Œå†…å­˜ä½¿ç”¨é«˜æ•ˆ æŒ‰éœ€åŠ è½½ï¼šæ‡’åŠ è½½ åˆç†åˆ©ç”¨ç¼“å­˜ï¼šæ¯”å¦‚ä¸‰æ–¹å›¾ç‰‡å‹ç¼©ç¼“å­˜ å°½é‡ä½¿ç”¨é€æ˜Viewï¼šæ§ä»¶æœ‰èƒŒæ™¯è‰²å¢å¤§å†…å­˜æ¶ˆè€— å¯åŠ¨ä¼˜åŒ– é‡ç‚¹ pre-main é˜¶æ®µï¼šäºŒè¿›åˆ¶é‡æ’ å°½é‡ å°‘ç”¨å¤–éƒ¨åŠ¨æ€åº“ï¼Œè‹¹æœå®˜æ–¹å»ºè®®è‡ªå®šä¹‰çš„åŠ¨æ€åº“æœ€å¥½ ä¸è¦è¶…è¿‡6ä¸ªï¼Œå¦‚æœè¶…è¿‡6ä¸ªï¼Œéœ€è¦ åˆå¹¶ åŠ¨æ€åº“ å‡å°‘ OC ç±»ï¼Œå› ä¸ºç±»è¶Šå¤šï¼Œè¶Šè€—æ—¶ å°†ä¸å¿…é¡»åœ¨ +load æ–¹æ³•ä¸­åšçš„äº‹æƒ…å»¶è¿Ÿåˆ° +initialize ä¸­ï¼Œå°½é‡ä¸è¦ç”¨ C++ è™šå‡½æ•° main é˜¶æ®µï¼šmian -&gt; didFinishLaunching å‡å°‘å¯åŠ¨åˆå§‹åŒ–çš„æµç¨‹ï¼Œèƒ½æ‡’åŠ è½½çš„æ‡’åŠ è½½ï¼Œèƒ½å»¶è¿Ÿçš„å»¶è¿Ÿï¼Œèƒ½æ”¾åå°åˆå§‹åŒ–çš„æ”¾åå°ï¼Œå°½é‡å°‘å ç”¨ä¸»çº¿ç¨‹çš„å¯åŠ¨æ—¶é—´ ä¼˜åŒ–ä»£ç é€»è¾‘ï¼Œå»é™¤éå¿…é¡»çš„ä»£ç é€»è¾‘ï¼Œå‡å°‘æ¯ä¸ªæµç¨‹çš„æ¶ˆè€—æ—¶é—´ å¯åŠ¨é˜¶æ®µèƒ½ ä½¿ç”¨å¤šçº¿ç¨‹ æ¥åˆå§‹åŒ–çš„ï¼Œå°±ä½¿ç”¨å¤šçº¿ç¨‹ å°½é‡ ä½¿ç”¨çº¯ä»£ç  æ¥è¿›è¡ŒUIæ¡†æ¶çš„æ­å»ºï¼Œå°¤å…¶æ˜¯ä¸»UIæ¡†æ¶ï¼Œä¾‹å¦‚ UITabBarControllerï¼Œå°½é‡é¿å…ä½¿ç”¨Xibæˆ–è€…SBï¼Œç›¸æ¯”çº¯ä»£ç è€Œè¨€ï¼Œè¿™ç§æ›´è€—æ—¶ åˆ é™¤åºŸå¼ƒç±»ã€æ–¹æ³• å¡é¡¿ç›‘å¬ é‡ç‚¹ä¸»è¦æ˜¯ç”¨ displayLink + Runloop è¿›è¡ŒFPSç›‘æµ‹ ä¸»è¦ä»å‡è½» CPU å’Œ GPU æ¶ˆè€—å…¥æ‰‹ï¼Œä¿è¯å†™ä¸€ä¸ª VSync åˆ°æ¥æ—¶ï¼ŒCPU å’Œ GPU èƒ½å¤Ÿå†™ä½œå®Œæˆä¸‹ä¸€å¸§çš„æ¸²æŸ“å¹¶ç¼“å­˜åˆ°å¸§ç¼“å†²åŒº å¡é¡¿ä¼˜åŒ–åœ¨ CPU å±‚é¢ï¼š 1ï¼‰å°½é‡ç”¨è½»é‡çº§çš„å¯¹è±¡ï¼Œæ¯”å¦‚ ç”¨ä¸åˆ°äº‹ä»¶å¤„ç† çš„åœ°æ–¹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ CALayer å–ä»£ UIView2ï¼‰ä¸è¦é¢‘ç¹åœ°è°ƒç”¨ UIView çš„ç›¸å…³å±æ€§ï¼Œæ¯”å¦‚ frameã€boundsã€transform ç­‰å±æ€§ï¼Œå°½é‡å‡å°‘ä¸å¿…è¦çš„ä¿®æ”¹3ï¼‰å°½é‡ æå‰è®¡ç®—å¥½å¸ƒå±€ï¼Œåœ¨æœ‰éœ€è¦æ—¶ä¸€æ¬¡æ€§è°ƒæ•´å¯¹åº”çš„å±æ€§ï¼Œä¸è¦å¤šæ¬¡ä¿®æ”¹å±æ€§4ï¼‰å›¾ç‰‡çš„ size æœ€å¥½åˆšå¥½è·Ÿ UIImageView çš„ size ä¿æŒä¸€è‡´5ï¼‰æ§åˆ¶ä¸€ä¸‹çº¿ç¨‹çš„æœ€å¤§å¹¶å‘æ•°é‡6ï¼‰å°½é‡æŠŠ è€—æ—¶çš„æ“ä½œæ”¾åˆ°å­çº¿ç¨‹ï¼šå¦‚textå®½é«˜è·å–ç­‰ å¡é¡¿ä¼˜åŒ–åœ¨ GPUå±‚é¢ï¼š 1ï¼‰GPUèƒ½å¤„ç†çš„ æœ€å¤§çº¹ç† å°ºå¯¸æ˜¯ 4096x4096ï¼Œä¸€æ—¦è¶…è¿‡è¿™ä¸ªå°ºå¯¸ï¼Œå°±ä¼šå ç”¨ CPU èµ„æºè¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥çº¹ç†å°½é‡ä¸è¦è¶…è¿‡è¿™ä¸ªå°ºå¯¸2ï¼‰å°½é‡ å‡å°‘è§†å›¾æ•°é‡å’Œå±‚æ¬¡3ï¼‰å‡å°‘é€æ˜çš„è§†å›¾ï¼ˆalpha&lt;1ï¼‰ï¼Œä¸é€æ˜çš„å°±è®¾ç½® opaque ä¸º YES4ï¼‰å°½é‡ é¿å…å‡ºç°ç¦»å±æ¸²æŸ“ï¼šåœ†è§’ã€é˜´å½±ã€é®ç½©ç­‰ tableViewå¡é¡¿ä¼˜åŒ– é‡ç‚¹ æœ€å¸¸ç”¨çš„å°±æ˜¯cellçš„å¤ç”¨ï¼Œ æ³¨å†Œå¤ç”¨æ ‡è¯†ç¬¦ é¿å…cellçš„é‡æ–°å¸ƒå±€ï¼Œåˆå§‹åŒ–æ—¶å°±å¸ƒå±€å¥½ æå‰è®¡ç®—å¹¶ç¼“å­˜cellçš„é«˜åº¦ å‡å°‘cellä¸­æ§ä»¶çš„æ•°é‡ï¼Œå°‘åŠ¨æ€æ·»åŠ  view é¿å…èƒŒæ™¯é€æ˜ èƒ½ä½¿ç”¨å±€éƒ¨æ›´æ–° çš„å°±ä½¿ç”¨ å±€éƒ¨æ›´æ–° åŠ è½½ç½‘ç»œæ•°æ®ï¼Œä¸‹è½½å›¾ç‰‡ï¼Œä½¿ç”¨å¼‚æ­¥åŠ è½½ï¼Œå¹¶ç¼“å­˜ æŒ‰éœ€åŠ è½½cellï¼šcellæ»šåŠ¨å¾ˆå¿«æ—¶ï¼ŒåªåŠ è½½èŒƒå›´å†…çš„cell ä¸è¦å®ç°æ— ç”¨çš„ä»£ç†æ–¹æ³•ï¼ŒtableViewåªéµå®ˆä¸¤ä¸ªåè®® ç½‘ç»œä¼˜åŒ– é‡ç‚¹ DNSä¼˜åŒ–ï¼šå³åŸŸåè§£æä¼˜åŒ–ï¼Œç¼“å­˜ ip èµ„æºä¼˜åŒ–ï¼š å›¾ç‰‡webpï¼Œæ¯”png&#x2F;jpgå° æ•°æ®ä¼ è¾“ç”¨ProtocolBufferä»£æ›¿jsonï¼Œæ•°æ®å°ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¹Ÿç®€å• è¯·æ±‚å‹ç¼©ã€è¯·æ±‚åˆå¹¶ æ•°æ®ç¼“å­˜ ç½‘ç»œç¯å¢ƒç›‘æµ‹ é’ˆå¯¹æ€§è¯·æ±‚é‡è¯• TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ï¼Ÿé‡ç‚¹ ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯äºŒæ¬¡æ¡æ‰‹ï¼Ÿ ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†å»ºç«‹ä¸€ä¸ªå¯é çš„æ•°æ®ä¼ è¾“é€šé“ï¼š åˆšå¼€å§‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¤„äºå…³é—­çŠ¶æ€ï¼Œè€Œä¸”æœåŠ¡ç«¯Bä¸€ç›´å¤„äºç›‘å¬çŠ¶æ€ï¼Œæ—¶åˆ»ç›‘å¬æ˜¯å¦æœ‰å»ºç«‹è¿æ¥çš„è¯·æ±‚ å½“å®¢æˆ·ç«¯éœ€è¦å»ºç«‹è¿æ¥çš„æ—¶å€™å°±ä¼šå‘é€ä¸€ä¸ª è¯·æ±‚è¿æ¥ çš„æŠ¥æ–‡ï¼Œæ­¤æŠ¥æ–‡æ˜¯ åŒæ­¥æŠ¥æ–‡SYN=1ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ª éšæœºçš„åºå·seq=xï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡æ¡æ‰‹ å½“æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚è¿æ¥æŠ¥æ–‡æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ª ç¡®è®¤è¿æ¥ çš„æŠ¥æ–‡ï¼Œæ­¤æŠ¥æ–‡æ˜¯ åŒæ­¥æŠ¥æ–‡SYN=1ï¼Œå¹¶ä¸” ç¡®è®¤æŠ¥æ–‡ACK=1ï¼ŒåŒæ—¶æœåŠ¡ç«¯ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ª éšæœºçš„åºå·seq=yï¼Œå¹¶ä¸”å°† ç¡®è®¤æŠ¥æ–‡ç¡®è®¤å·ack=x+1ï¼Œå›ä¼ ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹ å½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„ ACKç¡®è®¤æŠ¥æ–‡åï¼Œä¼šå›å¤ä¸€ä¸ª ACKç¡®è®¤æŠ¥æ–‡ï¼Œç”¨äºç¡®è®¤ç¡®è®¤æŠ¥æ–‡å·²ç»æ”¶åˆ°ï¼Œæ­¤æŠ¥æ–‡ ACK=1ï¼Œseq=x+1ï¼Œack=y+1ï¼Œè¿™æ˜¯ç¬¬ä¸‰æ¬¡æ¡æ‰‹ å››æ¬¡æŒ¥æ‰‹ å››æ¬¡æŒ¥æ‰‹åˆ™æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¼ è¾“å®Œæˆæ¥æ”¶å†å…³é—­è¿æ¥ã€‚ å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ä¼šå‘é€ä¸€ä¸ª è¯·æ±‚æ–­å¼€è¿æ¥ çš„æŠ¥æ–‡ï¼Œæ­¤æŠ¥æ–‡æ˜¯ FIN=1ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ª éšæœºçš„åºå·seq=uï¼Œå‘é€ç»™æœåŠ¡ç«¯ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚æ–­å¼€è¿æ¥ FINæŠ¥æ–‡ åï¼Œå›å¤ä¸€ä¸ª ç¡®è®¤æ–­å¼€è¿æ¥ æŠ¥æ–‡ ACK=1,seq=v,ack=u+1ï¼Œè¿™æ˜¯ç¬¬äºŒæ¬¡æŒ¥æ‰‹ å½“æœåŠ¡ç«¯æ•°æ®å‘é€å®Œåï¼Œå†å‘é€ä¸€ä¸ªFINæŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯å‡†å¤‡å…³é—­è¿æ¥ï¼Œæ­¤æŠ¥æ–‡ FIN=1,ACK=1,ack=u+1,seq=wï¼Œè¿™æ˜¯ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ å½“å®¢æˆ·ç«¯æ”¶åˆ° FINç¡®è®¤æŠ¥æ–‡ï¼Œå†å‘é€ä¸€ä¸ªFINç¡®è®¤æŠ¥æ–‡ ACK=1,seq=u+1,ack=w+1ï¼Œå¹¶è¿›å…¥ TIME-WAIT ç­‰å¾…ï¼Œç­‰å¾… 2MSL åå…³é—­è¿æ¥ï¼Œè¿™æ˜¯ç¬¬å››æ¬¡æŒ¥æ‰‹ äº‹ä»¶é“¾ é‡ç‚¹OCå­¦ä¹ 01ï¼šäº‹ä»¶ä¼ é€’é“¾å’Œå“åº”é“¾ ä¼ é€’é“¾ï¼šç”±ç³»ç»Ÿå‘ç¦»ç”¨æˆ·æœ€è¿‘çš„viewä¼ é€’ã€‚é¡ºåºï¼šAppdelegate -&gt; UIApplication -&gt; UIWindow -&gt; ViewController -&gt; subViews å“åº”é“¾ï¼šç”±ç¦»ç”¨æˆ·æœ€è¿‘çš„viewå‘ç³»ç»Ÿä¼ é€’ã€‚é¡ºåºï¼š superViews â€“&gt; ViewController â€“&gt; UIWindow â€“&gt; UIApplication â€“&gt; AppDelegate äº‹ä»¶ä¼ é€’çš„ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Ÿ é‡ç‚¹1234// è¿”å›æœ€é€‚åˆå¤„ç†äº‹ä»¶çš„è§†å›¾- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event; // åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨è¿™ä¸ªViewå†…éƒ¨- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event; ç¬¬ä¸€ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª UIViewï¼Œæ˜¯ç”¨æ¥å¯»æ‰¾æœ€ç»ˆå“ªä¸€ä¸ªè§†å›¾æ¥å“åº”è¿™ä¸ªäº‹ä»¶ ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åˆ¤æ–­æŸä¸€ä¸ªç‚¹å‡»çš„ä½ç½®æ˜¯å¦åœ¨è§†å›¾èŒƒå›´å†…ï¼Œå¦‚æœåœ¨å°±è¿”å›YES å®ç°ä¸€ä¸ªæŒ‰é’®çš„ç‚¹å‡»èŒƒå›´æ‰©å¤§æ•ˆæœ é‡ç‚¹è‡ªå®šä¹‰ä¸€ä¸ªæŒ‰é’®ï¼Œç»§æ‰¿UIButtonï¼Œé‡å†™ pointInside:withEvent: æ–¹æ³•ï¼Œ 12345678- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event&#123; // å½“å‰btnå¤§å° CGRect btnBounds = self.bounds; // æ‰©å¤§æŒ‰é’®çš„ç‚¹å‡»èŒƒå›´ï¼Œå¢å¤§å†…è¾¹è· btnBounds = CGRectInset(btnBounds, -10, -10); // è‹¥ç‚¹å‡»çš„ç‚¹åœ¨æ–°çš„boundsé‡Œï¼Œè¿”å›YES return CGRectContainsPoint(btnBounds, point);&#125; å­è§†å›¾è¶…è¿‡çˆ¶è§†å›¾éƒ¨åˆ†ä»ç„¶èƒ½å“åº” é‡ç‚¹é‡å†™ hitTest:withEvent æ–¹æ³•ï¼Œè®© å­è§†å›¾ å»ç›¸åº”äº‹ä»¶ 123456789101112131415- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event&#123; // åˆ¤æ–­btnèƒ½å¦æ¥æ”¶äº‹ä»¶ if (self.btn.userInteractionEnabled == NO || self.btn.hidden == YES || self.btn.alpha &lt;= 0.01) &#123; return nil; &#125; // æŠŠå½“å‰ç‚¹è½¬æ¢æˆbtnåæ ‡ç³»ä¸Šçš„ç‚¹ CGPoint btnP = [self convertPoint:point toView:self.btn]; // å½“è§¦æ‘¸ç‚¹åœ¨btnä¸Šæ—¶ï¼Œæ‰è®©æŒ‰é’®ç›¸åº”äº‹ä»¶ if ([self.btn pointInside:btnP withEvent:event]) &#123; NSLog(@&quot;%@&quot;,NSStringFromCGPoint(btnP)); return self.btn; &#125; NSLog(@&quot;çˆ¶è§†å›¾ç›¸åº”&quot;); return [super hitTest:point withEvent:event];&#125; é¡¹ç›®é¢è¯•é¢˜ç›´æ’­åŠŸèƒ½æ€ä¹ˆå®ç°çš„ï¼Ÿç›´æ’­é—´æ˜¯é€šè¿‡é›†æˆé‡‘å±±äº‘SDKå®ç°çš„ï¼Œåˆ†ä¸ºä¸¤ç«¯ ä¸»æ’­ å’Œ è§‚ä¼— ä¸»æ’­ é€šè¿‡ æ¨æµ åˆ›å»ºç›´æ’­é—´ï¼Œé€šè¿‡ æ‘„åƒå¤´å’Œéº¦å…‹é£ è·å– éŸ³è§†é¢‘æµ ï¼Œè®¾ç½® æ¨æµå‚æ•°ï¼Œä¸»è¦æ˜¯ è§†é¢‘ç¼–ç å™¨å’ŒéŸ³é¢‘ç¼–ç ç‡çš„è®¾ç½®ï¼Œè®¾ç½®å®Œæ¨æµå‚æ•°ä¹‹åï¼Œå°†æµåª’ä½“æ¨é€æœåŠ¡å™¨ è§‚ä¼— è¿›å…¥ç›´æ’­é—´ï¼Œåˆå§‹åŒ–æ’­æ”¾å™¨ï¼Œä»æœåŠ¡å™¨è·å–æ’­æ”¾æ‹‰æµçš„æ•°æ® ç›´æ’­é—´çš„èŠå¤©IMå®ç°ï¼Ÿ èŠå¤©åŠŸèƒ½æ˜¯ä½¿ç”¨çš„èäº‘SDKï¼Œé€šè¿‡åŠ å…¥èŠå¤©å®¤å®ç°çš„ã€‚ èäº‘SDKå®ç°äº†ç§èŠçš„åŠŸèƒ½ è‡ªå·±å†™çš„èŠå¤©é¡µé¢ï¼Œé€šè¿‡ èäº‘æ¥å£ ä¼ å…¥å‚æ•° ä¼šè¯ç±»å‹ï¼šå•èŠã€ç¾¤ç»„ã€‚èŠå¤©å®¤ç­‰ï¼Œç›®æ ‡ä¼šè¯IDï¼‰ï¼Œæ¶ˆæ¯æ•°é‡ï¼Œè·å–æŸä¸ªä¼šè¯çš„å†…å®¹ã€‚å‘é€æ–‡æœ¬æ¶ˆæ¯ã€å›¾ç‰‡æ¶ˆæ¯ï¼Œç›‘å¬æ¶ˆæ¯ï¼Œåˆ·æ–°åˆ—è¡¨ é¢è¯•å®˜é—®è¿˜æœ‰ä»€ä¹ˆæƒ³é—®çš„ï¼Ÿ é‡ç‚¹æŠ€æœ¯é¢ä¸é—®è–ªèµ„å¾…é‡ï¼Œäººäº‹é¢é—®è–ªèµ„å¾…é‡ é—®å²—ä½ï¼š åœ¨è¿™ä¸ªå²—ä½ä¸Šï¼Œä¼šç›´æ¥ æ¥è§¦åˆ°å“ªäº›ç±»å‹çš„é¡¹ç›®ï¼Ÿ è¿™ä¸ªå²—ä½çš„ä¸»è¦èŒè´£æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦çš„KPIæ˜¯ä»€ä¹ˆï¼Ÿ è¿™ä¸ªå²—ä½å¦‚ä½•è¯„ä¼°ç»©æ•ˆï¼Œè¯•ç”¨æœŸéœ€è¦è¾¾åˆ°ä»€ä¹ˆæŒ‡æ ‡ï¼Ÿ è¿™ä¸ªå²—ä½çš„æœ€å¤§æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ é—®å›¢é˜Ÿï¼š å›¢é˜Ÿçš„åŸºæœ¬æƒ…å†µï¼Ÿ è¿™ä¸ªå›¢é˜Ÿåœ¨å…¬å¸çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ å¯ä»¥è·Ÿæˆ‘ä»‹ç»ä¸€ä¸‹æˆ‘çš„é¢†å¯¼å—ï¼Ÿ é—®å…¬å¸ å…¬å¸çš„æ–‡åŒ–æ°›å›´æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ å‘˜å·¥çš„æ™‹å‡æœºåˆ¶æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿæˆ‘è¿™ä¸ªå²—ä½çš„æ™‹å‡æœºä¼šå¦‚ä½•ï¼Ÿ è¿™ä¸ªå²—ä½æ‰€åœ¨çš„å›¢é˜Ÿå¦‚ä½•æ”¯æŒå…¬å¸ç›®æ ‡çš„å®ç°ï¼Ÿ","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-é¢è¯•é¢˜","slug":"OC-é¢è¯•é¢˜","permalink":"https://www.bboyzj.cn/tags/OC-%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"Blog-04ï¼šä¸»é¢˜å®Œå–„","slug":"Blogæ­å»º/Blog-04ï¼šä¸»é¢˜å®Œå–„","date":"2023-03-01T02:54:01.000Z","updated":"2023-03-01T17:50:03.426Z","comments":true,"path":"2023/03/01/Blogæ­å»º/Blog-04ï¼šä¸»é¢˜å®Œå–„/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/Blog%E6%90%AD%E5%BB%BA/Blog-04%EF%BC%9A%E4%B8%BB%E9%A2%98%E5%AE%8C%E5%96%84/","excerpt":"","text":"å‰è¨€æˆ‘ä»¬ä»¥ Snippet ä¸»é¢˜é—®ä¾‹ ä¸‹è½½å®‰è£…1mac@bogon Blog % $ git clone git://github.com/shenliyang/hexo-theme-snippet.git themes/hexo-theme-snippet å®‰è£…ä¸»é¢˜æ’ä»¶1mac@bogon Blog % $ npm i hexo-renderer-ejs hexo-renderer-less hexo-deployer-git -S éƒ¨ç½²ä¸»é¢˜å…·ä½“éƒ¨ç½²çœ‹ä¸‹é¢çš„é“¾æ¥ï¼š1ã€2ã€3æ­¥éª¤å¯çœç•¥ Snippet","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}],"tags":[{"name":"åšå®¢æ­å»º","slug":"åšå®¢æ­å»º","permalink":"https://www.bboyzj.cn/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"}],"keywords":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}]},{"title":"Blog-03ï¼šGithubåŸŸåç»‘å®šé˜¿é‡Œäº‘åŸŸå","slug":"Blogæ­å»º/Blog-03ï¼šGithubåŸŸåç»‘å®šé˜¿é‡Œäº‘åŸŸå","date":"2023-03-01T02:17:25.000Z","updated":"2023-03-09T07:08:25.789Z","comments":true,"path":"2023/03/01/Blogæ­å»º/Blog-03ï¼šGithubåŸŸåç»‘å®šé˜¿é‡Œäº‘åŸŸå/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/Blog%E6%90%AD%E5%BB%BA/Blog-03%EF%BC%9AGithub%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A%E9%98%BF%E9%87%8C%E4%BA%91%E5%9F%9F%E5%90%8D/","excerpt":"","text":"æ³¨å†ŒåŸŸåå» é˜¿é‡Œäº‘ æ³¨å†Œè´¦å·ã€å¹¶è´­ä¹°åŸŸåï¼Œå…·ä½“æµç¨‹è¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»äº† åŸŸåè§£æ åœ¨ç»ˆç«¯ ping ä¸€ä¸‹ä¹‹å‰é…ç½®çš„é™æ€é¡µé¢åœ°å€,å¯ä»¥è·å–åˆ°å¯¹åº”çš„ipåœ°å€: 123456mac@bogon ~ % ping BboyZJ.github.ioPING bboyzj.github.io (185.199.109.153): 56 data bytes64 bytes from 185.199.109.153: icmp_seq=0 ttl=50 time=261.217 ms64 bytes from 185.199.109.153: icmp_seq=1 ttl=50 time=337.547 ms64 bytes from 185.199.109.153: icmp_seq=2 ttl=50 time=260.716 ms... @è§£æ è®°å½•ç±»å‹ï¼šAä¸»æœºè®°å½•ï¼š@è§£æè¯·æ±‚æ¥æºï¼šé»˜è®¤è®°å½•å€¼ï¼š185.199.109.153TTLï¼š10åˆ†é’Ÿ ç‚¹å‡»ç¡®å®š wwwè§£æ è®°å½•ç±»å‹ï¼šCNAMEä¸»æœºè®°å½•ï¼šwwwè§£æçº¿è·¯æ¥æºï¼šé»˜è®¤è®°å½•å€¼ï¼šBboyZJ.github.ioTTLï¼š10åˆ†é’Ÿ ç‚¹å‡»ç¡®å®š é…ç½®é¡¹ç›® CNAME åœ¨ Blog/source ç›®å½•ä¸‹ï¼Œæ–°å»º CNAME æ–‡ä»¶ï¼Œå†…å®¹è¾“å…¥é˜¿é‡Œäº‘ç”³è¯·çš„åŸŸå www.bboyzj.cn 12mac@bogon ~ % cd /Users/mac/Desktop/Blog/source mac@bogon source % touch CNAME é…ç½® Blog ç›®å½•ä¸‹ _config.yml æ–‡ä»¶ï¼ŒURL æ¨¡å— 123456789# URL## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;url: https://www.bboyzj.cnroot: /BboyZJ.github.io/permalink: :year/:month/:day/:title/permalink_defaults:pretty_urls: trailing_index: true # Set to false to remove trailing &#x27;index.html&#x27; from permalinks trailing_html: true # Set to false to remove trailing &#x27;.html&#x27; from permalinks æ‰§è¡Œ 123mac@bogon ~ % hexo cleanmac@bogon ~ % hexo gmac@bogon ~ % hexo d æäº¤é™ˆæˆåŠŸåï¼Œå°±å¯ä»¥åœ¨ GitHub å’Œ www.bboyzj.cn ä¸ªäººåŸŸåç»‘å®šä¸Šäº†","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}],"tags":[{"name":"åšå®¢æ­å»º","slug":"åšå®¢æ­å»º","permalink":"https://www.bboyzj.cn/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"}],"keywords":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}]},{"title":"Blog-02ï¼šéƒ¨ç½²åšå®¢åˆ°GitHub","slug":"Blogæ­å»º/Blog-02ï¼šéƒ¨ç½²åšå®¢åˆ°GitHub","date":"2023-03-01T01:12:01.000Z","updated":"2023-03-09T07:07:09.408Z","comments":true,"path":"2023/03/01/Blogæ­å»º/Blog-02ï¼šéƒ¨ç½²åšå®¢åˆ°GitHub/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/Blog%E6%90%AD%E5%BB%BA/Blog-02%EF%BC%9A%E9%83%A8%E7%BD%B2%E5%8D%9A%E5%AE%A2%E5%88%B0GitHub/","excerpt":"","text":"æ³¨å†ŒGitHubè´¦å·å‰å¾€ Github ç½‘ç«™ï¼Œæ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ã€‚ç”¨é‚®ç®±æ³¨å†Œçš„ä¸€å®šå‰å¾€é‚®ç®±å»éªŒè¯é‚®ä»¶ã€‚ éƒ¨ç½²åˆ° GitHub ä¸Š æ–°å»º reponsity ä»“åº“ ä»“åº“åè®¾ç½®æˆ ç”¨æˆ·å.github.io ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ BboyZJ.github.ioï¼Œé€‰æ‹© Publicï¼Œå‹¾é€‰ Add a README file ï¼Œæœ€å Create respository é…ç½®ç§˜é’¥ æŸ¥çœ‹ç§˜é’¥ 123$ cd ~/.ssh$ ls$ cat id_rsa.pub æ·»åŠ SSHç§˜é’¥ï¼šå¤´åƒ -&gt; Setting -&gt; SSH and GPG keys Title éšæ„å†™ï¼ŒKey éœ€è¦å¡«å†™åˆšæ‰å¤åˆ¶çš„ ç§˜é’¥ æ–‡æœ¬å†…å®¹ æ·»åŠ å®Œæˆï¼ŒéªŒè¯é“¾æ¥ 123mac@bogon ~ % ssh -T git@github.comHi BboyZJ! You&#x27;ve successfully authenticated, but GitHub does not provide shell access. ä¸Šä¼ æ–‡ä»¶åˆ° GitHub é…ç½® Blog ä¸‹ _config.yml ä¸­çš„ Deployment æ¨¡å— 123456# Deployment## Docs: https://hexo.io/docs/one-command-deploymentdeploy: type: git repository: https://github.com/BboyZJ/BboyZJ.github.io.git branch: master å®‰è£…éƒ¨ç½²æ’ä»¶ é€šè¿‡ Hexo å‘å¸ƒåˆ° GitHubï¼Œéœ€è¦å®‰è£…éƒ¨ç½²æ’ä»¶ 1mac@bogon ~ % npm install hexo-deployer-git --save éƒ¨ç½² 123mac@bogon ~ % cd /Users/mac/Desktop/Blogmac@bogon ~ % hexo gmac@bogon ~ % hexo d è®¿é—® è¿™æ—¶æˆ‘ä»¬çš„ GitHub åŸŸå https://BboyZJ.github.io å°±å¯ä»¥çœ‹åˆ° Hexo ç½‘ç«™äº†ï¼Œå¦‚æœæ²¡æ˜¾ç¤ºå‡ºæ¥å°± åˆ·æ–° ä¸€ä¸‹","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}],"tags":[{"name":"åšå®¢æ­å»º","slug":"åšå®¢æ­å»º","permalink":"https://www.bboyzj.cn/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"}],"keywords":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}]},{"title":"Blog-01ï¼šHexoä¸ªäººåšå®¢æ­å»º","slug":"Blogæ­å»º/Blog-01ï¼šHexoä¸ªäººåšå®¢æ­å»º","date":"2023-02-28T23:39:40.000Z","updated":"2023-03-09T07:06:01.416Z","comments":true,"path":"2023/03/01/Blogæ­å»º/Blog-01ï¼šHexoä¸ªäººåšå®¢æ­å»º/","link":"","permalink":"https://www.bboyzj.cn/2023/03/01/Blog%E6%90%AD%E5%BB%BA/Blog-01%EF%BC%9AHexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/","excerpt":"","text":"Hexo ä»€ä¹ˆæ˜¯Hexoï¼Ÿ ç®€ä»‹ï¼šHexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚æƒ³è¦è¯¦ç»†çš„äº†è§£ Hexo ï¼Œå»å®˜ç½‘å­¦ä¹ ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚ å®‰è£…å‰æ æ£€æŸ¥æ˜¯å¦å®‰è£… homebrew 12345mac@bogon ~ % brew -vHomebrew 3.6.21-28-ge6548a8Homebrew/homebrew-core (git revision 5434c8344e8; last commit 2023-02-09)Homebrew/homebrew-cask (git revision 15c2c1fa53; last commit 2023-02-09)mac@bogon ~ % å¦‚æœé¡ºåˆ©æ˜¾ç¤ºç‰ˆæœ¬å·ï¼Œè¯´æ˜homebrewå·²ç»å®‰è£…ã€‚å¦åˆ™ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š 1mac@bogon ~ % ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; å®‰è£…è¿‡ç¨‹å¦‚æœå‡ºç°ä¸‹é¢çš„é—®é¢˜ 1curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused è§£å†³: 1mac@bogon ~ % /usr/bin/ruby -e &quot;$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install)&quot; å®‰è£… Node.js 123mac@bogon ~ % brew install nodemac@bogon ~ % node -vv18.14.2 å®‰è£…GitMacç³»ç»Ÿé»˜è®¤å·²ç»å®‰è£…å¥½äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦å†å®‰è£… å®‰è£…Hexoå¦‚æœæ‚¨çš„ç”µè„‘ä¸­å·²ç»å®‰è£…ä¸Šè¿°å¿…å¤‡ç¨‹åºï¼Œé‚£ä¹ˆæ­å–œæ‚¨ï¼ä½ å¯ä»¥ç›´æ¥å‰å¾€å®‰è£… Hexo æ­¥éª¤ã€‚ ä½¿ç”¨npmå®Œæˆ hexo å®‰è£… 12345678910111213141516171819202122mac@bogon ~ % npm install -g hexo-climac@bogon ~ % hexo -vhexo-cli: 4.1.0os: Darwin 21.6.0 darwin x64node: 12.16.1v8: 7.8.279.23-node.31uv: 1.34.0zlib: 1.2.11brotli: 1.0.7ares: 1.15.0modules: 72nghttp2: 1.40.0napi: 5llhttp: 2.0.4http_parser: 2.9.3openssl: 1.1.1dcldr: 35.1icu: 64.2tz: 2019cunicode: 12.1mac@bogon ~ % å»ºç«™ æ¡Œé¢æ–°å»º Blog æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ° Blog ä¸‹ï¼Œæ‰§è¡Œ: 123456789101112mac@bogon ~ % cd /Users/mac/Desktop/Blog mac@bogon Blog % hexo initINFO Cloning hexo-starter https://github.com/hexojs/hexo-starter.gitINFO Install dependenciesnpm notice npm notice New major version of npm available! 7.3.0 -&gt; 9.5.1npm notice Changelog: https://github.com/npm/cli/releases/tag/v9.5.1npm notice Run npm install -g npm@9.5.1 to update!npm notice INFO Start blogging with Hexo!mac@bogon Blog % ã€ç›®å½•æ–‡ä»¶ã€‘ï¼š _config.landscape.ymlï¼šç½‘ç«™æœ¬åœ°é…ç½®ä¿¡æ¯_config.ymlï¼šç½‘ç«™çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥åœ¨æ­¤é…ç½®å¤§éƒ¨åˆ†çš„å‚æ•°sourceâ€“postsï¼šå­˜æ”¾ md æ–‡ä»¶themesï¼šä¸»é¢˜æ–‡ä»¶å¤¹ï¼Œå¸¸ç”¨ä¸»é¢˜ ä¼šæ”¾å…¥è¿™é‡Œpublicï¼šMarkdown å’Œ HTML æ–‡ä»¶ä¼šè¢«è§£æå¹¶æ”¾åˆ° public æ–‡ä»¶å¤¹ï¼Œè€Œå…¶ä»–æ–‡ä»¶ä¼šè¢«æ‹·è´è¿‡å» hexo æµ‹è¯• ç”Ÿæˆé™æ€é¡µé¢ 1mac@bogon Blog % hexo g ä¼šåœ¨æ ¹ç›®å½• Blog\\ ä¸‹ç”Ÿæˆ public æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«ç›¸åº”çš„ html é¡µé¢ã€‚ å¯åŠ¨æœåŠ¡å™¨ 1mac@bogon Blog % hexo s æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ç½‘å€: http://localhost:4000 ï¼Œå³å¯çœ‹åˆ°hexoç”Ÿæˆçš„é™æ€é¡µé¢ã€‚ åœæ­¢æœåŠ¡å™¨ Ctrl + C ä¸»é¢˜hexoæä¾›äº†å¾ˆå¤šä¸»é¢˜å¯ä»¥å‚è€ƒï¼Œä¸‹é¢ä»¥ hexo-theme-casual ä¸»é¢˜ä¸ºä¾‹ å®‰è£…ä¸»é¢˜æ’ä»¶ hexo-theme-redefine 1æ—  hexo-theme-casual 1mac@bogon Blog % $ npm install --save hexo-renderer-jade hexo-renderer-scss hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive hexo-generator-search hexo-theme-snippet 1mac@bogon Blog % $ npm i hexo-renderer-ejs hexo-renderer-less hexo-deployer-git -S hexo-theme-butterfly 12mac@bogon Blog % $ git clone -b dev https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterflymac@bogon Blog % $ npm install hexo-renderer-pug hexo-renderer-stylus ä¸‹è½½ä¸»é¢˜ è¿›å…¥ä¸»é¢˜çš„ github ä¸‹è½½é¡µï¼Œç‚¹å‡» code -&gt; cloneï¼Œå¤åˆ¶ https ä¸‹è½½é“¾æ¥ï¼Œè¿›å…¥ åšåº“Blogç›®å½•ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 123mac@bogon Blog % cd /Users/mac/Desktop/Blog mac@bogon Blog % cd themes mac@bogon themes % git clone https://github.com/littlewin-wang/hexo-theme-casual.git ã€æ³¨ã€‘ï¼šä¸»é¢˜å­˜æ”¾çš„ç›®å½•æ˜¯ Blog/themesï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæ¯ä¸€ä¸ªä¸‹è½½çš„ä¸»é¢˜éƒ½å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œæˆ‘è¿™ä¸ªä¸»é¢˜çš„ç›®å½•æ˜¯ hexo-theme-casualï¼Œå¯ä»¥ä¸‹è½½å¤šä¸ªä¸»é¢˜: ä¸»é¢˜åº”ç”¨ æ‰¾åˆ° åšå®¢Blog ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ _config.ymlï¼Œæ‰¾åˆ° Extensions æ¨¡å—ï¼Œä¿®æ”¹ theme å­—æ®µï¼š 1234# Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/theme: hexo-theme-casual å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ 1234567891011mac@bogon Blog % hexo sINFO Validating configINFO Start processingINFO Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.[Browsersync] Access URLs: ---------------------------------- UI: http://localhost:3001 ---------------------------------- UI External: http://localhost:3001 ---------------------------------- æŸ¥çœ‹æ•ˆæœ é€šè¿‡ http://localhost:4000/ æŸ¥çœ‹ä¿®æ”¹åçš„æ•ˆæœ ä¸»é¢˜æ›´æ–° è¿™ä¸€æ­¥ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸»é¢˜æœ‰ä¼˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°åŒæ­¥æ›´æ–°ä¸€ä¸‹ 12mac@bogon Blog % /Users/mac/Desktop/Blog/themes/casual mac@bogon Blog % git pull å…¶ä»–å‘½ä»¤ æ¸…é™¤æ—§çš„å†…å®¹ hexo clean ç”Ÿæˆé™æ€å‘å¸ƒé¡µé¢ hexo g å‘å¸ƒé¡µé¢ hexo d","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}],"tags":[{"name":"åšå®¢æ­å»º","slug":"åšå®¢æ­å»º","permalink":"https://www.bboyzj.cn/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"}],"keywords":[{"name":"Blog","slug":"Blog","permalink":"https://www.bboyzj.cn/categories/Blog/"}]},{"title":"OCæ¶æ„00ï¼šMVVMåŒå‘æ•°æ®ç»‘å®š","slug":"OCå­¦ä¹ /OCå­¦ä¹ 00ï¼šMVVMåŒå‘æ•°æ®ç»‘å®š","date":"2023-02-27T13:57:46.000Z","updated":"2023-03-08T22:48:12.050Z","comments":true,"path":"2023/02/27/OCå­¦ä¹ /OCå­¦ä¹ 00ï¼šMVVMåŒå‘æ•°æ®ç»‘å®š/","link":"","permalink":"https://www.bboyzj.cn/2023/02/27/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A000%EF%BC%9AMVVM%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A/","excerpt":"","text":"MVVM æ˜¯ä»€ä¹ˆï¼ŸMVVM åŒ…å«ä¸‰éƒ¨åˆ†ï¼š Modelï¼šæ¨¡å‹å±‚ï¼Œä¸»è¦æ˜¯å­˜æ”¾æ•°æ® Viewï¼šè§†å›¾å±‚ï¼ŒUI ç»˜åˆ¶ ViewModelï¼šä¸šåŠ¡é€»è¾‘å¤„ç†å±‚ï¼Œå°† Model å’Œ View åˆ†å¼€ï¼Œå¯ä»¥å–å‡º Model çš„æ•°æ®ï¼ŒåŒæ—¶å¤„ç† View è¦å±•ç¤ºçš„å†…å®¹æ¶‰åŠçš„ä¸šåŠ¡é€»è¾‘ MVVM é‡‡ç”¨åŒå‘æ•°æ®ç»‘å®šï¼š MVVM ä¼˜åŠ£ ä¼˜åŠ¿ ä»£ç æ¸…æ™°ï¼šViewModel åˆ†ç¦»å¤§éƒ¨åˆ† VC ä»£ç  æ–¹ä¾¿æµ‹è¯•ï¼šå¯å¯¹ ViewModel æ„é€ å•å…ƒæµ‹è¯• å¼€å‘è§£è€¦ï¼šä¸€ä½å¼€å‘è€…è´Ÿè´£é€»è¾‘å®ç°ï¼Œä¸€ä½å¼€å‘è€…è´Ÿè´£ UI å®ç° åŠ£åŠ¿ ä»£ç é‡å¤šï¼Œéœ€è¦å¯¹æ¯ä¸ª Controller å®ç°ç»‘å®š å®æˆ˜æ€è·¯ VC ä¸‹ä»£ç  123456789101112131415161718#import &quot;ZJTwoViewController.h&quot;#import &quot;ZJTwoViewModel.h&quot;@interface ZJTwoViewController ()@property (nonatomic,strong)UIButton * btn;@property (nonatomic,strong)ZJTwoViewModel * viewModel;@end@implementation ZJTwoViewController- (void)viewDidLoad &#123; [super viewDidLoad]; self.view.backgroundColor = [UIColor whiteColor];; // ç»‘å®šVC self.viewModel = [[ZJTwoViewModel alloc] initWithVC:self];&#125; Modelä¸‹ä»£ç  1234567@interface ZJTwoModel : NSObject@property (nonatomic,copy)NSString * name;@end@implementation ZJTwoModel@end View ä¸‹ä»£ç  12345678910111213@protocol ZJTwoViewDelegate &lt;NSObject&gt;- (void)doSomethings;@end@interface ZJTwoView : UIView// æœ‰ç”¨VM@property (nonatomic,weak)ZJTwoViewModel * viewModel;// è®¾ç½®ä»£ç†@property (nonatomic,weak)id&lt;ZJTwoViewDelegate&gt;delegate;// è‡ªèº«æ§ä»¶@property (nonatomic,strong)UILabel * label;@end .m æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344#import &quot;ZJTwoView.h&quot;@implementation ZJTwoView- (instancetype)initWithFrame:(CGRect)frame&#123; self = [super initWithFrame:frame]; if (self) &#123; [self addSubview:self.label]; &#125; return self;&#125;#pragma mark -lazy- (UILabel *)label&#123; if (!_label) &#123; _label = [[UILabel alloc] initWithFrame:CGRectMake(20, 40, self.frame.size.width - 40, self.frame.size.height - 80)]; _label.backgroundColor = [UIColor orangeColor]; _label.textAlignment = NSTextAlignmentCenter; &#125; return _label;&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; // ä»£ç† if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(doSomethings)]) &#123; [self.delegate doSomethings]; &#125;&#125;// é‡å†™ setter æ–¹æ³•ï¼Œç›‘å¬æ¥è‡ª viewModel çš„æ•°æ®- (void)setViewModel:(ZJTwoViewModel *)viewModel&#123; // è·å–æ•°æ® _viewModel = viewModel; /* å®ç°ç›‘å¬ æ¯”å¦‚ RACï¼ˆå¥½å¤šå…¬å¸éƒ½ä½¿ç”¨MVVM+RACä¸¤è€…æ­é…ï¼‰ */ RACSignal * signal = [viewModel rac_valuesForKeyPath:@&quot;name&quot; observer:self]; [signal subscribeNext:^(NSString * name) &#123; NSLog(@&quot;name=%@&quot;,name); &#125;];&#125;@end ViewModel ä¸‹ä»£ç  .h æ–‡ä»¶ 123456789#import &lt;Foundation/Foundation.h&gt;NS_ASSUME_NONNULL_BEGIN@interface ZJTwoViewModel : NSObject// å…¥å£æ–¹æ³•- (instancetype)initWithVC:(UIViewController *)controller;@end .m ä¸‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109#import &quot;ZJTwoViewModel.h&quot;#import &quot;ZJTwoView.h&quot;#import &quot;ZJTwoModel.h&quot;@interface ZJTwoViewModel ()&lt;UITextFieldDelegate,ZJTwoViewDelegate&gt;// VC@property (nonatomic,weak)UIViewController * vc;// Model@property (nonatomic,strong)ZJTwoModel * model;// View@property (nonatomic,strong)ZJTwoView * view;// TF@property (nonatomic,strong)UITextField * tf;// model.nameç»‘å®šçš„name@property (nonatomic,copy)NSString * name;@end@implementation ZJTwoViewModel// å…¥å£æ–¹æ³•ï¼šç»‘å®šä¸€ä¸ª VC å¹¶å®ç°ä¸šåŠ¡é€»è¾‘- (instancetype)initWithVC:(UIViewController *)controller&#123; if (self = [super init]) &#123; // ç»‘å®šæ§åˆ¶å™¨ self.vc = controller; // åˆå§‹åŒ–UI [self initUI]; // åˆå§‹åŒ–RAC [self initRAC]; &#125; return self;&#125;#pragma mark -initUI- (void)initUI&#123; // æ·»åŠ è§†å›¾ [self.vc.view addSubview:self.view]; // Viewå’ŒViewModelåŒå‘ç»‘å®š self.view.viewModel = self; // ä»£ç† self.view.delegate = self; // æ¨¡å‹ self.model = [ZJTwoModel new]; self.model.name = @&quot;ZJ&quot;; // æ ¸å¿ƒæ€æƒ³ V/M èƒ½å¤Ÿæ‹¥æœ‰VCï¼Œä½†ä¸¤è€…ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ // å°†Modelç»‘å®šåˆ°VMä¸Š self.name = self.model.name; // éªŒè¯ç›‘å¬ï¼šåŠ¨æ€æ£€æµ‹æ–‡æœ¬å†…å®¹ [self.vc.view addSubview:self.tf];&#125;#pragma mark -ç›‘å¬- (void)initRAC&#123; // ç›‘å¬è§†å›¾å‡ºç°çš„äº‹ä»¶ [[self.vc rac_signalForSelector:@selector(viewWillAppear:)] subscribeNext:^(id x) &#123; NSLog(@&quot;viewWillAppear&quot;); &#125;];&#125;#pragma mark -&lt;UITextFieldDelegate&gt;// åŠ¨æ€æ£€æµ‹æ–‡æœ¬æ¡†å†…å®¹- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string&#123; [textField addTarget:self action:@selector(textFieldDidChange:) forControlEvents:UIControlEventEditingChanged]; return YES;;&#125;// åŠ¨æ€æ–‡æœ¬- (void)textFieldDidChange:(id)sender&#123; UITextField * tf = (UITextField *)sender; // å˜æ›´æ•°æ®ï¼š// self.name = tf.text; // ç›´æ¥æ”¹å˜æ¨¡å‹ self.model.name = tf.text; // æ›´æ–°UI self.view.label.text = self.model.name;&#125;#pragma mark -ZJTwoViewDelegate- (void)doSomethings&#123; NSLog(@&quot;doSomethings&quot;);&#125;#pragma mark -lazy- (ZJTwoView *)view&#123; if (!_view) &#123; _view = [[ZJTwoView alloc] initWithFrame:CGRectMake(30, 80, kScreenWidth - 60, 200)]; _view.backgroundColor = [UIColor redColor]; &#125; return _view;&#125;- (UITextField *)tf&#123; if (!_tf) &#123; _tf = [[UITextField alloc] initWithFrame:CGRectMake(50, 500, kScreenWidth - 100, 50)]; _tf.clearButtonMode = UITextFieldViewModeWhileEditing; _tf.textColor = [UIColor whiteColor]; _tf.placeholder = @&quot;ç‚¹å‡»æ›´æ”¹&quot;; _tf.backgroundColor = [UIColor redColor]; _tf.delegate = self; &#125; return _tf;&#125;@end","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCåº•å±‚åŸç†15.5ï¼šdyldå‘å±•å²","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†15-2ï¼šdyldå‘å±•å²","date":"2023-02-25T20:30:55.000Z","updated":"2023-02-25T20:42:34.497Z","comments":true,"path":"2023/02/26/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†15-2ï¼šdyldå‘å±•å²/","link":"","permalink":"https://www.bboyzj.cn/2023/02/26/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8615-2%EF%BC%9Adyld%E5%8F%91%E5%B1%95%E5%8F%B2/","excerpt":"","text":"dyldç®€ä»‹ dyldå…¨å The dynamic link editorï¼› æ˜¯è‹¹æœçš„åŠ¨æ€é“¾æ¥å™¨ï¼› æ˜¯è‹¹æœæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼› åœ¨åº”ç”¨è¢«ç¼–è¯‘æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åï¼ˆå³Mach-Oï¼‰ï¼Œå°†å…¶äº¤ç”±dyldè´Ÿè´£é“¾æ¥ï¼ŒåŠ è½½ç¨‹åºã€‚ dyldè´¯ç©¿äº†Appå¯åŠ¨çš„è¿‡ç¨‹ï¼ŒåŒ…å«åŠ è½½ä¾èµ–åº“ã€ä¸»ç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€å¯åŠ¨ä¼˜åŒ–ç­‰ï¼Œä¸å¯é¿å…çš„éœ€è¦å’Œdyldæ‰“äº¤é“ ä¸”dyldæ˜¯å¼€æºçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®˜ç½‘ä¸‹è½½å®ƒçš„æºç æ¥é˜…è¯»ç†è§£ dyld 1.0ï¼ˆ1996-2004ï¼‰ dyld 1åŒ…å«åœ¨NeXTStep 3.3ä¸­ï¼Œåœ¨æ­¤ä¹‹å‰çš„NeXTä½¿ç”¨é™æ€äºŒè¿›åˆ¶æ•°æ®ã€‚ä½œç”¨å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œ dyld 1æ˜¯åœ¨ç³»ç»Ÿå¹¿æ³›ä½¿ç”¨C++åŠ¨æ€åº“ä¹‹å‰ç¼–å†™çš„ï¼Œç”±äºC++æœ‰è®¸å¤šç‰¹æ€§ï¼Œä¾‹å¦‚å…¶åˆå§‹åŒ–å™¨çš„å·¥ä½œï¼Œåœ¨é™æ€ç¯å¢ƒå·¥ä½œè‰¯å¥½ï¼Œä½†æ˜¯åœ¨åŠ¨æ€ç¯å¢ƒä¸­å¯èƒ½ä¼šé™ä½æ€§èƒ½ã€‚å› æ­¤å¤§å‹çš„C++åŠ¨æ€åº“ä¼šå¯¼è‡´dyldéœ€è¦å®Œæˆå¤§é‡çš„å·¥ä½œï¼Œé€Ÿåº¦å˜æ…¢ åœ¨å‘å¸ƒmacOS 10.0å’ŒCheetahå‰ï¼Œè¿˜å¢åŠ äº†ä¸€ä¸ªç‰¹æ€§ï¼Œå³Prebindingé¢„ç»‘å®šã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PrebindingæŠ€æœ¯ä¸ºç³»ç»Ÿä¸­çš„æ‰€æœ‰dylibå’Œåº”ç”¨ç¨‹åºæ‰¾åˆ°å›ºå®šçš„åœ°å€ã€‚dyldå°†ä¼šåŠ è½½è¿™äº›åœ°å€çš„æ‰€æœ‰å†…å®¹ã€‚å¦‚æœåŠ è½½æˆåŠŸï¼Œå°†ä¼šç¼–è¾‘æ‰€æœ‰dylibå’Œç¨‹åºçš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¥è·å¾—æ‰€æœ‰é¢„è®¡ç®—ã€‚å½“ä¸‹æ¬¡éœ€è¦å°†æ‰€æœ‰æ•°æ®æ”¾å…¥ç›¸åŒåœ°å€æ—¶å°±ä¸éœ€è¦è¿›è¡Œé¢å¤–æ“ä½œäº†ï¼Œå°†å¤§å¤§çš„æé«˜é€Ÿåº¦ã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æ¯æ¬¡å¯åŠ¨éƒ½éœ€è¦ç¼–è¾‘è¿™äº›äºŒè¿›åˆ¶æ•°æ®ï¼Œè‡³å°‘ä»å®‰å…¨æ€§æ¥è¯´ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸å‹å¥½ã€‚ dyld 2ï¼ˆ2004-2017ï¼‰ dyld 2ä»2004å¹´å‘å¸ƒè‡³ä»Šï¼Œå·²ç»ç»è¿‡äº†å¤šä¸ªç‰ˆæœ¬è¿­ä»£ï¼Œæˆ‘ä»¬ç°åœ¨å¸¸è§çš„ä¸€äº›ç‰¹æ€§ï¼Œä¾‹å¦‚ASLRã€Code Signã€share cacheç­‰æŠ€æœ¯ï¼Œéƒ½æ˜¯åœ¨dyld 2ä¸­å¼•å…¥çš„ dyld 2.0ï¼ˆ2004-2007ï¼‰ 2004å¹´åœ¨macOS Tigerä¸­æ¨å‡ºäº†dyld 2 dyld 2æ˜¯dyld 1å®Œå…¨é‡å†™çš„ç‰ˆæœ¬ï¼Œå¯ä»¥æ­£ç¡®æ”¯æŒC++åˆå§‹åŒ–å™¨è¯­ä¹‰ï¼ŒåŒæ—¶æ‰©å±•äº†mach-oæ ¼å¼å¹¶æ›´æ–°dyldã€‚ä»è€Œè·å¾—äº†é«˜æ•ˆç‡C++åº“çš„æ”¯æŒã€‚ dyld 2å…·æœ‰å®Œæˆçš„dlopenå’Œdlsymï¼ˆä¸»è¦ç”¨äºåŠ¨æ€åŠ è½½åº“å’Œè°ƒç”¨å‡½æ•°ï¼‰å®ç°ï¼Œä¸”å…·æœ‰æ­£ç¡®çš„è¯­ä¹‰ï¼Œå› æ­¤å¼ƒç”¨äº†æ—§ç‰ˆçš„API dlopenï¼šæ‰“å¼€ä¸€ä¸ªåº“ï¼Œè·å–å¥æŸ„ dlsymï¼šåœ¨æ‰“å¼€çš„åº“ä¸­æŸ¥æ‰¾ç¬¦å·çš„å€¼ dlcloseï¼šå…³é—­å¥æŸ„ã€‚ dlerrorï¼šè¿”å›ä¸€ä¸ªæè¿°æœ€åä¸€æ¬¡è°ƒç”¨dlopenã€dlsymï¼Œæˆ– dlclose çš„é”™è¯¯ä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚ dyld çš„ è®¾è®¡ç›®æ ‡ æ˜¯ æå‡å¯åŠ¨é€Ÿåº¦ã€‚å› æ­¤ä»…è¿›è¡Œæœ‰é™çš„å¥å…¨æ€§æ£€æŸ¥ã€‚ä¸»è¦æ˜¯å› ä¸ºä»¥å‰çš„æ¶æ„ç¨‹åºæ¯”è¾ƒå°‘ åŒæ—¶dyldä¹Ÿæœ‰ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œå› æ­¤å¯¹ä¸€äº›åŠŸèƒ½è¿›è¡Œäº†æ”¹è¿›ï¼Œæ¥æé«˜dyldåœ¨å¹³å°ä¸Šçš„å®‰å…¨æ€§ ç”±äºå¯åŠ¨é€Ÿåº¦çš„å¤§å¹…æå‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å‡å°‘Prebindingçš„å·¥ä½œé‡ã€‚ä¸ç¼–è¾‘ç¨‹åºæ•°æ®çš„åŒºåˆ«åœ¨äºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»…ç¼–è¾‘ç³»ç»Ÿåº“ï¼Œä¸”å¯ä»¥ä»…åœ¨è½¯ä»¶æ›´æ–°æ—¶åšè¿™äº›äº‹æƒ…ã€‚å› æ­¤åœ¨è½¯ä»¶æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šçœ‹åˆ°â€œä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½â€ç±»ä¼¼çš„æ–‡å­—ã€‚è¿™å°±æ˜¯åœ¨æ›´æ–°æ—¶è¿›è¡ŒPrebindingã€‚ç°åœ¨dyldç”¨äºæ‰€æœ‰ä¼˜åŒ–ï¼Œå…¶ç”¨é€”å°±æ˜¯ä¼˜åŒ–ã€‚å› æ­¤åé¢æœ‰äº†dyld 2 dyld 2.xï¼ˆ2007-2017ï¼‰ åœ¨2004-20017è¿™å‡ å¹´é—´è¿›è¡Œäº†å¤§é‡æ”¹è¿›ï¼Œdyld 2çš„æ€§èƒ½æ˜¾è‘—æé«˜ é¦–å…ˆï¼Œå¢åŠ äº†å¤§é‡çš„åŸºç¡€æ¶æ„å’Œå¹³å°ã€‚ è‡ªä»dyld 2åœ¨PowerPCå‘å¸ƒä¹‹åï¼Œå¢åŠ äº†x86ã€x86_64ã€armã€arm64å’Œè®¸å¤šçš„è¡ç”Ÿå¹³å°ã€‚ è¿˜æ¨å‡ºäº†iOSã€tvOSå’ŒwatchOSï¼Œè¿™äº›éƒ½éœ€è¦æ–°çš„dyldåŠŸèƒ½ é€šè¿‡å¤šç§æ–¹å¼å¢åŠ å®‰å…¨æ€§ å¢åŠ  codeSigningä»£ç ç­¾åã€ ASLRï¼ˆAddress space layout randomizationï¼‰åœ°å€ç©ºé—´é…ç½®éšæœºåŠ è½½ï¼šæ¯æ¬¡åŠ è½½åº“æ—¶ï¼Œå¯èƒ½ä½äºä¸åŒçš„åœ°å€ bound checkingè¾¹ç•Œæ£€æŸ¥ï¼šmach-oæ–‡ä»¶ä¸­å¢åŠ äº†Headerçš„è¾¹ç•Œæ£€æŸ¥åŠŸèƒ½ï¼Œä»è€Œé¿å…æ¶æ„äºŒè¿›åˆ¶æ•°æ®çš„æ³¨å…¥ å¢å¼ºäº†æ€§èƒ½ å¯ä»¥æ¶ˆé™¤Prebindingï¼Œç”¨share cacheå…±äº«ä»£ç ä»£æ›¿ ASLR ASLRæ˜¯ä¸€ç§é˜²èŒƒå†…å­˜æŸåæ¼æ´è¢«åˆ©ç”¨çš„è®¡ç®—æœºå®‰å…¨æŠ€æœ¯ï¼ŒASLRé€šè¿‡éšæœºæ”¾ç½®è¿›ç¨‹å…³é”®æ•°æ®åŒºåŸŸçš„åœ°å€ç©ºé—´æ¥é˜²æ­¢æ”»å‡»è€…è·³è½¬åˆ°å†…å­˜ç‰¹å®šä½ç½®æ¥åˆ©ç”¨å‡½æ•° Linuxå·²åœ¨å†…æ ¸ç‰ˆæœ¬2.6.12ä¸­æ·»åŠ ASLR Appleåœ¨Mac OS X Leopard 10.5ï¼ˆ2007å¹´åæœˆå‘è¡Œï¼‰ä¸­æŸäº›åº“å¯¼å…¥äº†éšæœºåœ°å€åç§»ï¼Œä½†å…¶å®ç°å¹¶æ²¡æœ‰æä¾›ASLRæ‰€å®šä¹‰çš„å®Œæ•´ä¿æŠ¤èƒ½åŠ›ã€‚è€ŒMac OS X Lion 10.7åˆ™å¯¹æ‰€æœ‰çš„åº”ç”¨ç¨‹åºå‡æä¾›äº†ASLRæ”¯æŒã€‚ Appleåœ¨iOS 4.3å†…å¯¼å…¥äº†ASLRã€‚ bounds checking è¾¹ç•Œæ£€æŸ¥ å¯¹mach-o headerä¸­çš„è®¸å¤šå†…å®¹æ·»åŠ äº†é‡è¦çš„è¾¹ç•Œæ£€æŸ¥åŠŸèƒ½ï¼Œä»è€Œå¯ä»¥é¿å…æ¶æ„äºŒè¿›åˆ¶æ•°æ®çš„æ³¨å…¥ share cache å…±äº«ä»£ç  share cacheæœ€æ—©å®åœ¨iOS3.1å’ŒmacOS Snow Leopardä¸­è¢«å¼•å…¥ï¼Œç”¨äºå®Œå…¨å–ä»£Prebinding share cacheæ˜¯ä¸€ä¸ªå•æ–‡ä»¶ï¼ŒåŒ…å«å¤§å¤šæ•°ç³»ç»Ÿdylibï¼Œç”±äºè¿™äº›dylibåˆå¹¶æˆäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œä¼˜åŒ–ã€‚ é‡æ–°è°ƒæ•´æ‰€æœ‰æ–‡æœ¬æ®µï¼ˆ_TEXTï¼‰å’Œæ•°æ®æ®µï¼ˆ_DATAï¼‰ï¼Œå¹¶é‡å†™æ•´ä¸ªç¬¦å·è¡¨ï¼Œä»¥æ­¤æ¥å‡å°æ–‡ä»¶çš„å¤§å°ï¼Œä»è€Œåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­ä»…æŒ‚è½½å°‘é‡çš„åŒºåŸŸã€‚å…è®¸æˆ‘ä»¬æ‰“åŒ…äºŒè¿›åˆ¶æ•°æ®æ®µï¼Œä»è€ŒèŠ‚çœå¤§é‡çš„RAM æœ¬è´¨æ˜¯ä¸€ä¸ªdylibé¢„é“¾æ¥å™¨ï¼Œå®ƒåœ¨RAMä¸Šçš„èŠ‚çº¦æ˜¯æ˜¾è‘—çš„ï¼Œåœ¨æ™®é€šçš„iOSç¨‹åºä¸­è¿è¡Œå¯ä»¥èŠ‚çº¦500-1gå†…å­˜ è¿˜å¯ä»¥é¢„ç”Ÿæˆæ•°æ®ç»“æ„ï¼Œç”¨æ¥ä¾›dyldå’ŒOb-Cåœ¨è¿è¡Œæ—¶ä½¿ç”¨ã€‚ä»è€Œä¸å¿…åœ¨ç¨‹åºå¯åŠ¨æ—¶åšè¿™äº›äº‹æƒ…ï¼Œè¿™ä¹Ÿä¼šèŠ‚çº¦æ›´å¤šçš„RAMå’Œæ—¶é—´ share cacheåœ¨macOSä¸Šæœ¬åœ°ç”Ÿæˆï¼Œè¿è¡Œdyldå…±äº«ä»£ç ï¼Œå°†å¤§å¹…ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ dyld 2 å·¥ä½œæµç¨‹dyld 2æ˜¯çº¯ç²¹çš„in-processï¼Œå³åœ¨ç¨‹åºè¿›ç¨‹å†…æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ„å‘³ç€åªæœ‰å½“åº”ç”¨ç¨‹åºè¢«å¯åŠ¨æ—¶ï¼Œdyld 2æ‰èƒ½å¼€å§‹æ‰§è¡Œä»»åŠ¡ ä»¥ä¸‹æ˜¯dyld 2çš„å·¥ä½œæµç¨‹å›¾ç¤º 1ã€dyldçš„åˆå§‹åŒ–ï¼Œä¸»è¦ä»£ç åœ¨dyldbootstrap::startï¼Œæ¥ç€æ‰§è¡Œdyld::_mainï¼Œdyld::_mainä»£ç è¾ƒå¤šï¼Œæ˜¯dyldåŠ è½½çš„æ ¸å¿ƒéƒ¨åˆ†ï¼› 2ã€æ£€æŸ¥å¹¶å‡†å¤‡ç¯å¢ƒï¼Œä¾‹å¦‚è·å–äºŒè¿›åˆ¶è·¯å¾„ã€æ£€æŸ¥ç¯å¢ƒé…ç½®ï¼Œè§£æä¸»äºŒè¿›åˆ¶çš„image headerç­‰ä¿¡æ¯ 3ã€å®ä¾‹åŒ–ä¸»äºŒè¿›åˆ¶çš„image loaderï¼Œæ ¡éªŒä¸»äºŒè¿›åˆ¶å’Œdyldçš„ç‰ˆæœ¬æ˜¯å¦åŒ¹é… 4ã€æ£€æŸ¥share cacheæ˜¯å¦å·²ç»mapï¼Œå¦‚æœæ²¡æœ‰åˆ™éœ€è¦å…ˆæ‰§è¡Œmap share cacheæ“ä½œ 5ã€æ£€æŸ¥DYLD_INSERT_LIBRARIESï¼Œå¦‚æœæœ‰åˆ™åŠ è½½æ’å…¥çš„åŠ¨æ€åº“ï¼ˆå³å®ä¾‹åŒ–image loaderï¼‰ 6ã€æ‰§è¡Œlinkæ“ä½œï¼Œä¼šå…ˆé€’å½’åŠ è½½ä¾èµ–çš„æ‰€æœ‰åŠ¨æ€åº“ï¼ˆä¼šå¯¹ä¾èµ–åº“è¿›è¡Œæ’åºï¼Œè¢«ä¾èµ–çš„æ€»æ˜¯åœ¨å‰é¢ï¼‰ï¼ŒåŒæ—¶åœ¨è¿™é˜¶æ®µå°†æ‰§è¡Œç¬¦å·ç»‘å®šï¼Œä»¥åŠrebaseï¼Œbindingæ“ä½œï¼› 7ã€æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ï¼ŒOCçš„+loadå’ŒCçš„constructoræ–¹æ³•éƒ½ä¼šåœ¨è¿™ä¸ªé˜¶æ®µæ‰§è¡Œï¼› 8ã€è¯»å–Mach-oçš„LC_MAINæ®µè·å–ç¨‹åºçš„å…¥å£åœ°å€ï¼Œè°ƒç”¨mainå‡½æ•° ç®€åŒ–ç‰ˆ è§£æ mach-o æ–‡ä»¶ï¼Œæ‰¾åˆ°å…¶ä¾èµ–çš„åº“ï¼Œå¹¶ä¸”é€’å½’çš„æ‰¾åˆ°æ‰€æœ‰ä¾èµ–çš„åº“ï¼Œå½¢æˆä¸€å¼ åŠ¨æ€åº“çš„ä¾èµ–å›¾ã€‚iOS ä¸Šçš„å¤§éƒ¨åˆ† app éƒ½ä¾èµ–å‡ ç™¾ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼ˆå¤§éƒ¨åˆ†æ˜¯ç³»ç»Ÿçš„åŠ¨æ€åº“ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªæ­¥éª¤åŒ…å«äº†è¾ƒå¤§çš„å·¥ä½œé‡ã€‚ åŒ¹é… mach-o æ–‡ä»¶åˆ°è‡ªèº«çš„åœ°å€ç©ºé—´ è¿›è¡Œç¬¦å·æŸ¥æ‰¾ï¼ˆperform symbol lookupsï¼‰ rebaseå’Œbindingï¼šç”±äº app éœ€è¦è®©åœ°å€ç©ºé—´é…ç½®éšæœºåŠ è½½ï¼Œæ‰€ä»¥æ‰€æœ‰çš„æŒ‡é’ˆéƒ½éœ€è¦åŠ ä¸Šä¸€ä¸ªåŸºåœ°å€ è¿è¡Œåˆå§‹åŒ–ç¨‹åºï¼Œä¹‹åè¿è¡Œ main() å‡½æ•° dyld 3ï¼ˆ2017-è‡³ä»Šï¼‰ dyld 3æ˜¯2017å¹´WWDCæ¨å‡ºçš„å…¨æ–°çš„åŠ¨æ€é“¾æ¥å™¨ï¼Œå®ƒå®Œå…¨æ”¹å˜äº†åŠ¨æ€é“¾æ¥çš„æ¦‚å¿µï¼Œä¸”å°†æˆä¸ºå¤§å¤šæ•°macOSç³»ç»Ÿç¨‹åºçš„é»˜è®¤è®¾ç½®ã€‚2017 Apple OSå¹³å°ä¸Šçš„æ‰€æœ‰ç³»ç»Ÿç¨‹åºéƒ½ä¼šé»˜è®¤ä½¿ç”¨dyld 3. dyld 3æœ€æ—©æ˜¯åœ¨2017å¹´çš„iOS 11ä¸­å¼•å…¥ï¼Œä¸»è¦ç”¨æ¥ä¼˜åŒ–ç³»ç»Ÿåº“ã€‚ è€Œåœ¨iOS 13ç³»ç»Ÿä¸­ï¼ŒiOSå…¨é¢é‡‡ç”¨æ–°çš„dyld 3æ¥æ›¿ä»£ä¹‹å‰çš„dyld 2ï¼Œå› ä¸ºdyld 3å®Œå…¨å…¼å®¹dyld 2ï¼Œå…¶APIæ¥å£ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¹¶ä¸éœ€è¦åšé¢å¤–çš„é€‚é…å°±èƒ½å¹³æ»‘è¿‡æ¸¡ã€‚ ä¸ºä»€ä¹ˆéœ€è¦é‡æ–°è®¾è®¡dyld 2ï¼Œå½¢æˆæ–°çš„dyld 3 ï¼Ÿé‡æ–°è®¾è®¡dyldï¼Œä¸»è¦ä»ä»¥ä¸‹å‡ æ–¹é¢è¿›è¡Œè€ƒè™‘ é‡æ–°è®¾è®¡dyldï¼Œä¸»è¦ä»ä»¥ä¸‹å‡ æ–¹é¢è¿›è¡Œè€ƒè™‘ æ€§èƒ½ï¼šæƒ³è¦å°½å¯èƒ½çš„æé«˜å¯åŠ¨é€Ÿåº¦ å®‰å…¨æ€§ï¼šåœ¨dyld 2ä¸­å¢åŠ äº†å®‰å…¨ç‰¹æ€§ï¼Œä½†æ˜¯å¾ˆéš¾è·Ÿéšç°å®æƒ…å½¢ï¼Œè™½ç„¶åšäº†å¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯éš¾ä»¥å®ç°è¿™ä¸ªç›®æ ‡ å¯é æ€§å’Œå¯æµ‹è¯•æ€§ï¼šä¸ºæ­¤Appleå‘å¸ƒäº†å¾ˆå¤šä¸é”™çš„æµ‹è¯•æ¡†æ¶ï¼Œä¾‹å¦‚XCTestï¼Œä½†æ˜¯è¿™äº›æµ‹è¯•æ¡†æ¶ä¾èµ–äºåŠ¨æ€é“¾æ¥å™¨çš„åº•å±‚åŠŸèƒ½ï¼Œç„¶åå°†æµ‹è¯•æ¡†æ¶çš„åº“æ’å…¥è¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨äºæµ‹è¯•ç°æœ‰çš„dyldä»£ç ï¼Œä¸”éš¾ä»¥æµ‹è¯•å®‰å…¨æ€§å’Œæ€§èƒ½æ°´å¹³ å¦‚ä½•å°† dyld 2 æ”¹è¿›å’Œä¼˜åŒ–ä¸º dyld 3ï¼Ÿæ”¹è¿›å’Œä¼˜åŒ–å»ºè®® ä»ä¸Šé¢çš„dyld 2çš„å·¥ä½œæµç¨‹ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†dyld 2çš„æ‰§è¡Œæµç¨‹ï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢æ¥æ”¹è¿›å’Œä¼˜åŒ–ï¼š ç¡®å®šå®‰å…¨æ•æ„Ÿçš„éƒ¨åˆ† Parse mach-o headersè§£æmach-o å’Œ Find dependenciesæ‰¾åˆ°ä¾èµ–åº“ï¼Œæ˜¯å®‰å…¨æ•æ„Ÿéƒ¨åˆ†ï¼Œå³æœ€å¤§çš„å®‰å…¨éšæ‚£ä¹‹ä¸€ï¼› æ¶æ„æ’°æ”¹mach-oå¤´éƒ¨ï¼Œå¯ä»¥è¿›è¡ŒæŸäº›æ”»å‡»ï¼› å¦‚æœAppä½¿ç”¨äº† @rpaths å³æœç´¢è·¯å¾„ï¼Œå¯ä»¥é€šè¿‡æ¶æ„æ’°æ”¹è·¯å¾„æˆ–è€…å°†ä¸€äº›åº“æ’å…¥åˆ°ç‰¹å®šçš„ä½ç½®ï¼Œæ¥è¾¾åˆ°ç ´åç¨‹åºçš„ç›®çš„ï¼› ç¡®å®šå¤§é‡å ç”¨èµ„æºçš„éƒ¨åˆ†ï¼ˆå³å¯ç¼“å­˜éƒ¨åˆ†ï¼‰ Perform symbol lookupsç¬¦å·æŸ¥æ‰¾å°±æ˜¯å…¶ä¸­ä¸€ä¸ªï¼Œå› ä¸ºåœ¨ä¸€ä¸ªç‰¹å®šçš„åº“ä¸­ï¼Œé™¤éè¿›è¡Œè½¯ä»¶æ›´æ–°æˆ–è€…åœ¨ç£ç›˜ä¸Šæ›´æ”¹åº“ï¼Œä¸ç„¶ç¬¦å·å°†å§‹ç»ˆä½äºåº“ä¸­çš„ç›¸åŒçš„åç§»ä½ç½®ï¼ˆå³ç¬¦å·åç§»é‡å›ºå®šï¼‰ï¼› dyld 2 æ”¹è¿›å’Œä¼˜åŒ– ä»¥ä¸‹æ˜¯dyld 2 å‘ dyld 3 çš„ä¸€äº›æ”¹å˜ï¼Œä¸»è¦æ˜¯å°†å®‰å…¨æ•æ„Ÿçš„éƒ¨åˆ† å’Œ å ç”¨å¤§é‡èµ„æºçš„éƒ¨åˆ†ç§»åŠ¨åˆ°ä¸Šå±‚ï¼Œç„¶åå°†ä¸€ä¸ªclosureå†™å…¥ç£ç›˜è¿›è¡Œç¼“å­˜ï¼Œç„¶åæˆ‘ä»¬åœ¨ç¨‹åºè¿›ç¨‹ä¸­ä½¿ç”¨closureã€‚ä»¥ä¸‹æ˜¯å›¾ç¤º dyld 3 ç»„æˆéƒ¨åˆ†&#x2F;å·¥ä½œæµç¨‹ dyld 3çš„å·¥ä½œæµç¨‹ä¸»è¦åˆ†ä¸º3éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤º ç¬¬ä¸€éƒ¨åˆ†ï¼šout-of-process ï¼šmach-o parser è¿›ç¨‹å¤–çš„mach-oåˆ†æå™¨å’Œç¼–è¯‘å™¨ï¼Œæ˜¯æ™®é€šçš„åå°ç¨‹åºï¼Œç”¨äºæé«˜æµ‹è¯•åŸºç¡€æ¶æ„çš„æ€§èƒ½ã€‚ ç¬¬ä¸€éƒ¨åˆ†ä¸»è¦åœ¨Appè¿›ç¨‹ä¹‹å¤–åšä»¥ä¸‹å·¥ä½œï¼š è§£ææ‰€æœ‰æœç´¢è·¯å¾„@rpathã€ç¯å¢ƒå˜é‡ï¼Œå› ä¸ºå®ƒä»¬ä¼šå½±å“å¯åŠ¨é€Ÿåº¦ åˆ†æ mach-oäºŒè¿›åˆ¶æ•°æ® æ‰§è¡Œç¬¦å·æŸ¥æ‰¾ åˆ©ç”¨è¿™äº›ç»“æœåˆ›å»ºlaunch clourse ç¬¬äºŒéƒ¨åˆ†ï¼šin-process ï¼šengine è¿›ç¨‹å†…çš„å¼•æ“ï¼Œè¿™éƒ¨åˆ†å¸¸é©»åœ¨å†…å­˜ä¸­ï¼Œä¸”åœ¨dyld 3ä¸å†éœ€è¦åˆ†æmach-oæ–‡ä»¶å¤´æˆ–è€…æ‰§è¡Œç¬¦å·æŸ¥æ‰¾å°±å¯ä»¥å¯åŠ¨åº”ç”¨ï¼Œå› ä¸ºåˆ†æmach-oå’Œæ‰§è¡Œç¬¦å·æŸ¥æ‰¾éƒ½æ˜¯è€—æ—¶æ“ä½œï¼Œæ‰€ä»¥æå¤§çš„æé«˜äº†ç¨‹åºå¯åŠ¨é€Ÿåº¦ã€‚ ç¬¬äºŒéƒ¨åˆ†ä¸»è¦åœ¨Appè¿›ç¨‹ä¸­åšä»¥ä¸‹å·¥ä½œï¼š æ£€æŸ¥launch closureæ˜¯å¦æ­£ç¡® æ˜ å°„åˆ°dylibä¸­ï¼Œå†è·³è½¬mainå‡½æ•° ç¬¬ä¸‰éƒ¨åˆ†ï¼šlaunch closure ï¼šcache å¯åŠ¨é—­åŒ…launch closureç¼“å­˜æœåŠ¡ã€‚å…¶ä¸­å¤§å¤šæ•°ç¨‹åºå¯åŠ¨éƒ½ä¼šä½¿ç”¨ç¼“å­˜ï¼Œè€Œä¸éœ€è¦è°ƒç”¨è¿›ç¨‹å¤– mach-oåˆ†æå™¨å’Œç¼–è¯‘å™¨ã€‚ä¸”launch closureæ¯”mach-oæ›´ç®€å•ï¼Œå› ä¸ºlaunch closureæ˜¯å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œä¸éœ€è¦ç”¨å¤æ‚çš„æ–¹æ³•è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œç®€å•çš„æ ¡éªŒï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜é€Ÿåº¦ ç³»ç»Ÿåº”ç”¨çš„launch closureç›´æ¥åŠ å…¥åˆ°å…±äº«ç¼“å­˜ share cache å¯¹äºç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæˆ‘ä»¬å°†åœ¨åº”ç”¨å®‰è£…æˆ–è€…æ›´æ–°æœŸé—´æ„å»ºlaunch closureï¼Œå› ä¸ºæ­¤æ—¶ system libraryå·²å‘ç”Ÿæ›´æ”¹ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨iOSï¼ŒtvOSå’ŒwatchOSä¸Šï¼Œè¿™äº›æ“ä½œéƒ½å°†åœ¨è¿è¡Œä¹‹å‰ä¸ºæ‚¨é¢„å…ˆæ„å»ºã€‚ åœ¨macOSä¸Šï¼Œç”±äºå¯ä»¥ä¾§å‘åŠ è½½åº”ç”¨ç¨‹åº(è¿™é‡Œåº”è¯¥æ˜¯æŒ‡éApp Storeå®‰è£…çš„åº”ç”¨)ï¼Œå› æ­¤å¦‚æœéœ€è¦ï¼Œin-process engineå¯ä»¥åœ¨é¦–æ¬¡å¯åŠ¨æ—¶RPC(Remote Procedure Call)åˆ°out to the daemonï¼Œç„¶åï¼Œå®ƒå°±å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„closureäº†ã€‚ æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼Œdyld 3 æŠŠå¾ˆå¤šè€—æ—¶çš„æŸ¥æ‰¾ã€è®¡ç®—å’Œ I&#x2F;O æ“ä½œéƒ½é¢„å…ˆå¤„ç†å¥½äº†ï¼Œä½¿å¾—å¯åŠ¨é€Ÿåº¦æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚å³dyld 3æŠŠå¾ˆå¤šè€—æ—¶çš„æ“ä½œéƒ½æå‰å¤„ç†å¥½äº†ï¼Œæå¤§æå‡äº†å¯åŠ¨é€Ÿåº¦ã€‚ å¯åŠ¨é—­åŒ…ï¼ˆlaunch closureï¼‰è¿™æ˜¯ä¸€ä¸ªæ–°å¼•å…¥çš„æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ app åœ¨å¯åŠ¨æœŸé—´æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ¯”å¦‚è¿™ä¸ª app ä½¿ç”¨äº†å“ªäº›åŠ¨æ€é“¾æ¥åº“ï¼Œå…¶ä¸­å„ä¸ªç¬¦å·çš„åç§»é‡ï¼Œä»£ç ç­¾ååœ¨å“ªé‡Œç­‰ç­‰ã€‚ dyld 3ç¬¦å·ç¼ºå¤±é—®é¢˜ dyld 2ä¸­é»˜è®¤é‡‡å–çš„æ˜¯lazy symbolçš„ç¬¦å·åŠ è½½æ–¹å¼ dyld 3ä¸­ï¼Œåœ¨appå¯åŠ¨ä¹‹å‰ï¼Œç¬¦å·è§£æçš„ç»“æœå·²ç»åœ¨launch closureå†…äº†ï¼Œæ‰€ä»¥lazy symbolå°±ä¸å†éœ€è¦äº†ã€‚ å¦‚æœæ­¤æ—¶ï¼Œå¦‚æœæœ‰ç¬¦å·ç¼ºå¤±çš„æƒ…å†µï¼Œdyld 2 å’Œ dyld 3çš„è¡¨ç°æ˜¯ä¸åŒçš„ dyld 2ä¸­ï¼Œé¦–æ¬¡è°ƒç”¨ç¼ºå¤±ç¬¦å·æ—¶Appä¼šcrash åœ¨dyld 3ä¸­ï¼Œç¼ºå¤±ç¬¦å·ä¼šå¯¼è‡´Appä¸€å¯åŠ¨å°±ä¼šcrash æ€»ç»“dyld 2å·¥ä½œæµç¨‹ è§£æmach-oå¤´éƒ¨ æŸ¥æ‰¾ä¾èµ–åº“ æ˜ å°„mach-oæ–‡ä»¶ï¼Œæ”¾å…¥åœ°å€ç©ºé—´ä¸­ æ‰§è¡Œç¬¦å·æŸ¥æ‰¾ ä½¿ç”¨ASLRè¿›è¡Œrebaseå’Œbindç»‘å®š è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–å™¨ æ‰§è¡Œmainå‡½æ•° dyld 3å·¥ä½œæµç¨‹ è¿›ç¨‹å¤–ï¼šå°†dyld 2ä¸­çš„mach-oå¤´éƒ¨è§£æã€ç¬¦å·æŸ¥æ‰¾ç§»åˆ°äº†è¿›ç¨‹å¤–æ‰§è¡Œï¼Œä¸”å°†å…¶æ‰§è¡Œç»“æœæ”¾å…¥å¯åŠ¨é—­åŒ…ï¼Œå­˜å‚¨åˆ°ç£ç›˜ä¸­ è¿›ç¨‹å†…ï¼šéªŒè¯å¯åŠ¨é—­åŒ…æ­£ç¡®æ€§ï¼Œå¹¶æ˜ å°„dylibï¼Œæ‰§è¡Œmainå‡½æ•° å¯åŠ¨é—­åŒ…ç¼“å­˜æœåŠ¡","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†14-1ï¼šobjc-msgSendç¼“å­˜æŸ¥æ‰¾(å¿«é€ŸæŸ¥æ‰¾)æ±‡ç¼–åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-1ï¼šobjc-msgSendç¼“å­˜æŸ¥æ‰¾(å¿«é€ŸæŸ¥æ‰¾)æ±‡ç¼–åˆ†æ","date":"2023-02-25T10:38:26.000Z","updated":"2023-02-25T18:30:49.495Z","comments":true,"path":"2023/02/25/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-1ï¼šobjc-msgSendç¼“å­˜æŸ¥æ‰¾(å¿«é€ŸæŸ¥æ‰¾)æ±‡ç¼–åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2023/02/25/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8614-1%EF%BC%9Aobjc-msgSend%E7%BC%93%E5%AD%98%E6%9F%A5%E6%89%BE(%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE)%E6%B1%87%E7%BC%96%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼šæ¶ˆæ¯å‘é€objc-msgSend å†…éƒ¨å…ˆè¿›è¡Œ å¿«é€ŸæŸ¥æ‰¾ å³ ç¼“å­˜ï¼ˆCacheLookupï¼‰æŸ¥æ‰¾ æœ¬æ–‡ä¸»è¦ç»§ä¸Šä¸€ç«  objc_msgSend å¼•ç”³ï¼Œobjc_msgSend æ˜¯ç”¨æ±‡ç¼–å†™çš„ï¼Œå› ä¸ºæ€§èƒ½å¥½ã€é€Ÿåº¦å¿« æ±‡ç¼–çš„ç‰¹æ€§ï¼šå¿« + åŠ¨æ€æ€§ï¼ˆä¸ç¡®å®šï¼‰ objc_msgSend æ±‡ç¼–æŸ¥æ‰¾æµç¨‹åˆ†æåœ¨ objc4-781æºç  ä¸­ï¼Œæœç´¢ objc_msgSendï¼Œç”±äºæˆ‘ä»¬æ—¥å¸¸å¼€å‘çš„éƒ½æ˜¯æ¶æ„ arm64ï¼Œæ‰€ä»¥éœ€è¦æ‰¾åˆ° objc-msgSend-arm64.s æ–‡ä»¶ï¼Œ objc_msgSend æºç å®ç°çš„å…¥å£æ˜¯åœ¨ ENTRY _objc_msgSend è¿™ä¸ªæ–‡ä»¶ä¸‹ï¼Œå‘ç°æ˜¯ æ±‡ç¼–å®ç°ã€‚ objc_msgSend æ±‡ç¼–æºç  objc_msgSend æ˜¯æ¶ˆæ¯å‘é€çš„æºç çš„å…¥å£ï¼Œå…¶ä½¿ç”¨ æ±‡ç¼– å®ç°çš„ï¼Œ_objc_msgSend æºç å®ç°å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364// æ¶ˆæ¯å‘é€ -&gt; æ±‡ç¼–å…¥å£ -&gt; _objc_msgSendä¸»è¦æ˜¯æ‹¿åˆ°æ¥æ”¶è€…çš„isaä¿¡æ¯ENTRY _objc_msgSend // æ— çª—å£ UNWIND _objc_msgSend, NoFrame /* p0å’Œç©ºå¯¹æ¯”ï¼Œå³åˆ¤æ–­receiveræ˜¯å¦å­˜åœ¨ å…¶ä¸­p0ï¼ˆæ¶ˆæ¯æ¥æ”¶è€…ï¼‰æ˜¯objc_msgSendçš„ç¬¬ä¸€ä¸ªå‚æ•° */ cmp p0, #0 // nil check and tagged pointer check// æ˜¯å¦æ”¯æŒ tagged pointers å°å¯¹è±¡ç±»å‹#if SUPPORT_TAGGED_POINTERS // le-å°äºï¼Œ å°å¯¹è±¡æˆ–ç©ºåˆ¤æ–­ b.le LNilOrTagged // (MSB tagged pointer looks negative)#else // å¦åˆ™ // eq-ç­‰äºï¼Œp0ç­‰äº0æ—¶ï¼Œç›´æ¥è¿”å›ç©º b.eq LReturnZero#endif // p0å³receiverè‚¯å®šå­˜åœ¨çš„æµç¨‹ // æ ¹æ®å¯¹è±¡æ‹¿å‡ºisaï¼Œå³ä»x0å¯„å­˜å™¨æŒ‡å‘çš„åœ°å€ å–å‡º isaï¼Œå­˜å…¥p13å¯„å­˜å™¨ ldr p13, [x0] // p13 = isa // åœ¨ram64æ¶æ„ä¸‹é€šè¿‡ p16 = isaï¼ˆp13ï¼‰&amp; ISA_MASKï¼Œæ‹¿å‡ºshiftclsä¿¡æ¯ï¼Œå¾—åˆ°classä¿¡æ¯ GetClassFromIsa_p16 p13 // p16 = class// è·å–isaå®Œæ¯•LGetIsaDone: // calls imp or objc_msgSend_uncached // å¼€å¯ç¼“å­˜æŸ¥æ‰¾æµç¨‹ï¼Œå³å¿«é€ŸæŸ¥æ‰¾æµç¨‹ CacheLookup NORMAL, _objc_msgSend#if SUPPORT_TAGGED_POINTERS// å°å¯¹è±¡æˆ–è€…ç©ºåˆ¤æ–­LNilOrTagged: // ç›´æ¥è¿”å›ç©º b.eq LReturnZero // nil check // tagged adrp x10, _objc_debug_taggedpointer_classes@PAGE add x10, x10, _objc_debug_taggedpointer_classes@PAGEOFF ubfx x11, x0, #60, #4 ldr x16, [x10, x11, LSL #3] adrp x10, _OBJC_CLASS_$___NSUnrecognizedTaggedPointer@PAGE add x10, x10, _OBJC_CLASS_$___NSUnrecognizedTaggedPointer@PAGEOFF cmp x10, x16 b.ne LGetIsaDone // ext tagged adrp x10, _objc_debug_taggedpointer_ext_classes@PAGE add x10, x10, _objc_debug_taggedpointer_ext_classes@PAGEOFF ubfx x11, x0, #52, #8 ldr x16, [x10, x11, LSL #3] b LGetIsaDone// SUPPORT_TAGGED_POINTERS#endifLReturnZero: // x0 is already zero mov x1, #0 movi d0, #0 movi d1, #0 movi d2, #0 movi d3, #0 ret END_ENTRY _objc_msgSend ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥ï¼š ã€ç¬¬ä¸€æ­¥ã€‘åˆ¤æ–­ objc_msgSend æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° receiver æ˜¯å¦ä¸ºç©º å¦‚æœæ”¯æŒ tagged pointer å°å¯¹è±¡ï¼Œè·³è½¬è‡³ LNilOrTagged å¦‚æœ å°å¯¹è±¡ ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›ç©ºï¼Œå³ LReturnZero å¦‚æœ å°å¯¹è±¡ ä¸ä¸ºç©ºï¼Œåˆ™å¤„ç†å°å¯¹è±¡çš„ isaï¼Œèµ°åˆ°ã€ç¬¬äºŒæ­¥ã€‘ å¦‚æœ æ—¢ä¸æ˜¯å°å¯¹è±¡ï¼Œreceiver ä¹Ÿä¸ä¸ºç©ºï¼Œæœ‰ä»¥ä¸‹ä¸¤æ­¥ ä» receiver ä¸­å–å‡º isa å­˜å…¥ p13 å¯„å­˜å™¨ é€šè¿‡ GetClassFromIsa_p16 ä¸­ï¼Œarm64 æ¶æ„ä¸‹é€šè¿‡ isa &amp; ISA_MASK è·å– shiftcls ä½åŸŸçš„ç±»ä¿¡æ¯ï¼Œå³ classï¼ŒGetClassFromIsa_p16 çš„æ±‡ç¼–å®ç°å¦‚ä¸‹ï¼Œç„¶åèµ°åˆ°ã€ç¬¬äºŒæ­¥ã€‘ ã€ç¬¬äºŒæ­¥ã€‘å¦‚æœè·å¾— isa æŒ‡é’ˆ å¦‚æœæœ‰ isaï¼Œèµ°åˆ° CacheLookupï¼Œå³ç¼“å­˜æŸ¥æ‰¾æµç¨‹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ sel-imp å¿«é€ŸæŸ¥æ‰¾æµç¨‹ 123456789101112131415161718192021222324252627282930313233.macro GetClassFromIsa_p16 /* src */// æ­¤å¤„ç”¨äºwatchOS#if SUPPORT_INDEXED_ISA // Indexed isa // å°†isaçš„å€¼å­˜å…¥p16å¯„å­˜å™¨ mov p16, $0 // optimistically set dst = src // åˆ¤æ–­æ˜¯å¦æ˜¯ non-pointer isa tbz p16, #ISA_INDEX_IS_NPI_BIT, 1f // done if not non-pointer isa // isa in p16 is indexed // å°†_objc_indexed_classes æ‰€åœ¨çš„é¡µçš„åŸºå€ è¯»å…¥åˆ°x10å¯„å­˜å™¨ adrp x10, _objc_indexed_classes@PAGE // x10 = x10 + _objc_indexed(pageä¸­çš„åç§»é‡) -x10åŸºå€æ ¹æ®åç§»é‡è¿›è¡Œå†…å­˜åç§» add x10, x10, _objc_indexed_classes@PAGEOFF // ä»p16çš„ç¬¬ISA_INDEX_SHIFTä½å¼€å§‹ï¼Œæå– ISA_INDEX_BITSä½åˆ°p16å¯„å­˜å™¨ï¼Œå‰©ä½™çš„é«˜ä½ç”¨0è¡¥å…… ubfx p16, p16, #ISA_INDEX_SHIFT, #ISA_INDEX_BITS // extract index ldr p16, [x10, p16, UXTP #PTRSHIFT] // load class from array1:// ç”¨äº64ä½ç³»ç»Ÿ#elif __LP64__ // 64-bit packed isa // p16 = class = isa &amp; ISA_MASKï¼ˆä½è¿ç®— &amp; å³è·å–isaä¸­çš„shiftclsä¿¡æ¯ï¼‰ and p16, $0, #ISA_MASK#else // 32-bit raw isa // ç”¨äº32ä½ç³»ç»Ÿ mov p16, $0#endif.endmacro objc_msgSend ç¼“å­˜ï¼ˆCacheLookupï¼‰æŸ¥æ‰¾æ±‡ç¼–æµç¨‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170.macro CacheLookup // // Restart protocol: // // As soon as we&#x27;re past the LLookupStart$1 label we may have loaded // an invalid cache pointer or mask. // // When task_restartable_ranges_synchronize() is called, // (or when a signal hits us) before we&#x27;re past LLookupEnd$1, // then our PC will be reset to LLookupRecover$1 which forcefully // jumps to the cache-miss codepath which have the following // requirements: // // GETIMP: // The cache-miss is just returning NULL (setting x0 to 0) // // NORMAL and LOOKUP: // - x0 contains the receiver // - x1 contains the selector // - x16 contains the isa // - other registers are set as per calling conventions //LLookupStart$1: // p1 = SEL, p16 = isaï¼Œ#define CACHEï¼ˆ2 * __SIZEOF_POINER__ï¼‰ï¼Œå…¶ä¸­__SIZEOF_POINTER__è¡¨ç¤ºpointerçš„å¤§å° ï¼Œå³ 2*8 = 16 // p11 = mask | bucketsï¼Œä»x16ï¼ˆå³isaï¼‰ä¸­å¹³ç§»16å­—èŠ‚ï¼Œå–å‡ºcacheå­˜å…¥p11å¯„å­˜å™¨ï¼Œisaè·ç¦»cacheæ­£å¥½16å­—èŠ‚ï¼šisaï¼ˆ8å­—èŠ‚ï¼‰ï¼ŒsuperClassï¼ˆ8å­—èŠ‚ï¼‰ï¼Œcacheï¼ˆmaské«˜16ä½ + bucketsä½48ä½ï¼‰ ldr p11, [x16, #CACHE] // 64ä½çœŸæœº#if CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_HIGH_16 // p11(cache) &amp; 0x0000ffffffffffff ï¼Œmaské«˜16ä½æŠ¹é›¶ï¼Œå¾—åˆ°buckets å­˜å…¥p10å¯„å­˜å™¨ï¼Œå³å»æ‰maskï¼Œç•™ä¸‹buckets and p10, p11, #0x0000ffffffffffff // p10 = buckets /* 1ï¼‰å…ˆå°†p11(cache)å³ç§»48ä½ï¼Œå¾—åˆ°mask(å³p11 å­˜å‚¨mask) 2ï¼‰mask &amp; p1ï¼ˆmsgSendçš„ç¬¬äºŒä¸ªå‚æ•° cmd-selï¼‰ï¼Œå¾—åˆ°sel-impçš„ä¸‹è¡¨index(å³æœç´¢ä¸‹æ ‡) 3ï¼‰å­˜å…¥p12(cache insertå†™å…¥æ—¶çš„å“ˆå¸Œä¸‹æ ‡è®¡ç®—æ˜¯ é€šè¿‡ sel &amp; maskï¼Œè¯»å–æ—¶ä¹Ÿè¦ç”¨è¿™ç§æ–¹å¼) */ and p12, p1, p11, LSR #48 // x12 = _cmd &amp; mask // é64ä½çœŸæœº#elif CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_LOW_4 and p10, p11, #~0xf // p10 = buckets and p11, p11, #0xf // p11 = maskShift mov p12, #0xffff lsr p11, p12, p11 // p11 = mask = 0xffff &gt;&gt; p11 and p12, p1, p11 // x12 = _cmd &amp; mask#else#error Unsupported cache mask storage for ARM64.#endif /* 1) p12æ˜¯ä¸‹æ ‡ï¼Œp10æ˜¯bucketsæ•°ç»„é¦–åœ°å€ï¼Œä¸‹æ ‡ * 1&lt;&lt;4(å³16)å¾—åˆ°å®é™…å†…å­˜çš„åç§»é‡ï¼Œé€šè¿‡bucketsçš„é¦–åœ°å€åç§»ï¼Œè·å–bucketå­˜å…¥p12å¯„å­˜å™¨ 2) LSL #(1+PTRSHIFT) å®é™…å«ä¹‰å°±æ˜¯å¾—åˆ°ä¸€ä¸ªbucketå ç”¨å†…å­˜å¤§å°ï¼Œç›¸å½“äºmask = occupied - 1ï¼Œ_cmd &amp; maskï¼Œå–ä½™æ•° */ add p12, p10, p12, LSL #(1+PTRSHIFT) // p12 = buckets + ((_cmd &amp; mask) &lt;&lt; (1+PTRSHIFT)) // ä»x12ï¼ˆå³p12ï¼‰ä¸­å–å‡ºbucketï¼Œåˆ†åˆ«å°†impå’Œselå­˜å…¥ p17ï¼ˆå­˜å‚¨impï¼‰ å’Œ p9ï¼ˆå­˜å‚¨selï¼‰ ldp p17, p9, [x12] // &#123;imp, sel&#125; = *bucket // æ¯”è¾ƒ sel å’Œ p1ï¼ˆå”‡ä¹³çš„å‚æ•°cmdï¼‰1: cmp p9, p1 // if (bucket-&gt;sel != _cmd) // å¦‚æœä¸ç›¸ç­‰ï¼Œå³æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯·è·³è½¬è‡³2f b.ne 2f // scan more // å¦‚æœç›¸ç­‰ï¼Œå³CacheHit ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å› imp CacheHit $0 // call or return imp 2: // not hit: p12 = not-hit bucket // å¦‚æœä¸€ç›´éƒ½æ‰¾ä¸åˆ°ï¼Œå› ä¸ºæ˜¯normalï¼Œè·³è½¬è‡³__objc_msgSend_uncached CheckMiss $0 // miss if bucket-&gt;sel == 0 // åˆ¤æ–­p12ï¼ˆä¸‹æ ‡å¯¹åº”çš„bucketï¼‰æ˜¯å¦ç­‰äºp10ï¼ˆbucketsæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¦‚æœç­‰äºåˆ™è·³è½¬è‡³3f cmp p12, p10 // wrap if bucket == buckets // å®šä½åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆå³ç¬¬ä¸€ä¸ªbucketï¼‰ b.eq 3f // ä»x12ï¼ˆå³p12 bucketsé¦–åœ°å€ï¼‰ï¼Œå®é™…éœ€è¦å¹³ç§»çš„å†…å­˜å¤§å°BUCKET_SIZE,å¾—åˆ°ç¬¬äºŒä¸ªbucketå…ƒç´ ï¼Œimp-selåˆ†åˆ«å­˜å…¥p17-p9ï¼Œå³å‘å‰æŸ¥æ‰¾ ldp p17, p9, [x12, #-BUCKET_SIZE]! // &#123;imp, sel&#125; = *--bucket // æŒ‘æˆ˜è‡³ç¬¬1æ­¥ï¼Œç»§ç»­å¯¹æ¯” selä¸cmd b 1b // loop3: // wrap: p12 = first bucket, w11 = mask#if CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_HIGH_16 /* 1) äººä¸ºè®¾å€¼åˆ°æœ€åä¸€ä¸ªå…ƒç´  2) p11(mask)å³ç§»44ä½ï¼Œç›¸å½“äºmaskå·¦ç§»4ä½ï¼Œç›´æ¥å®šä½åˆ°bucketsçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç¼“å­˜æŸ¥æ‰¾é¡ºåºæ˜¯å‘å‰æŸ¥æ‰¾ */ add p12, p12, p11, LSR #(48 - (1+PTRSHIFT)) // p12 = buckets + (mask &lt;&lt; 1+PTRSHIFT)#elif CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_LOW_4 add p12, p12, p11, LSL #(1+PTRSHIFT) // p12 = buckets + (mask &lt;&lt; 1+PTRSHIFT)#else#error Unsupported cache mask storage for ARM64.#endif // Clone scanning loop to miss instead of hang when cache is corrupt. // The slow path may detect any corruption and halt later. // å†æŸ¥æ‰¾ä¸€éç¼“å­˜ï¼ˆï¼‰ // æ‹¿åˆ°x12(å³p12) bucketä¸­çš„ imp-sel åˆ†åˆ«å­˜å…¥ p17-p9 ldp p17, p9, [x12] // &#123;imp, sel&#125; = *bucket// æ¯”è¾ƒ sel ä¸ p1ï¼ˆä¼ å…¥çš„å‚æ•°cmdï¼‰1: cmp p9, p1 // if (bucket-&gt;sel != _cmd) // å¦‚æœä¸ç›¸ç­‰ï¼Œå³èµ°åˆ°ç¬¬äºŒæ­¥ b.ne 2f // scan more // å¦‚æœç›¸ç­‰ï¼Œå³å‘½ä¸­ï¼Œç›´æ¥è¿”å›imp CacheHit $0 // call or return imp 2: // not hit: p12 = not-hit bucket // å¦‚æœä¸€ç›´æ‰¾ä¸åˆ°ï¼Œåˆ™CheckMiss CheckMiss $0 // miss if bucket-&gt;sel == 0 // åˆ¤æ–­p12ï¼ˆä¸‹æ ‡å¯¹åº”çš„bucketï¼‰æ˜¯å¦ç­‰äºp10ï¼ˆbucketsæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¡¨ç¤ºå‰é¢å·²ç»æ²¡æœ‰äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ° cmp p12, p10 // wrap if bucket == buckets // å¦‚æœç­‰äºï¼Œè·³è½¬è‡³ç¬¬3æ­¥ b.eq 3f // ä»x12ï¼ˆå³p12 bucketsé¦–åœ°å€ï¼‰ï¼Œå®é™…éœ€è¦å¹³ç§»çš„å†…å­˜å¤§å°BUCKET_SIZEï¼Œå¾—åˆ°ç¬¬äºŒä¸ªbucketå…ƒç´ ï¼Œimp-selåˆ†åˆ«å­˜å…¥p17-p9ï¼Œå³å‘å‰æŸ¥æ‰¾ ldp p17, p9, [x12, #-BUCKET_SIZE]! // &#123;imp, sel&#125; = *--bucket // è·³è½¬è‡³ç¬¬1æ­¥ï¼Œç»§ç»­å¯¹æ¯” selä¸imp b 1b // loopLLookupEnd$1:LLookupRecover$1:3: // double wrap // è·³è½¬è‡³JumpMiss å› ä¸ºæ˜¯normalï¼Œè·³è½¬è‡³__objc_msgSend_uncached JumpMiss $0.endmacro// ä»¥ä¸‹æ˜¯æœ€åè·³è½¬çš„æ±‡ç¼–å‡½æ•°.macro CacheHit.if $0 == NORMAL TailCallCachedImp x17, x12, x1, x16 // authenticate and call imp.elseif $0 == GETIMP mov p0, p17 cbz p0, 9f // don&#x27;t ptrauth a nil imp AuthAndResignAsIMP x0, x12, x1, x16 // authenticate imp and re-sign as IMP9: ret // return IMP.elseif $0 == LOOKUP // No nil check for ptrauth: the caller would crash anyway when they // jump to a nil IMP. We don&#x27;t care if that jump also fails ptrauth. AuthAndResignAsIMP x17, x12, x1, x16 // authenticate imp and re-sign as IMP ret // return imp via x17.else.abort oops.endif.endmacro.macro CheckMiss // miss if bucket-&gt;sel == 0.if $0 == GETIMP // å¦‚æœä¸ºGETIMPï¼Œè·³è½¬è‡³LGetImpMiss cbz p9, LGetImpMiss.elseif $0 == NORMAL // å¦‚æœä¸ºNORMALï¼Œè·³è½¬è‡³__objc_msgSend_uncached cbz p9, __objc_msgSend_uncached.elseif $0 == LOOKUP // å¦‚æœä¸ºLOOKUPï¼Œè·³è½¬è‡³__objc_msgLookup_uncached cbz p9, __objc_msgLookup_uncached.else.abort oops.endif.endmacro.macro JumpMiss.if $0 == GETIMP b LGetImpMiss.elseif $0 == NORMAL b __objc_msgSend_uncached.elseif $0 == LOOKUP b __objc_msgLookup_uncached.else.abort oops.endif.endmacro ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š ã€ç¬¬ä¸€æ­¥ã€‘é€šè¿‡ cache é¦–åœ°å€å¹³ç§» 16 å­—èŠ‚ï¼ˆå› ä¸ºåœ¨objc_classä¸­ï¼‰ï¼Œé¦–åœ°å€ è·ç¦» cache æ­£å¥½ 16 å­—èŠ‚ï¼Œå³ isaé¦–åœ°å€ å  8 å­—èŠ‚ï¼ŒsuperClasså  8 å­—èŠ‚ï¼‰ï¼Œè·å– cacheï¼Œcacheä¸­ é«˜16ä½å­˜maskï¼Œä½48ä½å­˜bucketsï¼Œå³ p11 = cacheã€‚ ã€ç¬¬äºŒæ­¥ã€‘ä»cacheä¸­åˆ†åˆ«å–å‡º bucketså’Œmask,å¹¶ç”±maskæ ¹æ®å“ˆå¸Œç®—æ³•è®¡ç®—å‡ºå“ˆå¸Œä¸‹æ ‡ é€šè¿‡ cache å’Œ æ©ç ï¼ˆå³0x0000ffffffffffffï¼‰çš„ &amp; è¿ç®—ï¼Œå°† é«˜16ä½maskæŠ¹é›¶ï¼Œå¾—åˆ°bucketsæŒ‡é’ˆåœ°å€ï¼Œå³ p10 = buckets å°† cache å³ç§» 48 ä½ï¼Œå¾—åˆ° maskï¼Œå³ p11 = mask å°† objc_msgSend çš„å‚æ•° p1 (å³ç¬¬äºŒä¸ªå‚æ•°_cmd) &amp; maskï¼Œé€šè¿‡ å“ˆå¸Œç®—æ³•ï¼Œå¾—åˆ°éœ€è¦æŸ¥æ‰¾å­˜å‚¨ sel-imp çš„ bucketä¸‹æ ‡indexï¼Œå³ p12 = index = _cmd &amp; maskï¼Œä¸ºä»€ä¹ˆé€šè¿‡è¿™ç§æ–¹å¼å‘¢ï¼Ÿå› ä¸ºåœ¨ å­˜å‚¨sel-impæ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡åŒæ · å“ˆå¸Œç®—æ³•è®¡ç®—å“ˆå¸Œä¸‹æ ‡è¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥ è¯»å– ä¹Ÿéœ€è¦é€šè¿‡åŒæ ·çš„æ–¹å¼è¯»å–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567// Class points to cache. SEL is key. Cache buckets store SEL+IMP.// Caches are never built in the dyld shared cache.static inline mask_t cache_hash(SEL sel, mask_t mask) &#123; return (mask_t)(uintptr_t)sel &amp; mask;&#125; ã€ç¬¬ä¸‰æ­¥ã€‘æ ¹æ®æ‰€å¾—çš„ å“ˆå¸Œä¸‹æ ‡Index å’Œ bucketsé¦–åœ°å€ï¼Œå–å‡ºå“ˆå¸Œä¸‹æ ‡å¯¹åº”çš„ bucket å…¶ä¸­ PTRSHIFT ç­‰äº 3ï¼Œå·¦ç§» 4 ä½ï¼ˆå³2^4 &#x3D; 16å­—èŠ‚ï¼‰çš„ç›®çš„æ˜¯è®¡ç®—å‡ºä¸€ä¸ª bucket å®é™…å ç”¨çš„å¤§å°ï¼Œç»“æ„ä½“ bucket_t ä¸­ sel å  8 å­—èŠ‚ï¼Œimp å  8 å­—èŠ‚ æ ¹æ®è®¡ç®—çš„å“ˆå¸Œä¸‹æ ‡ indexä¹˜ä»¥å•ä¸ªbucketå ç”¨çš„å†…å­˜å¤§å° ï¼Œå¾—åˆ° buckets é¦–åœ°å€åœ¨ å®é™…å†…å­˜ä¸­çš„åç§»é‡ é€šè¿‡ é¦–åœ°å€+å®é™…åç§»é‡ï¼Œè·å–å“ˆå¸Œä¸‹æ ‡indexå¯¹åº”çš„ bucket ã€ç¬¬å››æ­¥ã€‘æ ¹æ®è·å–çš„ bucketï¼Œå–å‡ºå…¶ä¸­çš„ imp å­˜å…¥ p17ï¼Œå³ p17 = impï¼Œå–å‡º sel å­˜å…¥ p9ï¼Œå³ p9 = sel ã€ç¬¬äº”æ­¥ã€‘ç¬¬ä¸€æ¬¡é€’å½’å¾ªç¯ æ¯”è¾ƒè·å–çš„ bucket ä¸­ sel ä¸ objc_msgSend çš„ç¬¬äºŒä¸ªå‚æ•°çš„ _cmd(å³p1) æ˜¯å¦ç›¸ç­‰ å¦‚æœç›¸ç­‰ï¼Œåˆ™ç›´æ¥è·³è½¬è‡³ CacheHitï¼Œå³ ç¼“å­˜å‘½ä¸­ï¼Œè¿”å› imp å¦‚æœä¸ç›¸ç­‰ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µ å¦‚æœä¸€ç›´éƒ½æ‰¾ä¸åˆ°ï¼Œç›´æ¥è·³è½¬è‡³ CheckMissï¼Œå› ä¸º $0 æ˜¯ normalï¼Œä¼šè·³è½¬è‡³ __objc_msgSend_uncachedï¼Œå³è¿›å…¥ æ…¢é€ŸæŸ¥æ‰¾æµç¨‹ å¦‚æœ æ ¹æ®indexè·å–çš„bucket ç­‰äº bucketsçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ äººä¸º çš„å°† å½“å‰bucketè®¾ç½®ä¸ºbucketsçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆé€šè¿‡ bucketsé¦–åœ°å€+maskå³ç§»44ä½ï¼ˆç­‰åŒäºå·¦ç§»4ä½ï¼‰ç›´æ¥ å®šä½åˆ°buckerçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œç„¶åç»§ç»­è¿›è¡Œé€’å½’å¾ªç¯ï¼ˆç¬¬ä¸€ä¸ª é€’å½’å¾ªç¯åµŒå¥— ç¬¬äºŒä¸ª é€’å½’å¾ªç¯ï¼‰ï¼Œå³ã€ç¬¬å…­æ­¥ã€‘ å¦‚æœ å½“å‰bucket ä¸ç­‰äº bucketsçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç»§ç»­ å‘å‰æŸ¥æ‰¾ï¼Œè¿›å…¥ ç¬¬ä¸€æ¬¡é€’å½’å¾ªç¯ ã€ç¬¬å…­æ­¥ã€‘ç¬¬äºŒæ¬¡é€’å½’å¾ªç¯ï¼šé‡å¤ã€ç¬¬äº”æ­¥ã€‘çš„æ“ä½œï¼Œä¸ã€ç¬¬äº”æ­¥ã€‘ä¸­å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œå¦‚æœ å½“å‰çš„bucketè¿˜æ˜¯ç­‰äº bucketsçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç›´æ¥è·³è½¬è‡³ JumpMissï¼Œæ­¤æ—¶çš„ $0 æ˜¯ normalï¼Œä¹Ÿæ˜¯ç›´æ¥è·³è½¬è‡³ __objc_msgSend_uncachedï¼Œå³è¿›å…¥ æ…¢é€ŸæŸ¥æ‰¾æµç¨‹ ä»¥ä¸‹æ˜¯æ•´ä¸ª å¿«é€ŸæŸ¥æ‰¾ è¿‡ç¨‹ å€¼çš„å˜åŒ– è¿‡ç¨‹ objc_msgSendé€šè¿‡ä¼ªä»£ç å®ç°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950#include &lt;stdio.h&gt;// æŸ¥æ‰¾ imp impå­˜å‚¨åœ¨ cache çš„ bucket ä¸‹[person sayNB] -&gt; imp ( cache -&gt; bucket (sel imp))// è·å–å½“å‰çš„å¯¹è±¡id person = 0x10000// è·å–isaisa_t isa = 0x000000// isa -&gt; class -&gt; cachecache_t cache = isa + 16å­—èŠ‚// arm64// mask|buckets åœ¨ä¸€èµ·çš„buckets = cache &amp; 0x0000ffffffffffff// è·å–maskmask = cache LSR #48// ä¸‹æ ‡ = mask &amp; selindex = mask &amp; p1// bucket ä» buckets éå†çš„å¼€å§‹ (èµ·å§‹æŸ¥è¯¢çš„bucket)bucket = buckets + index * 16 (sel imp = 16)int count = 0// CheckMiss $0do&#123; if ((bucket == buckets) &amp;&amp; (count == 0))&#123; // è¿›å…¥ç¬¬äºŒå±‚åˆ¤æ–­ // bucket == ç¬¬ä¸€ä¸ªå…ƒç´  // bucketäººä¸ºè®¾ç½®åˆ°æœ€åä¸€ä¸ªå…ƒç´  bucket = buckets + mask * 16 count++; &#125;else if (count == 1) goto CheckMiss // &#123;imp, sel&#125; = *--bucket // ç¼“å­˜çš„æŸ¥æ‰¾çš„é¡ºåºæ˜¯: å‘å‰æŸ¥æ‰¾ bucket--; imp = bucket.imp; sel = bucket.sel; &#125;while (bucket.sel != _cmd) // // bucketé‡Œé¢çš„sel æ˜¯å¦åŒ¹é…_cmd// CacheHit $0return impCheckMiss: CheckMiss(normal) ç»“å°¾ åœ¨ ç¼“å­˜ï¼ˆCacheLookupï¼‰æŸ¥æ‰¾ è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°ï¼Œæ— è®ºæ˜¯èµ°åˆ° CheckMiss è¿˜æ˜¯ JumpMissï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ° __objc_msgSend_uncached æ±‡ç¼–å‡½æ•° CheckMissæºç  123456789101112.macro CheckMiss // miss if bucket-&gt;sel == 0.if $0 == GETIMP cbz p9, LGetImpMiss.elseif $0 == NORMAL cbz p9, __objc_msgSend_uncached.elseif $0 == LOOKUP cbz p9, __objc_msgLookup_uncached.else.abort oops.endif.endmacro JumpMissæºç  1234567891011.macro JumpMiss.if $0 == GETIMP b LGetImpMiss.elseif $0 == NORMAL b __objc_msgSend_uncached.elseif $0 == LOOKUP b __objc_msgLookup_uncached.else.abort oops.endif.endmacro åœ¨ objc-msg-ram64.s æ–‡ä»¶ä¸­æŸ¥æ‰¾ __objc_msgSend_uncached çš„æ±‡ç¼–æºç ï¼Œå‘ç°å…¶æ ¸å¿ƒæ˜¯ MethodTableLookup(å³æŸ¥è¯¢æ–¹æ³•åˆ—è¡¨) ï¼Œå› æ­¤å¦‚æœ ç¼“å­˜ï¼ˆCacheLookupï¼‰æŸ¥æ‰¾ æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å» MethodTableLookupï¼ˆå³æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼‰ ï¼Œä¸‹ä¸€ç« æˆ‘ä»¬ä»‹ç» __objc_msgSend_uncachedæºç  12345678910STATIC_ENTRY __objc_msgSend_uncached UNWIND __objc_msgSend_uncached, FrameWithNoSaves // THIS IS NOT A CALLABLE C FUNCTION // Out-of-band p16 is the class to search // æ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾ MethodTableLookup TailCallFunctionPointer x17","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†14-0ï¼šæ–¹æ³•è°ƒç”¨çš„æœ¬è´¨objc_msgSendæ¶ˆæ¯å‘é€","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-0ï¼šæ–¹æ³•è°ƒç”¨çš„æœ¬è´¨objc_msgSendæ¶ˆæ¯å‘é€","date":"2023-02-25T08:41:30.000Z","updated":"2023-02-25T11:11:50.608Z","comments":true,"path":"2023/02/25/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-0ï¼šæ–¹æ³•è°ƒç”¨çš„æœ¬è´¨objc_msgSendæ¶ˆæ¯å‘é€/","link":"","permalink":"https://www.bboyzj.cn/2023/02/25/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8614-0%EF%BC%9A%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E7%9A%84%E6%9C%AC%E8%B4%A8objc_msgSend%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81/","excerpt":"","text":"å‰è¨€æˆ‘ä»¬å…ˆå¾—å‡ºç»“è®ºï¼šæ–¹æ³•è°ƒç”¨çš„æœ¬è´¨æ˜¯ objc_msgSendæ¶ˆæ¯å‘é€ æœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯ç†è§£ objc_msgSend çš„ æ–¹æ³•æŸ¥æ‰¾ æµç¨‹ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ OCåº•å±‚åŸç†13ï¼šcache-tåº•å±‚åŸç†åˆ†æ ä¸­ï¼Œåˆ†æäº† cacheçš„å†™å…¥æµç¨‹ï¼Œåœ¨å†™å…¥æµç¨‹ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ª cacheè¯»å–æµç¨‹ï¼Œå³ objc_msgSend å’Œ cache_getImp åœ¨åˆ†æä¹‹å‰ï¼Œé¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯ Runtime Runtimeä»‹ç»runtimeæˆä¸ºè¿è¡Œæ—¶ï¼Œå®ƒåŒºåˆ«äºç¼–è¯‘æ—¶ï¼š è¿è¡Œæ—¶ æ˜¯ ä»£ç è·‘èµ·æ¥ï¼Œè¢«è£…è½½åˆ°å†…å­˜ä¸­ çš„è¿‡ç¨‹ï¼Œå¦‚æœæ­¤æ—¶å‡ºé”™ï¼Œåˆ™ç¨‹åºä¼šå´©æºƒï¼Œæ˜¯ä¸€ä¸ª åŠ¨æ€ é˜¶æ®µ ç¼–è¯‘æ—¶ æ˜¯ æºä»£ç ç¼–è¯‘æˆæœºå™¨èƒ½è¯†åˆ«çš„ä»£ç  çš„è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯å¯¹è¯­è¨€è¿›è¡Œæœ€åŸºæœ¬çš„æ£€æŸ¥æŠ¥é”™ï¼Œå³ è¯æ³•åˆ†æã€è¯­æ³•åˆ†æ ç­‰ï¼Œæ˜¯ä¸€ä¸ª é™æ€ çš„é˜¶æ®µ runtime çš„ ä½¿ç”¨ æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼Œå…¶ä¸­ä¸‰ç§å®ç°æ–¹å¼ä¸ç¼–è¯‘å±‚å’Œåº•å±‚çš„å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼š é€šè¿‡ OCä»£ç ï¼Œä¾‹å¦‚ [person sayNB] é€šè¿‡ Framework&amp;Serviceï¼Œä¾‹å¦‚ isKindOfClass é€šè¿‡ Runtime APIï¼Œä¾‹å¦‚ class_getInstanceSize complier å°±æ˜¯æˆ‘ä»¬äº†è§£çš„ ç¼–è¯‘å™¨ï¼Œå³ LLVMï¼Œä¾‹å¦‚ OC çš„ alloc å¯¹åº”åº•å±‚çš„ objc_alloc runtime system library å°±æ˜¯ Runtime åº•å±‚åº“ã€‚ å¯ä»¥é€šè¿‡ command + shift + 0 æ‰“å¼€å®˜æ–¹æ–‡æ¡£ æ¢ç´¢æ–¹æ³•çš„æœ¬è´¨æ–¹æ³•çš„æœ¬è´¨ åœ¨ OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢ æ–‡ç« ä¸­ï¼Œé€šè¿‡ clang ç¼–è¯‘çš„æºç ï¼Œç†è§£äº† ocå¯¹è±¡çš„æœ¬è´¨ï¼ŒåŒæ ·çš„ï¼Œä½¿ç”¨clang ç¼–è¯‘ main.m -&gt; main.cpp æ–‡ä»¶ï¼Œé€šè¿‡æŸ¥çœ‹mainå‡½æ•°ä¸­æ–¹æ³•è°ƒç”¨çš„å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤º mian.m å†…å®ç°å¦‚ä¸‹ä»£ç ï¼š 1234// ğŸ‘‡main.mä¸­ZJPerson * person = [ZJPerson alloc];[person sayNB];[person sayHello]; ç»ˆç«¯ clang ç¼–è¯‘ miam.m -&gt; main.cpp åçš„ä»£ç  1234// ğŸ‘‡clangç¼–è¯‘åçš„åº•å±‚å®ç°ZJPerson * person = ((ZJPerson *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(&quot;ZJPerson&quot;), sel_registerName(&quot;alloc&quot;));((void (*)(id, SEL))(void *)objc_msgSend)((id)person, sel_registerName(&quot;sayNB&quot;));((void (*)(id, SEL))(void *)objc_msgSend)((id)person, sel_registerName(&quot;sayHello&quot;)); æ€»ç»“ï¼š é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•çš„æœ¬è´¨ å°±æ˜¯ objc_msgSendæ¶ˆæ¯å‘é€ éªŒè¯æ–¹æ³•æœ¬è´¨æ–¹æ³•ï¼šæ¶ˆæ¯ï¼ˆæ¶ˆæ¯çš„æ¥å—è€…ï¼Œæ¶ˆæ¯ä¸»ä½“ï¼‰ ä¸ºäº†éªŒè¯ï¼Œé€šè¿‡ objc_msgSend æ–¹æ³•æ¥å®Œæˆ [person sayNB] çš„è°ƒç”¨ï¼ŒæŸ¥çœ‹å…¶æ‰“å°æ˜¯å¦ä¸€è‡´ 1234æ³¨ï¼šğŸ‘‡ objc_msgSend æ¶ˆæ¯å‘é€æµç¨‹æ˜¯åœ¨ &lt;objc/message.h&gt; ç³»ç»Ÿåº“ä¸­1ã€ç›´æ¥è°ƒç”¨ `objc_msgSend`ï¼Œå¯¼å…¥å¤´æ–‡ä»¶ `#import&lt;objc/message.h&gt;`2ã€éœ€è¦å°† target --&gt; Build Setting --&gt; æœç´¢msg --&gt; å°† enable strict checking of objc_msgSend calls ç”± YES æ”¹ä¸º NOï¼Œå°†ä¸¥å‰çš„æ£€æŸ¥æœºåˆ¶å…³æ‰ï¼Œå¦åˆ™ `objc_msgSend` çš„å‚æ•°ä¼šæŠ¥é”™3. `sel_registerName = @selector() = NNSelectorFromString()` å†æ¬¡ç¼–è¯‘è¿è¡Œ command + R 123ZJPerson * person = [ZJPerson alloc];[person sayNB];objc_msgSend(person,sel_registerName(&quot;sayNB&quot;)); å…¶æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œå‘ç°æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ [person sayNB] ç­‰ä»·äº objc_msgSend(person,sel_registerName(&quot;sayNB&quot;)) å­ç±»å¯¹è±¡æ–¹æ³•è°ƒç”¨-æ‰§è¡Œçˆ¶ç±»çš„å®ç° é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç±» å­ç±»ZJStudent å’Œ çˆ¶ç±»ZJPerson 1234567891011121314151617// çˆ¶ç±» ZJPerson@interface ZJPerson : NSObject- (void)sayNB;@end@implementation ZJPerson- (void)sayNB&#123; NSLog(@&quot;666&quot;);&#125;@end// ZJStudent ç»§æ‰¿çˆ¶ç±» ZJPerson@interface ZJStudent : ZJPerson- (void)sayNB;@end@implementation ZJStudent@end åœ¨ main.m ä¸­è®©å­ç±»è°ƒç”¨ sayNB æ–¹æ³•ï¼ŒæŸ¥çœ‹æ˜¯å¦èƒ½è¾“å‡ºç»“æœ 123456ZJPerson * person = [ZJPerson alloc];ZJStudent * student = [ZJStudent alloc]; // æ¶ˆæ¯çš„æ¥æ”¶è€…è¿˜æ˜¯è‡ªå·± - çˆ¶ç±» - è¯·ä½ ç›´æ¥æ‰¾æˆ‘çš„çˆ¶äº²è¦[student sayNB];objc_msgSend(student,sel_registerName(&quot;sayNB&quot;)); è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ ç”±æ‰“å°ç»“æœå¯çŸ¥,å­ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œå¯ä»¥ æ‰§è¡Œçˆ¶ç±»æ–¹æ³•çš„å®ç° é‚£ä¹ˆå­ç±»æ˜¯å¦‚ä½•è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬å¾€ä¸‹æ¢ç´¢ å­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³•çš„åŸç†æˆ‘ä»¬å…ˆè¯´ç»“è®ºï¼šæˆ‘ä»¬è¿˜å¯ä»¥å°è¯•è®© person çš„è°ƒç”¨æ‰§è¡Œçˆ¶ç±»ä¸­çš„å®ç°ï¼Œé€šè¿‡ objc_msgSendSuper å®ç° åœ¨ main.m å‡½æ•°ä¸­çš„è°ƒç”¨ 12345678910ZJPerson * person = [ZJPerson alloc];ZJStudent * student = [ZJStudent alloc]; struct objc_super zjsuper;zjsuper.receiver = person; // æ¶ˆæ¯çš„æ¥æ”¶è€…è¿˜æ˜¯personzjsuper.super_class = [ZJPerson class]; // å‘Šè¯‰çˆ¶ç±»æ˜¯è° // æ¶ˆæ¯çš„æ¥æ”¶è€…è¿˜æ˜¯è‡ªå·± - çˆ¶ç±» - è¯·ä½ ç›´æ¥æ‰¾æˆ‘çš„çˆ¶äº²è¦[student sayNB];objc_msgSendSuper(&amp;zjsuper, sel_registerName(&quot;sayNB&quot;)); è¿›å…¥objc_msgSendSuperå†…ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç»“æ„ ç”±ä¸Šå›¾å¯çŸ¥ objc_msgSendSuper æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå‚æ•° ï¼ˆç»“æ„ä½“ï¼Œselï¼‰ï¼Œå…¶ç»“æ„ä½“ç±»å‹æ˜¯ objc_super å®šä¹‰çš„ç»“æ„ä½“å¯¹è±¡ï¼Œä¸”éœ€è¦æŒ‡å®š receiver å’Œ super_class ä¸¤ä¸ªå±æ€§ è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 1232023-02-25 16:31:22.959805+0800 msg_sengç»§æ‰¿çˆ¶ç±»[53476:1503775] 6662023-02-25 16:31:22.961094+0800 msg_sengç»§æ‰¿çˆ¶ç±»[53476:1503775] 666Program ended with exit code: 0 ç”±æ‰“å°ç»“æœï¼Œæˆ‘ä»¬å‘ç°ä¸è®ºæ˜¯ [person sayHello] è¿˜æ˜¯ objc_msgSendSuper éƒ½æ‰§è¡Œçš„æ˜¯ çˆ¶ç±» ä¸­çš„ sayHello çš„å®ç°ï¼Œæ‰€ä»¥è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¯ä»¥çŒœæƒ³ï¼šæ–¹æ³•è°ƒç”¨ã€é¦–å…ˆæ˜¯åœ¨ç±»ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœç±»ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œä¼šåˆ°çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚ æ€»ç»“ ç”±ä¸Šé¢çš„ç»“è®ºæˆ‘ä»¬çŸ¥é“ æ–¹æ³•çš„è°ƒç”¨ å®é™…ä¸Šæ˜¯ æ¶ˆæ¯å‘é€objc_msgSend åœ¨ c ä¸­ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ å‡½æ•° åœ¨ OC ä¸­ï¼Œæ–¹æ³•è°ƒç”¨æ˜¯æ¶ˆæ¯å‘é€ï¼Œæ¶ˆæ¯å‘é€objc_smgSendæ˜¯é€šè¿‡ selæ–¹æ³•ç¼–å· æ‰¾åˆ° impå‡½æ•°æŒ‡é’ˆåœ°å€ ï¼Œè¿›è€Œæ‰¾åˆ° å†…å®¹","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"Swiftå­¦ä¹ 25ï¼šSwiftä¸­çš„æ¨¡å¼å’Œæ¨¡å¼åŒ¹é…","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 25ï¼šSwiftä¸­çš„æ¨¡å¼å’Œæ¨¡å¼åŒ¹é…","date":"2023-02-23T13:36:05.000Z","updated":"2023-03-09T07:24:03.834Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 25ï¼šSwiftä¸­çš„æ¨¡å¼å’Œæ¨¡å¼åŒ¹é…/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A025%EF%BC%9ASwift%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%BC%8F%E5%92%8C%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D/","excerpt":"","text":"æ¨¡å¼ æ¨¡å¼ä»£è¡¨ å•ä¸ªå€¼æˆ–å¤åˆå€¼ çš„ ç»“æ„ï¼Œ å¯ä»¥ç”¨æ¨¡å¼æ¥åŒ¹é…å„ç§å„æ ·çš„å€¼ï¼Œä¾‹å¦‚ï¼š(x,y) åŒ¹é… å…ƒç»„(1,2) å¯ä»¥ä»å¤åˆå€¼ä¸­å–å‡ºéƒ¨åˆ†æˆ–å…¨éƒ¨å€¼ï¼Œç„¶åæŠŠå€¼ç»‘å®šä¸€ä¸ªå¸¸é‡æˆ–å˜é‡ï¼Œä¾‹å¦‚ï¼š(let x,y) æå– (1,2) æ¨¡å¼åˆ†ç±»Swift ä¸­æ¨¡å¼åˆ†ä¸ºä¸¤ç±»ï¼š ä¸€ç§èƒ½æˆåŠŸåŒ¹é…ä»»ä½•ç±»å‹çš„å€¼ï¼›å¦ä¸€ç§åœ¨è¿è¡Œæ—¶åŒ¹é…æŸä¸ªç‰¹å®šå€¼å¯èƒ½ä¼šå¤±è´¥ ç¬¬ä¸€ç§æ¨¡å¼ç”¨äºè§£æ„ç®€å•çš„å¸¸é‡ã€å˜é‡å’Œå¯é€‰ç»‘å®šä¸­çš„å€¼ ç¬¬äºŒç§æ¨¡å¼ç”¨äºå…¨æ¨¡å¼åŒ¹é…ã€‚ æ¨¡å¼åˆ†ç±»ï¼š é€šé…ç¬¦æ¨¡å¼ï¼ˆWildcard Patternï¼‰ æ ‡è¯†ç¬¦æ¨¡å¼ï¼ˆIdentifier Patternï¼‰ å€¼ç»‘å®šæ¨¡å¼ï¼ˆValue-Binding Patternï¼‰ å…ƒç»„æ¨¡å¼ï¼ˆTuple Patternï¼‰ æšä¸¾ç”¨ä¾‹æ¨¡å¼ï¼ˆEnumeratinal Case Patternï¼‰ å¯é€‰é¡¹æ¨¡å¼ï¼ˆOptional Patternï¼‰ ç±»å‹è½¬æ¢æ¨¡å¼ï¼ˆType-Casting Patternï¼‰ è¡¨è¾¾å¼æ¨¡å¼ï¼ˆExpression Patternï¼‰ é€šé…ç¬¦æ¨¡å¼ï¼ˆWildcard Patternï¼‰ é€šé…ç¬¦æ¨¡å¼ï¼ˆWildcard Patternï¼‰ ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿ _ æ„æˆï¼Œç”¨äºåŒ¹é…å¹¶å¿½ç•¥ä»»ä½•èŒ 123for _ in 1...3 &#123;&#125; æ ‡è¯†ç¬¦æ¨¡å¼ï¼ˆIdentifier Patternï¼‰ æ ‡è¯†ç¬¦æ¨¡å¼åŒ¹é…ä»»ä½•å€¼ï¼Œå¹¶å°†åŒ¹é…çš„å€¼å’Œä¸€ä¸ªå˜é‡æˆ–å¸¸é‡ç»‘å®šèµ·æ¥ 1let someValue = 42 å€¼ç»‘å®šæ¨¡å¼ï¼ˆValue-Binding Patternï¼‰ æŠŠåŒ¹é…åˆ°çš„å€¼ç»‘å®šç»™ä¸€ä¸ª å˜é‡letæˆ–å¸¸é‡var 123456let point = (2,3)switch point &#123;// å°† point ä¸­çš„å…ƒç´ ç»‘å®šåˆ° x å’Œ ycase let (x,y): print(&quot;\\(x),\\(y)&quot;)&#125; å…ƒç»„æ¨¡å¼ï¼ˆTuple Patternï¼‰ å…ƒç»„æ¨¡å¼ç”±é€—å·åˆ†å‰²ï¼Œå…·æœ‰é›¶ä¸ªæˆ–å¤šä¸ªæ¨¡å¼çš„åˆ—è¡¨ï¼Œç”±ä¸€å¯¹åœ†æ‹¬å·æ‹¬èµ·æ¥ã€‚ 1234let points = [(0,0),(0,1),(1,1)]for (x,0) in points &#123; print(&quot;&quot;)&#125; æšä¸¾ç”¨ä¾‹æ¨¡å¼ï¼ˆEnumeratinal Case Patternï¼‰ åŒ¹é…ç°æœ‰æŸä¸ªæšä¸¾ç±»å‹çš„æŸä¸ªç”¨ä¾‹ï¼Œä½“ç°åœ¨ switch ä¸­ case æ ‡ç­¾ä¸­ï¼ŒåŠ ifã€whileã€guard å’Œ for in çš„ case ä¸­ å¯é€‰é¡¹æ¨¡å¼ï¼ˆOptional Patternï¼‰ åŒ¹é… Optional&lt;Wrapped&gt; æšä¸¾åœ¨ some&lt;Wrapped&gt; ä¸­åŒ…è£…çš„å€¼ å¯é€‰é¡¹æ¨¡å¼ä¸º for in è¯­å¥æä¾›äº†ä¸€ç§è¿­ä»£æ•°ç»„çš„ç®€ä¾¿æ–¹å¼ï¼Œåªä¸ºæ•°ç»„ä¸­çš„é nil å…ƒç´ æ‰§è¡Œå¾ªç¯ä½“ 12345678let someNum: Int? = 10if case .some(let x) = someNum &#123; print(x)&#125;if case let x? = someNum &#123; print(x)&#125; ç±»å‹è½¬æ¢æ¨¡å¼ï¼ˆType-Casting Patternï¼‰ æœ‰ä¸¤ç§ï¼šisæ¨¡å¼ å’Œ asæ¨¡å¼ï¼Œis æ¨¡å¼åªå‡ºç°åœ¨ switch è¯­å¥ case æ ‡ç­¾ä¸­ is ç±»å‹ï¼šä»…å½“ä¸€ä¸ªå€¼ç±»å‹åœ¨è¿è¡Œæ—¶å’Œ isæ¨¡å¼ å³è¾¹æŒ‡å®šçš„ç±»å‹ä¸€è‡´ï¼Œæˆ–å­ç±»ä¸‹ï¼Œæ‰åŒ¹é…å€¼ï¼Œæ²¡æœ‰è¿”å›ç±»å‹ æ¨¡å¼ as ç±»å‹ï¼šä»…å½“ä¸€ä¸ªå€¼ç±»å‹åœ¨è¿è¡Œæ—¶å’Œ asæ¨¡å¼ å³è¾¹æŒ‡å®šçš„ç±»å‹ä¸€è‡´ï¼Œæˆ–å­ç±»ä¸‹ï¼Œæ‰åŒ¹é…å€¼ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œè¢«è½¬æ¢æˆ asæ¨¡å¼å³è¾¹æŒ‡å®šçš„ç±»å‹ 12345678910111213141516171819202122232425262728protocol Animal &#123; var name:String &#123; get &#125;&#125;struct Dog:Animal &#123; var name:String &#123; return &quot;dog&quot; &#125; var runSpeed:Int&#125;struct Bird:Animal &#123; var name:String&#123; return &quot;bird&quot; &#125; var flightHeight:Int&#125;let animals:[Any] = [Dog(runSpeed:40),Bird(flightHeight:500)]for animal in animals &#123; switch animal&#123; case let dog as Dog: print(&quot;\\(dog.name) run at \\(dog.runSpeed)&quot;) case let bird as Bird: print(&quot;\\(bird.name) swip at \\(bird.flightHeight)&quot;) default: break &#125;&#125; è¡¨è¾¾å¼æ¨¡å¼ï¼ˆExpression Patternï¼‰ è¡¨è¾¾å¼æ¨¡å¼ä»£è¡¨è¡¨è¾¾å¼çš„å€¼ï¼Œåªå‡ºç°åœ¨ switch è¯­å¥ä¸­çš„ case æ ‡ç­¾ä¸­ å¯é‡è½½ ~= è¿ç®—ç¬¦æ¥æä¾›è‡ªå®šä¹‰çš„è¡¨è¾¾å¼åŒ¹é…è¡Œä¸º è‡ªå®šä¹‰ç±»æˆ–ç»“æ„ä½“ç±»å‹ é»˜è®¤ä¹Ÿæ˜¯æ— æ³•è¿›è¡Œè¡¨è¾¾å¼æ¨¡å¼åŒ¹é…çš„ï¼Œä¹Ÿéœ€è¦é‡è½½ ~= è¿ç®—ç¬¦ 123456789101112131415struct Employee&#123; var salary:Int&#125;func ~= (left:ClosedRange&lt;Int&gt;,right:Employee) -&gt; Bool&#123; return left.contains(right.salary)&#125;var e: Employee = Employee(salary:2000)switch e&#123;case 0...1000: print(&quot;åƒä¸é¥±&quot;)case 1000...5000: print(&quot;å‹‰å¼ºåº¦æ—¥&quot;)default: break&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 24ï¼šå¦‚ä½•åœ¨Swifté‡Œé¢è¿›è¡Œæ§åˆ¶è½¬ç§»","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 24ï¼šå¦‚ä½•åœ¨Swifté‡Œé¢è¿›è¡Œæ§åˆ¶è½¬ç§»","date":"2023-02-23T13:35:34.000Z","updated":"2023-03-09T07:24:01.145Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 24ï¼šå¦‚ä½•åœ¨Swifté‡Œé¢è¿›è¡Œæ§åˆ¶è½¬ç§»/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A024%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8Swift%E9%87%8C%E9%9D%A2%E8%BF%9B%E8%A1%8C%E6%8E%A7%E5%88%B6%E8%BD%AC%E7%A7%BB/","excerpt":"","text":"æ§åˆ¶è½¬ç§» continue break fallthrough return throw continue continue å‘Šè¯‰æˆ‘ä¸å†ç»§ç»­å½“å‰å¾ªç¯éå†äº†ï¼Œå†æ¬¡ä»å¤´å¼€å§‹ä¸‹ä¸€æ¬¡éå† break break ä¼šç«‹å³ç»“æŸæ•´ä¸ªæ§åˆ¶æµè¯­å¥ï¼Œå³è·³å‡ºæ•´ä¸ªå¾ªç¯ fallthrough ä½ ç¡®å®šè¦è´¯ç©¿è¡Œä¸ºï¼Œä½ å¯ä»¥åœ¨ switch æ¯ä¸ª case æœ«å°¾ ä½¿ç”¨ fallthrough å…³é”®å­— 12345678910let num = 5var des = &quot;the num \\(num) is&quot;switch num &#123;case 2,3,5,7: des += &quot;a prime number&quot; fallthroughdefault: des += &quot; also a int&quot;&#125;print(des) è¯­å¥æ ‡ç­¾ å¯ä»¥ç”¨ k æ¥ç»™å¾ªç¯è¯­å¥æˆ–æ¡ä»¶è¯­å¥åšæ ‡è®°ã€‚ é…åˆ break æˆ– continue æ¥ç»“æŸè¢«æ ‡è®°çš„è¯­å¥ 12345678910111213141516171819var num = 10whileLoop: while num &gt; 0 &#123; switch num &#123; case 9: print(&quot;9&quot;) case 10: var sum = 0 for i in 0...10 &#123; sum += i if i == 9 &#123; print(sum) break whileLoop &#125; &#125; default: print(&quot;default&quot;) &#125; num -= 1&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 23ï¼šæ›´åŠ å¼ºå¤§çš„switch","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 23ï¼šæ›´åŠ å¼ºå¤§çš„switch","date":"2023-02-23T13:35:07.000Z","updated":"2023-03-09T07:23:56.957Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 23ï¼šæ›´åŠ å¼ºå¤§çš„switch/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A023%EF%BC%9A%E6%9B%B4%E5%8A%A0%E5%BC%BA%E5%A4%A7%E7%9A%84switch/","excerpt":"","text":"swift switch è¯­å¥ä¼šå°†ä¸€ä¸ªå€¼ä¸å¤šä¸ªå¯èƒ½åŒ¹é…çš„æ¨¡å¼åŒ¹é…ï¼Œç„¶ååŸºäºç¬¬ä¸€ä¸ªæˆåŠŸåŒ¹é…çš„æ¨¡å¼æ¥æ‰§è¡Œåˆé€‚çš„ä»£ç å— switch è¯­å¥ä¸€å®šå¾—æ˜¯å…¨é¢çš„ã€‚ç»™å®šç±»å‹é‡Œçš„æ¯ä¸€ä¸ªå€¼éƒ½å¾—åŒ¹é…åˆ°ä¸€ä¸ª switch çš„ caseã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªé»˜è®¤åŒ¹é…çš„ case æ¥åŒ¹é…æ‰€æœ‰æœªæ˜ç¡®çš„å€¼ï¼Œç”¨å…³é”®å­— default æ ‡è®° OC ä¸­ switch è¯­å¥ä¸å…¨é¢ï¼Œä»ç„¶å¯ä»¥è¿è¡Œ 1234567let c:Character = &quot;z&quot;switch c &#123;case &quot;a&quot;: print(&quot;the first letter is alphabet&quot;)case &quot;z&quot;: print(&quot;the last letter is alphabet&quot;)&#125; ä¿®æ”¹ 123456789let c:Character = &quot;z&quot;switch c &#123;case &quot;a&quot;: print(&quot;the first letter is alphabet&quot;)case &quot;z&quot;: print(&quot;the last letter is alphabet&quot;)default: print(&quot;other&quot;)&#125; æ²¡æœ‰éšç§è´¯ç©¿ ç›¸æ¯” OC å’Œ C ï¼ŒSwift é‡Œçš„ Switch ä¸ä¼šé»˜è®¤ä»åŒ¹é…çš„ case æœ«å°¾ è´¯ç©¿åˆ°ä¸‹ä¸€ä¸ª case é‡Œ ç›¸åï¼Œæ•´ä¸ª Switch åœ¨åŒ¹é…åˆ°ç¬¬ä¸€ä¸ª case æ‰§è¡Œå®Œæ¯•ä¹‹åé€€å‡ºï¼Œä¸å†éœ€è¦æ˜¾ç¤º break æ¯ä¸€ä¸ª case çš„å‡½æ•°ä½“å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¯æ‰§è¡Œçš„è¯­å¥ åœ¨ä¸€ä¸ª Switch çš„ case ä¸­åŒ¹é…å¤šä¸ªå€¼å¯ä»¥ç”¨ é€—å·åˆ†å‰²ï¼Œå¹¶ä¸”å¯ä»¥å†™æˆå¤šè¡Œ 123456789let c = &quot;a&quot;switch c &#123;case &quot;a&quot;,&quot;e&quot;,&quot;i&quot;: print(&quot;å…ƒéŸ³å­—æ¯&quot;)case &quot;b&quot;,&quot;c&quot;: print(&quot;ç¬¦å°å­—æ¯&quot;)default: print(&quot;å…¶ä»–å­—ç¬¦&quot;)&#125; åŒºé—´åŒ¹é… Switch çš„ case çš„å€¼å¯ä»¥å†ä¸€ä¸ªåŒºé—´ä¸­åŒ¹é… 123456789101112let count = 43switch count&#123;case 0: print(&quot;none&quot;)case 1...25: print(&quot;1~25&quot;)case 26..&lt;51: print(&quot;26~50&quot;)default: print(&quot;other&quot;)&#125; å…ƒç»„åŒ¹é… ä½ å¯ä»¥ä½¿ç”¨å…ƒç»„æ¥åœ¨ä¸€ä¸ª switch ä¸­æµ‹è¯•æœ‰å¤šä¸ªå€¼ ä½¿ç”¨ä¸‹åˆ’çº¿ _ æ¥è¡¨æ˜åŒ¹é…æ‰€æœ‰å¯èƒ½çš„å€¼ 1234567891011121314let point = (1,1)switch point&#123;case (0,0): print(&quot;point at origin&quot;)case (_,0): print(&quot;point at x&quot;)case (0,_): print(&quot;point at y&quot;)case (-2...2,-2...2): print(&quot;point at box&quot;)default: print(0,0)&#125; å€¼ç»‘å®š switch çš„ case å¯ä»¥å°†åŒ¹é…åˆ°çš„å€¼ä¸´æ—¶ ç»‘å®š åˆ°ä¸€ä¸ª å¸¸é‡æˆ–å˜é‡ï¼Œæ¥ç»™ case çš„å‡½æ•°ä½“ä½¿ç”¨ å¦‚æœä½¿ç”¨ var å…³é”®å­—ï¼Œä¸´æ—¶çš„å˜é‡å°±ä¼šä»¥åˆé€‚çš„å€¼æ¥åˆ›å»ºå¹¶åˆå§‹åŒ–ã€‚å¯¹è¿™ä¸ªå˜é‡çš„ä»»ä½•æ”¹å˜éƒ½åªä¼šåœ¨ case çš„å‡½æ•°ä½“å†…æœ‰æ•ˆ 123456789let point = (1,0)switch point&#123;case (let x,0): print(&quot;x is \\(x) when y is 0&quot;)case (0,let y): print(&quot;y is \\(y) when x is 0&quot;)default: print(&quot;other&quot;)&#125; where è¯­å¥ switch case å¯ä»¥ä½¿ç”¨ where è¯­å¥æ¥æ£€æŸ¥æ˜¯å¦ç¬¦åˆç‰¹å®šçš„çº¦æŸ 123456789let point = (1,-1)switch point&#123;case (let x,let y) where x == y: print(&quot;x == y&quot;)case (let x,let y) where x == -y: print(&quot;x == -y&quot;)default: print(&quot;other&quot;)&#125; å¤åˆåŒ¹é… case åå¯ä»¥å†™å¤šä¸ªæ¨¡å¼æ¥å¤åˆï¼Œåœ¨æ¯ä¸ªæ¨¡å¼é—´ç”¨ , å·åˆ†å‰² å¤åˆåŒ¹é… - å€¼ç»‘å®š å¤åˆåŒ¹é…åŒæ ·å¯ä»¥åŒ…å« å€¼ç»‘å®šã€‚","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 22ï¼šå¦‚ä½•åœ¨Swifté‡Œè¿›è¡Œå¾ªç¯æ§åˆ¶","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 22ï¼šå¦‚ä½•åœ¨Swifté‡Œè¿›è¡Œå¾ªç¯æ§åˆ¶","date":"2023-02-23T13:34:50.000Z","updated":"2023-03-09T07:23:54.581Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 22ï¼šå¦‚ä½•åœ¨Swifté‡Œè¿›è¡Œå¾ªç¯æ§åˆ¶/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A022%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8Swift%E9%87%8C%E8%BF%9B%E8%A1%8C%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6/","excerpt":"","text":"for in å¾ªç¯ ä½¿ç”¨ for in å¾ªç¯æ¥éå†åºåˆ—ï¼Œæ¯”å¦‚ä¸€ä¸ªèŒƒå›´çš„æ•°å­—ï¼Œæ•°ç»„ä¸­å…ƒç´ æˆ–è€…å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ å¦‚æœä½ ä¸éœ€è¦åºåˆ—çš„æ¯ä¸€ä¸ªå€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ _ æ¥å–ä»£éå†å 123456789101112131415// éå†for i in 0...3&#123; print(i)&#125;// éå†å­—ç¬¦ä¸²for c in &quot;hello,world&quot; &#123; print(c)&#125;// éå†æ•°ç»„let letter = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]for str in letter &#123; print(str)&#125; for in éå†å­—å…¸ å½“éå†å­—å…¸æ—¶ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½è¿”å›ä¸€ä¸ª (key,value) å…ƒç»„ï¼Œä½ å¯ä»¥åœ¨ for in å¾ªç¯ä½“ä¸­ä½¿ç”¨æ˜¾ç¤ºå‘½åå¸¸é‡æ¥åˆ†è§£ (key,value) å…ƒç»„æˆå‘˜ 1234567let nums = [&quot;age&quot;:&quot;30&quot;,&quot;sex&quot;:&quot;ç”·&quot;]for (key,value) in nums &#123; print(&quot;key is \\(key),value is \\(value)&quot;)&#125;for t in nums &#123; print(&quot;key is \\(t.0),value is \\(t.1)&quot;)&#125; for in åˆ†æ®µåŒºé—´ ä½¿ç”¨ stride(from:to:by) å‡½æ•°æ¥è·³è¿‡ä¸æƒ³è¦çš„æ ‡è®°ï¼ˆå¼€åŒºé—´ï¼‰ 123for i in stride(from: 0, to: 50, by: 10) &#123; print(i)&#125; é—­åŒºé—´ ä¹ŸåŒæ ·é€‚ç”¨ï¼Œä½¿ç”¨ stride(from:through:by:) å³å¯ 123for i in stride(from: 0, through: 50, by: 10) &#123; print(i)&#125; while å¾ªç¯ repeat-while å¾ªç¯ ï¼ˆoc ä¸­æ˜¯ do-whileï¼‰","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 21ï¼šå¦‚ä½•åœ¨swiftä¸­è‡ªå®šä¹‰è¿ç®—ç¬¦","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 21ï¼šå¦‚ä½•åœ¨swiftä¸­è‡ªå®šä¹‰è¿ç®—ç¬¦","date":"2023-02-22T20:03:04.000Z","updated":"2023-03-09T07:23:52.087Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 21ï¼šå¦‚ä½•åœ¨swiftä¸­è‡ªå®šä¹‰è¿ç®—ç¬¦/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A021%EF%BC%9A%E5%A6%82%E4%BD%95%E5%9C%A8swift%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%90%E7%AE%97%E7%AC%A6/","excerpt":"","text":"è‡ªå®šä¹‰è¿ç®—ç¬¦ é™¤äº†å®ç°æ ‡å‡†çš„è¿ç®—ç¬¦ï¼Œåœ¨ swift å½“ä¸­è¿˜å¯ä»¥å£°æ˜å’Œå®ç°è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼ˆcustom operatorsï¼‰ æ–°çš„è¿ç®—ç¬¦è¦åœ¨å…¨å±€ä½œç”¨åŸŸå†…ï¼Œä½¿ç”¨ operator å…³é”®å­—è¿›è¡Œå£°æ˜ï¼ŒåŒæ—¶è¿˜è¦æŒ‡å®š prefixã€infix æˆ–è€… postfix é™å®šç¬¦ ã€ç¤ºä¾‹1ã€‘ï¼šä¸€å…ƒè¿ç®—ç¬¦ 123456789101112131415struct Vector2D &#123; var x = 0.0,y = 0.0&#125;// å£°æ˜ä¸€å…ƒè¿ç®—ç¬¦prefix operator +++// æ‰©å±•extension Vector2D &#123; static prefix func +++ (vector: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: vector.x + vector.x,y: vector.y + vector.y) &#125;&#125;let vectorToDouble = Vector2D(x: 1.0,y: 2.0)let doubleVector = +++vectorToDoubleprint(&quot;\\(doubleVector.x) \\(doubleVector.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœ 12.0 4.0 ã€ç¤ºä¾‹2ã€‘ï¼š 1234567891011121314// ä¸­ç¼€è¿ç®—ç¬¦struct Vector2D &#123; var x = 0.0,y = 0.0&#125;infix operator +-: AdditionPrecedenceextension Vector2D &#123; static func +- (left: Vector2D,right: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x + right.x,y: left.y - right.y) &#125;&#125;let firstVector = Vector2D(x: 1.0,y: 3.0)let secondVector = Vector2D(x: 2.0,y: 5.0)let result = firstVector +- secondVectorprint(&quot;\\(result.x) \\(result.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 13.0 -2.0 ã€ç¤ºä¾‹3ã€‘ï¼š 1234567891011121314// ä¸­ç¼€è¿ç®—ç¬¦struct Vector2D &#123; var x = 0.0,y = 0.0&#125;infix operator *^: MultiplicationPrecedenceextension Vector2D &#123; static func *^ (left: Vector2D,right: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x * right.x,y: left.y * left.y + right.y * right.y) &#125;&#125;let firstVector = Vector2D(x: 1.0,y: 3.0)let secondVector = Vector2D(x: 2.0,y: 5.0)let result = firstVector *^ secondVectorprint(&quot;\\(result.x) \\(result.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 12.0 34.0 è‡ªå®šä¹‰ä¸­ç¼€è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§å’Œç»“åˆæ€§ è‡ªå®šä¹‰ ä¸­ç¼€ï¼ˆinfixï¼‰ è¿ç®—ç¬¦ä¹Ÿå¯ä»¥æŒ‡å®šä¼˜å…ˆçº§å’Œç»“æ ¸æ€§ æ¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸­ç¼€è¿ç®—ç¬¦éƒ½å±äºä¸€ä¸ª ä¼˜å…ˆçº§ç»„ ä¼˜å…ˆçº§ç»„æŒ‡å®šäº†è‡ªå®šä¹‰ä¸­ç¼€è¿ç®—ç¬¦å’Œå…¶ä»–ä¸­ç¼€è¿ç®—ç¬¦çš„å…³ç³» ã€ç¤ºä¾‹ã€‘ï¼š 123456789101112131415161718192021// ä¼˜å…ˆçº§å’Œç»“åˆæ€§struct Vector2D &#123; var x = 0.0,y = 0.0&#125;infix operator +-: AdditionPrecedenceextension Vector2D &#123; static func +- (left: Vector2D,right: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x + right.x,y: left.y - right.y) &#125;&#125;infix operator *^: MultiplicationPrecedenceextension Vector2D &#123; static func *^ (left: Vector2D,right: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x * right.x,y: left.y * left.y + right.y * right.y) &#125;&#125;let firstVector = Vector2D(x: 1.0,y: 2.0)let secondVector = Vector2D(x: 2.0,y: 3.0)let thirdVector = Vector2D(x: 3.0,y: 4.0)let result = firstVector +- secondVector *^ thirdVectorprint(&quot;\\(result.x) \\(result.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 17.0 -23.0 ã€æ³¨ã€‘ï¼šå…ˆè®¡ç®— *^ ä¼˜å…ˆçº§ç»„ï¼Œå†è®¡ç®— +- ä¼˜å…ˆçº§ç»„ x: 2 * 3 &#x3D; 6 + 1 &#x3D; 7.0y: 3 * 3 + 4 * 4 &#x3D; 2 - 25 &#x3D; -23 æ¥ä¸‹æ¥æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªä¼˜å…ˆçº§ç»„ 123456789101112131415161718192021222324252627282930// è‡ªå®šä¹‰ä¼˜å…ˆçº§å’Œç»“åˆæ€§struct Vector2D &#123; var x = 0.0,y = 0.0&#125;infix operator +-: AdditionPrecedenceextension Vector2D &#123; static func +- (left: Vector2D,right: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x + right.x,y: left.y - right.y) &#125;&#125;infix operator *^: MyPrecedencegroup// æˆ‘çš„ä¼˜å…ˆçº§ç»„precedencegroup MyPrecedencegroup &#123; // ç»“åˆæ€§ associativity: left // ä¼˜å…ˆçº§ lowerThan: AdditionPrecedence&#125;extension Vector2D &#123; static func *^ (left: Vector2D,right: Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x * right.x,y: left.y * left.y + right.y * right.y) &#125;&#125;let firstVector = Vector2D(x: 1.0,y: 2.0)let secondVector = Vector2D(x: 2.0,y: 3.0)let thirdVector = Vector2D(x: 3.0,y: 4.0)let result = firstVector +- secondVector *^ thirdVectorprint ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 19.0 17.0 ã€æ³¨ã€‘ï¼šå…ˆè®¡ç®— *^ ä¼˜å…ˆçº§ç»„ï¼Œå†è®¡ç®— +- ä¼˜å…ˆçº§ç»„ xï¼š1 + 2 &#x3D; 3 * 3 &#x3D; 9.0yï¼š2 - 3 &#x3D; -1 * -1 + 4 * 4 &#x3D; 17.0","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 20ï¼šå¦‚ä½•ä¸ºç±»å’Œç»“æ„ä½“è‡ªå®šä¹‰è¿ç®—ç¬¦","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 20ï¼šå¦‚ä½•ä¸ºç±»å’Œç»“æ„ä½“è‡ªå®šä¹‰è¿ç®—ç¬¦","date":"2023-02-22T20:02:46.000Z","updated":"2023-03-09T07:23:46.686Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 20ï¼šå¦‚ä½•ä¸ºç±»å’Œç»“æ„ä½“è‡ªå®šä¹‰è¿ç®—ç¬¦/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A020%EF%BC%9A%E5%A6%82%E4%BD%95%E4%B8%BA%E7%B1%BB%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%90%E7%AE%97%E7%AC%A6/","excerpt":"","text":"è¿ç®—ç¬¦é‡è½½ ç±»å’Œç»“æ„ä½“ å¯ä»¥ä¸ºç°æœ‰çš„è¿ç®—ç¬¦æä¾›è‡ªå®šä¹‰çš„å®ç°ï¼Œç§°ä¸º è¿ç®—ç¬¦é‡è½½ 1234567struct Vector2D &#123; var x = 0.0,y = 0.0&#125;let vector = Vector2D(x: 1.0,y: 2.0)let anotherVertor = Vector2D(x: 3.0,y: 1.0)let thirdVertor = vector + anotherVertor è¿ç®—ç¬¦é‡è½½ 1234567891011121314struct Vector2D &#123; var x = 0.0,y = 0.0&#125;extension Vector2D &#123; static func + (left:Vector2D,right:Vector2D) -&gt; Vector2D &#123; return Vector2D(x: left.x + right.x,y: left.y + right.y) &#125;&#125;let vector = Vector2D(x: 1.0,y: 2.0)let anotherVertor = Vector2D(x: 3.0,y: 1.0)let thirdVector = vector + anotherVertorprint(&quot;x is \\(thirdVector.x),y is \\(thirdVector.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 1x is 4.0,y is 3.0 ä¸€å…ƒè¿ç®—ç¬¦çš„é‡è½½ ç±»å’Œç»“æ„ä½“ ä¹Ÿèƒ½æä¾› æ ‡å‡†ä¸€å…ƒè¿ç®—ç¬¦ çš„å®ç° è¦å®ç° å‰ç¼€ æˆ–è€… åç¼€ è¿ç®—ç¬¦ï¼Œéœ€è¦åœ¨å£°æ˜è¿ç®—ç¬¦å‡½æ•°çš„æ—¶å€™åœ¨ func å…³é”®å­—ä¹‹å‰æŒ‡å®š prefix æˆ–è€… postfix é™å®šç¬¦ 1234567891011struct Vector2D &#123; var x = 0.0,y = 0.0&#125;extension Vector2D &#123; static prefix func - (vector:Vector2D) -&gt; Vector2D &#123; return Vector2D(x: -vector.x,y: -vector.y) &#125;&#125;let vector = Vector2D(x: 1.0,y: 2.0)let vector2 = -vectorprint(&quot;x is \\(vector2.x),y is \\(vector2.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 1x is -1.0,y is -2.0 ç»„åˆèµ‹å€¼è¿ç®—ç¬¦é‡è½½ ç»„åˆèµ‹å€¼è¿ç®—ç¬¦å°†èµ‹å€¼è¿ç®—ç¬¦ = ä¸å…¶ä»–è¿ç®—ç¬¦è¿›è¡Œç»“åˆ åœ¨å®ç°çš„æ—¶å€™ï¼Œéœ€è¦æŠŠè¿ç®—ç¬¦çš„å·¦å‚æ•°è®¾ç½®æˆ inout ç±»å‹ï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°çš„å€¼ä¼šåœ¨è¿ç®—ç¬¦å‡½æ•°å†…ç›´æ¥è¢«ä¿®æ”¹ 123456789extension Vector2D &#123; static func += (left: inout Vector2D,right:Vector2D) &#123; left = Vector2D(x: left.x + right.x,y: left.y + right.y) &#125;&#125;var vector3 = Vector2D(x: 1.0, y: 2.0)let vector4 = Vector2D(x: 2.0,y: 3.0)vector3 += vector4print(&quot;x is \\(vector3.x),y is \\(vector3.y)&quot;) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 1x is 3.0,y is 5.0 ç­‰ä»·è¿ç®—ç¬¦é‡è½½ è‡ªå®šä¹‰ç±»å’Œç»“æ„ä½“ä¸æ¥æ”¶ç­‰ä»·è¿ç®—ç¬¦çš„é»˜è®¤å®ç°ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ ç­‰äº è¿ç®—ç¬¦ == å’Œ ä¸ç­‰äº è¿ç®—ç¬¦ != è¦ä½¿ç”¨ç­‰ä»·è¿ç®—ç¬¦æ¥æ£€æŸ¥ä½ è‡ªå·±ç±»å‹çš„ç­‰ä»·ï¼Œéœ€è¦å’Œå…¶ä»– ä¸­ç¼€è¿ç®—ç¬¦ ä¸€æ ·æä¾›ä¸€ä¸ª ç­‰äº è¿ç®—ç¬¦é‡è½½ï¼Œå¹¶ä¸”éµå¾ªæ ‡å‡†åº“çš„ Equatable åè®® swift ä¸ºä¸€ä¸‹è‡ªå®šä¹‰ç±»å‹æä¾›ç­‰ä»·è¿ç®—ç¬¦åˆæˆå®ç° åªæœ‰éµå¾ª Equatable åè®®å­˜å‚¨å±æ€§çš„ ç»“æ„ä½“ åªæ‹¥æœ‰éµå¾ª Equatable åè®®å…³è”ç±»å‹çš„ æšä¸¾ æ²¡æœ‰å…³è”ç±»å‹çš„æšä¸¾ 123456789101112// ç­‰ä»·è¿ç®—ç¬¦struct Vector2D &#123; var x = 0.0,y = 0.0&#125;extension Vector2D: Equatable &#123; static func == (left:Vector2D,right:Vector2D) -&gt; Bool &#123; return (left.x == right.x) &amp;&amp; (left.y == right.y) &#125;&#125;var vector1 = Vector2D(x: 1.0, y: 2.0)let vector2 = Vector2D(x: 2.0,y: 3.0)print(vector1 == vector2) ç¼–è¯‘è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š 1false è‡ªå®šä¹‰ä¸­ç¼€è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§å’Œç»“åˆæ€§ è‡ªå®šä¹‰çš„ä¸­ç¼€ infix è¿ç®—ç¬¦ä¹Ÿå¯ä»¥æŒ‡å®šä¼˜å…ˆçº§å’Œç»“åˆæ€§ æ¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ä¸­ç¼€è¿ç®—ç¬¦éƒ½å±äºä¸€ä¸ªä¼˜å…ˆçº§ç»„ ä¼˜å…ˆçº§ç»„æŒ‡å®šäº†è‡ªå®šä¹‰ä¸­ç¼€è¿ç®—ç¬¦å’Œå…¶ä»–ä¸­ç¼€è¿ç®—ç¬¦çš„å…³ç³»","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 19ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 19ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§","date":"2023-02-22T20:02:16.000Z","updated":"2023-03-09T07:23:43.977Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 19ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A019%EF%BC%9A%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7%E5%92%8C%E7%BB%93%E5%90%88%E6%80%A7/","excerpt":"","text":"è¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§ è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ä½¿å¾—ä¸€äº›è¿ç®—ç¬¦ä¼˜å…ˆäºå…¶ä»–è¿ç®—ç¬¦ï¼Œé«˜ä¼˜å…ˆçº§çš„è¿ç®—ç¬¦ä¼šå…ˆè¢«è®¡ç®— ç»“åˆæ€§å®šä¹‰äº†å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¿ç®—ç¬¦æ˜¯å¦‚ä½•ç»“åˆï¼ˆæˆ–å…³è”ï¼‰çš„ ä¸€ä¸€ æ˜¯å·¦è¾¹ç»“åˆä¸ºä¸€ç»„ï¼Œè¿˜æ˜¯ä¸å³è¾¹ç»“åˆä¸ºä¸€ç»„ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼šå®ƒä»¬æ˜¯ä¸å·¦è¾¹çš„è¡¨è¾¾å¼ç»“åˆçš„ æˆ–è€… å®ƒä»¬æ˜¯ä¸å³è¾¹çš„è¡¨ç¤ºå¼ç»“åˆçš„ è¿ç®—ç¬¦ä¼˜å…ˆçº§-æ˜¾ç¤ºæ‹¬å· 2 + 3 % 4 * 5 ç­‰ä»·äº 2 + ((3 % 4) * 5) swift è¯­è¨€ä¸­é€»è¾‘è¿ç®—ç¬¦ &amp;&amp; å’Œ || æ˜¯å·¦ç›¸å…³çš„ï¼Œè¿™æ„å‘³ç€å¤šä¸ªé€»è¾‘è¿ç®—ç¬¦ç»„åˆçš„è¡¨è¾¾å¼ä¼šé¦–å…ˆè®¡ç®—æœ€å·¦è¾¹çš„","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 18ï¼šè¿ç®—ç¬¦åº”ç”¨ä¸¾ä¾‹","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 18ï¼šè¿ç®—ç¬¦åº”ç”¨ä¸¾ä¾‹","date":"2023-02-22T17:32:43.000Z","updated":"2023-03-09T07:23:41.153Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 18ï¼šè¿ç®—ç¬¦åº”ç”¨ä¸¾ä¾‹/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A018%EF%BC%9A%E8%BF%90%E7%AE%97%E7%AC%A6%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B/","excerpt":"","text":"ä¸¤ä¸ªæ•°å­—äº¤æ¢ ä¸å€ŸåŠ©ä¸´æ—¶å˜é‡ï¼Œäº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ 1234567var a = 1var b = 2a = a ^ bb = a ^ ba = a ^ bprint(a)print(b) æ±‚æ— ç¬¦å·æ•´æ•°äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•° ç»™å®šä¸€ä¸ªæ— ç¬¦å·æ•´å‹ UInt å˜é‡ï¼Œæ±‚å…¶äºŒè¿›åˆ¶è¡¨ä¸­ 1 çš„ä¸ªæ•°ï¼Œè¦æ±‚ç®—æ³•æ‰§è¡Œæ•ˆç‡å°½å¯èƒ½çš„é«˜ æ€è·¯ï¼šçœ‹ä¸€ä¸ªå…«ä½æ•´æ•° 10 100 001 ï¼Œå…ˆåˆ¤æ–­æœ€åä¸€ä½æ˜¯å¦ä¸º 1 ï¼Œè€Œ ä¸ æ“ä½œå¯ä»¥è¾¾åˆ°ç›®å‰ã€‚å¯ä»¥æŠŠè¿™ä¸ª å…«ä½æ•°å­— ä¸ 00 0000 01 è¿›è¡Œ ä¸ æ“ä½œï¼Œå¦‚æœç»“æœä¸º 1ï¼Œåˆ™è¡¨ç¤ºå½“å‰å…«ä½æ•°çš„æœ€åä¸€ä½ä¸º 1ï¼Œå¦åˆ™ä¸º 0 ã€‚æ€ä¹ˆåˆ¤æ–­ç¬¬ äºŒ ä½å‘¢ï¼Ÿå‘å³ç§»ä½ï¼Œå†å»¶ç»­å‰é¢çš„åˆ¤æ–­å³å¯ 12345678910111213// æœ‰å‡ ä¸ª 1func countsOfOnes(num:UInt) -&gt; UInt &#123; var count:UInt = 0 var temp = num while temp != 0 &#123; // å¦‚æœéƒ½æ˜¯ä½ 1 æ‰ç´¯åŠ  count += temp &amp; 1 // å³ç§» temp = temp &gt;&gt; 1 &#125; return count&#125;countsOfOnes(num: 8) å¦‚æœæ•´æ•°çš„äºŒè¿›åˆ¶ä¸­æœ‰è¾ƒå¤šçš„ 0ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯ä¸€æ¬¡å³ç§»åšåˆ¤æ–­ä¼šå¾ˆæµªè´¹ï¼Œæ€ä¹ˆæ”¹è¿›å‰é¢çš„ç®—æ³•å‘¢ï¼Ÿæœ‰æ²¡æœ‰åŠæ³•è®©ç®—æ³•çš„å¤æ‚åº¦åªæœ‰ä¸ 1 çš„ä¸ªæ•°æœ‰å…³ï¼Ÿ æ€è·¯ï¼šä¸ºäº†ç®€åŒ–è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è€ƒè™‘åªæœ‰é«˜ä½ 1 çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š11 000 000ï¼Œå¦‚ä½•è·³è¿‡å‰é¢ä½ä½çš„ 6 ä¸ª 0 ï¼Œè€Œç›´æ¥åˆ¤æ–­ç¬¬ ä¸ƒ ä½çš„ 1ï¼Ÿæˆ‘ä»¬å¯ä»¥è®¾è®¡ 11 000 000 å’Œ 10 111 111ï¼ˆä¹Ÿå°±æ˜¯ 11 000 000 - 1ï¼‰åš ä¸ æ“ä½œï¼Œæ¶ˆå»æœ€ä½ä½çš„ 1ã€‚å¦‚æœå¾—åˆ°çš„ç»“æœä¸º 0ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æ‰¾åˆ°æˆ–æ¶ˆå»é‡Œé¢æœ€åä¸€ä¸ª 1ï¼Œå¦‚æœä¸ä¸º 0ï¼Œé‚£ä¹ˆè¯´æ˜æˆ‘ä»¬æ¶ˆå»äº†æœ€ä½ä½çš„ 1ï¼Œä½†æ˜¯äºŒè¿›åˆ¶ä¸­è¿˜æœ‰å…¶ä»–çš„ 1ï¼Œæˆ‘ä»¬çš„è®¡æ•°å™¨éœ€è¦åŠ  1ï¼Œç„¶åç»§ç»­ä¸Šé¢çš„æ“ä½œ è®¡æ•°å™¨ count &#x3D; 0 æ­¥éª¤ä¸€ï¼šæ•´æ•°ä¸ä¸º0ï¼Œè¯´æ˜äºŒè¿›åˆ¶é‡Œé¢è‚¯å®šæœ‰1ï¼Œcount &#x3D; 1 11 000 000 &amp; 10 111 111 &#x3D; 10 000 000 (æ¶ˆå»ç¬¬7ä½çš„1) æ­¥éª¤äºŒï¼šç»“æœä¸ä¸º 0ï¼Œè¯´æ˜äºŒè¿›åˆ¶é‡Œè¿˜æœ‰ 1ï¼Œcount &#x3D; 2 10 000 000 &amp; 01 111 111 &#x3D; 0ï¼ˆæ¶ˆå»ç¬¬8ä½çš„1ï¼‰ 12345678910func countsOfOnes2(num:UInt) -&gt; UInt &#123; var count:UInt = 0 var temp = num while temp != 0 &#123; count += 1 temp = temp &amp; (temp - 1) &#125; return count&#125;countsOfOnes2(num: 3) å¼•ç”³ï¼šå¦‚æœåˆ¤æ–­ä¸€ä¸ªå¾æ”¶ä¸º2çš„æ•´æ•°æ¬¡å¹‚ ç»™å®šä¸€ä¸ªæ— ç¬¦å·æ•´å‹ UInt å˜é‡ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º 2 çš„æ•´æ•°æ¬¡å¹‚ æ€è·¯ï¼šä¸€ä¸ªæ•´æ•°å¦‚æœæ˜¯ 2 çš„æ•´æ•°æ¬¡æ–¹ï¼Œé‚£ä¹ˆå®ƒçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ‰ä¸”åªæœ‰ä¸€ä½æ˜¯1ï¼Œè€Œå…¶ä»–æ‰€æœ‰ä½éƒ½æ˜¯ 0ï¼Œæ ¹æ®å‰é¢çš„åˆ†æï¼ŒæŠŠè¿™ä¸ªæ•´æ•°å‡å» 1 åå†å’Œå®ƒè‡ªå·±åš &amp; è¿ç®—ï¼Œè¿™ä¸ªæ•´æ•°ä¸­å”¯ä¸€çš„ 1 å°±å˜æˆ 0 äº†ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°çš„ç»“æœæ˜¯ 0 12345// 2çš„æ•´æ•°æ¬¡å¹‚func isPowerTwo(num:UInt) -&gt; Bool &#123; return (num &amp; (num - 1)) == 0&#125;isPowerTwo(num: 18) ç¼ºå¤±çš„æ•°å­— å¾ˆå¤šæˆå¯¹å‡ºç°çš„æ­£æ•´æ•°ä¿å­˜åœ¨ç£ç›˜æ–‡ä»¶ä¸­ï¼Œæ³¨æ„æˆå¯¹æ•°å­—ä¸ä¸€å®šæ˜¯ç›¸é‚»çš„ï¼Œå¦‚æœ 2ã€3ã€4ã€3ã€4ã€2ã€..ï¼Œç”±äºæ„å¤–æœ‰ä¸€ä¸ªæ•°å­—æ¶ˆå¤±äº†ï¼Œå¦‚ä½•å°½å¿«æ‰¾åˆ°æ˜¯å“ªä¸ªæ•°å­—æ¶ˆå¤±äº†ï¼Ÿ æ€è·¯ï¼šè€ƒè™‘ ^ å¼‚æˆ–æ“ä½œçš„å®šä¹‰ï¼Œå½“ä¸¤ä¸ªæ“ä½œçš„æ•°å¯¹åº”ä½ä¸ç›¸åŒæ—¶ï¼Œæ”¹æ•°çš„å¯¹åº”ä½å°±ä¸º1ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæ˜¯ç›¸ç­‰çš„ä¸¤ä¸ªæ•° ^å¼‚æˆ–ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ 0ï¼Œè€Œ 0 ä¸ä»»ä½•æ•°å­— ^å¼‚æˆ–ï¼Œå¾—åˆ°çš„æ˜¯é‚£ä¸ªæ•°å­—æœ¬èº«ã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å°†æ‰€æœ‰çš„æ•°å­—åš ^å¼‚æˆ–æ“ä½œï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæ•°å­—æ¶ˆå¤±ï¼Œé‚£ä¹ˆå…¶ä»–ä¿©ä¿©å‡ºç°çš„æ•°å­— ^å¼‚æˆ–åä¸º0ï¼Œ0ä¸ä»…æœ‰çš„ä¸€ä¸ªçš„æ•°å­—åš ^å¼‚æˆ–ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†æ¶ˆå¤±çš„æ•°å­—æ˜¯å“ªä¸ªï¼Ÿ 123456789// ç¼ºå¤±çš„æ•°å­—func findLostNum(nums:[UInt]) -&gt; UInt &#123; var lostNum:UInt = 0 for num in nums &#123; lostNum = lostNum ^ num &#125; return lostNum&#125;findLostNum(nums: [1,3,2,4,2,1,3]) å¦‚æœæœ‰ä¸¤ä¸ªæ•°å­—æ„å¤–ä¸¢å¤±äº†ï¼ˆä¸¢å¤±çš„ä¸æ˜¯ç›¸ç­‰çš„æ•°å­—ï¼‰ï¼Œæ”¹å¦‚ä½•æ‰¾åˆ°ä¸¢å¤±çš„ä¸¤ä¸ªæ•°å­—ï¼Ÿ æ€è·¯ï¼šå‡è®¾é¢˜ç›®ä¸­è¿™ä¸¤ä¸ªåªå‡ºç°1æ¬¡çš„æ•°å­—åˆ†åˆ«æ˜¯Aå’ŒBï¼Œå¦‚æœèƒ½å°†Aï¼ŒBåˆ†å¼€åˆ°äºŒä¸ªæ•°ç»„ä¸­ï¼Œé‚£æ˜¾ç„¶ç¬¦åˆ å¼‚æˆ– è§£æ³•çš„å…³é”®ç‚¹äº†ï¼Œå› æ­¤è¿™ä¸ªé¢˜ç›®çš„å…³é”®ç‚¹äº‹å°†Aå’ŒBåˆ†å¼€åˆ°äºŒä¸ªæ•°ç»„ä¸­ã€‚ç”±äºAï¼ŒBè‚¯å®šæ˜¯ä¸ç›¸ç­‰çš„ï¼Œå› æ­¤åœ¨äºŒè¿›åˆ¶ä¸Šè‚¯å®šæœ‰ä¸€ä½æ˜¯ä¸åŒçš„ã€‚æ ¹æ®è¿™ä¸€ä½æ˜¯ 0 è¿˜æ˜¯ 1 å¯ä»¥å°†Aå’ŒBåˆ†å¼€åˆ°Aç»„åˆBç»„ã€‚è€Œè¿™ä¸ªæ•°ç»„ä¸­å…¶å®ƒæ•°å­—é‚£ä¹ˆå°±å±äºAç»„ï¼Œè¦ä¹ˆå°±å±äºBç»„ã€‚å†å¯¹Aç»„ å’Œ Bç»„ åˆ†åˆ«æ‰§è¡Œ å¼‚æˆ– è§£æ³•ï¼Œå°±å¯ä»¥å¾—åˆ°A,Bäº†ã€‚è€Œè¦åˆ¤æ–­Aï¼ŒBåœ¨å“ªä¸€ä½ä¸Šä¸ç›¸åŒï¼Œåªè¦æ ¹æ® A ^ B çš„ç»“æœå°±å¯ä»¥çŸ¥é“äº†ï¼Œè¿™ä¸ªç»“æœåœ¨äºŒè¿›åˆ¶ä¸Šä¸º 1 çš„ä½éƒ½è¯´æ˜ Aï¼ŒBåœ¨è¿™ä¸€ä½ä¸Šæ˜¯ä¸åŒçš„ 12345678910111213141516171819202122232425// ä¸¢å¤±çš„ä¸¤ä¸ªä¸åŒæ•°func findTwoLostNum(nums:[UInt]) -&gt; (UInt,UInt) &#123; var lostNum1:UInt = 0 var lostNum2:UInt = 0 var temp:UInt = 0 // è®¡ç®—ä¸¤ä¸ªæ•°çš„å¼‚æˆ–ç»“æœ for num in nums &#123; temp = temp ^ num &#125; // æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸º 1 çš„ä½ var flag:UInt = 1 while ((flag &amp; temp) == 0) &#123; flag = flag &lt;&lt; 1 &#125; // æ‰¾åˆ°ä¸¤ä¸ªä¸¢å¤±çš„æ•°å­— for num in nums &#123; if (num &amp; flag) == 0 &#123; lostNum1 = lostNum1 ^ num &#125;else &#123; lostNum2 = lostNum2 ^ num &#125; &#125; return (lostNum1,lostNum2)&#125;findTwoLostNum(nums: [1,2,3,4,2,1])","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 17ï¼šä½è¿ç®—ç¬¦","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 17ï¼šä½è¿ç®—ç¬¦","date":"2023-02-22T17:32:26.000Z","updated":"2023-03-09T07:23:37.782Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 17ï¼šä½è¿ç®—ç¬¦/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A017%EF%BC%9A%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/","excerpt":"","text":"ä½å–åè¿ç®—ç¬¦ ä½å–åè¿ç®—ç¬¦ ~ æ˜¯å¯¹æ‰€æœ‰ä½çš„æ•°å­—è¿›è¡Œå–åæ“ä½œ 123let n1:UInt8 = 255let n2 = ~n1print(n2) ä½ä¸è¿ç®—ç¬¦ ä½ä¸è¿ç®—ç¬¦ &amp; å¯ä»¥å¯¹ä¸¤ä¸ªæ•°çš„æ¯”ç‰¹ä½è¿›è¡Œåˆå¹¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ï¼Œåªæœ‰å½“è¿™ä¸¤ä¸ªæ•°éƒ½æ˜¯ 1 æ—¶æ‰èƒ½è¿”å› 1 123456let n1:UInt8 = 255let n2 = ~n1let n3 = n1 &amp; n2let n4 = n1 | n2print(n3)print(n4) ä½æˆ–è¿ç®—ç¬¦ ä½æˆ–è¿ç®—ç¬¦ | å¯ä»¥å¯¹ä¸¤ä¸ªæ¯”ç‰¹ä½è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„æ•°ï¼Œåªè¦ä¸¤ä¸ªæ“ä½œä½ä»»æ„ä¸€ä¸ªä¸º 1 æ—¶ï¼Œé‚£ä¹ˆå¯¹åº”çš„ä½æ•°å°±ä¸º 1 ä½å¼‚æˆ–è¿ç®—ç¬¦ ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼Œæˆ–è€…è¯´ äº’æ–¥æˆ– ^ å¯ä»¥å¯¹ä¸¤ä¸ªæ•°çš„æ¯”ç‰¹ä½è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒè¿”å›ä¸€ä¸ªæ–°çš„æ•°ï¼Œå½“ä¸¤ä¸ªæ“ä½œæ•°çš„å¯¹åº”ä½ä¸åŒæ—¶ï¼Œè¯¥æ•°çš„å¯¹åº”ä½å°±ä¸º 1 1234let n1:UInt8 = 255let n2 = ~n1let n5 = n1 ^ n2print(n5) ä½å·¦ç§»å’Œå³ç§»è¿ç®—ç¬¦ ä½å·¦ç§»è¿ç®—ç¬¦ &lt;&lt; å’Œä½å³ç§»è¿ç®—ç¬¦ &gt;&gt; å¯ä»¥æŠŠæ‰€æœ‰ä½æ•°çš„æ•°å­—å‘å·¦æˆ–å‘å³ç§»åŠ¨ä¸€ä¸ªç¡®å®šçš„ä½æ•° ä½ å·¦ç§»å’Œå³ç§» å…·æœ‰ç»™ æ•´æ•°ä¹˜ä»¥æˆ–é™¤ä»¥äºŒ çš„æ•ˆæœï¼Œå°†ä¸€ä¸ªæ•° å·¦ç§» ä¸€ä½ç›¸å½“äºæŠŠè¿™ä¸ª æ•°ç¿»å€ï¼Œå°†ä¸€ä¸ªæ•° å³ç§» ç›¸å½“äºæŠŠè¿™ä¸ªæ•° å‡åŠ æ— ç¬¦å·æ•´æ•°çš„ä½ç§»æ“ä½œ å·²ç»å­˜åœ¨çš„æ¯”ç‰¹ä½æŒ‰æŒ‡å®šçš„ä½æ•°è¿›è¡Œå·¦ç§»å’Œå³ç§» ä»»ä½•ç§»åŠ¨è¶…å‡ºæ•´å‹å­˜å‚¨è¾¹ç•Œçš„ä½éƒ½ä¼šè¢«ä¸¢å¼ƒ ç”¨ 0 æ¥å¡«å……å‘å·¦æˆ–å‘å³ç§»åŠ¨åäº§ç”Ÿçš„ç©ºç™½ä½ æœ‰ç¬¦å·æ•´æ•°çš„ä½ç§»æ“ä½œ æœ‰ç¬¦å·æ•´æ•°ä½¿ç”¨å®ƒçš„ç¬¬ä¸€ä½ï¼ˆæ‰€è°“çš„ç¬¦å·ä½ï¼‰æ¥è¡¨ç¤ºè¿™ä¸ªæ•´æ•°æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œç¬¦å·ä½ 0 è¡¨ç¤º æ­£æ•°ï¼Œ1 è¡¨ç¤º è´Ÿæ•° å…¶ä½™çš„ä½æ•°ï¼ˆæ‰€è°“çš„æ•°å€¼ä½ï¼‰å­˜å‚¨äº†å®é™…çš„å€¼ï¼Œæœ‰ç¬¦å·æ­£æ•´æ•°å’Œæ— ç¬¦å·æ•°çš„å­˜å‚¨æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä» 0 å¼€å§‹ç®—èµ· ä½†æ˜¯è´Ÿæ•°çš„å­˜å‚¨æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œå®ƒå­˜å‚¨çš„æ˜¯ 2 çš„ n æ¬¡æ–¹å‡å»å®ƒçš„ç»å¯¹å€¼ï¼Œè¿™é‡Œçš„ n ä¸ºæ•°å€¼ä½çš„ä½æ•° ç¤ºä¾‹ï¼š 123let n6: Int = 8print(n6 &lt;&lt; 1)print(n6 &gt;&gt; 1) è¡¥ç è¡¨ç¤ºçš„ä¼˜ç‚¹ é¦–å…ˆï¼Œå¦‚æœæƒ³ç»™ -4 åŠ ä¸ª -1ï¼Œåªéœ€è¦å°†è¿™ä¸¤ä¸ªæ•°çš„å…¨éƒ¨ 8 ä¸ªæ¯”ç‰¹ä½ç›¸åŠ ï¼ˆåŒ…æ‹¬ç¬¦å·ä½ï¼‰ï¼Œå¹¶ä¸”å°†è®¡ç®—ç»“æœä¸­è¶…å‡ºçš„éƒ¨åˆ†ä¸¢æ‰ å…¶æ¬¡ï¼Œä½¿ç”¨äºŒè¿›åˆ¶è¡¥ç å¯ä»¥ä½¿è´Ÿæ•°ä½çš„ä½å·¦ç§»å’Œå³ç§»æ“ä½œå¾—åˆ°æ ¹æ­£æ•°åŒæ ·çš„æ•ˆæœï¼Œå³æ¯å‘å·¦ç§»ä¸€ä½å°±å°†è‡ªèº«çš„æ•°å€¼ ä¹˜ä»¥2 ï¼Œæ¯å‘å³ç§»ä¸€ä½å°±å°†è‡ªèº«çš„æ•°å€¼ é™¤ä»¥2ï¼Œè¦è¾¾åˆ°æ­¤ç›®çš„ï¼Œå¯¹ æœ‰ç¬¦å·çš„æ•´æ•° çš„å³ç§»æœ‰ä¸€ä¸ªé¢å¤–çš„è§„åˆ™ï¼šå½“å¯¹æ•´æ•°è¿›è¡Œä½å³ç§»æ“ä½œæ—¶ï¼Œéµå¾ªä¸æ— ç¬¦å·æ•´æ•°ç›¸åŒçš„è§„åˆ™ï¼Œä½†æ˜¯å¯¹äºä½ç§»äº§ç”Ÿçš„ç©ºç™½ä½ä½¿ç”¨ç¬¦å·è¿›è¡Œå¡«å……ï¼Œè€Œä¸æ˜¯ 0","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 16ï¼šåŒºé—´è¿ç®—ç¬¦","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 16ï¼šåŒºé—´è¿ç®—ç¬¦","date":"2023-02-22T17:32:10.000Z","updated":"2023-03-09T07:23:34.627Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 16ï¼šåŒºé—´è¿ç®—ç¬¦/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A016%EF%BC%9A%E5%8C%BA%E9%97%B4%E8%BF%90%E7%AE%97%E7%AC%A6/","excerpt":"","text":"é—­åŒºé—´è¿ç®—ç¬¦ é—­åŒºé—´è¿ç®—ç¬¦ a...b å®šä¹‰äº†ä» a åˆ° b çš„ä¸€ç»„èŒƒå›´ï¼Œå¹¶ä¸”åŒ…å« a å’Œ b ï¼Œa çš„å€¼ä¸èƒ½å¤§äº b 12345// é—­åŒºé—´let range = 0...5for index in range &#123; print(index)&#125; åŠå¼€åŒºé—´è¿ç®—ç¬¦ åŠå¼€åŒºé—´è¿ç®—ç¬¦ a..&lt;b å®šä¹‰äº†ä» a åˆ° b ä½†ä¸åŒ…æ‹¬ b çš„åŒºé—´ 12345// åŠå¼€åŠé—­åŒºé—´let range = 0..&lt;5for index in range &#123; print(index)&#125; å¦‚åŒé—­åŒºé—´è¿ç®—ç¬¦ï¼Œa çš„å€¼ä¹Ÿä¸èƒ½å¤§äº b ï¼Œå¦‚æœ a ä¸ b çš„å€¼ç›¸ç­‰ï¼Œé‚£è¿”å›çš„åŒºé—´å°†ä¼šæ˜¯ç©ºçš„ å•ä¾§åŒºé—´ é—­åŒºé—´è¿ç®—ç¬¦æœ‰å¦å¤–ä¸€ç§å½¢å¼æ¥è®©åŒºé—´æœä¸€ä¸ªæ–¹å‘å°½å¯èƒ½çš„è¿œï¼Œè¿™ç§åŒºé—´å«åšå•ä¾§åŒºé—´ 12345// å•ä¾§é—­åŒºé—´let names = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]for name in names[...2] &#123; print(name)&#125; åŠå¼€åŒºé—´è¿ç®—ç¬¦åŒæ ·å¯ä»¥æœ‰å•ä¾§å½¢å¼ï¼Œåªéœ€è¦å†™å®ƒæœ€ç»ˆçš„å€¼ 12345// å•ä¾§åŠå¼€åŠé—­åŒºé—´let names = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]for name in names[..&lt;2] &#123; print(name)&#125; æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªåŒ…å«æ•°ç»„æ‰€æœ‰å…ƒç´ çš„åŒºé—´ï¼Œä»ç´¢å¼• 2 åˆ°æ•°ç»„çš„ç»“æŸï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥çœç•¥åŒºé—´è¿ç®—ç¬¦ä¸€ä¾§çš„å€¼ 123for name in names[2...] &#123; print(name)&#125; å•ä¾§åŒºé—´å¯ä»¥å†å…¶ä»–ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ï¼Œä¸ä»…ä»…æ˜¯ä¸‹æ ‡ ä¸èƒ½å˜é‡çœç•¥äº†ç¬¬ä¸€ä¸ªå€¼çš„å•ä¾§åŒºé—´ï¼Œå› ä¸ºéå†æ ¹æœ¬ä¸çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹ï¼Œä½ å¯ä»¥éå†çœç•¥äº†æœ€ç»ˆå€¼çš„å•ä¾§åŒºé—´ å­—ç¬¦ä¸²ç´¢å¼•åŒºé—´ å­—ç¬¦ä¸²èŒƒå›´å¯ä»¥ä½¿ç”¨åŒºé—´è¿ç®—ç¬¦ 12345// å­—ç¬¦ä¸²ç´¢å¼•åŒºé—´var str = &quot;hello,world&quot;let range = str.startIndex...str.index(str.endIndex, offsetBy: -6)str.removeSubrange(range)print(str) å€’å™ç´¢å¼• é€šè¿‡ reversed() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ­£åºå¾ªç¯å˜æˆé€†åºå¾ªç¯ 1234// é€†åºfor i in (0...4).reversed() &#123; print(i)&#125; Comparable åŒºåˆ« åŒºé—´è¿ç®—ç¬¦å¯ä»¥ä½œç”¨åœ¨ Comparable ç±»å‹ä¸Šï¼Œè¿”å›é—­åŒºé—´å’ŒåŠé—­åŒºé—´ 1234567var str = &quot;hello,world&quot;let range = &quot;a&quot;...&quot;z&quot;for c:Character in str &#123; if !range.contains(String(c)) &#123; print(&quot;\\(c) ä¸æ˜¯å°å†™å­—ç¬¦&quot;) &#125; &#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 15ï¼šä¸ºäº†Optionalï¼Œåˆå¹¶ç©ºç½®è¿ç®—ç¬¦","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 15ï¼šä¸ºäº†Optionalï¼Œåˆå¹¶ç©ºç½®è¿ç®—ç¬¦","date":"2023-02-22T17:31:50.000Z","updated":"2023-03-09T07:23:29.080Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 15ï¼šä¸ºäº†Optionalï¼Œåˆå¹¶ç©ºç½®è¿ç®—ç¬¦/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A015%EF%BC%9A%E4%B8%BA%E4%BA%86Optional%EF%BC%8C%E5%90%88%E5%B9%B6%E7%A9%BA%E7%BD%AE%E8%BF%90%E7%AE%97%E7%AC%A6/","excerpt":"","text":"åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦ åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦ a ?? b å¦‚æœå¯é€‰é¡¹ a æœ‰å€¼åˆ™å±•å¼€ï¼Œå¦‚æœæ²¡æœ‰å€¼æ˜¯ nilï¼Œåˆ™è¿”å›é»˜è®¤å€¼ b è¡¨è¾¾å¼ a å¿…é¡»æ˜¯ä¸€ä¸ªå¯é€‰ç±»å‹ï¼Œè¡¨è¾¾å¼ b å¿…é¡»ä¸ a çš„å­˜å‚¨ç±»å‹ç›¸åŒ å®é™…ä¸Šæ˜¯ ä¸‰å…ƒè¿ç®—ç¬¦ ä½œç”¨åˆ° Optional ä¸Šçš„ç¼©å†™ a != nil ? a : b å¦‚æœ a çš„å€¼æ˜¯éç©ºçš„ï¼Œb çš„å€¼å°†ä¸ä¼šè¢«è€ƒè™‘ï¼Œä¹Ÿå°±æ˜¯åˆå¹¶ç©ºå€¼è¿ç®—ç¬¦æ˜¯çŸ­è·¯çš„ å¯é€‰å€¼ä¸ºnilæ—¶ï¼Œä¸èƒ½å¼ºåˆ¶è§£åŒ… å¯ä»¥ç”¨ if åˆ¤æ–­å®ç° 123456789101112131415161718let a:Int? = nillet b = 2func sum(x:Int?,y:Int?) -&gt; Int&#123;// return x! + y! if x != nil &#123; if y != nil &#123; return x! + y! &#125;else &#123; return x! &#125; &#125;else &#123; if y != nil &#123; return y! &#125;else &#123; return 0 &#125; &#125;&#125; ä¹Ÿå¯ä»¥ç”¨ ?? æ¥å®ç° 1return (a ?? 0) + b","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 14ï¼šåœ¨Swifté‡Œå¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 14ï¼šåœ¨Swifté‡Œå¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º","date":"2023-02-22T17:31:22.000Z","updated":"2023-03-09T07:23:25.105Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 14ï¼šåœ¨Swifté‡Œå¦‚ä½•å¤„ç†ç®—æœ¯ç»“æœæº¢å‡º/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A014%EF%BC%9A%E5%9C%A8Swift%E9%87%8C%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E7%AE%97%E6%9C%AF%E7%BB%93%E6%9E%9C%E6%BA%A2%E5%87%BA/","excerpt":"","text":"æº¢å‡ºè¿ç®—ç¬¦ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“å‘ä¸€ä¸ªæ•´æ•°èµ‹è¶…å‡ºå®ƒå®¹é‡çš„å€¼æ—¶ï¼Œswift ä¼šæŠ¥é”™è€Œä¸æ˜¯ç”Ÿæˆä¸€ä¸ªæ— æ•ˆçš„æ•°ï¼Œç»™æˆ‘ä»¬æ“ä½œè¿‡å¤§æˆ–è¿‡å°çš„æ•°æ—¶æä¾›äº†é¢å¤–çš„å®‰å…¨æ€§ åŒæ—¶æä¾›ä¸‰ä¸ªç®—æœ¯æº¢å‡ºè¿ç®—ç¬¦æ¥è®©ç³»ç»Ÿæ”¯æŒæ•´æ•°æº¢å‡ºè¿ç®— æº¢å‡ºåŠ æ³• &amp;+ æº¢å‡ºå‡æ³• &amp;- æº¢å‡ºä¹˜æ³• &amp;* å€¼æº¢å‡º æ•°å€¼å¯ä»¥å‡ºç°å‘ä¸Šæº¢å‡ºæˆ–å‘ä¸‹æº¢å‡º æº¢å‡ºä¹Ÿä¼šå‘ç”Ÿåœ¨æœ‰ç¬¦å·æ•´å‹æ•°å€¼ä¸Š å¯¹äºæ— ç¬¦å·ä¸æœ‰ç¬¦å·æ•´å‹æ•°å€¼æ¥è¯´ï¼Œå½“å‡ºç°æº¢å‡ºæ—¶ï¼Œå®ƒä»¬ä¼šä»æ•°å€¼æ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°å˜æˆæœ€å°çš„æ•°ï¼ŒåŒæ ·çš„ï¼Œå½“å‘ç”Ÿä¸‹æº¢æ—¶ï¼Œå®ƒä»¬ä¼šä»æ‰€èƒ½å®¹çº³çš„æœ€å°æ•°å˜æˆæœ€å¤§çš„æ•° ä»£ç ç¤ºä¾‹ ä¸Šæº¢å‡º ä¸‹æº¢å‡º","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 13ï¼šèµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 13ï¼šèµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦","date":"2023-02-22T17:30:48.000Z","updated":"2023-03-09T07:23:22.923Z","comments":true,"path":"2023/02/23/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 13ï¼šèµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦/","link":"","permalink":"https://www.bboyzj.cn/2023/02/23/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A013%EF%BC%9A%E8%B5%8B%E5%80%BC%E5%92%8C%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6/","excerpt":"","text":"åŸºæœ¬æ¦‚å¿µ ä¸€å…ƒè¿ç®—ç¬¦å¯¹ä¸€ä¸ªç›®æ ‡è¿›è¡Œæ“ä½œã€‚ä¸€å…ƒå‰ç¼€è¿ç®—ç¬¦ï¼ˆå¦‚!bï¼‰ï¼Œä¸€å…ƒåç¼€è¿ç®—ç¬¦ï¼ˆb!ï¼‰ äºŒå…ƒè¿ç®—ç¬¦å¯¹ä¸¤ä¸ªç›®æ ‡è¿›è¡Œæ“ä½œï¼ˆa+bï¼‰åŒæ—¶å› ä¸ºå®ƒä»¬å‡ºç°åœ¨ä¸¤ä¸ªç›®æ ‡ä¹‹é—´ï¼Œæ‰€ä»¥æ˜¯ä¸­ç¼€ ä¸‰å…ƒè¿ç®—ç¬¦æ“ä½œä¸‰ä¸ªç›®æ ‡ï¼Œswift è¯­è¨€ä¹Ÿä»…æœ‰ä¸€ä¸ª ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œä¸‰å…ƒæ¡ä»¶è¿ç®—ç¬¦ï¼ˆa?b:cï¼‰ swift è¿ç®—ç¬¦çš„æ”¹è¿› swiftåœ¨æ”¯æŒ c ä¸­çš„å¤§å¤šæ•°æ ‡å‡†è¿ç®—ç¬¦çš„åŒæ—¶ä¹Ÿå¢åŠ äº†ä¸€äº›æ’é™¤å¸¸è§ä»£ç é”™è¯¯çš„èƒ½åŠ› èµ‹å€¼ç¬¦å· = ä¸ä¼šè¿”å›å€¼ï¼Œä»¥é˜²æ­¢å®ƒè¢«æ— ç”¨äºç­‰äºç¬¦å· == ç®—æœ¯ç¬¦å· +ã€-ã€*ã€/ã€% ä»¥åŠå…¶ä»–å¯ä»¥ç›‘æµ‹å¹¶é˜»æ­¢å€¼æº¢å‡ºï¼Œä»¥é¿å…ä½ åœ¨æ“ä½œæ¯”å­˜å‚¨ç±»å‹å…è®¸çš„èŒƒå›´æ›´å¤§æˆ–æ›´å°çš„æ•°å­—æ—¶å¾—åˆ°å„ç§å¥‡æ€ªçš„ç»“æœ èµ‹å€¼è¿ç®—ç¬¦ èµ‹å€¼è¿ç®—ç¬¦å°†ä¸€ä¸ªå€¼èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªå€¼ å¦‚æœèµ‹å€¼ç¬¦å·å³ä¾§æ˜¯æ‹¥æœ‰å¤šä¸ªå€¼çš„å…ƒç»„ï¼Œå®ƒçš„å…ƒç´ å°†ä¼šä¸€æ¬¡æ€§åœ°æ‹†åˆ†æˆå¸¸é‡æˆ–è€…å˜é‡ Swift çš„èµ‹å€¼ç¬¦å·è‡ªèº«ä¸ä¼šè¿”å›å€¼ ç®—æœ¯è¿ç®—ç¬¦-æ ‡å‡†è¿ç®—ç¬¦ æ ‡å‡†ç®—æœ¯è¿ç®—ç¬¦ + - * / ç®—æœ¯è¿ç®—ç¬¦åŒæ—¶ä¹Ÿæ”¯æŒ String çš„æ‹¼æ¥ swift ç®—æœ¯è¿ç®—ç¬¦é»˜è®¤ä¸å…è®¸å€¼æº¢å‡º ç®—æœ¯è¿ç®—ç¬¦ - ä½™æ•°è¿ç®—ç¬¦ ä½™æ•°è¿ç®—ç¬¦ a%b å¯ä»¥æ±‚å‡ºå¤šå°‘ä¸ª b çš„å€æ•°èƒ½å¤Ÿåˆšå¥½æ”¾è¿› a ä¸­å¹¶ä¸”è¿”å›å‰©ä¸‹çš„å€¼ï¼ˆå°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„ä½™æ•°ï¼‰ å½“ a æ˜¯è´Ÿæ•°æ—¶ä¹Ÿé€‚ç”¨ç›¸åŒçš„æ–¹æ³•æ¥è¿›è¡Œè®¡ç®— å½“ b ä¸ºè´Ÿæ•°æ—¶å®ƒçš„æ­£è´Ÿå·è¢«å¿½ç•¥æ‰ã€‚è¿™æ„å‘³ç€ a%b ä¸ a%-b èƒ½å¤Ÿè·å¾—ç›¸åŒçš„ç­”æ¡ˆ 12345678let c = 9 % 4print(c)let d = 9 % -4print(d)let e = -9 % 4print(e) ç®—æœ¯è¿ç®—ç¬¦ - ä¸€å…ƒ æ•°å­—å€¼çš„æ­£è´Ÿå·å¯ä»¥ç”¨å‰ç¼€ - æ¥åˆ‡æ¢ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€å…ƒå‡å·è¿ç®—ç¬¦ ä¸€å…ƒå‡å·è¿ç®—ç¬¦ - ç›´æ¥åœ¨è¦è¿›è¡Œæ“ä½œçš„å€¼å‰è¾¹æ”¾ç½®ï¼Œä¸åŠ ä»»ä½•ç©ºæ ¼ ä¸€å…ƒåŠ å·è¿ç®—ç¬¦ + ç›´æ¥è¿”å›å®ƒæ“ä½œçš„å€¼ï¼Œä¸ä¼šå¯¹å…¶è¿›è¡Œä»»ä½•çš„ä¿®æ”¹","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 12ï¼šè·å–å­ä¸²å’Œå­—ç¬¦ä¸²æ¯”è¾ƒ","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 12ï¼šè·å–å­ä¸²å’Œå­—ç¬¦ä¸²æ¯”è¾ƒ","date":"2023-02-21T18:59:39.000Z","updated":"2023-03-09T07:23:19.900Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 12ï¼šè·å–å­ä¸²å’Œå­—ç¬¦ä¸²æ¯”è¾ƒ/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A012%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%AD%90%E4%B8%B2%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83/","excerpt":"","text":"å­å­—ç¬¦ä¸² ä½¿ç”¨ä¸‹æ ‡æˆ–è€…ç±»ä¼¼ prefix(_:) çš„æ–¹æ³•å¾—åˆ°çš„å­å­—ç¬¦ä¸²æ˜¯ Substring ç±»å‹ Substring æ‹¥æœ‰ String çš„å¤§éƒ¨åˆ†æ–¹æ³• Substring å¯ä»¥è½¬æˆ String ç±»å‹ 1234let str = &quot;hello,world&quot;let index = str.firstIndex(of: &quot;,&quot;) ?? str.endIndexlet begin = str[..&lt;index]let new = String(begin) å­å­—ç¬¦ä¸²é‡ç”¨ä¸€éƒ¨åˆ†åŸå­—ç¬¦ä¸²çš„å†…å­˜ ä¿®æ”¹å­—ç¬¦ä¸²æˆ–å­å­—ç¬¦ä¸²ä¹‹å‰éƒ½ä¸éœ€è¦èŠ±è´¹æ‹·è´å†…å­˜çš„ä»£ä»· String å’Œ Substring éƒ½éµå¾ª StringProtocol åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåŸºæœ¬ä¸Šéƒ½èƒ½å¾ˆæ–¹ä¾¿çš„å…¼å®¹æ‰€æœ‰æ¥å— StringProtocol å€¼çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•° å­—ç¬¦ä¸²çš„æ¯”è¾ƒ å­—ç¬¦ä¸²å’Œå­—ç¬¦ç›¸ç­‰æ€§ == å’Œ != å‰ç¼€ç›¸ç­‰æ€§ hasPrefis(_:) åç¼€ç›¸ç­‰æ€§ hasSubffix(_:) 12345var str1 = &quot;1&quot;var str2 = &quot;2&quot;print(str1 == str2)print(str1.hasPrefix(&quot;1&quot;))print(str2.hasSuffix(&quot;2&quot;))","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 11ï¼šç´¢å¼•è®¿é—®å’Œä¿®æ”¹å­—ç¬¦ä¸²","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 11ï¼šç´¢å¼•è®¿é—®å’Œä¿®æ”¹å­—ç¬¦ä¸²","date":"2023-02-21T18:59:05.000Z","updated":"2023-03-09T07:23:17.616Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 11ï¼šç´¢å¼•è®¿é—®å’Œä¿®æ”¹å­—ç¬¦ä¸²/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A011%EF%BC%9A%E7%B4%A2%E5%BC%95%E8%AE%BF%E9%97%AE%E5%92%8C%E4%BF%AE%E6%94%B9%E5%AD%97%E7%AC%A6%E4%B8%B2/","excerpt":"","text":"å­—ç¬¦ä¸²ç´¢å¼• æ¯ä¸€ä¸ª String å€¼éƒ½æœ‰ç›¸å…³çš„ç´¢å¼•ç±»å‹ï¼ŒString.Indexï¼Œä»–ç›¸å½“äºæ¯ä¸ª Character åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½® startIndex å±æ€§æ¥è®¿é—® String ä¸­ç¬¬ä¸€ä¸ª Character çš„ä½ç½®ã€‚endIndex å±æ€§å°±æ˜¯ String ä¸­æœ€åä¸€ä¸ªå­—ç¬¦ä¸²çš„ä½ç½® endIndex å±æ€§å¹¶ä¸æ˜¯å­—ç¬¦ä¸²ä¸‹æ ‡è„šæœ¬çš„åˆæ³•å®é™…å‚æ•° å¦‚æœ String ä¸ºç©ºï¼Œåˆ™ startIndex ä¸ endIndex ç›¸ç­‰ ä½¿ç”¨ index(before:) å’Œ index(after:) æ–¹æ³•æ¥è®¿é—®ç»™å®šç´¢å¼•çš„å‰å è¦è®¿é—®ç»™å®šç´¢å¼•æ›´è¿œçš„ç´¢å¼•ï¼Œä½ å¯ä»¥ä½¿ç”¨ index(_:offetBy:) ä½¿ç”¨ indices å±æ€§æ¥è®¿é—®å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦çš„ç´¢å¼• 123456var greeting = &quot;Hello, playground&quot;greeting[greeting.startIndex]greeting[greeting.index(before: greeting.endIndex)]greeting[greeting.index(after: greeting.startIndex)]let index = greeting.index(greeting.startIndex, offsetBy: 7)greeting[index] æ’å…¥ æ’å…¥å­—ç¬¦ï¼Œä½¿ç”¨ insert(_:at:) æ–¹æ³• æ’å…¥åˆ°å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹åˆ°ç‰¹å®šçš„ç´¢å¼•ï¼Œä½¿ç”¨ insert(contentsOf:at:) æ–¹æ³• 1234var str = &quot;hello&quot;str.insert(&quot;!&quot;, at: str.endIndex)str.insert(contentsOf: &quot; world&quot;, at: str.firstIndex(of: &quot;!&quot;)!)print(str) åˆ é™¤ ç§»é™¤å­—ç¬¦ï¼Œä½¿ç”¨ remove(at:) æ–¹æ³• 12var str = &quot;hello&quot;str.remove(at: str.index(before: str.endIndex)) ç§»é™¤ä¸€å°æ®µç‰¹å®šèŒƒå›´çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ removeSubrange(_:) æ–¹æ³• 123var str = &quot;hello&quot;let range = str.index(str.endIndex, offsetBy: -str.count)..&lt;str.endIndexstr.removeSubrange(range)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 10ï¼šå­—ç¬¦ä¸²å¸¸è§æ“ä½œ","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 10ï¼šå­—ç¬¦ä¸²å¸¸è§æ“ä½œ","date":"2023-02-21T18:58:45.000Z","updated":"2023-03-09T07:23:15.658Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 10ï¼šå­—ç¬¦ä¸²å¸¸è§æ“ä½œ/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A010%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/","excerpt":"","text":"å­—ç¬¦ä¸²çš„å¯å˜æ€§ var æŒ‡å®šçš„å¯ä»¥ä¿®æ”¹ let æŒ‡å®šçš„ä¸å¯ä¿®æ”¹ å¯¹æ¯” Object-C (NSString å’Œ NSMutableString) å­—ç¬¦ä¸²æ˜¯ å€¼ç±»å‹ String å€¼åœ¨ä¼ é€’ç»™æ–¹æ³•æˆ–å‡½æ•°çš„æ—¶å€™ä¼šè¢«å¤åˆ¶è¿‡å» èµ‹å€¼ç»™å¸¸é‡æˆ–å˜é‡çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ · Swift ç¼–è¯‘å™¨ä¼˜åŒ–äº†å­—ç¬¦ä¸²ä½¿ç”¨çš„èµ„æºï¼Œå®é™…ä¸Šæ‹·è´åªä¼šåœ¨ç¡®å®éœ€è¦çš„æ—¶å€™æ‰è¿›è¡Œ 123456var str1 = &quot;hello&quot;var str2 = str1print(str1 == str2)str1.append(&quot;,world&quot;)print(str1)print(str2) æ“ä½œå­—ç¬¦ for in å¾ªç¯éå† String ä¸­çš„æ¯ä¸€ä¸ªç‹¬ç«‹çš„ Character Character ç±»å‹ String å€¼å¯ä»¥é€šè¿‡ä¼ å…¥ Character æ•°ç»„æ¥æ„é€  1234var str = &quot;hello&quot;for c in str&#123; print(c)&#125; å­—ç¬¦ä¸²çš„æ‹¼æ¥ ä½¿ç”¨åŠ è¿ç®—ç¬¦ + åˆ›å»ºæ–°å­—ç¬¦ä¸² ä½¿ç”¨ + èµ‹å€¼ç¬¦å· += åœ¨å·²ç»å­˜åœ¨çš„ String å€¼æœ«å°¾è¿½åŠ ä¸€ä¸ª String å€¼ ä½¿ç”¨ String ç±»å‹çš„ append() æ–¹æ³•æ¥å¯ä»¥ç»™ä¸€ä¸ª String å˜é‡çš„æœ«å°¾è¿½åŠ  Character å€¼ å­—ç¬¦ä¸²æ’å€¼ å­—ç¬¦ä¸²æ’å€¼æ˜¯ä¸€ç§ä»æ··åˆå¸¸é‡ã€å˜é‡ã€å­—é¢é‡å’Œè¡¨è¾¾å¼çš„å­—ç¬¦ä¸²å­—é¢é‡æ„é€ æ–° String å€¼çš„æ–¹æ³• æ¯ä¸€ä¸ªä½ æ’å…¥åˆ°å­—ç¬¦ä¸²å­—é¢é‡çš„å…ƒç´ éƒ½è¦è¢«ä¸€å¯¹åœ†æ‹¬å·åŒ…è£¹ï¼Œç„¶åä½¿ç”¨åæ–œæ å‰ç¼€ \\() ç±»ä¼¼äº NSString çš„ stringWithFormat æ–¹æ³•ï¼Œä½†æ˜¯æ›´åŠ ç®€ä¾¿ï¼Œæ›´å¼ºå¤§ å¯ä»¥åœ¨æ‰©å±•å­—ç¬¦ä¸²åˆ†å‰²ç¬¦ä¸­åˆ›å»ºä¸€ä¸ªåŒ…å«åœ¨å…¶ä»–æƒ…å†µä¸‹ä¼šè¢«å½“åšå­—ç¬¦ä¸²æ’å€¼çš„å­—ç¬¦ è¦åœ¨ä½¿ç”¨æ‰©å±•åˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼ï¼Œåœ¨åæ–œæ åä½¿ç”¨åŒ¹é…é¦–å°¾äº•å·æ•°é‡çš„äº•å· 12let str = &quot;6 * 7 = \\(6 * 7)&quot;print(str)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 09ï¼šå­—ç¬¦ä¸²åˆ›å»ºå’Œä½¿ç”¨","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 09ï¼šå­—ç¬¦ä¸²åˆ›å»ºå’Œä½¿ç”¨","date":"2023-02-21T18:58:24.000Z","updated":"2023-03-09T07:23:11.756Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 09ï¼šå­—ç¬¦ä¸²åˆ›å»ºå’Œä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A009%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"åˆå§‹åŒ–ç©ºä¸² å­—é¢é‡ åˆå§‹åŒ–å™¨è¯­æ³• isEmpty æ£€æŸ¥æ˜¯å¦ä¸ºç©ºä¸² 123456var emptyString = &quot;&quot;var anotherEmptyString = String()if emptyString.isEmpty &#123; print(&quot;Nothing to see here&quot;)&#125; å­—é¢é‡ å­—ç¬¦ä¸²å­—é¢é‡æ˜¯è¢«åŒå¼•å· â€œâ€ åŒ…è£¹çš„å›ºå®šé¡ºåºæ–‡æœ¬å­—ç¬¦ Swift ä¼šä¸º str å¸¸é‡æ¨æ–­ç±»å‹ä¸º String 1let str = &quot;some string&quot; å¤šè¡Œå­—é¢é‡ å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ç”¨ä¸‰ä¸ªåŒå¼•å·å¼•èµ·æ¥çš„ä¸€ç³»åˆ—å­—ç¬¦ å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡æŠŠæ‰€æœ‰è¡ŒåŒ…æ‹¬åœ¨å¼•å·å†…ï¼Œå¼€å§‹å’Œç»“æŸé»˜è®¤ä¸ä¼šæœ‰æ¢è¡Œç¬¦ å¦‚æœä¸ºäº†ä¹¦å†™ç¾è§‚è€Œä¸æ¢è¡Œåœ¨åé¢åŠ  \\ 12345678let someStr = &quot;&quot;&quot;1\\2\\345&quot;&quot;&quot;print(someStr) è¦è®©å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡èµ·å§‹æˆ–ç»“æŸäºæ¢è¡Œï¼Œå°±åœ¨ç¬¬ä¸€æˆ–æœ€åä¸€è¡Œå†™ä¸€ä¸ªç©ºè¡Œ å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ ç¼©è¿› ä»¥åŒ¹é…å‘¨å›´çš„ä»£ç ã€‚åŒå¼•å·ï¼ˆâ€â€â€ï¼‰å‰çš„ç©ºæ ¼ä¼šå‘Šè¯‰Swiftå…¶ä»–è¡Œå‰åº”è¯¥æœ‰å¤šå°‘ç©ºç™½æ˜¯éœ€è¦å¿½ç•¥çš„ å¦‚æœä½ åœ¨æŸè¡Œçš„ç©ºæ ¼è¶…è¿‡äº†ç»“æŸçš„åŒå¼•å·ï¼ˆâ€â€â€ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›ç©ºæ ¼ä¼šè¢«åŒ…å« 12345678 let someStr = &quot;&quot;&quot; 1 2 3 4 5 &quot;&quot;&quot;print(someStr) å­—ç¬¦ä¸²é‡Œçš„ç‰¹æ®Šå­—ç¬¦ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ \\oï¼ˆç©ºå­—ç¬¦ï¼‰,\\ï¼ˆåæ–œæ ï¼‰ï¼Œ\\tï¼ˆæ°´å¹³åˆ¶è¡¨ç¬¦ï¼‰ï¼Œ\\nï¼ˆæ¢è¡Œç¬¦ï¼‰ï¼Œ\\rï¼ˆå›è½¦ç¬¦ï¼‰ï¼Œ\\â€ï¼ˆåŒå¼•å·ï¼‰ä»¥åŠ &#39;ï¼ˆå•å¼•å·ï¼‰ ä»»æ„çš„ Unicode æ ‡é‡ï¼Œå†™ä½œ \\u&#123;&#125;nï¼Œé‡Œè¾¹çš„ n æ˜¯ä¸€ä¸ª 1-8 ä½çš„16è¿›åˆ¶æ•°å­—ï¼Œå…¶å€¼æ˜¯åˆæ³• Unicode å€¼ 1let str = &quot;\\u&#123;24&#125;&quot; å¯ä»¥åœ¨å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡ä¸­åŒ…å«åŒå¼•å·ï¼ˆâ€ï¼‰è€Œä¸éœ€è¦è½¬ä¹‰ã€‚è¦åœ¨å¤šè¡Œå­—ç¬¦ä¸²ä¸­åŒ…å«æ–‡æœ¬ â€œâ€â€â€â€â€ï¼Œè½¬ä¹‰è‡³å°‘ä¸€ä¸ªåŒå¼•å· æ‰©å±•å­—ç¬¦ä¸²åˆ†éš”ç¬¦(Raw String) åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸­æ”¾ç½®æ‰©å±•åˆ†éš”ç¬¦æ¥ä½¿ åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸² ä¸è®©ä»–ä»¬çœŸçš„ç”Ÿæ•ˆ æŠŠå­—ç¬¦ä¸²æ”¾åœ¨åŒå¼•å· (â€œ) å†…å¹¶ç”± (#) åŒ…è£¹ 12let str = #&quot;1\\n2\\n3\\n&quot;#print(str) å¦‚æœå­—ç¬¦ä¸²é‡Œé¢æœ‰ &quot;# åˆ™é¦–å°¾éœ€è¦ä¸¤ä¸ª ## 12let str = ##&quot;1\\&quot;#n2\\#n3\\#n&quot;##print(str) å¦‚æœä½ éœ€è¦å­—ç¬¦ä¸²ä¸­æŸä¸ªç‰¹æ®Šç¬¦å·çš„æ•ˆæœï¼Œä½¿ç”¨åŒ¹é…ä½ åŒ…è£¹çš„ # å·æ•°é‡çš„ # å·ï¼Œå¹¶åœ¨å‰é¢å†™è½¬ä¹‰ç¬¦å· \\ 12let str = #&quot;1\\#n2\\#n3\\#n&quot;#print(str)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 08ï¼šOptionalçš„ä½¿ç”¨Optionalå®ç°åŸç†æ¢ç´¢","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 08ï¼šOptionalçš„ä½¿ç”¨Optionalå®ç°åŸç†æ¢ç´¢","date":"2023-02-21T18:56:00.000Z","updated":"2023-03-09T07:23:09.481Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 08ï¼šOptionalçš„ä½¿ç”¨Optionalå®ç°åŸç†æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A008%EF%BC%9AOptional%E7%9A%84%E4%BD%BF%E7%94%A8Optional%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"Optional-å®ç°æ¢ç©¶ Optional å…¶å®æ˜¯ä¸€ä¸ªæ ‡å‡†åº“é‡Œçš„ä¸€ä¸ª public çš„ enum ç±»å‹ï¼Œè€Œä¸”æ˜¯ æ³›å‹ çš„ï¼Œæ³›å‹çš„ç±»å‹æ˜¯ Wrapped ç”¨æ ‡å‡†åº“å®ç°è¯­è¨€ç‰¹æ€§çš„å…¸å‹ Optional.none å°±æ˜¯ nil Optional.some åˆ™åŒ…è£…äº†å®é™…çš„å€¼ 12345var str:Optional&lt;String&gt; = &quot;abc&quot;if let actualStr = str &#123; let count = actualStr.count print(count)&#125; Optional-è§£åŒ…å®ç° æ³›å‹å±æ€§ unsafelyUnwrapped ç†è®ºä¸Šæˆ‘æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨ unsafelyUnwrapped è·å–å¯é€‰é¡¹çš„å€¼ 123var str:String? = &quot;abc&quot;let count = str.unsafelyUnwrapped.countprint(count)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 07ï¼šOptionalçš„ä½¿ç”¨","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 07ï¼šOptionalçš„ä½¿ç”¨","date":"2023-02-21T18:55:20.000Z","updated":"2023-03-09T07:23:02.713Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 07ï¼šOptionalçš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A007%EF%BC%9AOptional%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"ä¸ºä»€ä¹ˆéœ€è¦ Optionalï¼Ÿ Object-C é‡Œçš„ nil æ˜¯æ— ç±»å‹çš„æŒ‡é’ˆ Object-C é‡Œé¢çš„æ•°ç»„ã€å­—å…¸ã€é›†åˆç­‰ä¸å…è®¸æ”¾å…¥ nil Object-C æ‰€æœ‰ å¯¹è±¡çš„å˜é‡ éƒ½å¯ä»¥ä¸º nil Object-C åªèƒ½ç”¨åœ¨å¯¹è±¡ä¸Šï¼Œè€Œåœ¨å…¶ä»–åœ°æ–¹åˆç”¨å…¶ä»–ç‰¹æ®Šå€¼ï¼ˆä¾‹å¦‚NSNotFoundï¼‰è¡¨ç¤ºå€¼çš„ç¼ºå¤± Optional é€šè¿‡åœ¨ å˜é‡ç±»å‹ åé¢åŠ  ? è¡¨ç¤º è¿™é‡Œæœ‰ä¸€ä¸ªå€¼ï¼Œå®ƒç­‰äº x æˆ–è€… è¿™é‡Œæ ¹æœ¬æ²¡æœ‰å€¼ ä½ å¯ä»¥é€šè¿‡ç»™å¯é€‰å˜é‡èµ‹å€¼ä¸€ä¸ª nil æ¥å°†ä¹‹è®¾ç½®ä¸ºæ²¡æœ‰å€¼ åœ¨ Object-C ä¸­ nil æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸å­˜åœ¨å¯¹è±¡çš„æŒ‡é’ˆ åœ¨ Swift ä¸­ï¼Œnil ä¸æ˜¯æŒ‡é’ˆï¼Œå®ƒæ˜¯ å€¼ç¼ºå¤±çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œä»»ä½•ç±»å‹çš„å¯é€‰é¡¹éƒ½å¯ä»¥è®¾ç½®æˆ nil è€Œä¸ä»…ä»…æ˜¯å¯¹è±¡ åªæœ‰å¯é€‰é¡¹æ‰èƒ½è®¾ç½®ä¸º nil 12var str: String = nilvar str1: String? = nil Optional-If è¯­å¥ä»¥åŠå¼ºåˆ¶è§£åŒ… å¯é€‰é¡¹æ˜¯æ²¡æ³•ç›´æ¥ä½¿ç”¨çš„ éœ€è¦ç”¨ ! å·å¼ºåˆ¶è§£åŒ…åæ‰èƒ½ä½¿ç”¨ï¼ˆæ„æ€æ˜¯æˆ‘çŸ¥é“è¿™ä¸ªå¯é€‰é¡¹é‡Œé¢æœ‰å€¼ï¼Œä½¿ç”¨å§ï¼‰ 12var str: String? = &quot;abc&quot;let count = str.count éœ€è¦æ”¹æˆå¦‚ä¸‹ä»£ç ï¼Œæ‰èƒ½æ­£ç¡®æ‰§è¡Œ 12var str: String? = &quot;abc&quot;let count = str!.count æˆ– 1234var str: String? = &quot;abc&quot;if str != nil &#123; let count = str!.count&#125; Optional-ç»‘å®š å¯ä»¥ä½¿ç”¨ å¯é€‰ç»‘å®š æ¥åˆ¤æ–­å¯é€‰é¡¹æ˜¯å¦åŒ…å«å€¼ï¼Œå¦‚æœåŒ…å«å°±æŠŠèµ‹å€¼ç»™ä¸€ä¸ªä¸´æ—¶çš„ å¸¸é‡æˆ–å˜é‡ å¯é€‰ç»‘å®šå¯ä»¥ä¸ if å’Œ while çš„è¯­å¥ä½¿ç”¨æ¥æ£€æŸ¥å¯é€‰é¡¹å†…éƒ¨çš„å€¼ï¼Œå¹¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡ åŒä¸€ä¸ª if è¯­å¥ä¸­åŒ…å«å¤šå¯é€‰é¡¹ç»‘å®šï¼Œç”¨é€—å·åˆ†å‰²å³å¯ã€‚å¦‚æœä»»ä¸€å¯é€‰ç»‘å®šç»“æœæ˜¯ nil æˆ–è€… å¸ƒå°”å€¼ ä¸º false ï¼Œé‚£ä¹ˆæ•´ä¸ª if åˆ¤æ–­ä¼šè¢«çœ‹åš false 12345var str:String? = &quot;abc&quot;if let actualStr = str &#123; let count = actualStr.count print(count)&#125; Optional - éšå£«è§£åŒ… æœ‰äº›å¯é€‰é¡¹ä¸€æ—¦è¢«è®¾å®šå€¼ä¹‹åï¼Œå°±ä¼šä¸€ç›´æ‹¥æœ‰å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥å»æ‰æ£€æŸ¥çš„éœ€æ±‚ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½è¿›è¡Œè§£åŒ… é€šè¿‡æœ‰å£°æ˜çš„ç±»å‹åè¾¹æ·»åŠ ä¸€ä¸ªå¹å·ï¼ˆString!ï¼‰è€Œéé—®å·ï¼ˆString?ï¼‰æ¥ä¹¦å†™éšå£«è§£åŒ…å¯é€‰é¡¹ 123var str:String! = &quot;abc&quot;let count = str.countprint(count) éšå£«è§£åŒ…å¯é€‰é¡¹ä¸»è¦è¢«ç”¨åœ¨Swift ç±» çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ Optional-å¯é€‰é“¾ å¯é€‰é¡¹åé¢åŠ é—®å· å¦‚æœå¯é€‰é¡¹ä¸ä¸ºnilï¼Œè¿”å›ä¸€ä¸ªå¯é€‰é¡¹ç»“æœï¼Œå¦åˆ™ä¸ºnil 123var str:String? = &quot;abc&quot;let count = str?.countlet lastIndex = count - 1 å°†ä¸Šé¢çš„ä»£ç æ”¹ä¸ºï¼š 1234567var str:String? = &quot;abc&quot;let count = str?.count//let lastIndex = count - 1if count != nil &#123; let lastIndex = count! - 1 print(lastIndex)&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 06ï¼šTupleå…ƒç»„","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 06ï¼šTupleå…ƒç»„","date":"2023-02-21T18:54:43.000Z","updated":"2023-03-09T07:23:00.125Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 06ï¼šTupleå…ƒç»„/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A006%EF%BC%9ATuple%E5%85%83%E7%BB%84/","excerpt":"","text":"Tuple å…ƒç»„ æŠŠå¤šä¸ªå€¼åˆå¹¶æˆå•ä¸€çš„å¤åˆå‹çš„å€¼ å…ƒç»„ å†…çš„å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œè€Œä¸”å¯ä»¥ä¸å¿…æ˜¯ç»Ÿä¸€ç±»å‹ 123let error = (1,&quot;æ²¡æœ‰æƒé™&quot;)print(error.0)print(error.1) å…ƒç´ å‘½å å…ƒç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥æŒ‡å®šå¯¹åº”çš„å…ƒç´ åç§° 123let error = (errorCode:1,errorMessage:&quot;æ²¡æœ‰æƒé™&quot;)print(error.errorCode)print(error.errorMessage) å¦‚æœæ²¡æœ‰æŒ‡å®šåç§°çš„å…ƒç´ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹æ ‡çš„æ–¹å¼æ¥å¼•ç”¨ 123let error = (1,&quot;æ²¡æœ‰æƒé™&quot;)print(error.0)print(error.1) Tuple ä¿®æ”¹ ç”¨ var å®šä¹‰çš„å…ƒç»„å°±æ˜¯å¯å˜å…ƒç»„ï¼Œlet å®šä¹‰çš„å…ƒç»„å°±æ˜¯ä¸å¯å˜å…ƒç»„ ä¸ç®¡æ˜¯å¯å˜è¿˜æ˜¯ä¸å¯å˜å…ƒç»„ï¼Œå…ƒç»„åœ¨åˆ›å»ºåå°±ä¸èƒ½å¢åŠ å’Œåˆ é™¤å…ƒç´  å¯ä»¥å¯¹å¯å˜å…ƒç»„çš„å…ƒç´ è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯ä¸èƒ½æ”¹å˜å…¶ç±»å‹ 123var error = (errorCode:1,errorMessage:&quot;æ²¡æœ‰æƒé™&quot;)error.errorCode = 2error.errorMessage = &quot;2&quot; any ç±»å‹å¯ä»¥æ”¹ä¸ºä»»ä½•ç±»å‹ 12345var error: (Any,String) = (1,&quot;æ²¡æœ‰æƒé™&quot;)error.0 = 2print(error)error.0 = &quot;abc&quot;print(error) Tuple åˆ†è§£ å°†ä¸€ä¸ªå…ƒç»„çš„å†…å®¹åˆ†è§£æˆå•ç‹¬çš„å¸¸é‡æˆ–å˜é‡ 1234let error = (1,&quot;æ²¡æœ‰æƒé™&quot;)let (errorCode,errorMessage) = errorprint(errorCode)print(errorMessage) å¦‚æœåªéœ€è¦ä½¿ç”¨å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œä¸éœ€è¦çš„æ•°æ®å¯ä»¥ç”¨ä¸‹åˆ’çº¿ _ ä»£æ›¿ 123let error = (1,&quot;æ²¡æœ‰æƒé™&quot;)let (_,errorMessage) = errorprint(errorMessage) ä½œä¸ºå‡½æ•°è¿”å›å€¼ ä½¿ç”¨ Tuple ä¸ºå‡½æ•°è¿”å›å¤šä¸ªå€¼ è¿”å›å€¼çš„ Tuple å¯ä»¥å†å‡½æ•°çš„è¿”å›ç±»å‹éƒ¨åˆ†è¢«å‘½å 12345func writeToFile(content:String) -&gt; (errorCode:Int,errorMessage:String) &#123; return (1,&quot;æ²¡æœ‰æƒé™&quot;)&#125;let error = writeToFile(content: &quot;&quot;)print(error)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 05ï¼šæ•°å€¼ç±»å‹","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 05ï¼šæ•°å€¼ç±»å‹","date":"2023-02-21T18:53:56.000Z","updated":"2023-03-09T07:22:36.488Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 05ï¼šæ•°å€¼ç±»å‹/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A005%EF%BC%9A%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B/","excerpt":"","text":"æ•´æ•° Swift æä¾›äº† 8ï¼Œ16ï¼Œ32ï¼Œ64 ä½ç¼–ç çš„æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•´æ•° å‘½åæ–¹å¼ï¼šä¾‹å¦‚ 8ä½æ— ç¬¦å·æ•´æ•°çš„ç±»å‹æ˜¯ UInt8ï¼Œ32ä½æœ‰ç¬¦å·æ•´æ•°çš„ç±»å‹æ˜¯ Int32 é€šè¿‡ min å’Œ max å±æ€§æ¥è®¿é—®æ¯ä¸ªæ•´æ•°ç±»å‹çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ Swift æä¾›äº†ä¸€ä¸ªé¢å¤–çš„æ•´æ•°ç±»å‹ï¼šIntï¼Œå®ƒæ‹¥æœ‰ä¸å½“å‰å¹³å°çš„åŸç”Ÿå­—ç›¸åŒçš„é•¿åº¦ åŒæ—¶ Swift ä¹Ÿæä¾› UInt ç±»å‹ï¼Œæ¥è¡¨ç¤ºå¹³å°é•¿åº¦ç›¸å…³çš„æ— ç¬¦å·æ•´å‹ å»ºè®®åœ¨ç”¨åˆ°è¯ä¹¦çš„åœ°æ–¹éƒ½ä½¿ç”¨ Int æµ®ç‚¹ç±»å‹ Doubleï¼š64ä½æµ®ç‚¹æ•°ï¼Œè‡³å°‘æœ‰ 15 ä½æ•°å­—çš„ç²¾åº¦ Floatï¼š32ä½æµ®ç‚¹æ•°ï¼Œè‡³å°‘æœ‰ 6 ä¸ºæ•°å­—çš„ç²¾åº¦ åœ¨ä¸¤ç§ç±»å‹éƒ½å¯ä»¥çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨ Double ç±»å‹ æ•°å€¼èŒƒå›´ 123let a = 8let b: UInt8 = 240print(&quot;UInt8 min \\(UInt8.min),UInt8 max \\(UInt8.max)&quot;) Bool Boolï¼štrue å’Œ false Swift çš„ç±»å‹å®‰å…¨æœºåˆ¶ä¼šé˜»æ­¢ä½ ç”¨ä¸€ä¸ªéå¸ƒå°”é‡çš„å€¼æ›¿æ¢æ‰ Bool 1234let i = 1if i &#123; print(i)&#125; æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ ç±»å‹åˆ«å ç±»å‹åˆ«åæ˜¯ä¸€ä¸ªä¸º å·²å­˜åœ¨ç±»å‹ å®šä¹‰çš„ä¸€ä¸ª å¯é€‰æ‹©çš„åå­— ä½ å¯ä»¥ç”¨å…³é”®å­— typealias å®šä¹‰ä¸€ä¸ªç±»å‹çš„åˆ«å å½“ä½ æƒ³é€šè¿‡åœ¨ä¸€ä¸ªåœ¨ä¸Šä¸‹æ–‡ä¸­çœ‹èµ·æ¥æ›´åˆé€‚å¯å…·æœ‰è¡¨è¾¾è¡Œçš„åå­—æ¥å¼•ç”¨ä¸€ä¸ªå·²å­˜åœ¨çš„ç±»å‹æ—¶ï¼Œè¿™æ—¶åˆ«åå°±éå¸¸æœ‰ç”¨äº† 123// éŸ³é¢‘é‡‡æ ·ç‡typealias AudioSample = UInt8let sample:AudioSample = 32","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 04ï¼šå˜é‡å’Œå¸¸é‡","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 04ï¼šå˜é‡å’Œå¸¸é‡","date":"2023-02-21T18:12:27.000Z","updated":"2023-03-09T07:22:31.262Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 04ï¼šå˜é‡å’Œå¸¸é‡/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A004%EF%BC%9A%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/","excerpt":"","text":"å£°æ˜å˜é‡å’Œå¸¸é‡ ä½¿ç”¨å…³é”®å­— let å£°æ˜å¸¸é‡ 12let a = 1a = 2 ç”±äº x æ˜¯å¸¸é‡ï¼Œä¸èƒ½ç»™å¸¸é‡èµ‹å€¼ï¼Œä¼šæŠ¥é”™ ä½¿ç”¨å…³é”®å­— var å£°æ˜å˜é‡ 12var b = 1b = 2 å¯ä»¥åœ¨ä¸€è¡Œä¸­å£°æ˜å¤šä¸ªå˜é‡å’Œå¸¸é‡ï¼Œç”¨é€—å·åˆ†å‰² 1var x = 0.0,y = 1.0,z = 2.0 ç±»å‹æ ‡æ³¨ åœ¨å£°æ˜ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡æ—¶æä¾›ç±»å‹æ ‡æ³¨ï¼Œæ¥æ˜ç¡®å˜é‡æˆ–å¸¸é‡èƒ½å¤Ÿå­˜å‚¨å€¼çš„ç±»å‹ æ·»åŠ  ç±»å‹æ ‡æ³¨ çš„æ–¹æ³•æ˜¯åœ¨ å˜é‡æˆ–å¸¸é‡ çš„åå­—åé¢åŠ ä¸€ä¸ª å†’å·ï¼Œå†è·Ÿä¸€ä¸ª ç©ºæ ¼ï¼Œæœ€ååŠ ä¸Šä½¿ç”¨çš„ ç±»å‹åç§° å¯ä»¥åœ¨ä¸€è¡Œä¸­å®šä¹‰å¤šä¸ªç›¸å…³çš„å˜é‡ä¸ºç›¸åŒçš„ç±»å‹ï¼Œç”¨ é€—å· åˆ†å‰²ï¼Œåªè¦åœ¨æœ€åçš„å˜é‡åå­—ååŠ ä¸Šç±»å‹æ ‡æ³¨ 123var a: Stringa = &quot;hello&quot;a = 10 å¸¸é‡å’Œå˜é‡å‘½å å¸¸é‡å’Œå˜é‡çš„åå­—å‡ ä¹å¯ä»¥ä½¿ç”¨ä»»ä½•å­—ç¬¦ï¼Œç”šè‡³åŒ…æ‹¬ Unicode å­—ç¬¦ å¸¸é‡å’Œå˜é‡çš„åå­—ä¸èƒ½åŒ…å« ç©ºç™½å­—ç¬¦ã€æ•°å­¦ç¬¦å·ã€ç®­å¤´ã€ä¿ç•™çš„ï¼ˆæˆ–è€…æ— æ•ˆçš„ï¼‰Unicodeç ä½ã€è¿çº¿å’Œåˆ¶è¡¨ç¬¦ã€‚ä¹Ÿä¸èƒ½ä»¥ æ•°å­— å¼€å¤´ï¼Œå°½ç®¡æ•°å­—å‡ ä¹å¯ä»¥ä½¿ç”¨åœ¨åå­—å…¶ä»–çš„ä»»ä½•åœ°æ–¹ 123let Ï€ = 3.1415let ä½ å¥½ = &quot;ä½ å¥½ä¸–ç•Œ&quot;let ğŸ¶ğŸ‚ = &quot;dog,cow&quot; æ‰“å°å¸¸é‡å’Œå˜é‡ print(_:separator:teminator) å­—ç¬¦ä¸²æ’å…¥ ç”¨ \\() æ¥æ’å…¥ 123456let Ï€ = 3.1415let ä½ å¥½ = &quot;ä½ å¥½ä¸–ç•Œ&quot;let ğŸ¶ğŸ‚ = &quot;dog,cow&quot;print(Ï€)print(&quot;\\(ä½ å¥½)&quot;)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 03ï¼šPlaygorundä½¿ç”¨","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 03ï¼šPlaygroundä½¿ç”¨","date":"2023-02-21T16:41:59.000Z","updated":"2023-03-09T07:22:28.309Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 03ï¼šPlaygroundä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A003%EF%BC%9APlayground%E4%BD%BF%E7%94%A8/","excerpt":"","text":"ç®€ä»‹ Swift çš„ Playgorund æ˜¯ä¸ºäº†è®©äººäººéƒ½èƒ½æ„‰å¿«çš„å­¦ä¹  swift ç¼–ç¨‹ ä½†å‘å±•è‡³ä»Šï¼Œè¿™ä¸ªå·¥å…·è¶Šæ¥è¶Šå¼ºå¤§ Playgorund ä½¿ç”¨ åˆ›å»ºä¸€ä¸ª Playgorund åº”ç”¨ Nextï¼Œé»˜è®¤å MyPlayground å¯ä»¥é€šè¿‡ New -&gt; Playground Page åˆ›å»ºå¤šä¸ª Playground æ¥å­¦ä¹  æ³¨ï¼šå¿«æ·é”® command + option + n åˆ›å»º Playground Page command + shift + enter å¿«é€Ÿè¿è¡Œç¨‹åº ç®€å•ä½¿ç”¨ å†™ä¸€ä¸ªæ±‚å’Œçš„å‡½æ•° 12345678// æ±‚å’Œå‡½æ•°func sum(a:Int,b:Int) -&gt; Int &#123; return a+b&#125;// è°ƒç”¨æ±‚å’Œå‡½æ•° èµ‹å€¼ç»™ å¸¸é‡ clet c = sum(a: 1, b: 2)// æ‰“å°å¸¸é‡ cprint(c)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 02ï¼šREPLäº¤äº’å¼è§£é‡Šå™¨","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 02ï¼šREPLäº¤äº’å¼è§£é‡Šå™¨","date":"2023-02-21T16:41:38.000Z","updated":"2023-03-09T07:21:52.642Z","comments":true,"path":"2023/02/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 02ï¼šREPLäº¤äº’å¼è§£é‡Šå™¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A002%EF%BC%9AREPL%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%A7%A3%E9%87%8A%E5%99%A8/","excerpt":"","text":"ä»‹ç» xcode 6.1 å¼•è¿›äº†å¦å¤–ä¸€ç§ä»¥äº¤äº’å¼çš„æ–¹å¼æ¥ä½“éªŒ Swift çš„æ–¹æ³• Read Eval PrintLoopï¼Œç®€ç§°REPL ä½¿ç”¨REPL é™¤äº†å¯ä»¥ å®šä¹‰å¸¸é‡å’Œå˜é‡ å¤–ï¼Œè¿˜æ˜¯å¯ å®šä¹‰å‡½æ•° æ‰“å¼€ç»ˆç«¯è¾“å…¥ 12mac@bogon ~ % swiftmac@bogon ~ % swift repl å®šä¹‰å˜é‡ å®šä¹‰å‡½æ•° REPL å…¶ä»–å‘½ä»¤ é€€å‡ºï¼š:quit å¸®åŠ©ï¼š:help å°†å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„å¼€å§‹å¤„ï¼šControl + A å°†å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰è¡Œçš„ç»“æŸå¤„ï¼šControl + E","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 01ï¼šSwiftç¼–è¯‘æµç¨‹","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 01ï¼šSwiftç¼–è¯‘è¿‡ç¨‹","date":"2023-02-21T15:49:55.000Z","updated":"2023-03-09T07:21:48.350Z","comments":true,"path":"2023/02/21/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 01ï¼šSwiftç¼–è¯‘è¿‡ç¨‹/","link":"","permalink":"https://www.bboyzj.cn/2023/02/21/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A001%EF%BC%9ASwift%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/","excerpt":"","text":"ç¼–è¯‘å™¨æ¶æ„Swiftç¼–è¯‘è¿‡ç¨‹å’ŒOCåŸºæœ¬ç±»ä¼¼ï¼Œä»…ä»…æ˜¯å‰ç«¯ç¼–è¯‘å™¨ä¸ä¸€æ ·ã€‚ OC/C å‰ç«¯ç¼–è¯‘å™¨æ˜¯ Clang Swift å…ˆè§£ææˆ Swift ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œé€šè¿‡ swiftc è¿™ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œç¼–è¯‘æˆ Swift IL OC å’Œ Swift æœ€åå‡ç¼–è¯‘æˆ LLVM IR ä¸­é—´å±‚è¡¨ç¤º OC å’Œ Swift æœ€ç»ˆé€šè¿‡ åç«¯ç¼–è¯‘å™¨ LLVM compiler ï¼Œç¼–è¯‘æˆæœ€ç»ˆçš„åœ¨å…·ä½“åœ°å€ä¸Šå¯ä»¥æ‰§è¡Œçš„äºŒè¿›åˆ¶ï¼ŒåŒ…æ‹¬x86ã€armå’Œother è¯¦ç»†ç¼–è¯‘æµç¨‹ Swift å…ˆè§£ææˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ ç»è¿‡ä¸€ç³»åˆ—å·¥å…·ç¼–ç¨‹ Swift çš„ SIL(ä¸­é—´è¯­è¨€) å†ç»è¿‡ åˆ†æã€IRå·¥å…· è½¬æˆ LLVM IR(ä¸­é—´è¡¨ç¤ºå±‚) æœ€ç»ˆé€šè¿‡ åç«¯ç¼–è¯‘å™¨ LLVM compiler ç¼–è¯‘æˆ .o ç›®æ ‡æ–‡ä»¶ å‘½ä»¤è¡Œæµç¨‹ä½¿ç”¨ç»ˆç«¯åˆ›å»ºä¸€ä¸ªç®€å•çš„ main.swift æ–‡ä»¶ 12mac@bogon ~ % cd Desktopmac@bogon Desktop % touch main.swift æ­¤æ—¶ä½ å¯ä»¥åœ¨æ¡Œé¢çœ‹åˆ°ä¸€ä¸ª main.swift æ–‡ä»¶ åœ¨è¯¥æ–‡ä»¶ä¸‹å†™ä¸‹ä¸¤ä¸ªæ•°ç›¸åŠ çš„ä¸€ä¸ªå‡½æ•° 123456func sum(a:Int,b:Int) -&gt; Int &#123; return a + b&#125;let value = sum(a: 1, b: 2)print(value) æ‰“å¼€å‘½ä»¤è¡Œå·¥å…· mac@bogon ~ % cd Desktop ç”Ÿæˆ AST æŠ½è±¡è¯­æ³•æ ‘ mac@bogon ~ % swiftc main.swift -dump-ast ç”Ÿæˆ SIL ä¸­é—´è¯­è¨€ mac@bogon ~ % swiftc main.swift -emit-sil ç”Ÿæˆ LLVM IR ä¸­é—´è¡¨ç¤ºå±‚ mac@bogon ~ % swiftc main.swift -emit-ir ç”Ÿæˆ Assembly Language æ±‡ç¼–è¯­è¨€ mac@bogon ~ % swiftc main.swift -emit-assembly ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ mac@bogon ~ % swiftc -o main.out main.swift å‘½ä»¤è¡Œè¾“å…¥ï¼š 1234mac@bogon ~ % cd /Users/mac/Desktop/01swiftç¼–è¯‘æµç¨‹ mac@bogon 01swiftç¼–è¯‘æµç¨‹ % swiftc -o main.out main.swiftmac@bogon 01swiftç¼–è¯‘æµç¨‹ % ./main.out3","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šå•ä¾‹æ¨¡å¼","slug":"Swift/Swiftå­¦ä¹ ï¼šå•ä¾‹æ¨¡å¼","date":"2023-02-21T14:08:53.000Z","updated":"2023-03-08T22:10:19.559Z","comments":true,"path":"2023/02/21/Swift/Swiftå­¦ä¹ ï¼šå•ä¾‹æ¨¡å¼/","link":"","permalink":"https://www.bboyzj.cn/2023/02/21/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9A%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ç®€ä»‹å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰ æœ€ swift å¼€å‘ä¸­å¸¸è§çš„ è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚ ç‰¹ç‚¹ ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€çš„è®¿é—®ç‚¹ å‡å°‘å†…å­˜å¼€é”€ï¼Œè§£å†³äº†ä¸€ä¸ªç±»å…¨å±€ä½¿ç”¨æ—¶é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ å®ç° static å£°æ˜ä¸€ä¸ªå¸¸é‡å®ä¾‹å¯¹è±¡sharedï¼Œåªåˆ†é…ä¸€æ¬¡å†…å­˜ private ç§æœ‰åŒ–æ„é€ å‡½æ•° initï¼Œæ”¾æ­¢å¤–éƒ¨åˆ›å»ºæ–°å®ä¾‹ 12345678910111213class MySingleton &#123; // å£°æ˜é™æ€å˜é‡å®ä¾‹ï¼Œåªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œå€¼åˆ†é…ä¸€æ¬¡å†…å­˜ static let shared = MySingleton() // ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢ä»å¤–éƒ¨åˆ›å»ºæ–°çš„å®ä¾‹ private override init () &#123; super.init() &#125; // å‡½æ•° func doSomething() &#123; print(&quot;do something&quot;) &#125;&#125; ä½¿ç”¨å•ä¾‹å¯¹è±¡ 1MySingleton.shared.doSomething();","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"SwiftUIå­¦ä¹ 12ï¼šListåˆ—è¡¨å’ŒForEachå¾ªç¯çš„ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 12ï¼šListåˆ—è¡¨å’ŒForEachå¾ªç¯çš„ä½¿ç”¨","date":"2023-02-20T09:27:34.000Z","updated":"2023-03-08T22:30:08.818Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 12ï¼šListåˆ—è¡¨å’ŒForEachå¾ªç¯çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A012%EF%BC%9AList%E5%88%97%E8%A1%A8%E5%92%8CForEach%E5%BE%AA%E7%8E%AF%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 11ï¼šPathè·¯å¾„çš„ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 11ï¼šPathè·¯å¾„çš„ä½¿ç”¨","date":"2023-02-20T09:26:54.000Z","updated":"2023-03-08T22:30:02.506Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 11ï¼šPathè·¯å¾„çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A011%EF%BC%9APath%E8%B7%AF%E5%BE%84%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 10ï¼šStateå’ŒBindingç»‘å®šçš„ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 10ï¼šStateå’ŒBindingç»‘å®šçš„ä½¿ç”¨","date":"2023-02-20T09:26:17.000Z","updated":"2023-03-08T22:37:23.238Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 10ï¼šStateå’ŒBindingç»‘å®šçš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A010%EF%BC%9AState%E5%92%8CBinding%E7%BB%91%E5%AE%9A%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€åœ¨æœ¬ç« èŠ‚ä¸­ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•ä½¿ç”¨ State å’Œ Binding ç»‘å®šï¼Œç›‘å¬å±æ€§å€¼çš„å˜åŒ–ï¼Œå’Œæ ¹æ® Binding ç»‘å®šå…³ç³»ï¼Œæ”¹å˜ä¸€ä¸ªå±æ€§å€¼åŒæ—¶å½±å“å¦ä¸€ä¸ªå±æ€§å€¼çš„å˜åŒ– ä¸¾ä¾‹ï¼š å½“æˆ‘ä»¬åœ¨å¬éŸ³ä¹æˆ–çœ‹è§†é¢‘æ—¶ï¼Œç‚¹å‡» æ’­æ”¾ æŒ‰é’®ï¼Œæ’­æ”¾ æŒ‰é’®å˜æˆ æš‚åœ æŒ‰é’®ï¼ŒåŒæ—¶è§†é¢‘å¼€å§‹æ’­æ”¾ è¿™å°±ç”¨åˆ°äº† @Stateå±æ€§åŒ…è£…å™¨ å’Œ @BindingåŒ…è£…å™¨ å°è¯•å®Œæˆä¸‹é¢çš„è®¾è®¡ç¨¿ï¼š åˆ†æ é¦–å…ˆæˆ‘ä»¬å‡†å¤‡å¥½å›¾ç‰‡ç´ æï¼Œæœªé€‰ä¸­çš„å›¾ç‰‡å’Œé€‰ä¸­çš„å›¾ç‰‡ï¼Œæ”¾åˆ°Assetsä¸­ å®šä¹‰ä¸€ä¸ª@Stateå˜é‡å­˜æ”¾çŠ¶æ€ï¼Œé€šè¿‡ç‚¹å‡»æ¥åˆ‡æ¢çŠ¶æ€ åˆ›å»ºæŒ‰é’®é€šè¿‡çŠ¶æ€å˜é‡åˆ¤æ–­æ˜¾ç¤ºå›¾ç‰‡ æ³¨ï¼šå®šä¹‰çš„å˜é‡æ”¾åœ¨structä¸‹é¢ï¼Œbodyä¸Šé¢ å…·ä½“ä»£ç çš„å®ç°çŸ¥è¯†ç‚¹ï¼š 1.toggle() åˆ‡æ¢æŒ‰é’®çŠ¶æ€ å®Œæˆä»£ç ï¼š 12345678910111213141516171819struct ContentView: View &#123; // å®šä¹‰å˜é‡ @State var isSelect:Bool = false var body: some View &#123; // æŒ‰é’® Button &#123; print(&quot;ç‚¹å‡»äº†æŒ‰é’®&quot;) self.isSelect.toggle() &#125; label: &#123; Image(systemName: isSelect ? &quot;checkmark.circle.fill&quot; : &quot;circle&quot;) .font(.system(size: 150)) .foregroundColor(isSelect ? Color(red: 112/255, green: 182/255, blue: 3/255) : Color(red: 170/255, green: 170/255, blue: 170/255)) &#125; &#125;&#125; Bindingç»‘å®šä»¥ä¸Šé¢çš„ä»£ç ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æŒ‰é’®ä¸‹é¢æ·»åŠ ä¸€ä¸ªæ–‡æœ¬Text æŒ‰é’®å…³é—­æ—¶ï¼Œtitleæ–‡å­—ä¸ºï¼šæœªå¼€å¯ æŒ‰é’®æ‰“å¼€æ—¶ï¼Œtitleæ–‡å­—ä¸ºï¼šå·²å¼€å¯ æˆ‘ä»¬å®ç°ä¸€ä¸‹ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132struct ContentView: View &#123; // å®šä¹‰å˜é‡ @State var isSelect:Bool = false var body: some View &#123; // æŒ‰é’® VStack &#123; Button &#123; print(&quot;ç‚¹å‡»äº†æŒ‰é’®&quot;) self.isSelect.toggle() &#125; label: &#123; Image(systemName: isSelect ? &quot;checkmark.circle.fill&quot; : &quot;circle&quot;) .font(.system(size: 150)) .foregroundColor(isSelect ? Color(red: 112/255, green: 182/255, blue: 3/255) : Color(red: 170/255, green: 170/255, blue: 170/255)) &#125; // æ–‡æœ¬ titleView() &#125; &#125;&#125;struct titleView: View &#123; var body: some View &#123; Text(&quot;æœªå¼€å¯&quot;) .font(.system(size: 25)) .fontWeight(.bold) .padding() &#125;&#125; æ­¤æ—¶å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡ isSelect æ¥å…³è” Textæ–‡å­—ï¼Œä¼šæŠ¥é”™ï¼Œå› ä¸ºæ‰¾ä¸åˆ°ï¼Œä¸åœ¨ä¸€ä¸ªè§†å›¾ä¸‹ å› æ­¤ï¼Œæˆ‘ä»¬è¿™é‡Œå¼•å…¥äº† Bindingç»‘å®š æ¦‚å¿µï¼ŒBindingå…±äº«äº†Stateå®šä¹‰çš„çŠ¶æ€ï¼ŒStateçŠ¶æ€æ”¹å˜æ—¶ï¼ŒBindingç»‘å®šçš„å‚æ•°ä¼šä¸€èµ·æ”¹å˜ å®šä¹‰ç»‘å®šå˜é‡ isSelect 12// å®šä¹‰ç»‘å®š@Binding var isSelect:Bool ç»‘å®šçŠ¶æ€ç”¨$ 12// æ–‡æœ¬titleView(isSelect: $isSelect) å®Œæ•´ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142struct ContentView_Previews: PreviewProvider &#123; static var previews: some View &#123; ContentView() &#125;&#125;struct ContentView: View &#123; // å®šä¹‰å˜é‡ @State var isSelect:Bool = false var body: some View &#123; // æŒ‰é’® VStack &#123; Button &#123; print(&quot;ç‚¹å‡»äº†æŒ‰é’®&quot;) self.isSelect.toggle() &#125; label: &#123; Image(systemName: isSelect ? &quot;checkmark.circle.fill&quot; : &quot;circle&quot;) .font(.system(size: 150)) .foregroundColor(isSelect ? Color(red: 112/255, green: 182/255, blue: 3/255) : Color(red: 170/255, green: 170/255, blue: 170/255)) &#125; // æ–‡æœ¬ titleView(isSelect: $isSelect) &#125; &#125;&#125;struct titleView: View &#123; // ç»‘å®šçŠ¶æ€ @Binding var isSelect:Bool var body: some View &#123; Text(self.isSelect ? &quot;å·²å¼€å¯&quot; : &quot;æœªå¼€å¯&quot;) .font(.system(size: 25)) .fontWeight(.bold) .padding() &#125;&#125;","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 09ï¼šGradientæ¸å˜è‰²çš„ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 09ï¼šGradientæ¸å˜è‰²çš„ä½¿ç”¨","date":"2023-02-20T09:25:43.000Z","updated":"2023-03-08T22:29:55.357Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 09ï¼šGradientæ¸å˜è‰²çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A009%EF%BC%9AGradient%E6%B8%90%E5%8F%98%E8%89%B2%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"ä»‹ç»å¦‚æœæˆ‘ä»¬æƒ³è¦åšæ¸å˜è‰²èƒŒæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨SwiftUIæ¡†æ¶å†…ç½®çš„æ¸å˜è‰²ä»£ç  å·¦å³æ¸å˜ 1 ä¸Šä¸‹æ¸å˜ 1 ç®€å•æè¿°ä¸‹å‚æ•°çš„æ„æ€ï¼š 1234LinerGradient()ï¼šçº¿æ€§æ¸å˜gradientï¼šæ¸å˜è‰²ï¼Œé€šå¸¸ç”¨é¢œè‰²æ•°ç»„ [Color.blue,Color.green]ï¼Œä¹Ÿå°±æ˜¯å¼€å§‹é¢œè‰²è“è‰²ï¼Œç»“æŸé¢œè‰² æ˜¯ç»¿è‰²startPointï¼šå¼€å§‹ä½ç½®ï¼Œé€šå¸¸ä½¿ç”¨.leading .trailing .top .botton å·¦å³ä¸Šä¸‹endPointï¼šç»“æŸä½ç½®ï¼Œé€šå¸¸ä½¿ç”¨.leading .trailing .top .botton å·¦å³ä¸Šä¸‹ æŒ‰é’®æ ·å¼åè®®å¦‚æœæŒ‰é’®å¾ˆå¤šï¼Œåˆ‡æ ·å¼éƒ½å¯ä»¥å¤ç”¨çš„æƒ…å†µä¸‹ï¼Œå¤åˆ¶ä¸€å¤§ä¸²ä»£ç ä¸ç¬¦åˆ ä¼˜é›…ä»£ç çš„ç›®æ ‡ è¿™é‡Œæˆ‘ä»¬ç§‘æ™®ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå«åš ButtonStylesï¼Œä¹Ÿå°±æ˜¯æŒ‰é’®æ ·å¼åè®®ï¼Œç»§æ‰¿è¿™ä¸ªåè®®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°æ ·å¼ å®ƒçš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š 123456struct GradientBackgroundStyle:ButtonStyle&#123; func makeBody(configuration: Configuration) -&gt; some View &#123; configuration.label // Buttonæ ·å¼ &#125;&#125; æ ·å¼ä½¿ç”¨æ–¹å¼ 12// æ ·å¼å¼•ç”¨æ–¹å¼.buttonStyle(GradientBackgroundStyle()) å®Œæ•´ä»£ç å’Œæ•ˆæœ123456789101112131415161718192021222324252627282930313233struct ContentView: View &#123; var body: some View &#123; Button &#123; print(&quot;ç™»å½•æˆåŠŸ&quot;) &#125; label: &#123; Text(&quot;å¾®ä¿¡ç™»å½•&quot;) .font(.system(size: 14)) &#125; // æ ·å¼å¼•ç”¨æ–¹å¼ .buttonStyle(GradientBackgroundStyle()) &#125;&#125;struct ContentView_Previews: PreviewProvider &#123; static var previews: some View &#123; ContentView() &#125;&#125;// ButtonStylestruct GradientBackgroundStyle:ButtonStyle&#123; func makeBody(configuration: Configuration) -&gt; some View &#123; configuration.label // æŒ‰é’®ä¿®é¥°ç¬¦ .frame(minWidth: 0,maxWidth: .infinity,minHeight: 0,maxHeight: 50) .foregroundColor(.white) .background(LinearGradient(gradient: Gradient(colors: [Color(&quot;8FD3F4&quot;),Color(&quot;84FAB0&quot;)]), startPoint: .leading, endPoint: .trailing)) .cornerRadius(5) .padding(.horizontal,20) &#125;&#125;","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 08ï¼šUIButtonæŒ‰é’®çš„ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 08ï¼šUIButtonæŒ‰é’®çš„ä½¿ç”¨","date":"2023-02-20T08:25:53.000Z","updated":"2023-03-08T22:35:57.085Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 08ï¼šUIButtonæŒ‰é’®çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A008%EF%BC%9AUIButton%E6%8C%89%E9%92%AE%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€åœ¨æœ¬ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¼šå¦‚ä½•ä½¿ç”¨ButtonæŒ‰é’®è¿™ä¸ªåŸºæœ¬æ§ä»¶ ç”±äºButtonç»„ä»¶åœ¨ä¸åŒåœºæ™¯ä¸‹åº”ç”¨ä¸åŒï¼Œæˆ‘ä»¬åˆ†æˆ3ä¸ªéƒ¨åˆ† ç®€å•æ–‡å­—æŒ‰é’® ç®€å•å›¾ç‰‡æŒ‰é’® å›¾ç‰‡+æ–‡å­—æŒ‰é’® åˆ›å»ºæŒ‰é’®swiftUIä¸­åˆ›å»ºæŒ‰é’®ä»£ç å¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345Button &#123; // æ“ä½œ &#125; label: &#123; // æŒ‰é’®æ ·å¼ &#125; ç¬¬ä¸€ä¸ªæ³¨é‡Šï¼šç‚¹å‡»äº†æŒ‰é’®åï¼Œç³»ç»Ÿæ‰§è¡Œä»€ä¹ˆæ“ä½œ ç¬¬äºŒä¸ªæ³¨é‡Šï¼šæŒ‰é’®çš„æ ·å¼ï¼Œè¿™ä¸ªæŒ‰é’®æ˜¯ä»€ä¹ˆ ä¸¾ä¸ªä¾‹å­ï¼š 1234567891011struct ContentView: View &#123; var body: some View &#123; Button &#123; // æ“ä½œ print(&quot;ç™»å½•æˆåŠŸ&quot;) &#125; label: &#123; // æŒ‰é’®æ ·å¼ Text(&quot;å¾®ä¿¡ç™»å½•&quot;) &#125; &#125;&#125; Textå¸¸ç”¨æ–¹æ³• .frameï¼šå°ºå¯¸ï¼Œ.infinity è‡ªé€‚åº”å±å¹•å®½é«˜ .paddingï¼šè¾¹è·ï¼Œåœ¨æŒ‰é’®å¤–é¢æ’‘å¼€ä¸€å—é¢ç§¯ï¼Œä¸Šä¸‹å·¦å³éƒ½ç•™è¾¹è· ç”¨Buttonå®ç°ä¸‹é¢çš„UIæ•ˆæœå›¾å¦‚ä¸‹ æ€è·¯ï¼šåˆ›å»º Button æŒ‰é’®ï¼Œå¹¶å°†å…¶ æå– æˆå­è§†å›¾ï¼Œæ’å…¥åˆ° å‚ç›´åˆ†å¸ƒä¸­ ç®€å•æ–‡å­—æŒ‰é’®1234567891011121314151617181920// æŒ‰é’®è§†å›¾struct ButtonView: View &#123; // å®šä¹‰å˜é‡ var title:String? var bgColor:Color? var body: some View &#123; Button &#123; // æ“ä½œ print(&quot;\\(title!)æˆåŠŸ&quot;) &#125; label: &#123; // æŒ‰é’®æ ·å¼ Text(title!) .frame(minWidth: 0,maxWidth: .infinity,minHeight: 0,maxHeight: 40) .background(bgColor) .font(.system(size: 14)) .foregroundColor(.white) .cornerRadius(5) .padding(.horizontal,50) // æ°´å¹³å±…ä¸­ï¼Œå·¦å³è¾¹è·50 &#125; &#125;&#125; ç®€å•å›¾ç‰‡æŒ‰é’®123456789101112131415// å›¾ç‰‡æŒ‰é’®struct ImgButton: View &#123; var body: some View &#123; Button &#123; print(&quot;ç™»å½•æˆåŠŸ&quot;) &#125; label: &#123; Image(&quot;wechat&quot;) .resizable() .aspectRatio(contentMode: .fit) .frame(minWidth: 0,maxWidth: 50,minHeight: 0,maxHeight: 50) &#125; &#125;&#125; å›¾ç‰‡+æ–‡å­—æŒ‰é’®12345678910111213141516171819202122// å›¾ç‰‡æ–‡å­—æŒ‰é’®struct ImgTextButton: View &#123; var body: some View &#123; Button &#123; print(&quot;ç™»å½•æˆåŠŸ&quot;) &#125; label: &#123; HStack &#123; Image(systemName: &quot;applelogo&quot;) .font(.title) Text(&quot;Appleç™»å½•&quot;) .fontWeight(.semibold) .font(.title) &#125; .frame(minWidth: 0,maxWidth: .infinity,minHeight: 0,maxHeight: 70) .background(Color(red: 51/255, green: 51/255, blue: 51/255)) .foregroundColor(.white) .cornerRadius(40) .padding(.horizontal,20) &#125; &#125;&#125; æœ€åå‘ˆç°çš„ä»£ç 12345678910111213141516struct ContentView: View &#123; var body: some View &#123; VStack &#123; // å¾®ä¿¡ç™»å½• ButtonView(title: &quot;å¾®ä¿¡ç™»å½•&quot;,bgColor: .green) // Appleç™»å½• ButtonView(title: &quot;Appleç™»å½•&quot;,bgColor: .black) // å›¾ç‰‡æŒ‰é’® ImgButton() // å›¾ç‰‡+æ–‡å­—æŒ‰é’® ImgTextButton() &#125; &#125;&#125;","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 07ï¼šScrollViewæ»šåŠ¨è§†å›¾ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 07ï¼šScrollViewæ»šåŠ¨è§†å›¾ä½¿ç”¨","date":"2023-02-20T08:25:30.000Z","updated":"2023-03-08T22:34:01.346Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 07ï¼šScrollViewæ»šåŠ¨è§†å›¾ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A007%EF%BC%9AScrollView%E6%BB%9A%E5%8A%A8%E8%A7%86%E5%9B%BE%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€åœ¨æœ¬ç« ä¸­ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•ä½¿ç”¨ ä»£ç åˆ†ç»„ å’Œ ä»£ç å¤ç”¨ çš„æ–¹å¼åˆ›å»º ScrollView æ»šåŠ¨è§†å›¾ ä»¥å¾®ä¿¡å…¬ä¼—å·ä¸ºä¾‹ï¼Œæˆ‘ä»¬è¯•è¯•å®Œæˆä¸‹é¢çš„UIè®¾è®¡å›¾ åˆ†æç”±UIå¯çŸ¥ï¼Œæ–‡ç« æ˜¯ç”±å›¾ç‰‡Imageå’ŒTextç»„æˆï¼Œè€Œä¸”æ˜¯ çºµå‘æ’åˆ— å› æ­¤ï¼Œæˆ‘ä»¬å®ç°çš„æ­¥éª¤å¦‚ä¸‹ï¼š å‡†å¤‡ä¸€äº›å›¾ç‰‡ç´ æï¼Œæ”¾å…¥åˆ° Assets.xcassets æ–‡ä»¶ä¸­ å…ˆå®ŒæˆåŸºç¡€çš„ å•ä¸ªå¡ç‰‡çš„ä»£ç ï¼Œå¹¶å°†å…¶ çºµå‘åˆ†å¸ƒ å°†å¡ç‰‡ æå–æˆå­è§†å›¾ï¼ŒåµŒå…¥åˆ° ScrollView ä¸­ ä»£ç å®ç° å°†å›¾ç‰‡ç´ æï¼Œæ”¾å…¥åˆ° Assets.xcassets æ–‡ä»¶ä¸­ åŸºç¡€å¡ç‰‡çš„å®ç° Imageå›¾ç‰‡çš„å¸¸ç”¨æ–¹æ³•: 12.resizabl ï¼šè°ƒèŠ‚å¤§å°ï¼Œè°ƒæ•´å›¾ç‰‡æ˜¾ç¤ºçš„å¤§å°.aspectRatio() ï¼šå®½é«˜æ¯”ï¼Œ.aspectRatio(contentMode: ContentMode.fit)è®©å›¾ç‰‡é€‚åº”å±å¹•ï¼Œå¹¶ä¿æŒåŸæœ‰çš„å®½é«˜æ¯” Textæ–‡æœ¬å¸¸ç”¨çš„æ–¹æ³•ï¼š 1234.font()ï¼šå­—ä½“ï¼Œ.font(.system(size:17))ï¼Œç³»ç»Ÿ17å·å­—.fontWeight()ï¼šå­—é‡ï¼Œ.fontWeight(.blod)ï¼ŒåŠ ç²—.foregroundColor()ï¼šå­—ä½“é¢œè‰²ï¼Œ.foregroundColor(.black)ï¼Œç³»ç»Ÿé»‘è‰².padding()ï¼šè¾¹è·ï¼Œå››å‘¨ç•™å¼€è¾¹è· å•ä¸ªå¡ç‰‡å®ç°çš„ä»£ç ï¼š 123456789101112VStack &#123; // å›¾ç‰‡ Image(&quot;book1&quot;) .resizable() // è°ƒæ•´å›¾ç‰‡æ˜¾ç¤ºçš„å¤§å° .aspectRatio(contentMode: ContentMode.fit) // å®½é«˜æ¯” // æ–‡å­— Text(&quot;ä½ çš„èƒ½åŠ›æ˜¯å¦åœ¨å…¨ä¸–ç•Œé€šç”¨ï¼Œå¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆéœ€æ±‚é‡æ–°è¯„ä¼°ä½ çš„èƒ½åŠ›&quot;) .font(.system(size: 17)) .fontWeight(.bold) .foregroundColor(.black) .padding() &#125; ç»™æ•´ä¸ª å¡ç‰‡ åŠ è¾¹æ¡†ï¼Œé€šè¿‡ .overlay() ä¿®é¥°ç¬¦ è¦†ç›– ä¸Šå»ï¼š 12345.cornerRadius(10).overlay( RoundedRectangle(cornerRadius: 10) .stroke(Color(red: 150/255, green: 150/255, blue: 150/255,opacity: 0.1),lineWidth: 1)) ç»™ å¡ç‰‡ è®¾ç½®ä¸€ä¸ªè¾¹è·ï¼Œç”¨åˆ°äº† .padding() ä¿®é¥°ç¬¦ï¼Œä¸”æ˜¯å®ƒçš„ é«˜çº§ç”¨æ³•ï¼š 1.padding([.top,.horizontal]) é¡¶éƒ¨ï¼Œæ°´å¹³å±…ä¸­ å°†å¡ç‰‡æå–æˆå­è§†å›¾ 12345678910111213141516171819202122232425262728// å¡ç‰‡è§†å›¾struct CardView: View &#123; // å®šä¹‰å˜é‡ var img:String? // å›¾ç‰‡ var title:String? // æ ‡é¢˜ var body: some View &#123; VStack &#123; // å›¾ç‰‡ Image(img!) .resizable() // è°ƒæ•´å›¾ç‰‡æ˜¾ç¤ºçš„å¤§å° .aspectRatio(contentMode: ContentMode.fit) // å®½é«˜æ¯” // æ–‡å­— Text(title!) .font(.system(size: 17)) .fontWeight(.bold) .foregroundColor(.black) .padding() &#125; .cornerRadius(10) .overlay( RoundedRectangle(cornerRadius: 10) .stroke(Color(red: 150/255, green: 150/255, blue: 150/255,opacity: 0.1),lineWidth: 1) ) .padding([.top,.horizontal]) &#125;&#125; å°†å¤šå¼ å¡ç‰‡æ·»åŠ åˆ°ScrollViewä¸­ 123456789101112131415struct ContentView: View &#123; var body: some View &#123; ScrollView&#123; VStack &#123; // å¡ç‰‡è§†å›¾ CardView(img: &quot;book1&quot;,title: &quot;ä½ çš„èƒ½åŠ›æ˜¯å¦èƒ½åœ¨å…¨ä¸–ç•Œé€šç”¨ï¼Œå¦‚æœä¸èƒ½,é‚£ä¹ˆéœ€æ±‚é‡æ–°è¯„ä¼°ä½ çš„èƒ½åŠ›ã€‚&quot;) CardView(img: &quot;book2&quot;,title: &quot;å½“ä½ åˆ¤æ–­ä½ çš„æƒ³æ³•æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±åœ¨ä»Šå¤©å®Œæˆå§ã€‚&quot;) CardView(img: &quot;book3&quot;,title: &quot;å½“ä½ åˆ¤æ–­ä½ çš„æƒ³æ³•æ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±åœ¨ä»Šå¤©å®Œæˆå§ã€‚&quot;) CardView(img: &quot;book4&quot;,title: &quot;å°†è‡ªèº«æ‰€å­¦çš„å›é¦ˆç¤¾ä¼šï¼Œä¸ä¹Ÿæ˜¯æ„è§å¹¸ç¦çš„äº‹å„¿ä¹ˆ&quot;) CardView(img: &quot;book2&quot;,title: &quot;æˆåŠŸçš„ç§˜è¯€ï¼Œç»å¯¹ä¸è¦å’Œåˆ«äººåšç›¸åŒçš„äº‹å„¿&quot;) &#125; &#125; &#125;&#125; æœ€ç»ˆå‘ˆç°çš„ç»“æœå¦‚ä¸‹ï¼š","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 06ï¼šå®šä¹‰å˜é‡","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 06ï¼šå®šä¹‰å˜é‡","date":"2023-02-20T07:25:50.000Z","updated":"2023-03-08T22:31:57.581Z","comments":true,"path":"2023/02/20/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 06ï¼šå®šä¹‰å˜é‡/","link":"","permalink":"https://www.bboyzj.cn/2023/02/20/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A006%EF%BC%9A%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F/","excerpt":"","text":"å®šä¹‰å˜é‡ç”±ä¸Šä¸€ç« çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å‘ç°ï¼Œé™¤äº† å®šä»·æ–¹æ¡ˆçš„æ ‡é¢˜ä¸åŒï¼ˆè¿ç»­åŒ…æœˆï¼Œ1ä¸ªæœˆï¼Œ12ä¸ªæœˆï¼‰ï¼Œä¸åŒå®šä»·æ–¹æ¡ˆä»·æ ¼ä¸åŒï¼ˆï¿¥18ã€ï¿¥30ã€ï¿¥228ï¼‰ã€èƒŒæ™¯é¢œè‰²ä¸åŒï¼Œå…¶ä»–éƒ½ä¸€æ ·ï¼Œæˆ‘ä»¬å°†è¿™ä¸‰ä¸ªå±æ€§å®šä¹‰æˆå˜é‡ 12345678910struct priceView: View &#123; // å®šä¹‰å˜é‡ var title: String? var price: String? var bgColor: Color? var body: some View &#123; HStack &#123; // è¿ç»­åŒ…æœˆ VStack &#123; ç»™å˜é‡èµ‹äºˆçœŸæ­£çš„å€¼ å°†ä»·æ ¼è§†å›¾æ”¹æˆå¯ä»¥ä¼ é€’å˜é‡çš„é€šç”¨å‡½æ•° 1234567891011121314151617181920212223242526272829303132// ä»·æ ¼struct priceView: View &#123; // å®šä¹‰å˜é‡ var title: String? var price: String? var bgColor: Color? var body: some View &#123; ZStack &#123; VStack()&#123; Text(title!) .font(.system(size: 17)) .fontWeight(.bold) .foregroundColor(Color(red: 190/255, green: 188/255, blue: 184/255)) Text(price!) .fontWeight(.bold) .font(.system(size: 30)) .foregroundColor(Color(red: 239 / 255, green: 129 / 255, blue: 112 / 255)) &#125; // æœ€å¤§å®½åº¦è‡ªé€‚åº” .frame(minWidth: 0, maxWidth: .infinity, minHeight: 90) .padding(20) .background(Color(&quot;faf7f3&quot;)) .cornerRadius(4) .overlay( // è¦†ç›– RoundedRectangle(cornerRadius: 4) .stroke(Color(red: 202 / 255, green: 169 / 255, blue: 106 / 255),lineWidth: 2)) &#125; &#125;&#125; æ­¤æ—¶ï¼Œä½ å¯ä»¥ä¼ é€’4ä¸ªå‚æ•°ï¼Œæ¥ç”Ÿæˆ å‚ç›´åˆ†å¸ƒçš„ è§†å›¾ è¿ç»­åˆ›å»ºä¸‰ä¸ªè§†å›¾å¹¶æ·»åŠ åˆ° æ°´å¹³åˆ†å¸ƒä¸­ 123456789101112131415161718import SwiftUIstruct ContentView: View &#123; var body: some View &#123; HStack &#123; // è¿ç»­åŒ…æœˆ priceView(title: &quot;è¿ç»­åŒ…æœˆ&quot;,price: &quot;$18&quot;,bgColor: Color(&quot;faf7f3&quot;)) // 1ä¸ªæœˆ priceView(title: &quot;1ä¸ªæœˆ&quot;,price: &quot;$30&quot;,bgColor: Color(red: 244/255, green: 244/255, blue: 245/255)) // 12ä¸ªæœˆ priceView(title: &quot;12ä¸ªæœˆ&quot;,price: &quot;$228&quot;,bgColor: Color(red: 244/255, green: 244/255, blue: 245/255)) &#125; .padding(10) &#125;&#125; ç”±äºè¿ç»­åŒ…æœˆä¸Šè¿˜æœ‰ä¸€ä¸ªé¦–æœˆç‰¹æƒ ï¼Œæ‰€ä»¥éœ€è¦ æ’å…¥åˆ° å åŠ åˆ†å¸ƒ ä¸­ 12345678910111213// è¿ç»­åŒ…æœˆZStack &#123; priceView(title: &quot;è¿ç»­åŒ…æœˆ&quot;,price: &quot;$18&quot;,perPrice: &quot;&quot;,bgColor: Color(&quot;faf7f3&quot;)) // é¦–æœˆç‰¹æƒ  Text(&quot;é¦–æœˆç‰¹æƒ &quot;) .font(.system(size: 14)) .fontWeight(.bold) .foregroundColor(.white) .background(Color(red: 202 / 255, green: 169 / 255, blue: 106 / 255)) .cornerRadius(4) .padding(10) .offset(x:0,y:-65)&#125; æœ€åå°† é¦–æœˆç‰¹æƒ  æå–å­è§†å›¾ 12345678910111213// é¦–æœˆç‰¹æƒ struct FirstSpecial: View &#123; var body: some View &#123; Text(&quot;é¦–æœˆç‰¹æƒ &quot;) .font(.system(size: 14)) .fontWeight(.bold) .foregroundColor(.white) .background(Color(red: 202 / 255, green: 169 / 255, blue: 106 / 255)) .cornerRadius(4) .padding(10) .offset(x:0,y:-65) &#125;&#125;","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 05ï¼šä»£ç åˆ†ç»„ç®¡ç†","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 05ï¼šä»£ç åˆ†ç»„ç®¡ç†","date":"2023-02-19T15:14:49.000Z","updated":"2023-03-08T22:31:25.786Z","comments":true,"path":"2023/02/19/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 05ï¼šä»£ç åˆ†ç»„ç®¡ç†/","link":"","permalink":"https://www.bboyzj.cn/2023/02/19/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A005%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%88%86%E7%BB%84%E7%AE%A1%E7%90%86/","excerpt":"","text":"ä¸ºä»€ä¹ˆè¦åˆ†ç»„ç®¡ç†å½“æˆ‘ä»¬ body ä¸­ä»£ç è¶Šæ¥è¶Šå¤šï¼Œä¼šæ˜¾å¾—å¾ˆè‡ƒè‚¿ï¼Œä¸æ˜“è¯»å–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å…¶æ¯ä¸ª ç‹¬ç«‹ çš„éƒ¨åˆ† æå– å‡ºæ¥ æå–å­è§†å›¾ å°†é¼ æ ‡ç§»åŠ¨åˆ° HStackåˆ†å¸ƒè§†å›¾ ä¸Šï¼ŒæŒ‰ä½ commandï¼Œé€‰ä¸­ Extract SubViewï¼Œè¿™ä¸ªæ“ä½œæ˜¯æå–å­è§†å›¾ ç‚¹å‡»åæˆ‘ä»¬å°±å¯ä»¥æŠŠæ ‡é¢˜æå–å‡ºæ¥äº† ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ª ExtractedView()ï¼Œè¿™ä¸ªå°±æ˜¯è¿˜æœªé‡æ–°å‘½åçš„ å®šä»·æ–¹æ¡ˆè§†å›¾ ä¸ºäº†æ–¹ä¾¿å®šä½ä»£ç ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªå­è§†å›¾å‘½åï¼Œç‚¹å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©Refactorï¼Œé€‰æ‹©Rename å‘½åä¸º priceViewï¼Œæœ€å¥½éµå¾ª ã€é©¼å³°å‘½åæ³•ã€‘ ä»£ç æŠ˜å Xcode -&gt; Preference -&gt; Text Editing -&gt; Code folding ribbon","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 04ï¼šVStack,HStack,ZStackè§†å›¾æ’åˆ—ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 04ï¼šVStack-HStack-ZStackè§†å›¾æ’åˆ—ä½¿ç”¨","date":"2023-02-19T13:38:18.000Z","updated":"2023-03-08T22:29:31.031Z","comments":true,"path":"2023/02/19/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 04ï¼šVStack-HStack-ZStackè§†å›¾æ’åˆ—ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/19/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A004%EF%BC%9AVStack-HStack-ZStack%E8%A7%86%E5%9B%BE%E6%8E%92%E5%88%97%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€åœ¨ä¸€ä¸ªé¡µé¢ä¸­ï¼Œç»å¸¸ä¼šçœ‹åˆ°è®¸å¤šUIæ§ä»¶ï¼Œåœ¨ä¸åŒçš„ä½ç½®æ‘†æ”¾ï¼Œåœ¨ SwiftUI ä¸­åˆ†ä¸ºï¼š VStackå‚ç›´æ‘†æ”¾ HStackæ°´å¹³æ‘†æ”¾ ZStackæ©ç›–æ‘†æ”¾ ä¸‰ç§æ‘†æ”¾å›¾ç¤º åˆ›å»ºä¸€ä¸ªæ–°å·¥ç¨‹Stackï¼Œäº†è§£ä¸åŒåˆ†å¸ƒ å‚ç›´åˆ†å¸ƒ 12345678910111213141516171819202122232425// å‚ç›´åˆ†å¸ƒVStack(alignment: .center)&#123; // å±…ä¸­å¯¹é½ Text(&quot;View1&quot;) .font(.system(size: 20)) .foregroundColor(.blue) .frame(width: 300, height: 100, alignment: .center) .background(Color.green) .padding(10) Text(&quot;View2&quot;) .font(.system(size: 20)) .foregroundColor(.blue) .frame(width: 300, height: 100, alignment: .center) .background(Color.green) .padding(10) Text(&quot;View3&quot;) .font(.system(size: 20)) .foregroundColor(.blue) .frame(width: 300, height: 100, alignment: .center) .background(Color.green) .padding(10)&#125; é¢„è§ˆè§†å›¾å¦‚ä¸‹ï¼š æ°´å¹³åˆ†å¸ƒ åŒç† è¦†ç›–åˆ†å¸ƒ åŒç† å†™ä¸€ä¸ªç®€å•çš„æ¡ˆåˆ—æ¡ˆåˆ—å›¾ ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677struct ContentView: View &#123; var body: some View &#123; // å®šä»·æ–¹æ¡ˆ HStack &#123; // è¿ç»­åŒ…æœˆ VStack &#123; ZStack &#123; VStack()&#123; Text(&quot;è¿ç»­åŒ…æœˆ&quot;) .font(.system(size: 17)) .fontWeight(.bold) .foregroundColor(Color(red: 190/255, green: 188/255, blue: 184/255)) Text(&quot;Â¥18&quot;) .fontWeight(.bold) .font(.system(size: 30)) .foregroundColor(Color(red: 239 / 255, green: 129 / 255, blue: 112 / 255)) &#125; // æœ€å¤§å®½åº¦è‡ªé€‚åº” .frame(minWidth: 0, maxWidth: .infinity, minHeight: 90) .padding(20) .background(Color(&quot;faf7f3&quot;)) .cornerRadius(4) .overlay( // è¦†ç›– RoundedRectangle(cornerRadius: 4).stroke(Color(red: 202 / 255, green: 169 / 255, blue: 106 / 255),lineWidth: 2)) // é¦–æœˆç‰¹æƒ  Text(&quot;é¦–æœˆç‰¹æƒ &quot;) .font(.system(size: 14)) .fontWeight(.bold) .foregroundColor(.white) .background(Color(red: 202 / 255, green: 169 / 255, blue: 106 / 255)) .cornerRadius(4) .padding(10) .offset(x:0,y:-65) &#125; &#125; //1ä¸ªæœˆ VStack &#123; Text(&quot;1ä¸ªæœˆ&quot;) .fontWeight(.bold) .font(.system(size: 17)) .foregroundColor(Color(red: 190 / 255, green: 188 / 255, blue: 184 / 255)) Text(&quot;Â¥30&quot;) .fontWeight(.bold) .font(.system(size: 30)) .foregroundColor(Color(red: 239 / 255, green: 129 / 255, blue: 112 / 255)) &#125; .frame(minWidth: 0, maxWidth: .infinity, minHeight: 90) .padding(20) .background(Color(red: 244 / 255, green: 244 / 255, blue: 245 / 255)) .cornerRadius(10) // 12ä¸ªæœˆ VStack()&#123; Text(&quot;12ä¸ªæœˆ&quot;) .font(.system(size: 17)) .fontWeight(.bold) .foregroundColor(Color(red: 190/255, green: 188/255, blue: 184/255)) Text(&quot;Â¥288&quot;) .fontWeight(.bold) .font(.system(size: 30)) .foregroundColor(Color(red: 239 / 255, green: 129 / 255, blue: 112 / 255)) Text(&quot;Â¥19.00/æœˆ&quot;) .fontWeight(.bold) .font(.system(size: 17)) .foregroundColor(Color(red: 190 / 255, green: 188 / 255, blue: 184 / 255)) &#125; .frame(minWidth: 0, maxWidth: .infinity, minHeight: 90) .padding(20) .background(Color(red: 244 / 255, green: 244 / 255, blue: 245 / 255)) .cornerRadius(10) &#125; .padding(10) &#125;&#125; .padding ï¼š è®¾ç½®è¾¹è· command + VStack&#x2F;HStack&#x2F;ZStack å¯ä»¥åœ¨æœ€å¤–å±‚åµŒå…¥ åˆ†å¸ƒ Embed in VStackï¼šåµŒå…¥æ°´å¹³åˆ†å¸ƒ è¦è°ƒæ•´ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ .offset ä¿®é¥°ç¬¦ï¼Œè®¾ç½®åç§»é‡ Xï¼ŒYåˆ†åˆ«å¯¹åº”åæ ‡è½´ä½ç½®ï¼ŒXè½´æ­£æ•°ä¸ºå³ç§»ï¼Œè´Ÿæ•°ä¸ºå·¦ç§»ï¼ŒYè½´æ­£æ•°ä¸‹ç§»ï¼Œè´Ÿæ•°ä¸Šç§»ã€‚ .frame(minWidth: 0, maxWidth: .infinity, minHeight: 90) æœ€å°å®½åº¦0ï¼Œ.infinity æœ€å¤§å®½åº¦è‡ªé€‚åº” swiftUI ä¿®é¥°ç¬¦æœ‰é¡ºåºï¼Œå…ˆåˆ‡åœ†è§’ï¼Œå†åŠ è¾¹æ¡† 1.overlay(RoundedRectangle(cornerRadius: 6).stroke(Color(red: 202 / 255, green: 169 / 255, blue: 106 / 255),lineWidth: 2)) RoundedRectangle()ï¼šåœ†è§’çŸ©å½¢strokeï¼šæè¾¹lineWidthï¼šçº¿å®½cornerRadiusï¼šåœ†è§’åº¦æ•° å¯¼å…¥è‰²å½©çš„åŠæ³•ç‚¹å‡»Assetsï¼Œåœ¨åº•éƒ¨ç‚¹å‡»â€œ+â€æŒ‰é’®ï¼ŒæŒ‘é€‰ New Color Setï¼Œé€‰æ‹© Show Color Panel","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 03ï¼šTextæ–‡å­—å’ŒImageå›¾ç‰‡çš„ä½¿ç”¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 03ï¼šTextæ–‡å­—å’ŒImageå›¾ç‰‡çš„ä½¿ç”¨","date":"2023-02-19T11:44:43.000Z","updated":"2023-03-08T22:26:52.105Z","comments":true,"path":"2023/02/19/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 03ï¼šTextæ–‡å­—å’ŒImageå›¾ç‰‡çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/19/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A003%EF%BC%9AText%E6%96%87%E5%AD%97%E5%92%8CImage%E5%9B%BE%E7%89%87%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"Text æ–‡å­—çš„ä½¿ç”¨ åœ¨ContentView.swiftæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å®ç°å¦‚ä¸‹ä»£ç  12345678910111213141516171819202122232425struct ContentView: View &#123; var body: some View &#123; // åˆå§‹åŒ–ä¸€ä¸ªæ–‡æœ¬ Text(&quot;Hello World&quot;) // èƒŒæ™¯é¢œè‰² .background(Color.red) // è®¾ç½®å­—é‡ï¼šå­—ä½“åŠ ç²— .fontWeight(.bold) // å­—ä½“å¤§å° .font(.system(size: 20)) // å­—ä½“é¢œè‰² .foregroundColor(.blue) // é˜´å½± .shadow(color: .black, radius: 1) // è¾¹è· .padding(10) &#125;&#125;struct ContentView_Previews: PreviewProvider &#123; static var previews: some View &#123; ContentView() &#125;&#125; æ›´å¤šå‚æ•°è®¾ç½®å¦‚ä¸‹: Image å›¾ç‰‡çš„ä½¿ç”¨åœ¨ Assets.xcassets æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å¯¼å…¥ æœ¬åœ°å›¾ç‰‡ç´ æï¼Œä¹Ÿå¯ä»¥è®¾ç½®é¢œè‰² ä¸Šé¢æˆ‘ä»¬å¯¼å…¥äº†ä¸€å¼ å›¾ç‰‡ï¼Œå›åˆ°ä»£ç ï¼š 12345678910111213141516171819// åˆå§‹åŒ–ä¸€å¼ å›¾ç‰‡Image(&quot;test&quot;) // ç¼©æ”¾å›¾ç‰‡ï¼ˆæ‹‰ä¼¸ç¼©æ”¾ï¼‰ .resizable() // ç­‰æ¯”ä¾‹ç¼©æ”¾ .scaledToFit() // è°ƒæ•´å›¾ç‰‡å°ºå¯¸ .frame(width: 300) // è£å‰ªå›¾ç‰‡ .clipShape(Circle()) // é€æ˜åº¦ .opacity(0.8) // è¦†ç›–ä¸€å±‚è§†å›¾ .overlay( Text(&quot;ç¼–è¾‘&quot;) .fontWeight(.bold) .font(.system(size: 20)) .foregroundColor(.white) ) æœ€ååœ¨é¢„è§ˆä¸­å‘ˆç°çš„æ ·å¼å¦‚ä¸‹ï¼š çŸ¥è¯†ç‚¹ï¼šImageé™¤äº†å¯ä»¥å±•ç¤º æœ¬åœ°å›¾ç‰‡ï¼Œè¿˜å¯ä»¥å±•ç¤º ç½‘ç»œå›¾ç‰‡ å’Œ ç³»ç»Ÿå›¾æ ‡ å®˜æ–¹ç¬¦å·Apple å®˜æ–¹æä¾›äº† 3000 ä¸ªæ–°ç¬¦å·ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œå¼€å‘è€…å‡ ä¹æ— éœ€è‡ªå·±æ”¶é›†å¸¸ç”¨å›¾æ ‡ Appleå®˜æ–¹å›¾æ ‡ ä½¿ç”¨æ–¹å¼ 123// ä½¿ç”¨ç³»ç»Ÿå›¾æ ‡Image(systemName: &quot;square.and.arrow.up&quot;) .font(.system(size: 50)) å®‰å…¨åŒºæˆ‘ä»¬çœ‹åˆ°æ¨¡æ‹Ÿå™¨é¢„ç•™äº† é¡¶æ  å’Œ åº•æ  ä¸¤å—åŒºåŸŸï¼Œè¿™æ˜¯ å®‰å…¨åŒºåŸŸ å¦‚æœæƒ³å¿½ç•¥å®‰å…¨åŒºåŸŸï¼ŒæŠŠè§†å›¾æ’‘å¼€æ•´ä¸ªå±å¹•ï¼Œé€šè¿‡è®¾ç½® .edgesIgnoringSafeArea ä¿®é¥°ï¼š 1.edgesIgnoringSafeArea(.all)","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 02ï¼šæ­å»ºä¸€ä¸ªæ–°é¡¹ç›®","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 02ï¼šæ­å»ºä¸€ä¸ªæ–°é¡¹ç›®","date":"2023-02-19T11:03:33.000Z","updated":"2023-03-08T22:24:33.708Z","comments":true,"path":"2023/02/19/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 02ï¼šæ­å»ºä¸€ä¸ªæ–°é¡¹ç›®/","link":"","permalink":"https://www.bboyzj.cn/2023/02/19/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A002%EF%BC%9A%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E9%A1%B9%E7%9B%AE/","excerpt":"","text":"å‰è¨€åœ¨æœ¬ç« ä¸­ï¼Œä½ å°†å­¦ä¼šå¦‚ä½•ä½¿ç”¨Xcodeåˆ›å»ºä¸€ä¸ªSwiftUIé¡¹ç›® åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªSwiftUIé¡¹ç›®é¦–å…ˆï¼Œå¯åŠ¨Xcodeï¼Œåœ¨é¡¶æ é€‰æ‹© File -&gt; New -&gt; Project åœ¨ iOS ç±»ç›®ä¸‹ï¼Œé€‰æ‹© Appï¼Œé€‰æ‹© Nextï¼Œç»§ç»­ä¸‹ä¸€ä¸ªå±å¹• choose options for your new projectï¼šå®Œå–„é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ Productï¼šé¡¹ç›®åç§°ï¼Œæœ€å¥½æ˜¯è‹±æ–‡ Teamï¼šå¼€å‘è€…è´¦å·ï¼ˆä¸ªäººã€å…¬å¸ã€ä¼ä¸šï¼‰ Organization Nameï¼šç»„ç»‡åç§° Organization Identifierï¼šåº”ç”¨ç¨‹åºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåå‘DNSè¡¨ç¤ºæ³•ï¼Œç”µå­é‚®ä»¶ååœ°å€æˆ–å…¬å¸åœ°å€é¢ å€’ Bundle Identifierï¼šç»„ç»‡å”¯ä¸€æ ‡è¯†.é¡¹ç›®åç§° Interfaceï¼šç”¨æˆ·ç•Œé¢ï¼ŒSwiftUI æˆ– Storyboard Languageï¼šè¯­è¨€ï¼ŒSwift æˆ– Objective-C Use Core Dataï¼šé¢å‘å¯¹è±¡çš„æ•°æ®åº“ï¼Œä¸é€‰ Include Testsï¼šæµ‹è¯•ï¼Œä¸é€‰ ç‚¹å‡» Next ï¼Œé€‰æ‹©æ–‡ä»¶ä¿å­˜ç›®å½•åï¼Œæˆ‘ä»¬æˆåŠŸåˆ›å»ºä¸€ä¸ªSwiftUIé¡¹ç›® é»˜è®¤æƒ…å†µä¸‹ï¼ŒXcodeè‡ªåŠ¨æ ¹æ® ContentView.swift å†…å®¹ç”Ÿæˆ SwiftUI ç¤ºä¾‹ä»£ç  å¯ä»¥æ ¹æ®é¡¶éƒ¨è·¯å¾„åˆ‡æ¢æ¨¡æ‹Ÿå™¨å‹å·ï¼Œç„¶åå•å‡»é¢„è§ˆåŒº Resume æŒ‰é’®ï¼ŒæŸ¥çœ‹å®æ—¶é¢„è§ˆæ•ˆæœ Xcodeç•Œé¢ ä¸­é—´ï¼šä¸»ç¼–è¾‘çª—å£ï¼Œåˆ†ä¸¤éƒ¨åˆ† ä»£ç åŒº é¢„è§ˆåŒº å·¦ä¾§ï¼šæ–‡ä»¶å¯¼èˆªå™¨ å³ä¾§ï¼šå®ç”¨ç¨‹åºçª—å£ ä¸‹é¢ï¼šè°ƒè¯•å™¨ï¼Œæ§åˆ¶å°è¾“å‡º é¢„è§ˆåŒº Live ï¼š æ¨¡æ‹Ÿä¸€ä¸ªå®é™…çš„çœŸå®äº’åŠ¨æƒ…å†µ Selectableï¼š é€‰æ‹©æ¨¡å¼ï¼Œé€‰ä¸­ç”»é¢å†…å®¹ æ‰¾åˆ° å¯¹åº”çš„ä»£ç  Variantsï¼š å¿«è¯»æ¯”è¾ƒä¸€ä¸‹ä¸åŒçš„æƒ…æ™¯ï¼Œä½†å¹¶ä¸ç”Ÿæ•ˆ Color Scheme Variantsï¼šé¢œè‰²æ–¹æ¡ˆ Lightï¼ˆæµ…è‰²ï¼‰ Darkï¼ˆæ·±è‰²ï¼‰Orientation Variantsï¼šæ–¹å‘ ç«–å‘ï¼ˆPortraitï¼‰ æ¨ªå‘ï¼ˆLandscapeï¼‰Dynamic Type Variantsï¼šåŠ¨æ€ç±»å‹ ä½¿ç”¨è€…é€‰æ‹©çš„å­—ä½“å¤§å°ï¼ˆä»æœ€å°çš„XS -&gt; æœ€å¤§çš„ AX5ï¼‰ Device Setting ï¼š è®¾ç½®ä¸Šé¢çš„3ä¸ªä¸åŒæƒ…æ™¯å¹¶ç”Ÿæ•ˆ Preview on Deviceï¼š åœ¨å…·ä½“çš„è®¾å¤‡é¢„è§ˆ Appå…¥å£123456789101112// @main ä»£è¡¨çš„å°±æ˜¯è¿™ä¸ªAppçš„å…¥å£@mainstruct FirstDemoApp: App &#123; // bodyå±æ€§è®¾è®¡ä¸€ä¸ªSceneçš„ç±»å‹ var body: some Scene &#123; // è§†çª— WindowGroup &#123; // æœ€åº•å±‚çš„ç”»é¢ ContentView() &#125; &#125;&#125; ä¸€ä¸ªAppåŸºæœ¬çš„æ¶æ„å°±æ˜¯ï¼ŒAppé‡Œé¢ä¼šæœ‰ä¸€ä¸ª è§†çª—Sceneï¼Œè§†çª—Scene é‡Œé¢ä¼šæœ‰ Viewï¼Œä½ åªè¦è®¾å®šä¸€ä¸ªéµå¾ª Protocol è§„èŒƒçš„ç±»å‹ï¼Œå°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„åŠŸèƒ½ï¼ŒAppéœ€è¦çŸ¥é“è§†çª—Sceneæ˜¯ä»€ä¹ˆï¼Œsceneéœ€è¦çŸ¥é“view AssetsåŒ…åœ¨è¿™ä¸ª target ä¸­çš„æ¡£æ¡ˆï¼Œå¦‚å›¾ç‰‡ã€iconã€color Preview Contentå­˜æ”¾ä¸€äº›å¼€å‘æ—¶ç”¨åˆ°çš„ å›¾ç‰‡å’Œèµ„æ–™ç­‰ï¼Œåœ¨æ‰“åŒ…çš„æ—¶å€™å›è‡ªåŠ¨è¢«æ’é™¤ã€‚","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"SwiftUIå­¦ä¹ 01ï¼šSwiftå…¥é—¨","slug":"SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 01ï¼šSwiftUIå…¥é—¨","date":"2023-02-19T07:05:11.000Z","updated":"2023-03-08T22:19:55.868Z","comments":true,"path":"2023/02/19/SwiftUIè¯¾ç¨‹/SwiftUIå­¦ä¹ 01ï¼šSwiftUIå…¥é—¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/19/SwiftUI%E8%AF%BE%E7%A8%8B/SwiftUI%E5%AD%A6%E4%B9%A001%EF%BC%9ASwiftUI%E5%85%A5%E9%97%A8/","excerpt":"","text":"ä»€ä¹ˆæ˜¯SwiftUIï¼Ÿ SwiftUI å®ƒæ˜¯ä¸€ä¸ªç”¨æ¥è®¾è®¡æ‰€æœ‰ Appleæ‰€æœ‰å¹³å°ï¼ˆå¦‚ï¼šWatchåº”ç”¨ã€Apple TVã€Macåº”ç”¨ï¼‰App çš„ framework SwiftUI æ”¯æŒ é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä¹Ÿé¢å‘ å‡½æ•°å¼ç¼–ç¨‹ æˆ– é¢å‘åè®®ç¼–ç¨‹ã€‚ swiftUIç‰¹ç‚¹ frameworkï¼šå¸®æˆ‘ä»¬å¿«é€Ÿçš„æ¶æ„UIã€å¤„ç†ä½¿ç”¨è€…äº’åŠ¨å’Œèµ„æ–™ç®¡ç† å®£å‘Šå¼è¯­æ³•ï¼ˆdeclarativeï¼‰ï¼šç®€æ´ã€å¥½ä¸Šæ‰‹ã€å¿«é€Ÿå¼€å‘ æ”¯æŒæ‰€æœ‰ Apple å¹³å°ï¼šiOS 14.0+ã€iPad 14.0+ã€macOS 10.15+ã€Mac Catelyst 14.0+ã€tvOS 14.0+ã€watchOS 6.0+ 6ä¸ªå¹³å° æ³¨ï¼šå®ƒæœ‰ç‰ˆæœ¬çš„é™åˆ¶ï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªç›¸å¯¹æ–°çš„frameworkï¼Œæœ€å°‘éœ€è¦iOS14æ‰èƒ½æ”¯æŒ","categories":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}],"tags":[{"name":"SwiftUI-å­¦ä¹ ç¯‡","slug":"SwiftUI-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/tags/SwiftUI-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"keywords":[{"name":"SwiftUI","slug":"SwiftUI","permalink":"https://www.bboyzj.cn/categories/SwiftUI/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 19ï¼šæ•°æ®ç±»å‹","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 19ï¼šæ•°æ®ç±»å‹","date":"2023-02-18T08:41:06.000Z","updated":"2023-03-01T13:51:51.657Z","comments":true,"path":"2023/02/18/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 19ï¼šæ•°æ®ç±»å‹/","link":"","permalink":"https://www.bboyzj.cn/2023/02/18/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A019%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/","excerpt":"","text":"æ•°æ®ç±»å‹ åŸºæœ¬ç±»å‹ æ•°å€¼ç±»å‹ï¼š æ•´æ•°ç±»å‹ï¼šçŸ­æ•´å‹ shortã€æ•´å‹ intã€é•¿æ•´å‹ long æµ®ç‚¹ç±»å‹ï¼šå•ç²¾åº¦å‹ floatã€åŒç²¾åº¦å‹ double å­—ç¬¦ç±»å‹ï¼šchar æ„é€ ç±»å‹ æ•°ç»„ ç»“æ„ä½“ï¼šstruct å…±ç”¨ä½“ï¼šunion æšä¸¾ç±»å‹ï¼šenum æŒ‡é’ˆç±»å‹ ç©ºç±»å‹ void æ³¨æ„ï¼š c è¯­è¨€ä¸­æ²¡æœ‰å­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨ å­—ç¬¦æ•°ç»„char[] è¡¨ç¤ºå­—ç¬¦ä¸² ä¸åŒæ“ä½œç³»ç»Ÿï¼Œæ•°æ®ç±»å‹ å ç”¨å­—èŠ‚é•¿åº¦ä¸ä¸€æ · åŸºæœ¬æ•°æ®ç±»å‹ sizeofè¿ç®—ç¬¦ ç”¨äº è·å–æ•°æ®ç±»å‹æˆ–è¡¨è¾¾å¼çš„é•¿åº¦ï¼Œé•¿åº¦ä»¥ å­—èŠ‚ è¡¨ç¤º signed å’Œ unsigned signedï¼šæœ‰ç¬¦å·ï¼Œç¬¬ä¸€ä¸ªä½ä»£è¡¨æ­£è´Ÿï¼Œå‰©ä½™ä»£è¡¨å¤§å°ã€‚ unsignedï¼šæ— ç¬¦å·ï¼Œæ‰€æœ‰ä½éƒ½ä¸ºå¤§å°ï¼Œæ²¡æœ‰è´Ÿæ•°ã€‚ åŸºæœ¬æ•°æ®ç±»å‹çš„å–å€¼èŒƒå›´ æ¯”ç‰¹ä½ CPUèƒ½è¯»æ‡‚çš„æœ€å°å•ä½æ˜¯ï¼šæ¯”ç‰¹ä½ï¼Œbitï¼Œbã€‚æ¯ä¸ªæ¯”ç‰¹ä½åªèƒ½å­˜æ”¾äºŒè¿›åˆ¶æ•°ï¼Œå³0å’Œ1ã€‚ å­—èŠ‚ å†…å­˜æœºæ„æœ€å°å¯»å€å•ä½ï¼šå­—èŠ‚ï¼ŒByteï¼ŒB 1Byte &#x3D; 8 bit","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 18ï¼šå¸¸é‡","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 18ï¼šå¸¸é‡","date":"2023-02-18T08:14:14.000Z","updated":"2023-03-01T13:51:44.295Z","comments":true,"path":"2023/02/18/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 18ï¼šå¸¸é‡/","link":"","permalink":"https://www.bboyzj.cn/2023/02/18/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A018%EF%BC%9A%E5%B8%B8%E9%87%8F/","excerpt":"","text":"C å¸¸é‡ å¸¸é‡æ˜¯å›ºå®šå€¼ï¼Œåœ¨æ‰§è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜ï¼Œè¿™äº›å›ºå®šå€¼ï¼Œåˆå«åš å­—é¢é‡ å¸¸é‡å¯ä»¥æ˜¯ä»»ä½•çš„ åŸºæœ¬æ•°æ®ç±»å‹ã€‚ å¸¸é‡ å°±æ˜¯å¸¸è§„çš„å˜é‡ï¼Œåªä¸è¿‡åœ¨å®šä¹‰åä¸èƒ½è¿›è¡Œä¿®æ”¹ã€‚ å®šä¹‰å¸¸é‡ ä½¿ç”¨ #define é¢„å¤„ç†å™¨ #define LENGTH 10 ä½¿ç”¨ const å…³é”®å­— const type variable = value;","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 17ï¼štypedef","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 17ï¼štypedef","date":"2023-02-18T05:58:49.000Z","updated":"2023-03-01T13:51:40.382Z","comments":true,"path":"2023/02/18/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 17ï¼štypedef/","link":"","permalink":"https://www.bboyzj.cn/2023/02/18/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A017%EF%BC%9Atypedef/","excerpt":"","text":"typedefC è¯­è¨€æä¾›äº†å…³é”®å­— typedef ï¼Œå¯ä»¥ç”¨å®ƒä¸º ç±»å‹ å–ä¸€ä¸ªæ–°çš„åå­—ã€‚ ä¾‹å¦‚ï¼šä¸ºæ— ç¬¦å·å­—ç¬¦å®šä¹‰ä¸€ä¸ªåç§° UChar typedef unsigned char UChar; ä¾‹å¦‚ï¼šä¸ºç»“æ„ä½“å®šä¹‰ä¸€ä¸ªåç§° MyBook 1234567891011121314151617181920212223#include &lt;stdio.h&gt;#include &lt;string.h&gt;typedef struct Book&#123; char title[50]; int book_id;&#125;MyBook;int main(int argc, const char * argv[]) &#123; // typedefå‰// struct Book myBook; // typedefå MyBook book; strcpy(book.title,&quot;ZJ&quot;); book.book_id = 12; printf(&quot;æ ‡é¢˜ï¼š%s\\n&quot;,book.title); printf(&quot;ä¹¦ ID:%d\\n&quot;,book.book_id); return 0;&#125; å½“ä¸Šé¢çš„ä»£ç  ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œäº§ç”Ÿçš„ç»“æœ 123æ ‡é¢˜ï¼šZJä¹¦ ID:12Program ended with exit code: 0 typedef å’Œ #define åŒºåˆ« typedef ä»…é™äºä¸º ç±»å‹ å®šä¹‰åç§°ï¼›#define ä¸ä»…å¯ä»¥ä¸º ç±»å‹ å®šä¹‰åˆ«ä¹°ï¼Œä¹Ÿå¯ä»¥ä¸º æ•°å€¼ å®šä¹‰ typedefç”±ç¼–è¯‘å™¨ æ‰§è¡Œ è§£é‡Šï¼›#defineç”±ç¼–è¯‘å™¨ é¢„å¤„ç† å¤„ç†","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 16ï¼šenum(æšä¸¾)","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 16ï¼šenum-æšä¸¾","date":"2023-02-18T05:58:37.000Z","updated":"2023-03-01T13:51:36.445Z","comments":true,"path":"2023/02/18/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 16ï¼šenum-æšä¸¾/","link":"","permalink":"https://www.bboyzj.cn/2023/02/18/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A016%EF%BC%9Aenum-%E6%9E%9A%E4%B8%BE/","excerpt":"","text":"enum(æšä¸¾)æšä¸¾åœ¨ C ä¸­æ˜¯ä¸€ç§ åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå®ƒå¯ä»¥è®©æ•°æ® æ›´ç®€æ´ã€æ›´æ˜“è¯» æšä¸¾è¯­æ³•å®šä¹‰æ ¼å¼ï¼š enum æšä¸¾å &#123;æšä¸¾å…ƒç´ 1,æšä¸¾å…ƒç´ 2,...&#125; ä¸€ä¸ªæ˜ŸæœŸçš„ä¾‹å­ï¼š 123enum DAY&#123; MON=1,TUE,WED,THU,FRI,SAT,SUN&#125;; æšä¸¾å˜é‡çš„å®šä¹‰ å…ˆå®šä¹‰æšä¸¾ç±»å‹ï¼Œå†å®šä¹‰æšä¸¾å˜é‡ 123456789101112// å®šä¹‰æšä¸¾ç±»å‹enum DAY&#123; MON=1,TUE,WED,THU,FRI,SAT,SUN&#125;;int main(int argc, const char * argv[]) &#123; // å®šä¹‰æšä¸¾å˜é‡ enum DAY day; printf(&quot;%d\\n&quot;,day=WED); return 0;&#125; å®šä¹‰æšä¸¾ç±»å‹çš„åŒæ—¶ï¼Œå®šä¹‰æšä¸¾å˜é‡ 1234// å®šä¹‰æšä¸¾ç±»å‹å’Œå˜é‡enum DAY&#123; MON=1,TUE,WED,THU,FRI,SAT,SUN&#125;day; çœç•¥æšä¸¾åç§°ï¼Œç›´æ¥å®šä¹‰æšä¸¾å˜é‡ 1234// çœç•¥æšä¸¾åç§°ï¼Œç›´æ¥å®šä¹‰æšä¸¾å˜é‡enum &#123; MON=1,TUE,WED,THU,FRI,SAT,SUN&#125;day; å®ä¾‹ï¼Œéå†æšä¸¾ 1234567891011// çœç•¥æšä¸¾åç§°ï¼Œç›´æ¥å®šä¹‰æšä¸¾å˜é‡enum &#123; MON=1,TUE,WED,THU,FRI,SAT,SUN&#125;day;int main(int argc, const char * argv[]) &#123; for (day = MON; day&lt;=SUN; day++) &#123; printf(&quot;%d\\n&quot;,day); &#125; return 0;&#125; å½“ä¸Šé¢çš„ä»£ç  ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œäº§ç”Ÿç»“æœ 123456781234567Program ended with exit code: 0","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 15ï¼šé€’å½’","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 15ï¼šé€’å½’","date":"2023-02-18T05:58:13.000Z","updated":"2023-03-01T13:51:32.643Z","comments":true,"path":"2023/02/18/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 15ï¼šé€’å½’/","link":"","permalink":"https://www.bboyzj.cn/2023/02/18/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A015%EF%BC%9A%E9%80%92%E5%BD%92/","excerpt":"","text":"é€’å½’é€’å½’æŒ‡ï¼š å‡½æ•°ä¸­ä½¿ç”¨å‡½æ•°è‡ªèº«çš„æ–¹æ³• C è¯­è¨€ä¸­æ”¯æŒé€’å½’ï¼Œå³ ä¸€ä¸ªå‡½æ•°å¯ä»¥è°ƒç”¨è‡ªèº«ï¼Œåœ¨ä½¿ç”¨é€’å½’æ—¶ï¼Œç¨‹åºå‘˜è¦æ³¨æ„å‡½æ•°çš„ é€€å‡ºæ¡ä»¶ï¼Œå¦åˆ™ä¼šè¿›å…¥æ­»å¾ªç¯ æ•°çš„é˜¶ä¹˜1234567891011121314double factorial(unsigned int i)&#123; if (i&lt;=1)&#123; return 1; &#125; return i * factorial(i-1);&#125;int main(int argc, const char * argv[]) &#123; int i = 5; printf(&quot;%d çš„é˜¶ä¹˜æ˜¯ï¼š%f\\n&quot;,i,factorial(i)); return 0;&#125; å½“ä¸Šé¢çš„ä»£ç è¢« ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œäº§ç”Ÿçš„ç»“æœï¼š 125 çš„é˜¶ä¹˜æ˜¯ï¼š120.000000Program ended with exit code: 0 æ–æ³¢é‚£å¥‘é¢æ•°åˆ—å½“å‰æ•°æ˜¯å‰ä¸¤ä¸ªæ•°ä¹‹å’Œ 12345678910111213141516171819int fibonaci(int i)&#123; if (i == 0) &#123; return 0; &#125; if (i == 1) &#123; return 1; &#125; return fibonaci(i-1) + fibonaci(i-2);&#125;int main(int argc, const char * argv[]) &#123; for (int i = 0; i &lt; 10; i++)&#123; printf(&quot;%d\\t\\n&quot;, fibonaci(i)); &#125; return 0;&#125; å½“ä¸Šé¢çš„ä»£ç  ç¼–è¯‘å’Œè¿è¡Œæ—¶ï¼Œäº§ç”Ÿçš„ç»“æœï¼š 12345678910110 1 1 2 3 5 8 13 21 34 Program ended with exit code: 0","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Flutteré¢è¯•é¢˜ï¼šFlutter","slug":"é¢è¯•é¢˜/Flutteré¢è¯•é¢˜ï¼šFlutter","date":"2023-02-15T17:21:00.000Z","updated":"2023-03-08T21:39:32.273Z","comments":true,"path":"2023/02/16/é¢è¯•é¢˜/Flutteré¢è¯•é¢˜ï¼šFlutter/","link":"","permalink":"https://www.bboyzj.cn/2023/02/16/%E9%9D%A2%E8%AF%95%E9%A2%98/Flutter%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9AFlutter/","excerpt":"","text":"ä»€ä¹ˆæ˜¯flutterï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ flutter æ˜¯ google æ¨å‡ºå¹¶ å¼€æºçš„ç§»åŠ¨åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œé€šè¿‡ dart è¯­è¨€å¼€å‘APPï¼Œä¸€å¥—ä»£ç å¯ä»¥åŒæ—¶è¿è¡Œåœ¨ iOS å’Œ Android å¹³å°ã€‚ flutter åº•å±‚ä½¿ç”¨ skia ä½œä¸º 2Dæ¸²æŸ“å¼•æ“ï¼Œé€šè¿‡è‡ªå·±çš„æ¸²æŸ“å¼•æ“æ¥ ç»˜åˆ¶widget(ç»„ä»¶)ï¼Œdart è¯­è¨€å€Ÿé‰´äº† Java å’Œ JavaScript åŒæ—¶åŠ å…¥äº†ä¸€äº› ç°ä»£ç¼–ç¨‹è¯­è¨€ ç‰¹æ€§ã€‚","categories":[{"name":"Flutter","slug":"Flutter","permalink":"https://www.bboyzj.cn/categories/Flutter/"}],"tags":[{"name":"Flutter-é¢è¯•é¢˜","slug":"Flutter-é¢è¯•é¢˜","permalink":"https://www.bboyzj.cn/tags/Flutter-%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"keywords":[{"name":"Flutter","slug":"Flutter","permalink":"https://www.bboyzj.cn/categories/Flutter/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 14ï¼šå†…å­˜ç®¡ç†","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 14ï¼šå†…å­˜ç®¡ç†","date":"2023-02-14T16:14:03.000Z","updated":"2023-03-01T13:51:28.902Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 14ï¼šå†…å­˜ç®¡ç†/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A014%EF%BC%9A%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","excerpt":"","text":"å†…å­˜ç®¡ç†C è¯­è¨€ä¸ºå†…å­˜ åˆ†é…å’Œç®¡ç† æä¾›äº†å‡ ä¸ªå‡½æ•°ï¼Œè¿™äº›å‡½æ•°éƒ½åœ¨ &lt;stdlib.h&gt; å¤´æ–‡ä»¶ä¸­ åŠ¨æ€å†…å­˜åˆ†é… å…¨å±€å˜é‡ åˆ†é…åœ¨å†…å­˜ä¸­çš„ é™æ€å­˜å‚¨åŒº å±€éƒ¨å˜é‡ åˆ†é…åœ¨å†…å­˜ä¸­çš„ åŠ¨æ€å­˜å‚¨åŒºï¼Œå­˜æ”¾åœ¨ æ ˆï¼ˆstackï¼‰ åŒºã€‚ ä¸´æ—¶æ•°æ® åˆ†é…åœ¨å†…å­˜ä¸­çš„ åŠ¨æ€å­˜å‚¨åŒºï¼Œå­˜æ”¾åœ¨ å †ï¼ˆheapï¼‰ åŒº ç”¨ malloc å‡½æ•°å¼€è¾ŸåŠ¨æ€å­˜å‚¨åŒº void * malloc(unsigned int size); åœ¨å†…å­˜åŠ¨æ€å­˜å‚¨åŒºåˆ†é…ä¸€ä¸ªé•¿åº¦ä¸ºsizeçš„è¿ç»­ç©ºé—´ï¼Œå½¢å‚sizeç±»å‹ä¸ºæ— ç¬¦å·æ•´å‹ malloc(100)ï¼šå¼€è¾Ÿ100å­—èŠ‚çš„ä¸´æ—¶åˆ†é…åŸŸï¼Œå…¶å€¼ä¸ºç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ ç”¨ calloc å‡½æ•°å¼€è¾ŸåŠ¨æ€å­˜å‚¨åŒº void * calloc(unsigned n,unsigned int size); å†…å­˜ä¸­åˆ†é…nä¸ªé•¿åº¦ä¸ºsizeçš„è¿ç»­ç©ºé—´ ç”¨ recalloc å‡½æ•°é‡æ–°åˆ†é…åŠ¨æ€å­˜å‚¨åŒº void * recalloc(void *p,unsigned int size); å¦‚æœå·²ç»ç”¨ malloc å’Œ calloc å‡½æ•°è·å–äº†ï¼Œæƒ³æ”¹å˜å¤§å°ï¼Œç”¨ recalloc é‡æ–°åˆ†é… recalloc(p,50); &#x2F;&#x2F; å°†pæ‰€æŒ‡å‘çš„å·²åˆ†é…çš„åŠ¨æ€å†…å­˜æ”¹ä¸º50å­—èŠ‚ ç”¨ free å‡½æ•°é‡Šæ”¾åŠ¨æ€å­˜å‚¨åŒº void free(void *p); å…¶ä½œç”¨æ˜¯é‡Šæ”¾æŒ‡é’ˆå˜é‡pæ‰€æŒ‡å‘çš„åŠ¨æ€ç©ºé—´ã€‚","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 13ï¼šæ–‡ä»¶","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 13ï¼šæ–‡ä»¶","date":"2023-02-14T16:13:49.000Z","updated":"2023-03-01T13:51:25.322Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 13ï¼šæ–‡ä»¶/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A013%EF%BC%9A%E6%96%87%E4%BB%B6/","excerpt":"","text":"æ‰“å¼€æ–‡ä»¶FILE * fopen(const char * filename,const * mode); filename:æ–‡ä»¶åmodeï¼šæ ·å¼ å…³é—­æ–‡ä»¶int fclose(int c,FILE *fp); fclose()å‡½æ•°è¿”å›é›¶ï¼šå…³é—­æˆåŠŸfclose()éŸ©å¼è¿”å›EOFï¼šå…³é—­å¤±è´¥ æ³¨ï¼šEOF æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨å¤´æ–‡ä»¶&lt;stdio.h&gt;ä¸­çš„å¸¸é‡ å†™å…¥æ–‡ä»¶ æŠŠå­—ç¬¦å†™å…¥åˆ°æµä¸­ int fputc(char c,FILE *fp); æŠŠå­—ç¬¦ä¸²å†™å…¥åˆ°æµä¸­ int fputs(const char *s,FILE *fp); æˆ– int fprintf(FILE *fp,const char *format,...); æ³¨ï¼šè¯·ç¡®ä¿æ‚¨æœ‰å¯ç”¨çš„tmpç›®å½• è¯»å–æ–‡ä»¶ è¯»å–ä¸€ä¸ªå­—ç¬¦ int fgetc(FILE *fp); è¯»å– å­—ç¬¦ä¸² char * fgets(char *buf,int n,FILE *fp); è¯»å– n-1 ä¸ªå­—ç¬¦ï¼Œè¯»å–åˆ°çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°ç¼“å†²åŒºbufï¼Œå¹¶è¿½åŠ ä¸€ä¸ª null å­—ç¬¦ï¼›å¦‚æœè¯»å–åˆ° \\næˆ–EOF ç»“æŸ æˆ– int fscanf(FILE *fp, const char *format, ...); è¯»å–å­—ç¬¦ä¸²ï¼Œé‡åˆ° ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ åœæ­¢ äºŒè¿›åˆ¶ I&#x2F;O å‡½æ•°äºŒè¿›åˆ¶è¾“å…¥å’Œè¾“å‡º 12345size_t fread(void *ptr, size_t size_of_elements, size_t number_of_elements, FILE *a_file); size_t fwrite(const void *ptr, size_t size_of_elements, size_t number_of_elements, FILE *a_file);","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 12ï¼šé¢„å¤„ç†å™¨","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 12ï¼šé¢„å¤„ç†å™¨","date":"2023-02-14T16:13:38.000Z","updated":"2023-03-01T13:51:21.761Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 12ï¼šé¢„å¤„ç†å™¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A012%EF%BC%9A%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8/","excerpt":"","text":"C é¢„å¤„ç†å™¨é¢„å¤„ç†å™¨ ä¸æ˜¯ ç¼–è¯‘å™¨çš„ç»„æˆéƒ¨åˆ†ï¼Œæ˜¯ç¼–è¯‘è¿‡ç¨‹çš„ä¸€ä¸ªå•ç‹¬çš„æ­¥éª¤ã€‚ç®€è¨€ä¹‹ï¼ŒCé¢„å¤„ç†å™¨æ˜¯ä¸€ä¸ª æ–‡æœ¬æ›¿æ¢å·¥å…·ï¼Œå®ƒä¼šæŒ‡ç¤ºç¼–è¯‘å™¨åœ¨å®é™…ç¼–è¯‘å‰å®Œæˆæ‰€éœ€çš„ é¢„å¤„ç†ï¼›æˆ‘ä»¬æŠŠ C é¢„å¤„ç†å™¨(C Preprocessor) ç®€å†™æˆ(CPP) æ‰€æœ‰çš„é¢„å¤„ç†å™¨éƒ½æ˜¯ä»¥ # å¼€å¤´ï¼Œéç©ºå­—ç¬¦ï¼Œä¸ºå¢åŠ å¯è¯»æ€§ï¼Œä»ç¬¬ä¸€åˆ—å¼€å§‹ï¼Œä¸‹é¢åˆ—å‡ºäº†æ‰€æœ‰çš„é¢„å¤„ç†å‘½ä»¤ï¼š é¢„å¤„ç†å®ä¾‹#define MAX_LENGTH 20 è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰ CPP æŠŠæ‰€æœ‰çš„ MAX_LENGTH å®šä¹‰ä¸º 20ï¼Œä½¿ç”¨ #define å®šä¹‰å¸¸é‡æ¥å¢å¼ºå¯è¯»æ€§ 12#include &lt;stdio,h&gt;#include &quot;myheader.h&quot; è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰ CPP ä» ç³»ç»Ÿåº“ ä¸­è¯»å– stdio.hï¼Œå¹¶æ·»åŠ åˆ° å½“å‰æºæ–‡ä»¶ ä¸­ï¼›ä¸‹ä¸€è¡Œå‘Šè¯‰ CPP ä» æœ¬åœ°ç›®å½• ä¸­è·å– myheader.hï¼Œå¹¶æ·»åŠ åˆ° å½“å‰æºæ–‡ä»¶ä¸­ 12#undef FILE_SIZE#define FILE_SIZE 30 è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰ CPP å–æ¶ˆå·²å®šä¹‰çš„ FILE_SIZEï¼Œå¹¶å®šä¹‰å®ƒä¸º 30 123#ifndef MESSAGE #define MESSAGE &quot;You wish!&quot;#endif è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰ CPP åªè¦å½“ MESSAGE æœªå®šä¹‰æ—¶ï¼Œæ‰å®šä¹‰ MESSAGE 123#ifdef DEBUG /*debug here*/#endif è¿™ä¸ªæŒ‡ä»¤å‘Šè¯‰ CPP ï¼Œå¦‚æœå®šä¹‰äº† DEBUG,åˆ™æ‰§è¡Œè¯­å¥ã€‚ é¢„å®šä¹‰å®ANSI C å®šä¹‰äº†è®¸å¤šå® 1234567891011#include &lt;stdio.h&gt; main()&#123; printf(&quot;File :%s\\n&quot;, __FILE__ ); printf(&quot;Date :%s\\n&quot;, __DATE__ ); printf(&quot;Time :%s\\n&quot;, __TIME__ ); printf(&quot;Line :%d\\n&quot;, __LINE__ ); printf(&quot;ANSI :%d\\n&quot;, __STDC__ ); &#125; å½“ä¸Šé¢çš„ä»£ç åœ¨ main.c ä¸­ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š 123456File :/Users/mac/Desktop/é¢„å¤„ç†å™¨/é¢„å¤„ç†å™¨/main.mDate :Feb 18 2023Time :13:22:02Line :16ANSI :1Program ended with exit code: 0 é¢„å¤„ç†å™¨è¿ç®—ç¬¦ å®å»¶ç»­è¿ç®—ç¬¦ () ä¸€ä¸ªå®é€šå¸¸å†™åœ¨ä¸€ä¸ªå•è¡Œä¸Šã€‚ä½†æ˜¯å¦‚æœå®å¤ªé•¿ï¼Œä¸€ä¸ªå•è¡Œå®¹çº³ä¸ä¸‹ï¼Œåˆ™ä½¿ç”¨ å®å»¶ç»­è¿ç®—ç¬¦ï¼ˆ\\ï¼‰ã€‚ä¾‹å¦‚ï¼š 12#define msg(a,b) \\ printf(#a &quot;and&quot; #b &quot;\\n&quot;) å­—ç¬¦ä¸²å¸¸é‡åŒ–è¿ç®—ç¬¦ï¼ˆ#ï¼‰ åœ¨å®å®šä¹‰ä¸­ï¼ŒæŠŠä¸€ä¸ª å®å‚æ•° è½¬ä¸º å­—ç¬¦ä¸²å¸¸é‡ åœ¨ main.c ä¸­ ç¼–è¯‘å’Œè¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¾—åˆ°ä¸‹é¢çš„ç»“æœ 11and&#x27;a&#x27; æ ‡è®°ç²˜è´´è¿ç®—ç¬¦ï¼ˆ##ï¼‰ å®å®šä¹‰å†…æ ‡è®°ç²˜è´´è¿ç®—ç¬¦ï¼ˆ##ï¼‰ä¼šåˆå¹¶ä¸¤ä¸ªå‚æ•° å‚æ•°åŒ–å®#define square(x) (x*x) 12#define max(x,y) \\ printf(&quot;%d\\n&quot;,x&gt;y?x:y);","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 11ï¼šåŸºæœ¬è¯­æ³•","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 11ï¼šåŸºæœ¬è¯­æ³•","date":"2023-02-14T16:13:29.000Z","updated":"2023-03-01T13:51:18.607Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 11ï¼šåŸºæœ¬è¯­æ³•/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A011%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/","excerpt":"","text":"C çš„ä»¤ç‰Œï¼ˆTokenï¼‰C ç¨‹åºç”±å„ç§ä»¤ç‰Œç»„æˆï¼Œä»¤ç‰Œå¯ä»¥æ˜¯ å…³é”®å­—ã€å¸¸é‡ã€å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªç¬¦å·ã€‚ åˆ†å·;åˆ†å·æ˜¯è¯­å¥ ç»“æŸç¬¦ æ³¨é‡Š å•è¡Œæ³¨é‡Š // å•è¡Œæ³¨é‡Š å¤šè¡Œæ³¨é‡Š 123456/* å•è¡Œæ³¨é‡Š*//* å¤šè¡Œæ³¨é‡Š å¤šè¡Œæ³¨é‡Š ...*/ å…³é”®å­— autoï¼šå£°æ˜è‡ªåŠ¨å˜é‡ constï¼šå®šä¹‰å¸¸é‡ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«constä¿®é¥°ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°±ä¸èƒ½è¢«æ”¹å˜ externï¼šå£°æ˜å˜é‡æˆ–å‡½æ•°å¯ä»¥è¢«å…¶ä»–æ–‡ä»¶ä½¿ç”¨ registerï¼šå£°æ˜å¯„å­˜å™¨å˜é‡ typedefï¼šç»™æ•°æ®ç±»å‹èµ·åˆ«å","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 10ï¼šå…±ç”¨ä½“","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 10ï¼šå…±ç”¨ä½“","date":"2023-02-14T16:13:03.000Z","updated":"2023-03-01T13:51:14.889Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 10ï¼šå…±ç”¨ä½“/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A010%EF%BC%9A%E5%85%B1%E7%94%A8%E4%BD%93/","excerpt":"","text":"å…±ç”¨ä½“å…±ç”¨ä½“ æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œå…è®¸æ‚¨åœ¨ ç›¸åŒçš„å†…å­˜ä½ç½®å­˜å‚¨ä¸åŒçš„æ•°æ®ç±»å‹ã€‚ å®šä¹‰å…±ç”¨ä½“å¿…é¡»ç”¨ union è¯­å¥ï¼Œæ–¹å¼ä¸ç»“æ„ä½“ç±»å‹ã€‚ 12345union MyData&#123; int i; float j; char k[5];&#125;data; å½“ä¸Šé¢çš„ä»£ç è¢« ç¼–è¯‘å’Œè¿è¡Œæ—¶ï¼Œäº§ç”Ÿçš„ç»“æœ 12å†…å­˜å ç”¨ï¼š8Program ended with exit code: 0 è¯´æ˜ï¼šå…±ç”¨ä½“å ç”¨çš„å†…å­˜åº”è¶³å¤Ÿå­˜å‚¨å…±ç”¨ä½“ä¸­æœ€å¤§çš„æˆå‘˜ï¼Œå› ä¸ºå†…å­˜å¯¹é½ï¼Œ4çš„æ•´æ•°å€&#x3D;8 è®¿é—®å…±ç”¨ä½“æˆ‘ä»¬ä½¿ç”¨ æˆå‘˜è®¿é—®è¿ç®—ç¬¦(.)ã€‚ 1234567891011121314int main(int argc, const char * argv[]) &#123; union MyData data; printf(&quot;å†…å­˜å ç”¨ï¼š%lu\\n&quot;,sizeof(data)); data.i = 1; data.j = 3.14; strcpy(data.k, &quot;ZJ&quot;); printf(&quot;i:%d\\n&quot;,data.i); printf(&quot;j:%f\\n&quot;,data.j); printf(&quot;k:%s\\n&quot;,data.k); return 0;&#125; å½“ä¸Šé¢çš„ä»£ç ç¼–è¯‘å’Œè¿è¡Œæ˜¯ï¼Œäº§ç”Ÿçš„ç»“æœï¼š 12345å†…å­˜å ç”¨ï¼š8i:1073760858j:2.004538k:ZJProgram ended with exit code: 0","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 09ï¼šç»“æ„ä½“","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 09ï¼šç»“æ„ä½“","date":"2023-02-14T16:12:43.000Z","updated":"2023-03-01T13:51:02.563Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 09ï¼šç»“æ„ä½“/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A009%EF%BC%9A%E7%BB%93%E6%9E%84%E4%BD%93/","excerpt":"","text":"å£°æ˜ç»“æ„ä½“1234struct st&#123; int a; char ch[4];&#125; å®šä¹‰ç»“æ„ä½“1234struct st&#123; int a; char ch[4];&#125;t1; æ³¨ï¼št1ï¼šç»“æ„ä½“å˜é‡å åˆå§‹åŒ–ç»“æ„ä½“1struct test t1 = &#123;5&#125;; ç»“æ„ä½“æ•°ç»„1struct test arr[3] = &#123;1,2,3&#125;; ç»“æ„ä½“æŒ‡é’ˆstruct ç»“æ„ä½“å *å˜é‡åï¼› 12345678910111213141516#include &lt;stdio.h&gt;struct test&#123; int a; char c; char arr[5];&#125;t1;int main(int argc, const char * argv[]) &#123; // åˆå§‹åŒ–ç»“æ„ä½“ struct test t1 = &#123;.a=1,.c=&#x27;a&#x27;,.arr=&quot;abc&quot;&#125;; printf(&quot;%d %c %s\\n&quot;,t1.a,t1.c,t1.arr); return 0;&#125; ç»“æ„ä½“æŒ‡é’ˆè·å–æˆå‘˜å˜é‡ (*ptr).structMenber ptr-&gt;structMenber æ³¨ï¼š.è¿ç®—ç¬¦ é«˜äº * ï¼Œæ‰€ä»¥(*ptr)æ‹¬å·ä¸èƒ½å°‘ å­—èŠ‚å¯¹é½#pragma pack(n)ï¼šæŒ‡å®šæŒ‰ç…§nå­—èŠ‚å¯¹é½è§„åˆ™è¿›è¡Œå­˜å‚¨ å­—èŠ‚å¯¹é½çš„åŸå›  è®¡ç®—æœºå†…å­˜ä»¥å­—èŠ‚ä¸ºå•ä½åˆ’åˆ†ï¼ŒCPUé€šè¿‡ åœ°å€æ€»çº¿ æ¥è®¿é—®å†…å­˜ï¼Œä¸€æ¬¡èƒ½å¤„ç†å‡ ä¸ªå­—èŠ‚ï¼Œåœ°å€æ€»çº¿å°±è¯»å–å‡ ä¸ªå­—èŠ‚ã€‚32ä½ä¸€æ¬¡è¯»å–4ä¸ªå­—èŠ‚ã€‚64ä½ä¸€æ¬¡è¯»å–8ä¸ªå­—èŠ‚ã€‚ å†…å­˜å¯¹é½åŸå› ï¼šé¿å…å­˜å–æ•ˆç‡çš„æŸå¤± æ€»ç»“ ç»“æ„ä½“ä¸å å†…å­˜ç©ºé—´ï¼Œæ˜¯ä¸€ä¸ªåˆ›å»ºå˜é‡çš„ æ¨¡æ¿ ç»“æ„ä½“ æˆå‘˜å˜é‡ éœ€è¦å¼€è¾Ÿå†…å­˜ç©ºé—´","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 08ï¼šå­—ç¬¦ä¸²","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 08ï¼šå­—ç¬¦ä¸²","date":"2023-02-14T16:07:57.000Z","updated":"2023-03-01T13:51:06.835Z","comments":true,"path":"2023/02/15/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 08ï¼šå­—ç¬¦ä¸²/","link":"","permalink":"https://www.bboyzj.cn/2023/02/15/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A008%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2/","excerpt":"","text":"å­—ç¬¦ä¸²çš„è¾“å…¥å’Œè¾“å‡º scanf(æ ¼å¼æ§åˆ¶,åœ°å€åˆ—è¡¨(å˜é‡å‰åŠ &amp;)) printf(æ ¼å¼æ§åˆ¶,åœ°å€åˆ—è¡¨) gets(å­—ç¬¦æ•°ç»„) puts(å­—ç¬¦æ•°ç»„) åŒºåˆ«ï¼š gets() å’Œ puts() ï¼š åªèƒ½è¾“å…¥æˆ–è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸² scanf() å’Œ printf() ï¼šå¯ä»¥è¾“å‡ºå¤šä¸ªå­—ç¬¦ä¸² å­—ç¬¦ä¸²è¿æ¥strcat(å­—ç¬¦æ•°ç»„1,å­—ç¬¦æ•°ç»„2) å­—ç¬¦ä¸²å¤åˆ¶å‡½æ•°strcpy(å­—ç¬¦æ•°ç»„1,å­—ç¬¦ä¸²2æˆ–å­—ç¬¦æ•°ç»„å) strncpy(å­—ç¬¦æ•°ç»„1,å­—ç¬¦ä¸²2æˆ–å­—ç¬¦æ•°ç»„å,n) å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°strcmp(å­—ç¬¦æ•°ç»„1,å­—ç¬¦ä¸²2æˆ–å­—ç¬¦æ•°ç»„) å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°strlen(å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„) å­—ç¬¦ä¸²è½¬æ¢å¤§å°å†™å‡½æ•°å¤§å†™è½¬å°å†™ï¼šstrlwr(å­—ç¬¦æ•°ç»„) å°å†™è½¬å¤§å†™ï¼šstrupr(å­—ç¬¦æ•°ç»„)","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 07ï¼šæŒ‡é’ˆ","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 07ï¼šæŒ‡é’ˆ","date":"2023-02-13T12:37:03.000Z","updated":"2023-03-01T13:50:58.640Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 07ï¼šæŒ‡é’ˆ/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A007%EF%BC%9A%E6%8C%87%E9%92%88/","excerpt":"","text":"å®šä¹‰æŒ‡é’ˆå˜é‡ç±»å‹å * æŒ‡é’ˆå˜é‡å æ˜Ÿå· æ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ª å˜é‡æ˜¯æŒ‡é’ˆã€‚ ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼ŸæŒ‡é’ˆ å°±æ˜¯ å†…å­˜åœ°å€ï¼ŒæŒ‡é’ˆå˜é‡ æ˜¯ç”¨æ¥ å­˜æ”¾å†…å­˜åœ°å€çš„å˜é‡ã€‚ æŒ‡é’ˆçš„å£°æ˜ï¼š 12int *ip; // ä¸€ä¸ªæ•´å‹çš„æŒ‡é’ˆchar *cp; // ä¸€ä¸ªå­—ç¬¦å‹çš„æŒ‡é’ˆ å¦‚ä½•ä½¿ç”¨æŒ‡é’ˆ12345678910111213141516int main(int argc, const char * argv[]) &#123; int var=20; // å®é™…å˜é‡çš„å£°æ˜ int *ip; // æŒ‡é’ˆå˜é‡çš„å£°æ˜ ip = &amp;var; // åœ¨ æŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨ var çš„åœ°å€ printf(&quot;var å˜é‡çš„åœ°å€ï¼š%p\\n&quot;,&amp;var); /* åœ¨æŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨çš„åœ°å€ */ printf(&quot;ip å˜é‡å­˜å‚¨çš„åœ°å€: %p\\n&quot;,ip); /* ä½¿ç”¨æŒ‡é’ˆè®¿é—®å€¼ */ printf(&quot;*ip å˜é‡çš„å€¼: %d\\n&quot;,*ip); return 0;&#125; å½“ä¸Šé¢çš„ä»£ç è¢« ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œäº§ç”Ÿçš„ç»“æœ 1234var å˜é‡çš„åœ°å€ï¼š0x7ff7bfeff45cip å˜é‡å­˜å‚¨çš„åœ°å€: 0x7ff7bfeff45c*ip å˜é‡çš„å€¼: 20Program ended with exit code: 0 æ³¨ï¼š&amp;å–åœ°å€è¿ç®—ç¬¦ã€‚&amp;aæ˜¯å˜é‡açš„åœ°å€ã€‚ æŒ‡é’ˆæ•°ç»„æŒ‡å‘æ•´æ•°ç±»å‹çš„æŒ‡é’ˆæ•°ç»„ 123456789101112131415161718// å¸¸é‡const int MAX = 3;int main(int argc, const char * argv[]) &#123; // æ•°ç»„ int var[] = &#123;10,100,200&#125;; int i,*ptr[MAX]; for (i=0; i&lt;MAX; i++) &#123; // èµ‹å€¼ä¸ºæ•´æ•°çš„åœ°å€ ptr[i] = &amp;var[i]; &#125; for (i=0; i&lt;MAX; i++) &#123; printf(&quot;value of var[%d]=%d\\n&quot;,i,*ptr[i]); &#125; return 0;&#125; å½“ä¸Šé¢çš„ä»£ç è¢« ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œç»“æœ 1234value of var[0]=10value of var[1]=100value of var[2]=200Program ended with exit code: 0 æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆæ˜¯ä¸€ä¸ª æŒ‡é’ˆé“¾ï¼Œç¬¬ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç¬¬äºŒä¸ªæŒ‡é’ˆçš„ åœ°å€ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆæŒ‡å‘ å®é™…å€¼çš„ä½ç½®ã€‚ 12345678910111213141516171819202122int main(int argc, const char * argv[]) &#123; int v; int *p1; int **p2; v=100; // è·å–vçš„åœ°å€ p1=&amp;v; // è·å–p1çš„åœ°å€ p2=&amp;p1; // æ‰“å°å€¼ printf(&quot;var=%d\\n&quot;,v); printf(&quot;p1=%p\\n&quot;,p1); printf(&quot;*p1=%d\\n&quot;,*p1); printf(&quot;p2=%p\\n&quot;,p2); printf(&quot;**p1=%d\\n&quot;,**p2); return 0;&#125; å½“ä¸Šé¢çš„ä»£ç è¢« ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œç»“æœï¼š 123456var=100p1=0x7ff7bfeff3bc*p1=100p2=0x7ff7bfeff3b0**p1=100Program ended with exit code: 0 ä¼ é€’æŒ‡é’ˆç»™å‡½æ•°C è¯­è¨€å…è®¸ä¼ é€’ æŒ‡é’ˆç»™ å‡½æ•°ï¼Œåªéœ€è¦ç®€å•çš„å£°æ˜å‡½æ•°å‚æ•°ä¸ºæŒ‡é’ˆå³å¯ ç¤ºä¾‹ 123456789101112131415161718192021222324252627#include &lt;stdio.h&gt;int main(int argc, const char * argv[]) &#123; // å‡½æ•°çš„å£°æ˜ void exchange(int *a,int *b,int *c); int a,b,c; printf(&quot;è¯·è¾“å…¥ a b c:&quot;); scanf(&quot;%d,%d,%d&quot;,&amp;a,&amp;b,&amp;c); exchange(&amp;a, &amp;b, &amp;c); printf(&quot;order:%d,%d,%d\\n&quot;,a,b,c); return 0;&#125;void exchange(int *a,int *b,int *c)&#123; // å‡½æ•°çš„å£°æ˜ void swap(int *x,int *y); // äº¤æ¢ if (*a &gt; *b) swap(a, b); if (*a &gt; *c) swap(a, c); if (*b &gt; *c) swap(b, c);&#125;void swap(int *x,int *y)&#123; int temp; temp = *x; *x = *y; *y = temp;&#125; ä»å‡½æ•°ä¸­è¿”å›æŒ‡é’ˆå¿…é¡» å£°æ˜ä¸€ä¸ªè¿”å›æŒ‡é’ˆçš„å‡½æ•°ï¼ŒC è¯­è¨€ä¸æ”¯æŒè°ƒç”¨å‡½æ•°æ—¶ï¼Œè¿”å›å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œé™¤éå®šä¹‰å±€éƒ¨å˜é‡çš„ static å˜é‡ å®ä¾‹ 123456789101112131415161718192021222324252627#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#define MAX 5;// å‡½æ•°å®šä¹‰int * getRandom(void)&#123; static int r[10]; for (int i=0; i&lt;MAX; i++) &#123; r[i]=rand(); printf(&quot;%d\\n&quot;,r[i]); &#125; return r;&#125;int main(int argc, const char * argv[]) &#123; int *p; p=getRandom(); for (int i=0; i&lt;MAX; i++) &#123; printf(&quot;*(p+[%d]):%d\\n&quot;,i,*(p+i)); &#125; return 0;&#125; å½“ä¸Šé¢çš„ä»£ç  ç¼–è¯‘å’Œè¿è¡Œ æ—¶ï¼Œäº§ç”Ÿçš„ç»“æœ 12345678910111680728247524916226500739849436581144108930*(p+[0]):16807*(p+[1]):282475249*(p+[2]):1622650073*(p+[3]):984943658*(p+[4]):1144108930Program ended with exit code: 0","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 06ï¼šæ•°ç»„","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 06ï¼šæ•°ç»„","date":"2023-02-13T12:36:53.000Z","updated":"2023-03-07T04:06:59.576Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 06ï¼šæ•°ç»„/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A006%EF%BC%9A%E6%95%B0%E7%BB%84/","excerpt":"","text":"ä¸€ç»´æ•°ç»„ æ•°ç»„åˆ›å»º type_t arr_name[const_n] type_t : æ•°ç»„å…ƒç´ çš„ç±»å‹ arr_name : æ•°ç»„åç§° const_n : æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œç”¨æ¥æ‰§è¡Œæ•°ç»„çš„å¤§å° æ•°ç»„åˆå§‹åŒ– int arr[10] &#x3D; {0}; &#x2F;&#x2F; æ•°ç»„çš„ä¸å®Œå…¨åˆå§‹åŒ– int sz &#x3D; sizeof(arr)&#x2F;sizeof(arr[0]); &#x2F;&#x2F; è®¡ç®—æ•°ç»„çš„å…ƒç´ ä¸ªæ•° æ•°ç»„åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ˜¯è¿ç»­çš„ 123456789101112#include &lt;stdio.h&gt;int main(int argc, const char * argv[]) &#123; // æ•°ç»„ä¸å®Œæˆåˆå§‹åŒ– int arr[10] = &#123;0&#125;; int sz = sizeof(arr)/sizeof(arr[0]); for (int i=0; i&lt;sz; i++) &#123; printf(&quot;&amp;arr[%d]=%p\\n&quot;,i,&amp;arr[i]); &#125; return 0;&#125; æŸ¥çœ‹æ‰“å°ç»“æœ 1234567891011&amp;arr[0]=0x7ff7bfeff3c0&amp;arr[1]=0x7ff7bfeff3c4&amp;arr[2]=0x7ff7bfeff3c8&amp;arr[3]=0x7ff7bfeff3cc&amp;arr[4]=0x7ff7bfeff3d0&amp;arr[5]=0x7ff7bfeff3d4&amp;arr[6]=0x7ff7bfeff3d8&amp;arr[7]=0x7ff7bfeff3dc&amp;arr[8]=0x7ff7bfeff3e0&amp;arr[9]=0x7ff7bfeff3e4Program ended with exit code: 0 äºŒç»´æ•°ç»„ äºŒç»´æ•°ç»„åˆ›å»º 123int arr[è¡Œ][åˆ—]int arr[3][4] = &#123;&#123;1,2&#125;,&#123;3,4&#125;&#125;; äºŒç»´æ•°ç»„çš„ä½¿ç”¨ 12345678910int main(int argc, const char * argv[]) &#123; int arr[3][4] = &#123;&#123;1,2,3&#125;,&#123;5,6,7,8&#125;&#125;; for (int i=0; i&lt;2; i++) &#123; for (int j=0; j&lt;2; j++) &#123; printf(&quot;%d\\n&quot;,arr[i][j]); &#125; &#125; return 0;&#125; äºŒç»´æ•°ç»„åœ¨å†…å­˜çš„å­˜å‚¨ å†…å­˜æ˜¯è¿ç»­çš„ æ•°ç»„ä½œä¸ºå½¢å¼å‚æ•°æœ‰ä¸‰ç§æ–¹å¼å‘Šè¯‰ç¼–è¯‘å™¨å°†è¦æ¥æ”¶ä¸€ä¸ª æ•´å‹æŒ‡é’ˆ å½¢å¼å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆ 123void myFunc(int *param)&#123; ...&#125; å½¢å¼å‚æ•°æ˜¯ä¸€ä¸ªå·²å®šå¤§å°çš„æ•°ç»„ 123void myFunc(int param[10])&#123;...&#125; å½¢å¼å‚æ•°æ˜¯ä¸€ä¸ªæœªå®šä¹‰å¤§å°çš„æ•°ç»„ 123void myFunc(int param[])&#123;...&#125; ä»å‡½æ•°è¿”å›æ•°ç»„C è¯­è¨€ä¸å…è®¸è¿”å›ä¸€ä¸ªå®Œæˆçš„æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡ å£°æ˜ä¸€ä¸ªè¿”å›æŒ‡é’ˆçš„å‡½æ•° 123int * myFunc&#123;...&#125;","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 05ï¼šå‡½æ•°ä¸ç¨‹åºç»“æ„","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 05ï¼šå‡½æ•°ä¸ç¨‹åºç»“æ„","date":"2023-02-13T12:36:40.000Z","updated":"2023-03-01T13:50:51.098Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 05ï¼šå‡½æ•°ä¸ç¨‹åºç»“æ„/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A005%EF%BC%9A%E5%87%BD%E6%95%B0%E4%B8%8E%E7%A8%8B%E5%BA%8F%E7%BB%93%E6%9E%84/","excerpt":"","text":"å‡½æ•°çš„å£°æ˜å’Œå®šä¹‰ åœ¨Cè¯­è¨€ä¸­ï¼Œå‡½æ•°çš„å®šä¹‰é¡ºåºæ˜¯æœ‰è®²ç©¶çš„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰åé¢å®šä¹‰çš„å‡½æ•°æ‰å¯ä»¥è°ƒç”¨å‰é¢å®šä¹‰è¿‡çš„å‡½æ•° å¦‚æœæƒ³æŠŠå‡½æ•°çš„å®šä¹‰å†™åœ¨mainå‡½æ•°åé¢ï¼Œè€Œä¸”mainå‡½æ•°èƒ½æ­£å¸¸è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œé‚£å°±å¿…é¡»åœ¨mainå‡½æ•°çš„å‰é¢è¿›è¡Œå‡½æ•°çš„å£°æ˜ å‡½æ•°çš„å£°æ˜ï¼š è¿”å›å€¼ç±»å‹ å‡½æ•°å(å‚æ•°1,å‚æ•°2,â€¦) æ³¨ï¼šå¦‚æœåªæœ‰å‡½æ•°çš„å£°æ˜ï¼Œæ²¡æœ‰å‡½æ•°çš„å®šä¹‰ï¼Œé‚£ä¹ˆé“¾æ¥æ—¶ä¼šå‡ºé”™ å¤šä¸ªæºæ–‡ä»¶é¡¹ç›®å¤§ï¼Œå¦‚æœéƒ½æ”¾åœ¨ä¸€ä¸ª.cæ–‡ä»¶æºä»£ç ä¼šéå¸¸å¤šï¼Œå› æ­¤éœ€è¦åˆ›å»ºæ–°çš„.cæ–‡ä»¶å­˜æ”¾ä¸åŒçš„ä»£ç  1234567891011main.cint main()&#123; int c = sum(1,2); return 0;&#125;sum.cint sum(int a,int b)&#123; return a+b;&#125; include ä½œç”¨ include æ˜¯ C è¯­è¨€ é¢„å¤„ç† æŒ‡ä»¤ä¹‹ä¸€ï¼Œåé¢è·Ÿä¸€ä¸ªæ–‡ä»¶åï¼Œä¼šæ ¹æ®æ–‡ä»¶åå»æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¹¶æŠŠè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹åŒ…å«åˆ°å½“å‰æ–‡ä»¶ä¸­ã€‚ include&lt;&gt; å’Œ includeâ€œâ€åŒºåˆ« â€œâ€ï¼šä»çˆ¶æ–‡ä»¶å¤¹æœç´¢ï¼Œæ‰¾ä¸åˆ°å»çˆ¶çš„çˆ¶æ–‡ä»¶å¤¹æœç´¢ï¼Œæ‰¾ä¸åˆ°å»ç¼–è¯‘å™¨è®¾ç½®çš„inlcudeè·¯å¾„å†…æœç´¢ï¼Œæ‰¾ä¸åˆ°åˆ™åœ¨ç³»ç»Ÿçš„INCLUDEç¯å¢ƒå˜é‡å†…æœç´¢ &lt;&gt;ï¼šç¼–è¯‘å™¨è®¾ç½®çš„includeè·¯å¾„å†…æœç´¢ï¼Œæ‰¾ä¸åˆ°åˆ™åœ¨ç³»ç»Ÿçš„INCLUDEç¯å¢ƒå˜é‡å†…æœç´¢ å¤´æ–‡ä»¶.h å’Œ æºæ–‡ä»¶ .cçš„åˆ†å·¥ å‡½æ•°çš„å£°æ˜å†™åœ¨ .h æ–‡ä»¶ä¸­ å‡½æ•°çš„å®šä¹‰å¸è½½ .c æºæ–‡ä»¶ä¸­ å‡½æ•°çš„å‚æ•° å½¢å¼å‚æ•° å½¢å‚ åœ¨å®šä¹‰æ—¶ç¼–è¯‘ç³»ç»Ÿä¸åˆ†é…å†…å­˜ï¼Œåªæœ‰åœ¨è°ƒç”¨å‡½æ•°æ—¶æ‰åˆ†é…å†…å­˜ã€‚è°ƒç”¨ç»“æŸå†…å­˜è¢«é‡Šæ”¾ã€‚ å®é™…å‚æ•° å®å‚ å‡ºç°åœ¨ä¸»å‡½æ•°ä¸­ï¼Œå½“å‡½æ•°è°ƒç”¨æ—¶ï¼Œå‡½æ•°æŠŠå®å‚çš„å€¼ä¼ é€’ç»™å‡½æ•°çš„å½¢å‚ï¼Œä»è€Œå®ç°å‡½æ•°é—´çš„ä¼ é€’ã€‚ ä¼ é€’çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šå€¼ä¼ é€’ å’Œ åœ°å€ä¼ é€’ å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ å±€éƒ¨å˜é‡ï¼šé¦–å…ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå…¶æ¬¡æ˜¯è¿™ä¸ªå˜é‡åœ¨ç¨‹åºçš„ å±€éƒ¨èŒƒå›´æœ‰æ•ˆ ä¹¦å†™ï¼šé¦–å­—æ¯å°å†™ å…¨å±€å˜é‡ï¼šé¦–å…ˆæ˜¯å˜é‡ï¼Œå…¶æ¬¡åœ¨ å®šä¹‰å¤„ä»¥ä¸‹æ‰æœ‰æ•ˆ ä¹¦å†™ï¼šé¦–å­—æ¯å¤§å†™ å¤´æ–‡ä»¶ includeä½œç”¨ï¼š includeï¼šæŠŠå¤´æ–‡ä»¶é‡Œçš„å†…å®¹åŸå°ä¸åŠ¨çš„å¤åˆ¶åˆ°å¼•ç”¨è¯¥å¤´æ–‡ä»¶çš„åœ°æ–¹ã€‚ å¤´æ–‡ä»¶çš„æ ¼å¼è¯´æ˜ 123456#ifndef å¤´æ–‡ä»¶å // å¤´æ–‡ä»¶åçš„æ ¼å¼æ˜¯&quot;_å¤´æ–‡ä»¶å_&quot;ï¼Œæ³¨æ„è¦å¤§å†™#define å¤´æ–‡ä»¶åå¤´æ–‡ä»¶å†…å®¹#endif ç¤ºä¾‹ä»£ç ï¼šå¤´æ–‡ä»¶main.h 12345678910#ifndef _MATH_H_ // å¦‚æœæ²¡æœ‰å®šä¹‰main.hï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚è¿™æ˜¯é˜²æ­¢é‡å¤å®šä¹‰#define _MATH_H_ // å®šä¹‰å¤´æ–‡ä»¶// ä¸‹é¢çš„ä»£ç æ˜¯å¤´æ–‡ä»¶å†…å®¹#include&lt;stido.h&gt; // å¤´æ–‡ä»¶#define ADD 1 // å®å®šä¹‰extern int x; // å…¨å±€å˜é‡void swap(int a,int b); // å‡½æ•°å£°æ˜#endif // è¡¨ç¤ºå¤´æ–‡ä»¶ç»“æŸ å†…éƒ¨å‡½æ•°å’Œå¤–éƒ¨å‡½æ•° å¤–éƒ¨å‡½æ•°ï¼šå¯ä»¥è¢«å…¶ä»–æºæ–‡ä»¶è°ƒç”¨çš„å‡½æ•° åœ¨å‡½æ•°å£°æ˜å¤„æ·»åŠ  externå…³é”®å­—ï¼Œå¯çœç•¥ å†…éƒ¨å‡½æ•°ï¼šåªåœ¨å®šä¹‰çš„æºæ–‡ä»¶ä¸­æœ‰æ•ˆ åœ¨å‡½æ•°çš„è¿”å›å€¼ç±»å‹å‰é¢æ·»åŠ  staticå…³é”®å­—ï¼Œä¹Ÿç§° é™æ€å‡½æ•° ç»ƒä¹  å½¢å‚å’Œå®å‚ è¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°må’Œnï¼Œæ±‚ä»måŠ åˆ°nçš„å’Œï¼ˆm&lt;&#x3D;nï¼‰ï¼Œå¹¶è¾“å‡º 123456789101112131415161718192021222324252627282930313233#include &lt;stdio.h&gt;int sum(int a,int b);void swap(int *a,int *b);int main(int argc, const char * argv[]) &#123; int m,n,total; printf(&quot;è¯·è¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼š&quot;); scanf(&quot;%d,%d&quot;,&amp;m,&amp;n); if (m&gt;n)&#123; swap(&amp;m, &amp;n); &#125; total = sum(m, n); printf(&quot;a=%d,b=%d\\n&quot;,m,n); printf(&quot;total=%d\\n&quot;,total); return 0;&#125;int sum(int a,int b)&#123; for (int i = a+1; i &lt;= b; i++) &#123; a += i; &#125; return a;&#125;void swap(int *a,int *b)&#123; int temp = *a; *a = *b; *b = temp;&#125; å®šä¹‰é€‰æ‹©æ’åºå’Œä½¿ç”¨é€‰æ‹©æ’åºåˆ†åˆ«åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ main.c 1234567891011121314151617181920#include &lt;stdio.h&gt;#define ARR_LEN 10void select_sort(int arr[],int len);void print_arr(int arr[],int len);int main(int argc, const char * argv[]) &#123; int arr[ARR_LEN] = &#123;8,1,4,10,3,6,2,7,9,5&#125;; printf(&quot;æ’åºå‰ï¼š\\n&quot;); print_arr(arr, ARR_LEN); select_sort(arr, ARR_LEN); printf(&quot;æ’åºåï¼š\\n&quot;); print_arr(arr, ARR_LEN); return 0;&#125; ssort.c 12345678910111213141516171819202122232425262728#include &lt;stdio.h&gt;// äº¤æ¢static void swap(int *a,int *b)&#123; int temp = *a; *a = *b; *b = temp;&#125;// æ‰“å°æ•°ç»„extern void print_arr(int arr[],int len)&#123; for (int i = 0; i &lt; len; i++) &#123; printf(&quot;%d&quot;,arr[i]); &#125; printf(&quot;\\n&quot;);&#125;// é€‰æ‹©æ’åºextern void select_sort(int arr[],int len)&#123; int i,j; for (i = 0; i &lt; len; i ++) &#123; for (j = i+1; j &lt; len; j++) &#123; if (arr[i] &gt; arr[j])&#123; swap(&amp;arr[i], &amp;arr[j]); &#125; &#125; &#125;&#125;","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 04ï¼šè¯­å¥å’Œæ§åˆ¶å—","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 04ï¼šè¯­å¥å’Œæ§åˆ¶å—","date":"2023-02-13T04:58:15.000Z","updated":"2023-03-01T13:50:46.354Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 04ï¼šè¯­å¥å’Œæ§åˆ¶å—/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A004%EF%BC%9A%E8%AF%AD%E5%8F%A5%E5%92%8C%E6%8E%A7%E5%88%B6%E5%9D%97/","excerpt":"","text":"è¾“å…¥è¾“å‡ºè¯­å¥ printf(æ ¼å¼æ§åˆ¶,è¾“å‡ºè¡¨åˆ—) %dæ ¼å¼ç¬¦ï¼šè¾“å‡ºæœ‰ç¬¦å·åè¿›åˆ¶æ•´æ•°ã€‚ cæ ¼å¼ç¬¦ï¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ã€‚ sæ ¼å¼ç¬¦ï¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ fæ ¼å¼ç¬¦ï¼š%f-å®æ•°éƒ¨åˆ†å…¨éƒ¨è¾“å‡ºï¼Œå°æ•°éƒ¨åˆ†è¾“å‡º6ä½ã€‚%m.nf-mè¡¨ç¤ºåŒ…æ‹¬å°æ•°åœ¨å†…çš„æ•´ä¸ªæµ®ç‚¹æ•°é•¿åº¦ï¼Œnè¡¨ç¤ºå°æ•°ç‚¹ä¿ç•™å‡ ä½ã€‚ pæ ¼å¼ç¬¦ï¼šç”¨æ¥è¾“å‡ºåœ°å€ã€‚ scanf ä¸€èˆ¬å½¢å¼ä¸º scanf(æ ¼å¼æ§åˆ¶,åœ°å€è¡¨åˆ—) æ­£åˆ™ éœ€è¦é€šè¿‡ #include &lt;regex.h&gt; åº“ %[abc]ï¼šè¯»å–a&#x2F;b&#x2F;cä»»æ„ä¸€å‘˜ %[^a-z]ï¼šè¯»å–ä¸åœ¨a-zä¹‹é—´çš„å­—ç¬¦ä¸² %[^&#x3D;]ï¼šè¯»å–å­—ç¬¦ä¸²ç›´åˆ°ç¢°åˆ°&#x3D;å· %[^&#x3D;]ï¼šå‰é¢å·è¡¨ç¤ºä¸ä¿å­˜å˜é‡ å­—ç¬¦è¾“å…¥è¾“å‡º putchar(c)ï¼šç”¨äºè¾“å‡ºå­—ç¬¦c c &#x3D; getchar()ï¼šç”¨äºè¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œè¿”å›çš„ä¸æ˜¯charç±»å‹ï¼Œè€Œæ˜¯ int ç±»å‹ ä¸€èˆ¬ç”¨æ³• while(c&#x3D;getchar() &amp;&amp; a!&#x3D;EOF) { } EOFï¼šæŒ‡æ£€æµ‹æ–‡ä»¶å°¾ï¼Œå®å®šä¹‰å€¼ä¸º-1 åˆ¤æ–­è¯­å¥ if(â€¦){} if(â€¦){} else{} if(â€¦){} else if(â€¦){} â€¦ else{â€¦} switch(è¡¨è¾¾å¼){case å¸¸é‡1:è¯­å¥1;case å¸¸é‡2:è¯­å¥2;â€¦;case å¸¸é‡n:è¯­å¥n;default:è¯­å¥n+1} å¾ªç¯è¯­å¥ while while (è¡¨è¾¾å¼) { è¯­å¥} doâ€¦whileï¼šè‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ do è¯­å¥while (è¡¨è¾¾å¼); for for (è¡¨è¾¾å¼1,è¡¨è¾¾å¼2,è¡¨è¾¾å¼3) è¯­å¥ å¾ªç¯æ‰“æ–­ break æˆ– goto continue continue ä¸è·³å‡ºå¾ªç¯ï¼Œè€Œæ˜¯å°†ç¨‹åºæ‰§è¡Œè·³è½¬åˆ°æœ«å°¾å¤„ ç»ƒä¹ é¢˜ å¾ªç¯æ‰“å°å­—ç¬¦ä¸² 123456789101112#include &lt;stdio.h&gt;int main(int argc, const char * argv[]) &#123; char str[] = &quot;Hello World!&quot;; size_t len = sizeof(str)/sizeof(char); printf(&quot;%zu\\n&quot;,len); for (int i = 0; i&lt;len; i++) &#123; printf(&quot;%c\\n&quot;,str[i]); &#125; return 0;&#125; åˆ¤æ–­å­—ç¬¦ 12345678910111213141516171819202122232425262728293031323334// å£°æ˜void judge_char(char ch);int main(int argc, const char * argv[]) &#123; char ch; printf(&quot;è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼š&quot;); scanf(&quot;%c&quot;,&amp;ch); judge_char(ch); return 0;&#125;// å®šä¹‰void judge_char(char ch)&#123; /* getcharå’Œputchar ä¸“é—¨ç”¨äºå­—ç¬¦çš„è¾“å…¥å’Œè¾“å‡º getchar()å†™æ³•ä¸Šè¦ä¸º å˜é‡ = getchar(); putchar()å†™æ³•ä¸Šè¦ä¸º putchar(å˜é‡) getchar(&#x27;\\n&#x27;)è¾“å‡ºä¸€ä¸ªæ§åˆ¶ç¬¦ putchar(&#x27;å­—æ¯/å­—ç¬¦&#x27;);è¾“å‡ºä¸€ä¸ªå­—æ¯/å­—ç¬¦ */// ch = getchar(); if (ch &lt; 31) &#123; printf(&quot;è¿™æ˜¯ä¸€ä¸ªæ§åˆ¶å­—ç¬¦æˆ–é€šè®¯ä¸“ç”¨å­—ç¬¦!\\n&quot;); &#125;else if (ch &gt;= &#x27;0&#x27; &amp;&amp; ch &lt;= &#x27;9&#x27;) &#123; printf(&quot;è¿™æ˜¯ä¸€ä¸ªæ•°å­—!&quot;); &#125;else if (ch &gt;= &#x27;A&#x27; &amp;&amp; ch &lt;= &#x27;Z&#x27;) &#123; printf(&quot;è¿™æ˜¯ä¸€ä¸ªå¤§å†™å­—æ¯!\\n&quot;); &#125;else if (ch &gt;= &#x27;a&#x27; &amp;&amp; ch &lt;= &#x27;z&#x27;) &#123; printf(&quot;è¿™æ˜¯ä¸€ä¸ªå°å†™å­—æ¯!\\n&quot;); &#125;else &#123; printf(&quot;è¿™æ˜¯å…¶ä»–å­—ç¬¦!\\n&quot;); &#125;&#125; ä»»æ„è¾“å…¥3ä¸ªæ•´æ•°ï¼Œä½¿ç”¨ifè¯­å¥å¯¹è¿™3ä¸ªè¯­å¥ä»å°åˆ°å¤§å‡åºæ’åºã€‚ 123456789101112131415161718192021222324252627// äº¤æ¢x,yvoid swap(int *x,int *y)&#123; int temp = *x; *x = *y; *y = temp;&#125;int main(int argc, const char * argv[]) &#123; int a,b,c; printf(&quot;è¯·è¾“å…¥a,b,c:\\n&quot;); scanf(&quot;%d,%d,%d&quot;,&amp;a,&amp;b,&amp;c); if (a&gt;b)&#123; swap(&amp;a, &amp;b); &#125; if (a&gt;c)&#123; swap(&amp;a, &amp;c); &#125; if (b&gt;c)&#123; swap(&amp;b, &amp;c); &#125; printf(&quot;å‡åºæ’åºç»“æœï¼š\\n&quot;); printf(&quot;%d,%d,%d\\n&quot;,a,b,c); return 0;&#125; ä¹ä¹ä¹˜æ³•è¡¨ 1234567891011int main(int argc, const char * argv[]) &#123; int i = 0; int j = 0; for (i = 1; i &lt;= 9; i++) &#123; for (j = 1; j &lt;= 9; j++) &#123; printf(&quot;%d*%d=%2d\\t&quot;,i,j,i*j); &#125; printf(&quot;\\n&quot;); &#125; return 0;&#125; ä½¿ç”¨gotoè¯­å¥æ¨¡æ‹Ÿå¾ªç¯ï¼Œæ±‚10ä»¥å†…æ•´æ•°ä¹‹å’Œã€‚ 1234567891011121314#include &lt;stdio.h&gt;int main(int argc, const char * argv[]) &#123; int sum = 0; int i = 0; LOOP: if (++i &lt;= 10) &#123; sum += i; goto LOOP; &#125; printf(&quot;10ä»¥å†…çš„æ­£æ•´æ•°ä¹‹å’Œä¸ºï¼š%d\\n&quot;,sum); return 0;&#125; whileå¾ªç¯ï¼šæœ€å¤§å…¬çº¦æ•° å’Œ æœ€å°å…¬å€æ•° å…¬çº¦æ•°ï¼šå‡ ä¸ªè‡ªç„¶æ•°å…±æœ‰çš„çº¦æ•°ï¼Œä¸ºä»–ä»¬çš„å…¬çº¦æ•°æœ€å¤§å…¬çº¦æ•°ï¼šå…¬çº¦æ•°ä¸­çš„æœ€å¤§ä¸€ä¸ª å…¬å€æ•°ï¼šèƒ½å¤Ÿè¢«ä¸€ä¸ªæ•´æ•°æ•´é™¤é¢æ•´æ•°æˆä¸ºå…¶å€æ•°æœ€å°å…¬å€æ•°ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªæ•´æ•°çš„å…¬å€æ•°æœ€å°çš„ä¸€ä¸ª é—®ï¼šä½¿ç”¨whileå¾ªç¯ï¼Œæ±‚ä¸¤ä¸ªæ­£æ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°å’Œæœ€å°å…¬å€æ•° 12345678910111213141516171819202122232425#include &lt;stdio.h&gt;int main(int argc, const char * argv[]) &#123; int a,b,m,c; printf(&quot;è¯·è¾“å…¥ä¸¤ä¸ªæ•°ï¼š&quot;); scanf(&quot;%d,%d&quot;,&amp;a,&amp;b); // ç»™ä¸¤ä¸ªæ•´æ•°æ’åº if (a&lt;b)&#123; int temp = a; a = b; b = temp; &#125; m = a*b; c = a%b; while (c != 0) &#123; a = b; // æœ€å¤§å…¬çº¦æ•° b = c; c = a%b; &#125; printf(&quot;æœ€å¤§å…¬çº¦æ•°æ˜¯ï¼š%d\\n&quot;,b); printf(&quot;æœ€å°å…¬å€æ•°æ˜¯ï¼š%d\\n&quot;,m/b); return 0;&#125;","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 03ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 03ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼","date":"2023-02-12T18:10:04.000Z","updated":"2023-03-07T05:14:48.910Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 03ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A003%EF%BC%9A%E8%BF%90%E7%AE%97%E7%AC%A6%E5%92%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F/","excerpt":"","text":"æµ‹è¯•é¢˜ åˆ¤æ–­æ­£æ•´æ•°çš„ä½æ•° 1234567891011121314151617181920212223#include &lt;stdio.h&gt;// å£°æ˜void IntCount(int num);// å…¥å£å‡½æ•°int main(int argc, const char * argv[]) &#123; // åˆ¤æ–­æ­£æ•´æ•°çš„ä½æ•° int num; printf(&quot;è¯·è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•°ï¼š&quot;); scanf(&quot;%d&quot;,&amp;num); IntCount(12345); return 0;&#125;// åˆ¤æ–­æ­£æ•´æ•°çš„ä½æ•°void IntCount(int num) &#123; int count = 0; // ä½æ•° while (num &gt; 0) &#123; num = num/10; count += 1; &#125; printf(&quot;%d\\n&quot;, count);&#125; æ‰“å°100ä»¥å†…ï¼ˆåŒ…å«100ï¼‰èƒ½è¢«10æ•´é™¤çš„æ­£æ•´æ•° 1234567891011121314151617181920212223#include &lt;stdio.h&gt;int main(int argc, const char * argv[]) &#123; // æ‰“å°100ä»¥å†…è¢«10æ•´é™¤çš„æ­£æ•´æ•° int i = 1; while (i &lt; 100) &#123; if (i % 10 == 0) &#123; printf(&quot;%d\\n&quot;,i); &#125; i ++; &#125; return 0;&#125;==========102030405060708090 è¾“å…¥ä¸¤ä¸ªé—­åŒºé—´ï¼Œå¹¶åˆ¤æ–­ä¸¤ä¸ªåŒºé—´æ˜¯å¦é‡å ï¼Ÿ 1234567891011121314151617181920#define MAX(a,b) ((a&gt;b) ? a:b)#define MIN(a,b) ((a&lt;b) ? a:b)int main(int argc, const char * argv[]) &#123; int start_1,end_1; int start_2,end_2; printf(&quot;è¯·è¾“å…¥ç¬¬ä¸€ä¸ªé—­åŒºé—´(é€—å·åˆ†å‰²)ï¼š&quot;); scanf(&quot;%d,%d&quot;,&amp;start_1,&amp;end_1); printf(&quot;è¯·è¾“å…¥ç¬¬äºŒä¸ªé—­åŒºé—´(é€—å·åˆ†å‰²)ï¼š&quot;); scanf(&quot;%d,%d&quot;,&amp;start_2,&amp;end_2); if (MIN(end_1, end_2) &lt; MAX(start_1, start_2)) &#123; printf(&quot;ä¸é‡å &quot;); &#125;else &#123; printf(&quot;é‡å &quot;); &#125; return 0;&#125; è¾“å…¥ä»»æ„å¹´ä»½çš„æ­£æ•´æ•°nï¼Œåˆ¤æ–­è¯¥å¹´ä»½æ˜¯å¦ä¸ºé—°å¹´ï¼Ÿ é—°å¹´çš„å®šä¹‰ï¼šèƒ½è¢«400æ•´é™¤çš„å¹´ä»½ä¸ºé—°å¹´ï¼›èƒ½è¢«4æ•´é™¤åŒæ—¶ä¸èƒ½è¢«100æ•´é™¤çš„å¹´ä»½æ˜¯é—°å¹´ é—°å¹´ä¸€å¹´æœ‰366å¤©ï¼Œ2æœˆä»½æœ‰29å¤©å¹³å¹´ä¸€å¹´æœ‰365å¤©ï¼Œ2æœˆä»½æœ‰28å¤© 1234567891011121314151617// åˆ¤æ–­é—°å¹´void is_leap_year(int year)&#123; if (year%400==0 || (year%4==0 &amp;&amp; year%100!=0)) &#123; printf(&quot;%då¹´æ˜¯é—°å¹´\\n&quot;,year); &#125;else&#123; printf(&quot;%då¹´ä¸æ˜¯é—°å¹´\\n&quot;,year); &#125;&#125;int main(int argc, const char * argv[]) &#123; // åˆ¤æ–­é—°å¹´ int year; printf(&quot;è¯·è¾“å…¥å¹´ä»½ï¼š&quot;); scanf(&quot;%d&quot;,&amp;year); is_leap_year(year); return 0;&#125; æ‰“å°é‚®è´¹ä»·æ ¼è¡¨ï¼Œè¾“å‡º20kgä»¥å†…ç‰©å“çš„é‚®è´¹ä»·æ ¼è¡¨ï¼Œé‚®è´¹è®¡ç®—è§„åˆ™å¦‚ä¸‹ï¼š 1kgä»¥å†…6å…ƒ è¶…è¿‡1kg,æ¯å¢åŠ 1kgåŠ æ”¶2å…ƒ æ³¨ï¼šé€—å·è¿ç®—ç¬¦ä¸è¡¨è¾¾å¼å°çŸ¥è¯† 1.é€—å·è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æ˜¯æ‰€æœ‰è¿ç®—ç¬¦ä¸­æœ€ä½çš„ 2.æ•´ä¸ªé€—å·è¡¨è¾¾å¼çš„å€¼ä¸ºå…¶ä¸­æœ€åä¸€ä¸ªå­è¡¨è¾¾å¼çš„å€¼ 3.é€—å·è¿ç®—ç¬¦å¸¸ç”¨åœ¨forå¾ªç¯å¤´éƒ¨åˆå§‹åŒ–æˆ–é€’å¢å¤šä¸ªå˜é‡ 123456789101112#define FIRST_COST 6#define NEXT_COST 2int main(int argc, const char * argv[]) &#123; int weight,cost; printf(&quot;é‡é‡\\tä»·æ ¼\\t\\n&quot;); for (weight=1,cost=FIRST_COST;weight&lt;=10;++weight,cost=FIRST_COST+(weight-1)*NEXT_COST) &#123; printf(&quot;%d\\tï¿¥%d\\n&quot;,weight,cost); &#125; return 0;&#125; è¾“å…¥ä¸‰ä¸ªæ•´æ•°ï¼Œæ±‚å‡ºæœ€å¤§å€¼å¹¶è¾“å‡ºï¼Ÿ 123456789int main(int argc, const char * argv[]) &#123; int a,b,c,max; printf(&quot;è¯·è¾“å…¥3ä¸ªæ•´æ•°ï¼š&quot;); scanf(&quot;%d,%d,%d&quot;,&amp;a,&amp;b,&amp;c); max = c&gt;((a&gt;b)?a:b) ? c:((a&gt;b)?a:b); printf(&quot;3ä¸ªæ•°ä¸­çš„æœ€å¤§å€¼æ˜¯ï¼š%d\\n&quot;,max); return 0;&#125; å®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ•´å‹æ•°ç»„ï¼ˆæœªæ˜¾ç¤ºæŒ‡å®šæ•°ç»„é•¿åº¦ï¼‰ï¼Œå¾ªç¯è¾“å‡ºæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ã€‚åœ¨å®Œæˆä»¥ä¸Šä»»åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å¾—åˆ°æ•°ç»„çš„é•¿åº¦ï¼Œéœ€è¦å€ŸåŠ©sizeofè¿ç®—ç¬¦ï¼Ÿ å°çŸ¥è¯†ï¼š 1.sizeofåœ¨ä½¿ç”¨çš„æ—¶å€™çœ‹ä¸Šå»åƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆå› ä¸ºåé¢æœ‰ä¸€å¯¹å°æ‹¬å·ï¼‰ï¼Œä½†ä»–æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š a)sizeof(å˜é‡å) b)sizeof(æ•°æ®ç±»å‹å) c)sizeof å˜é‡å 2. sizeofçš„è¿”å›å€¼ç±»å‹æ˜¯size_t 12345678910int main(int argc, const char * argv[]) &#123; int arr[]=&#123;1,2,3,4,5&#125;; size_t len = sizeof(arr)/sizeof(arr[0]); size_t i; for (i=0; i&lt;len; ++i) &#123; printf(&quot;%d\\n&quot;,arr[i]); &#125; return 0;&#125; æ ¹æ®è¿ç®—ç¬¦ä¼˜å…ˆçº§åŠæ±‚èŒé¡ºåºï¼Œä½¿ç¨‹åºè¾“å‡ºç»“æœä¸º2ï¼Œ3ï¼Œ1 12345678910int main(int argc, const char * argv[]) &#123; int x,y,z; printf(&quot;è¯·è¾“å…¥2ä¸ªæ•´æ•°ï¼š&quot;); scanf(&quot;%d,%d&quot;,&amp;x,&amp;y); z=x++,++y,y++; printf(&quot;%d,%d,%d\\n&quot;,x,y,z); return 0;&#125;","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 02ï¼šå˜é‡çš„ç±»å‹","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 02ï¼šå˜é‡","date":"2023-02-12T16:52:46.000Z","updated":"2023-03-07T04:49:39.109Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 02ï¼šå˜é‡/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A002%EF%BC%9A%E5%8F%98%E9%87%8F/","excerpt":"","text":"å˜é‡ ä»€ä¹ˆæ˜¯å˜é‡ï¼Ÿ å˜é‡è¡¨ç¤º å†…å­˜ä¸­çš„ä¸€ä¸ªå­˜å‚¨åŒºåŸŸï¼ˆä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå ç”¨çš„ç©ºé—´å¤§å°ä¸ä¸€æ ·ï¼‰ ä¸ºä»€ä¹ˆéœ€è¦å˜é‡ï¼Ÿ ç­”ï¼šå˜é‡æ˜¯å…¶ç¨‹åºçš„ åŸºæœ¬ç»„æˆå•ä½ å®šä¹‰å˜é‡type variable_list; typeï¼šå˜é‡ç±»å‹ variable_listï¼šä¸€ä¸ªæˆ–å¤šä¸ªæ ‡è¯†ç¬¦ç»„æˆï¼Œå¤šä¸ªç”¨é€—å·åˆ†å‰² 1int i, j, k; å˜é‡çš„å£°æ˜å˜é‡çš„å£°æ˜æœ‰ä¸¤ç§ï¼š ä¸€ç§æ˜¯éœ€è¦å»ºç«‹å­˜å‚¨ç©ºé—´ã€‚ int i; &#x2F;&#x2F; å£°æ˜ï¼Œä¹Ÿæ˜¯å®šä¹‰ å¦ä¸€ç§æ˜¯ä¸éœ€è¦å»ºç«‹å­˜å‚¨ç©ºé—´çš„ï¼Œç”¨ externå…³é”®å­— å£°æ˜çš„ã€‚ extern int i; &#x2F;&#x2F; å£°æ˜ï¼Œä¸æ˜¯å®šä¹‰","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cè¯­è¨€å­¦ä¹ 01ï¼šCè¯­è¨€æ¦‚è¿°","slug":"Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 01ï¼šCè¯­è¨€æ¦‚è¿°","date":"2023-02-12T16:32:23.000Z","updated":"2023-03-07T04:03:58.139Z","comments":true,"path":"2023/02/13/Cå­¦ä¹ /Cè¯­è¨€å­¦ä¹ 01ï¼šCè¯­è¨€æ¦‚è¿°/","link":"","permalink":"https://www.bboyzj.cn/2023/02/13/C%E5%AD%A6%E4%B9%A0/C%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A001%EF%BC%9AC%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B0/","excerpt":"","text":"Cè¯­è¨€ç‰¹ç‚¹C è¯­è¨€æ˜¯ä¸€é—¨è¿‡ç¨‹æ€§è¯­è¨€ï¼ŒC è¯­è¨€å¯ä»¥ ä»£æ›¿æœºå™¨è¯­è¨€æˆ–æ±‡ç¼–è¯­è¨€ç¼–å†™è¿è¡Œé€Ÿåº¦å¿«çš„ç¨‹åºã€‚ è¯­è¨€ç®€æ´ï¼Œä½¿ç”¨æ–¹ä¾¿çµæ´» å¯ç§»æ¤æ€§å¥½ è¡¨è¾¾èƒ½åŠ›å¼º è¡¨è¾¾æ–¹å¼çµæ´» å¯è¿›è¡Œç»“æ„åŒ–ç¨‹åºè®¾è®¡ å¯ä»¥ç›´æ¥æ“ä½œè®¡ç®—æœºç¡¬ä»¶ ç”Ÿæˆçš„ç›®æ ‡ä»£ç è´¨é‡é«˜ ç¼–ç¨‹æœºåˆ¶C è¯­è¨€ç¨‹åºä»æºä»£ç åˆ°äºŒè¿›åˆ¶ç¨‹åºéƒ½ç»å†äº†å“ªäº›è¿‡ç¨‹ï¼Ÿ é¢„å¤„ç†(Preprocession) é¢„å¤„ç†ç”¨äºå°†æ‰€æœ‰çš„ #includeå¤´æ–‡ä»¶åŠå®å®šä¹‰ æ›¿æ¢æˆ çœŸæ­£çš„å†…å®¹test.c åˆ° test.i ç¼–è¯‘(Complication) ç¼–è¯‘è¿‡ç¨‹å°† é¢„å¤„ç†ä¹‹åçš„ç¨‹åº è½¬æ¢æˆç‰¹å®šçš„ æ±‡ç¼–ä»£ç (Assemble Code)test.i åˆ° test.s æ±‡ç¼–(Assemble) æ±‡ç¼–è¿‡ç¨‹å°† æ±‡ç¼–ä»£ç  è½¬æ¢æˆ æœºå™¨ç (machine code)ï¼Œè¿™ä¸€æ­¥äº§ç”Ÿçš„æ–‡ä»¶å« ç›®æ ‡æ–‡ä»¶ï¼Œæ¯ä¸€ä¸ª æºæ–‡ä»¶ éƒ½ä¼šäº§ç”Ÿä¸€ä¸ª ç›®æ ‡æ–‡ä»¶test.s åˆ° test.o é“¾æ¥(Linking) é“¾æ¥è¿‡ç¨‹å°† å¤šä¸ªç›®æ ‡æ–‡ä»¶åŠæ‰€éœ€çš„åº“æ–‡ä»¶ é“¾æ¥æˆæœ€ç»ˆçš„ å¯æ‰§è¡Œæ–‡ä»¶(executable file)","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-æ¢ç´¢ç¯‡","slug":"C-æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/C-%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Cé¢è¯•é¢˜ï¼šC","slug":"é¢è¯•é¢˜/Cç®—æ³•é¢è¯•é¢˜ï¼šC","date":"2023-02-11T16:06:03.000Z","updated":"2023-03-08T22:45:06.638Z","comments":true,"path":"2023/02/12/é¢è¯•é¢˜/Cç®—æ³•é¢è¯•é¢˜ï¼šC/","link":"","permalink":"https://www.bboyzj.cn/2023/02/12/%E9%9D%A2%E8%AF%95%E9%A2%98/C%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9AC/","excerpt":"","text":"æ±½æ°´ç“¶æŸå•†åº—è§„å®šï¼šä¸‰ä¸ªç©ºæ±½æ°´ç“¶å¯ä»¥æ¢ä¸€ç“¶æ±½æ°´ï¼Œå…è®¸å‘è€æ¿å€Ÿç©ºæ±½æ°´ç“¶ï¼ˆä½†æ˜¯å¿…é¡»è¦å½’è¿˜ï¼‰ã€‚å°å¼ æ‰‹ä¸Šæœ‰nä¸ªç©ºæ±½æ°´ç“¶ï¼Œå¥¹æƒ³çŸ¥é“è‡ªå·±æœ€å¤šå¯ä»¥å–åˆ°å¤šå°‘ç“¶æ±½æ°´ã€‚æ•°æ®èŒƒå›´ï¼šè¾“å…¥çš„æ­£æ•´æ•°æ»¡è¶³1 â‰¤ n â‰¤ 100 æ³¨æ„ï¼šæœ¬é¢˜å­˜åœ¨å¤šç»„è¾“å…¥ã€‚è¾“å…¥çš„ 0 è¡¨ç¤ºè¾“å…¥ç»“æŸï¼Œå¹¶ä¸ç”¨è¾“å‡ºç»“æœã€‚ ç¤ºä¾‹1ï¼šè¾“å…¥ä¾‹å­ï¼š310810è¾“å‡ºä¾‹å­ï¼š1540ä¾‹å­è¯´æ˜ï¼šæ ·ä¾‹ 1 è§£é‡Šï¼šç”¨ä¸‰ä¸ªç©ºç“¶æ¢ä¸€ç“¶æ±½æ°´ï¼Œå‰©ä¸€ä¸ªç©ºç“¶æ— æ³•ç»§ç»­äº¤æ¢æ ·ä¾‹ 2 è§£é‡Šï¼šç”¨ä¹ä¸ªç©ºç“¶æ¢ä¸‰ç“¶æ±½æ°´ï¼Œå‰©å››ä¸ªç©ºç“¶å†ç”¨ä¸‰ä¸ªç©ºç“¶æ¢ä¸€ç“¶æ±½æ°´ï¼Œå‰©ä¸¤ä¸ªç©ºç“¶ï¼Œå‘è€æ¿å€Ÿä¸€ä¸ªç©ºç“¶å†ç”¨ä¸‰ä¸ªç©ºç“¶æ¢ä¸€ç“¶æ±½æ°´å–å®Œå¾—ä¸€ä¸ªç©ºç“¶è¿˜ç»™è€æ¿ 123456789101112131415161718192021222324252627#import &lt;Foundation/Foundation.h&gt;int main(int argc, char* argv[]) &#123; NSAutoreleasePool* pool = [[NSAutoreleasePool alloc] init]; // å®šä¹‰ç©ºæ°”æ°´å¹³ä¸ºnumï¼Œæœ€å¤šå¯å–åˆ°ret int num,ret; while (scanf(&quot;%d&quot;, &amp;num) != EOF) &#123; // æ±½æ°´ç“¶å¯ä»¥æ˜¯0ï¼Œè¿™é‡Œè·³å‡ºå¾ªç¯ // åˆå§‹å€¼ ret = 0; if (num &gt; 0) &#123; // å¦‚æœç©ºç“¶ &gt;= 3 é‚£ä¹ˆä¸€ç›´å¯ç½®æ¢ while (num &gt;= 3) &#123; // æ±½æ°´ = æ±½æ°´ + ç©ºç“¶3ä¸ªæ¢ä¸€ç“¶æ±½æ°´ ret = ret + num/3; // ç©ºç“¶3ä¸ªæ¢1ä¸ªç©ºç“¶ + å‰©ä½™æœªç½®æ¢çš„ç©ºç“¶ num = num/3 + num%3; &#125; // å¦‚æœè¿˜å‰©2ä¸ªç©ºç“¶ï¼Œåˆ™è¿˜èƒ½ç½®æ¢ä¸€ç“¶æ±½æ°´ if (num == 2) &#123; ret ++; &#125; printf(&quot;%d&quot;,ret); &#125; &#125; [pool drain]; return 0;&#125; æ˜æ˜çš„éšæœºæ•°æ˜æ˜ç”Ÿæˆäº†Nä¸ª1åˆ°500ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚è¯·ä½ åˆ å»å…¶ä¸­é‡å¤çš„æ•°å­—ï¼Œå³ç›¸åŒçš„æ•°å­—åªä¿ç•™ä¸€ä¸ªï¼ŒæŠŠå…¶ä½™ç›¸åŒçš„æ•°å»æ‰ï¼Œç„¶åå†æŠŠè¿™äº›æ•°ä»å°åˆ°å¤§æ’åºï¼ŒæŒ‰ç…§æ’å¥½çš„é¡ºåºè¾“å‡ºã€‚æ•°æ®èŒƒå›´ï¼š 1â‰¤nâ‰¤1000 ï¼Œè¾“å…¥çš„æ•°å­—å¤§å°æ»¡è¶³ 1â‰¤valâ‰¤500 è¾“å…¥æè¿°ï¼šç¬¬ä¸€è¡Œå…ˆè¾“å…¥éšæœºæ•´æ•°çš„ä¸ªæ•° N ã€‚æ¥ä¸‹æ¥çš„ N è¡Œæ¯è¡Œè¾“å…¥ä¸€ä¸ªæ•´æ•°ï¼Œä»£è¡¨æ˜æ˜ç”Ÿæˆçš„éšæœºæ•°ã€‚å…·ä½“æ ¼å¼å¯ä»¥å‚è€ƒä¸‹é¢çš„â€ç¤ºä¾‹â€ã€‚ ç¤ºä¾‹1ï¼šè¾“å…¥ä¾‹å­ï¼š3221è¾“å‡ºä¾‹å­ï¼š12ä¾‹å­è¯´æ˜ï¼šè¾“å…¥è§£é‡Šï¼šç¬¬ä¸€ä¸ªæ•°å­—æ˜¯3ï¼Œä¹Ÿå³è¿™ä¸ªå°æ ·ä¾‹çš„N&#x3D;3ï¼Œè¯´æ˜ç”¨è®¡ç®—æœºç”Ÿæˆäº†3ä¸ª1åˆ°500ä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œæ¥ä¸‹æ¥æ¯è¡Œä¸€ä¸ªéšæœºæ•°å­—ï¼Œå…±3è¡Œï¼Œä¹Ÿå³è¿™3ä¸ªéšæœºæ•°å­—ä¸ºï¼š221æ‰€ä»¥æ ·ä¾‹çš„è¾“å‡ºä¸ºï¼š12 c è¯­è¨€å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435#import &lt;Foundation/Foundation.h&gt;int main(int argc, char* argv[]) &#123; NSAutoreleasePool* pool = [[NSAutoreleasePool alloc] init]; int n; // ä¸ªæ•° int arr[1001]; // æ•°ç»„ int j,k; //å®šä¹‰å¾ªç¯å› å­ï¼ŒåµŒå¥—åŒå±‚å¾ªç¯ while (scanf(&quot;%d&quot;, &amp;n) != EOF) &#123; // ç”Ÿæˆéšæœºæ•°å¹¶æ·»åŠ åˆ°æ•°ç»„ä¸­ for (int i = 0; i &lt; n; i ++) &#123; int r = rand()%1000; arr[i] = r; &#125; // å†’æ³¡æ’åº for(j=0; j&lt;n-1; j++) //è®¾ç½®å¾ªç¯åç•Œ &#123; for(k=0; k&lt;n-j-1; k++) //ä¸æ–­å‘åè¿›è¡Œæ¯”è¾ƒ &#123; if(arr[k]&gt;arr[k+1]) //æ¯”è¾ƒç›¸é‚»çš„å…ƒç´  &#123; int temp=arr[k]; //ä¸‰æ¯æ°´äº¤æ¢æ³• arr[k]=arr[k+1]; arr[k+1]=temp; &#125; &#125; &#125; /* è¾“å‡ºæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å€¼ */ for (int m = 0; m &lt; n; m++ )&#123; printf(&quot;Element[%d] = %d\\n&quot;, m, arr[m] ); &#125; &#125; [pool drain]; return 0;&#125; è¿›åˆ¶è½¬æ¢16è¿›åˆ¶è½¬10è¿›åˆ¶ 12345678910111213141516171819202122232425262728293031#import &lt;Foundation/Foundation.h&gt;#include&lt;stdlib.h&gt;int main(int argc, char* argv[]) &#123; char a[] = &quot;1c&quot;; func(a); printf(&quot;%d\\n&quot;,func(a)); return 0;&#125;int func(char a[])&#123; // é•¿åº¦ long len = strlen(a); int i,j,num=0; for (i = 0; i &lt; len; i ++) &#123; if (a[i] == &#x27;A&#x27;) num += 10 * pow(16, len - i - 1); //pow() å‡½æ•°ç”¨æ¥æ±‚ x çš„ y æ¬¡æ–¹çš„å€¼ã€‚ else if (a[i] == &#x27;B&#x27;) num += 11 * pow(16, len - i - 1); else if (a[i] == &#x27;C&#x27;) num += 12 * pow(16, len - i - 1); else if (a[i]==&#x27;D&#x27;) num += 13 * pow(16, len - i - 1); else if (a[i] == &#x27;E&#x27;) num += 14 * pow(16, len - i - 1); else num += 15 * pow(16, len - i - 1); &#125; return num;&#125;","categories":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}],"tags":[{"name":"C-é¢è¯•é¢˜","slug":"C-é¢è¯•é¢˜","permalink":"https://www.bboyzj.cn/tags/C-%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"keywords":[{"name":"C","slug":"C","permalink":"https://www.bboyzj.cn/categories/C/"}]},{"title":"Swiftå­¦ä¹ ï¼šKingfisherä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šKingfisherä½¿ç”¨","date":"2023-02-09T04:39:18.000Z","updated":"2023-03-08T22:17:17.288Z","comments":true,"path":"2023/02/09/Swift/Swiftå­¦ä¹ ï¼šKingfisherä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/09/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9AKingfisher%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€Kingfisher æ˜¯ä¸€ä¸ª ä¸‹è½½ã€ç¼“å­˜ ç½‘ç»œå›¾ç‰‡çš„è½»é‡çº§çº¯swiftåº“ï¼Œåœ¨swiftä¸­æ˜¯ä¸€ä¸ªSDWebImageçš„å‡çº§ç‰ˆ ç‰¹å¾ å¼‚æ­¥ä¸‹è½½å’Œç¼“å­˜å›¾ç‰‡ æä¾›å›¾ç‰‡å¤„ç†å™¨å’Œè¿‡æ»¤å™¨ å†…å­˜å’Œç£ç›˜çš„å¤šå±‚ç¼“å­˜ æ‰©å±•UIImageView&#x2F;UIButtonæ¥è®¾ç½®å›¾ç‰‡ï¼Œå†…ç½®è¿‡æ¸¡åŠ¨ç”» åŸºæœ¬ä½¿ç”¨ ç›´æ¥è®¾ç½®ä¸€å¼ urlå›¾ç‰‡ 123if let url = URL(string: &quot;http://mvimg2.meitudata.com/55fe3d94efbc12843.jpg&quot;) &#123; imgView.kf.setImage(with: url)&#125; æ³¨ï¼škingfisher é¦–å…ˆå°è¯•ä»ç¼“å­˜ä¸­å»å–ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç›´æ¥ä¸‹è½½å›¾ç‰‡å¹¶ä¸”ç¼“å­˜ä¸‹æ¥å¤‡ç”¨ï¼›æ­¤å¤–ï¼Œkingfisher é»˜è®¤ä½¿ç”¨ url ä½œä¸º cacheKey ä»¥æ–¹ä¾¿å†æ¬¡åŠ è½½è¯¥å›¾ç‰‡æ—¶å»ç¼“å­˜ä¸­æ ¹æ® cacheKey æŸ¥æ‰¾ æŒ‡å®šç»™ä¸€ä¸ª cacheKey ç¼“å­˜å›¾ç‰‡ 12let imageResource = ImageResource(downloadURL: url, cacheKey: &quot;Custom_cache_key&quot;)imageView.kf.setImage(with: imageResource) è®¾ç½®å ä½å›¾ç‰‡ 123if let url = URL(string: &quot;http://mvimg2.meitudata.com/55fe3d94efbc12843.jpg&quot;) &#123; imageView.kf.setImage(with: url, placeholder: placeholder_image, options: nil, progressBlock: nil, completionHandler: nil)&#125; ä¸‹è½½å®Œæˆå›è°ƒ 12345678910111213141516if let url = URL(string: &quot;http://mvimg2.meitudata.com/55fe3d94efbc12843.jpg&quot;) &#123; imageView.kf.setImage(with: url, placeholder: nil, options: nil, progressBlock: nil, completionHandler: &#123; (image, error, cacheType, imageUrl) in image // ä¸º nil æ—¶ï¼Œè¡¨ç¤ºä¸‹è½½å¤±è´¥ error // ä¸º nil æ—¶ï¼Œè¡¨ç¤ºä¸‹è½½æˆåŠŸï¼Œ é nil æ—¶ï¼Œå°±æ˜¯ä¸‹è½½å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ cacheType // ç¼“å­˜ç±»å‹ï¼Œæ˜¯ä¸ªæšä¸¾ï¼Œåˆ†ä»¥ä¸‹ä¸‰ç§ï¼š // .none å›¾ç‰‡è¿˜æ²¡ç¼“å­˜ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½å›¾ç‰‡çš„æ—¶å€™ï¼‰ // .memory ä»å†…å­˜ä¸­è·å–åˆ°çš„ç¼“å­˜å›¾ç‰‡ï¼ˆç¬¬äºŒæ¬¡åŠä»¥ä¸ŠåŠ è½½ï¼‰ // .disk ä»ç£ç›˜ä¸­è·å–åˆ°çš„ç¼“å­˜å›¾ç‰‡ï¼ˆç¬¬äºŒæ¬¡åŠä»¥ä¸ŠåŠ è½½ï¼‰ imageUrl // æ‰€è¦ä¸‹è½½çš„å›¾ç‰‡çš„url &#125;)&#125; åŠ è½½èŠèŠ± 12345678910public enum IndicatorType &#123; /// é»˜è®¤æ²¡æœ‰èŠèŠ± case none /// ä½¿ç”¨ç³»ç»ŸèŠèŠ± case activity /// ä½¿ç”¨ä¸€å¼ å›¾ç‰‡ä½œä¸ºèŠèŠ±ï¼Œæ”¯æŒgifå›¾ case image(imageData: Data) /// ä½¿ç”¨è‡ªå®šä¹‰èŠèŠ±ï¼Œè¦éµå¾ªIndicatoråè®® case custom(indicator: Indicator)&#125; ä½¿ç”¨ç³»ç»ŸèŠèŠ± 12imageView.kf.indicatorType = .activityimageView.kf.setImage(with: url) ä½¿ç”¨gifå›¾ä½œä¸ºåŠ è½½èŠèŠ± 1234let path = Bundle.main.path(forResource: &quot;myImage&quot;, ofType: &quot;gif&quot;)!let data = try! Data(contentsOf: URL(fileURLWithPath: path))imageView.kf.indicatorType = .image(imageData: data)imageView.kf.setImage(with: url) è‡ªå®šä¹‰èŠèŠ±ï¼Œéµå¾ª Indicatoråè®® 12345678910111213141516171819202122let myIndicator = CustomIndicator()imageView.kf.indicatorType = .custom(indicator: myIndicator)imageView.kf.setImage(with: url)struct CustomIndicator: Indicator &#123; var view: IndicatorView = UIView() func startAnimatingView() &#123; view.isHidden = false &#125; func stopAnimatingView() &#123; view.isHidden = true &#125; init() &#123; view.backgroundColor = UIColor.magenta &#125;&#125; æ ¹æ®å®æ—¶ä¸‹è½½å›¾ç‰‡çš„æ•°æ®åšè¿›åº¦æ¡åŠ è½½æˆ–è€…èŠèŠ±åŠ è½½ï¼ˆçµæ´»ï¼Œæ¯”ä¾‹ä¸ºï¼šå›¾ç‰‡å·²ä¸‹è½½æ•°æ® &#x2F; å›¾ç‰‡æ€»æ•°æ®ï¼‰ 123456789imageView.kf.setImage(with: url, placeholder: nil, options: nil, progressBlock: &#123; (receivedData, totolData) in let percentage = (Float(receivedData) / Float(totolData)) * 100.0 print(&quot;downloading progress is: \\(percentage)%&quot;) // è¿™é‡Œç”¨è¿›åº¦æ¡æˆ–è€…ç»˜åˆ¶viewéƒ½å¯ä»¥ï¼Œç„¶åæ ¹æ® percentage% è¡¨ç¤ºè¿›åº¦å°±è¡Œäº†&#125;, completionHandler: nil) â€¦","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯Debugç¯å¢ƒ","slug":"Swift/Swiftå­¦ä¹ ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯Debugç¯å¢ƒ","date":"2023-02-07T03:09:34.000Z","updated":"2023-03-08T22:10:33.366Z","comments":true,"path":"2023/02/07/Swift/Swiftå­¦ä¹ ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯Debugç¯å¢ƒ/","link":"","permalink":"https://www.bboyzj.cn/2023/02/07/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9A%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%98%AFDebug%E7%8E%AF%E5%A2%83/","excerpt":"","text":"build setting é…ç½®target -&gt; builf setting -&gt; swift flags -&gt; other swift flags ä¸‹ ç‚¹å‡» debug æ·»åŠ  -D DEBUGï¼Œæ³¨æ„ release ä¸‹ä¸æ·»åŠ  è°ƒç”¨12345#if DEFBU // debug#else // release#endif","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šRxSwiftä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šRxSwiftä½¿ç”¨","date":"2023-02-07T03:02:45.000Z","updated":"2023-03-08T22:13:44.247Z","comments":true,"path":"2023/02/07/Swift/Swiftå­¦ä¹ ï¼šRxSwiftä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/07/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9ARxSwift%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€OC å“åº”å¼ç¼–ç¨‹ä¸€èˆ¬ä½¿ç”¨ ReactiveCocoaï¼Œè€Œ Swift å“åº”å¼ç¼–ç¨‹ä¸€èˆ¬ä½¿ç”¨ RxSwiftï¼ŒRxSwift æœ¬è´¨æ˜¯ è§‚å¯Ÿè€…æ¨¡å¼ï¼Œç›®çš„æ˜¯è®© æ•°æ®/äº‹ä»¶æµå’Œå¼‚æ­¥ä»»åŠ¡ èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„åºåˆ—åŒ–å¤„ç†ã€‚ RxSwift å¼•å…¥Podfileæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ï¼Œå¹¶ pod update 123# å“åº”å¼ç¼–ç¨‹åº“pod &#x27;RxSwift&#x27;pod &#x27;RxCocoa&#x27; RxSwift ä½¿ç”¨ Target Action 12345lazy var bag: DisposeBag = DisposeBag()btn.rx.tap.subscribe &#123; event in print(&quot;ç‚¹å‡»æŒ‰é’®&quot;)&#125;.disposed(by: bag); ç›‘å¬è¾“å…¥æ¡†æ–‡å­—å˜åŒ– 12345lazy var bag: DisposeBag = DisposeBag()tf.rx.text.subscribe(onNext: &#123;string in print(&quot;è¾“å…¥å˜åŒ–ï¼š\\(string!)&quot;);&#125;).disposed(by: bag) è¾“å…¥æ¡†æ–‡å­—ç»‘å®šåˆ°labelä¸Š 123lazy var bag: DisposeBag = DisposeBag()tf.rx.text.bind(to:label.rx.text).disposed(by: bag) é€šçŸ¥ 12345lazy var bag: DisposeBag = DisposeBag()NotificationCenter.default.rx.notification(.NSExtensionHostWillEnterForeground).subscribe(onNext: &#123; notification in print(&quot;Application will enter foreground&quot;);&#125;).disposed(by: bag) ç›‘å¬å±æ€§æ”¹å˜ 1234567label.rx.observe(String.self, &quot;text&quot;).subscribe &#123; event in print(&quot;æ–‡æœ¬æ”¹å˜ï¼š\\(event.element!!)&quot;)&#125;.disposed(by: bag)label.rx.observe(CGRect.self, &quot;frame&quot;).subscribe &#123; event in print(&quot;frameæ”¹å˜ï¼š\\(event.element!!)&quot;)&#125;.disposed(by: bag) ç›‘å¬æ»šåŠ¨åç§» 123scrollView.rx.contentOffset.subscribe &#123; point in print(&quot;æ»šåŠ¨åç§»ï¼š\\(point.element!)&quot;)&#125;.disposed(by: bag)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­typealiasä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­typealiasä½¿ç”¨","date":"2023-02-05T07:01:41.000Z","updated":"2023-03-08T22:11:34.384Z","comments":true,"path":"2023/02/05/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­typealiasä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/05/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%ADtypealias%E4%BD%BF%E7%94%A8/","excerpt":"","text":"ç®€ä»‹typealiasï¼šç±»å‹åˆ«å ä½¿ç”¨ ç¬¬ä¸€ç§æ–¹å¼ 12345678910// å®šä¹‰é—­åŒ…typealias SuccessCallBack = (_ code:String,_ message:String) -&gt; void// å£°æ˜é—­åŒ…var customCallBack : SuccessCallBack?// ä½¿ç”¨if let call = customCallBack &#123; call(&quot;ä½ æ˜¯è°&quot;,&quot;ä½ ç®¡æˆ‘æ˜¯è°&quot;);&#125; ç¬¬äºŒç§æ–¹å¼ 12345678// å®šä¹‰é—­åŒ…var callBack:((_ code:String,_ message:String) -&gt; Void)?// ä½¿ç”¨if let call = callBack &#123; call(&quot;æˆ‘æ˜¯è°&quot;,&quot;æˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘æ˜¯è°&quot;);&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šHandyJSONçš„ä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šHandyJSONçš„ä½¿ç”¨","date":"2023-02-04T04:03:43.000Z","updated":"2023-03-08T22:10:23.318Z","comments":true,"path":"2023/02/04/Swift/Swiftå­¦ä¹ ï¼šHandyJSONçš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/04/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9AHandyJSON%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€HandyJSON æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªç”¨äºSwiftè¯­è¨€ä¸­çš„ JSONåºåˆ—åŒ–/ååºåˆ—åŒ–åº“ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œ jsonå’Œmodel çš„è½¬æ¢ï¼Œä»¥åŠå¸¸ç”¨çš„ å­—å…¸å’Œæ¨¡å‹ çš„äº’ç›¸è½¬æ¢ JSONè½¬Modelåªéœ€è¦åœ¨å®šä¹‰æ—¶ï¼Œå®ç°HandyJSONåè®®ï¼Œè¿™ä¸ªåè®®åªè¦æ±‚å®ç°ä¸€ä¸ªç©ºçš„init()å‡½æ•° å®šä¹‰ BaseModel 1234567891011import HandyJSONclass BaseModel: HandyJSON &#123; // è¿”å›çš„æ•°æ® var data : Any? // ä¸šåŠ¡ç  var code : Int? // æç¤ºä¿¡æ¯ var msg : String? required init() &#123;&#125;&#125; è½¬æ¢ 123if let baseModel = BaseModel.deserialize(from:jsonString)&#123; print();&#125; model è½¬ json1JSONSerializer.serializeToJson(object:xxx)","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­extensionä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­extensionä½¿ç”¨","date":"2023-02-04T03:12:04.000Z","updated":"2023-03-08T22:11:29.147Z","comments":true,"path":"2023/02/04/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­extensionä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/04/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%ADextension%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€swift ä¸­çš„ æ‰©å±•Extensionï¼Œç±»ä¼¼ OC ä¸­çš„ åˆ†ç±»Category ä½œç”¨ æ‰©å±•å¯ä»¥ä¸º æšä¸¾ã€ç»“æ„ä½“ã€ç±»ã€åè®® æ·»åŠ æ–°åŠŸèƒ½ æ·»åŠ æ–¹æ³•ã€è®¡ç®—å±æ€§ã€ä¸‹æ ‡ã€åˆå§‹åŒ–å™¨ã€åµŒå¥—ç±»å‹ã€åè®®ç­‰ æ‰©å±•ä¸èƒ½åŠåˆ°çš„äº‹ ä¸èƒ½è¦†ç›–åŸæœ‰çš„åŠŸèƒ½ OCæ˜¯å…è®¸è¦†ç›–çš„ï¼Œä½†swiftæ˜¯å®‰å…¨çš„ï¼Œæ˜¯ä¸å…è®¸è¦†ç›–çš„ ä¸èƒ½æ·»åŠ å­˜å‚¨å±æ€§ å› ä¸ºå±æ€§ä¼šæ”¹å˜å†…å­˜ç»“æ„ï¼Œä½†æ‰©å±•æ˜¯ä¸å…è®¸æ”¹å˜åŸæœ‰çš„å†…å­˜ç»“æ„ ä¸èƒ½å‘å·²æœ‰çš„å±æ€§æ·»åŠ å±æ€§è§‚å¯Ÿå€¼ ä¸èƒ½æ·»åŠ çˆ¶ç±» ä¸èƒ½æ‰©å±•åé¢ä¹¦å†™å†’å·ç»§æ‰¿çˆ¶ç±»ï¼ˆExtension Car:Personï¼‰ï¼Œå› ä¸ºç»§æ‰¿æœ‰å¯èƒ½æ”¹å˜åŸæœ‰ç±»çš„ç»“æ„ ä¸èƒ½æ·»åŠ æŒ‡å®šåˆå§‹åŒ–å™¨ï¼Œä¸èƒ½æ·»åŠ ååˆå§‹åŒ–å™¨ requiredåˆå§‹åŒ–å™¨ä¸èƒ½åœ¨æ‰©å±•ä¸­ï¼Œåªèƒ½åœ¨åŸæœ‰ç±»ä¸­ å®ç”¨ æ‰©å±•æ–¹æ³• 123456789101112131415161718extension ViewController &#123; // MARKï¼š- å®ä¾‹æ–¹æ³• // å£°æ˜æ— å‚æ•°æ— è¿”å›å€¼çš„å®ä¾‹æ–¹æ³• func run() &#123; print(&quot;run&quot;); &#125; // MARKï¼šç±»æ–¹æ³• // å£°æ˜ç§æœ‰ç±»æ–¹æ³• private class func eat() &#123; print(&quot;eat&quot;); &#125; // MARKï¼šé™æ€æ–¹æ³•ï¼ˆå±äºç‰¹æ®Šçš„ç±»æ–¹æ³•ï¼‰ static func speak() &#123; print(&quot;speak&quot;); &#125;&#125; æ‰©å±•åè®® 123456789extension ViewController: UITableViewDataSourceï¼Œ UITableViewDelegate &#123; func tableView(_ tableView: UITableViewï¼Œ numberOfRowsInSection section: Int) -&gt; Int &#123; return 5 &#125; func tableView(_ tableView: UITableViewï¼Œ cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell &#123; return UITableViewCell() &#125;&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­æ–¹æ³•çš„å£°æ˜","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­æ–¹æ³•çš„å£°æ˜","date":"2023-02-04T02:52:19.000Z","updated":"2023-03-08T22:13:10.471Z","comments":true,"path":"2023/02/04/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­æ–¹æ³•çš„å£°æ˜/","link":"","permalink":"https://www.bboyzj.cn/2023/02/04/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%AD%E6%96%B9%E6%B3%95%E7%9A%84%E5%A3%B0%E6%98%8E/","excerpt":"","text":"å®ä¾‹æ–¹æ³•12345678910111213141516171819202122232425// MARKï¼šå®ä¾‹æ–¹æ³•// å£°æ˜æ— å‚æ•°æ— è¿”å›å€¼çš„å®ä¾‹æ–¹æ³•func run() &#123; print(&quot;run&quot;);&#125;// å£°æ˜å¸¦å‚çš„å®ä¾‹æ–¹æ³•ï¼Œå…¶ä¸­ï¼šdest è¢«ç§°ä¸ºå‚æ•°æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨ â€œ_â€ ä»£æ›¿func run(dest distance: Int) &#123; print(distance);&#125;// å£°æ˜å¸¦å¤šä¸ªå‚æ•°çš„å®ä¾‹æ–¹æ³•func run(dest distance: Int,sour position:Int) &#123; print(distance+position);&#125;// å£°æ˜å¸¦å‚æ•°æœ‰è¿”å›å€¼çš„å®ä¾‹æ–¹æ³•func run(dest distance: Int) -&gt; Bool &#123; return true;&#125;// å£°æ˜å¸¦å‚æ•°æœ‰å¤šä¸ªè¿”å›å€¼çš„å®ä¾‹æ–¹æ³•func run(dest distance: Int) -&gt; (Bool,Int) &#123; return (true,10);&#125;// å£°æ˜ç§æœ‰å®ä¾‹æ–¹æ³•ï¼Œå…¶ä¸­ private å¯æ›´æ¢å…¶ä»–è®¿é—®æƒé™çš„å…³é”®å­—private func cry(content value:String)&#123; print(value);&#125; ç±»æ–¹æ³•12345678// å£°æ˜ç±»æ–¹æ³•class func walk()&#123; print(&quot;walk&quot;);&#125;// å£°æ˜ç§æœ‰ç±»æ–¹æ³•private class func eat() &#123; print(&quot;eat&quot;);&#125; é™æ€æ–¹æ³•123456789// MARKï¼šé™æ€æ–¹æ³•ï¼ˆå±äºç‰¹æ®Šçš„ç±»æ–¹æ³•ï¼‰static func speak() &#123; print(&quot;speak&quot;);&#125;// ç§æœ‰é™æ€æ–¹æ³•private static func see() &#123; print(&quot;see&quot;);&#125; æ³¨ï¼šå®ä¾‹æ–¹æ³•ç”±å®ä¾‹å¯¹è±¡è°ƒç”¨ï¼›ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•ç”¨ç±»å¯¹è±¡è°ƒç”¨","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­guardè¯­å¥","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­guardè¯­å¥","date":"2023-02-03T11:54:25.000Z","updated":"2023-03-08T22:11:31.845Z","comments":true,"path":"2023/02/03/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­guardè¯­å¥/","link":"","permalink":"https://www.bboyzj.cn/2023/02/03/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%ADguard%E8%AF%AD%E5%8F%A5/","excerpt":"","text":"å‰è¨€123guard æ¡ä»¶ else &#123; // do something&#125; å½“ guard è¯­å¥æ¡ä»¶ä¸º false æ—¶ï¼Œæ‰§è¡Œå¤§æ‹¬å·é‡Œé¢çš„ä»£ç  å½“ guard è¯­å¥æ¡ä»¶ä¸º true æ—¶ï¼Œè·³è¿‡guardè¯­å¥ åˆ—å­1234567891011func login(_ info:[String:String])&#123; guard let username = info[&quot;username&quot;] else &#123; print(&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot;); return; &#125; guard let password = info[&quot;password&quot;] else &#123; print(&quot;è¯·è¾“å…¥å¯†ç &quot;); return; &#125; print(&quot;ç”¨æˆ·åï¼š\\(username)&quot;,&quot;å¯†ç ï¼š\\(password)&quot;);&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 08ï¼šswiftä¸­@availableå’Œ#available","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­@availableå’Œ#available","date":"2023-02-03T11:54:08.000Z","updated":"2023-02-04T03:30:33.504Z","comments":true,"path":"2023/02/03/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­@availableå’Œ#available/","link":"","permalink":"https://www.bboyzj.cn/2023/02/03/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%AD@available%E5%92%8C#available/","excerpt":"","text":"å‰è¨€å¯¹äº å‡½æ•°ã€ç±»ã€åè®®ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ @available å£°æ˜è¿™äº›ç±»å‹çš„å£°æ˜å‘¨æœŸä¾èµ–äºç‰¹å®šçš„å¹³å°å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€‚è€Œ #available ç”¨åœ¨åˆ¤æ–­è¯­å¥ä¸­ï¼Œåœ¨ä¸åŒå¹³å°ä¸Šåšä¸åŒçš„é€»è¾‘ @available1234@available(iOS 9,*)func myMethod()&#123; // do something&#125; iOS 9 : è¡¨ç¤ºåœ¨ iOS 9 ç‰ˆæœ¬ä»¥ä¸Šæ‰å¯ç”¨ æ˜Ÿå· * : è¡¨ç¤ºåŒ…å«äº†æ‰€æœ‰å¹³å° #availble#availble ç”¨äºæ¡ä»¶è¯­å¥ä»£ç å—ä¸­ï¼Œåˆ¤æ–­ä¸åŒçš„å¹³å°ä¸‹ï¼Œåšä¸é€šçš„é€»è¾‘å¤„ç† 1234567if #availble(iOS 9,*) &#123; // iOS 9 åŠä»¥ä¸Šç³»ç»Ÿè¿è¡Œ&#125;guard #availble(iOS 9,*) else &#123; // iOS 9 ä»¥ä¸‹ç³»ç»Ÿè¿è¡Œ&#125;","categories":[{"name":"swift-å­¦ä¹ ç¯‡","slug":"swift-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/categories/swift-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"tags":[{"name":"iOS-Swift","slug":"iOS-Swift","permalink":"https://www.bboyzj.cn/tags/iOS-Swift/"}],"keywords":[{"name":"swift-å­¦ä¹ ç¯‡","slug":"swift-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/categories/swift-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­asã€asï¼ã€asï¼Ÿå·çš„ä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­asã€asï¼ã€asï¼Ÿå·çš„ä½¿ç”¨","date":"2023-02-03T11:27:15.000Z","updated":"2023-03-08T22:11:43.844Z","comments":true,"path":"2023/02/03/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­asã€asï¼ã€asï¼Ÿå·çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/03/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%ADas%E3%80%81as%EF%BC%81%E3%80%81as%EF%BC%9F%E5%8F%B7%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å…³äº as å°†å­ç±»è½¬æ¢ä¸ºåŸºç±» 1234class Auto &#123;&#125;class Car : Auto &#123;&#125;let car = Car()let truck = car sa Auto æ•°å€¼ç±»å‹çš„è½¬æ¢ 1let n1 = 56 as Int æ¨¡å¼åŒ¹é… 1234567swich Auto &#123; case let car as Car: print(&quot;è¿™é‡Œæ˜¯Carç±»å‹å¯¹è±¡&quot;); case let truck as Truck: print(&quot;è¿™é‡Œæ˜¯Truckç±»å‹å¯¹è±¡&quot;); default: break&#125; as!å‘ä¸‹å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ä¼šæŠ¥é”™ 1234class Auto &#123;&#125;class Car: Auto &#123;&#125;let auto: Auto = Car()let car = auto as! Car as?å‘ä¸‹å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ä¼šè¿”å›nil 1234567let auto: Auto = Car()if let car = auto as? Car &#123; print(&quot;è¿™æ˜¯Car&quot;)&#125;else &#123; print(&quot;è¿™ä¸æ˜¯Car&quot;)&#125;","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­ï¼Ÿã€ï¼ã€ï¼Ÿï¼Ÿå·çš„ä½¿ç”¨","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­ï¼Ÿã€ï¼ã€ï¼Ÿï¼Ÿå·çš„ä½¿ç”¨","date":"2023-02-03T11:06:43.000Z","updated":"2023-03-08T22:13:26.309Z","comments":true,"path":"2023/02/03/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­ï¼Ÿã€ï¼ã€ï¼Ÿï¼Ÿå·çš„ä½¿ç”¨/","link":"","permalink":"https://www.bboyzj.cn/2023/02/03/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%AD%EF%BC%9F%E3%80%81%EF%BC%81%E3%80%81%EF%BC%9F%EF%BC%9F%E5%8F%B7%E7%9A%84%E4%BD%BF%E7%94%A8/","excerpt":"","text":"å‰è¨€swift ä¸­ ? æ˜¯å¯é€‰çš„æ„æ€ï¼Œ! æ˜¯å¼ºåˆ¶&#x2F;è§£åŒ…çš„æ„æ€ï¼Œ?? æ˜¯ç”¨äºåˆ¤æ–­ å˜é‡/å¸¸é‡ æ•°å€¼æ˜¯å¦ä¸ºnil ï¼Ÿå·çš„ä½¿ç”¨å£°æ˜ä¸€ä¸ª Optional å˜é‡æˆ–å¸¸é‡æ—¶ï¼Œåœ¨æ•°æ®ç±»å‹åé¢åŠ ä¸Š ï¼Ÿ å·å³å¯ 12// åå­—var name : String? !å·çš„ä½¿ç”¨ï¼ å·ç”¨äºè§£åŒ…ï¼Œä¸€èˆ¬åªæœ‰åœ¨ä¿è¯ å˜é‡/å¸¸é‡ æœ‰å€¼ï¼Œæ‰èƒ½è¿›è¡Œ å¼ºè¡Œè§£åŒ… 123var a : Int?a = 5;print(a!); ?? å·?? å·ç”¨äºåˆ¤æ–­ å˜é‡/å¸¸é‡ æ•°å€¼æ˜¯å¦ä¸ºnilï¼Œä¸ºnilåˆ™ä½¿ç”¨ ?? å·åé¢çš„å€¼æ›¿ä»£ 12var a : Int?print(a ?? 0);","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šAlamofireç½‘ç»œè¯·æ±‚å°è£…","slug":"Swift/Swiftå­¦ä¹ ï¼šAlamofireç½‘ç»œè¯·æ±‚å°è£…","date":"2023-02-03T02:11:52.000Z","updated":"2023-03-08T22:10:25.571Z","comments":true,"path":"2023/02/03/Swift/Swiftå­¦ä¹ ï¼šAlamofireç½‘ç»œè¯·æ±‚å°è£…/","link":"","permalink":"https://www.bboyzj.cn/2023/02/03/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9AAlamofire%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%B0%81%E8%A3%85/","excerpt":"","text":"å‰è¨€Alamofire æ˜¯ä¸€ä¸ªä½¿ç”¨ swift å¼€å‘çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œå¼€å‘å›¢é˜Ÿæ˜¯ AFNetworking çš„åŸå›¢é˜Ÿã€‚è¯­æ³•ç®€æ´ï¼Œé‡‡ç”¨ é“¾å¼ç¼–ç¨‹ çš„æ€æƒ³ï¼Œæœ¬è´¨æ˜¯åŸºäº NSURLSession è¿›è¡Œå°è£…ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ä¸€èˆ¬è¦è¿›è¡Œ äºŒæ¬¡å°è£…ã€‚ æ ¹æ®åå°è¿”å›çš„æ•°æ®å®šä¹‰ BaseModel å®šä¹‰ BaseModel 1234567891011import HandyJSONclass BaseModel: HandyJSON &#123; // è¿”å›çš„æ•°æ® var data : Any? // ä¸šåŠ¡ç  var code : Int? // æç¤ºä¿¡æ¯ var msg : String? required init() &#123;&#125;&#125; BaseModel å»ºç«‹åï¼Œå°±å¯ä»¥æ­£å¼å¼€å§‹å‡†å¤‡æ­å»ºç½‘ç»œè¯·æ±‚å·¥å…·äº†","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šlazyæ¢ç´¢","slug":"Swift/Swiftå­¦ä¹ ï¼šlazyæ¢ç´¢","date":"2023-02-02T15:43:25.000Z","updated":"2023-03-08T22:17:10.502Z","comments":true,"path":"2023/02/02/Swift/Swiftå­¦ä¹ ï¼šlazyæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2023/02/02/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Alazy%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"å‰è¨€ lazy çš„æœ¬è´¨æ˜¯ å£°æ˜å¹¶æ‰§è¡Œçš„é—­åŒ…ï¼Œæˆ–ä¸€ä¸ªæœ‰è¿”å›å€¼çš„å‡½æ•°è°ƒç”¨ï¼Œåªæ‰§è¡Œä¸€æ¬¡ lazyå±æ€§ å°±æ˜¯ åˆå§‹å€¼ ç›´åˆ° ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™ æ‰æ‰§è¡Œçš„å±æ€§ lazy å±æ€§å¿…é¡»æ˜¯å˜é‡ï¼ˆvarä¿®é¥°ç¬¦ï¼‰,å› ä¸ºå¸¸é‡å±æ€§ï¼ˆletä¿®é¥°ç¬¦ï¼‰å¿…é¡»åœ¨åˆå§‹åŒ–ä¹‹å‰å°±æœ‰å€¼ï¼Œæ‰€ä»¥å¸¸é‡å±æ€§ä¸èƒ½å®šä¹‰ä¸ºlazy OCä¸­çš„å»¶è¿ŸåŠ è½½12345678@property (nonatomic,strong)UILabel * label;- (UILabel *)label&#123; if (!_label)&#123; _label = [[UILabel alloc] init]; NSLog(@&quot;åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º&quot;) &#125; return _label;&#125; Swift å»¶è¿ŸåŠ è½½1234567lazy var myL: UILabel = &#123; var myL = UILabel(frame: CGRectZero); myL.backgroundColor = UIColor.green; myL.text = &quot;æˆ‘&quot;; print(&quot;åªåœ¨é¦–æ¬¡è®¿é—®è¾“å‡º&quot;); return myL;&#125;() ç›¸æ¯” OC çš„å®ç°ï¼Œlazy ç®€å•å¤šäº†ã€‚ lazy var label: UILabel = UILabel() æ§ä»¶æ‡’åŠ è½½12345lazy var btn = &#123; () -&gt; UIButton in // () -&gt; UIButton in å¯ä»¥çœç•¥å‰ææ˜¯å·²æŒ‡å®šç±»å‹ // æ‰§è¡Œç±»å‹ä¸å¯çœç•¥ return UIButton(type: .custom);&#125;() å¸¸è§å†™æ³• 12345lazy var btn: UIButton = &#123; // () -&gt; UIButton in å¯ä»¥çœç•¥å‰ææ˜¯å·²æŒ‡å®šç±»å‹ // æ‰§è¡Œç±»å‹ä¸å¯çœç•¥ return UIButton(type: .custom);&#125;()","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šswiftä¸­å®å®šä¹‰æ›¿ä»£æ–¹æ¡ˆ","slug":"Swift/Swiftå­¦ä¹ ï¼šswiftä¸­å®å®šä¹‰æ›¿ä»£æ–¹æ¡ˆ","date":"2023-02-02T13:52:08.000Z","updated":"2023-03-08T22:12:48.616Z","comments":true,"path":"2023/02/02/Swift/Swiftå­¦ä¹ ï¼šswiftä¸­å®å®šä¹‰æ›¿ä»£æ–¹æ¡ˆ/","link":"","permalink":"https://www.bboyzj.cn/2023/02/02/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9Aswift%E4%B8%AD%E5%AE%8F%E5%AE%9A%E4%B9%89%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88/","excerpt":"","text":"ç®€ä»‹swiftä¸­æ²¡æœ‰å®å®šä¹‰ï¼Œè‹¹æœç®€ä»‹ç”¨ let æˆ– get å±æ€§æ¥æ›¿ä»£å®å®šä¹‰å€¼ ç¬¬ä¸€ç§ï¼šè·å–çš„å€¼ä¸ä¼šå˜å¯ä»¥ç›´æ¥ä½¿ç”¨ let KnavBarHeight = 44.0; ç¬¬äºŒç§ï¼šè·å–çš„å€¼ä¼šå˜let å®šä¹‰çš„æ˜¯å¸¸é‡ï¼Œå¦‚æœåé¢çš„å€¼ä¼šå˜å¯ä»¥ä½¿ç”¨ å‡½æ•° 123func StatusBar_height() -&gt; CGFloat&#123; return UIApplication.shared.statusBarFrame.size.height;&#125; é€šè¿‡ StatusBar_height() è·å–çŠ¶æ€æ çš„é«˜åº¦ ç¬¬ä¸‰ç§ï¼šè¾“å…¥æœ‰å‚æ•°123func RGB_COLOR(r:CGFloat,g:CGFloat,b:CGFloat) -&gt; UIColor&#123; return UIColor(red:r,green:g,blue:b,alpha:1);&#123; æ³¨ï¼šfunc ä¹Ÿå¯ä»¥ç”¨ var ä»£æ›¿ ä½¿ç”¨ åˆ›å»º Common.swift æ–‡ä»¶å­˜æ”¾ åˆ›å»º SRSF-Swift-Bridging-Header å­˜æ”¾ä¸‰æ–¹åº“","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Flutterå­¦ä¹ 01:Macç¯å¢ƒæ­å»º","slug":"Flutterå­¦ä¹ /Flutterå­¦ä¹ 01ï¼šMacç¯å¢ƒæ­å»º","date":"2023-01-08T11:04:34.000Z","updated":"2023-03-08T21:42:43.753Z","comments":true,"path":"2023/01/08/Flutterå­¦ä¹ /Flutterå­¦ä¹ 01ï¼šMacç¯å¢ƒæ­å»º/","link":"","permalink":"https://www.bboyzj.cn/2023/01/08/Flutter%E5%AD%A6%E4%B9%A0/Flutter%E5%AD%A6%E4%B9%A001%EF%BC%9AMac%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/","excerpt":"","text":"ä¸‹è½½Flutter æ–¹å¼ä¸€ï¼š ä¸‹è½½ flutter SDKï¼šhttps://flutter.io/sdk-archive/#macos å°†æ–‡ä»¶è§£å‹åˆ°ç›®æ ‡è·¯å¾„ 12mac@192 ~ % cd ç›®æ ‡æ–‡ä»¶è·¯å¾„mac@192 ~ % unzip ~/Downloads/flutter_macos_3.3.10-stable.zip é…ç½® flutter çš„ PATH ç¯å¢ƒå˜é‡ 1mac@192 ~ % export PATH=&quot;$PATH:`pwd`/flutter/bin&quot; pwdï¼šæ˜¯ flutter ä¸‹ bin çš„æ–‡ä»¶è·¯å¾„ æ–¹å¼äºŒï¼š ç›´æ¥ä» Github ä¸Šä¸‹è½½ï¼š 1mac@192 ~ % git clone https://github.com/flutter/flutter.git -b stable ç¯å¢ƒå˜é‡è®¾ç½® è¿›å…¥æ ¹ç›®å½• mac@192 ~ % cd ~ åˆ›å»º .bash_profile mac@192 ~ % touch .bash_profile ç¼–è¾‘ .bash_profile mac@192 ~ % open -e .bash_profile è®¾ç½®ç¯å¢ƒå˜é‡ 1234# Flutterexport PUB_HOSTED_URL=https://pub.flutter-io.cn # å›½å†…é•œåƒexport FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn # å›½å†…é•œåƒexport PATH=&quot;$PATH:/Users/mac/Desktop/Flutter/flutter/bin&quot; æ³¨ï¼šexport PATH=&quot;$PATH:ã€flutterçš„binç›®å½•ã€‘ ä¿å­˜ .bash_profile mac@192 ~ % command+s æ›´æ–° mac@192 ~ % source .bash_profile éªŒè¯æ˜¯å¦æˆåŠŸ mac@192 ~ % flutter doctor å¦‚æœç»ˆç«¯æ˜¾ç¤ºå¦‚ä¸‹ï¼Œè¯æ˜æˆåŠŸäº†ï¼Œå¦‚ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344Downloading Darwin x64 Dart SDK from Flutter engine 3316dd8728419ad3534e3f6112aa6291f587078a... % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 202M 100 202M 0 0 5622k 0 0:00:36 0:00:36 --:--:-- 6859kBuilding flutter tool...Flutter assets will be downloaded from https://storage.flutter-io.cn. Make sureyou trust this source!Downloading Material fonts... 1,526msDownloading Gradle Wrapper... 262msDownloading package sky_engine... 473msDownloading flutter_patched_sdk tools... 1,162msDownloading flutter_patched_sdk_product tools... 638msDownloading darwin-x64 tools... 5.5sDownloading libimobiledevice... 78msDownloading usbmuxd... 75msDownloading libplist... 75msDownloading openssl... 249msDownloading ios-deploy... 88msDownloading darwin-x64/font-subset tools... 255msDoctor summary (to see all details, run flutter doctor -v):[âœ“] Flutter (Channel stable, 3.3.10, on macOS 12.6.1 21G217 darwin-x64, locale zh-Hans-CN)[!] Android toolchain - develop for Android devices (Android SDK version 30.0.0) âœ— cmdline-tools component is missing Run `path/to/sdkmanager --install &quot;cmdline-tools;latest&quot;` See https://developer.android.com/studio/command-line for more details. âœ— Android license status unknown. Run `flutter doctor --android-licenses` to accept the SDK licenses. See https://flutter.dev/docs/get-started/install/macos#android-setup for more details.[!] Xcode - develop for iOS and macOS (Xcode 14.1) ! CocoaPods 1.10.1 out of date (1.11.0 is recommended). CocoaPods is used to retrieve the iOS and macOS platform side&#x27;s plugin code that responds to your plugin usage on the Dart side. Without CocoaPods, plugins will not work on iOS or macOS. For more info, see https://flutter.dev/platform-plugins To upgrade see https://guides.cocoapods.org/using/getting-started.html#installation for instructions.[âœ“] Chrome - develop for the web[!] Android Studio (not installed)[âœ“] VS Code (version 1.73.1)[âœ“] Connected device (3 available)[âœ“] HTTP Host Availability é’ˆå¯¹ CocoaPods 1.10.1 out of date (1.11.0 is recommended) æˆ‘ä»¬åªéœ€è¦ä¸‹è½½å®‰è£…å°±å¯ä»¥äº†ï¼š mac@192 ~ % sudo gem install -n /usr/local/bin cocoapods é€šè¿‡ pod --version æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬ é’ˆå¯¹ cmdline-tools component is missing é”™è¯¯ æ‰“å¼€ Android studio ä¸‹ tools--&gt;SDK manager ä¸­è¿›å…¥ SDK tools ä¸­ï¼š æ‰¾åˆ° Android SDK ç‚¹å‡» Apply è¿›è¡Œä¸‹è½½ å†æ¬¡ flutter doctor è¿è¡Œï¼Œå‡ºç°å¦‚ä¸‹ï¼Œåˆ™ä»£è¡¨æˆåŠŸ 123456789101112Doctor summary (to see all details, run flutter doctor -v):[âœ“] Flutter (Channel stable, 3.3.10, on macOS 12.6.1 21G217 darwin-x64, locale zh-Hans-CN)[âœ“] Android toolchain - develop for Android devices (Android SDK version 30.0.0)[âœ“] Xcode - develop for iOS and macOS (Xcode 14.1)[âœ“] Chrome - develop for the web[âœ“] Android Studio (version 2021.1)[âœ“] VS Code (version 1.73.1)[âœ“] Connected device (3 available)[âœ“] HTTP Host Availabilityâ€¢ No issues found! æ‰“å¼€ Android studio ç¨‹åºï¼Œå®‰è£… flutterï¼š å®‰è£… dart å®‰è£…å®Œæˆï¼Œé‡æ–°å¯åŠ¨ Android studioï¼Œå°±å¯ä»¥å¼€å‘ flutter äº† å‡çº§ flutter flutter SDK æ‰€æœ‰åˆ†æ”¯ beat&#x2F;dev&#x2F;master&#x2F;stableï¼Œå…¶ä¸­stableä¸ºç¨³å®šåˆ†æ”¯ï¼Œdevå’Œmasterä¸ºå¼€å‘åˆ†æ”¯ï¼Œè¿è¡Œ flutter channel æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ 12345mac@bogon ~ % flutter channelFlutter channels: master beta* stable â€œ*â€ å·æœ¬åœ°çš„flutter SDK è·Ÿè¸ªåˆ†æ”¯ï¼Œåˆ‡æ¢åˆ†æ”¯ flutter channel beta å’Œ flutter channel master å‡çº§ flutter sdk å’Œ ä¾èµ–åŒ… 1flutter upgrade è¯¥å‘½ä»¤ä¼šåŒæ—¶æ›´æ–° Flutter SDK å’Œ flutterä¾èµ–åŒ…ï¼Œå¦‚æœåªæƒ³æ›´æ–°ä¾èµ–åŒ…ï¼š 12flutter packages get è·å–é¡¹ç›®æ‰€æœ‰çš„ä¾èµ–åŒ…flutter packages upgrade è·å–é¡¹ç›®æ‰€æœ‰ä¾èµ–åŒ…çš„æœ€æ–°ç‰ˆæœ¬ IDEé…ç½®å’Œä½¿ç”¨Flutter å»ºè®®ä½¿ç”¨ Android Studio å’Œ VS Code ä¹‹ä¸€å¼€å‘ä½“éªŒï¼Œé€šè¿‡ IDEå’Œæ’ä»¶ å¯è·å¾—ä»£ç è¡¥å…¨ã€è¯­æ³•é«˜äº®ã€widgetç¼–è¾‘è¾…åŠ©ã€è¿è¡Œå’Œè°ƒè¯•ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©æˆ‘ä»¬æå¤§çš„æé«˜å¼€å‘æ•ˆç‡ Android Studio VS Code Flutterå®˜ç½‘ è¿æ¥åˆ° ios çœŸæœºè®¾å¤‡Flutterå®˜ç½‘ å¦‚æœå‡ºç°å¦‚ä¸‹ï¼š flutterçœŸæœºè¿è¡Œ æ— æ³•æ‰“å¼€â€œiproxyâ€,å› ä¸ºæ— æ³•éªŒè¯å¼€å‘è€… æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1234sudo xattr -d com.apple.quarantine sudo xattr -d com.apple.quarantine sudo xattr -d com.apple.quarantinesudo xattr -d com.apple.quarantine /Users/mac/Desktop/Flutter/flutter/bin/cache/artifacts/usbmuxd/iproxy å…¶ä¸­ /Users/mac/Desktop/Flutter/flutter æ˜¯ä½ æ¡Œé¢flutterçš„è·¯å¾„","categories":[{"name":"Flutter-å­¦ä¹ ç¯‡","slug":"Flutter-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/categories/Flutter-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}],"tags":[{"name":"Flutter","slug":"Flutter","permalink":"https://www.bboyzj.cn/tags/Flutter/"}],"keywords":[{"name":"Flutter-å­¦ä¹ ç¯‡","slug":"Flutter-å­¦ä¹ ç¯‡","permalink":"https://www.bboyzj.cn/categories/Flutter-%E5%AD%A6%E4%B9%A0%E7%AF%87/"}]},{"title":"OCæ•°æ®ç»“æ„00ï¼šå…¥é—¨","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCæ•°æ®ç»“æ„00ï¼šå…¥é—¨","date":"2022-11-23T00:55:26.000Z","updated":"2023-03-07T04:47:05.090Z","comments":true,"path":"2022/11/23/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCæ•°æ®ç»“æ„00ï¼šå…¥é—¨/","link":"","permalink":"https://www.bboyzj.cn/2022/11/23/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%8400%EF%BC%9A%E5%85%A5%E9%97%A8/","excerpt":"","text":"æ¦‚è¿° æ•°æ®ç»“æ„æ¦‚å¿µï¼š æˆ‘ä»¬æŠŠç°å®ä¸­ å¤§é‡å¤æ‚çš„é—®é¢˜ ä»¥ç‰¹å®šçš„æ•°æ®ç±»å‹å’Œç‰¹å®šçš„å­˜å‚¨ç»“æ„ä¿å­˜åˆ° ä¸»å­˜å‚¨å™¨ï¼ˆå†…å­˜ï¼‰ä¸­ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå®ç°æŸä¸ªåŠŸèƒ½ï¼ˆæ’åºç­‰ï¼‰çš„æ“ä½œå« ç®—æ³•ã€‚ æ•°æ®ç»“æ„ &#x3D; å…ƒç´  + å…ƒç´ å…³ç³» ç®—æ³• &#x3D; å¯¹æ•°æ®ç»“æ„çš„æ“ä½œ ç®—æ³•ï¼šè§£å†³é—®é¢˜çš„æ–¹æ³•å’Œæ­¥éª¤ è¡¡é‡æ ‡å‡†ï¼š æ—¶é—´å¤æ‚åº¦ï¼šç®—æ³•è¦æ‰§è¡Œçš„æ¬¡æ•°ï¼Œéæ‰§è¡Œæ—¶é—´ ç©ºé—´å¤æ‚åº¦ï¼šç®—æ³•æ‰§è¡Œè¿‡ç¨‹ å¤§æ¦‚è¦å ç”¨çš„æœ€å¤§å†…å­˜ æŒ‡é’ˆå®šä¹‰ åœ°å€ åœ°å€æ˜¯å†…å­˜å•å…ƒçš„ç¼–å·ï¼Œå…¶ç¼–å·ä» 0 å¼€å§‹çš„éè´Ÿæ•´æ•°ï¼ŒèŒƒå›´ï¼š0 â€“ 0xFFFFFFFF x64å¹³å°ä¸‹æœ€å¤§å†…å­˜åœ°å€ä¸º 2^64 - 1 æŒ‡é’ˆ æŒ‡é’ˆå°±æ˜¯åœ°å€ï¼Œåœ°å€å°±æ˜¯æŒ‡é’ˆ å³ * = &amp;ï¼ŒæŒ‡é’ˆå˜é‡ æ˜¯å­˜æ”¾ å†…å­˜å•å…ƒåœ°å€ çš„å˜é‡ï¼Œå®ƒå†…éƒ¨ä¿å­˜çš„å€¼æ˜¯å¯¹åº”çš„ åœ°å€ï¼Œ åœ°å€å°±æ˜¯å†…å­˜å•å…ƒç¼–å·ã€‚ ä¾‹å­ï¼š 123456int i = 10; // å®šä¹‰ä¸€ä¸ª æ•´å½¢å˜é‡ i åˆå§‹å€¼ 10int *p = i; // å®šä¹‰ä¸€ä¸ª æ•´å½¢çš„æŒ‡é’ˆå˜é‡pï¼Œå˜é‡p æŒ‡å‘ içš„åœ°å€// è¿™ä¸¤è¡Œç­‰äºä¸Šé¢ä¸¤è¡Œint *p; *p = &amp;i; ç»“æ„ä½“ç»“æ„ä½“æ˜¯ç”¨æˆ·æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦ï¼Œè‡ªå®šä¹‰çš„å¤åˆæ•°æ®ç±»å‹ 12345678910// å­¦ç”Ÿç±»å‹typedef struct Student &#123; // ç»“æ„ä½“å®šä¹‰ int age; char *name;&#125;myStudent;// ç›´æ¥ä¼ é€’ åªå ç”¨ 4 byte çš„æŒ‡é’ˆï¼Œçœæ—¶æ•ˆç‡ä¹Ÿé«˜&lt;æ¨èç”¨æ³•&gt;void func(struct Student *p)&#123; print(&quot;age = %d&quot;,p)&#125; æœ‰ä¸¤ç§ç»“æ„ä½“çš„ä½¿ç”¨æ–¹å¼ï¼š ç›´æ¥ä½¿ç”¨ 1struct Student stu = &#123;12,&quot;xiaojian&quot;&#125;; é€šè¿‡æŒ‡é’ˆä½¿ç”¨ 12struct Student *p = &amp;stu;p -&gt; age = 31;","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.bboyzj.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"OC-æ•°æ®ç»“æ„æ¢ç´¢ç¯‡","slug":"OC-æ•°æ®ç»“æ„æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.bboyzj.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"Python3å­¦ä¹ 02ï¼šè¿è¡ŒPythonæ–¹å¼","slug":"Pythonå­¦ä¹ /Python3å­¦ä¹ 02ï¼šè¿è¡ŒPythonæ–¹å¼","date":"2022-07-22T07:43:10.000Z","updated":"2023-03-08T23:05:19.236Z","comments":true,"path":"2022/07/22/Pythonå­¦ä¹ /Python3å­¦ä¹ 02ï¼šè¿è¡ŒPythonæ–¹å¼/","link":"","permalink":"https://www.bboyzj.cn/2022/07/22/Python%E5%AD%A6%E4%B9%A0/Python3%E5%AD%A6%E4%B9%A002%EF%BC%9A%E8%BF%90%E8%A1%8CPython%E6%96%B9%E5%BC%8F/","excerpt":"","text":"å‰è¨€è¿è¡Œ Python æœ‰ä¸‰ç§æ–¹å¼ï¼š 1ã€äº¤äº’å¼è§£æå™¨ 1$ python # Unix/Linux 2ã€å‘½ä»¤è¡Œè„šæœ¬ 1$ python script.py # Unix/Linux æ³¨ï¼šåœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œè¯·æ£€æŸ¥è„šæœ¬æ˜¯å¦æœ‰å¯æ‰§è¡Œæƒé™ 3ã€é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼šIntegrated Development Environmentï¼‰: PyCharmï¼‰ PyCharm æ˜¯ç”± JetBrains æ‰“é€ çš„ä¸€æ¬¾ Python IDEï¼Œæ”¯æŒ macOSã€ Windowsã€ Linux ç³»ç»Ÿã€‚ PyCharm åŠŸèƒ½ : è°ƒè¯•ã€è¯­æ³•é«˜äº®ã€Projectç®¡ç†ã€ä»£ç è·³è½¬ã€æ™ºèƒ½æç¤ºã€è‡ªåŠ¨å®Œæˆã€å•å…ƒæµ‹è¯•ã€ç‰ˆæœ¬æ§åˆ¶ç­‰ PyCharm ä¸‹è½½åœ°å€ : https://www.jetbrains.com/pycharm/download/ PyCharm å®‰è£…æ•™ç¨‹åœ°å€ : https://www.w3cschool.cn/python3/python3-l4i738c3.html Python IDE å®‰è£…æ•™ç¨‹åœ°å€ï¼šhttps://www.w3cschool.cn/python/python-ide.html","categories":[{"name":"Python","slug":"Python","permalink":"https://www.bboyzj.cn/categories/Python/"}],"tags":[{"name":"Python-å­¦ä¹ ","slug":"Python-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/Python-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"Python","slug":"Python","permalink":"https://www.bboyzj.cn/categories/Python/"}]},{"title":"Python3å­¦ä¹ 01ï¼šMacå®‰è£…Python3","slug":"Pythonå­¦ä¹ /Python3å­¦ä¹ 01ï¼šMacå®‰è£…Python3","date":"2022-07-22T06:50:53.000Z","updated":"2023-03-08T23:05:08.788Z","comments":true,"path":"2022/07/22/Pythonå­¦ä¹ /Python3å­¦ä¹ 01ï¼šMacå®‰è£…Python3/","link":"","permalink":"https://www.bboyzj.cn/2022/07/22/Python%E5%AD%A6%E4%B9%A0/Python3%E5%AD%A6%E4%B9%A001%EF%BC%9AMac%E5%AE%89%E8%A3%85Python3/","excerpt":"","text":"ä¸‹è½½å®‰è£…åŒ…æ‰“å¼€ pythonå®˜ç½‘ ï¼Œé€‰æ‹©ä¸‹é¢ç¨³å®šç‰ˆæœ¬çš„æœ€æ–°çš„åŒ…è¿›è¡Œä¸‹è½½å®‰è£… å®‰è£… Python3æŒ‰ç…§å®‰è£…çš„æç¤ºï¼Œä¸€ç›´ä¸‹ä¸€æ­¥å³å¯ å®‰è£…é…ç½® pipä»€ä¹ˆæ˜¯ pipï¼Ÿ pip è¿™ä¸ªåŒ…æ˜¯ python å¼ºå¤§çš„æ¨¡ç»„ä¸‹è½½å¿…å¤‡å·¥å…·åŒ… æ‰“å¼€ç»ˆç«¯è¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š 1% curl https://bootstrap.pypa.io/get-pip.py | python3 å®‰è£…æˆåŠŸåï¼Œå¦‚ä¸‹ï¼š Python3 ç¯å¢ƒå˜é‡é…ç½®æƒ³è®©Mac OSç³»ç»Ÿå†…é»˜è®¤çš„ python ç‰ˆæœ¬ä¸ºæ–°å®‰è£…çš„ python 3.10ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œé…ç½®ï¼š 1ã€ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 12% which Python3/Library/Frameworks/Python.framework/Versions/3.10/bin/Python3 ç„¶åæŠŠç¬¬äºŒè¡Œçš„è·¯å¾„å¤åˆ¶ä¸‹æ¥ï¼Œä¿å­˜åˆ°ä¸€ä¸ªåœ°æ–¹ 2ã€åœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š 1% vim ~/.bash_profile æ•²å‡»é”®ç›˜ä¸Šçš„ i æŒ‰é”®ï¼Œè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œç•Œé¢æœ€å·¦ä¸‹æ–¹å‡ºç° INSERT å‡ ä¸ªå­—æ¯ 3ã€ä½¿ç”¨é”®ç›˜ä¸Šçš„æ–¹å‘é”®ï¼Œå°†ç™½è‰²çš„å…‰æ ‡ç§»åŠ¨åˆ°éšä¾¿ä¸€ä¸ªç©ºç™½è¡Œï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 12345# Setting PATH for Python 3.10 ï¼ˆè¿™ä¸¤è¡Œåº”è¯¥æ˜¯æ³¨é‡Šï¼Œä½†æ˜¯æœ¬å°ç™½ä¸æ•¢åˆ ï¼‰# The original version is saved in .bash_profile.pysave ï¼ˆè¿™ä¸¤è¡Œåº”è¯¥æ˜¯æ³¨é‡Šï¼Œä½†æ˜¯æœ¬å°ç™½ä¸æ•¢åˆ ï¼‰PATH=&quot;/Library/Frameworks/Python.framework/Versions/3.10/bin:$&#123;PATH&#125;&quot;export PATHalias python=&quot;/Library/Frameworks/Python.framework/Versions/3.10/bin/python3&quot; å¼•å·é‡Œé¢çš„è·¯å¾„æ˜¯åˆšæ‰æ‰§è¡Œ æ­¥éª¤ 1 ä¿å­˜ä¸‹æ¥çš„è·¯å¾„ï¼Œç„¶å PATH= åé¢çš„å‘½ä»¤ï¼Œè¯·åŠ¡å¿…æŒ‰ç…§ä»¥ä¸Šçš„æ ¼å¼åˆ å‡å‡ ä¸ªå­—æ¯ï¼Œåªä¿ç•™åˆ° bin ï¼ˆçœ‹æ¸…æ¥šå•Šï¼Œåé¢æ²¡æœ‰æ–œæ ï¼‰å°±å¯ä»¥ï¼ï¼ï¼ 4ã€ä¿å­˜é€€å‡º è¾“å…¥ç»“æŸåæ•²å‡»é”®ç›˜å·¦ä¸Šè§’çš„ ESC æŒ‰é”®ï¼ŒINSERT æ¶ˆå¤±ï¼Œæ­¤æ—¶ï¼ŒæŒ‰ä½ shift + ï¼šé”®ï¼Œæ¥ç€è¾“å…¥ wq å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç„¶åæ•²å‡» å›è½¦é”® é¡µé¢ä¼šè‡ªåŠ¨å…³é—­ã€‚ 5ã€è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ 1% source ~/.bash_profile æ˜¾ç¤ºè¿›ç¨‹å®Œæˆå³å¯ 6ã€è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ 1% vim ~/.zshrc è¾“å…¥æ­¥éª¤3ä¸­çš„å†…å®¹ï¼Œæ“ä½œç±»ä¼¼ 7ã€å…³é—­ç»ˆç«¯é¡µé¢ï¼Œé‡æ–°æ‰“å¼€ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤ 1% python å‡ºç°ä¸‹é¢çš„å†…å®¹å³é…ç½®ç¯å¢ƒå˜é‡æˆåŠŸ","categories":[{"name":"Python","slug":"Python","permalink":"https://www.bboyzj.cn/categories/Python/"}],"tags":[{"name":"Python-å­¦ä¹ ","slug":"Python-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/Python-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"Python","slug":"Python","permalink":"https://www.bboyzj.cn/categories/Python/"}]},{"title":"OCé€†å‘05ï¼šæ±‡ç¼–æ€»ç»“","slug":"OCé€†å‘/OCé€†å‘05ï¼šæ±‡ç¼–æ€»ç»“","date":"2022-04-20T07:53:47.000Z","updated":"2022-04-21T05:27:51.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘05ï¼šæ±‡ç¼–æ€»ç»“/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9105%EF%BC%9A%E6%B1%87%E7%BC%96%E6%80%BB%E7%BB%93/","excerpt":"","text":"","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘04ï¼šOCåæ±‡ç¼–ï¼ˆä¸‹ï¼‰","slug":"OCé€†å‘/OCé€†å‘04ï¼šOCåæ±‡ç¼–ï¼ˆä¸‹ï¼‰","date":"2022-04-20T07:53:33.000Z","updated":"2022-04-21T05:27:47.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘04ï¼šOCåæ±‡ç¼–ï¼ˆä¸‹ï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9104%EF%BC%9AOC%E5%8F%8D%E6%B1%87%E7%BC%96%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘04ï¼šOCåæ±‡ç¼–ï¼ˆä¸Šï¼‰","slug":"OCé€†å‘/OCé€†å‘04ï¼šOCåæ±‡ç¼–ï¼ˆä¸Šï¼‰","date":"2022-04-20T07:53:16.000Z","updated":"2022-04-21T05:27:41.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘04ï¼šOCåæ±‡ç¼–ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9104%EF%BC%9AOC%E5%8F%8D%E6%B1%87%E7%BC%96%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘03ï¼šå¾ªç¯é€‰æ‹©æŒ‡é’ˆï¼ˆä¸‹ï¼‰","slug":"OCé€†å‘/OCé€†å‘03ï¼šå¾ªç¯é€‰æ‹©æŒ‡é’ˆï¼ˆä¸‹ï¼‰","date":"2022-04-20T07:52:26.000Z","updated":"2022-04-21T05:27:14.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘03ï¼šå¾ªç¯é€‰æ‹©æŒ‡é’ˆï¼ˆä¸‹ï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9103%EF%BC%9A%E5%BE%AA%E7%8E%AF%E9%80%89%E6%8B%A9%E6%8C%87%E9%92%88%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘03ï¼šå¾ªç¯é€‰æ‹©æŒ‡é’ˆï¼ˆä¸Šï¼‰","slug":"OCé€†å‘/OCé€†å‘03ï¼šå¾ªç¯é€‰æ‹©æŒ‡é’ˆï¼ˆä¸Šï¼‰","date":"2022-04-20T07:52:08.000Z","updated":"2022-04-21T05:27:33.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘03ï¼šå¾ªç¯é€‰æ‹©æŒ‡é’ˆï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9103%EF%BC%9A%E5%BE%AA%E7%8E%AF%E9%80%89%E6%8B%A9%E6%8C%87%E9%92%88%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘02ï¼šå‡½æ•°æœ¬è´¨ï¼ˆä¸‹ï¼‰","slug":"OCé€†å‘/OCé€†å‘02ï¼šå‡½æ•°æœ¬è´¨ï¼ˆä¸‹ï¼‰","date":"2022-04-20T07:51:43.000Z","updated":"2022-05-06T03:37:14.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘02ï¼šå‡½æ•°æœ¬è´¨ï¼ˆä¸‹ï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9102%EF%BC%9A%E5%87%BD%E6%95%B0%E6%9C%AC%E8%B4%A8%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦æ˜¯è®²è§£å‡½æ•°çš„ å‚æ•°ã€è¿”å›å€¼ã€å±€éƒ¨å˜é‡ åœ¨æ±‡ç¼–ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œä»¥åŠ CPSR æ ‡å¿—å¯„å­˜å™¨ å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ arm64ä¸‹ï¼Œå‡½æ•°çš„ å‚æ•° æ˜¯å­˜æ”¾åœ¨ x0-x7ï¼ˆw0-w7ï¼‰ è¿™8ä¸ªå¯„å­˜å™¨é‡Œé¢çš„ï¼Œå¦‚æœè¶…è¿‡ 8 ä¸ªå‚æ•°ï¼Œå°±ä¼šå…¥æ ˆ å¦‚æœè‡ªå®šä¹‰å‡½æ•°æ—¶ï¼Œå‚æ•°æœ€å¥½ä¸è¦è¶…è¿‡6ä¸ªï¼ˆå› ä¸ºæœ‰ä¸¤ä¸ªéšè—å‚æ•° self,_cmdï¼‰ å¦‚æœå‡½æ•°éœ€è¦å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥ä¼ å…¥æ•°ç»„ã€ç»“æ„ä½“ã€æŒ‡é’ˆç­‰ç±»å‹ å‡½æ•°çš„ è¿”å›å€¼ æ”¾åœ¨ x0å¯„å­˜å™¨ ä¸­ å¦‚æœè¿”å›å€¼ å¤§äº8ä¸ª å­—èŠ‚ï¼Œå°±ä¼š åˆ©ç”¨å†…å­˜ä¼ é€’ æŸ¥çœ‹ç³»ç»Ÿçš„å‚æ•°æ±‡ç¼–ä¸‹é¢é€šè¿‡ç³»ç»Ÿä¸­å¯¹å‡½æ•°çš„æ±‡ç¼–æ¥æŸ¥çœ‹ç³»ç»Ÿå¯¹å‚æ•°ã€è¿”å›å€¼æ˜¯å¦‚ä½•æ“ä½œçš„ 1234567int sum(int a, int b)&#123; return a + b;&#125;- (void)viewDidLoad&#123; [super viewDidLoad]; sum(10, 20);&#125; æŸ¥çœ‹æ±‡ç¼–ï¼Œåœ¨è·³è½¬åˆ°sumå‡½æ•°ä¹‹å‰ï¼Œå·²ç»å°†å‚æ•°å­˜å…¥ w0ã€w1 åœ¨sumå‡½æ•°ä¸­ï¼Œè¯»å–w0ã€w1ï¼Œæ”¾å…¥w8ã€w9ã€‚ç„¶åå°†ç›¸åŠ åçš„ç»“æœæ”¾å…¥w0ï¼ˆå³è¿”å›å€¼åœ¨w0å¯„å­˜å™¨ï¼‰ è‡ªå·±ä¼˜åŒ–å®ç°sumè¿è¡Œå‘ç°ï¼Œå…¶ç»“æœä¸sumå‡½æ•°æ˜¯ä¸€è‡´çš„ï¼Œç»“æœéƒ½æ˜¯30 1234567891011121314151617&lt;!--asm.s--&gt;.text.global _suma_suma: add x0, x0, x1 ret &lt;!--è°ƒç”¨--&gt;int suma();- (void)viewDidLoad&#123; [super viewDidLoad]; printf(&quot;%d&quot;,suma(10, 20));&#125;&lt;!--æŸ¥çœ‹æ‰“å°ç»“æœ--&gt;30 ç¼–è¯‘å™¨ä¼˜åŒ–æ¥çœ‹ä¸€ä¸‹ä»£ç çš„æ±‡ç¼– 12345678int test(int a, int b, int c, int d, int e, int f, int g, int h, int i)&#123; return a + b + c + d + e + f + g + h + i;&#125;- (void)viewDidLoad &#123; [super viewDidLoad]; test(1, 2, 3, 4, 5, 6, 7, 8, 9);&#125; testå‡½æ•°æ–­ä½ï¼ŒæŸ¥çœ‹æ±‡ç¼– ä»¥ä¸‹æ˜¯ viewDidLoad æ ˆç©ºé—´çš„å­˜å…¥åˆ†æè¿‡ç¨‹ ä»¥ä¸‹æ˜¯ test å‡½æ•°çš„æ±‡ç¼–åˆ†æ ç¼–è¯‘å™¨ä¼˜åŒ– å°†debugæ¨¡å¼æ”¹æˆreleaseæ¨¡å¼ï¼Œæ­¤æ—¶å†æ¥æŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼Œå‘ç°æ²¡æœ‰testå‡½æ•°ï¼Œè¢«ä¼˜åŒ–æ‰äº† å¦‚æœéè¦æ‰§è¡Œ testï¼Œå¯ä»¥è¿™æ ·å†™ 1234- (void)viewDidLoad&#123; [super viewDidLoad]; printf(&quot;%d&quot;, test(1, 2, 3, 4, 5, 6, 7, 8, 9));&#125; æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼Œå‘ç°ä¼˜åŒ–åçš„testå‡½æ•°åœ¨æ±‡ç¼–ä¸­ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ª æ•°ï¼Œä¹Ÿå°±æ˜¯ testå‡½æ•°çš„è¿”å›å€¼ï¼ˆç›¸å½“äºå°† printf(&quot;%d&quot;, test(1, 2, 3, 4, 5, 6, 7, 8, 9)); ç›´æ¥ä¼˜åŒ–æˆäº† printf(&quot;%d&quot;, 45);) é€šè¿‡æ±‡ç¼–å®ç°å‡½æ•° å®šä¹‰å‡½æ•°å£°æ˜åŠè°ƒç”¨ 1234567int funcA(int a, int b);- (void)viewDidLoad &#123; [super viewDidLoad]; int a = funcA(10, 20); printf(&quot;%d&quot;, a);&#125; æ±‡ç¼–å®ç° funcA 12345678910111213141516171819202122&lt;!--samä¸­--&gt;.text.global _funcA, _sum_funcA: sub sp, sp, #0x10 stp x29, x30, [sp] // ä¿æŠ¤lr bl _sum ldp x29, x30, [sp] add sp, sp, #0x10 ret_sum: add x0, x0, x1 ret&lt;!--vcä¸­--&gt;int funcA();- (void)viewDidLoad&#123; [super viewDidLoad]; printf(&quot;%d&quot;,funcA(10,20));&#125; è¿è¡Œç»“æœå¦‚ä¸‹ 130 ã€è¯´æ˜ã€‘ï¼š å…³äºbæŒ‡ä»¤ï¼šåªæ˜¯è·³è½¬ï¼Œä¸æ”¹å˜lrå¯„å­˜å™¨ æ‹‰ä¼¸ç©ºé—´å’Œå‚æ•°ä¸ªæ•°æœ‰æ²¡æœ‰å…³ç³»ï¼Ÿ æœ‰å…³ç³»ï¼Œå‚æ•°è¶Šå¤šæ—¶ï¼Œå¦‚æœå¯„å­˜å™¨æ”¾ä¸ä¸‹ï¼Œå°±éœ€è¦ç”¨åˆ°å†…å­˜ã€‚å°±ä¼šå°†æ ˆç©ºé—´æ”¾å¤§ï¼Œå½±å“æ ˆç©ºé—´çš„ä¸ä»…ä»…æ˜¯å‚æ•°ä¸ªæ•°ï¼Œè¿˜æœ‰å±€éƒ¨å˜é‡ å‡½æ•°çš„è¿”å›å€¼å¦‚æœè¿”å›å€¼æ˜¯ ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸€ä¸ªå¯„å­˜å™¨æ”¾ä¸ä¸‹ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ æœ‰ä»¥ä¸‹ä»£ç ï¼Œè¿è¡ŒæŸ¥çœ‹å…¶æ±‡ç¼–ï¼š 123456789101112131415161718192021222324struct str &#123; int a; int b; int c; int d; int f; int g;&#125;;struct Str getStr(int a, int b, int c, int d, int f, int g)&#123; struct Str str1; str1.a = a; str1.b = b; str1.c = c; str1.d = d; str1.f = f; str1.g = g; return str1;&#125;- (void)viewDidLoad &#123; [super viewDidLoad]; struct Str str2 = getStr(1, 2, 3, 4, 5, 6);&#125; æ–­ç‚¹è¿è¡Œï¼Œä»¥ä¸‹æ˜¯ viewDidLoad å‡½æ•°çš„æ±‡ç¼–","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘02ï¼šå‡½æ•°æœ¬è´¨ï¼ˆä¸Šï¼‰","slug":"OCé€†å‘/OCé€†å‘02ï¼šå‡½æ•°æœ¬è´¨ï¼ˆä¸Šï¼‰","date":"2022-04-20T07:51:12.000Z","updated":"2022-04-29T08:15:49.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘02ï¼šå‡½æ•°æœ¬è´¨ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9102%EF%BC%9A%E5%87%BD%E6%95%B0%E6%9C%AC%E8%B4%A8%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"å‰è¨€æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ç†è§£ å‡½æ•°æ ˆ ä»¥åŠæ¶‰åŠçš„ç›¸å…³ æŒ‡ä»¤ åœ¨è®²å‡½æ•°çš„æœ¬è´¨ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦è®²ä¸‹ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µ æ ˆã€SPã€FP å¸¸è¯†æ ˆ æ ˆï¼šæ˜¯ä¸€ç§ å…·æœ‰ç‰¹æ®Šçš„è®¿é—®æ–¹å¼çš„å­˜å‚¨ç©ºé—´ï¼ˆå³ åè¿›å…ˆå‡º Last In First Outï¼ŒLIFOï¼‰ é«˜åœ°å€å¾€ä½åœ°å€å­˜æ•°æ®ï¼ˆå­˜ï¼šé«˜--&gt;ä½ï¼‰ æ ˆç©ºé—´å¼€è¾Ÿï¼šå¾€ä½åœ°å€å¼€è¾Ÿï¼ˆå¼€è¾Ÿï¼šé«˜--&gt;ä½ï¼‰ SPå’ŒFPå¯„å­˜å™¨ SPå¯„å­˜å™¨ï¼šåœ¨ä»»æ„æ—¶åˆ»ä¼š ä¿å­˜æˆ‘ä»¬æ ˆé¡¶çš„åœ°å€ FPå¯„å­˜å™¨ï¼ˆä¹Ÿç§°ä¸º x29 å¯„å­˜å™¨ï¼‰ï¼šå±äºé€šç”¨å¯„å­˜å™¨ï¼Œä½†æ˜¯åœ¨æŸäº›æ—¶åˆ»ï¼ˆä¾‹å¦‚å‡½æ•°åµŒå¥—è°ƒç”¨æ—¶ï¼‰å¯ä»¥ åˆ©ç”¨å®ƒä¿å­˜æ ˆåº•çš„åœ°å€ 1234æ³¨æ„ï¼š* arm64å¼€å§‹ï¼Œå–æ¶ˆäº†32ä½çš„LDMã€STMã€PUSHã€POPæŒ‡ä»¤ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ldr/ldpã€str/stpï¼ˆrå’Œpçš„åŒºåˆ«åœ¨äºå¤„ç†çš„å¯„å­˜å™¨ä¸ªæ•°ï¼Œrè¡¨ç¤ºå¤„ç†1ä¸ªå¯„å­˜å™¨ï¼Œpè¡¨ç¤ºå¤„ç†ä¸¤ä¸ªå¯„å­˜å™¨ï¼‰* arm64ä¸­ï¼Œå¯¹æ ˆçš„æ“ä½œæ˜¯ 16å­—èŠ‚å¯¹é½ çš„ ä»¥ä¸‹æ˜¯arm64ä¹‹å‰å’Œarm64ä¹‹åçš„ä¸€ä¸ªå¯¹æ¯” åœ¨arm64ä¹‹å‰ï¼Œæ ˆé¡¶æŒ‡é’ˆæ˜¯å‹æ ˆæ—¶ä¸€ä¸ªæ•°æ®ç§»åŠ¨ä¸€ä¸ªå•å…ƒ åœ¨arm64å¼€å§‹ï¼Œé¦–å…ˆæ˜¯ ä»é«˜åœ°å€å¾€ä½åœ°å€å¼€è¾Ÿä¸€æ®µç©ºé—´ï¼ˆç”±ç¼–è¯‘å™¨å†³å®šï¼‰ï¼Œç„¶åå†æ”¾å…¥æ•°æ®ï¼Œæ‰€ä»¥ä¸å­˜åœ¨pushã€popæ“ä½œã€‚è¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡å†…å­˜è¯»å†™æŒ‡ä»¤ï¼ˆldr/ldpã€str/stpï¼‰å¯¹å…¶è¿›è¡Œæ“ä½œ å‡½æ•°è°ƒç”¨æ ˆä»¥ä¸‹æ˜¯å¸¸è§çš„å‡½æ•°è°ƒç”¨ å¼€è¾Ÿï¼ˆsubï¼‰ ä»¥åŠ æ¢å¤æ ˆç©ºé—´ï¼ˆaddï¼‰ çš„æ±‡ç¼–ä»£ç  123456789// å¼€è¾Ÿæ ˆç©ºé—´sub sp, sp, #0x40 ; æ‹‰ä¼¸ï¼ˆå¼€è¾Ÿï¼‰0x40ï¼ˆ64å­—èŠ‚ï¼‰ç©ºé—´stp x29, x30, [sp, #0x30] ; x29\\x30 å¯„å­˜å™¨å…¥æ ˆä¿æŠ¤add x29, sp, #0x30 ; x29æŒ‡å‘æ ˆå¸§çš„åº•éƒ¨... ldp x29, x30, [sp, #0x30] ; æ¢å¤x29/x30 å¯„å­˜å™¨çš„å€¼// æ¢å¤æ ˆç©ºé—´add sp, sp, #0x40 ; æ ˆå¹³è¡¡ret å†…å­˜è¯»å†™æŒ‡ä»¤æ³¨æ„ï¼š è¯»/å†™æ•°æ® éƒ½æ˜¯å¾€ é«˜åœ°å€ è¯»/å†™ å†™æ•°æ®ï¼šå…ˆæ‹‰ä¼¸æ ˆç©ºé—´ï¼Œåœ¨æ‹¿spè¿›è¡Œå†™æ•°æ®ï¼Œå³ å…ˆç”³è¯·ç©ºé—´å†å†™æ•°æ® strï¼ˆstore registerï¼‰æŒ‡ä»¤ï¼š å°†æ•°æ®ä»å¯„å­˜å™¨ä¸­è¯»å‡ºæ¥ï¼Œå­˜åˆ° å†…å­˜ ä¸­ï¼ˆå³ä¸€ä¸ªå¯„å­˜å™¨æ˜¯ 8å­—èŠ‚=64ä½ï¼‰ ldrï¼ˆload registerï¼‰æŒ‡ä»¤ï¼š å°†æ•°æ®ä»å†…å­˜ä¸­è¯»å‡ºæ¥ï¼Œå­˜åˆ° å¯„å­˜å™¨ ä¸­ æ­¤æ—¶ ldr å’Œ str çš„å˜ç§ ldpå’Œstp è¿˜å¯ä»¥æ“ä½œ 2ä¸ª å¯„å­˜å™¨ï¼ˆå³ 16å­—èŠ‚=128ä½ï¼‰ å †æ ˆç»ƒä¹ ä½¿ç”¨32ä¸ªå­—èŠ‚ç©ºé—´ä½œä¸ºè¿™æ®µç¨‹åºçš„æ ˆç©ºé—´ï¼Œç„¶ååˆ©ç”¨æ ˆå°†x0å’Œx1çš„å€¼è¿›è¡Œäº¤æ¢ 12345sub sp, sp, #0x20 ;æ‹‰ä¼¸æ ˆç©ºé—´32ä¸ªå­—èŠ‚stp x0, x1, [sp, #0x10] ;spå¾€ä¸ŠåŠ 16ä¸ªå­—èŠ‚ï¼ˆä¸¤ä¸ª8å­—èŠ‚çš„å¯„å­˜å™¨ï¼‰ï¼Œå­˜æ”¾x0å’Œx1ldp x1, x0, [sp, #0x10] ;å°†spåç§»16ä¸ªå­—èŠ‚çš„å€¼ä»å–å‡ºæ¥ï¼Œæ”¾å…¥x1å’Œx0ï¼Œå†…å­˜æ˜¯tempï¼ˆå¯„å­˜å™¨é‡Œé¢çš„å€¼è¿›è¡Œäº¤æ¢äº†ï¼‰add sp, sp, #0x20 ;æ ˆå¹³è¡¡ret ;è¿”å› æ ˆçš„æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è°ƒå¼æŸ¥çœ‹æ ˆ åœ¨ asmæ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š 123456789.text.global _A,_B_B: sub sp, sp, #0x20 stp x0, x1, [sp, #0x10] ldp x1, x0, [sp, #0x10] add sp, sp, #0x20 ret åœ¨ VC ä¸­è°ƒç”¨ 1234567891011121314@interface ViewController ()@end@implementation ViewController// å‡½æ•°çš„å£°æ˜int B();- (void)viewDidLoad &#123; [super viewDidLoad]; B(); &#125; æ–­ç‚¹åˆ° sub sp, sp, #0x20ï¼š è¿›è¡Œè°ƒè¯•ï¼Œå¦‚ä¸‹å›¾ ç”±ä¸Šå›¾å¯çŸ¥ï¼Œspçš„åˆå§‹åœ°å€æ˜¯ 0x000000016f491a80ï¼Œæ­£å¸¸ç”±é«˜åœ°å€å¾€ä½åœ°å€ æ‹‰ä¼¸ï¼ˆå¼€è¾Ÿï¼‰ #0x20ä¸ªåœ°å€åï¼Œspçš„æœ€æ–°åœ°å€ä¸º 0x000000016f491a80 - 0x20 = 0x000000016f491a60 æŒ‰ä½ control Step intoï¼Œå¾€ä¸‹èµ°ä¸€æ­¥æŸ¥çœ‹ç»“æœ æ­¤æ—¶ x0ï¼Œx1 çš„é»˜è®¤åœ°å€å¦‚ä¸‹å›¾ stp x0, x1, [sp, #0x10]ï¼šå°† sp çš„åç§» #0x10 å†™å…¥ x0ï¼Œx1ï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š ldp x1, x0, [sp, #0x10]ï¼šå°† sp çš„å†…å­˜åœ°å€åŠ ä¸Š #0x10ï¼Œè¯»å– x0ï¼Œx1 çš„æ•°æ®å¹¶äº¤æ¢ç»“æœå¦‚ä¸‹ï¼› add sp, sp, #0x20ï¼šèµ°åˆ°æ ˆå¹³è¡¡ï¼Œæœ€åå°† sp æŒ‡é’ˆåœ°å€åŠ ä¸Š #0x20ï¼Œå³ spæ¢å¤äº†ï¼Œæ­¤æ—¶çš„aå’Œbä»ç„¶åœ¨å†…å­˜ä¸­ï¼Œç­‰å¾…ç€ä¸‹ä¸€è½®æ ˆæ‹‰ä¼¸åæ•°æ®çš„å†™å…¥è¦†ç›–ã€‚å¦‚æœæ­¤æ—¶è¯»å–ï¼Œè¯»å–åˆ°çš„æ˜¯åƒåœ¾æ•°æ® å¦‚æœä¸Šé¢é»˜è®¤çš„åœ°å€ä¸æ–¹ä¾¿çœ‹ï¼Œä½ å¯ä»¥é‡å†™ register write x0 0xa å’Œ register write x1 0xb çš„æ¥æ–­ç‚¹è°ƒè¯•ï¼Œå¦‚ä¸‹å›¾ï¼š ç–‘é—®ï¼šæ ˆç©ºé—´ä¸æ–­å¼€è¾Ÿï¼Œæ­»å¾ªç¯ï¼Œä¼šä¸ä¼šå´©æºƒï¼Ÿ åœ¨è¿™é‡Œæˆ‘ä»¬å°†ä¼šå¤„ç†ä¸Šç¯‡ OCé€†å‘01ï¼šåˆå§‹æ±‡ç¼– æ–‡ç« ä¸­æ–‡æœ«é—ç•™çš„é—®é¢˜ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ±‡ç¼–ä»£ç æ¥æ¼”ç¤º 123456789101112131415161718&lt;!--asm.s--&gt;.text.global _B_B: sub sp,sp,#0x20 stp x0,x1,[sp,#0x10] ldp x1,x0,[sp,#0x10];å¯„å­˜å™¨é‡Œé¢çš„å€¼è¿›è¡Œäº¤æ¢ bl _B add sp,sp,#0x20 ret &lt;!--è°ƒç”¨--&gt;int B();int main(int argc, char * argv[]) &#123; B();&#125; è¿è¡Œç»“æœå‘ç°ï¼šæ­»å¾ªç¯ä¼šå´©æºƒï¼Œä¼šå¯¼è‡´ å †æ ˆæº¢å‡º blã€retæŒ‡ä»¤blæ ‡å· bï¼šè½¬åˆ°æ ‡å·å¤„æ‰§è¡ŒæŒ‡ä»¤ï¼ˆå³bï¼‰ å°† ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ æ”¾å…¥é€šç”¨å¯„å­˜å™¨ lrï¼ˆx30ï¼‰ ä¸­ ç­‰åˆ°Bå‡½æ•°retæ—¶ï¼Œé€šè¿‡lrè·å–å›å®¶çš„è·¯ï¼ˆæ³¨ï¼šlrå°±æ˜¯ä¿å­˜å›å®¶çš„è·¯ï¼‰ ret é»˜è®¤ä½¿ç”¨ lr(x30)å¯„å­˜å™¨ çš„å€¼ï¼Œé€šè¿‡åº•å±‚æŒ‡ä»¤æç¤ºCPUæ­¤å¤„ä½œä¸ºä¸‹æ¡æŒ‡ä»¤åœ°å€ arm64å¹³å°çš„ç‰¹è‰²æŒ‡ä»¤ï¼Œå®ƒé¢å‘ç¡¬ä»¶åšäº†ä¼˜åŒ–å¤„ç†çš„ ç»ƒä¹ ä¸‹é¢é€šè¿‡æ±‡ç¼–ä»£ç æ¥æ¼”ç¤º blã€retæŒ‡ä»¤ asmæ–‡ä»¶ä¸‹ä»£ç å¦‚ä¸‹ 123456789101112.text.global _A, _B_A: mov x0, #0xaaaa bl _B mov x0, #0xaaaa ret_B: mov x0, #0xbbbb ret vcä¸­æ‰§è¡Œå¦‚ä¸‹ä»£ç  1234567891011// å‡½æ•°çš„å£°æ˜int A();int B();- (void)viewDidLoad &#123; [super viewDidLoad]; printf(@&quot;A&quot;); A(); printf(@&quot;B&quot;);&#125; æ–­ç‚¹ mov x0ï¼Œ#0xaaaa è¿è¡Œï¼šå‘ç° lr ä¿å­˜äº†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ˜¯ 1f78 å¾€ä¸‹æ‰§è¡Œ bl _B ï¼šæ­¤æ—¶ x0 çš„åœ°å€ä¸º 0xaaaa ç»§ç»­æ‰§è¡Œ bl _Bï¼Œè·³è½¬åˆ° Bï¼Œæ­¤æ—¶çš„ lr ä¼šå˜æˆ A ä¸­ bl çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ 1f20 æ‰§è¡Œå®ŒBä¸­çš„ mov x0, #0xbbbbï¼Œx0 å˜æˆ bbbb æ‰§è¡Œ B ä¸­çš„ retï¼Œlr ä¼šå›åˆ° A ä¸­ 1f20 ç»§ç»­æ‰§è¡Œ A ä¸­çš„ retï¼Œä¼šå†æ¬¡å›åˆ° 1f20 èµ°åˆ°è¿™é‡Œï¼Œå‘ç° æ­»å¾ªç¯äº†ï¼Œä¸»è¦æ˜¯å› ä¸º lr ä¸€ç›´æ˜¯ 1f20ï¼Œret åªä¼šçœ‹ lrã€‚ å…¶ä¸­ pc æ˜¯æŒ‡ æ¥ä¸‹æ¥è¦æ‰§è¡Œçš„å†…å­˜åœ°å€ï¼Œret æ˜¯æŒ‡è®©CPUå°† lr ä½œä¸ºæ¥ä¸‹æ¥æ‰§è¡Œçš„åœ°å€ï¼ˆç›¸å½“äºå°†lrèµ‹å€¼ç»™pcï¼‰ ç–‘é—®1ï¼šæ­¤æ—¶Bå›åˆ°Aæ²¡é—®é¢˜ï¼Œé‚£ä¹ˆAå›åˆ°viewDidLoadæ€ä¹ˆå›äº‹å‘¢ï¼Ÿ éœ€è¦åœ¨Açš„blä¹‹å‰ ä¿æŠ¤lrå¯„å­˜å™¨ ç–‘é—®2ï¼šæ˜¯å¦å¯ä»¥ä¿å­˜åˆ°å…¶ä»–å¯„å­˜å™¨ä¸Šï¼Ÿ ç­”æ¡ˆæ˜¯ ä¸å¯ä»¥ï¼ŒåŸå› æ˜¯ä¸å®‰å…¨ï¼Œå› ä¸ºä½ ä¸ç¡®å®šè¿™ä¸ªå¯„å­˜å™¨ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«åˆ«äººä½¿ç”¨ æ­£ç¡®åšæ³•ï¼šlrä¿å­˜åˆ°æ ˆåŒº ç³»ç»Ÿä¸­å‡½æ•°åµŒå¥—æ˜¯å¦‚ä½•è¿”å›çš„ï¼Ÿ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿæ˜¯å¦‚ä½•æ“ä½œçš„ï¼Œä¾‹å¦‚ï¼šd -&gt; c -&gt; viewDidLoad 123456789101112void d()&#123;&#125;void c()&#123; d(); return;&#125;- (void)viewDidLoad&#123; [super viewDidLoad]; printf(&quot;A&quot;); c(); printf(&quot;B&quot;);&#125; æŸ¥çœ‹æ±‡ç¼–ï¼Œæ–­ç‚¹åœ¨ c() å‡½æ•° stp x29,x30,[sp,#-0x10]ï¼šè¾¹å¼€è¾Ÿæ ˆï¼Œè¾¹å†™å…¥ï¼Œå…¶ä¸­ x29å°±æ˜¯fpï¼ˆæ ˆåº•ï¼‰ï¼Œx30æ˜¯lrï¼Œ! çš„å«ä¹‰æ˜¯ï¼Œå°†[]ä¸­è®¡ç®—çš„ç»“æœç»™spï¼Œå³ sp-=0x10 ldp x29, x30, [sp], #0x10ï¼šè¯»å–spæ‰§è¡Œåœ°å€çš„æ•°æ®ï¼Œæ”¾å…¥x29ã€x30ï¼›[sp], #0x10 è¡¨ç¤º sp=sp+0x10ï¼Œä»¥æ­¤ä¿è¯ æ ˆå¹³è¡¡ ã€ç»“è®ºã€‘ï¼šå½“æœ‰å‡½æ•°åµŒå¥—è°ƒç”¨æ—¶ï¼Œå°†ä¸Šä¸€ä¸ªå‡½æ•°çš„åœ°å€é€šè¿‡ lrï¼ˆå³x30ï¼‰ æ”¾åœ¨æ ˆä¸­ä¿å­˜ï¼Œä¿è¯å¯ä»¥æ‰¾åˆ°å›å®¶çš„è·¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º è‡ªå®šä¹‰æ±‡ç¼–ä»£ç å®Œå–„ï¼š_Aä¸­ä¿å­˜å›å®¶çš„è·¯æ‰€ä»¥æ ¹æ®ç³»ç»Ÿçš„å‡½æ•°åµŒå¥—æ“ä½œï¼Œæœ€ç»ˆåœ¨_Aä¸­å¢åŠ äº†å¦‚ä¸‹æ±‡ç¼–ä»£ç ï¼Œç”¨äºä¿å­˜å›å®¶çš„è·¯ 123456789101112131415161718&lt;!--å¯¼è‡´æ­»å¾ªç¯çš„æ±‡ç¼–ä»£ç --&gt;_A: mov x0. #0xaaaa bl _B mov x0, #0xaaaa ret &lt;!--å¢åŠ lrä¿å­˜ï¼šå¯ä»¥æ‰¾åˆ°å›å®¶çš„è·¯--&gt;_A: sub sp, sp, #0x10 // æ‹‰ä¼¸ str x30, [sp] // å­˜ mov x0, #0xaaaa // ä¿æŠ¤lrå¯„å­˜å™¨ï¼Œå­˜å‚¨åˆ°æ ˆåŒºåŸŸ bl _B mov x0, #0xaaa ldr x30, [sp] // ä¿®æ”¹lrï¼Œç”¨äºAæ‰¾åˆ°å›å®¶çš„è·¯ add sp, sp, #0x10 // æ ˆå¹³è¡¡ ret ä¿®æ”¹_Aã€_Bï¼šæ”¹æˆç®€å†™å½¢å¼ å…¶ä¸­lræ˜¯x30çš„ä¸€ä¸ªåˆ«å 12345678910111213141516171819202122232425262728293031_A: sub sp, sp, #0x10 // æ‹‰ä¼¸ str x30, [sp] // å­˜ mov x0, #0xaaaa // ä¿æŠ¤lrå¯„å­˜å™¨ï¼Œå­˜å‚¨åˆ°æ ˆåŒºåŸŸ bl _B mov x0, #0xaaa ldr x30, [sp] // ä¿®æ”¹lrï¼Œç”¨äºAæ‰¾åˆ°å›å®¶çš„è·¯ add sp, sp, #0x10 // æ ˆå¹³è¡¡ ret_B: mov x0, #0xbbbb ret &lt;!--æ”¹æˆç®€å†™å½¢å¼--&gt;_A: sub sp, sp, #0x10 // æ‹‰ä¼¸ str x30, [sp] // å­˜ mov x0, #0xaaaa // ä¿æŠ¤lrå¯„å­˜å™¨ï¼Œå­˜å‚¨åˆ°æ ˆåŒºåŸŸ bl _B mov x0, #0xaaa // ldr x30, [sp] // ä¿®æ”¹lrï¼Œç”¨äºAæ‰¾åˆ°å›å®¶çš„è·¯ // add sp, sp, #0x10 // æ ˆå¹³è¡¡ ldr x30, [sp], #0x10 // å°†spçš„å€¼è¯»å–å‡ºæ¥ï¼Œç»™åˆ°x30ï¼Œç„¶åsp += 0x10 ret_B: mov x0, #0xbbbb ret ã€æ–­ç‚¹è°ƒè¯•ã€‘: str x30, [sp, #-0x10]ï¼šæŸ¥çœ‹æ­¤æ—¶ spå¯„å­˜å™¨ çš„åœ°å€ sp = 0x000000016b411a80ï¼Œlr çš„åœ°å€ lr = 0x00000001003d9f90 æ‰§è¡Œåˆ° mov x0, #0xaaaaï¼šspå˜äº†ï¼Œlræœªå˜ æ‰§è¡Œ mov x0, #0xaaaaï¼Œx0 ä¸º aaaa æ‰§è¡ŒAä¸­çš„ bl _Bï¼šè·³è½¬åˆ°Bï¼Œæ­¤æ—¶ lr = 0x0000000100929f40ï¼Œx0 å˜æˆ bbbbï¼Œsp = 0x000000016f4d9a70 æ‰§è¡ŒBçš„retï¼šä»Bå›åˆ°Aï¼Œæ­¤æ—¶lrè¿˜æ˜¯ lr = 0x0000000100929f40 æ‰§è¡ŒAä¸­çš„ ldr x30, [sp], #0x10ï¼Œå‘ç°æ­¤æ—¶ lrå˜äº†ä¸º lr = 0x0000000100929f90ï¼Œspä¹Ÿå˜äº†ä¸º sp = 0x000000016f4d9a80ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒAæ‰¾åˆ°äº†å›å®¶çš„è·¯ x30å¯„å­˜å™¨ x30 å¯„å­˜å™¨ å­˜æ”¾ çš„æ˜¯ å‡½æ•°çš„è¿”å›åœ°å€ï¼Œå½“retæŒ‡ä»¤æ‰§è¡Œæ—¶åˆ»ï¼Œä¼šå¯»æ‰¾x30å¯„å­˜å™¨ä¿å­˜çš„åœ°å€å€¼ æ³¨æ„ï¼šåœ¨å‡½æ•°åµŒå¥—è°ƒç”¨æ—¶ï¼Œéœ€è¦å°†x30å…¥æ ˆ lr æ˜¯ x30 çš„åˆ«å sp æ ˆé‡Œé¢çš„æ“ä½œå¿…é¡»æ˜¯ 16å­—èŠ‚å¯¹é½ï¼Œå´©æºƒæ˜¯åœ¨æ ˆçš„æ“ä½œæ—¶æŒ‚çš„ æ€»ç»“ æ ˆï¼šæ˜¯ä¸€ç§å…·æœ‰ç‰¹æ®Šçš„è®¿é—®æ–¹å¼çš„å­˜å‚¨ç©ºé—´ï¼ˆå…ˆè¿›åå‡ºï¼ŒLast In First Outï¼ŒFIFOï¼‰ ARM64é‡Œé¢å¯¹ æ ˆçš„æ“ä½œ æ˜¯ 16å­—èŠ‚å¯¹é½ çš„ SPå’ŒFPå¯„å­˜å™¨ SPå¯„å­˜å™¨åœ¨ä»»æ„æ—¶åˆ»ä¼š ä¿å­˜æ ˆé¡¶çš„åœ°å€ FPå¯„å­˜å™¨ä¹Ÿç§°ä¸º x29å¯„å­˜å™¨ï¼Œå±äº é€šç”¨å¯„å­˜å™¨ï¼Œä½†æ˜¯åœ¨æŸäº›æ—¶åˆ»åˆ©ç”¨å®ƒ ä¿å­˜æ ˆåº•çš„åœ°å€ æ ˆçš„è¯»å†™æŒ‡ä»¤ è¯»ï¼šldrï¼ˆload registerï¼‰æŒ‡ä»¤ LDRã€LDP å†™ï¼šstrï¼ˆstore registerï¼‰æŒ‡ä»¤ STRã€STP æ±‡ç¼–ç»ƒä¹  æŒ‡ä»¤ sub spï¼Œspï¼Œ$0x10ï¼šæ‹‰ä¼¸æ ˆç©ºé—´ 16 å­—èŠ‚ stp x0ï¼Œx1ï¼Œ[sp]ï¼šspæ‰€åœ¨ä½ç½®å­˜æ”¾x0ã€x1 bl æŒ‡ä»¤ è·³è½¬æŒ‡ä»¤ï¼šbl æ ‡å·ï¼Œè¡¨ç¤ºç¨‹åºæ‰§è¡Œåˆ°æ ‡å·å¤„ã€‚å°†ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ä¿å­˜åˆ°lrå¯„å­˜å™¨ B ä»£è¡¨ç€ è·³è½¬ L è¡¨ç¤º lrï¼ˆx30ï¼‰å¯„å­˜å™¨ ret æŒ‡ä»¤ ç±»ä¼¼å‡½æ•°çš„ return è®©CPUæ‰§è¡Œlrå¯„å­˜å™¨æ‰€æŒ‡å‘çš„æŒ‡ä»¤ é¿å…åµŒå¥—å‡½æ•°æ— æ³•å›å»ï¼šéœ€è¦ä¿æŠ¤blï¼ˆå³ lrå¯„å­˜å™¨ï¼Œå­˜æ”¾å›å®¶çš„è·¯ ï¼‰ï¼Œä¿å­˜åœ¨å½“å‰å‡½æ•°è‡ªå·±çš„æ ˆç©ºé—´","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘01ï¼šåˆå§‹æ±‡ç¼–","slug":"OCé€†å‘/OCé€†å‘01ï¼šåˆå§‹æ±‡ç¼–","date":"2022-04-20T07:50:53.000Z","updated":"2022-04-29T01:15:48.000Z","comments":true,"path":"2022/04/20/OCé€†å‘/OCé€†å‘01ï¼šåˆå§‹æ±‡ç¼–/","link":"","permalink":"https://www.bboyzj.cn/2022/04/20/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9101%EF%BC%9A%E5%88%9D%E5%A7%8B%E6%B1%87%E7%BC%96/","excerpt":"","text":"å‰è¨€åœ¨é€†å‘å¼€å‘ä¸­ï¼Œéå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚å°±æ˜¯ é™æ€åˆ†æï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œæ‰‹æœºä¸Šå®‰è£… APP å…¶æœ¬è´¨æ˜¯ä¸€ä¸ª äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºiPhoneæ‰‹æœºæœ¬è´¨ä¸Šæ‰§è¡Œçš„æŒ‡ä»¤æ˜¯äºŒè¿›åˆ¶ï¼Œæ˜¯ç”±æ‰‹æœºä¸Šçš„ CPU æ‰§è¡Œçš„ï¼›è€Œé™æ€åˆ†ææ˜¯å»ºç«‹åœ¨åˆ†æäºŒè¿›åˆ¶ä¸Šé¢çš„ã€‚æ‰€ä»¥åœ¨å­¦ä¹ é€†å‘ä¹‹å‰ï¼Œéœ€è¦æå‰äº†è§£ç›¸å…³çš„æ±‡ç¼–çŸ¥è¯† æ±‡ç¼–è¯­è¨€çš„å‘å±•æœºå™¨è¯­è¨€æ˜¯ç”± 0å’Œ1 ç»„æˆçš„æœºå™¨æŒ‡ä»¤ï¼Œè¡¨ç¤ºç‰¹å®šçš„åŠŸèƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234åŠ ï¼š0100 0000å‡ï¼š0100 1000ä¹˜ï¼š1111 0111 1110 0000é™¤ï¼š1111 0111 1111 0000 æ±‡ç¼–è¯­è¨€ï¼ˆassembly languageï¼‰ç”±äºä½¿ç”¨æœºå™¨è¯­è¨€è¡¨ç¤ºæ—¶ä¸æ–¹ä¾¿è®°å¿†ï¼Œäºæ˜¯å¼€å§‹ä½¿ç”¨ åŠ©è®°ç¬¦ æ¥ä»£æ›¿æœºå™¨è¯­è¨€ï¼Œä¾‹å¦‚ä¸‹é¢ä½¿ç”¨åŠ©è®°ç¬¦è¡¨ç¤ºçš„ åŠ å‡ä¹˜é™¤ 1234åŠ ï¼šINC EAX é€šè¿‡ç¼–è¯‘å™¨ 0100 0000å‡ï¼šDEC EAX é€šè¿‡ç¼–è¯‘å™¨ 0100 1000ä¹˜ï¼šMUL EAX é€šè¿‡ç¼–è¯‘å™¨ 1111 0111 1110 0000é™¤ï¼šDIV EAX é€šè¿‡ç¼–è¯‘å™¨ 1111 0111 1111 0000 é«˜çº§è¯­è¨€ï¼ˆHigh-level programming languageï¼‰åœ¨åæœŸï¼Œä¸ºäº†æ›´åŠ é«˜æ•ˆçš„ç¼–ç¨‹ï¼Œåœ¨æ±‡ç¼–è¯­è¨€çš„åŸºç¡€ä¸Šæœ‰äº†æ›´é«˜çº§çš„è¯­è¨€ï¼Œä¾‹å¦‚ï¼šC/C++/Java/OC/Swift ç­‰ï¼Œè¿™äº›è¯­è¨€æ›´åŠ æ¥è¿‘äººç±»çš„è‡ªç„¶è¯­è¨€ï¼Œä¾‹å¦‚Cè¯­è¨€è¡¨ç¤ºåŠ å‡ä¹˜é™¤ 1234åŠ ï¼šA+B é€šè¿‡ç¼–è¯‘å™¨ 0100 0000å‡ï¼šA-B é€šè¿‡ç¼–è¯‘å™¨ 0100 1000ä¹˜ï¼šA*B é€šè¿‡ç¼–è¯‘å™¨ 1111 0111 1110 0000é™¤ï¼šA/B é€šè¿‡ç¼–è¯‘å™¨ 1111 0111 1111 0000 æœ€ç»ˆçš„ä»£ç åœ¨ç»ˆç«¯è®¾å¤‡ä¸Šæ˜¾ç¤ºçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š ã€è¯´æ˜ã€‘ï¼š æ±‡ç¼–è¯­è¨€ ä¸ æœºå™¨è¯­è¨€ æ˜¯ --å¯¹åº” çš„å…³ç³»ï¼Œæ¯ä¸€æ¡æœºå™¨æŒ‡ä»¤éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ æ±‡ç¼–è¯­è¨€ å¯ä»¥é€šè¿‡ ç¼–è¯‘ å¾—åˆ° æœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ å¯ä»¥é€šè¿‡ åç¼–è¯‘ å¾—åˆ° æ±‡ç¼–è¯­è¨€ é«˜çº§è¯­è¨€ å¯ä»¥é€šè¿‡ ç¼–è¯‘ å¾—åˆ° æ±‡ç¼–è¯­è¨€/æœºå™¨è¯­è¨€ï¼Œä½† æ±‡ç¼–æ±‡æ¼”/æœºå™¨è¯­è¨€ å‡ ä¹ä¸å¯èƒ½è¿˜åŸæˆé«˜çº§è¯­è¨€ ä¸åŒçš„ é«˜çº§è¯­è¨€ å¯ä»¥å¾—åˆ° åŒæ ·çš„ æ±‡ç¼–è¯­è¨€ï¼Œä½†æ˜¯åŒä¸€ä¸ª æ±‡ç¼–è¯­è¨€ æ— æ³•æ¨æ–­å‡ºç”¨ä»€ä¹ˆé«˜çº§è¯­è¨€ ä¸åŒçš„ CPUæ¶æ„ï¼Œè€ŒCPUæ¶æ„å¯¹åº”ä¸åŒçš„ æŒ‡ä»¤é›† æ±‡ç¼–è¯­è¨€çš„ç‰¹ç‚¹æ±‡ç¼–è¯­è¨€ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š å¯ä»¥ ç›´æ¥è®¿é—®ã€æ§åˆ¶ å„ç§ç¡¬ä»¶è®¾å¤‡ï¼Œæ¯”å¦‚ å­˜å‚¨å™¨ã€CPUç­‰ï¼Œèƒ½æœ€å¤§é™åº¦åœ°å‘æŒ¥ç¡¬ä»¶çš„åŠŸèƒ½ èƒ½å¤Ÿä¸å—ç¼–è¯‘å™¨çš„é™åˆ¶ï¼Œå¯¹ç”Ÿæˆçš„äºŒè¿›åˆ¶ä»£ç è¿›è¡Œå®Œå…¨çš„æ§åˆ¶ ç›®æ ‡ä»£ç ç®€çŸ­ï¼Œå ç”¨å†…å­˜å°‘ï¼Œæ‰§è¡Œé€Ÿåº¦å¿« æ±‡ç¼–æŒ‡ä»¤æ˜¯æœºå™¨æŒ‡ä»¤çš„ åŠ©è®°ç¬¦ï¼ŒåŒæœºå™¨æŒ‡ä»¤ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸€ç§CPUéƒ½æœ‰è‡ªå·±çš„æœºå™¨æŒ‡ä»¤&#x2F;æ±‡ç¼–æŒ‡ä»¤é›† çŸ¥è¯†ç‚¹è¿‡å¤šï¼Œè¦æ±‚è¿‡é«˜ï¼Œéœ€è¦å¼€å‘è€…å¯¹CPUç­‰ç¡¬ä»¶ç»“æ„æœ‰æ‰€äº†è§£ï¼Œä¸æ˜“äºç¼–å†™ã€è°ƒå¼ï¼Œä»¥åŠç»´æŠ¤ ä¸åŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚movå’ŒMOVæ˜¯ä¸€æ ·çš„ æ±‡ç¼–è¯­è¨€çš„ç”¨é€”ï¼ˆå“¥ æˆ‘å­¦äº†èƒ½å¹²å•¥ï¼Ÿï¼‰æŒ‰ç†è¯´ï¼Œæ±‡ç¼–è¿™ä¹ˆéš¾ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å­¦å‘¢ï¼Ÿä»¥åŠå­¦äº†èƒ½å¹²ä»€ä¹ˆï¼Ÿ æ±‡ç¼–å­¦ä¹ çš„ç›®çš„ä»»ä½•é«˜çº§è¯­è¨€æœ€ç»ˆéƒ½ä¼šè¢«ç¼–è¯‘æ±‡ç¼–ï¼Œå­¦ä¹ äº†æ±‡ç¼–çš„ç›¸å…³çŸ¥è¯†ï¼Œå¯ä»¥æ›´å¥½çš„æ—¥å¸¸å¼€å‘ï¼Œå­¦ä¹ æ¢ç´¢ä¸­å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„æ’æŸ¥é—®ï¼Œç†è§£åº•å±‚è¿è¡Œçš„æœºåˆ¶ï¼Œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š æ˜¯ç†è§£æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿçš„æœ€ä½³èµ·ç‚¹å’Œæœ€æœ‰æ•ˆé€”å¾„ ä¸ºç¼–å†™é«˜æ•ˆä»£ç æ‰“ä¸‹åŸºç¡€ ç†è§£ä»£ç çš„æœ¬è´¨ï¼Œä¾‹å¦‚ï¼š å‡½æ•°çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ ++aåº•å±‚æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ ç¼–è¯‘å™¨åœ¨åº•å±‚åˆ°åº•å¸®æˆ‘ä»¬åšäº†å“ªäº›å·¥ä½œï¼Ÿ DEBUGæ¨¡å¼å’ŒRELEASEæ¨¡å¼åˆ°åº•æœ‰å“ªäº›åœ°æ–¹æ˜¯ä¸åŒçš„ï¼Ÿä»¥åŠè¢«æˆ‘ä»¬å¿½ç•¥çš„ï¼Ÿ æ±‡ç¼–ä½¿ç”¨çš„åœºæ™¯ å¯ä»¥ ç¼–å†™é©±åŠ¨ç¨‹åºã€æ“ä½œç³»ç»Ÿï¼Œä¾‹å¦‚Linuxå†…æ ¸çš„æŸäº›å…³é”®å­— å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„ç¨‹åºæˆ–ä»£ç ç‰‡æ®µï¼Œå¯ ä¸é«˜çº§è¯­è¨€æ··åˆä½¿ç”¨ï¼ˆç§°ä¸ºå†…è”æ±‡ç¼–ï¼‰ ç”¨äº è½¯ä»¶å®‰å…¨æ–¹é¢ ç—…æ¯’çš„åˆ†æä¸é˜²æ²» é€†å‘ã€åŠ å£³ã€è„±å£³ã€ç ´è§£ã€å¤–æŒ‚ã€å…æ€ã€åŠ è§£å¯†ã€é»‘å®¢ç­‰ æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼Œæ±‡ç¼–æ—¶æ‰€æœ‰ğŸ‘¨ğŸ»â€ğŸ’»éƒ½éœ€è¦äº†è§£çš„ä¸€é—¨éå¸¸é‡è¦çš„è¯­è¨€ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å­¦ç”Ÿä¸­è®¡ç®—æœºç›¸å…³ä¸“ä¸šå­¦ç”Ÿçš„å¿…ä¿®è¯¾ï¼Œå°±å¥½æ¯”ä¿®æˆ¿å­ï¼Œåœ°åŸºç¨³äº†ï¼Œé«˜æ¥¼æ‰èƒ½å¹³åœ°èµ· æ±‡ç¼–è¯­è¨€çš„ç§ç±»ç›®å‰è®¨è®ºæ¯”è¾ƒå¤šçš„æ±‡ç¼–è¯­è¨€æœ‰ï¼š 8086æ±‡ç¼–ï¼ˆ8086å¤„ç†å™¨æ˜¯16bitçš„CPUï¼‰ Win32æ±‡ç¼– Win64æ±‡ç¼– ARMæ±‡ç¼–ï¼ˆåµŒå…¥å¼ã€Macã€iOSï¼‰ â€¦ æˆ‘ä»¬iPhoneé‡Œé¢ç”¨åˆ°çš„æ˜¯ ARMæ±‡ç¼–ï¼Œä½†æ˜¯ä¸åŒçš„è®¾å¤‡ä¹Ÿæœ‰å·®å¼‚ï¼Œå› CPUçš„æ¶æ„ä¸åŒ å¿…å¤‡å¸¸è¯†æƒ³è¦å­¦å¥½æ±‡ç¼–ï¼Œéœ€è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå¸¸è¯†ï¼š 1ã€é¦–å…ˆéœ€è¦äº†è§£CPUç­‰ç¡¬ä»¶çš„æ¶æ„ 2ã€APP&#x2F;ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ å¯æ‰§è¡Œæ–‡ä»¶ï¼šç¨‹åº&#x2F;APPåœ¨æœ¬åœ°ç£ç›˜çš„æ–‡ä»¶ imageï¼ˆé•œåƒæ–‡ä»¶ï¼‰ï¼šå¯æ‰§è¡Œæ–‡ä»¶è¢«è£…è½½åˆ°å†…å­˜çš„æ–‡ä»¶ï¼ˆåœ¨æ—©èµ·ï¼Œå…¶æœ¬è´¨ä¸å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼‰ å†…å­˜ä¸­é™¤äº† æŒ‡ä»¤ï¼Œè¿˜æœ‰ æ•°æ®ï¼Œä½†éƒ½æ˜¯ 0å’Œ1 ç»„åˆï¼ŒCPUæ˜¯å¦‚ä½•åŒºåˆ†çš„ï¼Ÿæ˜¯é€šè¿‡CPUä¸Šçš„éƒ¨ä»¶CPUå¯„å­˜å™¨æ¥åŒºåˆ† 3ã€ç¡¬ä»¶ç›¸å…³æœ€ä¸ºé‡è¦çš„æ˜¯CPU&#x2F;å†…å­˜ 4ã€åœ¨æ±‡ç¼–ä¸­ï¼Œå¤§éƒ¨åˆ†æŒ‡ä»¤éƒ½æ˜¯å’ŒCPUå’Œå†…å­˜ç›¸å…³çš„ æ€»çº¿æ€»çº¿ æ˜¯CPUå’Œå†…å­˜ä¹‹é—´çš„æ¡¥æ¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯iPhoneXä¸Šçš„A11ï¼ˆCPUèŠ¯ç‰‡ï¼‰ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼šæ¯ä¸€ä¸ªCPUèŠ¯ç‰‡éƒ½æœ‰å¾ˆå¤šç®¡è„šï¼Œè¿™äº›ç®¡è„šå’Œæ€»çº¿ç›¸è¿ï¼ŒCPUé€šè¿‡æ€»çº¿è·Ÿå¤–éƒ¨ä»¶è¿›è¡Œäº¤äº’ æ€»çº¿ï¼šæ˜¯ä¸€æ ¹æ ¹å¯¼çº¿çš„é›†åˆ æ€»çº¿çš„åˆ†ç±»æ€»çº¿ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ã€åœ°å€æ€»çº¿ï¼šCPUæ˜¯é€šè¿‡åœ°å€æ€»çº¿æ¥æŒ‡å®šå­˜å‚¨å•å…ƒçš„ 2ã€æ•°æ®æ€»çº¿ï¼šCPUä¸å†…å­˜&#x2F;å…¶ä»–éƒ¨ä»¶ä¹‹é—´çš„æ•°æ®ä¼ é€é€šé“ 3ã€æ§åˆ¶æ€»çº¿ï¼šCPUé€šè¿‡æ§åˆ¶æ€»çº¿å¯¹å¤–éƒ¨å™¨ä»¶è¿›è¡Œæ§åˆ¶ ä¸¾ä¾‹ï¼šCPUä»å†…å­˜çš„3å·å•å…ƒè¯»å–æ•°æ® 1ã€CPUæƒ³æ“ä½œå†…å­˜ä¸­çš„æ•°æ®ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°å†…å­˜åœ°å€ï¼šCPUé€šè¿‡åœ°å€æ€»çº¿ï¼Œå°†3è¿™ä¸ªåœ°å€ä¼ é€’ç»™å†…å­˜ä½ ï¼Œå³å¯»å€åˆ°å†…å­˜çš„3å·å•å…ƒ 2ã€éœ€è¦æ“ä½œ3å·å•å…ƒçš„æ•°æ®ï¼Œè¿˜éœ€è¦ç¡®å®šæ˜¯è¯»è¿˜æ˜¯å†™ï¼šCPUé€šè¿‡æ§åˆ¶æ€»çº¿å‘Šè¯‰å†…å­˜éœ€è¦è¿›è¡Œçš„æ“ä½œï¼Œå‡è®¾æ˜¯è¯» 3ã€å†…å­˜çŸ¥é“äº†CPUæƒ³è¦è¿›è¡Œçš„æ“ä½œï¼šå†…å­˜å°†3å·å•å…ƒçš„æ•°æ®é€šè¿‡æ•°æ®çº¿ä¼ é€’ç»™CPU åœ°å€æ€»çº¿ å®ƒçš„å®½åº¦å†³å®šäº† CPUçš„å¯»å€èƒ½åŠ›ï¼Œå³åœ°å€æ€»çº¿å†³å®šäº†CPUæ‰€èƒ½è®¿é—®çš„æœ€å¤§å†…å­˜ç©ºé—´çš„å¤§å°ï¼Œä¾‹å¦‚ï¼š10æ ¹åœ°å€çº¿ èƒ½è®¿é—®çš„æœ€å¤§å†…å­˜æ˜¯ 2^10 = 1024 ä½äºŒè¿›åˆ¶æ•°æ®ï¼ˆå³ 1KB ï¼‰ åœ°å€æ€»çº¿æ˜¯åœ°å€çº¿æ•°é‡ä¹‹å’Œ 8086 çš„ åœ°å€æ€»çº¿ å®½åº¦æ˜¯ 20ï¼Œæ‰€ä»¥å¯»å€èƒ½åŠ›æ˜¯ 1Mï¼ˆå³2^20ï¼‰ å†…å­˜åœ°å€çš„å•å…ƒæ˜¯ å­—èŠ‚byteï¼ˆç®€å†™Bï¼‰ï¼Œæ¯ä¸ªå­—èŠ‚é‡Œé¢å¯ä»¥æ”¾ 8ä½ï¼ˆå³bitï¼‰ï¼Œä»¥ä¸‹æ˜¯å†…å­˜æ¡çš„å›¾ç¤ºï¼š æ³¨æ„åŒºåˆ† æ•°é‡å•ä½ å’Œ å®¹é‡å•ä½ æ•°é‡å•ä½ï¼š1M = 1024Kï¼Œ1K = 1024 å®¹é‡å•ä½ï¼šå­—èŠ‚byteï¼ˆBï¼‰ 1024B = 1KBï¼Œ1024KB = 1MBï¼ŒIBMé“¶è¡Œçš„ç‹¬ç«‹ç³»ç»Ÿæ˜¯ä»¥2å­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œå¸¸ç”¨çš„ç”µè„‘æ˜¯ä»¥1å­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ ç½‘ç»œå®½å¸¦ 100M=100Mbpsï¼ˆæ¯”ç‰¹ä½ï¼Œæ¯ç§’ä¼ è¾“ 100/8 = 12.5MB/sï¼‰ æ•°æ®æ€»çº¿ å®ƒçš„å®½åº¦å†³å®šäº† CPUçš„å•æ¬¡æ•°æ®ä¼ é€é‡ï¼ˆå³ååé‡ï¼‰ï¼Œä¹Ÿå°±æ˜¯ æ•°æ®ä¼ é€é€Ÿåº¦ å³CPUå’Œå¤–ç•Œæ•°æ®çš„ä¼ é€é€Ÿåº¦ æ¯æ¡æ•°æ®çº¿ä¸€æ¬¡åªèƒ½ä¼ è¾“ä¸€ä½äºŒè¿›åˆ¶æ•°æ®ï¼Œä¾‹å¦‚ï¼š8æ ¹ æ•°æ®çº¿ ä¸€æ¬¡ å¯ä¼ é€ ä¸€ä¸ª8ä½ äºŒè¿›åˆ¶æ•°æ®ï¼ˆå³ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼‰ æ•°æ®æ€»çº¿æ˜¯æ•°æ®çº¿æ•°é‡ä¹‹å’Œ 8086 çš„ æ•°æ®æ€»çº¿ æ€»å®½åº¦æ˜¯ 16ï¼Œæ‰€ä»¥å•æ¬¡æœ€å¤§ä¼ é€ 2ä¸ªå­—èŠ‚ çš„æ•°æ® æˆ‘ä»¬å¸¸è¯´çš„32ä½ï¼ˆ4å­—èŠ‚ï¼‰ã€64ä½ï¼ˆ8å­—èŠ‚ï¼‰CPUï¼Œè¿™é‡Œçš„32ã€64æŒ‡çš„å°±æ˜¯æ•°æ®ååé‡ æ§åˆ¶æ€»çº¿ å®ƒçš„å®½åº¦å†³å®šäº† CPUå¯¹å…¶ä»–å™¨ä»¶çš„æ§åˆ¶èƒ½åŠ›ï¼Œèƒ½æœ‰å¤šå°‘ä¸­æ§åˆ¶ï¼Œå³CPUå¯¹å¤–éƒ¨å™¨ä»¶çš„æ§åˆ¶èƒ½åŠ› æ§åˆ¶æ€»çº¿æ˜¯æ§åˆ¶çº¿æ•°é‡ä¹‹å’Œ å°ç»ƒä¹  ä¸€ä¸ªCPUçš„å¯»å€èƒ½åŠ›ä¸º8KBï¼Œé‚£ä¹ˆå®ƒçš„åœ°å€æ€»çº¿çš„å®½åº¦ä¸º 2^13 ç­”ï¼šæˆ‘ä»¬çŸ¥é“ 10æ ¹ -&gt; 2^0 -&gt; 1KBï¼Œæ‰€ä»¥ï¼Œ8KB -&gt; 2^3 -&gt; 13æ ¹ å†…å­˜ CPUæ˜¯é€šè¿‡ æ€»çº¿ å’Œç¡¬ä»¶è®¾å¤‡è¿æ¥çš„ å†…å­˜æœ‰RAMä¸»å­˜å‚¨å™¨ã€RAMä¸»å­˜å‚¨å™¨ï¼ˆå†…å­˜æ¡ï¼‰ ä¸‹å›¾æ˜¯æŒ‰ç…§ç‰©ç†åœ°å€åˆ’åˆ†çš„å†…å­˜ï¼Œæœ‰ ä¸»å­˜å‚¨å™¨ã€æ˜¾å­˜åœ°å€ã€æ˜¾å¡åœ°å€ã€ç½‘å¡åœ°å€ã€ç³»ç»Ÿåœ°å€ å…¶ä¸­å†…å­˜ä¸­çš„ ä½åœ°å€ æ˜¯ç»™ ç”¨æˆ·ç”¨çš„ï¼Œé«˜åœ°å€ æ˜¯ç»™ ç³»ç»Ÿç”¨çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å†…å­˜åœ°å€ç©ºé—´çš„å¤§å°å—CPUåœ°å€æ€»çº¿å®½åº¦çš„é™åˆ¶ï¼Œ8086çš„åœ°å€æ€»çº¿å®½åº¦ä¸º20ï¼Œå¯ä»¥å®šä½2^20ä¸ªä¸åŒçš„å†…å­˜å•å…ƒï¼ˆå†…å­˜åœ°å€èŒƒå›´0x00000~0xFFFFFï¼‰ï¼Œæ‰€ä»¥8086çš„å†…å­˜ç©ºé—´å¤§å°ä¸º1MB 0x00000~0x9FFFFï¼šä¸»å­˜å‚¨å™¨ï¼Œå¯è¯»å¯å†™ 0xA0000~0xBFFFFï¼šå‘æ˜¾å­˜ä¸­å†™å…¥æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šè¢«æ˜¾å¡è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ï¼Œå¯è¯»å¯å†™ 0xC0000~0xFFFFFï¼šå­˜å‚¨å„ç§ç¡¬ä»¶&#x2F;ç³»ç»Ÿä¿¡æ¯ï¼Œåªè¯» è¿›åˆ¶å¾ˆå¤šäººå­¦ä¸å¥½è¿›åˆ¶ï¼ŒåŸå› æ˜¯æ€»ä»¥åè¿›åˆ¶ä¸ºä¾æ‰˜å»è€ƒè™‘å…¶ä»–è¿›åˆ¶ï¼Œéœ€è¦è¿ç®—çš„æ—¶å€™ä¹Ÿæ€»æ˜¯å…ˆè½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œåœ¨è½¬æ¢ä¸ºå…¶ä»–è¿›åˆ¶ï¼Œå…¶å®è¿™ç§æ–¹å¼æ˜¯é”™çš„ æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸€å®šè¦è½¬æ¢æˆåè¿›åˆ¶å‘¢ï¼Ÿä»…ä»…æ˜¯å› ä¸ºæˆ‘ä»¬å¯¹åè¿›åˆ¶æœ€ç†Ÿæ‚‰ï¼Œæ‰€ä»¥æ‰è½¬æ¢ æ¯ä¸€ç§è¿›åˆ¶éƒ½æ˜¯å®Œç¾çš„ï¼Œæƒ³å­¦å·è¿›åˆ¶é¦–å…ˆè¦å¿˜æ‰åè¿›åˆ¶ï¼Œä¹Ÿè¦å¿˜æ‰è¿›åˆ¶é—´çš„è½¬æ¢ è¿›åˆ¶çš„å®šä¹‰ å…«è¿›åˆ¶ç”±8ä¸ªç¬¦å·ç»„æˆï¼š0 1 2 3 4 5 6 7 é€¢å…«è¿›ä¸€ åè¿›åˆ¶ç”±10ä¸ªç¬¦å·ç»„æˆï¼š0 1 2 3 4 5 6 7 8 9 é€¢åè¿›ä¸€ Nè¿›åˆ¶å°±æ˜¯ç”±Nä¸ªç¬¦å·ç»„æˆï¼šé€¢Nè¿›ä¸€ 123456789&lt;!--ç»ƒä¹ --&gt;1+1åœ¨___æƒ…å†µä¸‹ç­‰äº3&lt;!--ç­”æ¡ˆ--&gt;åè¿›åˆ¶ç”±10ä¸ªç¬¦å·ç»„æˆ: 0 1 3 2 8 A B E S 7 é€¢åè¿›ä¸€å¦‚æœè¿™æ ·å®šä¹‰åè¿›åˆ¶ï¼š1+1ç­‰äº3&lt;!--ç›®çš„--&gt;ä¼ ç»Ÿå®šä¹‰çš„åè¿›åˆ¶å’Œè‡ªå®šä¹‰çš„åè¿›åˆ¶ä¸ä¸€æ ·ï¼Œå¦‚æœä¸å‘Šè¯‰åˆ«äººç¬¦å·è¡¨ï¼Œåˆ«äººæ˜¯æ— æ³•æ‹¿åˆ°å…·ä½“çš„æ•°æ®çš„ã€‚è¿™æ ·çš„åº”ç”¨åœºæ™¯ä¸»è¦æ˜¯ç”¨äºåŠ å¯† è¿›åˆ¶çš„è¿ç®—å…«è¿›åˆ¶å…«è¿›åˆ¶åŠ æ³•è¡¨ 1234567891011120 1 2 3 4 5 6 7 10 11 12 13 14 15 16 1720 21 22 23 24 25 26 27...1+1 = 2 1+2 = 3 2+2 = 4 1+3 = 4 2+3 = 5 3+3 = 61+4 = 5 2+4 = 6 3+4 = 7 4+4 = 10 1+5 = 6 2+5 = 7 3+5 = 10 4+5 = 11 5+5 = 121+6 = 7 2+6 = 10 3+6 = 11 4+6 = 12 5+6 = 13 6+6 =141+7 = 10 2+7 = 11 3+7 = 12 4+7 = 13 5+7 = 14 6+7 =15 7+7 = 16 å…«è¿›åˆ¶ä¹˜æ³•è¡¨ 123456780 1 2 3 4 5 6 7 10 11 12 13 14 15 16 17 20 21 22 23 24 25 26 27...1*1 = 1 1*2 = 2 2*2 = 4 1*3 = 3 2*3 = 6 3*3 = 11 1*4 = 4 2*4 = 10 3*4 = 14 4*4 = 201*5 = 5 2*5 = 12 3*5 = 17 4*5 = 24 5*5 = 311*6 = 6 2*6 = 14 3*6 = 22 4*6 = 30 5*6 = 36 6*6 = 441*7 = 7 2*7 = 16 3*7 = 25 4*7 = 34 5*7 = 43 6*7 = 52 7*7 = 61 åšä¸ªç»ƒä¹  2 + 3 &#x3D; ___ï¼Œ2 * 3 &#x3D; ___ï¼Œ4 + 5 &#x3D; ___ï¼Œ4 * 5 &#x3D; ___ 277 + 333 &#x3D; ___ï¼Œ276 * 54 &#x3D; ___ï¼Œ 237 - 54 &#x3D; ___ ï¼Œ234&#x2F;4 &#x3D; ___ ç¬¬ä¸€æ’çš„è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„å¾—å‡ºç»“è®ºä½†æ˜¯ç¬¬äºŒæ’æ¶‰åŠæ•°æ®è¾ƒå¤§ï¼Œå¦‚ä½•è®¡ç®—å‘¢ï¼Ÿä¸‹é¢ä»¥ 277 + 333 ä¸ºä¾‹ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š 1234å®é™…ä¸Šæ˜¯ä»¥åŠ æ³•è¡¨ä¸ºåŸºæœ¬çš„æ¯ä¸ªä½ç½®ç›¸åŠ  277 æœ€åä¸€ä½ç›¸åŠ  å€’æ•°ç¬¬äºŒä½ç›¸åŠ  ç¬¬ä¸€ä½ç›¸åŠ + 333 -&gt; 7+3=12 -&gt; 7+3=12 -&gt; 2+3=5 -&gt; æ‰€ä»¥æœ€åçš„ç»“æœæ˜¯632 ä¿ç•™2è¿›1 ä¿ç•™2+1=3ï¼Œè¿›1 ä¿ç•™5+1=6 äºŒè¿›åˆ¶äºŒè¿›åˆ¶çš„ç®€å†™å½¢å¼ 12345 äºŒè¿›åˆ¶: 1 0 1 1 1 0 1 1 1 1 0 0ä¸‰ä¸ªäºŒè¿›åˆ¶ä¸€ç»„: 101 110 111 100 å…«è¿›åˆ¶: 5 6 7 4å››ä¸ªäºŒè¿›åˆ¶ä¸€ç»„: 1011 1011 1100 åå…­è¿›åˆ¶: b b c ä½¿ç”¨äºŒè¿›åˆ¶ä»0åˆ°1111ï¼š0000 0001 0010 0011 0100 0101 0110 0111 1000 1001 1010 1011 1100 1101 1110 1111 å‘ç°è¿™æ ·ä½¿ç”¨äºŒè¿›åˆ¶å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥å°†å…¶æ”¹ä¸ºæ›´ç®€å•ä¸€ç‚¹çš„ç¬¦å· 0 1 2 3 4 5 6 7 8 9 A B C D E F è¿™å°±æ˜¯åå…­è¿›åˆ¶äº† æ•°æ®çš„å®½åº¦æ•°å­¦ä¸Šçš„æ•°å­—æ˜¯æ²¡æœ‰å¤§å°é™åˆ¶çš„ï¼Œå¯ä»¥æ— é™å¤§ ä½†æ˜¯åœ¨è®¡ç®—æœºä¸­ï¼Œç”±äºç¡¬ä»¶çš„åˆ¶çº¦ï¼Œæ•°æ®éƒ½æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼ˆç§°ä¸º æ•°æ®å®½åº¦ï¼‰ï¼Œè¶…è¿‡æœ€å¤šå®½åº¦çš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒ 1234567891011121314#import &lt;UIKit/UIKit.h&gt;#import &quot;AppDelegate.h&quot;int test()&#123; int cTemp = 0x1FFFFFFFF; return cTemp;&#125;int main(int argc, char * argv[]) &#123; printf(&quot;%x\\n&quot;,test()); @autoreleasepool &#123; return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); &#125;&#125; æ‰“æ–­ç‚¹åœ¨ int cTemp å¤„å’Œ return cTemp å¤„ï¼Œè°ƒè¯•ç»“æœå‘ç° 0 æº¢å‡ºäº†ï¼š ä¹Ÿå¯ä»¥æ­¤å¤„é€šè¿‡è·å–çš„åœ°å€ï¼Œç„¶ååœ¨ Debug-Debug Workflow-ViewMemory ä¸­è¾“å…¥åœ°å€ï¼ˆ0x000000016d82f70cï¼‰ æŸ¥çœ‹ è®¡ç®—æœºä¸­å¸¸è§çš„æ•°æ®å®½åº¦ ä½ï¼ˆbitï¼‰ï¼š1ä¸ªä½ å°±æ˜¯ 1ä¸ªäºŒè¿›åˆ¶ï¼Œå³ 0æˆ–1 å­—èŠ‚ï¼ˆbyteï¼‰ï¼š1ä¸ªå­—èŠ‚ ç”± 8ä¸ªbit ç»„æˆï¼Œå†…å­˜ä¸­çš„æœ€å°å•å…ƒbyte å­—ï¼ˆWordï¼‰ï¼š1ä¸ªå­— ç”± ä¸¤ä¸ªå­—èŠ‚ ç»„æˆï¼ˆ16ä½ï¼‰ï¼Œç¬¬2ä¸ªå­—èŠ‚åˆ†åˆ«ç§°ä¸º é«˜å­—èŠ‚å’Œä½å­—èŠ‚ åŒå­—ï¼ˆDoubleWorkï¼‰ï¼š1ä¸ªåŒå­—ç”±ä¸¤ä¸ªå­—ç»„æˆï¼ˆ32ä½ï¼‰ é‚£ä¹ˆè®¡ç®—æœºå­˜å‚¨æ•°æ®å®ƒåˆ†ä¸º æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ— ç¬¦å·æ•°ï¼Œç›´æ¥æ¢ç®— æœ‰ç¬¦å·æ•°ï¼Œç¬¦å·æ”¾åœ¨ç¬¬1ä½ï¼Œç¬¬1ä½æ˜¯0å³ æ­£æ•°ï¼Œä¸º1å³ è´Ÿæ•°ï¼š æ­£æ•°ï¼š0 1 2 3 4 5 6 7 è´Ÿæ•°ï¼šF E D C B A 9 8-1 -2 -3 -4 -5 -6 -7 -8 è‡ªå®šä¹‰è¿›åˆ¶ç¬¦å·ã€ç»ƒä¹ 1ã€‘ ç°åœ¨æœ‰10è¿›åˆ¶æ•°10ä¸ªç¬¦å·åˆ†åˆ«ä¸ºï¼š2ï¼Œ9ï¼Œ1ï¼Œ7ï¼Œ6ï¼Œ5ï¼Œ4ï¼Œ8ï¼Œ3ï¼ŒA é€¢10è¿›1ï¼Œé‚£ä¹ˆï¼š 123 + 234 &#x3D; ï¼ˆAA6ï¼‰ 12345678910111213141516171819202122åè¿›åˆ¶: 0 1 2 3 4 5 6 7 8 9è‡ªå®šä¹‰: 2 9 1 7 6 5 4 8 3 A(åè¿›åˆ¶10)92 99 91 97 96 95 94 98 93 9A 12 19 11 17 16 15 14 18 13 1A 72 79 71 77 76 75 74 78 73 7A 62 69 61 67 66 65 64 68 63 6A 52 59 51 57 56 55 54 58 53 5A 42 49 41 47 46 45 44 48 43 4A 82 89 81 87 86 85 84 88 83 8A 32 39 31 37 36 35 34 38 33 3A 922 (00)2 (01)9 (02)1 (03)7 (04)6 (05)5 (06)4 (07)8 (08)3 (09)A(10)92 (11)99 (12)91 (13)97 (14)96 (15)95 (16)94 (17)98 (18)93 (19)9A(20)12 (21)19 (22)11 (23)17 (24)16 (25)15 (26)14 (27)18 (28)13 (29)1A(30)72 (31)79 (32)71 (33)77 (34)76 (35)75 (36)74 (37)78 (38)73 (39)7A(40)62 (41)69 (42)61 (43)67 (44)66 (45)65 (46)64 (47)68 (48)63 (49)6A(50)52 59 51 57 56 55 54 58 53 5A(60)42 49 41 47 46 45 44 48 43 4A(70)82 89 81 87 86 85 84 88 83 8A(80)32 39 31 37 36 35 34 38 33 3A(90)922 åˆšæ‰é€šè¿‡10è¿›åˆ¶è¿ç®—å¯ä»¥è½¬æ¢ï¼Œç„¶åæŸ¥è¡¨ï¼Œä½†æ˜¯å¦‚æœæ˜¯å…¶ä»–è¿›åˆ¶ï¼Œå°±ä¸èƒ½è½¬æ¢ï¼Œè¦å­¦ä¼šç›´æ¥æŸ¥è¡¨ã€‚ ã€ç»ƒä¹ 2ã€‘ ç°åœ¨æœ‰9è¿›åˆ¶æ•°9ä¸ªç¬¦å·ï¼Œåˆ†åˆ«æ˜¯ï¼š2ï¼Œ9ï¼Œ1ï¼Œ7ï¼Œ6ï¼Œ5,4ï¼Œ8ï¼Œ3 é€¢9è¿›1ï¼Œé‚£ä¹ˆï¼š123 + 234 &#x3D; ï¼ˆ9926ï¼‰ 12345678910111213141516171819202122åè¿›åˆ¶: 0 1 2 3 4 5 6 7 8 è‡ªå®šä¹‰: 2 9 1 7 6 5 4 8 3 92 99 91 97 96 95 94 98 93 12 19 11 17 16 15 14 18 13 72 79 71 77 76 75 74 78 73 62 69 61 67 66 65 64 68 63 52 59 51 57 56 55 54 58 53 42 49 41 47 46 45 44 48 43 82 89 81 87 86 85 84 88 83 32 39 31 37 36 35 34 38 33 922 (00)2 (01)9 (02)1 (03)7 (04)6 (05)5 (06)4 (07)8 (08)3 (10)92 (11)99 (12)91 (13)97 (14)96 (15)95 (16)94 (17)98 (18)93 (20)12 19 11 17 16 15 14 18 13 (30)72 79 71 77 76 75 74 78 73 (40)62 69 61 67 66 65 64 68 63 (50)52 59 51 57 56 55 54 58 53 (60)42 49 41 47 46 45 44 48 43 (70)82 89 81 87 86 85 84 88 83 (80)32 39 31 37 36 35 34 38 33 (90)922 ... CPUå’Œå¯„å­˜å™¨å†…éƒ¨éƒ¨ä»¶ä¹‹é—´æ˜¯ç”± æ€»çº¿ è¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š CPUé™¤äº†æœ‰ æ§åˆ¶å™¨ã€è¿ç®—å™¨ï¼Œè¿˜æœ‰ å¯„å­˜å™¨ï¼Œå…¶ä¸­å¯„å­˜å™¨çš„ä½œç”¨å°±æ˜¯ è¿è¡Œæ•°æ®çš„ä¸´æ—¶å­˜å‚¨ CPUçš„è¿ç®—é€Ÿåº¦æ˜¯éå¸¸å¿«çš„ï¼Œä¸ºäº†æ€§èƒ½ CPU åœ¨å†…éƒ¨ å¼€è¾Ÿäº†ä¸€å°å—ä¸´æ—¶å­˜å‚¨åŒºåŸŸï¼Œå¹¶åœ¨è¿›è¡Œè¿ç®—æ—¶å…ˆå°†æ•°æ®ä»å†…å­˜ä¸­ å¤åˆ¶ åˆ°è¿™ä¸€å°å—ä¸´æ—¶åŒºåŸŸä¸­ï¼Œè¿ç®—å°±åœ¨è¿™ä¸€å°å—ä¸´æ—¶å­˜å‚¨åŒºè¿›è¡Œï¼Œç§°è¿™ä¸€å°å—ä¸´æ—¶å­˜å‚¨åŒºåŸŸä¸º å¯„å­˜å™¨ ã€é’ˆå¯¹arm64çš„CPUæ¥è¯´ã€‘ å¦‚æœå¯„å­˜å™¨ä»¥ x å¼€å¤´ï¼Œåˆ™è¡¨æ˜æ˜¯ä¸€ä¸ª 64ä½ï¼ˆ84/8=8å­—èŠ‚ï¼‰çš„å¯„å­˜å™¨zã€‚ å¦‚æœå¯„å­˜å™¨ä»¥ w å¼€å¤´ï¼Œåˆ™è¡¨æ˜æ˜¯ä¸€ä¸ª 32ä½ï¼ˆ32/8=4å­—èŠ‚ï¼‰ çš„å¯„å­˜å™¨ åœ¨ç³»ç»Ÿä¸­æ²¡æœ‰æä¾›16ä½å’Œ32ä½çš„å¯„å­˜å™¨ä¾›è®¿é—®å’Œä½¿ç”¨ï¼Œå…¶ä¸­ 32ä½çš„å¯„å­˜å™¨æ˜¯64ä½å¯„å­˜å™¨çš„ä½32ä½çš„éƒ¨åˆ†ï¼Œå¹¶ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ å¯¹äºç¨‹åºæ¥è¯´ï¼ŒCPUä¸­æœ€ä¸»è¦çš„éƒ¨ä»¶æ˜¯ å¯„å­˜å™¨ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜å¯„å­˜å™¨çš„å†…å®¹æ¥å®ç°å¯¹CPUçš„æ§åˆ¶ ä¸åŒCPUï¼Œå¯„å­˜å™¨çš„ä¸ªæ•°å’Œç»“æ„æ˜¯ä¸ç›¸åŒçš„ æŸ¥çœ‹å¯„å­˜å™¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œå¦‚ä¸‹å›¾ï¼š é€‰ä¸­åï¼Œä¼šå‡ºç°ä¸‰ç§å¯„å­˜å™¨ï¼Œå¦‚ä¸‹å›¾ï¼š æµ®ç‚¹å’Œå‘é‡å¯„å­˜å™¨å› ä¸ºæµ®ç‚¹æ•°çš„å­˜å‚¨ä»¥åŠå…¶è¿ç®—çš„ç‰¹æ®Šæ€§ï¼ŒCPUä¸­ä¸“é—¨æä¾› æµ®ç‚¹å¯„å­˜å™¨ æ¥å¤„ç†æµ®ç‚¹æ•° æµ®ç‚¹å¯„å­˜å™¨ 64ä½ï¼šD0-D31 32ä½ï¼šS0-S31 ç°åœ¨ CPUæ”¯æŒå‘é‡è¿ç®—ï¼ˆå‘é‡è¿ç®—åœ¨å›¾å½¢å¤„ç†ç›¸å…³çš„é¢†åŸŸç”¨çš„éå¸¸å¤šï¼‰ï¼Œä¸ºäº†æ”¯æŒå‘é‡è®¡ç®—ï¼Œç³»ç»Ÿä¹Ÿæä¾›äº†ä¼—å¤šçš„å‘é‡å¯„å­˜å™¨ å‘é‡å¯„å­˜å™¨ 128 ä½ï¼šV0 - V31 é€šç”¨å¯„å­˜å™¨ é€šç”¨å¯„å­˜å™¨ä¹Ÿç§°ä¸º æ•°æ®åœ°å€å¯„å­˜å™¨ã€‚é€šå¸¸ç”¨æ¥ åšæ•°æ®è®¡ç®—çš„ä¸´æ—¶å­˜å‚¨ã€ç´¯åŠ ã€è®¡æ•°ã€åœ°å€ä¿å­˜ç­‰åŠŸèƒ½ã€‚å®šä¹‰è¿™äº›å¯„å­˜å™¨çš„ä½œç”¨ä¸»è¦æ˜¯ç”¨äºåœ¨CPUæŒ‡ä»¤ä¸­ä¿å­˜æ“ä½œæ•°ï¼Œåœ¨CPUä¸­å½“åšä¸€äº›å¸¸è§„å˜é‡æ¥ä½¿ç”¨ ARM64ä¸­ 64ä½ï¼šx0-x30ï¼ŒXZR(å¯„å­˜å™¨) 32ä½ï¼šW0-W30,WZR(é›¶å¯„å­˜å™¨) arm64æ‹¥æœ‰ 32ä¸ª64ä½çš„é€šç”¨å¯„å­˜å™¨X0-X30ï¼Œä»¥åŠXZRï¼ˆé›¶å¯„å­˜å™¨ï¼‰ã€‚è¿™äº›é€šç”¨å¯„å­˜å™¨æœ‰æ—¶ä¹Ÿæœ‰ç‰¹å®šç”¨é€” é‚£ä¹ˆ w0-w28 è¿™äº›32ä½çš„ï¼Œå› ä¸º64ä½CPUå¯ä»¥å…¼å®¹32ä½ï¼Œæ‰€ä»¥å¯ä»¥åªä½¿ç”¨64ä½å¯„å­˜å™¨çš„ä½32ä½ ä¾‹å¦‚ w0å°±æ˜¯x0çš„ä½32ä½ 1æ³¨æ„ï¼šäº†è§£è¿‡8086æ±‡ç¼–çš„ä¸€å®šçŸ¥é“ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„å¯„å­˜å™¨æ®µå¯„å­˜å™¨ï¼šCSã€DSã€SS ã€ESã€‚è¿™å››ä¸ªå¯„å­˜å™¨ä¸»è¦ç”¨æ¥ä¿å­˜è¿™äº›æ®µçš„åŸºåœ°å€ï¼Œæ˜¯å±äºIntelæ¶æ„çš„CPUçš„ï¼Œåœ¨armä¸­å¹¶æ²¡æœ‰ é€šå¸¸ï¼ŒCPUä¼šå…ˆå°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°é€šç”¨å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†å¯¹å¯„å­˜å™¨ä¸­çš„æ•°æ®è¿›è¡Œè¿ç®— ä¾‹å­ï¼šå‡è®¾å†…å­˜ä¸­æœ‰å—çº¢è‰²å†…å­˜ç©ºé—´çš„å€¼æ˜¯3ï¼Œç°åœ¨æƒ³æŠŠå®ƒçš„å€¼åŠ 1ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°è“è‰²å†…å­˜ç©ºé—´ï¼Œå¦‚ä½•åšå‘¢ï¼Ÿ CPUé¦–å…ˆä¼šå°†çº¢è‰²å†…å­˜ç©ºé—´çš„å€¼æ”¾åˆ°X0å¯„å­˜å™¨ä¸­ï¼šmov X0ï¼Œçº¢è‰²å†…å­˜ç©ºé—´ ç„¶åè®©X0å¯„å­˜å™¨ä¸1ç›¸åŠ ï¼šadd X0,1 æœ€åå°†å€¼èµ‹å€¼ç»™å†…å­˜ç©ºé—´ï¼šmov è“è‰²å†…å­˜ç©ºé—´ï¼ŒX0 PCå¯„å­˜å™¨ ä¸º æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œå®ƒ æŒ‡ç¤ºäº†CPUå½“å‰è¦è¯»å–æŒ‡ä»¤çš„åœ°å€ åœ¨å†…å­˜&#x2F;ç£ç›˜ä¸­ï¼ŒæŒ‡ä»¤å’Œæ•°æ®æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œéƒ½æ˜¯äºŒè¿›åˆ¶ä¿¡æ¯ CPUåœ¨å·¥ä½œæ—¶ï¼Œå°†æœ‰çš„ä¿¡æ¯çœ‹åšæŒ‡ä»¤ï¼Œæœ‰çš„ä¿¡æ¯çœ‹åšæ•°æ®ï¼Œä¸ºåŒæ ·çš„ä¿¡æ¯èµ‹äºˆäº†ä¸åŒçš„æ„ä¹‰ ä¾‹å¦‚ 1110 0000 0000 0011 0000 1000 1010 1010 å¯ä»¥å½“åšæ•°æ® 0xE003008AA ä¹Ÿå¯ä»¥å½“åšæŒ‡ä»¤ mov x0,x8 CPUæ ¹æ®ä»€ä¹ˆå°†å†…å­˜ä¸­çš„ä¿¡æ¯çœ‹ä½œæŒ‡ä»¤å‘¢ï¼Ÿ CPUå°†pcæŒ‡å‘çš„å†…å­˜å•å…ƒçš„å†…å®¹çœ‹ä½œæŒ‡ä»¤ å¦‚æœå†…å­˜ä¸­çš„æŸæ®µå†…å®¹æ›¾ç»è¢«CPUæ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆå®ƒæ‰€åœ¨çš„å†…å­˜å•å…ƒå¿…ç„¶è¢«pcæŒ‡å‘è¿‡ å¯„å­˜å™¨çš„æ¡ˆä¾‹åˆ†æä¸‹é¢é€šè¿‡ä»¥ä¸‹ä»£ç çš„ä¾‹å­æ¥åˆ†æ 1234567891011121314#import &lt;UIKit/UIKit.h&gt;#import &quot;AppDelegate.h&quot;int test()&#123; int cTemp = 0x1FFFFFFFF; return cTemp;&#125;int main(int argc, char * argv[]) &#123; printf(&quot;%x\\n&quot;,test()); @autoreleasepool &#123; return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); &#125;&#125; ä»¥ä¸‹æ˜¯demoçš„æ±‡ç¼–å›¾ç¤º pcå¯„å­˜å™¨è°ƒå¼ æ‰“å° pc å¯„å­˜å™¨ï¼Œç°åœ¨æ˜¯ d613c æŒ‰ä½ control+Setp intoï¼Œç»§ç»­æ‰“å° é™¤äº†è¯»è¿˜å¯ä»¥å†™: register write pc 0x1025d6134 register read pc æ­¤æ—¶æ˜¯è¯»ä¸å‡ºæ¥çš„ï¼Œå› ä¸ºæ–­ç‚¹æ–­ä½äº†ï¼Œå¦‚æœstep into ï¼Œæ­¤æ—¶æ–­ç‚¹æ–­åœ¨å“ªé‡Œï¼Ÿ é«˜é€Ÿç¼“å­˜iPhoneXä¸Šæ­è½½çš„armå¤„ç†å™¨ A11ï¼Œå®ƒçš„1çº§ç¼“å­˜çš„å®¹é‡æ˜¯64Kbï¼Œ2çº§ç¼“å­˜çš„å®¹é‡æ˜¯8M CPUæ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å‰éƒ½éœ€è¦ä»å†…å­˜ä¸­å°†æŒ‡ä»¤è¯»å–åˆ°CPUå†…å­˜å¹¶æ‰§è¡Œï¼Œè€Œå¯„å­˜å™¨çš„è¿è¡Œé€Ÿåº¦ç›¸æ¯”å†…å­˜è¯»å†™è¦å¿«å¾ˆå¤šï¼Œä¸ºäº†æ€§èƒ½ï¼ŒCPUè¿˜é›†æˆäº†ä¸€ä¸ª é«˜é€Ÿç¼“å­˜åŒºåŸŸã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œå…ˆå°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ä»¥åŠæ•°æ®å¤åˆ¶åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼ˆç”±æ“ä½œç³»ç»Ÿå®Œæˆï¼‰ï¼Œç„¶åCPUç›´æ¥ä»é«˜é€Ÿç¼“å­˜ä¾æ¬¡è¯»å–æŒ‡ä»¤æ¥æ‰§è¡Œ blæŒ‡ä»¤ CPUä»ä½•å¤„æ‰§è¡ŒæŒ‡ä»¤ï¼Œæ˜¯ç”±pcä¸­çš„å†…å®¹å†³å®šçš„ï¼Œå¯ä»¥ é€šè¿‡æ”¹å˜pcçš„å†…å®¹æ¥æ§åˆ¶CPUæ‰§è¡Œç›®æ ‡æŒ‡ä»¤ arm64æä¾›äº†ä¸€ä¸ª movæŒ‡ä»¤ï¼ˆä¼ é€æŒ‡ä»¤ï¼‰ï¼Œå¯ä»¥ç”¨æ¥æ”¹å˜å¤§éƒ¨åˆ†å¯„å­˜å™¨çš„å€¼ï¼Œä¾‹å¦‚ mov x0,#10ã€mov x1,#20 ä½†æ˜¯ï¼ŒmovæŒ‡ä»¤å¹¶ä¸èƒ½ç”¨äºè®¾ç½®pcçš„å€¼ï¼Œarm64æ²¡æœ‰æä¾›è¿™æ ·çš„åŠŸèƒ½ arm64æä¾›äº†å¦å¤–çš„æŒ‡ä»¤æ¥ ä¿®æ”¹pcçš„å€¼ï¼Œè¿™äº›æŒ‡ä»¤ç»Ÿä¸€ç§°ä¸º è½¬ç§»æŒ‡ä»¤ï¼Œå…¶ä¸­æœ€ç®€å•çš„æ˜¯ blæŒ‡ä»¤ blæŒ‡ä»¤ç»ƒä¹ ç°åœ¨æœ‰ä¸¤æ®µä»£ç ï¼Œå‡è®¾ç¨‹åºå…ˆæ‰§è¡ŒAï¼Œè¯·å†™å‡ºæŒ‡ä»¤æ‰§è¡Œé¡ºåºï¼Œæœ€ç»ˆå¯„å­˜å™¨x0çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ 1234567891011121314151617181920212223242526_A: mov x0,#0xa0 mov x1,#0x00 add x1, x0, #0x14 mov x0,x1 bl _B mov x0,#0x0 ret_B: add x0, x0, #0x10 ret // åˆ†ææµç¨‹æµç¨‹ï¼š mov x0,#0xa0 -- x0ï¼š0xa0 mov x1,#0x00 -- x1ï¼š0x00 add x1, x0, #0x14 -- x1ï¼š0xa0+0x14=0xb4 mov x0,x1 -- x0ï¼š0xb4 bl _B -- è·³è½¬åˆ°B add x0, x0, #0x10 -- x0ï¼š0xb4+0x10=0xc4 ret -- å›åˆ°blè·³è½¬çš„ä¸‹ä¸€è¡Œ mov x0,#0x0 -- x0ï¼š0x00// ç»“æœx0çš„å€¼ï¼š0x00 æ±‡ç¼–ä»£ç éªŒè¯ä¸‹é¢æ¥å†™ä¸€æ®µæ±‡ç¼–ä»£ç éªŒè¯ï¼ˆcommand + n -&gt; empty -&gt; asm.sï¼‰ï¼ˆæ±‡ç¼–ä»£ç æ–‡ä»¶ï¼Œä¼šç¼–è¯‘æˆæºç ï¼‰ å¦‚ä½•æ‰§è¡Œå‘¢ï¼Ÿ åœ¨VCä¸­å®šä¹‰å‡½æ•°çš„å£°æ˜ åœ¨ mov x0,#0xa0 æ‰§è¡Œå¤„åŠ æ–­ç‚¹ï¼Œå¹¶æ‰§è¡Œç¨‹åºï¼Œå¼€å¯æ±‡ç¼–è°ƒè¯• æŒ‰ä½ control+step intoï¼Œè¿›å…¥Açš„å…·ä½“æ±‡ç¼– ç»§ç»­ control+step intoï¼Œåˆ° bl _B å¤„ æŒ‰ä½ control+step intoï¼Œè¿›å…¥æ±‡ç¼–ä»£ç B æ‰§è¡Œåˆ°Açš„ret ç–‘é—®ï¼š å‘ç°èµ°åˆ°è¿™é‡Œæ­»å¾ªç¯äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿé¢„çŸ¥åäº‹å¦‚ä½•ï¼Œè¯·çœ‹ä¸‹ä¸€ç¯‡ æ€»ç»“ 1ã€æ±‡ç¼–æ¦‚è¿° ä½¿ç”¨ åŠ©è®°ç¬¦ä»£æ›¿æœºå™¨æŒ‡ä»¤ çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ æ±‡ç¼–å’Œæœºå™¨æŒ‡ä»¤æ˜¯ ä¸€ä¸€å¯¹åº” çš„å…³ç³»ï¼Œæ‹¿åˆ°äºŒè¿›åˆ¶å°±å¯ä»¥åæ±‡ç¼– ç”±äºæ±‡ç¼–å’ŒCPUçš„æŒ‡ä»¤é›†æ˜¯å¯¹åº”çš„ï¼Œæ‰€ä»¥æ±‡ç¼–ä¸å…·å¤‡ç§»æ¤æ€§ 2ã€æ€»çº¿ï¼šæ˜¯ç”±ä¸€å †å¯¼çº¿çš„é›†åˆ åœ°å€æ€»çº¿ï¼šå…¶å®½åº¦å†³å®šäº†å¯»å€èƒ½åŠ› æ•°æ®æ€»çº¿ï¼šå…¶å®½åº¦å†³å®šäº†CPUæ•°æ®çš„ååé‡ æ§åˆ¶æ€»çº¿ï¼šå…¶å®½åº¦å†³å®šäº†CPUå¯¹å…¶ä»–å™¨ä»¶çš„æ§åˆ¶èƒ½åŠ› 3ã€è¿›åˆ¶ ä»»æ„è¿›åˆ¶éƒ½æ˜¯ç”±å¯¹åº”ä¸ªæ•°çš„ç¬¦å·ç»„æˆçš„ï¼Œç¬¦å·å¯ä»¥è‡ªå®šä¹‰ 2&#x2F;8&#x2F;16æ˜¯ç›¸å¯¹å®Œç¾çš„è¿›åˆ¶ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³» 3 ä¸ªäºŒè¿›åˆ¶ä½¿ç”¨ä¸€ä¸ª 8è¿›åˆ¶ æ ‡è¯† 4 ä¸ªäºŒè¿›åˆ¶ä½¿ç”¨ä¸€ä¸ª 16è¿›åˆ¶ æ ‡è¯† ä¸¤ä¸ª16è¿›åˆ¶å¯ä»¥æ ‡è¯†ä¸€ä¸ªå­—èŠ‚ï¼Œå³8ä½ æ•°é‡å•ä½ 1024 &#x3D; 1kï¼Œ1024k &#x3D; 1Mï¼Œ1024M &#x3D; 1G å®¹é‡å•ä½ 1024 &#x3D; 1KBï¼Œ1024KB &#x3D; 1MBï¼Œ1024MB &#x3D; 1GB æ•°æ®çš„å®½åº¦ è®¡ç®—æœºä¸­çš„æ•°æ®æ˜¯æœ‰å®½åº¦çš„ï¼Œè¶…è¿‡äº†å°±ä¼šæº¢å‡º 4ã€å¯„å­˜å™¨ï¼šCPUä¸ºäº†æ€§èƒ½ï¼Œè‡ªå†…éƒ¨å¼€è¾Ÿäº†ä¸€å°å—ä¸´æ—¶å­˜å‚¨åŒºåŸŸ æµ®ç‚¹å‘é‡å¯„å­˜å™¨ï¼šç”¨äºæµ®ç‚¹æ•°&#x2F;å‘é‡çš„å­˜å‚¨åŠè¿ç®— å¼‚å¸¸çŠ¶æ€å¯„å­˜å™¨ é€šç”¨å¯„å­˜å™¨ï¼šé™¤äº†å­˜æ”¾æ•°æ®æœ‰æ—¶ä¹Ÿæœ‰ç‰¹æ®Šçš„ç”¨é€” ARM64æ‹¥æœ‰32ä¸ª64ä½çš„é€šç”¨å¯„å­˜å™¨ X0-X30 ä»¥åŠXZRï¼ˆé›¶å¯„å­˜å™¨ï¼‰ ä¸ºäº†å…¼å®¹32ä½ï¼Œæ‰€ä»¥arm64ä½æ‹¥æœ‰ W0-W28 ä»¥åŠWZR 30ä¸ª32ä½å¯„å­˜å™¨ 32ä½å¯„å­˜å™¨å¹¶ä¸æ˜¯ç‹¬ç«‹å­˜åœ¨çš„ï¼Œä¾‹å¦‚ W0æ˜¯X0çš„ä½32ä½ PCå¯„å­˜å™¨ï¼šæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ PCå¯„å­˜å™¨é‡Œé¢çš„å€¼ä¿å­˜çš„å°±æ˜¯CPUæ¥ä¸‹æ¥éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ æ”¹å˜PCçš„å€¼å¯ä»¥æ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµç¨‹ movæŒ‡ä»¤ä¸èƒ½æ›´æ”¹PCå¯„å­˜å™¨çš„å€¼ï¼Œéœ€è¦é€šè¿‡blè·³è½¬æŒ‡ä»¤æ¥æ”¹å˜PCå¯„å­˜å™¨çš„å€¼","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘11ï¼šä»£ç æ³¨å…¥ï¼ˆä¸‹ï¼‰","slug":"OCé€†å‘/OCé€†å‘11ï¼šä»£ç æ³¨å…¥ï¼ˆä¸‹ï¼‰","date":"2022-02-08T08:04:13.000Z","updated":"2022-02-08T08:23:24.000Z","comments":true,"path":"2022/02/08/OCé€†å‘/OCé€†å‘11ï¼šä»£ç æ³¨å…¥ï¼ˆä¸‹ï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/02/08/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9111%EF%BC%9A%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘11ï¼šä»£ç æ³¨å…¥ï¼ˆä¸Šï¼‰","slug":"OCé€†å‘/OCé€†å‘11ï¼šä»£ç æ³¨å…¥ï¼ˆä¸Šï¼‰","date":"2022-02-08T08:03:52.000Z","updated":"2022-02-08T09:11:19.000Z","comments":true,"path":"2022/02/08/OCé€†å‘/OCé€†å‘11ï¼šä»£ç æ³¨å…¥ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/02/08/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9111%EF%BC%9A%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦è®²è§£ä»£ç æ³¨å…¥çš„ä¸¤ç§æ–¹å¼ï¼š Frameworkæ³¨å…¥ã€dylibæ³¨å…¥ ä»£ç æ³¨å…¥ä¸€èˆ¬ä¿®æ”¹åŸå§‹çš„ç¨‹åºï¼Œæ˜¯ åˆ©ç”¨ä»£ç æ³¨å…¥ çš„æ–¹å¼ï¼Œæ³¨å…¥ä»£ç å°±ä¼šé€‰æ‹©åˆ©ç”¨ Framework æˆ–è€… dylib ç­‰ä¸‰æ–¹åº“çš„æ–¹å¼æ³¨å…¥ æŸ¥çœ‹Mach-Oæ–‡ä»¶ åœ¨äº†è§£æ³¨å…¥å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ ipaåŒ… ä¸­çš„é™æ€åº“æ˜¯å¦‚ä½•æ³¨å…¥çš„ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼æŸ¥çœ‹Mach-Oå¯æ‰§è¡Œæ–‡ä»¶ * ç»ˆç«¯å‘½ä»¤ï¼šotool -l Demo * MachOView äºŒè¿›åˆ¶æ–‡ä»¶åˆ†æå·¥å…·ï¼ˆæ³¨ï¼šåˆ†ææ—¶å¯èƒ½å‡ºç°æ— æ³•åˆ†æçš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡CMD + Oæ‰“å¼€ï¼‰ Mach-O æ–‡ä»¶ä¸­ä¸»è¦çœ‹ load Commandsï¼ˆå³åŠ è½½å‘½ä»¤é›†ï¼‰ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡ºåŠ¨æ€åº“çš„åŠ è½½ç­‰ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ ¼å¼ä¸ºï¼šLC_LOAD_DYLIBï¼ˆxxxï¼‰ï¼Œæ˜¯åœ¨æŒ‡å®šè·¯å¾„ä¸‹åŠ è½½xxxï¼Œå¦‚ä¸‹æ‰€ç¤º æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œå¦‚æœéœ€è¦æ³¨å…¥ä»£ç ï¼Œæ˜¯ ä»¥åŠ¨æ€åº“çš„å½¢å¼æ³¨å…¥ æ–¹å¼ä¸€ï¼šFrameworkæ‰‹åŠ¨æ³¨å…¥ ç¬¬ä¸€æ­¥ï¼šåŠ¨æ€åº“è¿›å…¥AppåŒ…ï¼Œå³Frameworkæ³¨å…¥ åˆ›å»ºä¸€ä¸ª Frameworkï¼Œå‘½ä»¤ä¸ºZJHookï¼ˆåˆ›å»ºä½ç½®ï¼štarget -&gt; + -&gt; ios -&gt; Frameworkï¼‰ åœ¨ ZJHookä¸­åˆ›å»º inject æ–‡ä»¶ï¼Œåœ¨å£°æ˜å‘¨æœŸæ–¹æ³•loadå‡½æ•°ä¸­å†™æ³¨å…¥ä»£ç  123+(void)load&#123; NSLog(@&quot;CJLHook ------ æ³¨å…¥æˆåŠŸ&quot;);&#125; ç¼–è¯‘å·¥ç¨‹Demoï¼ˆæ³¨ï¼šè¿™é‡Œçš„å·¥ç¨‹ä¾ç„¶éœ€è¦é‡ç­¾åï¼‰ï¼Œç„¶åæŸ¥çœ‹å·¥ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶Demoï¼ŒæŸ¥æ‰¾å…¶ä¸­çš„Frameworksï¼Œä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ZJHookï¼Œä½†æ˜¯æ­¤æ—¶å¹¶ä¸ä¼šæ‰§è¡Œå…¶ä¸­çš„loadå‡½æ•° loadä¸ä¼šæ‰§è¡Œçš„åŸå› ï¼šæŸ¥çœ‹æ­¤æ—¶çš„Mach-Oæ–‡ä»¶ä¸­çš„ Load Commandsï¼Œå¹¶æ²¡æœ‰å‘ç°ZJHookï¼Œéšæ„æ­¤æ—¶æ˜¯ä¸ä¼šæ‰§è¡Œå…¶ä¸­çš„loadå‡½æ•°çš„ ç¬¬äºŒæ­¥ï¼šyololibæ‰‹åŠ¨æ³¨å…¥ï¼Œä¿®æ”¹Mach-Oå­—æ®µ é€šè¿‡yololibå·¥å…·ä¿®æ”¹Mach-Oå­—æ®µï¼š.&#x2F;yololib Demo Frameworks&#x2F;ZJHook.framework&#x2F;ZJHookï¼ˆæ³¨ï¼šéœ€è¦å°†Demoå¯æ‰§è¡Œæ–‡ä»¶æ‹·è´è¿‡æ¥ï¼‰ æ–¹å¼2ï¼šdylibæ³¨å…¥å‡†å¤‡å·¥ä½œï¼šåˆ›å»ºä¸€ä¸ªç©ºå·¥ç¨‹ï¼Œå¹¶è¿›è¡ŒDemoçš„é‡ç­¾åï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ä»¶iOSé€†å‘10ï¼šåº”ç”¨é‡ç­¾åï¼ˆä¸‹ï¼‰ dylibæ³¨å…¥ é€‰æ‹© target -&gt; + &gt; mac os -&gt; Library ï¼Œå‘½åä¸º ZJHook åœ¨ Build Setting ä¸­é…ç½® ZJHook Base SDK æ”¹ä¸º ios Code Signing identify æ”¹ä¸º iOS Developer å½“å‰å·¥ç¨‹æ‹·è´ lib","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘12ï¼šMach-Oæ–‡ä»¶ï¼ˆä¸‹ï¼‰","slug":"OCé€†å‘/OCé€†å‘12ï¼šMach-Oæ–‡ä»¶ï¼ˆä¸‹ï¼‰","date":"2022-01-25T01:34:11.000Z","updated":"2022-02-08T08:22:22.000Z","comments":true,"path":"2022/01/25/OCé€†å‘/OCé€†å‘12ï¼šMach-Oæ–‡ä»¶ï¼ˆä¸‹ï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/01/25/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9112%EF%BC%9AMach-O%E6%96%87%E4%BB%B6%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦ä»‹ç»Mach-Oçš„ç»“æ„æ¼”ç¤º Mach-Oå†…éƒ¨ç»“æ„å› ä¸ºMach-Oæ–‡ä»¶æœ¬èº«æ˜¯ä¸€ç§æ–‡ä»¶æ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šéœ€è¦äº†è§£å…¶æ–‡ä»¶å†…éƒ¨ç»“æ„ï¼Œå…¶å†…éƒ¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Mach-O çš„ç»„æˆç»“æ„ä¸»è¦åˆ†ä¸º ä¸‰éƒ¨åˆ† Header åŒ…å«è¯¥ äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€èˆ¬ä¿¡æ¯ å­—èŠ‚é¡ºåºã€ç»“æ„ç±»å‹ã€åŠ è½½æŒ‡ä»¤çš„æ•°é‡ç­‰ ä½¿å¾—å¯ä»¥å¿«é€Ÿç¡®è®¤ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å½“å‰æ–‡ä»¶ç”¨äº32ä½è¿˜æ˜¯64ä½ï¼Œå¯¹åº”çš„å¤„ç†å™¨æ˜¯ä»€ä¹ˆï¼Ÿæ–‡ä»¶ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ Load commands ï¼ˆåŠ è½½å‘½ä»¤ï¼‰ä¸€å¼ åŒ…å«å¾ˆå¤šå†…å®¹çš„è¡¨ å†…å®¹åŒ…æ‹¬ åŒºåŸŸçš„ä½ç½®ã€ç¬¦å·è¡¨ã€åŠ¨æ€ç¬¦å·è¡¨ ç­‰ Dataï¼ˆæ•°æ®ï¼‰é€šå¸¸æ˜¯å¯¹è±¡æ–‡ä»¶ä¸­æœ€å¤§çš„éƒ¨åˆ† åŒ…å« Segment çš„å…·ä½“ æ•°æ®ï¼Œé¦–å…ˆæ˜¯ åˆ†æ®µï¼Œç„¶åæ®µä¸­ åˆ†èŠ‚ ç»ˆç«¯å‘½ä»¤ï¼šotoolåœ¨ç»ˆç«¯ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ otool æŸ¥çœ‹Mach-Oçš„ä¸€äº›æŒ‡ä»¤ 123456789101112131415161718192021222324252627282930313233343536 % otoolUsage: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/otool [-arch arch_type] [-fahlLDtdorSTMRIHGvVcXmqQjCP] [-mcpu=arg] [--version] &lt;object file&gt; ... -f print the fat headers -a print the archive header -h print the mach header -l print the load commands -L print shared libraries used -D print shared library id name -t print the text section (disassemble with -v) -x print all text sections (disassemble with -v) -p &lt;routine name&gt; start dissassemble from routine name -s &lt;segname&gt; &lt;sectname&gt; print contents of section -d print the data section -o print the Objective-C segment -r print the relocation entries -S print the table of contents of a library (obsolete) -T print the table of contents of a dynamic shared library (obsolete) -M print the module table of a dynamic shared library (obsolete) -R print the reference table of a dynamic shared library (obsolete) -I print the indirect symbol table -H print the two-level hints table (obsolete) -G print the data in code table -v print verbosely (symbolically) when possible -V print disassembled operands symbolically -c print argument strings of a core file -X print no leading addresses or headers -m don&#x27;t use archive(member) syntax -B force Thumb disassembly (ARM objects only) -q use llvm&#x27;s disassembler (the default) -Q use otool(1)&#x27;s disassembler -mcpu=arg use `arg&#x27; as the cpu for disassembly -j print opcode bytes -P print the info plist section as strings -C print linker optimization hints --version print the version of /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/otool æŸ¥çœ‹Mach-Oçš„headerä¿¡æ¯ï¼šotool -f Demo 1234567891011121314151617181920212223242526% cd /Users/zhangjian/Library/Developer/Xcode/DerivedData/Demo-edwjvapoqaffzeeiyzyhfryhfrsr/Build/Products/Release-iphoneos/Demo.app zhangjian@zhangjiandeMBP Demo.app % otool -f DemoFat headersfat_magic 0xcafebabenfat_arch 3architecture 0 cputype 12 cpusubtype 9 capabilities 0x0 offset 16384 size 79280 align 2^14 (16384)architecture 1 cputype 12 cpusubtype 11 capabilities 0x0 offset 98304 size 79280 align 2^14 (16384)architecture 2 cputype 16777228 cpusubtype 0 capabilities 0x0 offset 180224 size 80000 align 2^14 (16384) MachOView è½¯ä»¶ é¦–å…ˆ Show in finder æ‰¾åˆ°Demo.appç¨‹åºåŒ… -&gt; å³é”®æ˜¾ç¤ºåŒ…å†…å®¹ -&gt; æ‰¾æ‰“exexå¯æ‰§è¡Œæ–‡ä»¶ å°†demoæ‹–æ‹½åˆ° MachOView æŸ¥çœ‹ Mach-O æ–‡ä»¶ éªŒè¯ ARM-V7 ä¸ ARM_V7S ä¹‹é—´æ˜¯å¦æ˜¯åˆ†é¡µï¼Ÿ * ARM_V7 ä¸ ARM_V7S çš„å·®å€¼ï¼š16384 + 79280 - 98304 = -2640 * ARM_V7 çš„å¤§å°ï¼š-2640 - 79280 = -81920ï¼ŒæŸ¥çœ‹è¿™ä¸ªå€¼æ˜¯å¦ pageSize(4096)çš„å€æ•° * æ˜¯å¦æ˜¯PageSizeçš„å€æ•°ï¼š91920/4096 = -20ï¼ˆMacOsä¸­ï¼‰ï¼Œä½†æ˜¯ç”±äºæ˜¯iOSï¼Œæ‰€ä»¥ 20/4 = 5é¡µï¼Œè¯´æ˜æ˜¯åˆ†é¡µäº†ï¼Œå³æŒ‰é¡µå¯¹é½ ä¸¤è€…å¯¹æ¯” otool ä¸ MachOView æŸ¥çœ‹çš„Mach-Oè¿›è¡Œå¯¹æ¯” MachOViewæ¼”ç¤ºé€šè¿‡ MachOView æŸ¥çœ‹Mach-Oç»“æ„ï¼Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šHeaderã€Load Commandsã€Data æŸ¥çœ‹ arm64 ä¸‹ Mach-O çš„header æŸ¥çœ‹ Load Commands * VM Addrï¼šè™šæ‹Ÿå†…å­˜åœ°å€ * VM Sizeï¼šè™šæ‹Ÿå†…å­˜å¤§å°ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œåœ¨å†…å­˜ä¸­çš„å¤§å°ï¼Œ4g * 64ä½åœ°å€ï¼š0x12345678a2345678 * 32ä½åœ°å€ï¼š0x12345678 * File offsetï¼šæ•°æ®åœ¨æ–‡ä»¶ä¸­åç§»é‡ * File sizeï¼šæ•°æ®åœ¨æ–‡ä»¶ä¸­çš„å¤§å° Section ä¸­åˆ†ä¸ºä¸¤å¤§ç±»ï¼š__TESTï¼ˆä»£ç ï¼‰ã€__DATAï¼ˆæ•°æ®ï¼‰ Header çš„æ•°æ®ç»“æ„ åœ¨ CMD + shift + O æœç´¢ loader.hï¼Œæ‰¾åˆ° Mach_Header_64ï¼ˆarm64æ¶æ„ï¼‰çš„æ•°æ®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ mach_header ç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª reverse 12345678910111213141516171819202122// 1.mach_headerstruct mach_header &#123; uint32_t magic; /* é­”æ•°ï¼Œå¿«é€Ÿå®šä½å±äº64ä½è¿˜æ˜¯32ä½ */ cpu_type_t cputype; /* cpuç±»å‹ */ cpu_subtype_t cpusubtype; /* cpuå…·ä½“ç±»å‹ */ uint32_t filetype; /* æ–‡ä»¶ç±»å‹ */ uint32_t ncmds; /* Load commandsçš„æ¡æ•° */ uint32_t sizeofcmds; /* Load commandsçš„å¤§å° */ uint32_t flags; /* æ ‡å¿—ä½æ ‡è¯†äºŒè¿›åˆ¶æ–‡ä»¶æ”¯æŒçš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯å’Œç³»ç»ŸåŠ è½½ã€é“¾æ¥æœ‰å…³ */&#125;;// 2.mach_header_64struct mach_header_64 &#123; uint32_t magic; /* é­”æ•°ï¼Œå¿«é€Ÿå®šä½å±äº64ä½è¿˜æ˜¯32ä½ */ cpu_type_t cputype; /* cpuç±»å‹ */ cpu_subtype_t cpusubtype; /* cpuå…·ä½“ç±»å‹ */ uint32_t filetype; /* æ–‡ä»¶ç±»å‹ */ uint32_t ncmds; /* Load commandsçš„æ¡æ•° */ uint32_t sizeofcmds; /* Load commandsçš„å¤§å° */ uint32_t flags; /* æ ‡å¿—ä½æ ‡è¯†äºŒè¿›åˆ¶æ–‡ä»¶æ”¯æŒçš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯å’Œç³»ç»ŸåŠ è½½ã€é“¾æ¥æœ‰å…³ */ uint32_t reserved; /* reserved */&#125;; æŸ¥çœ‹filetypeç§ç±» OCæ–‡ä»¶ï¼š#define MH_OBJECT 0x1 å¯æ‰§è¡Œæ–‡ä»¶ï¼š#define MH_EXECUTE 0x2 â€¦ Load CommandsLoad Commands ä¸­çš„ç›¸å…³å­—æ®µå«ä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š LC_SEGMENT_64ï¼šå°†æ–‡ä»¶ä¸­ï¼ˆ32ä½æˆ–64ä½ï¼‰çš„æ®µæ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œä¸»è¦åˆ†ä¸º__TEXTã€__DATAã€LINKEDITå‡ å¤§å— LC_DYLD_INFO_ONLYï¼šåŠ¨æ€é“¾æ¥ç›¸å…³ä¿¡æ¯ LC_SYMTABï¼šç¬¦å·åœ°å€ DYSYMTABï¼šåŠ¨æ€ç¬¦å·è¡¨åœ°å€ LC_LOAD_DYLINKERï¼šä½¿ç”¨è°åŠ è½½ï¼Œæˆ‘ä»¬ä½¿ç”¨dyld LC_UUIDï¼šMach-Oæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†UUID LC_VERSION_MIN_MACOSXï¼šæ”¯æŒæœ€ä½çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ LC_SOURCE_VERSIONï¼šæºä»£ç ç‰ˆæœ¬ LC_MAINï¼šè®¾å€¼ç¨‹åºä¸»çº¿ç¨‹çš„å…¥å£åœ°å€å’Œæ ˆå¤§å° LC_ENCRYPTION_INFO_64ï¼šåŠ å¯†ä¿¡æ¯ LC_LOAD_DYLIBï¼šä¾èµ–åº“çš„è·¯å¾„ï¼ŒåŒ…å«ä¸‰æ–¹åº“ LC_FUNCTION_STARTSï¼šå‡½æ•°èµ·å§‹åœ°å€è¡¨ LC_CODE_SIGNATUREï¼šä»£ç ç­¾å æ¼”ç¤º LC_SEGMENT_64 ä¸­ __TEXTã€__DATAã€LINKERDIT çš„å¯¹åº”å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º æŸ¥çœ‹ LC_DYLD_INFO_ONLY åŠ¨æ€é“¾æ¥ä¿¡æ¯ å…¶ä¸­ Rebase æ˜¯é‡å®šå‘ï¼Œé‡å®šå‘è¿‡ç¨‹ç®€è¿°å¦‚ä¸‹ï¼š ä»£ç æ®µ æ”¾å…¥Mach-Oæ–‡ä»¶ï¼Œåœ¨ç¼–è¯‘æ—¶æœŸï¼Œä¼šç”Ÿæˆä¸€ä¸ª åç§»åœ°å€ åœ¨è¿è¡Œæ—¶æœŸï¼Œmach-oæ–‡ä»¶æ”¾å…¥è™šæ‹Ÿå†…å­˜ï¼Œå…¶å†…å­˜ä¹Ÿæ˜¯éšæœºå˜åŒ–çš„(ç”±ç³»ç»Ÿåˆ†é… -ASLR) æ‰€ä»¥ä¹‹å‰çš„ä»£ç æ®µåœ¨mach-oä¸­åç§»å€¼å°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œéœ€è¦é€šè¿‡ ASLR + Rebase Info Offset é‡å®šå‘ï¼Œä¸»è¦æ”¹å˜çš„æ˜¯æ±‡ç¼–ä»£ç  æŸ¥çœ‹ LC_SYMTAB ç¬¦å·åœ°å€ æŸ¥çœ‹ LC_LOAD_DYLINKER ï¼Œä½¿ç”¨è°é“¾æ¥ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯dyld æŸ¥çœ‹ LC_UUIDï¼Œmach-oæ–‡ä»¶è¯†åˆ«çš„å”¯ä¸€æ ‡è¯† æŸ¥çœ‹ LC_VERSION_MIN_MACOSXï¼Œæ”¯æŒçš„æœ€ä½ç‰ˆæœ¬ä¿¡æ¯ æŸ¥çœ‹ LC_SOURCE_VERSIONï¼Œä»£ç ç‰ˆæœ¬ æŸ¥çœ‹ LC_MAINï¼Œå…¥å£å‡½æ•° ä½œç”¨ï¼šç”¨äºä½ æƒ³æ—¶æ‰¾ä¸åˆ°åˆ‡å…¥ç‚¹æ—¶ï¼ˆä¾‹å¦‚ï¼šåšäº†é˜²æŠ¤ï¼Œè¿è¡Œå°±é—ªé€€ï¼‰ï¼Œå¯ä»¥ä»è¿™é‡Œæ‰¾åˆ° æŸ¥çœ‹ LC_ENCRYPTION_INFO_64 ï¼Œæ­¤æ—¶ Crypt ID ä¸º 0ï¼Œè¡¨ç¤ºè¿˜æ²¡æœ‰åŠ å¯† Data å¦‚æœæˆ‘ä»¬æƒ³å¿«é€Ÿå®šä½ä»£ç æ®µï¼Œéœ€è¦é€šè¿‡ LC_SEGMENT_64(__TEXT) ä¸­çš„ VM Adress æŸ¥çœ‹ ä»£ç æ®µ çš„ èµ·å§‹ä½ç½® ä¹Ÿå¯ä»¥é€šè¿‡ objdump å‘½ä»¤æ¥æŸ¥çœ‹ï¼š objdump â€“macho -d Demo ä»è¿™é‡Œçœ‹å‡ºï¼Œæ­£å¥½ä¸Mach-Oæ–‡ä»¶ä¸­çš„å¯¹åº” æŸ¥çœ‹stubã€stub_helperï¼šä¸»è¦æ˜¯ç”¨äºç¬¦å·ç»‘å®šï¼Œè¿™é‡Œçš„ 0x10006574 å…¨æ˜¯æŒ‡å‘çš„ 00006574 åç§»ï¼Œä¸”å‰é¢6å¥æ±‡ç¼–éƒ½æ˜¯åœ¨åš ç¬¦å·ç»‘å®š æŸ¥çœ‹å¤–éƒ¨ç¬¦å·è¡¨ï¼ˆå³ è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰ç»‘å®šï¼‰ï¼Œæœ‰ä¸¤ä¸ªï¼šæ‡’åŠ è½½ã€éæ‡’åŠ è½½ è¿™é‡Œæ˜¯å…ˆ ç»‘å®š ä¸“é—¨ ç”¨æ¥ç»‘å®šå¤–éƒ¨çš„å‡½æ•°ï¼Œåœ¨ç”¨è¿™ä¸ªå‡½æ•°å»ç»‘å®šå…¶ä»–å‡½æ•° æ€»ç»“ Mach-O å†…éƒ¨ç»“æ„ header ï¼šç”¨äºå¿«é€Ÿç¡®å®šè¯¥æ–‡ä»¶çš„CPUç±»å‹ã€æ–‡ä»¶ç±»å‹ Load Commandsï¼šæŒ‡ç¤ºåŠ è½½å™¨å¦‚ä½•è®¾ç½®å¹¶åŠ è½½äºŒè¿›åˆ¶æ•°æ® Dataï¼šå­˜æ”¾æ•°æ®ï¼Œä¾‹å¦‚ä»£ç ã€æ•°æ®ã€å­—ç¬¦ä¸²å¸¸é‡ã€ç±»ã€æ–¹æ³•ç­‰ã€‚ Section ä¸­åˆ†ä¸ºä¸¤å¤§ç±»ï¼š__TEXT(ä»£ç )ã€__DATAï¼ˆæ•°æ®ï¼‰ å¯ä»¥é€šè¿‡ otool å‘½ä»¤æŸ¥çœ‹Mach-Oä¿¡æ¯ï¼Œä¾‹å¦‚æŸ¥çœ‹headerä¿¡æ¯ï¼šotool -f Demo å¯ä»¥é€šè¿‡ objump å‘½ä»¤æ¥æŸ¥çœ‹ä»£ç æ®µï¼š objump --macho -d Demo","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCé€†å‘12ï¼šMach-Oæ–‡ä»¶ï¼ˆä¸Šï¼‰","slug":"OCé€†å‘/OCé€†å‘12ï¼šMach-Oæ–‡ä»¶ï¼ˆä¸Šï¼‰","date":"2022-01-25T01:33:32.000Z","updated":"2022-02-08T08:11:08.000Z","comments":true,"path":"2022/01/25/OCé€†å‘/OCé€†å‘12ï¼šMach-Oæ–‡ä»¶ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2022/01/25/OC%E9%80%86%E5%90%91/OC%E9%80%86%E5%90%9112%EF%BC%9AMach-O%E6%96%87%E4%BB%B6%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦ä»‹ç» Mach-Oæ–‡ä»¶æ ¼å¼ ä»¥åŠ é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ Mach-O æ–‡ä»¶æ¦‚è¿° Mach-Oå…¶å®æ˜¯ Mach Object æ–‡ä»¶æ ¼å¼çš„ç¼©å†™ï¼Œæ˜¯ Mac ä»¥åŠ iOS ä¸Š å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œç±»ä¼¼äº Window ä¸Šçš„ PEæ ¼å¼ï¼ˆPortable Executableï¼‰ï¼Œlinux ä¸Šçš„ elfæ ¼å¼ï¼ˆExecutable And LinkingFormatï¼‰ã€‚ Mach-O æ˜¯ä¸€ç§ ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡ä»£ç ã€åŠ¨æ€åº“çš„æ–‡ä»¶æ ¼å¼ï¼Œä½œä¸º a.outæ ¼å¼ çš„æ›¿ä»£ï¼ŒMach-O æä¾›äº†æ›´å¼ºçš„æ‰©å±•æ€§ Mach-O æ–‡ä»¶æ ¼å¼å¸¸è§çš„ Mach-Oæ ¼å¼ æœ‰ä»¥ä¸‹å‡ ç§ï¼š ç›®æ ‡æ–‡ä»¶ .o åº“æ–‡ä»¶ï¼Œç»†åˆ†ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š .a .dylib .framework å¯æ‰§è¡Œæ–‡ä»¶ dyld dsym æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»ˆç«¯çš„ file æŒ‡ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶çš„ç±»å‹ 12$cd æ–‡ä»¶ç›®å½•$file æ–‡ä»¶ ç›®æ ‡æ–‡ä»¶ .o æ–°å»ºä¸€ä¸ª .c æ–‡ä»¶ 12% cd Desktop % touch demo.c åœ¨ .c æ–‡ä»¶ä¸­å®ç°å¦‚ä¸‹ 123456#include &lt;stdio.h&gt;int main()&#123; printf(&quot;test\\n&quot;); return 0;&#125; é€šè¿‡ clang å‘½ä»¤ç¼–è¯‘ .c æ–‡ä»¶ 123456789101112131415% clang -c demo.c% file demo.odemo.o: Mach-O 64-bit object x86_64% clang demo.o% lsa.out demo.c demo.o % file a.out a.out: Mach-O 64-bit executable x86_64% ./a.out test lsï¼šæŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ clang -c demo.c ï¼š å°† .cæ–‡ä»¶ ç¼–è¯‘æˆ .oæ–‡ä»¶ï¼ˆOCåœ¨åç«¯ä¸­ä½¿ç”¨çš„æ˜¯LLVMç¼–è¯‘ï¼Œè€Œå‰ç«¯ä½¿ç”¨çš„å·¥å…·æ˜¯ clangï¼Œå³ç†è§£ä¸º LLVMåŒ…å«clangï¼‰ file demo.o ï¼š æŸ¥çœ‹æ–‡ä»¶ç±»å‹ Mach-Oæ–‡ä»¶ã€64ä½ã€x86_64æ¶æ„ clang demo.o ï¼š å°† .oæ–‡ä»¶ ç¼–è¯‘æˆ å¯æ‰§è¡Œæ–‡ä»¶ ./a.out ï¼š æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ ä¹Ÿå¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å°† .cæ–‡ä»¶ ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ ï¼š clang -o demo2 demo.c 1234567% clang -o demo2 demo.c% lsdemo.c demo2% ./demo2test é‡å¤4 çš„æ“ä½œï¼Œå†æ¬¡ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ demo3ï¼Œæ­¤æ—¶é—®é¢˜æ¥äº†ï¼Œè¿™ä¸‰ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå³ aã€demo2ã€demo3ï¼‰æ˜¯å¦æ˜¯ä¸€æ ·çš„ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ md5 éªŒè¯ï¼Œå¦‚æœhashå€¼ä¸€æ ·ï¼Œåˆ™è¯´æ˜ä¸€æ ·çš„ï¼Œåä¹‹ä¸ä¸€æ · 12345678% md5 a.outMD5 (a.out) = 922bae326e46b2ac90f5ad4bf2ed031c% md5 demo2MD5 (demo2) = 922bae326e46b2ac90f5ad4bf2ed031c% md5 demo3MD5 (demo3) = 922bae326e46b2ac90f5ad4bf2ed031c ä¸­é—´äº§ç‰© .oæ–‡ä»¶å…¶ä¸­ .c å’Œ .out æ–‡ä»¶çš„åŒºåˆ«æ˜¯ä¸­é—´å¤šäº†ä¸€ä¸ª .o æ–‡ä»¶ã€‚è€Œåœ¨æˆ‘ä»¬çš„å®é™…å¼€å‘ä¸­ï¼Œå…¶å®æ˜¯ç”±å¤šä¸ªæºç çš„ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ç”±å¤šä¸ªæºç  ç”Ÿæˆçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå°† ä¸¤ä¸ª.o æ–‡ä»¶ç¼–è¯‘æˆ ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ æ–°å»ºä¸¤ä¸ª .c æ–‡ä»¶ test.c ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415#include &lt;stdio.h&gt;// å‡½æ•°å¤–å®šä¹‰å˜é‡ x å’Œ yint x;int y;int addtwonum()&#123; // å‡½æ•°å†…å£°æ˜å˜é‡ x å’Œ y ä¸ºå¤–éƒ¨å˜é‡ extern int x; extern int y; // ç»™å¤–éƒ¨å˜é‡ï¼ˆå…¨å±€å˜é‡ï¼‰x å’Œ y èµ‹å€¼ x = 1; y = 2; return x+y;&#125; test1.c ä»£ç å¦‚ä¸‹ï¼š 12345678910#include &lt;stdio.h&gt;int main()&#123; int result; result = 1; printf(&quot;result ä¸º: %d&quot;,result); return 0;&#125; é€šè¿‡ clang å°† ä¸¤ä¸ª.cæ–‡ä»¶ ç”Ÿæˆ ä¸¤ä¸ª.oæ–‡ä»¶ï¼šclang -c test1.c test.c 123% clang -c test1.c test.c% lstest1.o test.c test.o test1.c é€šè¿‡ clang å°† ä¸¤ä¸ª.oæ–‡ä»¶ ç¼–è¯‘æˆ ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼šclang -o demo test1.o test.o 1% clang -o demo test1.o test.o å¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™ 123456% clang -o demo test1.o test.oduplicate symbol &#x27;_main&#x27; in: test1.o test.old: 1 duplicate symbol for architecture x86_64clang: error: linker command failed with exit code 1 (use -v to see invocation) è¯´æ˜: text.c å’Œ test1.c ä¸­çš„ ä»£ç ç›¸åŒï¼Œéœ€è¦å°†å…¶ä¸­ä¸€ä¸ªä¸­çš„ä»£ç åˆ é™¤å³å¯ï¼Œå³ä¿è¯ test1.c å’Œ test.c å†…ä»£ç ä¸åŒ å¦‚æœæ­¤æ—¶æ¢ä¸€ä¸‹é“¾æ¥é¡ºåºå‘¢ï¼Ÿä¾‹å¦‚ï¼š clang -o demo1 test.o test1.o å¤šä¸ªæºç ä¸€æ¬¡æ€§ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š clang -o demo2 test1.c test.c å¯¹æ¯”ä¸Šè¿°ç”Ÿæˆä¸‰ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Ÿè¿™é‡Œæˆ‘ä»¬ä¹Ÿé€šè¿‡ md5 ç”Ÿæˆçš„ hashå€¼ è¿›è¡Œå¯¹æ¯”ï¼š 123456% md5 demoMD5 (demo) = 4be533adc572558230adcbd067379fea% md5 demo1MD5 (demo1) = a3ff882d7d541fe3bc2a11538bc2e031% md5 demo2MD5 (demo2) = 4be533adc572558230adcbd067379fea ç»“è®ºï¼šé€šè¿‡å¯¹æ¯”å‘ç°ï¼Œå¦‚æœæ”¹å˜äº† .oæ–‡ä»¶çš„ è¿æ¥é¡ºåºï¼Œé‚£ä¹ˆ Mach-O ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ è¿™é‡Œå¯ä»¥é€šè¿‡ objdump --macho -d demo æŸ¥çœ‹ Mach-O é“¾æ¥é¡ºåºï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829% objdump --macho -d demodemo:(__TEXT,__text) section_main:100003f30: 55 pushq %rbp100003f31: 48 89 e5 movq %rsp, %rbp100003f34: 48 83 ec 10 subq $16, %rsp100003f38: c7 45 fc 00 00 00 00 movl $0, -4(%rbp)100003f3f: c7 45 f8 01 00 00 00 movl $1, -8(%rbp)100003f46: 8b 75 f8 movl -8(%rbp), %esi100003f49: 48 8d 3d 56 00 00 00 leaq 86(%rip), %rdi ## literal pool for: &quot;result \\344\\270\\272: %d&quot;100003f50: b0 00 movb $0, %al100003f52: e8 2d 00 00 00 callq 0x100003f84 ## symbol stub for: _printf100003f57: 31 c0 xorl %eax, %eax100003f59: 48 83 c4 10 addq $16, %rsp100003f5d: 5d popq %rbp100003f5e: c3 retq100003f5f: 90 nop_addtwonum:100003f60: 55 pushq %rbp100003f61: 48 89 e5 movq %rsp, %rbp100003f64: 48 8d 0d a9 40 00 00 leaq _y(%rip), %rcx100003f6b: 48 8d 05 9e 40 00 00 leaq _x(%rip), %rax100003f72: c7 00 01 00 00 00 movl $1, (%rax)100003f78: c7 01 02 00 00 00 movl $2, (%rcx)100003f7e: 8b 00 movl (%rax), %eax100003f80: 03 01 addl (%rcx), %eax100003f82: 5d popq %rbp100003f83: c3 retq æºæ–‡ä»¶é“¾æ¥é¡ºåºæ˜¯ main + addtwonum è¿™é‡Œå¯ä»¥é€šè¿‡ objdump --macho -d demo1 æŸ¥çœ‹ Mach-O é“¾æ¥é¡ºåºï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940% objdump --macho -d demo1demo1:(__TEXT,__text) section_addtwonum:100003f20: 55 pushq %rbp100003f21: 48 89 e5 movq %rsp, %rbp100003f24: 48 8d 0d e9 40 00 00 leaq _y(%rip), %rcx100003f2b: 48 8d 05 de 40 00 00 leaq _x(%rip), %rax100003f32: c7 00 01 00 00 00 movl $1, (%rax)100003f38: c7 01 02 00 00 00 movl $2, (%rcx)100003f3e: 8b 00 movl (%rax), %eax100003f40: 03 01 addl (%rcx), %eax100003f42: 5d popq %rbp100003f43: c3 retq100003f44: 90 nop100003f45: 90 nop100003f46: 90 nop100003f47: 90 nop100003f48: 90 nop100003f49: 90 nop100003f4a: 90 nop100003f4b: 90 nop100003f4c: 90 nop100003f4d: 90 nop100003f4e: 90 nop100003f4f: 90 nop_main:100003f50: 55 pushq %rbp100003f51: 48 89 e5 movq %rsp, %rbp100003f54: 48 83 ec 10 subq $16, %rsp100003f58: c7 45 fc 00 00 00 00 movl $0, -4(%rbp)100003f5f: c7 45 f8 01 00 00 00 movl $1, -8(%rbp)100003f66: 8b 75 f8 movl -8(%rbp), %esi100003f69: 48 8d 3d 32 00 00 00 leaq 50(%rip), %rdi ## literal pool for: &quot;result \\344\\270\\272: %d&quot;100003f70: b0 00 movb $0, %al100003f72: e8 09 00 00 00 callq 0x100003f80 ## symbol stub for: _printf100003f77: 31 c0 xorl %eax, %eax100003f79: 48 83 c4 10 addq $16, %rsp100003f7d: 5d popq %rbp100003f7e: c3 retq æºæ–‡ä»¶çš„é“¾æ¥é¡ºåºæ˜¯ addtwonum + main è¿™é‡Œå¯ä»¥é€šè¿‡ objdump --macho -d demo2 æŸ¥çœ‹ Mach-O é“¾æ¥é¡ºåºï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930% objdump --macho -d demo2demo2:(__TEXT,__text) section_main:100003f30: 55 pushq %rbp100003f31: 48 89 e5 movq %rsp, %rbp100003f34: 48 83 ec 10 subq $16, %rsp100003f38: c7 45 fc 00 00 00 00 movl $0, -4(%rbp)100003f3f: c7 45 f8 01 00 00 00 movl $1, -8(%rbp)100003f46: 8b 75 f8 movl -8(%rbp), %esi100003f49: 48 8d 3d 56 00 00 00 leaq 86(%rip), %rdi ## literal pool for: &quot;result \\344\\270\\272: %d&quot;100003f50: b0 00 movb $0, %al100003f52: e8 2d 00 00 00 callq 0x100003f84 ## symbol stub for: _printf100003f57: 31 c0 xorl %eax, %eax100003f59: 48 83 c4 10 addq $16, %rsp100003f5d: 5d popq %rbp100003f5e: c3 retq100003f5f: 90 nop_addtwonum:100003f60: 55 pushq %rbp100003f61: 48 89 e5 movq %rsp, %rbp100003f64: 48 8d 0d a9 40 00 00 leaq _y(%rip), %rcx100003f6b: 48 8d 05 9e 40 00 00 leaq _x(%rip), %rax100003f72: c7 00 01 00 00 00 movl $1, (%rax)100003f78: c7 01 02 00 00 00 movl $2, (%rcx)100003f7e: 8b 00 movl (%rax), %eax100003f80: 03 01 addl (%rcx), %eax100003f82: 5d popq %rbp100003f83: c3 retq æºæ–‡ä»¶çš„é“¾æ¥é¡ºåºæ˜¯ main + addtwonum ä¸Šè¿°æ‰€è¯´çš„é“¾æ¥é¡ºåºï¼Œå¯¹åº”åˆ°æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æ˜¯æŒ‡å·¥ç¨‹ä¸­çš„ target -&gt; Build Phase -&gt; Compiles Sourcesï¼Œè¿™é‡Œå°±æ˜¯å¯¹åº”æºæ–‡ä»¶çš„ ç¼–è¯‘é¡ºåºï¼Œå¦‚æœæºæ–‡ä»¶çš„é¡ºåºå‘ç”Ÿäº†å˜åŒ–ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ä¸ä¸€æ ·çš„ åº“ æ–‡ä»¶ ä»€ä¹ˆæ˜¯åº“ï¼Ÿ ä¸»è¦æ˜¯ç¨‹åºä»£ç çš„é›†åˆï¼Œå³å°†Nä¸ªæ–‡ä»¶ç»„ç»‡èµ·æ¥ï¼Œæ˜¯å…±äº«ç¨‹åºä»£ç çš„ä¸€ç§æ–¹å¼ï¼Œ åº“çš„åˆ†ç±» å¼€æºåº“ï¼ˆå…¬æœ‰åº“ï¼‰ï¼šæºç æ˜¯å…¬å¼€çš„ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªæ–‡ä»¶çš„å®ç°ï¼Œä¾‹å¦‚Githubä¸­çš„AFNetworkingã€SDWebImageç­‰ é—­æºåº“ï¼ˆç§æœ‰åº“ï¼‰ï¼šæºç æœªå…¬å¼€ï¼Œæ˜¯ç»è¿‡ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œçœ‹ä¸åˆ°å…·ä½“çš„å®ç°ï¼Œå†ç»†åˆ†åˆåˆ†ä¸º é™æ€åº“ å’Œ åŠ¨æ€åº“ã€‚ é™æ€åº“ &amp; åŠ¨æ€åº“ é™æ€åº“ï¼šé™æ€åº“çš„å­˜åœ¨å½¢å¼ä¸»è¦æœ‰ä¸¤ç§ï¼ˆå»ºè®®ç”¨.frameworkï¼‰ï¼š.a + .framework .a æ˜¯ä¸€ä¸ª çº¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ.a ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè‡³å°‘éœ€è¦.hæ–‡ä»¶é…åˆï¼Œå¯èƒ½è¿˜ä¼šéœ€è¦èµ„æºæ–‡ä»¶ .framework ä¸­é™¤äº†æœ‰äºŒè¿›åˆ¶æ–‡ä»¶å¤–ï¼Œè¿˜æœ‰èµ„æºæ–‡ä»¶ï¼Œä¸”å¯ä»¥ ç›´æ¥ä½¿ç”¨ ä¸¤è€…çš„å…³ç³»ï¼š .a + .h + sourceFile = .frmework ä¼˜åŠ¿ï¼šæ–¹ä¾¿å…±äº«ä»£ç ï¼Œä¾¿äºåˆç†ä½¿ç”¨ å®ç°iOSçš„æ¨¡å—åŒ–ï¼Œå³å°†å›ºå®šä¸šåŠ¡æ¨¡å—åŒ–ä¸ºé™æ€åº“ å…±äº«ä»£ç ï¼Œä½†ä¸å¸Œæœ›è¢«çœ‹åˆ°ä»£ç çš„å…·ä½“å®ç° åŠ¨æ€åº“ï¼šåŠ¨æ€åº“çš„å­˜åœ¨å½¢å¼ä¹Ÿæ˜¯ä¸¤ç§ï¼š.dylib + .framework .framework ä¸ºä»€ä¹ˆå³æ˜¯é™æ€åº“åˆæ˜¯åŠ¨æ€åº“ï¼Ÿ ç³»ç»Ÿçš„ .framework æ˜¯åŠ¨æ€åº“ è‡ªå®šä¹‰çš„ .framework æ˜¯é™æ€åº“ é™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ« é™æ€åº“ åœ¨ é“¾æ¥ æ—¶ä¼šè¢«å®Œæ•´çš„æ‹·è´åˆ°é¡¹ç›®ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªAPPéƒ½æ˜¯ç”¨äº†åŒä¸€ä¸ªé™æ€åº“ï¼Œä¼šæ‹·è´å¤šä»½ï¼Œæµªè´¹å†…å­˜ åŠ¨æ€åº“ ä¸ä¼šå¤åˆ¶ï¼Œåªæœ‰ä¸€ä»½ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ åŠ¨æ€åŠ è½½ åˆ°å†…å­˜ä¸­ï¼Œå¤šä¸ªAPPå…±ç”¨ä¸€ä»½ï¼ŒèŠ‚çº¦å†…å­˜ éªŒè¯ .a .dylib æ˜¯å¦æ˜¯ Mach-Oæ–‡ä»¶1$ cd é¡¹ç›®æ ¹ç›®å½•ä¸‹ éªŒè¯ .a åœ¨é¡¹ç›®ä¸­ï¼Œé€šè¿‡findå‘½ä»¤æŸ¥æ‰¾åˆ° .a æ–‡ä»¶: ç»ˆç«¯è¾“å…¥ find /usr -name &quot;*.a&quot; éšæœºæŸ¥çœ‹ä¸€ä¸ª .a æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ª dynamically ç±»å‹ï¼š file .aæ–‡ä»¶è·¯å¾„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354zhangjian@zhangjiandeMBP SRSF % find /usr -name &quot;*.a&quot;find: /usr/sbin/authserver: Permission denied/usr/local/lib/libbrotlidec-static.a/usr/local/lib/libev.a/usr/local/lib/libjemalloc.a/usr/local/lib/libnghttp2.a/usr/local/lib/libevent_extra.a/usr/local/lib/libevent.a/usr/local/lib/libevent_core.a/usr/local/lib/libprotobuf.a/usr/local/lib/liblz4.a/usr/local/lib/libprotoc.a/usr/local/lib/libprotobuf-lite.a/usr/local/lib/libbrotlienc-static.a/usr/local/lib/libbrotlicommon-static.a/usr/local/lib/libuv.a/usr/local/lib/libzstd.a/usr/local/lib/libevent_openssl.a/usr/local/lib/libmysqlservices.a/usr/local/lib/libjemalloc_pic.a/usr/local/lib/libmysqlclient.a/usr/local/lib/libevent_pthreads.a/usr/local/Cellar/nghttp2/1.43.0/lib/libnghttp2.a/usr/local/Cellar/mysql-client/8.0.25/lib/libmysqlclient.a/usr/local/Cellar/libuv/1.41.0/lib/libuv.a/usr/local/Cellar/jemalloc/5.2.1_1/lib/libjemalloc.a/usr/local/Cellar/jemalloc/5.2.1_1/lib/libjemalloc_pic.a/usr/local/Cellar/brotli/1.0.9/lib/libbrotlidec-static.a/usr/local/Cellar/brotli/1.0.9/lib/libbrotlienc-static.a/usr/local/Cellar/brotli/1.0.9/lib/libbrotlicommon-static.a/usr/local/Cellar/icu4c/69.1/lib/libicui18n.a/usr/local/Cellar/icu4c/69.1/lib/libicutest.a/usr/local/Cellar/icu4c/69.1/lib/libicuio.a/usr/local/Cellar/icu4c/69.1/lib/libicudata.a/usr/local/Cellar/icu4c/69.1/lib/libicuuc.a/usr/local/Cellar/icu4c/69.1/lib/libicutu.a/usr/local/Cellar/lz4/1.9.3/lib/liblz4.a/usr/local/Cellar/zstd/1.5.0/lib/libzstd.a/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlservices.a/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlclient.a/usr/local/Cellar/libevent/2.1.12/lib/libevent_extra.a/usr/local/Cellar/libevent/2.1.12/lib/libevent.a/usr/local/Cellar/libevent/2.1.12/lib/libevent_core.a/usr/local/Cellar/libevent/2.1.12/lib/libevent_openssl.a/usr/local/Cellar/libevent/2.1.12/lib/libevent_pthreads.a/usr/local/Cellar/openssl@1.1/1.1.1k/lib/libcrypto.a/usr/local/Cellar/openssl@1.1/1.1.1k/lib/libssl.a/usr/local/Cellar/libev/4.33/lib/libev.a/usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf.a/usr/local/Cellar/protobuf/3.17.3/lib/libprotoc.a/usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf-lite.a% file /usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf-lite.a/usr/local/Cellar/libevent/2.1.12/lib/libevent_openssl.a: current ar archive random library è¿™ä¸ª.aåº“æ˜¯çœ‹ä¸å‡ºæ¥æ˜¯ dynamicallyç±»å‹ éªŒè¯ .dylib åœ¨é¡¹ç›®ä¸­é€šè¿‡ find æŸ¥æ‰¾ .dylibæ–‡ä»¶ï¼š find /usr -name &quot;*.dylib&quot; æŸ¥çœ‹ .dylib æ–‡ä»¶ï¼š file .dylibæ–‡ä»¶è·¯å¾„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164find: /usr/sbin/authserver: Permission denied/usr/local/Homebrew/Library/Homebrew/test/support/fixtures/mach/fat.dylib/usr/local/Homebrew/Library/Homebrew/test/support/fixtures/mach/i386.dylib/usr/local/Homebrew/Library/Homebrew/test/support/fixtures/mach/x86_64.dylib/usr/local/lib/libmysqlrouter_http_auth_backend.1.dylib/usr/local/lib/libmysqlharness_stdx.1.dylib/usr/local/lib/libevent_pthreads-2.1.7.dylib/usr/local/lib/libbrotlidec.1.dylib/usr/local/lib/libuv.dylib/usr/local/lib/libbrotlicommon.1.dylib/usr/local/lib/liblz4.1.9.3.dylib/usr/local/lib/libcares.dylib/usr/local/lib/libmysqlharness.1.dylib/usr/local/lib/libbrotlienc.dylib/usr/local/lib/libprotobuf-lite.dylib/usr/local/lib/libevent_openssl-2.1.7.dylib/usr/local/lib/libevent_extra.dylib/usr/local/lib/libbrotlienc.1.dylib/usr/local/lib/libuv.1.dylib/usr/local/lib/libevent_extra-2.1.7.dylib/usr/local/lib/libprotoc.28.dylib/usr/local/lib/libprotobuf.28.dylib/usr/local/lib/libmysqlharness_tls.1.dylib/usr/local/lib/libevent.dylib/usr/local/lib/libcares.2.dylib/usr/local/lib/libcares.2.4.2.dylib/usr/local/lib/libbrotlienc.1.0.9.dylib/usr/local/lib/libmysqlclient.21.dylib/usr/local/lib/libev.dylib/usr/local/lib/libprotoc.dylib/usr/local/lib/libzstd.1.5.0.dylib/usr/local/lib/libevent-2.1.7.dylib/usr/local/lib/libevent_pthreads.dylib/usr/local/lib/liblz4.dylib/usr/local/lib/libmysqlrouter_io_component.1.dylib/usr/local/lib/libmysqlrouter_http.1.dylib/usr/local/lib/libjemalloc.2.dylib/usr/local/lib/libnghttp2.14.dylib/usr/local/lib/libprotobuf.dylib/usr/local/lib/libmysqlclient.dylib/usr/local/lib/libevent_openssl.dylib/usr/local/lib/liblz4.1.dylib/usr/local/lib/libmysqlrouter_http_auth_realm.1.dylib/usr/local/lib/libbrotlicommon.dylib/usr/local/lib/libnghttp2.dylib/usr/local/lib/libzstd.1.dylib/usr/local/lib/libbrotlidec.dylib/usr/local/lib/libmysqlrouter.1.dylib/usr/local/lib/libbrotlidec.1.0.9.dylib/usr/local/lib/libevent_core.dylib/usr/local/lib/libbrotlicommon.1.0.9.dylib/usr/local/lib/libev.4.dylib/usr/local/lib/libzstd.dylib/usr/local/lib/libjemalloc.dylib/usr/local/lib/libprotobuf-lite.28.dylib/usr/local/lib/libevent_core-2.1.7.dylib/usr/local/Cellar/nghttp2/1.43.0/lib/libnghttp2.14.dylib/usr/local/Cellar/nghttp2/1.43.0/lib/libnghttp2.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/libssl.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/libssl.1.1.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/plugin/libssl.1.1.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/plugin/libcrypto.1.1.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/libmysqlclient.21.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/libcrypto.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/libmysqlclient.dylib/usr/local/Cellar/mysql-client/8.0.25/lib/libcrypto.1.1.dylib/usr/local/Cellar/libuv/1.41.0/lib/libuv.dylib/usr/local/Cellar/libuv/1.41.0/lib/libuv.1.dylib/usr/local/Cellar/jemalloc/5.2.1_1/lib/libjemalloc.2.dylib/usr/local/Cellar/jemalloc/5.2.1_1/lib/libjemalloc.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlidec.1.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlicommon.1.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlienc.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlienc.1.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlienc.1.0.9.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlicommon.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlidec.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlidec.1.0.9.dylib/usr/local/Cellar/brotli/1.0.9/lib/libbrotlicommon.1.0.9.dylib/usr/local/Cellar/icu4c/69.1/lib/libicui18n.69.dylib/usr/local/Cellar/icu4c/69.1/lib/libicuio.69.1.dylib/usr/local/Cellar/icu4c/69.1/lib/libicuio.dylib/usr/local/Cellar/icu4c/69.1/lib/libicuuc.69.dylib/usr/local/Cellar/icu4c/69.1/lib/libicutest.dylib/usr/local/Cellar/icu4c/69.1/lib/libicudata.dylib/usr/local/Cellar/icu4c/69.1/lib/libicudata.69.dylib/usr/local/Cellar/icu4c/69.1/lib/libicutu.69.1.dylib/usr/local/Cellar/icu4c/69.1/lib/libicui18n.69.1.dylib/usr/local/Cellar/icu4c/69.1/lib/libicuuc.dylib/usr/local/Cellar/icu4c/69.1/lib/libicutu.dylib/usr/local/Cellar/icu4c/69.1/lib/libicui18n.dylib/usr/local/Cellar/icu4c/69.1/lib/libicutest.69.dylib/usr/local/Cellar/icu4c/69.1/lib/libicudata.69.1.dylib/usr/local/Cellar/icu4c/69.1/lib/libicutest.69.1.dylib/usr/local/Cellar/icu4c/69.1/lib/libicuuc.69.1.dylib/usr/local/Cellar/icu4c/69.1/lib/libicuio.69.dylib/usr/local/Cellar/icu4c/69.1/lib/libicutu.69.dylib/usr/local/Cellar/lz4/1.9.3/lib/liblz4.1.9.3.dylib/usr/local/Cellar/lz4/1.9.3/lib/liblz4.dylib/usr/local/Cellar/lz4/1.9.3/lib/liblz4.1.dylib/usr/local/Cellar/c-ares/1.17.1/lib/libcares.dylib/usr/local/Cellar/c-ares/1.17.1/lib/libcares.2.dylib/usr/local/Cellar/c-ares/1.17.1/lib/libcares.2.4.2.dylib/usr/local/Cellar/zstd/1.5.0/lib/libzstd.1.5.0.dylib/usr/local/Cellar/zstd/1.5.0/lib/libzstd.1.dylib/usr/local/Cellar/zstd/1.5.0/lib/libzstd.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlrouter_http_auth_backend.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlharness_stdx.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlharness.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlharness_tls.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlclient.21.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlrouter_io_component.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlrouter_http.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlclient.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlrouter_http_auth_realm.1.dylib/usr/local/Cellar/mysql/8.0.25_1/lib/libmysqlrouter.1.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_pthreads-2.1.7.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_openssl-2.1.7.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_extra.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_extra-2.1.7.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent-2.1.7.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_pthreads.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_openssl.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_core.dylib/usr/local/Cellar/libevent/2.1.12/lib/libevent_core-2.1.7.dylib/usr/local/Cellar/openssl@1.1/1.1.1k/lib/libssl.dylib/usr/local/Cellar/openssl@1.1/1.1.1k/lib/libssl.1.1.dylib/usr/local/Cellar/openssl@1.1/1.1.1k/lib/libcrypto.dylib/usr/local/Cellar/openssl@1.1/1.1.1k/lib/engines-1.1/padlock.dylib/usr/local/Cellar/openssl@1.1/1.1.1k/lib/engines-1.1/capi.dylib/usr/local/Cellar/openssl@1.1/1.1.1k/lib/libcrypto.1.1.dylib/usr/local/Cellar/libev/4.33/lib/libev.dylib/usr/local/Cellar/libev/4.33/lib/libev.4.dylib/usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf-lite.dylib/usr/local/Cellar/protobuf/3.17.3/lib/libprotoc.28.dylib/usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf.28.dylib/usr/local/Cellar/protobuf/3.17.3/lib/libprotoc.dylib/usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf.dylib/usr/local/Cellar/protobuf/3.17.3/lib/libprotobuf-lite.28.dylib/usr/lib/libobjc-trampolines.dylib/usr/lib/libLeaksAtExit.dylib/usr/lib/libstdc++.6.dylib/usr/lib/libpython2.7.dylib/usr/lib/libhunspell-1.2.0.dylib/usr/lib/libMTLCapture.dylib/usr/lib/system/libsystem_pthread.dylib/usr/lib/system/introspection/libsystem_pthread.dylib/usr/lib/system/introspection/libdispatch.dylib/usr/lib/system/libsystem_kernel.dylib/usr/lib/system/libsystem_platform.dylib/usr/lib/libgmalloc.dylib/usr/lib/swift/libswiftRemoteMirror.dylib/usr/lib/swift/libswiftCreateML.dylib/usr/lib/libiodbc.2.dylib/usr/lib/libffi-trampolines.dylib/usr/lib/ssh-keychain.dylib/usr/lib/libpython.dylib/usr/lib/libiodbcinst.2.dylib% file /usr/lib/libpython.dylib/usr/lib/libpython.dylib: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit dynamically linked shared library x86_64] [arm64e]/usr/lib/libpython.dylib (for architecture x86_64): Mach-O 64-bit dynamically linked shared library x86_64/usr/lib/libpython.dylib (for architecture arm64e): Mach-O 64-bit dynamically linked shared library arm64e å¯æ‰§è¡Œæ–‡ä»¶ è¿™é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå³ä¸€èˆ¬æ˜¯æŒ‡æ—¥å¸¸é¡¹ç›®ä¸­ï¼Œç¼–è¯‘åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ file æŸ¥çœ‹å…¶æ–‡ä»¶ç±»å‹ 12% file /Users/zhangjian/Desktop/demo1 /Users/zhangjian/Desktop/demo1: Mach-O 64-bit executable x86_64 dyld dyldï¼ˆthe dynamic link editorï¼‰æ˜¯è‹¹æœçš„ åŠ¨æ€è¿æ¥å™¨ï¼Œæ˜¯è‹¹æœæ“ä½œç³»ç»Ÿä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œåœ¨ç³»ç»Ÿå†…æ ¸åšå¥½ç¨‹åºå‡†å¤‡å·¥ä½œä¹‹åï¼Œäº¤ç”±dyldè´Ÿè´£ä½™ä¸‹çš„å·¥ä½œï¼Œè€Œä¸”å®ƒæ˜¯å¼€æºçš„ï¼Œä»»ä½•äººå¯ä»¥é€šè¿‡è‹¹æœå®˜ç½‘ä¸‹è½½å®ƒçš„æºç æ¥é˜…è¯»ç†è§£å®ƒçš„è¿ä½œæ–¹å¼ï¼Œäº†è§£ç³»ç»ŸåŠ è½½åŠ¨æ€åº“çš„ç»†èŠ‚ã€‚ å…±äº«ç¼“å­˜æœºåˆ¶ åœ¨iOSç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç¨‹åºä¾èµ–çš„åŠ¨æ€åº“éƒ½éœ€è¦é€šè¿‡dyldï¼ˆä½äº&#x2F;usr&#x2F;lib&#x2F;dyldï¼‰ä¸€ä¸ªä¸€ä¸ª åŠ è½½åˆ°å†…å­˜ï¼Œç„¶è€Œï¼Œå¾ˆå¤šç³»ç»Ÿåº“å‡ ä¹æ˜¯æ¯ä¸ªç¨‹åºéƒ½ä¼šç”¨åˆ°çš„ï¼Œå¦‚æœåœ¨æ¯ä¸ªç¨‹åºè¿è¡Œçš„æ—¶å€™éƒ½é‡å¤çš„å»åŠ è½½ä¸€æ¬¡ï¼ŒåŠ¿å¿…é€ æˆè¿è¡Œç¼“æ…¢ï¼Œä¸ºäº†ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦å’Œæé«˜ç¨‹åºæ€§èƒ½ï¼Œå…±äº«ç¼“å­˜æœºåˆ¶å°±åº”è¿è€Œç”Ÿã€‚æ‰€æœ‰é»˜è®¤çš„åŠ¨æ€é“¾æ¥åº“è¢«åˆå¹¶æˆä¸€ä¸ªå¤§çš„ç¼“å­˜æ–‡ä»¶ï¼Œæ”¾åˆ°/System/Library/Caches/com.apple.dyld/ç›®å½•ä¸‹ï¼ŒæŒ‰ç…§ä¸åŒçš„æ¶æ„åˆ†åˆ«ä¿å­˜ç€ éªŒè¯dyld æŸ¥æ‰¾Macä¸­çš„dyld 12345678910111213141516171819202122zhangjian@zhangjiandeMBP ~ % cd /usr/lib zhangjian@zhangjiandeMBP lib % lscharset.alias libstdc++.6.dylibcron logdsc_extractor.bundle pamdtrace pkgconfigdyld python2.7groff rpcsvclibLeaksAtExit.dylib rubylibMTLCapture.dylib sasl2libffi-trampolines.dylib sqlite3libgmalloc.dylib ssh-keychain.dyliblibhunspell-1.2.0.dylib swiftlibiodbc.2.dylib systemlibiodbcinst.2.dylib updaterslibobjc-trampolines.dylib xpclibpython.dylib zshlibpython2.7.dylibzhangjian@zhangjiandeMBP lib % ls dylddyld æŸ¥çœ‹ dyldçš„æ–‡ä»¶ç±»å‹ï¼š file dyldï¼Œæ˜¯ä¸€ä¸ª åŠ¨æ€é“¾æ¥å™¨ï¼Œå…¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªMach-Oæ–‡ä»¶ 12345zhangjian@zhangjiandeMBP lib % file dylddyld: Mach-O universal binary with 3 architectures: [i386:Mach-O dynamic linker i386] [x86_64:Mach-O 64-bit dynamic linker x86_64] [arm64e]dyld (for architecture i386): Mach-O dynamic linker i386dyld (for architecture x86_64): Mach-O 64-bit dynamic linker x86_64dyld (for architecture arm64e): Mach-O 64-bit dynamic linker arm64e dsymæ–‡ä»¶ dsymä»‹ç» Xcodeç¼–è¯‘é¡¹ç›®åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªåŒåçš„ dSYMæ–‡ä»¶ï¼ŒdSYMæ˜¯ ä¿å­˜16è¿›åˆ¶å‡½æ•°åœ°å€æ˜ å°„ä¿¡æ¯çš„ä¸­è½¬æ–‡ä»¶ï¼Œæˆ‘ä»¬è°ƒè¯•çš„ symbols éƒ½ä¼šåŒ…å«åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ¯æ¬¡ç¼–è¯‘é¡¹ç›®çš„æ—¶å€™éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ dSYMæ–‡ä»¶ï¼Œä½äº/Users/&lt;ç”¨æˆ·å&gt;/Library/Developer/Xcode/Archivesç›®å½•ä¸‹ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬æˆ‘ä»¬éƒ½å¾ˆæœ‰å¿…è¦ä¿å­˜å¯¹åº”çš„ Archives æ–‡ä»¶ã€‚ å½“æˆ‘ä»¬è½¯ä»¶ release æ¨¡å¼æ‰“åŒ…æˆ–ä¸Šçº¿åï¼Œä¸ä¼šåƒæˆ‘ä»¬åœ¨xcodeä¸­é‚£æ ·ç›´è§‚çš„çœ‹åˆ° å´©æºƒ çš„é”™è¯¯æ—¥å¿—ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ åˆ†æcrash reportæ–‡ä»¶äº†ï¼ŒiOSè®¾å¤‡ä¸­ä¼šæœ‰æ—¥å¿—æ–‡ä»¶ä¿å­˜æˆ‘ä»¬æ¯ä¸ªåº”ç”¨å‡ºé”™çš„å‡½æ•°å†…å­˜åœ°å€ï¼Œé€šè¿‡ xcode çš„ organizer å¯ä»¥å°†iOSè®¾å¤‡ä¸­çš„ deviceLog å¯¼å‡ºæˆ crashæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ é€šè¿‡å‡ºé”™çš„å‡½æ•°åœ°å€å» æŸ¥è¯¢dSYM æ–‡ä»¶ä¸­ç¨‹åºå¯¹åº”çš„å‡½æ•°å’Œæ–‡ä»¶åï¼Œä½†å‰ææ˜¯æˆ‘ä»¬éœ€è¦æœ‰è½¯ä»¶ç‰ˆæœ¬å¯¹åº”çš„dSYMæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾ˆæœ‰å¿…è¦ä¿å­˜æ¯ä¸ªå‘å¸ƒç‰ˆæœ¬çš„ Archives æ–‡ä»¶äº† éªŒè¯ .dSYMæ–‡ä»¶ ç¨‹åº çœŸæœº+release ç¼–è¯‘æ—¶ï¼Œæœ‰ä¸€ä¸ª .dSYMæ–‡ä»¶ .dSYM ä¹Ÿæ˜¯ä¸€ä¸ª mach-o æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ª ç¬¦å·è¡¨ï¼Œä¸»è¦ç”¨äºå‡ºç°å´©æºƒåå¯ä»¥é€šè¿‡è¿™ä¸ªæ–‡ä»¶ å–ç¬¦å·ï¼Œæ–¹ä¾¿ æŸ¥è¯¢é—®é¢˜ é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶macç³»ç»Ÿæ‰€æ”¯æŒçš„cpuåŠç¡¬ä»¶å¹³å°å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ï¼Œä¸ºäº†è§£å†³è½¯ä»¶åœ¨å¤šä¸ªå¹³å°ç¡¬ä»¶å¹³å°ä¸Šçš„ å…¼å®¹æ€§ é—®é¢˜ï¼Œè‹¹æœå¼€å‘äº†ä¸€ä¸ª é€šç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ï¼ˆUniversal Binaryï¼‰ï¼Œåˆç§° èƒ–äºŒè¿›åˆ¶ï¼ˆFat Binaryï¼‰ è‹¹æœå…¬å¸æå‡ºçš„ä¸€ç§ç¨‹åºä»£ç ï¼Œèƒ½åŒæ—¶ é€‚ç”¨å¤šç§æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶ åŒä¸€ä¸ªç¨‹åºåŒ…ä¸­åŒæ—¶ä¸ºå¤šç§æ¶æ„æä¾›æœ€ç†æƒ³çš„æ€§èƒ½ã€‚ å› ä¸ºéœ€è¦å­˜å‚¨å¤šç§ä»£ç ï¼Œé€šç”¨äºŒè¿›åˆ¶åº”ç”¨ç¨‹åºé€šå¸¸æ¯”å•ä¸€å¹³å°äºŒè¿›åˆ¶çš„ç¨‹åºè¦å¤§ ä½†æ˜¯ç”±äºä¸¤ç§æ¶æ„æœ‰ å…±é€šçš„éæ‰§è¡Œèµ„æºï¼ˆä»£ç ä»¥å¤–çš„ï¼‰ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¾¾åˆ°å•ä¸€ç‰ˆæœ¬çš„ä¸¤å€ä¹‹å¤š è€Œä¸”ç”±äºæ‰§è¡Œä¸­åªè°ƒç”¨ä¸€éƒ¨åˆ†ä»£ç ï¼Œè¿è¡Œèµ·æ¥ä¹Ÿä¸éœ€è¦é¢å¤–çš„å†…å­˜ æ¼”ç¤º åœ¨æ—¥å¸¸å¼€å‘çš„é¡¹ç›®ä¸­ï¼Œå¯ä»¥é€šè¿‡Build Setting -&gt; Mach-O typeï¼ŒæŒ‡å®š Mach-Oæ–‡ä»¶çš„ç±»å‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡çœŸæœºç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå…¶æ¶æ„æ˜¯arm64ï¼Œæ˜¯ä¸€ä¸ªå•ä¸€æ¶æ„ iOS 9.0 ä»¥ä¸Šçš„ç³»ç»Ÿå¦æ”¯æŒ 64ä½æ¶æ„ 123% cd /Users/zhangjian/Library/Developer/Xcode/DerivedData/SRSF-bzdqlauzaknekvclilbreawtebqi/Build/Products/Debug-iphoneos/ä¸­å›¾äº‘ä¹¦æˆ¿.app% file ä¸­å›¾äº‘ä¹¦æˆ¿ ä¸­å›¾äº‘ä¹¦æˆ¿: Mach-O 64-bit executable arm64 åŒæ—¶ä¹Ÿå¯ä»¥åœ¨ Build Setting -&gt; Architectures ä¸­è®¾å€¼ç¼–è¯‘çš„ æ¶æ„ ç¯å¢ƒå˜é‡ $(ARCHS_STANDRAD) ï¼šåŒ…å« arm64ã€armv7 è¿˜æœ‰ä¸€ç§æ¶æ„ï¼šarmv7sï¼ŒiPhone5ã€iPhone5cå¯ç”¨çš„æ¶æ„ï¼Œå¯åœ¨å·¥ç¨‹ä¸­æ·»åŠ ï¼Œæ­¤æ—¶æŸ¥çœ‹ Release + çœŸæœºç¯å¢ƒ å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¯æŒ3ä¸ªæ¶æ„ 1234567% cd /Users/zhangjian/Library/Developer/Xcode/DerivedData/Demo-edwjvapoqaffzeeiyzyhfryhfrsr/Build/Products/Release-iphoneos/Demo.app % file DemoDemo: Mach-O universal binary with 3 architectures: [arm_v7:Mach-O executable arm_v7] [arm_v7s:Mach-O executable arm_v7s] [arm64:Mach-O 64-bit executable arm64]Demo (for architecture armv7): Mach-O executable arm_v7Demo (for architecture armv7s): Mach-O executable arm_v7sDemo (for architecture arm64): Mach-O 64-bit executable arm64 ARMæ¶æ„ARMæ¶æ„è¿‡å»ç§°ä½œ è¿›é˜¶ç²¾ç®€æŒ‡ä»¤é›†æœºå™¨ï¼ˆAdvanced RISC Machineï¼Œæ›´æ—©ç§°ä½œï¼šAcorn RISC Machineï¼‰ï¼Œæ˜¯ä¸€ä¸ª 32ä½ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰å¤„ç†å™¨æ¶æ„ï¼ŒARMå¤„ç†å™¨éå¸¸é€‚ç”¨äºé€šè®¯é¢†åŸŸï¼Œç¬¦åˆå…¶ä¸»è¦è®¾è®¡ç›®æ ‡ä¸ºä½è€—ç”µçš„ç‰¹æ€§ ARMå’ŒIntelå¤„ç†å™¨çš„ç¬¬ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå‰è€…ä½¿ç”¨ ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰,è€Œåè€…ä½¿ç”¨ å¤æ‚æŒ‡ä»¤é›†ï¼ˆCISCï¼‰ ARMå¤„ç†å™¨æŒ‡ä»¤é›†ï¼šæ˜¯æŒ‡è®¡ç®—æœºARMæ“ä½œç³»ç»ŸæŒ‡ä»¤ç³»ç»Ÿ armv6ã€armv7ã€armv7sã€arm64ã€arm64e éƒ½æ˜¯armå¤„ç†å™¨çš„æŒ‡ä»¤é›†ï¼Œæ‰€æœ‰æŒ‡ä»¤é›†åŸåˆ™ä¸Šéƒ½æ˜¯ å‘ä¸‹å…¼å®¹ çš„ è‹¹æœA7å¤„ç†å™¨æ”¯æŒä¸¤ä¸ªä¸åŒçš„æŒ‡ä»¤é›†ï¼š 32ä½ ARMæŒ‡ä»¤é›†ï¼ˆarmv6 | armv7 | armv7sï¼‰64ä½ ARMæŒ‡ä»¤é›†ï¼ˆarm64ï¼‰ i386 | x86_64 æ˜¯ Mac å¤„ç†å™¨çš„æŒ‡ä»¤é›† iOS è®¾å¤‡æ”¯æŒçš„æŒ‡ä»¤é›† é€šç”¨äºŒè¿›åˆ¶æºç  é€šè¿‡ CMD + shift + O æœç´¢ fat.h æ‰¾åˆ°å…¶ä¸­é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶çš„å¤´éƒ¨ç»“æ„ fat_header å¦‚ä¸‹æ‰€ç¤º 1234struct fat_header &#123; uint32_t magic; /* magicå­—æ®µè¢«å®šä¹‰ä¸ºå¸¸é‡FAT_MAGICï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªèƒ–äºŒè¿›åˆ¶ */ uint32_t nfat_arch; /* è¡¨ç¤ºæœ‰å¤šå°‘ä¸ªMach-Oæ–‡ä»¶ */&#125;; æ¯ä¸ªèƒ–äºŒè¿›åˆ¶éƒ½ç”¨ fat_arch ç»“æ„è¡¨ç¤ºï¼Œåœ¨ fat_header ä¹‹åï¼Œç´§æ¥ç€ä¸€ä¸ªæ´»å¤šä¸ªè¿ç»­çš„fat_archç»“æ„ä½“ 1234567struct fat_arch &#123; cpu_type_t cputype; /* cpu ç±»å‹ */ cpu_subtype_t cpusubtype; /* cpuçš„å­ç±»å‹ */ uint32_t offset; /* åˆ¶å®šäº†å½“å‰cpuæ¶æ„æ•°æ®ç›¸å¯¹äºå½“å‰æ–‡ä»¶å¼€å¤´çš„åç§»é‡ */ uint32_t size; /* æ•°æ®çš„å¤§å° */ uint32_t align; /* æ•°æ®çš„å†…å­˜å¯¹é½è¾¹ç•Œï¼Œå–å€¼å¿…é¡»æ˜¯2çš„æ¬¡æ–¹ï¼Œå®ƒç¡®ä¿äº†å½“å‰cpuæ¶æ„çš„ç›®æ ‡æ–‡ä»¶åœ¨åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œæ•°æ®æ˜¯ç»è¿‡å†…å­˜ä¼˜åŒ–å¯¹é½çš„ */&#125;; ç»ˆç«¯æŒ‡ä»¤ å¯ä»¥é€šè¿‡toolæ¥æŸ¥çœ‹fat_headerä¿¡æ¯ï¼šotool -f å¯æ‰§è¡Œæ–‡ä»¶ 12345678910111213141516171819202122232425262728% cd /Users/zhangjian/Library/Developer/Xcode/DerivedData/Demo-edwjvapoqaffzeeiyzyhfryhfrsr/Build/Products/Release-iphoneos/Demo.app % otool -f DemoFat headersfat_magic 0xcafebabenfat_arch 3architecture 0 cputype 12 cpusubtype 9 capabilities 0x0 offset 16384 size 79280 align 2^14 (16384)architecture 1 cputype 12 cpusubtype 11 capabilities 0x0 offset 98304 size 79280 align 2^14 (16384)architecture 2 cputype 16777228 cpusubtype 0 capabilities 0x0 offset 180224 size 80000 align 2^14 (16384)zhangjian@zhangjiandeMBP Demo.app % å¯ä»¥é€šè¿‡lipoå‘½ä»¤æ‹†åˆ†ã€åˆå¹¶èƒ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¸¸ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š $lipo -info MachOæ–‡ä»¶ï¼šä½¿ç”¨lifo -info å¯ä»¥æŸ¥çœ‹MachOæ–‡ä»¶åŒ…å«çš„æ¶æ„ $lipo MachOæ–‡ä»¶ -thin æ¶æ„ -output è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼šä½¿ç”¨lipo -thin æ‹†åˆ†æŸç§æ¶æ„ $lipo -create MachO1 MachO2 -output è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼šä½¿ç”¨lipo -create åˆå¹¶ å¤šç§æ¶æ„ lipoæ¼”ç¤º æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«çš„æ¶æ„ï¼šlipo -info Demo 1234% cd /Users/zhangjian/Library/Developer/Xcode/DerivedData/Demo-edwjvapoqaffzeeiyzyhfryhfrsr/Build/Products/Release-iphoneos/Demo.app % lipo -info Demo Architectures in the fat file: Demo are: armv7 armv7s arm64 æ‹†åˆ†ï¼šlipo Demo -thin armv7 -output Demo_armv7ï¼Œå¦‚æœæ‹†åˆ†æ²¡æœ‰çš„æ¶æ„ä¼šæŠ¥é”™ æŸ¥çœ‹æ‹†åˆ†åçš„å¯æ‰§è¡Œæ–‡ä»¶ç±»å‹ï¼šfile Demo_armv7 123% lipo Demo -thin armv7 -output Demo_armv7% file Demo_armv7Demo_armv7: Mach-O executable arm_v7 åˆå¹¶ï¼šlipo -create Demo_armv7 Demo_arm64 -output Demo_v7_64 æ€»ç»“ Mach-O å…¶å®æ˜¯ Mach Objectæ–‡ä»¶æ ¼å¼çš„ç¼©å†™ï¼Œæ˜¯macä»¥åŠiOSä¸Šå¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œæ˜¯ä¸€ç§ ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡ä»£ç ã€åŠ¨æ€åº“çš„æ–‡ä»¶æ ¼å¼ï¼Œä¸” Mach-Oæä¾›äº†æ›´å¼ºçš„æ‰©å±•æ€§ å¸¸è§çš„Mach-Oæ ¼å¼ï¼š.oã€åº“æ–‡ä»¶ï¼ˆ.aã€.dylibã€.frameworkï¼‰ã€å¯æ‰§è¡Œæ–‡ä»¶ã€dyldã€.dsym .a + .h + sourceFile = .framwork åŠ¨æ€.frameworkï¼šç³»ç»ŸFrameworkåº“ é™æ€.framworkï¼šè‡ªå®šä¹‰çš„Frameworkåº“ æŸ¥çœ‹æ–‡ä»¶ç±»å‹å‘½ä»¤ï¼šfile æ–‡ä»¶è·¯å¾„ æŸ¥çœ‹Mach-Oæºæ–‡ä»¶çš„é“¾æ¥é¡ºåºï¼šobjdump --macho -d å¯æ‰§è¡Œæ–‡ä»¶ dyldï¼ˆthe dynamic link editorï¼‰æ˜¯è‹¹æœçš„åŠ¨æ€é“¾æ¥å™¨ï¼Œmacä¸­è·¯å¾„ä¸º&#x2F;usr&#x2F;lib dSYM æ˜¯ä¿å­˜ 16 è¿›åˆ¶å‡½æ•°åœ°å€æ˜ å°„ä¿¡æ¯çš„ä¸­è½¬æ–‡ä»¶ï¼Œä½äº/Users/&lt;ç”¨æˆ·å&gt;/Library/Developer/Xcode/Archivesç›®å½•ã€‚å¯ä»¥ç”¨äºé€šè¿‡å‡ºé”™çš„å‡½æ•°åœ°å€å»æŸ¥è¯¢ dSYM æ–‡ä»¶ä¸­ç¨‹åºå¯¹åº”çš„å‡½æ•°åå’Œæ–‡ä»¶å é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆUniversal Binaryï¼Œä¹Ÿç§°ä¸ºèƒ–äºŒè¿›åˆ¶ï¼ˆFat Binaryï¼‰ï¼‰ã€‚ä¸»è¦é€‚ç”¨äºè§£å†³å¤šä¸ªå¹³å°çš„å…¼å®¹æ€§é—®é¢˜ é€šè¿‡otoolæ¥æŸ¥çœ‹fat_headerä¿¡æ¯ï¼šotool -f å¯æ‰§è¡Œæ–‡ä»¶ lipoå‘½ä»¤æ‹†åˆ†ã€åˆå¹¶èƒ–äºŒè¿›åˆ¶æ–‡ä»¶ $lipo -info MachOæ–‡ä»¶ï¼šä½¿ç”¨lifo -info å¯ä»¥æŸ¥çœ‹MachOæ–‡ä»¶åŒ…å«çš„æ¶æ„ $lipo MachOæ–‡ä»¶ â€“thin æ¶æ„ â€“output è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼šä½¿ç”¨lifo â€“thin æ‹†åˆ†æŸç§æ¶æ„ $lipo -create MachO1 MachO2 -output è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼š ä½¿ç”¨lipo -create åˆå¹¶å¤šç§æ¶æ„","categories":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-é€†å‘æ¢ç´¢ç¯‡","slug":"OC-é€†å‘æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E9%80%86%E5%90%91%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†41ï¼šå†…å­˜ä¼˜åŒ–ï¼ˆä¸€ï¼‰é‡æŒ‡é’ˆæ¢æµ‹","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†41ï¼šå†…å­˜ä¼˜åŒ–ï¼ˆä¸€ï¼‰é‡æŒ‡é’ˆæ¢æµ‹","date":"2021-07-22T06:51:26.000Z","updated":"2023-03-03T07:53:22.000Z","comments":true,"path":"2021/07/22/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†41ï¼šå†…å­˜ä¼˜åŒ–ï¼ˆä¸€ï¼‰é‡æŒ‡é’ˆæ¢æµ‹/","link":"","permalink":"https://www.bboyzj.cn/2021/07/22/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8641%EF%BC%9A%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E9%87%8E%E6%8C%87%E9%92%88%E6%8E%A2%E6%B5%8B/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦è®²è§£ä¸¤ç§é‡æŒ‡é’ˆæ£€æµ‹çš„åŸç†å’Œå®ç° æŠ€æœ¯ç‚¹ï¼šé‡æŒ‡é’ˆæ¢æµ‹æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ç†è§£é‡æŒ‡é’ˆçš„å½¢æˆè¿‡ç¨‹ä»¥åŠå¦‚æœå»æ£€æµ‹é‡æŒ‡é’ˆ å¼•å­åœ¨ä»‹ç»é‡æŒ‡é’ˆä¹‹å‰ï¼Œé¦–å…ˆè¯´ä¸‹ç›®å‰çš„å¼‚å¸¸å¤„ç†ç±»å‹ï¼Œé™„ è‹¹æœå®˜ç½‘é“¾æ¥ å¼‚å¸¸ç±»å‹å¼‚å¸¸ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼š è½¯ä»¶å¼‚å¸¸ï¼šä¸»è¦æ¥è‡ª kill()ã€phread_kill()ã€iOSä¸­çš„NSExceptionæœªæ•è·ã€absortç­‰ ç¡¬ä»¶å¼‚å¸¸ï¼šç¡¬ä»¶çš„ä¿¡å·å¤„ç†å™¨trapï¼Œæ˜¯å’Œå¹³å°ç›¸å…³çš„ï¼Œé‡æŒ‡é’ˆå´©æºƒå¤§éƒ¨åˆ†æ˜¯ç¡¬ä»¶å¼‚å¸¸ è€Œå¤„ç†å¼‚å¸¸æ—¶ï¼Œéœ€è¦å…³æ³¨ä¸¤ä¸ªæ¦‚å¿µ Machå¼‚å¸¸ï¼šMachå±‚å¼‚å¸¸ UNIXä¿¡å·ï¼šBSDå±‚è·å– iOSä¸­çš„POSIX APIå°±æ˜¯é€šè¿‡Machä¹‹ä¸Šçš„BSDå±‚å®ç°çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Mach æ˜¯ä¸€ä¸ªå— Acccent å¯å‘è€Œé«˜å‡ºçš„Unixç³»ç»Ÿ BSD å±‚æ˜¯å»ºç«‹åœ¨Machä¹‹ä¸Šï¼Œæ˜¯XNUä¸­ä¸€ä¸ªä¸å¯åˆ†å‰²çš„ä¸€éƒ¨åˆ†ï¼ŒBSDè´Ÿè´£æä¾›å¯é çš„ã€ç°ä»£çš„API POSIX è¡¨ç¤ºå¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆPortable Operation System Interfaceï¼‰ æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼ŒMachå¼‚å¸¸å’ŒUNIXä¿¡å·å­˜åœ¨å¯¹åº”çš„å…³ç³» ç¡¬ä»¶å¼‚å¸¸æµç¨‹ï¼šç¡¬ä»¶å¼‚å¸¸ -&gt; Machå¼‚å¸¸ -&gt; UNIXä¿¡å· è½¯ä»¶å¼‚å¸¸æµç¨‹ï¼šè½¯ä»¶å¼‚å¸¸ -&gt; UNIXå¼‚å¸¸ Machå¼‚å¸¸ä¸UNIXä¿¡å·çš„è½¬æ¢ä¸‹é¢æ˜¯ Machå¼‚å¸¸ ä¸ UNIXä¿¡å· çš„è½¬æ¢å…³ç³»ä»£ç ï¼Œæ¥è‡ª xnu ä¸­çš„ bsd/uxkern/ux_exception.c 123456789101112131415161718192021222324252627282930313233343536373839404142switch(exception) &#123;case EXC_BAD_ACCESS: if (code == KERN_INVALID_ADDRESS) *ux_signal = SIGSEGV; else *ux_signal = SIGBUS; break;case EXC_BAD_INSTRUCTION: *ux_signal = SIGILL; break;case EXC_ARITHMETIC: *ux_signal = SIGFPE; break;case EXC_EMULATION: *ux_signal = SIGEMT; break;case EXC_SOFTWARE: switch (code) &#123; case EXC_UNIX_BAD_SYSCALL: *ux_signal = SIGSYS; break; case EXC_UNIX_BAD_PIPE: *ux_signal = SIGPIPE; break; case EXC_UNIX_ABORT: *ux_signal = SIGABRT; break; case EXC_SOFT_SIGNAL: *ux_signal = SIGKILL; break; &#125; break;case EXC_BREAKPOINT: *ux_signal = SIGTRAP; break;&#125; å°†å…¶å¯¹åº”å…³ç³»æ±‡æ€»æˆä¸€ä¸ªè¡¨æ ¼ï¼Œå¦‚ä¸‹æ‰€ç¤º å…¶ä¸­ Machå¼‚å¸¸æœ‰ä»¥ä¸‹ UNIXä¿¡å·æœ‰ä»¥ä¸‹å‡ ç§ é‡æŒ‡é’ˆæŒ‡å‘çš„ å¯¹è±¡è¢«é‡Šæ”¾æˆ–æ”¶å›ï¼Œä½†æ˜¯è¯¥ æŒ‡é’ˆæ²¡æœ‰åšä»»ä½•çš„ä¿®æ”¹ï¼Œä»¥è‡³äº è¯¥æŒ‡é’ˆä»æŒ‡å‘å·²ç»å›æ”¶çš„å†…å­˜åœ°å€ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ é‡æŒ‡é’ˆ é‡æŒ‡é’ˆåˆ†ç±»è¿™ä¸ªå‚è€ƒè…¾è®¯Buglyå›¢é˜Ÿçš„æ€»ç»“ï¼Œå¤§è‡´åˆ†ä¸ºä¸¤ç±» å†…å­˜æ²¡è¢«è¦†ç›– å†…å­˜è¢«è¦†ç›– å¦‚ä¸‹å›¾æ‰€ç¤º ä¸ºä»€ä¹ˆOCé‡æŒ‡é’ˆçš„crashè¿™ä¹ˆå¤šï¼Ÿæˆ‘ä»¬ä¸€èˆ¬åœ¨APPå‘ç‰ˆå‰ï¼Œéƒ½ä¼šç»è¿‡å¤šè½®çš„ è‡ªæµ‹ã€å†…ä¾§ã€ç°åº¦æµ‹è¯• ç­‰ï¼ŒæŒ‰ç…§å¸¸ç†æ¥è¯´ï¼Œå¤§éƒ¨åˆ†çš„crashåº”è¯¥éƒ½è¢«è¦†ç›–äº†ï¼Œä½†æ˜¯ç”±äº é‡æŒ‡é’ˆçš„éšæœºæ€§ï¼Œä½¿å¾—ç»å¸¸åœ¨æµ‹è¯•æ—¶ä¸ä¼šå‡ºç°crashï¼Œè€Œæ˜¯åœ¨ çº¿ä¸Šå‡ºç°crashï¼Œè¿™å¯¹Appä½“éªŒæ¥è¯´æ˜¯éå¸¸è‡´å‘½çš„ è€Œé‡æŒ‡é’ˆçš„éšæœºæ€§é—®é¢˜å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š è·‘ä¸è¿›å‡ºé”™çš„é€»è¾‘ï¼Œæ‰§è¡Œä¸åˆ°å‡ºé”™çš„ä»£ç ï¼Œè¿™ç§å¯ä»¥é€šè¿‡ æé«˜æµ‹è¯•åœºæ™¯è¦†ç›–ç‡ æ¥è§£å†³ è·‘è¿›æœ‰é—®é¢˜çš„é€»è¾‘ï¼Œä½†æ˜¯é‡æŒ‡é’ˆæŒ‡å‘çš„åœ°å€å¹¶ä¸ä¸€å®šä¼šå¯¼è‡´crashï¼ŒåŸå› æ˜¯å› ä¸ºï¼šé‡æŒ‡é’ˆ å…¶æœ¬è´¨æ˜¯æŒ‡å‘ å·²ç»åˆ é™¤çš„å¯¹è±¡ æˆ– å—é™å†…å­˜åŒºåŸŸ çš„æŒ‡é’ˆï¼Œè¿™é‡Œè¯´çš„ OCé‡æŒ‡é’ˆï¼Œæ˜¯æŒ‡ OCå¯¹è±¡é‡Šæ”¾åæŒ‡é’ˆæœªç½®ç©ºè€Œå¯¼è‡´çš„é‡æŒ‡é’ˆã€‚è¿™é‡Œä¸å¿…ç°çš„åŸå› æ˜¯å› ä¸º dealloc æ‰§è¡Œååªæ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œè¿™ç‰‡ å†…å­˜æˆ‘ä¸ç”¨äº†ï¼Œè€Œç³»ç»Ÿå¹¶æ²¡æœ‰è®©è¿™ç‰‡å†…å­˜ä¸èƒ½è®¿é—®ã€‚ é‡æŒ‡é’ˆè§£å†³æ€è·¯è¿™é‡Œä¸»è¦æ˜¯å€Ÿé‰´Xcodeä¸­çš„ä¸¤ç§å¤„ç†æ–¹æ¡ˆï¼š Malloc Scrrbbleï¼Œå…¶å®˜æ–¹è§£é‡Š å¦‚ä¸‹ï¼šç”³è¯·å†…å­˜ alloc æ—¶åœ¨å†…å­˜ä¸Šå¡« 0xAAï¼Œé‡Šæ”¾å†…å­˜ dealloc åœ¨å†…å­˜ä¸Šå¡« 0x55ã€‚ Zombie Objectsï¼Œå…¶ å®˜æ–¹è§£é‡Š å¦‚ä¸‹ï¼šä¸€ä¸ªå¯¹è±¡å·²ç»è§£é™¤äº†å®ƒçš„å¼•ç”¨ï¼Œå·²ç»é‡Šæ”¾æ‰ï¼Œä½†æ˜¯æ­¤æ—¶ä»ç„¶æ˜¯å¯ä»¥æ¥æ”¶æ¶ˆæ¯ï¼Œè¿™ä¸ªå¯¹è±¡å°±å«åš Zombie Objectsï¼ˆåƒµå°¸å¯¹è±¡ï¼‰ã€‚è¿™ç§æ–¹æ¡ˆçš„é‡ç‚¹å°±æ˜¯ å°†é‡Šæ”¾çš„å¯¹è±¡ï¼Œå…¨éƒ¨è½¬ä¸ºåƒµå°¸å¯¹è±¡ ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯” åƒµå°¸å¯¹è±¡ ç›¸æ¯” Malloc Scribbleï¼Œä¸éœ€è¦è€ƒè™‘ä¼šä¸ä¼šå´©æºƒçš„é—®é¢˜ï¼Œåªè¦é‡æŒ‡é’ˆæŒ‡å‘åƒµå°¸å¯¹è±¡ï¼Œé‚£ä¹ˆå†æ¬¡è®¿é—®é‡æŒ‡é’ˆå°±ä¸€å®šä¼šå´©æºƒ åƒµå°¸å¯¹è±¡è¿™ç§æ–¹å¼ï¼Œä¸å¦‚ Malloc Scribbleè¦†ç›–é¢å¹¿ï¼Œå¯ä»¥é€šè¿‡ hook free æ–¹æ³•å°†cå‡½æ•°ä¹ŸåŒ…å«åœ¨å…¶ä¸­ Malloc Scribbleæ€è·¯ï¼šå½“è®¿é—®åˆ°å¯¹è±¡å†…å­˜ä¸­å¡«å†™çš„æ˜¯ 0xAAã€0x55 æ—¶ï¼Œç¨‹åºå°±ä¼šå‡ºç°å¼‚å¸¸ ç”³è¯·å†…å­˜ alloc æ—¶åœ¨å†…å­˜ä¸Šå¡« 0xAA é‡Šæ”¾å†…å­˜ dealloc ä½¿åœ¨å†…å­˜ä¸Šå¡« 0x55 ä»¥ä¸Šçš„ç”³è¯·å’Œé‡Šæ”¾çš„å¡«å……åˆ†åˆ«å¯¹åº”ä»¥ä¸‹ä¸¤ç§æƒ…å†µ ç”³è¯·ï¼šæ²¡æœ‰é”™åˆå§‹åŒ–å°±ç›´æ¥è¢«è®¿é—® é‡Šæ”¾ï¼šé‡Šæ”¾åè®¿é—® æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼Œé’ˆå¯¹é‡æŒ‡é’ˆï¼Œæˆ‘ä»¬çš„è§£å†³åŠæ³•æ˜¯ï¼šåœ¨å¯¹è±¡é‡Šæ”¾æ—¶åšæ•°æ®å¡«å…… 0x55 å³å¯ï¼Œå…³äºå¯¹è±¡çš„é‡Šæ”¾æµç¨‹å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  OCåº•å±‚åŸç†35ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸€ï¼‰TaggedPointer&#x2F;retain&#x2F;release&#x2F;dealloc&#x2F; é‡æŒ‡é’ˆæ¢æµ‹å®ç°1è¿™ä¸ªå®ç°ä¸»è¦ä¾æ® è…¾è®¯Buglyå·¥ç¨‹å¸ˆï¼šé™ˆå…¶é”‹ çš„åˆ†äº«ï¼Œåœ¨å…¶ä»£ç çš„ä¸»è¦æ€è·¯æ˜¯ï¼š é€šè¿‡ fishhook æ›¿æ¢ cå‡½æ•° çš„ free æ–¹æ³•ä¸ºè‡ªå®šä¹‰çš„ safe_freeï¼Œç±»ä¼¼äº Method Swizzling åœ¨ safe_free æ–¹æ³•ä¸­å¯¹ å·²ç»é‡Šæ”¾å˜é‡çš„å†…å­˜ï¼Œå¡«å…… 0x55 ï¼Œä½¿å·²ç»é‡Šæ”¾å˜é‡ ä¸èƒ½è®¿é—®ï¼Œä»è€Œä½¿æŸäº›é‡æŒ‡é’ˆçš„crashä»ä¸å¿…ç°å˜æˆ å¿…ç° ä¸ºäº† é˜²æ­¢å¡«å……0x55çš„å†…å­˜å†…æ–°çš„æ•°æ®å†…å®¹å¡«å……ï¼Œä½¿é‡æŒ‡é’ˆcrashå˜æˆä¸å¿…ç°ï¼Œåœ¨è¿™é‡Œé‡‡ç”¨çš„ç­–ç•¥æ˜¯ï¼Œsafe_freeä¸é‡Šæ”¾è¿™ç‰‡å†…å­˜ï¼Œè€Œæ˜¯è‡ªå·±ä¿ç•™ç€ï¼Œå³safe_freeæ–¹æ³•ä¸­ä¸ä¼šçœŸçš„è°ƒç”¨freeã€‚ åŒæ—¶ä¸ºäº† é˜²æ­¢ç³»ç»Ÿå†…å­˜è¿‡å¿«æ¶ˆè€—ï¼ˆå› ä¸ºè¦ä¿ç•™å†…å­˜ï¼‰ï¼Œéœ€è¦åœ¨ ä¿ç•™å†…å­˜å¤§äºä¸€å®šå€¼æ—¶é‡Šæ”¾ä¸€éƒ¨åˆ†ï¼Œé˜²æ­¢è¢«ç³»ç»Ÿæ€æ­»ï¼ŒåŒæ—¶ï¼Œåœ¨æ”¶åˆ° ç³»ç»Ÿå†…å­˜è­¦å‘Š æ—¶ï¼Œä¹Ÿéœ€è¦ é‡Šæ”¾ä¸€éƒ¨åˆ†å†…å­˜ å‘ç”Ÿcrashæ—¶ï¼Œå¾—åˆ°çš„å´©æºƒä¿¡æ¯æœ‰é™ï¼Œä¸åˆ©äºæ’æŸ¥é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨ä»£ç†ç±»ï¼ˆå³é›†æˆè‡ª NSProxyçš„å­ç±»ï¼‰ï¼Œé‡å†™æ¶ˆæ¯è½¬å‘çš„ä¸‰ä¸ªæ–¹æ³•ï¼ˆå‚è€ƒè¿™ç¯‡æ–‡ç«  OCåº•å±‚åŸç†14-3ï¼šæ¶ˆæ¯æµç¨‹åˆ†æä¹‹åŠ¨æ€æ–¹æ³•å†³è®® &amp; æ¶ˆæ¯è½¬å‘ï¼‰ï¼Œä»¥åŠNSObjectçš„å®ä¾‹æ–¹æ³•ï¼Œæ¥è·å–å¼‚å¸¸ä¿¡æ¯ã€‚ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯NSProxyåªèƒ½åšOCå¯¹è±¡çš„ä»£ç†ï¼Œæ‰€ä»¥éœ€è¦åœ¨safe_freeä¸­å¢åŠ å¯¹è±¡ç±»å‹çš„åˆ¤æ–­ ä»¥ä¸‹æ˜¯å®Œæ•´çš„é‡æŒ‡é’ˆæ¢æµ‹å®ç°ä»£ç  å¼•å…¥fishhook å®ç°NSProxyçš„ä»£ç†å­ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192&lt;!--1ã€MIZombieProxy.h--&gt;@interface MIZombieProxy : NSProxy@property (nonatomic, assign) Class originClass;@end&lt;!--2ã€MIZombieProxy.m--&gt;#import &quot;MIZombieProxy.h&quot;@implementation MIZombieProxy- (BOOL)respondsToSelector:(SEL)aSelector&#123; return [self.originClass instancesRespondToSelector:aSelector];&#125;- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel&#123; return [self.originClass instanceMethodSignatureForSelector:sel];&#125;- (void)forwardInvocation: (NSInvocation *)invocation&#123; [self _throwMessageSentExceptionWithSelector: invocation.selector];&#125;#define MIZombieThrowMesssageSentException() [self _throwMessageSentExceptionWithSelector: _cmd]- (Class)class&#123; MIZombieThrowMesssageSentException(); return nil;&#125;- (BOOL)isEqual:(id)object&#123; MIZombieThrowMesssageSentException(); return NO;&#125;- (NSUInteger)hash&#123; MIZombieThrowMesssageSentException(); return 0;&#125;- (id)self&#123; MIZombieThrowMesssageSentException(); return nil;&#125;- (BOOL)isKindOfClass:(Class)aClass&#123; MIZombieThrowMesssageSentException(); return NO;&#125;- (BOOL)isMemberOfClass:(Class)aClass&#123; MIZombieThrowMesssageSentException(); return NO;&#125;- (BOOL)conformsToProtocol:(Protocol *)aProtocol&#123; MIZombieThrowMesssageSentException(); return NO;&#125;- (BOOL)isProxy&#123; MIZombieThrowMesssageSentException(); return NO;&#125;- (NSString *)description&#123; MIZombieThrowMesssageSentException(); return nil;&#125;#pragma mark - MRC- (instancetype)retain&#123; MIZombieThrowMesssageSentException(); return nil;&#125;- (oneway void)release&#123; MIZombieThrowMesssageSentException();&#125;- (void)dealloc&#123; MIZombieThrowMesssageSentException(); [super dealloc];&#125;- (NSUInteger)retainCount&#123; MIZombieThrowMesssageSentException(); return 0;&#125;- (struct _NSZone *)zone&#123; MIZombieThrowMesssageSentException(); return nil;&#125;#pragma mark - private- (void)_throwMessageSentExceptionWithSelector:(SEL)selector&#123; @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;(-[%@ %@]) was sent to a zombie object at address: %p&quot;, NSStringFromClass(self.originClass),NSStringFromSelector(selector), self] userInfo:nil];&#125;@end hook free æ–¹æ³•çš„å…·ä½“å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165&lt;!--1ã€MISafeFree.h--&gt;@interface MISafeFree : NSObject//ç³»ç»Ÿè­¦å‘Šæ—¶ï¼Œç”¨å‡½æ•°é‡Šæ”¾ä¸€äº›å†…å­˜void free_safe_mem(size_t freeNum);@end&lt;!--2ã€MISafeFree.m--&gt;#import &quot;MISafeFree.h&quot;#import &quot;queue.h&quot;#import &quot;fishhook.h&quot;#import &quot;MIZombieProxy.h&quot;#import &lt;dlfcn.h&gt;#import &lt;objc/runtime.h&gt;#import &lt;malloc/malloc.h&gt;//ç”¨äºä¿å­˜zombieç±»static Class kMIZombieIsa;//ç”¨äºä¿å­˜zombieç±»çš„å®ä¾‹å˜é‡å¤§å°static size_t kMIZombieSize;//ç”¨äºè¡¨ç¤ºè°ƒç”¨freeå‡½æ•°static void(* orig_free)(void *p);//ç”¨äºä¿å­˜å·²æ³¨å†Œçš„ç±»çš„é›†åˆstatic CFMutableSetRef registeredClasses = nil;/* ç”¨æ¥ä¿å­˜è‡ªå·±ä¿ç•™çš„å†…å­˜ - 1ã€é˜Ÿåˆ—è¦çº¿ç¨‹å®‰å…¨æˆ–è€…è‡ªå·±åŠ é” - 2ã€è¿™ä¸ªé˜Ÿåˆ—å†…éƒ¨åº”è¯¥å°½é‡å°‘ç”³è¯·å’Œé‡Šæ”¾å †å†…å­˜ */struct DSQueue *_unfreeQueue = NULL;//ç”¨æ¥è®°å½•è‡ªå·±ä¿å­˜çš„å†…å­˜çš„å¤§å°int unfreeSize = 0;//æœ€å¤šå­˜å‚¨çš„å†…å­˜ï¼Œå¤§äºè¿™ä¸ªå€¼å°±é‡Šæ”¾ä¸€éƒ¨åˆ†#define MAX_STEAL_MEM_SIZE 1024*1024*100//æœ€å¤šä¿ç•™çš„æŒ‡é’ˆä¸ªæ•°ï¼Œè¶…è¿‡å°±é‡Šæ”¾ä¸€éƒ¨åˆ†#define MAX_STEAL_MEM_NUM 1024*1024*10//æ¯æ¬¡é‡Šæ”¾æ—¶é‡Šæ”¾çš„æŒ‡é’ˆæ•°é‡#define BATCH_FREE_NUM 100@implementation MISafeFree#pragma mark - Public Method//ç³»ç»Ÿè­¦å‘Šæ—¶ï¼Œç”¨å‡½æ•°é‡Šæ”¾ä¸€äº›å†…å­˜void free_safe_mem(size_t freeNum)&#123;#ifdef DEBUG //è·å–é˜Ÿåˆ—çš„é•¿åº¦ size_t count = ds_queue_length(_unfreeQueue); //éœ€è¦é‡Šæ”¾çš„å†…å­˜å¤§å° freeNum = freeNum &gt; count ? count : freeNum; //éå†å¹¶é‡Šæ”¾ for (int i = 0; i &lt; freeNum; i++) &#123; //è·å–æœªé‡Šæ”¾çš„å†…å­˜å— void *unfreePoint = ds_queue_get(_unfreeQueue); //åˆ›å»ºå†…å­˜å—ç”³è¯·çš„å¤§å° size_t memSize = malloc_size(unfreePoint); //åŸå­å‡æ“ä½œï¼Œå¤šçº¿ç¨‹å¯¹å…¨å±€å˜é‡è¿›è¡Œè‡ªå‡ __sync_fetch_and_sub(&amp;unfreeSize, (int)memSize); //é‡Šæ”¾ orig_free(unfreePoint); &#125;#endif&#125;#pragma mark - Life Circle+ (void)load&#123;#ifdef DEBUG loadZombieProxyClass(); init_safe_free();#endif&#125;#pragma mark - Private Methodvoid safe_free(void* p)&#123; //è·å–è‡ªå·±ä¿ç•™çš„å†…å­˜çš„å¤§å° int unFreeCount = ds_queue_length(_unfreeQueue); //ä¿ç•™çš„å†…å­˜å¤§äºä¸€å®šå€¼æ—¶å°±é‡Šæ”¾ä¸€éƒ¨åˆ† if (unFreeCount &gt; MAX_STEAL_MEM_NUM*0.9 || unfreeSize&gt;MAX_STEAL_MEM_SIZE) &#123; free_safe_mem(BATCH_FREE_NUM); &#125;else&#123; //åˆ›å»ºpç”³è¯·çš„å†…å­˜å¤§å° size_t memSize = malloc_size(p); //æœ‰è¶³å¤Ÿçš„ç©ºé—´æ‰è¦†ç›– if (memSize &gt; kMIZombieSize) &#123; //æŒ‡é’ˆå¼ºè½¬ä¸ºidå¯¹è±¡ id obj = (id)p; //è·å–æŒ‡é’ˆåŸæœ¬çš„ç±» Class origClass = object_getClass(obj); //åˆ¤æ–­æ˜¯ä¸æ˜¯objcå¯¹è±¡ char *type = @encode(typeof(obj)); /* - strcmp å­—ç¬¦ä¸²æ¯”è¾ƒ - CFSetContainsValue æŸ¥çœ‹å·²æ³¨å†Œç±»ä¸­æ˜¯å¦æœ‰origClassè¿™ä¸ªç±» å¦‚æœéƒ½æ»¡è¶³ï¼Œåˆ™å°†è¿™å—å†…å­˜å¡«å……0x55 */ if (strcmp(&quot;@&quot;, type) == 0 &amp;&amp; CFSetContainsValue(registeredClasses, origClass)) &#123; //å†…å­˜ä¸Šå¡«å……0x55 memset(obj, 0x55, memSize); //å°†è‡ªå·±ç±»çš„isaå¤åˆ¶è¿‡å» memcpy(obj, &amp;kMIZombieIsa, sizeof(void*)); //ä¸ºobjè®¾ç½®æŒ‡å®šçš„ç±» object_setClass(obj, [MIZombieProxy class]); //ä¿ç•™objåŸæœ¬çš„ç±» ((MIZombieProxy*)obj).originClass = origClass; //å¤šçº¿ç¨‹ä¸‹intçš„åŸå­åŠ æ“ä½œï¼Œå¤šçº¿ç¨‹å¯¹å…¨å±€å˜é‡è¿›è¡Œè‡ªåŠ ï¼Œä¸ç”¨ç†ä¼šçº¿ç¨‹é”äº† __sync_fetch_and_add(&amp;unfreeSize, (int)memSize); //å…¥é˜Ÿ ds_queue_put(_unfreeQueue, p); &#125;else&#123; orig_free(p); &#125; &#125;else&#123; orig_free(p); &#125; &#125;&#125;//åŠ è½½é‡æŒ‡é’ˆè‡ªå®šä¹‰ç±»void loadZombieProxyClass()&#123; registeredClasses = CFSetCreateMutable(NULL, 0, NULL); //ç”¨äºä¿å­˜å·²æ³¨å†Œç±»çš„ä¸ªæ•° unsigned int count = 0; //è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ç±» Class *classes = objc_copyClassList(&amp;count); //éå†ï¼Œå¹¶ä¿å­˜åˆ°registeredClassesä¸­ for (int i = 0; i &lt; count; i++) &#123; CFSetAddValue(registeredClasses, (__bridge const void *)(classes[i])); &#125; //é‡Šæ”¾ä¸´æ—¶å˜é‡å†…å­˜ free(classes); classes = NULL; kMIZombieIsa = objc_getClass(&quot;MIZombieProxy&quot;); kMIZombieSize = class_getInstanceSize(kMIZombieIsa);&#125;//åˆå§‹åŒ–ä»¥åŠfreeç¬¦å·é‡ç»‘å®šbool init_safe_free()&#123; //åˆå§‹åŒ–ç”¨äºä¿å­˜å†…å­˜çš„é˜Ÿåˆ— _unfreeQueue = ds_queue_create(MAX_STEAL_MEM_NUM); //dlsym åœ¨æ‰“å¼€çš„åº“ä¸­æŸ¥æ‰¾ç¬¦å·çš„å€¼ï¼Œå³åŠ¨æ€è°ƒç”¨freeå‡½æ•° orig_free = (void(*)(void*))dlsym(RTLD_DEFAULT, &quot;free&quot;); /* rebind_symbols:ç¬¦å·é‡ç»‘å®š - å‚æ•°1ï¼šrebindings æ˜¯ä¸€ä¸ªrebindingæ•°ç»„ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ struct rebinding &#123; const char *name; // ç›®æ ‡ç¬¦å·å void *replacement; // è¦æ›¿æ¢çš„ç¬¦å·å€¼ï¼ˆåœ°å€å€¼ï¼‰ void **replaced; // ç”¨æ¥å­˜æ”¾åŸæ¥çš„ç¬¦å·å€¼ï¼ˆåœ°å€å€¼ï¼‰ &#125;; - å‚æ•°2ï¼šrebindings_nel æè¿°æ•°ç»„çš„é•¿åº¦ */ //é‡ç»‘å®šfreeç¬¦å·ï¼Œè®©å®ƒæŒ‡å‘è‡ªå®šä¹‰çš„safe_freeå‡½æ•° rebind_symbols((struct rebinding[])&#123;&#123;&quot;free&quot;, (void*)safe_free&#125;&#125;, 1); return true;&#125;@end æµ‹è¯• 12345678910111213141516171819- (void)viewDidLoad &#123; [super viewDidLoad]; id obj = [[NSObject alloc] init]; self.assignObj = obj; // [MIZombieSniffer installSniffer];&#125;- (IBAction)mallocScribbleAction:(id)sender &#123; UIView* testObj = [[UIView alloc] init]; [testObj release]; for (int i = 0; i &lt; 10; i++) &#123; UIView* testView = [[UIView alloc] initWithFrame:CGRectMake(0,200,CGRectGetWidth(self.view.bounds), 60)]; [self.view addSubview:testView]; &#125; [testObj setNeedsLayout]; &#125; æ‰“å°ç»“æœå¦‚ä¸‹ Zombie Objectsåƒµå°¸å¯¹è±¡ å¯ä»¥ç”¨æ¥æ£€æµ‹å†…å­˜é”™è¯¯ï¼ˆEXC_BAD_ACCESSï¼‰,å®ƒå¯ä»¥æ•è·ä»»ä½•é˜é‡Šè®¿é—®åå†…å­˜çš„è°ƒç”¨ ç»™åƒµå°¸å¯¹è±¡å‘é€æ¶ˆæ¯çš„è¯ï¼Œå®ƒä»ç„¶æ˜¯å¯ä»¥å“åº”çš„ï¼Œç„¶åä¼šå‘ç”Ÿå´©æºƒï¼Œå¹¶è¾“å‡ºé”™è¯¯æ—¥å¿—æ¥æ˜¾ç¤ºé‡æŒ‡é’ˆå¯¹è±¡è°ƒç”¨çš„ç±»åå’Œæ–¹æ³• è‹¹æœçš„åƒµå°¸å¯¹è±¡æ£€æµ‹åŸç† é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹Xcodeä¸­åƒµå°¸å¯¹è±¡æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå…·ä½“æ“ä½œæ­¥éª¤å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  iOS Zombie Objects(åƒµå°¸å¯¹è±¡)åŸç†æ¢ç´¢ ä» dealloc çš„æºç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Replaced by NSZombieï¼Œå³ å¯¹è±¡é‡Šæ”¾ æ—¶ï¼ŒNSZombie å°† dealloc é‡Œåšæ›¿æ¢ï¼Œå¦‚ä¸‹æ‰€ç¤º æ‰€ä»¥åƒµå°¸å¯¹è±¡çš„ç”Ÿæˆè¿‡ç¨‹ä¼ªä»£ç å¦‚ä¸‹ 1234567891011121314151617181920212223//1ã€è·å–åˆ°å³å°†dealloctedå¯¹è±¡æ‰€å±ç±»ï¼ˆClassï¼‰Class cls = object_getClass(self);//2ã€è·å–ç±»åconst char *clsName = class_getName(cls)//3ã€ç”Ÿæˆåƒµå°¸å¯¹è±¡ç±»åconst char *zombieClsName = &quot;_NSZombie_&quot; + clsName;//4ã€æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ç›¸åŒçš„åƒµå°¸å¯¹è±¡ç±»åï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºClass zombieCls = objc_lookUpClass(zombieClsName);if (!zombieCls) &#123; //5ã€è·å–åƒµå°¸å¯¹è±¡ç±» _NSZombie_ Class baseZombieCls = objc_lookUpClass(â€œ_NSZombie_&quot;); //6ã€åˆ›å»º zombieClsName ç±» zombieCls = objc_duplicateClass(baseZombieCls, zombieClsName, 0);&#125;//7ã€åœ¨å¯¹è±¡å†…å­˜æœªè¢«é‡Šæ”¾çš„æƒ…å†µä¸‹é”€æ¯å¯¹è±¡çš„æˆå‘˜å˜é‡åŠå…³è”å¼•ç”¨ã€‚ objc_destructInstance(self);//8ã€ä¿®æ”¹å¯¹è±¡çš„ isa æŒ‡é’ˆï¼Œä»¤å…¶æŒ‡å‘ç‰¹æ®Šçš„åƒµå°¸ç±»objc_setClass(self, zombieCls); å½“åƒµå°¸å¯¹è±¡å†æ¬¡è¢«è®¿é—®æ—¶ï¼Œå°†è¿›å…¥æ¶ˆæ¯è½¬å‘æµç¨‹ï¼Œå¼€å§‹å¤„ç†åƒµå°¸å¯¹è±¡è®¿é—®ï¼Œè¾“å‡ºæ—¥å¿—å¹¶å‘ç”Ÿcrash æ‰€ä»¥åƒµå°¸å¯¹è±¡è§¦å‘æµç¨‹ä¼ªä»£ç å¦‚ä¸‹ 12345678910111213141516171819//1ã€è·å–å¯¹è±¡classClass cls = object_getClass(self);//2ã€è·å–å¯¹è±¡ç±»åconst char *clsName = class_getName(cls);//3ã€æ£€æµ‹æ˜¯å¦å¸¦æœ‰å‰ç¼€_NSZombie_if (string_has_prefix(clsName, &quot;_NSZombie_&quot;)) &#123;//4ã€è·å–è¢«é‡æŒ‡é’ˆå¯¹è±¡ç±»å const char *originalClsName = substring_from(clsName, 10); //5ã€è·å–å½“å‰è°ƒç”¨æ–¹æ³•å const char *selectorName = sel_getName(_cmd); //6ã€è¾“å‡ºæ—¥å¿— Log(&#x27;&#x27;*** - [%s %s]: message sent to deallocated instance %p&quot;, originalClsName, selectorName, self); //7ã€ç»“æŸè¿›ç¨‹ abort(); æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™é‡æŒ‡é’ˆæ¢æµ‹æ–¹å¼çš„æ€è·¯æ˜¯ï¼šdealloc æ–¹æ³•çš„æ›¿æ¢ï¼Œå…¶å…³é”®æ˜¯è°ƒç”¨ objc_destructInstance æ¥è§£é™¤å¯¹è±¡çš„å…³è”å¼•ç”¨ é‡æŒ‡é’ˆæ¢æµ‹å®ç°2è¿™ç§æ€è·¯ä¸»è¦æ¥æº sindrilin çš„æºç ï¼Œå…¶ä¸»è¦æ€è·¯æ˜¯ï¼š é‡æŒ‡é’ˆæ£€æµ‹æµç¨‹ å¼€å¯é‡æŒ‡é’ˆæ£€æµ‹ è®¾å€¼ç›‘æ§åˆ°é‡æŒ‡é’ˆçš„å›è°ƒblockï¼Œåœ¨blockä¸­æ‰“å°ä¿¡æ¯ï¼Œæˆ–è€…å­˜å‚¨å †æ ˆ æ£€æµ‹åˆ°é‡æŒ‡é’ˆæ˜¯å¦crash æœ€å¤§å†…å­˜å ç”¨ç©ºé—´ æ˜¯å¦è®°å½•deallocè°ƒç”¨æ ˆ ç›‘æ§ç­–ç•¥ åªç›‘æ§è‡ªå®šä¹‰å¯¹è±¡ ç™½åå•ç­–ç•¥ é»‘åå•ç­–ç•¥ ç›‘æ§æ‰€æœ‰å¯¹è±¡ äº¤æ¢NSObjectçš„deallocæ–¹æ³• è§¦å‘é‡æŒ‡é’ˆ å¼€å§‹å¤„ç†å¯¹è±¡ æ˜¯å¦è¾¾åˆ°æ›¿æ¢æ¡ä»¶ æ ¹æ®ç›‘æ§ç­–ç•¥ï¼Œæ˜¯å¦å±äºè¦æ£€æµ‹çš„ç±» ç©ºé—´æ˜¯å¦è¶³å¤Ÿ å¦‚æœç¬¦åˆæ¡ä»¶ï¼Œåˆ™è·å–å¯¹è±¡ï¼Œå¹¶è§£é™¤å¼•ç”¨ï¼Œå¦‚æœä¸ç¬¦åˆåˆ™æ­£å¸¸é‡Šæ”¾ï¼Œå³è°ƒç”¨åŸæ¥çš„deallocæ–¹æ³• å‘å¯¹è±¡å†…å¡«å……æ•°æ® èµ‹å€¼åƒµå°¸å¯¹è±¡çš„ç±»æŒ‡é’ˆæ›¿æ¢isa å¯¹è±¡+deallocè°ƒç”¨æ ˆï¼Œä¿å­˜åœ¨åƒµå°¸å¯¹è±¡ä¸­ æ ¹æ®æƒ…å†µæ˜¯å¦æ¸…ç†å†…å­˜å’Œå¯¹è±¡ é€šè¿‡åƒµå°¸å¯¹è±¡æ£€æµ‹çš„å®ç°æ€è·¯ é€šè¿‡OCä¸­ Method Swizzlingï¼Œäº¤æ¢ æ ¹ç±»NSObjectå’ŒNSProxy çš„ dealloc æ–¹æ³•ä¸º è‡ªå®šä¹‰çš„dealloc æ–¹æ³• ä¸ºäº† é¿å…å†…å­˜ç©ºé—´é‡Šæ”¾åè¢«é‡å†™é€ æˆé‡æŒ‡é’ˆ çš„é—®é¢˜ï¼Œé€šè¿‡ å­—å…¸å­˜å‚¨è¢«é‡Šæ”¾çš„å¯¹è±¡ï¼ŒåŒæ—¶è®¾ç½®åœ¨ 30såè°ƒç”¨deallocæ–¹æ³•å°†å­—å…¸ä¸­å­˜å‚¨çš„å¯¹è±¡é‡Šæ”¾ï¼Œé¿å…å†…å­˜å¢å¤§ ä¸ºäº†è·å–æ›´å¤šçš„å´©æºƒä¿¡æ¯ï¼Œè¿™é‡ŒåŒæ ·éœ€è¦åˆ›å»ºNSProxyçš„å­ç±» å…·ä½“å®ç° åˆ›å»ºNSProxyçš„å­ç±»ï¼Œå…¶å®ç°ä¸ä¸Šé¢çš„ MIZombieProxy æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ hook dealloc å‡½æ•°çš„å…·ä½“å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200&lt;!--1ã€MIZombieSniffer.h--&gt;@interface MIZombieSniffer : NSObject/*! * @method installSniffer * å¯åŠ¨zombieæ£€æµ‹ */+ (void)installSniffer;/*! * @method uninstallSnifier * åœæ­¢zombieæ£€æµ‹ */+ (void)uninstallSnifier;/*! * @method appendIgnoreClass * æ·»åŠ ç™½åå•ç±» */+ (void)appendIgnoreClass: (Class)cls;@end&lt;!--2ã€MIZombieSniffer.m--&gt;#import &quot;MIZombieSniffer.h&quot;#import &quot;MIZombieProxy.h&quot;#import &lt;objc/runtime.h&gt;//typedef void (*MIDeallocPointer) (id objc);//é‡æŒ‡é’ˆæ¢æµ‹å™¨æ˜¯å¦å¼€å¯static BOOL _enabled = NO;//æ ¹ç±»static NSArray *_rootClasses = nil;//ç”¨äºå­˜å‚¨è¢«é‡Šæ”¾çš„å¯¹è±¡static NSDictionary&lt;id, NSValue*&gt; *_rootClassDeallocImps = nil;//ç™½åå•static inline NSMutableSet *__mi_sniffer_white_lists()&#123; //åˆ›å»ºç™½åå•é›†åˆ static NSMutableSet *mi_sniffer_white_lists; //å•ä¾‹åˆå§‹åŒ–ç™½åå•é›†åˆ static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; mi_sniffer_white_lists = [[NSMutableSet alloc] init]; &#125;); return mi_sniffer_white_lists;&#125;static inline void __mi_dealloc(__unsafe_unretained id obj)&#123; //è·å–å¯¹è±¡çš„ç±» Class currentCls = [obj class]; Class rootCls = currentCls; //è·å–éNSObjectå’ŒNSProxyçš„ç±» while (rootCls != [NSObject class] &amp;&amp; rootCls != [NSProxy class]) &#123; //è·å–rootClsçš„çˆ¶ç±»ï¼Œå¹¶èµ‹å€¼ rootCls = class_getSuperclass(rootCls); &#125; //è·å–ç±»å NSString *clsName = NSStringFromClass(rootCls); //æ ¹æ®ç±»åè·å–deallocçš„impæŒ‡é’ˆ MIDeallocPointer deallocImp = NULL; [[_rootClassDeallocImps objectForKey:clsName] getValue:&amp;deallocImp]; if (deallocImp != NULL) &#123; deallocImp(obj); &#125;&#125;//hookäº¤æ¢deallocstatic inline IMP __mi_swizzleMethodWithBlock(Method method, void *block)&#123; /* imp_implementationWithBlock ï¼šæ¥æ”¶ä¸€ä¸ªblockå‚æ•°ï¼Œå°†å…¶æ‹·è´åˆ°å †ä¸­ï¼Œè¿”å›ä¸€ä¸ªtrampoline å¯ä»¥è®©blockå½“åšä»»ä½•ä¸€ä¸ªç±»çš„æ–¹æ³•çš„å®ç°ï¼Œå³å½“åšç±»çš„æ–¹æ³•çš„IMPæ¥ä½¿ç”¨ */ IMP blockImp = imp_implementationWithBlock((__bridge id _Nonnull)(block)); //method_setImplementation æ›¿æ¢æ‰methodçš„IMP return method_setImplementation(method, blockImp);&#125;@implementation MIZombieSniffer//åˆå§‹åŒ–æ ¹ç±»+ (void)initialize&#123; _rootClasses = [@[[NSObject class], [NSProxy class]] retain];&#125;#pragma mark - public+ (void)installSniffer&#123; @synchronized (self) &#123; if (!_enabled) &#123; //hookæ ¹ç±»çš„deallocæ–¹æ³• [self _swizzleDealloc]; _enabled = YES; &#125; &#125;&#125;+ (void)uninstallSnifier&#123; @synchronized (self) &#123; if (_enabled) &#123; //è¿˜åŸdeallocæ–¹æ³• [self _unswizzleDealloc]; _enabled = NO; &#125; &#125;&#125;//æ·»åŠ ç™¾åå•+ (void)appendIgnoreClass:(Class)cls&#123; @synchronized (self) &#123; NSMutableSet *whiteList = __mi_sniffer_white_lists(); NSString *clsName = NSStringFromClass(cls); [clsName retain]; [whiteList addObject:clsName]; &#125;&#125;#pragma mark - private+ (void)_swizzleDealloc&#123; static void *swizzledDeallocBlock = NULL; //å®šä¹‰blockï¼Œä½œä¸ºæ–¹æ³•çš„IMP static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; swizzledDeallocBlock = (__bridge void *)[^void(id obj) &#123; //è·å–å¯¹è±¡çš„ç±» Class currentClass = [obj class]; //è·å–ç±»å NSString *clsName = NSStringFromClass(currentClass); //åˆ¤æ–­è¯¥ç±»æ˜¯å¦åœ¨ç™½åå•ç±» if ([__mi_sniffer_white_lists() containsObject: clsName]) &#123; //å¦‚æœåœ¨ç™½åå•å†…ï¼Œåˆ™ç›´æ¥é‡Šæ”¾å¯¹è±¡ __mi_dealloc(obj); &#125; else &#123; //ä¿®æ”¹å¯¹è±¡çš„isaæŒ‡é’ˆï¼ŒæŒ‡å‘MIZombieProxy /* valueWithBytes:objCType åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªåŒ…å«ç»™å®šå€¼çš„NSValueå¯¹è±¡ï¼Œè¯¥å€¼ä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªç»™å®šçš„NSObjectç±»å‹ - å‚æ•°1ï¼šNSValueå¯¹è±¡çš„å€¼ - å‚æ•°2ï¼šç»™å®šå€¼çš„å¯¹åº”çš„OCç±»å‹ï¼Œéœ€è¦ä½¿ç”¨ç¼–è¯‘å™¨æŒ‡ä»¤@encodeæ¥åˆ›å»º */ NSValue *objVal = [NSValue valueWithBytes: &amp;obj objCType: @encode(typeof(obj))]; //ä¸ºobjè®¾ç½®æŒ‡å®šçš„ç±» object_setClass(obj, [MIZombieProxy class]); //ä¿ç•™å¯¹è±¡åŸæœ¬çš„ç±» ((MIZombieProxy *)obj).originClass = currentClass; //è®¾ç½®åœ¨30såè°ƒç”¨deallocå°†å­˜å‚¨çš„å¯¹è±¡é‡Šæ”¾ï¼Œé¿å…å†…å­˜ç©ºé—´çš„å¢å¤§ dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(30 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; __unsafe_unretained id deallocObj = nil; //è·å–éœ€è¦deallocçš„å¯¹è±¡ [objVal getValue: &amp;deallocObj]; //è®¾ç½®å¯¹è±¡çš„ç±»ä¸ºåŸæœ¬çš„ç±» object_setClass(deallocObj, currentClass); //é‡Šæ”¾ __mi_dealloc(deallocObj); &#125;); &#125; &#125; copy]; &#125;); //äº¤æ¢äº†æ ¹ç±»NSObjectå’ŒNSProxyçš„deallocæ–¹æ³•ä¸ºoriginalDeallocImp NSMutableDictionary *deallocImps = [NSMutableDictionary dictionary]; //éå†æ ¹ç±» for (Class rootClass in _rootClasses) &#123; //è·å–æŒ‡å®šç±»ä¸­deallocæ–¹æ³• Method oriMethod = class_getInstanceMethod([rootClass class], NSSelectorFromString(@&quot;dealloc&quot;)); //hook - äº¤æ¢deallocæ–¹æ³•çš„IMPå®ç° IMP originalDeallocImp = __mi_swizzleMethodWithBlock(oriMethod, swizzledDeallocBlock); //è®¾ç½®IMPçš„å…·ä½“å®ç° [deallocImps setObject: [NSValue valueWithBytes: &amp;originalDeallocImp objCType: @encode(typeof(IMP))] forKey: NSStringFromClass(rootClass)]; &#125; //_rootClassDeallocImpså­—å…¸å­˜å‚¨äº¤æ¢åçš„IMPå®ç° _rootClassDeallocImps = [deallocImps copy];&#125;+ (void)_unswizzleDealloc&#123; //è¿˜åŸdeallocäº¤æ¢çš„IMP [_rootClasses enumerateObjectsUsingBlock:^(Class rootClass, NSUInteger idx, BOOL * _Nonnull stop) &#123; IMP originDeallocImp = NULL; //è·å–æ ¹ç±»ç±»å NSString *clsName = NSStringFromClass(rootClass); //è·å–hookåçš„deallocå®ç° [[_rootClassDeallocImps objectForKey:clsName] getValue:&amp;originDeallocImp]; NSParameterAssert(originDeallocImp); //è·å–åŸæœ¬çš„deallocå®ç° Method oriMethod = class_getInstanceMethod([rootClass class], NSSelectorFromString(@&quot;dealloc&quot;)); //è¿˜åŸdeallocçš„å®ç° method_setImplementation(oriMethod, originDeallocImp); &#125;]; //é‡Šæ”¾ [_rootClassDeallocImps release]; _rootClassDeallocImps = nil;&#125;@end æµ‹è¯• 123456789101112131415161718192021@interface ViewController ()@property (nonatomic, assign) id assignObj;@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; id obj = [[NSObject alloc] init]; self.assignObj = obj; [MIZombieSniffer installSniffer];&#125;- (IBAction)zombieObjectAction:(id)sender &#123; NSLog(@&quot;%@&quot;, self.assignObj); &#125; æ‰“å°å´©æºƒä¿¡æ¯å¦‚ä¸‹","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCå­¦ä¹ 15ï¼šSDWebImageæ¢ç´¢","slug":"OCå­¦ä¹ /OCå­¦ä¹ 15ï¼šSDWebImageæ¢ç´¢","date":"2021-07-13T02:11:45.000Z","updated":"2023-03-08T23:03:34.456Z","comments":true,"path":"2021/07/13/OCå­¦ä¹ /OCå­¦ä¹ 15ï¼šSDWebImageæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2021/07/13/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A015%EF%BC%9ASDWebImage%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"ç®€ä»‹SDWebImage æ˜¯ä¸€ä¸ª å¼‚æ­¥åŠ è½½å›¾ç‰‡çš„åº“ï¼Œæä¾›äº†ä¸€ä¸ªUIImageView+WebCacheç±»æ”¯æŒæ¥è‡ªäº’è”ç½‘çš„è¿œç¨‹å›¾ç‰‡ï¼Œå…·æœ‰ç¼“å­˜ç®¡ç†ã€å¼‚æ­¥ä¸‹è½½ã€åŒä¸€ä¸ªURLæ¬¡æ•°æ§åˆ¶å’Œä¼˜åŒ–ç­‰ç‰¹å¾ã€‚ SDWebImage åŠ è½½å›¾ç‰‡çš„æµç¨‹ é€šè¿‡ UIImageView+WebCache ç±»è°ƒç”¨ sd_setImageWithURL:placeholderImageè°ƒç”¨ UIView+WebCacheç±»ä¸­çš„æ–¹æ³•sd_internalSetImageWithURL:placeholderImage:options:context:setImageBlock:progress:completed:ï¼Œå¦‚æœæœ‰å ä½å›¾ç‰‡ï¼Œå…ˆæ˜¾ç¤ºå ä½å›¾ç‰‡ï¼Œç„¶åæ ¹æ® url å¤„ç†å›¾ç‰‡ã€‚ å¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰å›¾ç‰‡ï¼Œåˆ™ä»ç£ç›˜ä¸­æŸ¥æ‰¾ï¼Œæ ¹æ®å¯¹URLçš„MD5å¤„ç†æŸ¥æ‰¾å›¾ç‰‡ï¼Œå¦‚æœæ‰¾åˆ°å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ï¼ŒåŒæ—¶å°†æ‰¾åˆ°çš„å›¾ç‰‡è¿”å›å¹¶æ˜¾ç¤ºã€‚ å¦‚æœç£ç›˜å’Œå†…å­˜éƒ½æ‰¾ä¸åˆ°å›¾ç‰‡ï¼Œåˆ™éœ€è¦ä¸‹è½½å›¾ç‰‡ï¼Œé€šè¿‡å…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨SDWebImageDownloaderä¸‹è½½å›¾ç‰‡ã€‚ å›¾ç‰‡ä¸‹è½½ç”±NSURLSessionæ¥å®Œæˆï¼Œä¸‹è½½å®Œæˆåå¯¹å›¾ç‰‡è¿›è¡Œå†…å­˜å’Œç£ç›˜ç¼“å­˜ï¼Œå¹¶è¿”å›æ˜¾ç¤ºã€‚ 12// ä¸‹è½½å›¾ç‰‡ operation.loaderOperation = [imageLoader requestImageWithURL:url options:options context:context progress:progressBlock completed:^(UIImage *downloadedImage, NSData *downloadedData, NSError *error, BOOL finished) &#123; SDWebImageView ç¼“å­˜æœºåˆ¶ é¦–å…ˆï¼ŒSDWebImageçš„å›¾ç‰‡ç¼“å­˜é‡‡ç”¨çš„æ˜¯ memoryï¼ˆå†…å­˜ï¼‰ å’Œ diskï¼ˆç£ç›˜ï¼‰ åŒé‡æœºåˆ¶ï¼ŒSDImageCache ä¸­æœ‰ memoryCache å’Œ diskCache ä¸¤ä¸ªå±æ€§ï¼›memoryCache æ˜¯å°†å›¾ç‰‡å­˜å‚¨åœ¨å†…å­˜ä¸­ ï¼› diskCache æ˜¯å°†å›¾ç‰‡æ”¾åˆ° NSCacheDiretory ç›®å½•ä¸­ï¼Œå…·ä½“å¦‚ä¸‹ï¼š Memoryå†…å­˜ä¸­æŸ¥æ‰¾ï¼šSDImageCacheä¸­æŸ¥æ‰¾å›¾ç‰‡ç¼“å­˜ï¼Œå¦‚æœæ‰¾åˆ°ç›´æ¥è¿”å›ï¼Œåä¹‹è¿›å…¥ç¡¬ç›˜æŸ¥æ‰¾ Diskç¡¬ç›˜ä¸­æŸ¥æ‰¾ï¼šå¦‚æœç¡¬ç›˜ä¸­æ‰¾åˆ°ï¼Œè¿˜éœ€è¦å°†å›¾ç‰‡å­˜å‚¨åˆ° memory ä¸­ ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä¸‹è½½ ä¸‹è½½ï¼šä½¿ç”¨ downloaderä¸‹è½½ï¼Œå¤±è´¥åŠ å…¥failedURLSé›†åˆï¼Œä¸‹è½½æ‹’ç»å†æ¬¡åŠ è½½ï¼Œä¸‹è½½æˆåŠŸåˆ™å†™å…¥ memory å’Œ diskï¼Œå¹¶è¿”å›æ˜¾ç¤º Diskç¼“å­˜ç­–ç•¥-APPåœ¨ç»“æŸæ—¶æ‰§è¡Œæ¸…ç†ä»»åŠ¡ï¼š 1ï¼‰æ¸…é™¤è¿‡æœŸçš„ç¼“å­˜æ–‡ä»¶ 2ï¼‰å¦‚æœæ¸…é™¤è¿‡æœŸçš„ç¼“å­˜æ–‡ä»¶æœªæ»¡è¶³æ¡ä»¶ï¼Œåˆ™å…ˆæ¸…é™¤æœ€æ—©çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜¯æŠ˜åŠæ¸…é™¤ã€‚","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-å­¦ä¹ ","slug":"OC-å­¦ä¹ ","permalink":"https://www.bboyzj.cn/tags/OC-%E5%AD%A6%E4%B9%A0/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼","date":"2021-07-05T06:50:58.000Z","updated":"2023-02-24T10:10:09.000Z","comments":true,"path":"2021/07/05/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼/","link":"","permalink":"https://www.bboyzj.cn/2021/07/05/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8640%EF%BC%9A%E7%BB%84%E4%BB%B6%E5%8C%96%EF%BC%88%E4%BA%8C%EF%BC%89%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E8%AE%AF%E6%96%B9%E5%BC%8F/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦è®²ç»„ä»¶åŒ–ä¹‹é—´æ˜¯å¦‚ä½• é€šè®¯ çš„ ç»„ä»¶åŒ–é€šè®¯æ–¹æ¡ˆç›®å‰çš„ä¸»æµæ–¹å¼æœ‰ä¸‰ç§ï¼š URL è·¯ç”± target-action protocol åŒ¹é… URLè·¯ç”±ç›®å‰iOSä¸Šå¤§éƒ¨åˆ†è·¯ç”±å·¥å…·éƒ½æ˜¯åŸºäºURLåŒ¹é…çš„ï¼Œæˆ–è€…æ ¹æ®å‘½åçº¦å®šï¼Œç”¨runtimeæ–¹æ³•è¿›è¡ŒåŠ¨æ€è°ƒç”¨ è¿™äº›åŠ¨æ€åŒ–çš„æ–¹æ¡ˆçš„æœ‰ç‚¹æ˜¯å®ç°ç®€å•ï¼Œç¼ºç‚¹æ˜¯éœ€è¦ç»´æŠ¤ å­—ç¬¦ä¸²è¡¨ï¼Œæˆ–è€…ä¾èµ–äºå‘½åçº¦å®šï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶æš´éœ²å‡ºæ‰€æœ‰é—®é¢˜ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯ URLè·¯ç”±æ–¹å¼ä¸»è¦æ˜¯ä»¥è˜‘è‡è¡—ä¸ºä»£è¡¨çš„ MGJRouter å…¶å®ç°æ€è·¯æ˜¯ï¼š Appå¯åŠ¨æ—¶å®ä¾‹åŒ–å„ç»„ä»¶æ¨¡å—ï¼Œç„¶åè¿™äº›ç»„ä»¶å‘ ModuleManager æ³¨å†Œ Urlï¼Œæœ‰äº›æ—¶å€™ä¸éœ€è¦å®ä¾‹åŒ–ï¼Œä½¿ç”¨classæ³¨å†Œ å½“ç»„ä»¶Aéœ€è¦è°ƒç”¨ç»„ä»¶Bæ—¶ï¼Œå‘ ModuleManager ä¼ é€’URLï¼Œå‚æ•°è·ŸéšURLä»¥GETæ–¹å¼ä¼ é€’ï¼Œç±»ä¼¼openURLã€‚ç„¶åç”± ModuleManager è´Ÿè´£è°ƒåº¦ç»„ä»¶Bï¼Œæœ€åå®Œæˆä»»åŠ¡ 1234567// 1.æ³¨å†ŒæŸä¸ªURLMGJRouter.registerURLPattern(&quot;app://home&quot;) &#123; (info) in print(&quot;info:\\(info)&quot;)&#125;// 2.è°ƒç”¨è·¯ç”±MGJRouter.openURL(&quot;app://home&quot;) URLè·¯ç”±çš„ä¼˜ç‚¹ æé«˜çš„åŠ¨æ€æ€§ï¼Œé€‚åˆç»å¸¸å¼€å±•è¿è¥æ´»åŠ¨çš„Appï¼Œä¾‹å¦‚ç”µå•† æ–¹ä¾¿åœ°ç»Ÿä¸€ç®¡ç†å¤šå¹³å°çš„è·¯ç”±è§„åˆ™ æ˜“äºé€‚é…URL Scheme URLè·¯ç”±çš„ç¼ºç‚¹ ä¼ å‚æ–¹å¼æœ‰é™ï¼Œå¹¶ä¸”æ— æ³•åˆ©ç”¨ç¼–è¯‘å™¨è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥ï¼Œå› æ­¤æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²è½¬æ¢è€Œæ¥ åªé€‚ç”¨äºç•Œé¢æ¨¡å—ï¼Œä¸é€‚ç”¨äºé€šç”¨æ¨¡å— å‚æ•°çš„æ ¼å¼ä¸æ˜ç¡®ï¼Œæ˜¯ä¸ªçµæ´»çš„ dictionaryï¼Œä¹Ÿéœ€è¦æœ‰ä¸ªåœ°æ–¹å¯ä»¥æŸ¥å‚æ•°æ ¼å¼ ä¸æ”¯æŒstoryboard ä¾èµ–äºå­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œéš¾ä»¥ç®¡ç†ï¼Œè˜‘è‡è¡—åšäº†ä¸ªåå°ä¸“é—¨ç®¡ç† æ— æ³•ä¿è¯æ‰€ä½¿ç”¨çš„æ¨¡å—ä¸€å®šå­˜åœ¨ è§£è€¦èƒ½åŠ›æœ‰é™ï¼Œurlçš„æ³¨å†Œã€å®ç°ã€ä½¿ç”¨å¿…é¡»ç”¨ç›¸åŒçš„å­—ç¬¦è§„åˆ™ï¼Œä¸€æ—¦ä»»ä½•ä¸€æ–¹ä½œå‡ºä¿®æ”¹éƒ½ä¼šå¯¼è‡´å…¶ä»–æ–¹çš„ä»£ç å¤±æ•ˆï¼Œå¹¶ä¸”é‡æ„éš¾åº¦å¤§ é™¤äº† MGJRouterï¼Œè¿˜æœ‰ä»¥ä¸‹è¿™äº›ä¸‰æ–¹æ¡†æ¶ routable-ios JLRoutes HHRouter target-actionè¿™ä¸ªæ–¹æ¡ˆæ˜¯åŸºäºOCçš„ runtimeã€category ç‰¹æ€§åŠ¨æ€è·å–æ¨¡å—ï¼Œä¾‹å¦‚é€šè¿‡ NSClassFromString è·å–ç±»å¹¶åˆ›å»ºå®ä¾‹ï¼Œé€šè¿‡ performSelector + NSInvocation åŠ¨æ€è°ƒç”¨æ–¹æ³• å…¶ä¸»è¦çš„ä»£è¡¨æ¡†æ¶æ˜¯ casatwyçš„CTMediator å…¶å®ç°æ€è·¯æ˜¯ï¼š åˆ©ç”¨ åˆ†ç±» ä¸ºè·¯ç”±æ·»åŠ æ–°æ¥å£ï¼Œåœ¨æ¥å£ä¸­ é€šè¿‡å­—ç¬¦ä¸²è·å–å¯¹åº”çš„ç±» é€šè¿‡ runtime åˆ›å»ºå®ä¾‹ï¼ŒåŠ¨æ€è°ƒç”¨å®ä¾‹çš„æ–¹æ³• 1234567891011121314151617181920212223242526272829//******* 1ã€åˆ†ç±»å®šä¹‰æ–°æ¥å£extension CTMediator&#123; @objc func A_showHome()-&gt;UIViewController?&#123; let params = [ kCTMediatorParamsKeySwiftTargetModuleName: &quot;ZJBase_Example&quot; ] if let vc = self.performTarget(&quot;A&quot;, action: &quot;Extension_HomeViewController&quot;, params: params, shouldCacheTarget: false) as? UIViewController&#123; return vc &#125; return nil &#125;&#125;//******* 2ã€æ¨¡å—æä¾›è€…æä¾›target-actionçš„è°ƒç”¨æ–¹å¼ï¼ˆå¯¹å¤–éœ€è¦åŠ ä¸Špublicå…³é”®å­—ï¼‰class Target_A: NSObject &#123; @objc func Action_Extension_HomeViewController(_ params: [String: Any])-&gt;UIViewController&#123; let home = HomeViewController() return home &#125;&#125;//******* 3ã€ä½¿ç”¨if let vc = CTMediator.sharedInstance().A_showHome() &#123; self.navigationController?.pushViewController(vc, animated: true) &#125; å…¶æ¨¡å—é—´çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç¼ºç‚¹ éœ€è¦åœ¨ mediator å’Œ target ä¸­é‡æ–°æ·»åŠ æ¯ä¸€ä¸ªæ¥å£ï¼Œæ¨¡å—åŒ–æ—¶ä»£ç è¾ƒä¸ºç¹ç åœ¨ category ä¸­ä»ç„¶å¼•å…¥äº† å­—ç¬¦ä¸²ç¼–ç ï¼Œå†…éƒ¨ä½¿ç”¨å­—å…¸ä¼ å‚ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿå­˜åœ¨å’ŒURLè·¯ç”±ç›¸åŒçš„é—®é¢˜ æ— æ³•ä¿è¯ä½¿ç”¨çš„æ¨¡å—ä¸€å®šå­˜åœ¨ï¼Œtargetåœ¨ä¿®æ”¹åï¼Œä½¿ç”¨è€…åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½å‘ç°é”™è¯¯ å¯èƒ½ä¼šåˆ›å»ºè¿‡å¤šçš„ target ç±» CTMediatoræºç åˆ†æ é€šè¿‡åˆ†ç±»ä¸­è°ƒç”¨çš„ performTarget æ¥åˆ° CTMediator ä¸­çš„å…·ä½“å®ç°ï¼Œå³ performTarget:action:params:shouldCacheTarget:ï¼Œä¸»è¦æ˜¯é€šè¿‡ä¼ å…¥çš„nameï¼Œæ‰¾åˆ°å¯¹åº”çš„ targetå’Œaction 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960- (id)performTarget:(NSString *)targetName action:(NSString *)actionName params:(NSDictionary *)params shouldCacheTarget:(BOOL)shouldCacheTarget&#123; if (targetName == nil || actionName == nil) &#123; return nil; &#125; //åœ¨swiftä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ä¼ å…¥å¯¹åº”é¡¹ç›®çš„targetåç§°ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°è§†å›¾æ§åˆ¶å™¨ NSString *swiftModuleName = params[kCTMediatorParamsKeySwiftTargetModuleName]; // generate target ç”Ÿæˆtarget NSString *targetClassString = nil; if (swiftModuleName.length &gt; 0) &#123; //swiftä¸­targetæ–‡ä»¶åæ‹¼æ¥ targetClassString = [NSString stringWithFormat:@&quot;%@.Target_%@&quot;, swiftModuleName, targetName]; &#125; else &#123; //OCä¸­targetæ–‡ä»¶åæ‹¼æ¥ targetClassString = [NSString stringWithFormat:@&quot;Target_%@&quot;, targetName]; &#125; //ç¼“å­˜ä¸­æŸ¥æ‰¾target NSObject *target = [self safeFetchCachedTarget:targetClassString]; //ç¼“å­˜ä¸­æ²¡æœ‰target if (target == nil) &#123; //é€šè¿‡å­—ç¬¦ä¸²è·å–å¯¹åº”çš„ç±» Class targetClass = NSClassFromString(targetClassString); //åˆ›å»ºå®ä¾‹ target = [[targetClass alloc] init]; &#125; // generate action ç”Ÿæˆactionæ–¹æ³•åç§° NSString *actionString = [NSString stringWithFormat:@&quot;Action_%@:&quot;, actionName]; //é€šè¿‡æ–¹æ³•åå­—ç¬¦ä¸²è·å–å¯¹åº”çš„sel SEL action = NSSelectorFromString(actionString); if (target == nil) &#123; // è¿™é‡Œæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ä¹‹ä¸€ï¼Œè¿™ä¸ªdemoåšå¾—æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥å“åº”çš„targetï¼Œå°±ç›´æ¥returnäº†ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥äº‹å…ˆç»™ä¸€ä¸ªå›ºå®šçš„targetä¸“é—¨ç”¨äºåœ¨è¿™ä¸ªæ—¶å€™é¡¶ä¸Šï¼Œç„¶åå¤„ç†è¿™ç§è¯·æ±‚çš„ [self NoTargetActionResponseWithTargetString:targetClassString selectorString:actionString originParams:params]; return nil; &#125; //æ˜¯å¦éœ€è¦ç¼“å­˜ if (shouldCacheTarget) &#123; [self safeSetCachedTarget:target key:targetClassString]; &#125; //æ˜¯å¦å“åº”sel if ([target respondsToSelector:action]) &#123; //åŠ¨æ€è°ƒç”¨æ–¹æ³• return [self safePerformAction:action target:target params:params]; &#125; else &#123; // è¿™é‡Œæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ï¼Œå¦‚æœæ— å“åº”ï¼Œåˆ™å°è¯•è°ƒç”¨å¯¹åº”targetçš„notFoundæ–¹æ³•ç»Ÿä¸€å¤„ç† SEL action = NSSelectorFromString(@&quot;notFound:&quot;); if ([target respondsToSelector:action]) &#123; return [self safePerformAction:action target:target params:params]; &#125; else &#123; // è¿™é‡Œä¹Ÿæ˜¯å¤„ç†æ— å“åº”è¯·æ±‚çš„åœ°æ–¹ï¼Œåœ¨notFoundéƒ½æ²¡æœ‰çš„æ—¶å€™ï¼Œè¿™ä¸ªdemoæ˜¯ç›´æ¥returnäº†ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç”¨å‰é¢æåˆ°çš„å›ºå®šçš„targeté¡¶ä¸Šçš„ã€‚ [self NoTargetActionResponseWithTargetString:targetClassString selectorString:actionString originParams:params]; @synchronized (self) &#123; [self.cachedTarget removeObjectForKey:targetClassString]; &#125; return nil; &#125; &#125;&#125; è¿›å…¥ safePerformAction: target: params: å®ç°ï¼Œä¸»è¦æ˜¯é€šè¿‡ invocation è¿›è¡Œ å‚æ•°ä¼ é€’+æ¶ˆæ¯è½¬å‘ 123456789101112131415- (id)safePerformAction:(SEL)action target:(NSObject *)target params:(NSDictionary *)params&#123; //è·å–æ–¹æ³•ç­¾å NSMethodSignature* methodSig = [target methodSignatureForSelector:action]; if(methodSig == nil) &#123; return nil; &#125; //è·å–æ–¹æ³•ç­¾åä¸­çš„è¿”å›ç±»å‹ï¼Œç„¶åæ ¹æ®è¿”å›å€¼å®Œæˆå‚æ•°ä¼ é€’ const char* retType = [methodSig methodReturnType]; //voidç±»å‹ if (strcmp(retType, @encode(void)) == 0) &#123; ... &#125; //...çœç•¥å…¶ä»–ç±»å‹çš„åˆ¤æ–­&#125; protocol classprotocolåŒ¹é…çš„ å®ç°æ€è·¯ æ˜¯ï¼š å°† protocol å’Œå¯¹åº”çš„ ç±» è¿›è¡Œ å­—å…¸åŒ¹é… é€šè¿‡ç”¨ protocol è·å– classï¼Œåœ¨ åŠ¨æ€åˆ›å»ºå®ä¾‹ protocolæ¯”è¾ƒå…¸å‹çš„ä¸‰æ–¹çŸ¿å»ºå°±æ˜¯ é˜¿é‡Œçš„BeeHive ï¼ŒBeeHive å€Ÿé‰´äº†Spring Serviceã€Apache DSOçš„æ¶æ„ç†å¿µï¼Œé‡‡ç”¨AOP+æ‰©å±•Appå£°æ˜å‘¨æœŸAPI å½¢å¼ï¼Œå°† ä¸šåŠ¡åŠŸèƒ½ã€åŸºç¡€åŠŸèƒ½ æ¨¡å—ä»¥æ¨¡å—æ–¹å¼ä»¥è§£å†³å¤§å‹åº”ç”¨ä¸­çš„å¤æ‚é—®é¢˜ï¼Œå¹¶è®© æ¨¡å—ä¹‹é—´ä»¥Serviceå½¢å¼è°ƒç”¨ï¼Œå°†å¤æ‚é—®é¢˜åˆ‡åˆ†ï¼Œä»¥AOPæ–¹å¼æ¨¡å—åŒ–æœåŠ¡ BeeHiveæ ¸å¿ƒæ€æƒ³ å„ä¸ªæ¨¡å—é—´è°ƒç”¨ä»ç›´æ¥è°ƒç”¨å¯¹åº”æ¨¡å—ï¼Œå˜æˆè°ƒç”¨ Service çš„å½¢å¼ï¼Œé¿å…äº†ç›´æ¥ä¾èµ– Appå£°æ˜å‘¨æœŸçš„åˆ†å‘ï¼Œå°†è€¦åˆåœ¨AppDelegateä¸­é€»è¾‘æ‹†åˆ†ï¼Œä¹°ä¸ªæ¨¡å—ä»¥å¾®åº”ç”¨çš„å½¢å¼ç‹¬ç«‹å­˜åœ¨ ç¤ºä¾‹å¦‚ä¸‹ 1234567// 1ã€æ³¨å†Œ[[BeeHive shareInstance] registerService:@protocol(HomeServiceProtocol) service:[BHViewController class]];// 2ã€ä½¿ç”¨#import &quot;BHService.h&quot;id&lt; HomeServiceProtocol &gt; homeVc = [[BeeHive shareInstance] createService:@protocol(HomeServiceProtocol)]; ä¼˜ç‚¹ åˆ©ç”¨æ¥å£è°ƒç”¨ï¼Œå®ç°äº†å‚æ•°ä¼ é€’æ—¶çš„ç±»å‹å®‰å…¨ ç›´æ¥ä½¿ç”¨æ¨¡å—çš„protocolæ¥å£ï¼Œæ— åºå†é‡å¤å°è£… ç¼ºç‚¹ ç”¨æ¡†æ¶æ¥åˆ›å»ºæ‰€æœ‰å¯¹è±¡ï¼Œåˆ›å»ºæ–¹å¼ä¸åŒï¼Œå³ä¸æ”¯æŒå¤–éƒ¨ä¼ å…¥å‚æ•° ç”¨ OC runtime åˆ›å»ºå¯¹è±¡ï¼Œä¸æ”¯æŒswift åªåšäº† protocol å’Œ class çš„åŒ¹é…ï¼Œä¸æ”¯æŒæ›´å¤æ‚çš„åˆ›å»ºæ–¹å¼å’Œä¾èµ–æ³¨å…¥ æ— æ³•ä¿è¯æ‰€ä½¿ç”¨çš„protocolä¸€å®šå­˜åœ¨å¯¹åº”çš„æ¨¡å—ï¼Œä¹Ÿæ— æ³•ç›´æ¥åˆ¤æ–­æŸä¸ªprotocolæ˜¯å¦èƒ½ç”¨äºè·å–æ¨¡å— é™¤äº† BeeHiveï¼Œè¿˜æœ‰ Swinject BeeHiveæ¨¡å—æ³¨å†Œåœ¨ BeeHive ä¸»è¦æ˜¯é€šè¿‡ BHModuleManager æ¥ç®¡ç†å„ä¸ªæ¨¡å—çš„ã€‚BHModuleManager ä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„æ¨¡å—ã€‚ BeeHiveæä¾›äº†ä¸‰ç§ä¸åŒçš„è°ƒç”¨å½¢å¼ï¼Œé™æ€plistï¼ŒåŠ¨æ€æ³¨å†Œï¼Œannotationã€‚Moduleã€Serviceä¹‹é—´æ²¡æœ‰å…³è”ï¼Œæ¯ä¸ªä¸šåŠ¡æ¨¡å—å¯ä»¥å•ç‹¬å®ç°Moduleæˆ–è€…Serviceçš„åŠŸèƒ½ã€‚ Annotationæ–¹å¼æ³¨å†Œè¿™ç§æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡ BeeHiveMod å®è¿›è¡Œ Annotation æ ‡è®° 123456789101112//***** ä½¿ç”¨BeeHiveMod(ShopModule)//***** BeeHiveModçš„å®å®šä¹‰#define BeeHiveMod(name) \\class BeeHive; char * k##name##_mod BeeHiveDATA(BeehiveMods) = &quot;&quot;#name&quot;&quot;;//***** BeeHiveDATAçš„å®å®šä¹‰ #define BeeHiveDATA(sectname) __attribute((used, section(&quot;__DATA,&quot;#sectname&quot; &quot;)))//***** å…¨éƒ¨è½¬æ¢å‡ºæ¥åä¸ºä¸‹é¢çš„æ ¼å¼char * kShopModule_mod __attribute((used, section(&quot;__DATA,&quot;&quot;BeehiveMods&quot;&quot; &quot;))) = &quot;&quot;&quot;ShopModule&quot;&quot;&quot;; è¿™é‡Œé’ˆå¯¹ __attribute éœ€è¦è¯´æ˜ä»¥ä¸‹å‡ ç‚¹ ç¬¬ä¸€ä¸ªå‚æ•° usedï¼šç”¨æ¥ä¿®é¥°å‡½æ•°ï¼Œè¢«usedä¿®é¥°ä»¥åï¼Œæ„å‘³ç€å³ä½¿å‡½æ•°æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåœ¨Releaseä¸‹ä¹Ÿä¸ä¼šè¢«ä¼˜åŒ–ã€‚å¦‚æœä¸åŠ è¿™ä¸ªä¿®é¥°ï¼Œé‚£ä¹ˆReleaseç¯å¢ƒé“¾æ¥å™¨ä¸‹ä¼šå»æ‰æ²¡æœ‰è¢«å¼•ç”¨çš„æ®µã€‚ é€šè¿‡ä½¿ç”¨ __attribute__((section(&quot;name&quot;))) æ¥æŒ‡æ˜å“ªä¸ªæ®µã€‚æ•°æ®åˆ™ç”¨__attribute__((used)) æ¥æ ‡è®°ï¼Œé˜²æ­¢é“¾æ¥å™¨ä¼šä¼˜åŒ–åˆ é™¤æœªè¢«ä½¿ç”¨çš„æ®µï¼Œç„¶åå°†æ¨¡å—æ³¨å…¥åˆ° __DATA ä¸­ è¿›å…¥ BHReadConfiguration æ–¹æ³•ï¼Œä¸»è¦æ˜¯é€šè¿‡ Mach-O æ‰¾åˆ°å­˜å‚¨çš„æ•°æ®æ®µï¼Œå–å‡ºæ”¾å…¥æ•°ç»„ä¸­ 1234567891011121314151617181920212223242526NSArray&lt;NSString *&gt;* BHReadConfiguration(char *sectionName,const struct mach_header *mhp)&#123; NSMutableArray *configs = [NSMutableArray array]; unsigned long size = 0;#ifndef __LP64__ // æ‰¾åˆ°ä¹‹å‰å­˜å‚¨çš„æ•°æ®æ®µ(Moduleæ‰¾BeehiveModsæ®µ å’Œ Serviceæ‰¾BeehiveServicesæ®µ)çš„ä¸€ç‰‡å†…å­˜ uintptr_t *memory = (uintptr_t*)getsectiondata(mhp, SEG_DATA, sectionName, &amp;size);#else const struct mach_header_64 *mhp64 = (const struct mach_header_64 *)mhp; uintptr_t *memory = (uintptr_t*)getsectiondata(mhp64, SEG_DATA, sectionName, &amp;size);#endif unsigned long counter = size/sizeof(void*); // æŠŠç‰¹æ®Šæ®µé‡Œé¢çš„æ•°æ®éƒ½è½¬æ¢æˆå­—ç¬¦ä¸²å­˜å…¥æ•°ç»„ä¸­ for(int idx = 0; idx &lt; counter; ++idx)&#123; char *string = (char*)memory[idx]; NSString *str = [NSString stringWithUTF8String:string]; if(!str)continue; BHLog(@&quot;config = %@&quot;, str); if(str) [configs addObject:str]; &#125; return configs; &#125; è¯»å–æœ¬åœ°Plistæ–‡ä»¶ é¦–å…ˆï¼Œéœ€è¦è®¾ç½®å¥½è·¯å¾„ 1[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;; // å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist åˆ›å»ºplistæ–‡ä»¶ï¼ŒPlistæ–‡ä»¶çš„æ ¼å¼ä¹Ÿæ˜¯æ•°ç»„ä¸­åŒ…å«å¤šä¸ªå­—å…¸ã€‚å­—å…¸é‡Œé¢æœ‰ä¸¤ä¸ªKeyï¼Œä¸€ä¸ªæ˜¯@&quot;moduleLevel&quot;ï¼Œå¦ä¸€ä¸ªæ˜¯ @&quot;moduleClass&quot; ã€‚æ³¨æ„æ ¹çš„æ•°ç»„çš„åå­—å«@â€œmoduleClassesâ€ã€‚ è¿›å…¥ loadLocalModules æ–¹æ³•ï¼Œä¸»è¦æ˜¯ä» Plist é‡Œé¢å–å‡ºæ•°ç»„ï¼Œç„¶åæŠŠæ•°ç»„åŠ å…¥åˆ°BHModuleInfos æ•°ç»„é‡Œé¢ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546//åˆå§‹åŒ–contextæ—¶ï¼ŒåŠ è½½Moduleså’ŒServices-(void)setContext:(BHContext *)context&#123; _context = context; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; [self loadStaticServices]; [self loadStaticModules]; &#125;);&#125;ğŸ‘‡//åŠ è½½modules- (void)loadStaticModules&#123; // è¯»å–æœ¬åœ°plistæ–‡ä»¶é‡Œé¢çš„Moduleï¼Œå¹¶æ³¨å†Œåˆ°BHModuleManagerçš„BHModuleInfosæ•°ç»„ä¸­ [[BHModuleManager sharedManager] loadLocalModules]; //æ³¨å†Œæ‰€æœ‰modulesï¼Œåœ¨å†…éƒ¨æ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œæ’åº [[BHModuleManager sharedManager] registedAllModules]; &#125;ğŸ‘‡- (void)loadLocalModules&#123; //plistæ–‡ä»¶è·¯å¾„ NSString *plistPath = [[NSBundle mainBundle] pathForResource:[BHContext shareInstance].moduleConfigName ofType:@&quot;plist&quot;]; //åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ if (![[NSFileManager defaultManager] fileExistsAtPath:plistPath]) &#123; return; &#125; //è¯»å–æ•´ä¸ªæ–‡ä»¶[@&quot;moduleClasses&quot; : æ•°ç»„] NSDictionary *moduleList = [[NSDictionary alloc] initWithContentsOfFile:plistPath]; //é€šè¿‡moduleClasses keyè¯»å– æ•°ç»„ [[@&quot;moduleClass&quot;:&quot;aaa&quot;, @&quot;moduleLevel&quot;: @&quot;bbb&quot;], [...]] NSArray&lt;NSDictionary *&gt; *modulesArray = [moduleList objectForKey:kModuleArrayKey]; NSMutableDictionary&lt;NSString *, NSNumber *&gt; *moduleInfoByClass = @&#123;&#125;.mutableCopy; //éå†æ•°ç»„ [self.BHModuleInfos enumerateObjectsUsingBlock:^(NSDictionary * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123; [moduleInfoByClass setObject:@1 forKey:[obj objectForKey:kModuleInfoNameKey]]; &#125;]; [modulesArray enumerateObjectsUsingBlock:^(NSDictionary * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123; if (!moduleInfoByClass[[obj objectForKey:kModuleInfoNameKey]]) &#123; //å­˜å‚¨åˆ° BHModuleInfos ä¸­ [self.BHModuleInfos addObject:obj]; &#125; &#125;];&#125; loadæ–¹æ³•æ³¨å†Œ è¯¥æ–¹æ³• æ³¨å†ŒModule å°±æ˜¯åœ¨ Load æ–¹æ³•é‡Œé¢æ³¨å†ŒModuleçš„ç±» 1234+ (void)load&#123; [BeeHive registerDynamicModule:[self class]];&#125; è¿›å…¥ registerDynamicModule å®ç° 123456789101112131415+ (void)registerDynamicModule:(Class)moduleClass&#123; [[BHModuleManager sharedManager] registerDynamicModule:moduleClass];&#125;ğŸ‘‡- (void)registerDynamicModule:(Class)moduleClass&#123; [self registerDynamicModule:moduleClass shouldTriggerInitEvent:NO];&#125;ğŸ‘‡- (void)registerDynamicModule:(Class)moduleClass shouldTriggerInitEvent:(BOOL)shouldTriggerInitEvent&#123; [self addModuleFromObject:moduleClass shouldTriggerInitEvent:shouldTriggerInitEvent];&#125; å…¶åº•å±‚è¿˜æ˜¯åŒç¬¬ä¸€ç§æ–¹å¼ä¸€æ ·ï¼Œæœ€ç»ˆä¼šèµ°åˆ°addModuleFromObject:shouldTriggerInitEvent:æ–¹æ³•ä¸­ loadæ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ BH_EXPORT_MODULE å®ä»£æ›¿ 123#define BH_EXPORT_MODULE(isAsync) \\+ (void)load &#123; [BeeHive registerDynamicModule:[self class]]; &#125; \\-(BOOL)async &#123; return [[NSString stringWithUTF8String:#isAsync] boolValue];&#125; BH_EXPORT_MODULE å®é‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨ æ˜¯å¦å¼‚æ­¥åŠ è½½Moduleæ¨¡å—ï¼Œå¦‚æœæ˜¯YESå°±æ˜¯ å¼‚æ­¥åŠ è½½ï¼Œå¦‚æœæ˜¯ NO å°±æ˜¯ åŒæ­¥åŠ è½½ã€‚ BeeHive æ¨¡å—äº‹ä»¶ BeeHiveä¼šç»™æ¯ä¸ªæ¨¡å—æä¾›ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œç”¨äºä¸BeeHiveå®¿ä¸»ç¯å¢ƒè¿›è¡Œå¿…è¦ä¿¡æ¯äº¤äº’ï¼Œæ„ŸçŸ¥æ¨¡å—ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–ã€‚ BeeHiveå„ä¸ªæ¨¡å—ä¼šæ”¶åˆ°ä¸€äº›äº‹ä»¶ã€‚åœ¨ BHModuleManager ä¸­ï¼Œæ‰€æœ‰çš„äº‹ä»¶è¢«å®šä¹‰æˆäº†BHModuleEventType æšä¸¾ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­æœ‰2ä¸ªäº‹ä»¶å¾ˆç‰¹æ®Šï¼Œä¸€ä¸ªæ˜¯ BHMInitEventï¼Œä¸€ä¸ªæ˜¯ BHMTearDownEvent 1234567891011121314151617181920212223242526272829303132typedef NS_ENUM(NSInteger, BHModuleEventType)&#123; //è®¾ç½®Moduleæ¨¡å— BHMSetupEvent = 0, //ç”¨äºåˆå§‹åŒ–Moduleæ¨¡å—ï¼Œä¾‹å¦‚ç¯å¢ƒåˆ¤æ–­ï¼Œæ ¹æ®ä¸åŒç¯å¢ƒè¿›è¡Œä¸åŒåˆå§‹åŒ– BHMInitEvent, //ç”¨äºæ‹†é™¤Moduleæ¨¡å— BHMTearDownEvent, BHMSplashEvent, BHMQuickActionEvent, BHMWillResignActiveEvent, BHMDidEnterBackgroundEvent, BHMWillEnterForegroundEvent, BHMDidBecomeActiveEvent, BHMWillTerminateEvent, BHMUnmountEvent, BHMOpenURLEvent, BHMDidReceiveMemoryWarningEvent, BHMDidFailToRegisterForRemoteNotificationsEvent, BHMDidRegisterForRemoteNotificationsEvent, BHMDidReceiveRemoteNotificationEvent, BHMDidReceiveLocalNotificationEvent, BHMWillPresentNotificationEvent, BHMDidReceiveNotificationResponseEvent, BHMWillContinueUserActivityEvent, BHMContinueUserActivityEvent, BHMDidFailToContinueUserActivityEvent, BHMDidUpdateUserActivityEvent, BHMHandleWatchKitExtensionRequestEvent, BHMDidCustomEvent = 1000 &#125;; ä¸»è¦åˆ†ä¸ºä¸‰ç§ ç³»ç»Ÿäº‹ä»¶ï¼šä¸»è¦æ˜¯æŒ‡ Applicationç”Ÿå‘½å‘¨æœŸäº‹ä»¶! ä¸€èˆ¬çš„åšæ³•æ˜¯AppDelegateæ”¹ä¸º ç»§æ‰¿è‡ªBHAppDelegate 1@interface TestAppDelegate : BHAppDelegate &lt;UIApplicationDelegate&gt; åº”ç”¨äº‹ä»¶ï¼šå®˜æ–¹ç»™å‡ºçš„æµç¨‹å›¾ï¼Œå…¶ä¸­ modSetupã€modInit ç­‰ï¼Œå¯ä»¥ç”¨äºç¼–ç å®ç°å„æ’ä»¶æ¨¡å—çš„è®¾ç½®ä¸åˆå§‹åŒ–ã€‚ è‡ªå®šä¹‰äº‹ä»¶ ä»¥ä¸Šæ‰€æœ‰çš„äº‹ä»¶éƒ½å¯ä»¥é€šè¿‡è°ƒç”¨ BHModuleManager çš„ triggerEvent: æ¥å¤„ç†ã€‚ 123456789101112131415161718192021222324252627282930313233343536- (void)triggerEvent:(NSInteger)eventType&#123; [self triggerEvent:eventType withCustomParam:nil]; &#125;ğŸ‘‡- (void)triggerEvent:(NSInteger)eventType withCustomParam:(NSDictionary *)customParam &#123; [self handleModuleEvent:eventType forTarget:nil withCustomParam:customParam];&#125;ğŸ‘‡#pragma mark - module protocol- (void)handleModuleEvent:(NSInteger)eventType forTarget:(id&lt;BHModuleProtocol&gt;)target withCustomParam:(NSDictionary *)customParam&#123; switch (eventType) &#123; //åˆå§‹åŒ–äº‹ä»¶ case BHMInitEvent: //special [self handleModulesInitEventForTarget:nil withCustomParam :customParam]; break; //ææ„äº‹ä»¶ case BHMTearDownEvent: //special [self handleModulesTearDownEventForTarget:nil withCustomParam:customParam]; break; //å…¶ä»–3ç±»äº‹ä»¶ default: &#123; NSString *selectorStr = [self.BHSelectorByEvent objectForKey:@(eventType)]; [self handleModuleEvent:eventType forTarget:nil withSeletorStr:selectorStr andCustomParam:customParam]; &#125; break; &#125; &#125; ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥å‘ç°ï¼Œé™¤å» BHMInitEvent åˆå§‹åŒ–äº‹ä»¶å’Œ BHMTearDownEvent æ‹†é™¤Moduleäº‹ä»¶è¿™ä¸¤ä¸ªç‰¹æ®Šäº‹ä»¶ä»¥å¤–ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯è°ƒç”¨çš„handleModuleEvent:forTarget:withSeletorStr:andCustomParam:æ–¹æ³•ï¼Œå…¶å†…éƒ¨å®ç°ä¸»è¦æ˜¯éå† moduleInstances å®ä¾‹æ•°ç»„ï¼Œè°ƒç”¨ performSelector:withObject: æ–¹æ³•å®ç°å¯¹åº”æ–¹æ³•è°ƒç”¨ 123456789101112131415161718192021222324252627282930313233343536- (void)handleModuleEvent:(NSInteger)eventType forTarget:(id&lt;BHModuleProtocol&gt;)target withSeletorStr:(NSString *)selectorStr andCustomParam:(NSDictionary *)customParam&#123; BHContext *context = [BHContext shareInstance].copy; context.customParam = customParam; context.customEvent = eventType; if (!selectorStr.length) &#123; selectorStr = [self.BHSelectorByEvent objectForKey:@(eventType)]; &#125; SEL seletor = NSSelectorFromString(selectorStr); if (!seletor) &#123; selectorStr = [self.BHSelectorByEvent objectForKey:@(eventType)]; seletor = NSSelectorFromString(selectorStr); &#125; NSArray&lt;id&lt;BHModuleProtocol&gt;&gt; *moduleInstances; if (target) &#123; moduleInstances = @[target]; &#125; else &#123; moduleInstances = [self.BHModulesByEvent objectForKey:@(eventType)]; &#125; //éå† moduleInstances å®ä¾‹æ•°ç»„ï¼Œè°ƒç”¨performSelector:withObject:æ–¹æ³•å®ç°å¯¹åº”æ–¹æ³•è°ƒç”¨ [moduleInstances enumerateObjectsUsingBlock:^(id&lt;BHModuleProtocol&gt; moduleInstance, NSUInteger idx, BOOL * _Nonnull stop) &#123; if ([moduleInstance respondsToSelector:seletor]) &#123;#pragma clang diagnostic push#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot; //è¿›è¡Œæ–¹æ³•è°ƒç”¨ [moduleInstance performSelector:seletor withObject:context];#pragma clang diagnostic pop [[BHTimeProfiler sharedTimeProfiler] recordEventTime:[NSString stringWithFormat:@&quot;%@ --- %@&quot;, [moduleInstance class], NSStringFromSelector(seletor)]]; &#125; &#125;];&#125; æ³¨æ„:è¿™é‡Œæ‰€æœ‰çš„ Module å¿…é¡»æ˜¯éµå¾ª BHModuleProtocol çš„ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶åˆ°è¿™äº›äº‹ä»¶çš„æ¶ˆæ¯ã€‚ BeeHiveæ¨¡å—è°ƒç”¨ åœ¨BeeHiveä¸­æ˜¯é€šè¿‡ BHServiceManager æ¥ç®¡ç†å„ä¸ª Protocol çš„ã€‚BHServiceManager ä¸­åªä¼šç®¡ç†å·²ç»è¢«æ³¨å†Œè¿‡çš„ Protocolã€‚ æ³¨å†Œ Protocol çš„æ–¹å¼æ€»å…±æœ‰ä¸‰ç§ï¼Œå’Œæ³¨å†Œ Module æ˜¯ä¸€æ ·ä¸€ä¸€å¯¹åº”çš„ Annotationæ–¹å¼æ³¨å†Œ 123456789//****** 1ã€é€šè¿‡BeeHiveServiceå®è¿›è¡ŒAnnotationæ ‡è®°BeeHiveService(HomeServiceProtocol,BHViewController)//****** 2ã€å®å®šä¹‰#define BeeHiveService(servicename,impl) \\class BeeHive; char * k##servicename##_service BeeHiveDATA(BeehiveServices) = &quot;&#123; \\&quot;&quot;#servicename&quot;\\&quot; : \\&quot;&quot;#impl&quot;\\&quot;&#125;&quot;;//****** 3ã€è½¬æ¢åçš„æ ¼å¼ï¼Œä¹Ÿæ˜¯å°†å…¶å­˜å‚¨åˆ°ç‰¹æ®Šçš„æ®µchar * kHomeServiceProtocol_service __attribute((used, section(&quot;__DATA,&quot;&quot;BeehiveServices&quot;&quot; &quot;))) = &quot;&#123; \\&quot;&quot;&quot;HomeServiceProtocol&quot;&quot;\\&quot; : \\&quot;&quot;&quot;BHViewController&quot;&quot;\\&quot;&#125;&quot;; è¯»å–æœ¬åœ°plistæ–‡ä»¶ é¦–å…ˆåŒModuleä¸€æ ·ï¼Œéœ€è¦å…ˆè®¾ç½®å¥½è·¯å¾„ 1[BHContext shareInstance].serviceConfigName = @&quot;BeeHive.bundle/BHService&quot;; è®¾ç½®plistæ–‡ä»¶ åŒæ ·ä¹Ÿæ˜¯åœ¨ setContext æ—¶æ³¨å†Œ services 12345678910111213141516171819202122232425262728293031//åŠ è½½services-(void)loadStaticServices&#123; [BHServiceManager sharedManager].enableException = self.enableException; [[BHServiceManager sharedManager] registerLocalServices]; &#125;ğŸ‘‡- (void)registerLocalServices&#123; NSString *serviceConfigName = [BHContext shareInstance].serviceConfigName; //è·å–plistæ–‡ä»¶è·¯å¾„ NSString *plistPath = [[NSBundle mainBundle] pathForResource:serviceConfigName ofType:@&quot;plist&quot;]; if (!plistPath) &#123; return; &#125; NSArray *serviceList = [[NSArray alloc] initWithContentsOfFile:plistPath]; [self.lock lock]; //éå†å¹¶å­˜å‚¨åˆ°allServicesDictä¸­ for (NSDictionary *dict in serviceList) &#123; NSString *protocolKey = [dict objectForKey:@&quot;service&quot;]; NSString *protocolImplClass = [dict objectForKey:@&quot;impl&quot;]; if (protocolKey.length &gt; 0 &amp;&amp; protocolImplClass.length &gt; 0) &#123; [self.allServicesDict addEntriesFromDictionary:@&#123;protocolKey:protocolImplClass&#125;]; &#125; &#125; [self.lock unlock];&#125; loadæ–¹æ³•æ³¨å†Œ åœ¨ Load æ–¹æ³•é‡Œé¢æ³¨å†Œ Protocol åè®®ï¼Œä¸»è¦æ˜¯è°ƒç”¨ BeeHive é‡Œé¢çš„registerService:service: å®Œæˆ protocol çš„æ³¨å†Œ 123456789+ (void)load&#123; [[BeeHive shareInstance] registerService:@protocol(UserTrackServiceProtocol) service:[BHUserTrackViewController class]];&#125;ğŸ‘‡- (void)registerService:(Protocol *)proto service:(Class) serviceClass&#123; [[BHServiceManager sharedManager] registerService:proto implClass:serviceClass];&#125; åˆ°æ­¤ï¼Œä¸‰ç§æ–¹å¼å°±åˆ›å»ºå®Œæˆäº† Protocolçš„è·å– Protocol ä¸ Module çš„åŒºåˆ«åœ¨äºï¼ŒProtocol æ¯” Module å¤šäº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å› Protocolå®ä¾‹å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556- (id)createService:(Protocol *)proto;&#123; return [[BHServiceManager sharedManager] createService:proto];&#125;ğŸ‘‡- (id)createService:(Protocol *)service&#123; return [self createService:service withServiceName:nil];&#125;ğŸ‘‡- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName &#123; return [self createService:service withServiceName:serviceName shouldCache:YES];&#125;ğŸ‘‡- (id)createService:(Protocol *)service withServiceName:(NSString *)serviceName shouldCache:(BOOL)shouldCache &#123; if (!serviceName.length) &#123; serviceName = NSStringFromProtocol(service); &#125; id implInstance = nil; //åˆ¤æ–­protocolæ˜¯å¦å·²ç»æ³¨å†Œè¿‡ if (![self checkValidService:service]) &#123; if (self.enableException) &#123; @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&quot;%@ protocol does not been registed&quot;, NSStringFromProtocol(service)] userInfo:nil]; &#125; &#125; NSString *serviceStr = serviceName; //å¦‚æœæœ‰ç¼“å­˜ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å– if (shouldCache) &#123; id protocolImpl = [[BHContext shareInstance] getServiceInstanceFromServiceName:serviceStr]; if (protocolImpl) &#123; return protocolImpl; &#125; &#125; //è·å–ç±»åï¼Œç„¶åå“åº”ä¸‹å±‚çš„æ–¹æ³• Class implClass = [self serviceImplClass:service]; if ([[implClass class] respondsToSelector:@selector(singleton)]) &#123; if ([[implClass class] singleton]) &#123; if ([[implClass class] respondsToSelector:@selector(shareInstance)]) //åˆ›å»ºå•ä¾‹å¯¹è±¡ implInstance = [[implClass class] shareInstance]; else //åˆ›å»ºå®ä¾‹å¯¹è±¡ implInstance = [[implClass alloc] init]; if (shouldCache) &#123; //ç¼“å­˜ [[BHContext shareInstance] addServiceWithImplInstance:implInstance serviceName:serviceStr]; return implInstance; &#125; else &#123; return implInstance; &#125; &#125; &#125; return [[implClass alloc] init];&#125; createService ä¼šå…ˆæ£€æŸ¥Protocolåè®®æ˜¯å¦æ˜¯æ³¨å†Œè¿‡çš„ã€‚ç„¶åæ¥ç€å–å‡ºå­—å…¸é‡Œé¢å¯¹åº”çš„Classï¼Œå¦‚æœå®ç°äº† shareInstance æ–¹æ³•ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª å•ä¾‹å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ª å®ä¾‹å¯¹è±¡ã€‚å¦‚æœè¿˜å®ç°äº†singletonï¼Œå°±èƒ½è¿›ä¸€æ­¥çš„æŠŠ implInstance å’ŒserviceStr å¯¹åº”çš„åŠ åˆ° BHContext çš„ servicesByName å­—å…¸é‡Œé¢ ç¼“å­˜ èµ·æ¥ã€‚è¿™æ ·å°±å¯ä»¥éšç€ä¸Šä¸‹æ–‡ä¼ é€’äº† è¿›å…¥ serviceImplClass å®ç°ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡º protocol å’Œ ç±» æ˜¯é€šè¿‡ å­—å…¸ ç»‘å®šçš„ï¼Œprotocolä½œä¸ºkeyï¼ŒserviceImpï¼ˆç±»çš„åå­—ï¼‰ä½œä¸ºvalue 123456789- (Class)serviceImplClass:(Protocol *)service&#123; //é€šè¿‡å­—å…¸å°† åè®® å’Œ ç±» ç»‘å®šï¼Œå…¶ä¸­åè®®ä½œä¸ºkeyï¼ŒserviceImpï¼ˆç±»çš„åå­—ï¼‰ä½œä¸ºvalue NSString *serviceImpl = [[self servicesDict] objectForKey:NSStringFromProtocol(service)]; if (serviceImpl.length &gt; 0) &#123; return NSClassFromString(serviceImpl); &#125; return nil;&#125; Module &amp; Protocolè¿™é‡Œç®€å•æ€»ç»“ä¸‹ï¼š å¯¹äº Moduleï¼šæ•°ç»„å­˜å‚¨ å¯¹äº Protocolï¼šé€šè¿‡å­—å…¸å°† protocol ä¸ ç±» è¿›è¡Œ ç»‘å®šï¼Œkey ä¸º protocolï¼Œ value ä¸º serviceImp å³ç±»å è¾…åŠ©ç±» BHConfig ç±»ï¼šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ª NSMutableDictionary ç±»å‹çš„ config å±æ€§ï¼Œè¯¥å±æ€§ç»´æŠ¤äº†ä¸€äº›åŠ¨æ€çš„ç¯å¢ƒå˜é‡ï¼Œä½œä¸º BHContext çš„è¡¥å……å­˜åœ¨ BHContext ç±»ï¼šæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ª NSMutableDictionary çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯ modulesByName å’Œ servicesByNameã€‚è¿™ä¸ªç±»ä¸»è¦ç”¨æ¥ä¿å­˜ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ã€‚ä¾‹å¦‚åœ¨ application:didFinishLaunchingWithOptions: çš„æ—¶å€™ï¼Œå°±å¯ä»¥åˆå§‹åŒ–å¤§é‡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ 12345//ä¿å­˜ä¿¡æ¯[BHContext shareInstance].application = application;[BHContext shareInstance].launchOptions = launchOptions;[BHContext shareInstance].moduleConfigName = @&quot;BeeHive.bundle/BeeHive&quot;;//å¯é€‰ï¼Œé»˜è®¤ä¸ºBeeHive.bundle/BeeHive.plist[BHContext shareInstance].serviceConfigName = @&quot;BeeHive.bundle/BHService&quot;; BHTimeProfiler ç±»ï¼šç”¨æ¥è¿›è¡Œè®¡ç®—æ—¶é—´æ€§èƒ½æ–¹é¢çš„Profiler BHWatchDog ç±»ï¼šç”¨æ¥å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œç›‘å¬ä¸»çº¿ç¨‹æ˜¯å¦å µå¡","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†39ï¼šç»„ä»¶åŒ–ï¼ˆä¸€ï¼‰æ–¹æ¡ˆ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†39ï¼šç»„ä»¶åŒ–ï¼ˆä¸€ï¼‰æ–¹æ¡ˆ","date":"2021-06-22T06:50:12.000Z","updated":"2023-03-04T15:21:45.000Z","comments":true,"path":"2021/06/22/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†39ï¼šç»„ä»¶åŒ–ï¼ˆä¸€ï¼‰æ–¹æ¡ˆ/","link":"","permalink":"https://www.bboyzj.cn/2021/06/22/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8639%EF%BC%9A%E7%BB%84%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E6%96%B9%E6%A1%88/","excerpt":"","text":"ç»„ä»¶åŒ–æ–¹æ¡ˆ å¸¸ç”¨çš„ç»„ä»¶åŒ–æ–¹æ¡ˆä¸»è¦æœ‰ä¸¤ç§ï¼š æœ¬åœ°ç»„ä»¶åŒ–ï¼šä¸»è¦æ˜¯é€šè¿‡åœ¨ å·¥ç¨‹ä¸­åˆ›å»ºlibraryï¼Œåˆ©ç”¨ cocoapods çš„ workspec è¿›è¡Œæœ¬åœ°ç®¡ç†ï¼Œä¸éœ€è¦å°†é¡¹ç›®ä¸Šä¼ gitï¼Œè€Œæ˜¯ç›´æ¥åœ¨æœ¬é¡¹ç›®ä¸­ä»¥ framework çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ cocoapodsç»„ä»¶åŒ–ï¼šä¸»è¦æ˜¯åˆ©ç”¨ cocoapods æ¥è¿›è¡Œç®¡ç†æ¨¡å—çš„ è¿œç¨‹ç®¡ç†ï¼Œéœ€è¦å°†é¡¹ç›®ä¸Šä¼ gitï¼ˆéœ€è¦æ³¨æ„ï¼šè¿™é‡Œçš„ç»„ä»¶åŒ–æ¨¡å—åˆ†ä¸º å…¬æœ‰åº“ å’Œ ç§æœ‰åº“ï¼Œå¯¹å…¬å¸è€Œè¨€ï¼Œä¸€èˆ¬æ˜¯ ç§æœ‰åº“ï¼‰ æœ¬åœ°ç»„ä»¶åŒ–åˆ›å»ºä¸»å·¥ç¨‹ é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º Modularization çš„å·¥ç¨‹ é›†æˆ cocoapodsï¼Œè¿›è¡Œæœ¬åœ°ç®¡ç† 1234zhangjian@zhangjiandeMBP ~ % cd /Users/zhangjian/Desktop/Modularization zhangjian@zhangjiandeMBP Modularization % pod initIgnoring ffi-1.13.1 because its extensions are not built. Try: gem pristine ffi --version 1.13.1zhangjian@zhangjiandeMBP Modularization % pod install åˆ›å»ºç»„ä»¶å‡è®¾æœ‰ä»¥ä¸‹å‡ ä¸ªæ¨¡å— ä¸»å·¥ç¨‹ï¼šæ‰¿è½½ä¸»è¦çš„è¡¨å±‚ä¸šåŠ¡ä»£ç  Coreï¼šç‹¬ç«‹å­˜åœ¨ï¼Œåº”ç”¨åŠ å¯†ã€æ¥å£è¯·æ±‚ç­‰æ•æ„Ÿä»£ç  Baseï¼šåŸºç±»å°è£…ï¼Œæ‹“å±•ï¼ŒåŸºæœ¬çš„æ•°æ®å¤„ç† Serviceï¼šæœåŠ¡å±‚ï¼Œå°è£…ä¸šåŠ¡å·¥å…·ç±»ï¼Œä¾‹å¦‚ç½‘ç»œå±‚æœåŠ¡ã€æŒä¹…åŒ–æœåŠ¡ç­‰ Podsï¼šä¸‰æ–¹ä¾èµ– å…¶ä¸­ï¼Œå„ä¸ªæ¨¡å—é—´çš„å…³ç³»å¦‚ä¸‹å›¾ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¿›è¡Œæ¨¡å—çš„åˆ›å»ºï¼Œä»¥ Core æ¨¡å—ä¸ºä¾‹ï¼š é€‰æ‹© File -&gt; new -&gt; project -&gt; iOS -&gt; Frameworkï¼Œæ–°å»ºä¸€ä¸ª ZJCore æ¨¡å— é€‰æ‹©æ­£ç¡®çš„ Group å’Œ WorkSpaceï¼ˆè¿™é‡Œæ³¨æ„ï¼šåˆ›å»ºçš„ library æœ€å¥½æ”¾åœ¨ ä¸»å·¥ç¨‹æ ¹ç›®å½•ä¸‹ï¼Œå¦åˆ™åç»­çš„ podfile æ‰§è¡Œ pod install ä¼šæŠ¥é”™ï¼‰ åˆ›å»ºæˆåŠŸåï¼Œçœ‹åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š å°†åˆ›å»ºçš„ library çš„ Build Settings -&gt; Mach-O Type ä¿®æ”¹ä¸ºé™æ€åº“ Static Library ä¸»å·¥ç¨‹è°ƒç”¨Library åœ¨ ZJCore ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä»£ç  1234567@interface ZJCoreSetting : NSObject// å£°æ˜å±æ€§@property (nonatomic,copy)NSString * name;@end@implementation ZJCoreSetting@end åœ¨ Build Phases -&gt; Headers -&gt; Public ä¸­å°†æ–°å»ºçš„æ–‡ä»¶æ‹–æ‹½åˆ° Puclic ä¸­ï¼Œè¿™æ ·ä¸»å·¥ç¨‹æ‰èƒ½è®¿é—®è¯¥æ–‡ä»¶ åœ¨ZJCoreæ–‡ä»¶ä¸­æ·»åŠ å¼•ç”¨ åœ¨ä¸»å·¥ç¨‹ä¸­ï¼Œé€‰æ‹© target -&gt; Frameworks,Libraries,and Embedded Content -&gt; + å· -&gt; æ·»åŠ  ZJCoreï¼Œåªéœ€è¦buildä¸»å·¥ç¨‹ï¼Œlibraryèƒ½å¤Ÿè‡ªåŠ¨è”ç¼– ä½¿ç”¨é¦–å…ˆ #import &lt;ZJCore/ZJCoreSetting.h&gt;ï¼Œç„¶åä½¿ç”¨ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­libraryä¹‹é—´çš„äº’ç›¸è°ƒç”¨ï¼Œä¸ä¸»å·¥ç¨‹è°ƒç”¨libraryç±»ä¼¼ï¼Œä¸»éœ€è¦æ·»åŠ ä¾èµ–ã€æš´éœ²headerå³å¯ ä½¿ç”¨cocoapodsç®¡ç†ä¸‰æ–¹ä¾èµ–å‡è®¾æˆ‘ä»¬éœ€è¦åœ¨ ZJCore ä¸­å°è£…ç½‘ç»œå±‚ä»£ç ï¼Œéœ€è¦ç”¨åˆ°ä¸‰æ–¹åº“ AFNetworkingï¼Œåœ¨podfileä¸­æœ‰å¦‚ä¸‹é…ç½®ï¼š 12345678910111213141516171819202122232425262728# Uncomment the next line to define a global platform for your projectplatform :ios, &#x27;9.0&#x27;################# ä¸‰æ–¹ä¾èµ–# ç½‘ç»œdef network_layer_pods pod &#x27;AFNetworking&#x27;end################# æ¨¡å—target &#x27;ZJCore&#x27; do # é…ç½®librayè·¯å¾„ project &#x27;ZJCore/ZJCore.xcodeproj&#x27; network_layer_podsend################# ä¸»å·¥ç¨‹target &#x27;Modularization&#x27; do # Comment the next line if you don&#x27;t want to use dynamic frameworks use_frameworks! network_layer_pods # Pods for Modularizationend ç»ˆç«¯ pod install ï¼Œç„¶åç­‰å¾…æˆåŠŸï¼ŒæˆåŠŸåä½ å¯ä»¥åœ¨ ZJCore æ¨¡å—ä¸­å¼•ç”¨å¤´æ–‡ä»¶ #import &lt;AFNetworking.h&gt; å¹¶ä½¿ç”¨ä¸‰æ–¹åº“å¦‚ä¸‹ï¼š åˆ°æ­¤ï¼Œä¸€ä¸ªæœ¬åœ°ç»„ä»¶åŒ–çš„æ¨¡å—å°±é…ç½®å®Œæˆäº† cocoapodsç»„ä»¶åŒ–é™¤äº†æœ¬åœ°ç»„ä»¶åŒ–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ cocoapodsï¼Œå…¶åŸç†å¦‚ä¸‹å›¾æ‰€ç¤º è¿™é‡Œè¿˜æ˜¯ä»¥æœ¬åœ°ç»„ä»¶åŒ–ä¸­çš„ç»“æ„ä¸ºä¾‹ åˆ›å»ºç§æœ‰ä»“åº“ åœ¨ github ä¸Šåˆ›å»ºä¸€ä¸ª MySpecs ä»“åº“ å…·ä½“æ­¥éª¤ï¼šç™»å½•github -&gt; ç‚¹å‡»å³ä¸Šè§’+å· -&gt; new reponsitory -&gt; è¾“å…¥ repository name ä¸º MySpecsï¼Œé€‰æ‹©ä»“åº“ç±»å‹ä¸º privateï¼Œç‚¹å‡» Create reponsitory å°†ç§æœ‰ä»“åº“æ·»åŠ è‡³æœ¬åœ° ~/.cocoapods/repos ç›®å½• 1pod repo add MySpecs git@github.com:13718004742/MySpecs.git æŸ¥çœ‹æ·»åŠ ç»“æœ åˆ›å»ºpodså·¥ç¨‹ï¼Œå³ç»„ä»¶åŒ–å·¥ç¨‹ ä½¿ç”¨ç»ˆç«¯åˆ›å»º ZJServices æ¨¡å— 12% cd Desktop % pod lib create ZJServices æ ¹æ®æç¤ºä¸€æ¬¡è¾“å…¥ï¼šiOSã€Objcã€Yesã€Noneã€Noã€ZJ è¿›å…¥æ¨¡å—çš„ç›®å½•ï¼Œå°†æ–‡ä»¶æ‹·è´è‡³ ZJServices -&gt; Classes ä¸­ï¼Œåˆ æ‰ ReplaceMe.m -&gt; æ›¿æ¢æˆä½ å°è£…å¥½çš„æ–‡ä»¶ æ‰§è¡Œ pod installï¼Œä¼šå°† Classesæ›´æ–°è‡³podsä¸­ 12% cd /Users/zhangjian/Desktop/ZJServices/Example% pod install æˆåŠŸåï¼ŒæŸ¥çœ‹å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š é…ç½®podså·¥ç¨‹ä¿®æ”¹æ¨¡å—çš„é…ç½®æ–‡ä»¶ï¼Œå³ ZJServices.podspec å¦‚æœéœ€è¦ä¾èµ–ä¸‰æ–¹åº“ï¼Œéœ€è¦é…ç½® s.dependecy 1s.dependency &#x27;AFNetworking&#x27;, &#x27;~&gt; 4.0.1&#x27; å¦‚æœæ¨¡å—é—´éœ€è¦ç›¸äº’å¼•ç”¨ï¼ŒåŒæ ·éœ€è¦é…ç½® s.dependencyï¼Œä»¥ ZJCore ä¸ºä¾‹ï¼Œéœ€è¦å¼•ç”¨ ZJServiceï¼Œåœ¨æ¡Œé¢ä»¥åŒæ ·çš„æ–¹å¼å†æ¬¡åˆ›å»ºä¸€ä¸ª ZJCoreï¼Œç„¶åä¿®æ”¹å¦‚ä¸‹ï¼š 12// 1.ä¿®æ”¹ podspec æ–‡ä»¶s.dependency &#x27;ZJServices&#x27; 12// 2. ä¿®æ”¹podfile æ–‡ä»¶pod &#x27;ZJServices&#x27;, :path =&gt; &#x27;../../ZJServices&#x27; å¦‚æœéœ€è¦åŠ è½½èµ„æºï¼Œå¦‚ å›¾ç‰‡/json/bundle æ–‡ä»¶ç­‰ åœ¨æ¨¡å—çš„ Assets æ–‡ä»¶å¤¹ä¸­æ·»åŠ èµ„æºæ–‡ä»¶ åœ¨ specs é‡Œé…ç½®èµ„æºè·¯å¾„ï¼ˆå¿…é¡»é…ç½®ï¼ï¼å¦åˆ™æ— æ³•è¯»å–èµ„æºï¼‰ è®¿é—®æ—¶éœ€è¦æŒ‡å®šèµ„æºæ–‡ä»¶è·¯å¾„ 1234// 1. ä¿®æ”¹ podspec æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºZJCore.bundles.resource_bundles = &#123; &#x27;ZJCore&#x27; =&gt; [&#x27;ZJCore/Assets/*.png&#x27;] &#125; ZJCore ä¸ºæ˜¾ç¤ºçš„å›¾ç‰‡èµ„æºçš„ bundle åå­—ï¼Œåœ¨æœ¬åœ°ä¼šæ˜¾ç¤º ZJCore.bundleï¼Œè¿™ä¸ª å¯ä»¥è‡ªå®šä¹‰ï¼ŒZJCore/Assets ä¸ºå›¾ç‰‡æ–‡ä»¶ç›®å½•ï¼Œå›åˆ° ZJCore çš„ Example æ¨¡å—ï¼Œå®‰è£… pod install 12345678910111213141516171819// 2. ä½¿ç”¨UIImageView *imgView = [[UIImageView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];imgView.backgroundColor = [UIColor yellowColor];[self.view addSubview:imgView]; //åˆ°æŒ‡å®šç›®å½•NSURL * bundleURL = [[NSBundle mainBundle] URLForResource:@&quot;Frameworks&quot; withExtension:nil];bundleURL = [bundleURL URLByAppendingPathComponent:@&quot;ZJCore&quot;];bundleURL = [bundleURL URLByAppendingPathExtension:@&quot;framework&quot;];if (bundleURL) &#123; NSBundle *imgBundle = [NSBundle bundleWithURL:bundleURL]; bundleURL = [imgBundle URLForResource:@&quot;ZJCore&quot; withExtension:@&quot;bundle&quot;]; if (bundleURL) &#123; NSBundle *bundle = [NSBundle bundleWithURL:bundleURL]; NSInteger scale = [[UIScreen mainScreen] scale]; NSString *imgName = [NSString stringWithFormat:@&quot;%@@%zdx.png&quot;, @&quot;zj&quot;,scale]; imgView.image = [UIImage imageWithContentsOfFile:[bundle pathForResource:imgName ofType:nil]]; &#125;&#125; é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡èµ„æºåœ¨ Frameworks ä¸‹çš„ ZJCore.framework ä¸‹çš„ ZJCore.bundle åŒ…ä¸­ï¼Œå³é”®æ‰“å¼€åŒ…å†…å®¹ï¼Œå³å¯çœ‹åˆ° zj@2x.png å›¾ç‰‡ï¼Œå¦‚ä¸‹å›¾ï¼š åŒç†ï¼Œæ¨¡å—ä¸­çš„jsonæ–‡ä»¶çš„è·å–æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„ æäº¤è‡³gitè¿™é‡Œæäº¤è‡³gitçš„æ¨¡å—æ˜¯podså·¥ç¨‹æ‰å¯ä»¥ï¼Œä»¥ ZJCore ä¸ºä¾‹ éœ€è¦åœ¨githubä¸Šåˆ›å»ºä¸€ä¸ªç§æœ‰repositoryï¼Œå‘½åä¸º ZJCore æ‰§è¡Œä»¥ä¸‹ç»ˆç«¯å‘½ä»¤ 123456789101112$ git init$ git add .$ git commit -m &quot;ç¬¬ä¸€æ¬¡æäº¤&quot; // å³ç¬¬ä¸€ä¸ªæ­¥éª¤ä¸­åˆ›å»ºçš„ä»“åº“åœ°å€$ git remote add origin git@github.com:13718004742/ZJCore.git// æŸ¥çœ‹å½“å‰ä¸»åˆ†æ”¯å$ git branch$ git push -u -f origin master // ä¸€å®šè¦æœ‰æ ‡ç­¾ï¼Œä¸ç„¶ä¼šæœ‰ä¸‹é¢çš„è­¦å‘Š// podspecæ–‡ä»¶ä¸­è·å–Gitç‰ˆæœ¬æ§åˆ¶çš„é¡¹ç›®éœ€è¦tagå·ï¼Œ % git tag -d rm è¡¨ç¤ºåˆ é™¤$ git tag &quot;0.1.0&quot; $ git push --tags éªŒè¯podspecæ–‡ä»¶æ‰§è¡Œç»ˆç«¯å‘½ä»¤ pod spec lintï¼Œæ³¨æ„ï¼špod spec ç›¸å¯¹äº pod lib ä¼šæ›´ä¸ºç²¾ç¡® * pod lib ç›¸å½“äºåªéªŒè¯ä¸€ä¸ªæœ¬åœ°ä»“åº“ * pod spec ä¼šåŒæ—¶éªŒè¯æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ 1% pod spec lint --allow-warnings å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ è§£å†³åŠæ³•å°† podspec æ–‡ä»¶ä¸‹çš„æ‰€æœ‰ https://... å‡æ”¹ä¸º git@github... æäº¤åˆ°ç§æœ‰ä»“åº“æ‰§è¡Œ pod repo æŸ¥çœ‹æœ¬åœ° MySpecs Repo æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 123// pod repo push [æœ¬åœ°Spec Repoåç§°][podspecæ–‡ä»¶è·¯å¾„]// ä¸¾ä¾‹$ pod repo push MySpecs ZJCore.podspec --verbose --allow-warnings æäº¤æˆåŠŸåï¼Œå¯åœ¨æœ¬åœ°ä»“åº“ä¸­çœ‹åˆ°æäº¤è·¯å¾„ MySpecs -&gt; ZJCore æ¨¡å—åŒ– åœ¨ Classes -&gt; åˆ›å»ºæ¨¡å— UIViewã€UILabelç­‰ï¼Œå¹¶åœ¨å„æ¨¡å—å†…å­˜æ”¾ä½ æƒ³æ‹·è´çš„ä»£ç æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ ä¸Šä¼ æ”¹åŠ¨åˆ°è¿œç¨‹ä»“åº“ 1234567$ git add .$ git commit -m &quot;xxx&quot;$ git push origin master// tag å€¼å¢åŠ $ git tag 0.x.x//æ¨é€tagåˆ°æœåŠ¡å™¨ä¸Š$ git push --tags ä¿®æ”¹.podspec ä½¿ç”¨ æ–°å»ºä¸€ä¸ª ZJDemo å·¥ç¨‹ï¼Œåœ¨é¡¹ç›®çš„ podfile é‡Œé¢æ·»åŠ  12345678910111213141516# Uncomment the next line to define a global platform for your projectplatform :ios, &#x27;9.0&#x27;# ç§æœ‰åº“ZJCoresource &#x27;git@github.com:13718004742/MySpecs.git&#x27;target &#x27;ZJDemo&#x27; do # Comment the next line if you don&#x27;t want to use dynamic frameworks use_frameworks! # ç§æœ‰åº“ZJCore pod &#x27;ZJCore&#x27; # Pods for ZJDemoend æ‰§è¡Œ pod install å³å¯","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†38ï¼šç•Œé¢ä¼˜åŒ–æ–¹æ¡ˆ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†38ï¼šç•Œé¢ä¼˜åŒ–æ–¹æ¡ˆ","date":"2021-06-09T06:49:41.000Z","updated":"2023-02-25T05:56:27.107Z","comments":true,"path":"2021/06/09/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†38ï¼šç•Œé¢ä¼˜åŒ–æ–¹æ¡ˆ/","link":"","permalink":"https://www.bboyzj.cn/2021/06/09/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8638%EF%BC%9A%E7%95%8C%E9%9D%A2%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦è®²ï¼š å¡é¡¿åŸç†ï¼šå¡é¡¿çš„åŸå›  - æ‰å¸§ å¡é¡¿æ£€æµ‹å·¥å…· å®æˆ˜é¡¹ç›®ä¼˜åŒ– ç•Œé¢å¡é¡¿é€šå¸¸æ¥è¯´ï¼Œè®¡ç®—æœºä¸­çš„æ˜¾ç¤ºè¿‡ç¨‹æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œé€šè¿‡ CPUã€GPUã€æ˜¾ç¤ºå™¨ ååŒå·¥ä½œæ¥å°†å›¾ç‰‡æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„ CPU è®¡ç®—å¥½æ˜¾ç¤ºçš„ å†…å®¹ï¼Œæäº¤åˆ° GPU GPU ç»è¿‡ æ¸²æŸ“ å®Œæˆåï¼Œå°†æ¸²æŸ“çš„ç»“æœæ”¾å…¥ FrameBuffer(å¸§ç¼“å­˜åŒº) éšå è§†é¢‘æ§åˆ¶å™¨ ä¼šæŒ‰ç…§ VSync(å‚ç›´åŒæ­¥) ä¿¡å·é€è¡Œè¯»å– FrameBuffer çš„æ•°æ® ç»è¿‡å¯èƒ½çš„ æ•°æ¨¡è½¬æ¢ ä¼ é€’ç»™ æ˜¾ç¤ºå™¨ è¿›è¡Œæ˜¾ç¤º æœ€å¼€å§‹æ—¶ï¼ŒFrameBufferåªæœ‰ä¸€ä¸ªï¼Œè¿™ç§æƒ…å†µä¸‹ FrameBuffer çš„è¯»å–å’Œåˆ·æ–°æœ‰å¾ˆå¤§çš„ æ•ˆç‡ é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº† åŒç¼“å­˜åŒºï¼Œå³ åŒç¼“å†²æœºåˆ¶ï¼Œå³ å‰FrameBuffer å’Œ åFrameBufferï¼ŒGPUæ¸²æŸ“ç»“æœæ¥å›åˆ‡æ¢æ”¾å…¥ å‰ã€åFrameBuffer ä¸­ã€‚è§†é¢‘æ§åˆ¶å™¨æ¥å›åˆ‡æ¢è¯»å– å‰åFrameBufferï¼Œäº¤ç»™ æ˜¾ç¤ºå™¨æ˜¾ç¤º åŒç¼“å­˜æœºåˆ¶ è™½ç„¶è§£å†³äº† æ•ˆç‡é—®é¢˜ï¼Œä½†æ˜¯éšä¹‹è€Œè¨€çš„æ˜¯æ–°çš„é—®é¢˜ï¼Œå½“è§†é¢‘æ§åˆ¶å™¨è¿˜æœª è¯»å–çš„é¢‘ç‡ å’Œ æ¸²æŸ“çš„é¢‘ç‡ ä¸ä¸€è‡´æ—¶ï¼Œå°±ä¼šäº§ç”Ÿ æ‰å¸§ï¼Œä¾‹å¦‚å±å¹•å†…å®¹æ˜¾ç¤ºä¸€åŠï¼ŒGPUå°†æ–°çš„ä¸€å¸§å†…å®¹æäº¤åˆ° FrameBufferï¼Œå¹¶å°†ä¸¤ä¸ªFrameBufferè€Œè¿›è¡Œäº¤æ¢åï¼Œè§†é¢‘æ§åˆ¶å™¨å°±å°†æ–°çš„ä¸€å¸§æ•°æ®çš„ä¸‹åŠæ®µæ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œé€ æˆ å±å¹•æ’•è£‚ ç°è±¡ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‡‡ç”¨äº† å‚ç›´åŒæ­¥ä¿¡å·æœºåˆ¶ï¼Œå³å›ºå®šå±å¹•åˆ·æ–°ç‡ æ¯ç§’åˆ·æ–°60æ¬¡ï¼Œå½“å¼€å¯å‚ç›´åŒæ­¥åï¼ŒGPUä¼šç­‰å¾…æ˜¾ç¤ºå™¨çš„VSyncä¿¡å·å‘å‡ºåï¼Œæ‰è¿›è¡Œæ–°çš„ä¸€å¸§æ¸²æŸ“å’ŒFrameBufferæ›´æ–°ï¼Œè€Œç›®å‰iOSè®¾å¤‡ä¸­é‡‡ç”¨çš„æ­£æ˜¯ åŒç¼“å­˜åŒº+VSync å±å¹•å¡é¡¿åŸå›  ä¸‹é¢æˆ‘ä»¬æ¥è¯´è¯´ï¼Œå±å¹•å¡é¡¿çš„åŸå›  åœ¨ VSync ä¿¡å·åˆ°æ¥åï¼Œç³»ç»Ÿå›¾å½¢æœåŠ¡ ä¼šé€šè¿‡ CADisplayLink ç­‰æœºåˆ¶é€šçŸ¥ Appï¼ŒApp ä¸»çº¿ç¨‹å¼€å§‹åœ¨ CPU ä¸­è®¡ç®—æ˜¾ç¤ºå†…å®¹ï¼ŒéšåCPUä¼šå°†è®¡ç®—å¥½çš„å†…å®¹æäº¤åˆ°GPUå»ã€‚ç”±GPUè¿›è¡Œå˜æ¢ã€åˆæˆã€æ¸²æŸ“ã€‚éšå GPU ä¼šæŠŠæ¸²æŸ“ç»“æœæäº¤åˆ° å¸§ç¼“å†²åŒº å»ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ VSync ä¿¡å·åˆ°æ¥æ—¶æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚ç”±äºå‚ç›´åŒæ­¥ä¿¡å·çš„æœºåˆ¶ï¼Œå¦‚æœåœ¨ä¸€ä¸ªVSyncæ—¶é—´å†…ï¼ŒCPUåè€…GPUæ²¡æœ‰å®Œæˆå†…å®¹æäº¤ï¼Œåˆ™é‚£ä¸€å¸§å°±ä¼šè¢«ä¸¢å¼ƒï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æœºä¼šå†æ˜¾ç¤ºï¼Œè€Œè¿™æ—¶æ˜¾ç¤ºå±ä¼šä¿ç•™ä¹‹å‰çš„å†…å®¹ä¸æ”¹å˜ã€‚æ‰€ä»¥å¯ä»¥ç®€å•ç†è§£ æ‰å¸§ ä¸º è¿‡æ—¶ä¸å€™ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ä¸€ä¸ªæ˜¾ç¤ºè¿‡ç¨‹ï¼Œç¬¬1ä¸ªåœ¨VSyncåˆ°æ¥æœŸé—´ï¼ŒGPUæ¸²æŸ“æå‰å®Œæˆï¼Œæ­£å¸¸æ˜¾ç¤ºï¼›ç¬¬2ä¸ªåœ¨VSyncæœŸé—´ï¼Œä»åœ¨å¤„ç†ä¸­ï¼Œæ­¤æ—¶å±å¹•ä¸åˆ·æ–°ï¼Œä¾æ—§æ˜¾ç¤ºç¬¬1å¸§ï¼›ç¬¬3ä¸ªVSyncæœŸé—´ï¼Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªFrameBufferï¼Œè®©CPUæ¸²æŸ“ï¼›æ­¤æ—¶å°±å‡ºç°äº† æ‰å¸§2 æƒ…å†µï¼Œæ¸²æŸ“æ—¶å°±ä¼šå‡ºç°æ˜æ˜¾çš„ å¡é¡¿ç°è±¡ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒCPUå’ŒGPUä¸è®ºæ˜¯å“ªä¸ªé˜»ç¢äº†æ˜¾ç¤ºæµç¨‹ï¼Œéƒ½ä¼šé€ æˆ æ‰å¸§ ç°è±¡ï¼Œæ‰€ä»¥ä¸ºäº†ç»™ç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒï¼Œåœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ å¡é¡¿æ£€æµ‹ ä»¥åŠç›¸åº”çš„ ä¼˜åŒ– å¡é¡¿ç›‘æ§å¡é¡¿ç›‘æ§çš„æ–¹æ¡ˆä¸€èˆ¬æœ‰ä¸‰ç§ï¼š YYFPSLabelï¼šé€šè¿‡ CADisplayLink + YYWeakProxy FPSç›‘æ§ï¼šä¸ºäº†ä¿æŒæµç¨‹çš„UIäº¤äº’ï¼ŒAppçš„åˆ·æ–°é¢‘ç‡åº”è¯¥ä¿æŒåœ¨ 60fps å·¦å³ï¼Œå…¶åŸå› æ˜¯å› ä¸º iOS è®¾å¤‡é»˜è®¤çš„åˆ·æ–°é¢‘ç‡æ˜¯ 60æ¬¡/ç§’ï¼Œè€Œ1æ¬¡åˆ·æ–°ï¼ˆå³VSyncä¿¡å·å‘å‡ºï¼‰çš„é—´éš”æ˜¯ 1000ms/60æ¬¡= 16.67ms/1æ¬¡ ï¼Œæ‰€ä»¥å¦‚æœåœ¨ 16.67ms å†…æ²¡æœ‰å‡†å¤‡å¥½ä¸‹ä¸€å¸§æ•°æ®ï¼Œå°±ä¼šäº§ç”Ÿå¡é¡¿ ä¸»çº¿ç¨‹å¡é¡¿ç›‘æ§ï¼šé€šè¿‡ å­çº¿ç¨‹ç›‘æµ‹ä¸»çº¿ç¨‹Runloopï¼Œåˆ¤æ–­ä¸¤ä¸ªçŠ¶æ€ï¼ˆkCFRunLoopBeforeSource å’Œ kCFRunLoopAfrerWaitingï¼‰ä¹‹é—´çš„è€—æ—¶æ˜¯å¦è¾¾åˆ°ä¸€å®šé˜€å€¼ FPSç›‘æ§FPSçš„ç›‘æ§ï¼Œä¸»è¦æ˜¯é€šè¿‡ CADislayLink å®ç°ï¼Œå€ŸåŠ© link çš„æ—¶é—´å·®ï¼Œæ¥è®¡ç®—ä¸€æ¬¡åˆ·æ–°æ‰€éœ€è¦çš„æ—¶é—´ï¼Œç„¶åé€šè¿‡ åˆ·æ–°æ¬¡æ•°/æ—¶é—´å·® å¾—åˆ°åˆ·æ–°é¢‘æ¬¡ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦åœ¨å…¶èŒƒå›´ï¼Œé€šè¿‡æ˜¾ç¤ºä¸åŒçš„æ–‡å­—é¢œè‰²æ¥è¡¨ç¤ºå¡é¡¿ä¸¥é‡æˆéƒ½ã€‚ åˆ›å»ºä¸€ä¸ª SPSDisplay å·¥å…·ç±»ï¼Œå®ç°å¦‚ä¸‹ä»£ç  12345#import &lt;UIKit/UIKit.h&gt;@interface FPSDisplay: NSObject+ (instancetype)shareFPSDisplay;@end 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105#import &quot;FPSDisplay.h&quot;#define SCREEN_HEIGHT [UIScreen mainScreen].bounds.size.height#define SCREEN_WIDTH [UIScreen mainScreen].bounds.size.width@interface FPSDisplay ()@property (strong, nonatomic) UILabel *displayLabel;@property (strong, nonatomic) CADisplayLink *link;@property (assign, nonatomic) NSInteger count;@property (assign, nonatomic) NSTimeInterval lastTime;@property (strong, nonatomic) UIFont *font;@property (strong, nonatomic) UIFont *subFont;@end@implementation FPSDisplay+ (instancetype)shareFPSDisplay &#123; static FPSDisplay *shareDisplay; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; shareDisplay = [[FPSDisplay alloc] init]; &#125;); return shareDisplay;&#125;- (instancetype)init &#123; self = [super init]; if (self) &#123; [self initDisplayLabel]; &#125; return self;&#125;- (void)initDisplayLabel &#123; CGRect frame = CGRectMake(SCREEN_WIDTH - 100, 44, 80, 30); self.displayLabel = [[UILabel alloc] initWithFrame: frame]; self.displayLabel.layer.cornerRadius = 5; self.displayLabel.clipsToBounds = YES; self.displayLabel.textAlignment = NSTextAlignmentCenter; self.displayLabel.userInteractionEnabled = NO; self.displayLabel.backgroundColor = [UIColor colorWithWhite:0.000 alpha:0.700]; _font = [UIFont fontWithName:@&quot;Menlo&quot; size:14]; if (_font) &#123; _subFont = [UIFont fontWithName:@&quot;Menlo&quot; size:4]; &#125; else &#123; _font = [UIFont fontWithName:@&quot;Courier&quot; size:14]; _subFont = [UIFont fontWithName:@&quot;Courier&quot; size:4]; &#125; [self initCADisplayLink]; [[self keyWindow] addSubview:self.displayLabel];&#125;-(UIWindow*)keyWindow&#123; UIWindow *foundWindow = nil; NSArray *windows = [[UIApplication sharedApplication]windows]; for (UIWindow *window in windows) &#123; if (window.isKeyWindow) &#123; foundWindow = window; break; &#125; &#125; return foundWindow;&#125;- (void)initCADisplayLink &#123; self.link = [CADisplayLink displayLinkWithTarget:self selector:@selector(tick:)]; [self.link addToRunLoop:[NSRunLoop mainRunLoop] forMode:NSRunLoopCommonModes];&#125;- (void)tick:(CADisplayLink *)link &#123; if (self.lastTime == 0) &#123; //å¯¹LastTimeè¿›è¡Œåˆå§‹åŒ– self.lastTime = link.timestamp; return; &#125; self.count += 1; //è®°å½•tickåœ¨1ç§’å†…æ‰§è¡Œçš„æ¬¡æ•° NSTimeInterval delta = link.timestamp - self.lastTime; //è®¡ç®—æœ¬æ¬¡åˆ·æ–°å’Œä¸Šæ¬¡æ›´æ–°FPSçš„æ—¶é—´é—´éš” //å¤§äºç­‰äº1ç§’æ—¶ï¼Œæ¥è®¡ç®—FPS if (delta &gt;= 1) &#123; self.lastTime = link.timestamp; float fps = self.count / delta; // æ¬¡æ•° é™¤ä»¥ æ—¶é—´ = FPS ï¼ˆæ¬¡/ç§’ï¼‰ self.count = 0; [self updateDisplayLabelText: fps]; &#125;&#125;- (void)updateDisplayLabelText: (float) fps &#123; CGFloat progress = fps / 60.0; UIColor *color = [UIColor colorWithHue:0.27 * (progress - 0.2) saturation:1 brightness:0.9 alpha:1]; self.displayLabel.text = [NSString stringWithFormat:@&quot;%d FPS&quot;,(int)round(fps)]; self.displayLabel.textColor = color;&#125;- (void)dealloc &#123; [_link invalidate];&#125;@end ä½¿ç”¨ 1[FPSDisplay shareFPSDisplay]; ä¸»çº¿ç¨‹å¡é¡¿ç›‘æ§é™¤äº†FPSï¼Œè¿˜å¯ä»¥é€šè¿‡ RunLoop æ¥ç›‘æ§ï¼Œå› ä¸ºå¡é¡¿çš„æ˜¯äº‹åŠ¡ï¼Œè€Œäº‹åŠ¡æ˜¯äº¤ç”± ä¸»çº¿ç¨‹ çš„ RunLoop å¤„ç†çš„ã€‚ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‰æ–¹åº“ OC å¯ä»¥ä½¿ç”¨ å¾®ä¿¡matrix ã€æ»´æ»´DoramonKit Swift çš„å¡é¡¿æ£€æµ‹ç¬¬ä¸‰æ–¹ ANREye ï¼Œå…¶ä¸»è¦æ€è·¯æ˜¯ï¼šåˆ›å»ºå­çº¿ç¨‹è¿›è¡Œå¾ªç¯ç›‘æµ‹ï¼Œæ¯æ¬¡æ£€æµ‹æ—¶è®¾ç½®æ ‡è®°ç½®ä¸ºtrueï¼Œç„¶åæ´¾å‘ä»»åŠ¡åˆ°ä¸»çº¿ç¨‹ï¼Œæ ‡è®°ç½®ä¸ºfalseï¼Œæ¥ç€å­çº¿ç¨‹ç¡çœ è¶…è¿‡é˜€å€¼æ—¶ï¼Œåˆ¤æ–­æ ‡è®°æ˜¯å¦ä¸ºfalseï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯´æ˜ä¸»çº¿ç¨‹å‘ç”Ÿäº†å¡é¡¿ ç•Œé¢ä¼˜åŒ–CPUå±‚é¢çš„ä¼˜åŒ– å°½é‡ ç”¨è½»é‡çº§çš„å¯¹è±¡ ä»£æ›¿é‡é‡çº§çš„å¯¹è±¡ï¼Œå¯ä»¥å¯¹æ€§èƒ½æœ‰æ‰€ä¼˜åŒ–ï¼Œä¾‹å¦‚: ä¸éœ€è¦ç›¸åº” è§¦æ‘¸ æ—¶é—´çš„æ§ä»¶ï¼Œç”¨ CALayer ä»£æ›¿ UIView å°½é‡å‡å°‘ å¯¹ UIView å’Œ CALayer çš„å±æ€§ä¿®æ”¹ CALayerå†…éƒ¨å¹¶æ²¡æœ‰å±æ€§ï¼Œå½“è°ƒç”¨å±æ€§æ–¹æ³•æ—¶ï¼Œå…¶å†…éƒ¨æ˜¯é€šè¿‡è¿è¡Œæ—¶ resolveInstanceMethod ä¸ºå¯¹è±¡ä¸´æ—¶æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶å°†å¯¹åº”å±æ€§å€¼ä¿å­˜åœ¨å†…éƒ¨çš„ä¸€ä¸ª Dictionaryä¸­ï¼ŒåŒæ—¶è¿˜ä¼šé€šçŸ¥delegateã€åˆ›å»ºåŠ¨ç”»ç­‰ï¼Œéå¸¸haoshi UIView ç›¸å…³çš„æ˜¾ç¤ºå±æ€§ï¼Œä¾‹å¦‚frameã€boundsã€transformç­‰ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä»CALayeræ˜ å°„æ¥çš„ï¼Œå¯¹é½è¿›è¡Œè°ƒæ•´æ—¶ï¼Œæ¶ˆè€—çš„èµ„æºæ¯”ä¸€èˆ¬å±æ€§è¦å¤§ å½“æœ‰å¤§é‡å¯¹è±¡é‡Šæ”¾æ—¶ï¼Œä¹Ÿæ˜¯éå¸¸è€—æ—¶çš„ï¼Œå°½é‡æŒªåˆ°åå°çº¿ç¨‹å»é‡Šæ”¾ å°½é‡ æå‰è®¡ç®—è§†å›¾å¸ƒå±€ï¼Œå³ é¢„æ’ç‰ˆï¼Œä¾‹å¦‚cellçš„è¡Œé«˜ Autolayout åœ¨ç®€å•é¡µé¢æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„æå‡å¼€å‘æ•ˆç‡ï¼Œä½†æ˜¯å¯¹äºå¤æ‚è§†å›¾è€Œè¨€ï¼Œä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œéšç€è§†å›¾æ•°é‡çš„å¢é•¿ï¼ŒAutolayout å¸¦æ¥çš„CPUæ¶ˆè€—æ˜¯ç¨‹æŒ‡æ•°ä¸Šå‡çš„ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨ ä»£ç å¸ƒå±€ï¼Œå¦‚æœä¸æƒ³æ‰‹åŠ¨è°ƒæ•´frameç­‰ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚Masonryï¼ˆOCï¼‰ã€SnapKit(swift)ç­‰ç­‰ æ–‡æœ¬å¤„ç†çš„ä¼˜åŒ–ï¼šå½“ä¸€ä¸ªç•Œé¢æœ‰å¤§é‡æ–‡æœ¬æ—¶ï¼Œå…¶è¡Œé«˜çš„è®¡ç®—ã€ç»˜åˆ¶ä¹Ÿæ˜¯éå¸¸è€—æ—¶çš„ å¦‚æœå¯¹æ–‡æœ¬æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨UILabelå†…éƒ¨çš„å®ç°æ–¹å¼ï¼Œä¸”éœ€è¦æ”¾åˆ°å­çº¿ç¨‹ä¸­è¿›è¡Œï¼Œé¿å…åˆ™å¡ä¸»çº¿ç¨‹ è®¡ç®—æ–‡æœ¬å®½é«˜ï¼š[NSAttributedString boundingRectWithSize:options:context:] æ–‡æœ¬ç»˜åˆ¶ï¼š [NSAttributedString drawWithRect:options:context:] è‡ªå®šä¹‰æ–‡æœ¬æ§ä»¶ï¼Œåˆ©ç”¨ TextKit æˆ–æœ€åº•å±‚çš„ CoreText å¯¹æ–‡æœ¬ å¼‚æ­¥ç»˜åˆ¶ã€‚å¹¶ä¸” CoreText å¯¹è±¡åˆ›å»ºå¥½åï¼Œèƒ½ç›´æ¥è·å–æ–‡æœ¬çš„å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡è®¡ç®—ï¼ˆè°ƒæ•´å’Œç»˜åˆ¶éƒ½éœ€è¦è®¡ç®—ä¸€æ¬¡ï¼‰ï¼ŒCoreTextç›´æ¥ä½¿ç”¨äº† CoreGraphics å ç”¨å†…å­˜å°ï¼Œæ•ˆç‡é«˜ å›¾ç‰‡å¤„ç†ï¼ˆè§£ç +ç»˜åˆ¶ï¼‰ å½“ä½¿ç”¨ UIImage æˆ– CGImageSource çš„æ–¹æ³•åˆ›å»ºå›¾ç‰‡æ—¶ï¼Œå›¾ç‰‡çš„æ•°æ®ä¸ä¼šç«‹å³è§£ç ï¼Œè€Œæ˜¯åœ¨è®¾ç½®æ—¶è§£ç ï¼ˆå³å›¾ç‰‡è®¾ç½®åˆ° UIImageView/CALayer.contents ä¸­ï¼Œç„¶ååœ¨ CALayer æäº¤è‡³GPUæ¸²æŸ“å‰ï¼ŒCGImage ä¸­çš„æ•°æ®æ‰è¿›è¡Œè§£ç ï¼‰ã€‚è¿™ä¸€æ­¥æ˜¯ æ— å¯é¿å… çš„ï¼Œä¸”æ˜¯å‘ç”Ÿåœ¨ ä¸»çº¿ç¨‹ ä¸­çš„ã€‚æƒ³è¦ç»•å¼€è¿™ä¸ªæœºåˆ¶ï¼Œå¸¸è§çš„åšæ³•æ˜¯åœ¨å­çº¿ç¨‹ä¸­ä¼˜å…ˆå°†å›¾ç‰‡ç»˜åˆ¶åˆ° CGBitmapContextï¼Œç„¶åä» Bitmap ç›´æ¥åˆ›å»ºå›¾ç‰‡ï¼Œä¾‹å¦‚ SDWebImage ä¸‰æ–¹æ¡†æ¶å¯¹å›¾ç‰‡çš„ç¼–è§£ç å¤„ç†ï¼Œè¿™å°±æ˜¯ Image çš„ é¢„è§£ç  å½“ä½¿ç”¨ CG å¼€å¤´çš„æ–¹æ³• ç»˜åˆ¶å›¾åƒ åˆ°ç”»å¸ƒä¸­ï¼Œç„¶åä»ç”»å¸ƒä¸­åˆ›å»ºå›¾ç‰‡æ—¶ï¼Œå¯ä»¥å°†å›¾åƒçš„ ç»˜åˆ¶ åœ¨ å­çº¿ç¨‹ ä¸­è¿›è¡Œ å›¾ç‰‡ä¼˜åŒ– å°½é‡ä½¿ç”¨ PNG æ ¼å¼å›¾ç‰‡ï¼Œä¸é€‚ç”¨ JPEG å›¾ç‰‡ é€šè¿‡ å­çº¿ç¨‹é¢„è§£ç ï¼Œä¸»çº¿ç¨‹æ¸²æŸ“ï¼Œå³é€šè¿‡ Bitmap åˆ›å»ºå›¾ç‰‡ï¼Œåœ¨å­çº¿ç¨‹èµ‹å€¼ image ä¼˜åŒ–å›¾ç‰‡å¤§å°ï¼Œå°½é‡é¿å…åŠ¨æ€ç¼©æ”¾ å°½é‡å°†å¤šå¼ å›¾åˆå¹¶ä¸ºä¸€å¼ è¿›è¡Œæ˜¾ç¤º å°½é‡ é¿å…ä½¿ç”¨é€æ˜çš„viewï¼Œå› ä¸ºä½¿ç”¨é€æ˜çš„viewï¼Œä¼šå¯¼è‡´åœ¨GPUä¸­è®¡ç®—åƒç´ æ—¶ï¼Œä¼šå°†é€æ˜viewä¸‹å±‚å›¾å±‚çš„åƒç´ ä¹Ÿè®¡ç®—è¿›æ¥ï¼Œå³ é¢œè‰²æ··åˆ å¤„ç† æŒ‰éœ€åŠ è½½ ï¼Œä¾‹å¦‚åœ¨TableViewä¸­æ»‘åŠ¨æ—¶ä¸åŠ è½½å›¾ç‰‡ï¼Œä½¿ç”¨é»˜è®¤å ä½å›¾ï¼Œè€Œæ˜¯åœ¨æ»‘åŠ¨åœæ­¢æ—¶åŠ è½½ å°‘ä½¿ç”¨ addView ç»™ cell åŠ¨æ€æ·»åŠ  view GPUå±‚é¢çš„ä¼˜åŒ–ç›¸å¯¹äºCPUè€Œè¨€ï¼ŒGPUä¸»è¦æ˜¯æ¥æ”¶CPUæäº¤çš„ çº¹ç†+é¡¶ç‚¹ï¼Œç»è¿‡ä¸€ç³»åˆ— transformï¼Œæœ€ç»ˆ æ··åˆå¹¶æ¸²æŸ“ï¼Œè¾“å‡ºåˆ° å±å¹•ä¸Š å°½é‡ å‡å°‘åœ¨çŸ­æ—¶é—´å†…å¤§é‡å›¾ç‰‡çš„æ˜¾ç¤ºï¼Œå°½å¯èƒ½å°† å¤šå¼ å›¾ç‰‡åˆä¸ºä¸€å¼ æ˜¾ç¤ºï¼Œä¸»è¦æ˜¯å› ä¸ºå½“æœ‰å¤§é‡å›¾ç‰‡è¿›è¡Œæ˜¾ç¤ºæ—¶ï¼Œæ— è®ºæ˜¯CPUè®¡ç®—è¿˜æ˜¯GPUçš„æ¸²æŸ“ï¼Œéƒ½æ˜¯éå¸¸è€—æ—¶çš„ï¼Œå¾ˆå¯èƒ½å‡ºç°æ‰å¸§çš„æƒ…å†µ å°½é‡ é¿å…å›¾ç‰‡çš„å°ºå¯¸è¶…è¿‡4096x4096ï¼Œå› ä¸ºå½“å›¾ç‰‡è¶…è¿‡è¿™ä¸ªå°ºå¯¸æ—¶ï¼Œä¼šå…ˆç”±CPUè¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åå†æäº¤ç»™GPUå¤„ç†ï¼Œå¯¼è‡´é¢å¤–CPUèµ„æºæ¶ˆè€— å°½é‡ å‡å°‘è§†å›¾æ•°é‡å’Œå±‚æ¬¡ï¼Œä¸»è¦æ˜¯å› ä¸ºè§†å›¾è¿‡å¤šä¸”é‡å æ—¶ï¼ŒGPUä¼šå°†å…¶æ··åˆï¼Œæ··åˆçš„è¿‡ç¨‹ä¹Ÿæ˜¯éå¸¸è€—æ—¶çš„ å°½é‡é¿å…ç¦»å±æ¸²æŸ“ å¼‚æ­¥æ¸²æŸ“ï¼Œä¾‹å¦‚å¯ä»¥å°†cellä¸­çš„æ‰€æœ‰æ§ä»¶ã€è§†å›¾åˆå¹¶æˆä¸€å¼ å›¾ç‰‡è¿›è¡Œæ˜¾ç¤ºã€‚å¯ä»¥å‚è€ƒ Graver ä¸‰æ–¹æ¡†æ¶ æ³¨ï¼šä¸Šè¿°è¿™äº›ä¼˜åŒ–æ–¹å¼çš„è½åœ°å®ç°ï¼Œéœ€è¦æ ¹æ®è‡ªèº«é¡¹ç›®è¿›è¡Œè¯„ä¼°ï¼Œåˆç†çš„ä½¿ç”¨è¿›è¡Œä¼˜åŒ–","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†37ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸‰ï¼‰AutoReleasePool & NSRunLoop åº•å±‚åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†37ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸‰ï¼‰AutoReleasePool-NSRunLoop-åº•å±‚åˆ†æ","date":"2021-06-02T06:48:31.000Z","updated":"2022-04-21T05:20:23.000Z","comments":true,"path":"2021/06/02/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†37ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸‰ï¼‰AutoReleasePool-NSRunLoop-åº•å±‚åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2021/06/02/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8637%EF%BC%9A%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%89%EF%BC%89AutoReleasePool-NSRunLoop-%E5%BA%95%E5%B1%82%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦åˆ†æ AutoReleasePool ä»¥åŠ NSRunLoop çš„åº•å±‚å®ç° AutoReleasePool è‡ªåŠ¨é‡Šæ”¾æ± è‡ªåŠ¨é‡Šæ”¾æ±  æ˜¯OCä¸­çš„ä¸€ç§ å†…å­˜è‡ªåŠ¨å›æ”¶æœºåˆ¶ï¼Œå®ƒå¯ä»¥å°†åŠ å…¥ AutoReleasePool ä¸­çš„ å˜é‡releaseçš„æ—¶æœºå»¶è¿Ÿï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“åˆ›å»ºä¸€ä¸ª å¯¹è±¡ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå˜é‡ä¼šåœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸçš„æ—¶ï¼Œç«‹å³releaseã€‚å¦‚æœå¯¹è±¡åŠ å…¥åˆ°äº†è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡å¹¶ ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œä¼š ç­‰åˆ°runloopä¼‘çœ /è¶…å‡ºautoreleasepool&#123;&#125;ä½œç”¨åŸŸ ä¹‹åæ‰èƒ½ è¢«é‡Šæ”¾ã€‚å…¶æœºåˆ¶å¦‚ä¸‹å›¾æ‰€ç¤º ä»ç¨‹åºå¯åŠ¨åˆ°åŠ è½½å®Œæˆï¼Œä¸»çº¿ç¨‹å¯¹åº”çš„ runloop ä¼šå¤„äº ä¼‘çœ  çŠ¶æ€ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’æ¥å”¤é†’runloop ç”¨æˆ·çš„æ¯ä¸€æ¬¡ äº¤äº’ éƒ½ä¼šå¯åŠ¨ä¸€æ¬¡ runloopï¼Œç”¨äºå¤„ç†ç”¨æˆ·çš„ æ‰€æœ‰ç‚¹å‡»ã€è§¦æ‘¸äº‹ä»¶ç­‰ runloop åœ¨ ç›‘å¬åˆ°äº¤äº’äº‹ä»¶ åï¼Œå°±ä¼š åˆ›å»º è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¹¶å°†æ‰€æœ‰ å»¶è¿Ÿé‡Šæ”¾ çš„å¯¹è±¡æ·»åŠ åˆ°è‡ªåŠ¨é‡Šæ”¾æ±  åœ¨ä¸€æ¬¡å®Œæ•´çš„runloopç»“æŸä¹‹å‰ï¼Œä¼šå‘è‡ªåŠ¨é‡Šæ”¾æ± ä¸­æ‰€æœ‰å¯¹è±¡ å‘é€releaseæ¶ˆæ¯ï¼Œç„¶å é”€æ¯ è‡ªåŠ¨é‡Šæ”¾æ±  clangåˆ†ææ ¹æ®ä¹‹å‰æºç åˆ†æç»éªŒï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ clang æ¥åˆ†æ å®šä¹‰å¦‚ä¸‹ä»£ç  1234int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; &#125;&#125; é€šè¿‡clangç¼–è¯‘æˆåº•å±‚å®ç°ï¼Œå‘½ä»¤ä¸ºï¼šxcrun -sdk iphonesimulator clang -arch x86_64 - rewrite-objc main.m 123456789101112131415161718192021//*********__AtAutoreleasePool**********struct __AtAutoreleasePool &#123; //æ„é€ å‡½æ•° __AtAutoreleasePool() &#123; atautoreleasepoolobj = objc_autoreleasePoolPush(); &#125; //ææ„å‡½æ•° ~__AtAutoreleasePool() &#123; objc_autoreleasePoolPop(atautoreleasepoolobj); &#125; void * atautoreleasepoolobj;&#125;;//*********main*********int main(int argc, const char * argv[]) &#123; &#123; // æ˜¯ä¸€ä¸ªç»“æ„ä½“ __AtAutoreleasePool __autoreleasepool; &#125; return 0;&#125; ç®€å•æ¥è¯´ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± å…¶æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ª å¯¹è±¡ 123@autoreleasepool &#123;&#125;//ç­‰ä»·äº&#123;__AtAutoreleasePool __autoreleasepool; &#125; __AtAutoreleasePool æ˜¯ä¸€ä¸ª ç»“æ„ä½“ï¼Œç”± æ„é€ å‡½æ•° + ææ„å‡½æ•°ï¼Œç»“æ„ä½“å®šä¹‰çš„å¯¹è±¡åœ¨ä½œç”¨åŸŸç»“æŸåï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•° å…¶ä¸­ &#123;&#125; æ˜¯ä½œç”¨åŸŸï¼Œä¼˜ç‚¹æ˜¯ ç»“æ„æ¸…æ™°ï¼Œå¯è¯»æ€§å¼ºï¼Œå¯ä»¥ åŠæ—¶åˆ›å»ºé”€æ¯ å…³äºæ¶‰åŠçš„æ„é€ å’Œææ„å‡½æ•°çš„è°ƒç”¨æ—¶æœºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ä¸€ä¸ªæ¡ˆä¾‹æ¥éªŒè¯ 12345678910111213141516171819struct ZJTest&#123; ZJTest()&#123; printf(&quot;123 - %s\\n&quot;, __func__); &#125; ~ZJTest()&#123; printf(&quot;456 - %s\\n&quot;, __func__); &#125;&#125;;int main(int argc, const char * argv[]) &#123; &#123; ZJTest test; &#125;&#125;//**********è¿è¡Œç»“æœ**********123 - ZJTest456 - ~ZJTest ä»è€Œå¯ä»¥å¾—å‡ºï¼Œåœ¨ ZJTest åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ æ„é€ å‡½æ•°ï¼Œåœ¨å‡ºäº†{}ä½œç”¨åŸŸåï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•° æ±‡ç¼–åˆ†æ åœ¨mainä»£ç éƒ¨åˆ†åŠ æ–­ç‚¹ï¼Œè¿è¡Œç¨‹åºï¼Œå¹¶å¼€å¯æ±‡ç¼–è°ƒè¯• é€šè¿‡è°ƒè¯•ç»“æœå‘ç°ï¼Œè¯æ˜äº†æˆ‘ä»¬clangåˆ†æçš„ç»“æœ æ€»ç»“ autoreleasepool å…¶æœ¬è´¨æ˜¯ä¸€ä¸ª ç»“æ„ä½“å¯¹è±¡ï¼Œä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± å¯¹è±¡å°±æ˜¯é¡µï¼Œæ˜¯ æ ˆç»“æ„å­˜å‚¨ï¼Œç¬¦åˆ å…ˆè¿›åå‡º çš„åŸåˆ™ é¡µçš„æ ˆåº•æ˜¯ä¸€ä¸ª 56 å­—èŠ‚å¤§å°çš„ ç©ºå ä½ç¬¦ï¼Œä¸€é¡µæ€»å¤§å°ä¸º 4096 å­—èŠ‚ åªæœ‰ ç¬¬ä¸€é¡µ æœ‰ å“¨å…µ å¯¹è±¡ï¼Œæœ€å¤šå­˜å‚¨ 504 ä¸ªå¯¹è±¡ï¼Œä»ç¬¬äºŒé¡µå¼€å§‹æœ€å¤šå­˜å‚¨ 505 ä¸ªå¯¹è±¡ autoreleasepool åœ¨åŠ å…¥è¦é‡Šæ”¾çš„å¯¹è±¡æ—¶ï¼Œåº•å±‚è°ƒç”¨çš„æ˜¯ objc_autoreleasePoolPush æ–¹æ³• autoreleasepool åœ¨è°ƒç”¨ææ„å‡½æ•°é‡Šæ”¾æ—¶ï¼Œå†…éƒ¨çš„å®ç°æ—¶è°ƒç”¨ objc_autoreleasePoolPop æ–¹æ³• åº•å±‚åˆ†æåœ¨ objc æºç ä¸­ï¼Œå¯¹ AutoreleasePool çš„è§£é‡Šå¦‚ä¸‹ï¼š 12345678910111213141516Autorelease pool implementation- A thread&#x27;s autorelease pool is a stack of pointers. çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯æŒ‡é’ˆçš„å †æ ˆ- Each pointer is either an object to release, or POOL_BOUNDARY which is an autorelease pool boundary.æ¯ä¸ªæŒ‡é’ˆéƒ½æ˜¯è¦é‡Šæ”¾çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯POOL_BOUNDARYï¼Œå®ƒæ˜¯è‡ªåŠ¨é‡Šæ”¾æ± çš„è¾¹ç•Œã€‚- A pool token is a pointer to the POOL_BOUNDARY for that pool. When the pool is popped, every object hotter than the sentinel is released.æ± ä»¤ç‰Œæ˜¯æŒ‡å‘è¯¥æ± çš„POOL_BOUNDARYçš„æŒ‡é’ˆã€‚å¼¹å‡ºæ± åï¼Œå°†é‡Šæ”¾æ¯”å“¨ç‚¹æ›´çƒ­çš„æ¯ä¸ªå¯¹è±¡ã€‚- The stack is divided into a doubly-linked list of pages. Pages are added and deleted as necessary. å †æ ˆåˆ†ä¸ºä¸¤ä¸ªåŒå‘é“¾æ¥çš„é¡µé¢åˆ—è¡¨ã€‚æ ¹æ®éœ€è¦æ·»åŠ å’Œåˆ é™¤é¡µé¢ã€‚- Thread-local storage points to the hot page, where newly autoreleased objects are stored. çº¿ç¨‹æœ¬åœ°å­˜å‚¨æŒ‡å‘çƒ­é¡µé¢ï¼Œè¯¥é¡µé¢å­˜å‚¨æ–°è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ã€‚ é€šè¿‡æè¿°ã€‚æœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š è‡ªåŠ¨é‡Šæ”¾æ±  æ˜¯ä¸€ä¸ªå…³äº æŒ‡é’ˆ çš„ å †æ ˆ å…¶ä¸­çš„æŒ‡é’ˆæ˜¯æŒ‡è¦ é‡Šæ”¾çš„å¯¹è±¡ æˆ–è€… pool_boundary å“¨å…µï¼ˆç°åœ¨ç»å¸¸è¢«ç§°ä¸º è¾¹ç•Œï¼‰ è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä¸€ä¸ª é¡µ çš„ç»“æ„ï¼ˆç»†è…»å†…å­˜ä¸­æåŠï¼‰ï¼Œè€Œä¸”è¿™ä¸ª é¡µ æ˜¯ä¸€ä¸ª åŒå‘é“¾æ¥ï¼ˆè¡¨ç¤ºçˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ï¼Œåœ¨ç±»ä¸­æåŠè¿‡ï¼Œå³ç±»çš„ç»§æ‰¿é“¾ï¼‰ è‡ªåŠ¨é‡Šæ”¾æ±  å’Œ çº¿ç¨‹ æœ‰å…³ç³» å¯¹äº è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒçš„ç‚¹æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä»€ä¹ˆæ—¶å€™ åˆ›å»ºï¼Ÿ å¯¹è±¡æ—¶ å¦‚ä½•åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ±  çš„ï¼Ÿ å“ªäº›å¯¹è±¡æ‰ä¼šåŠ å…¥ è‡ªåŠ¨é‡Šæ”¾æ± ï¼Ÿ ä¸‹é¢å¸¦ç€è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¿›ä¸€æ­¥æ¢ç´¢è‡ªåŠ¨é‡Šæ”¾æ± çš„åº•å±‚åŸç† AutoreleasePoolPage ä»æœ€åˆçš„ clang æˆ–è€… æ±‡ç¼– åˆ†ææˆ‘ä»¬äº†è§£äº†è‡ªåŠ¨é‡Šæ”¾æ± å…¶åº•å±‚æ˜¯è°ƒç”¨çš„ objc_autoreleasePoolPush å’Œ objc_autoreleasePoolPop ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶æºç å®ç°å¦‚ä¸‹ï¼š 12345678910111213//***********pushæ–¹æ³•***********void *objc_autoreleasePoolPush(void)&#123; return AutoreleasePoolPage::push();&#125;//***********popæ–¹æ³•***********voidobjc_autoreleasePoolPop(void *ctxt)&#123; AutoreleasePoolPage::pop(ctxt);&#125; ä»æºç ä¸­æˆ‘ä»¬å‘ç°ï¼Œéƒ½æ˜¯è°ƒç”¨çš„ AutoreleasePoolPage çš„ push å’Œ popï¼Œä»¥ä¸‹æ˜¯å…¶å®šä¹‰ï¼Œä»å®šä¹‰ä¸­å¯ä»¥çœ‹å‡ºï¼Œè‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä¸€ä¸ª é¡µï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ª å¯¹è±¡ï¼Œè¿™ä¸ª é¡µ çš„å¤§å°æ˜¯ 4096å­—èŠ‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137//************å®å®šä¹‰************#define PAGE_MIN_SIZE PAGE_SIZE#define PAGE_SIZE I386_PGBYTES#define I386_PGBYTES 4096 /* bytes per 80386 page *///************ç±»å®šä¹‰************class AutoreleasePoolPage : private AutoreleasePoolPageData&#123; friend struct thread_data_t;public: //é¡µçš„å¤§å° static size_t const SIZE =#if PROTECT_AUTORELEASEPOOL PAGE_MAX_SIZE; // must be multiple of vm page size#else PAGE_MIN_SIZE; // size and alignment, power of 2#endifprivate: ... //æ„é€ å‡½æ•° AutoreleasePoolPage(AutoreleasePoolPage *newParent) : AutoreleasePoolPageData(begin(),//å¼€å§‹å­˜å‚¨çš„ä½ç½® objc_thread_self(),//ä¼ çš„æ˜¯å½“å‰çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹æ—¶é€šè¿‡tlsè·å–çš„ newParent, newParent ? 1+newParent-&gt;depth : 0,//å¦‚æœæ˜¯ç¬¬ä¸€é¡µæ·±åº¦ä¸º0ï¼Œå¾€åæ˜¯å‰ä¸€ä¸ªçš„æ·±åº¦+1 newParent ? newParent-&gt;hiwat : 0) &#123;...&#125; //ææ„å‡½æ•° ~AutoreleasePoolPage() &#123;...&#125; ... //é¡µçš„å¼€å§‹ä½ç½® id * begin() &#123;...&#125; //é¡µçš„ç»“æŸä½ç½® id * end() &#123;...&#125; //é¡µæ˜¯å¦ä¸ºç©º bool empty() &#123;...&#125; //é¡µæ˜¯å¦æ»¡äº† bool full() &#123;...&#125; //é¡µçš„å­˜å‚¨æ˜¯å¦å°‘äºä¸€åŠ bool lessThanHalfFull() &#123;...&#125; //æ·»åŠ é‡Šæ”¾å¯¹è±¡ id *add(id obj)&#123;...&#125; //é‡Šæ”¾æ‰€æœ‰å¯¹è±¡ void releaseAll() &#123;...&#125; //é‡Šæ”¾åˆ°stopä½ç½®ä¹‹å‰çš„æ‰€æœ‰å¯¹è±¡ void releaseUntil(id *stop) &#123;...&#125; //æ€æ‰ void kill() &#123;...&#125; //é‡Šæ”¾æœ¬åœ°çº¿ç¨‹å­˜å‚¨ç©ºé—´ static void tls_dealloc(void *p) &#123;...&#125; //è·å–AutoreleasePoolPage static AutoreleasePoolPage *pageForPointer(const void *p) &#123;...&#125; static AutoreleasePoolPage *pageForPointer(uintptr_t p) &#123;...&#125; //æ˜¯å¦æœ‰ç©ºæ± å ä½ç¬¦ static inline bool haveEmptyPoolPlaceholder() &#123;...&#125; //è®¾ç½®ç©ºæ± å ä½ç¬¦ static inline id* setEmptyPoolPlaceholder()&#123;...&#125; //è·å–å½“å‰æ“ä½œé¡µ static inline AutoreleasePoolPage *hotPage()&#123;...&#125; //è®¾ç½®å½“å‰æ“ä½œé¡µ static inline void setHotPage(AutoreleasePoolPage *page) &#123;...&#125; //è·å–coldPage static inline AutoreleasePoolPage *coldPage() &#123;...&#125; //å¿«é€Ÿé‡Šæ”¾ static inline id *autoreleaseFast(id obj)&#123;...&#125; //æ·»åŠ è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡ï¼Œå½“é¡µæ»¡çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³• static __attribute__((noinline)) id *autoreleaseFullPage(id obj, AutoreleasePoolPage *page) &#123;...&#125; //æ·»åŠ è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡ï¼Œå½“æ²¡é¡µçš„æ—¶å€™ä½¿ç”¨è¿™ä¸ªæ–¹æ³• static __attribute__((noinline)) id *autoreleaseNoPage(id obj)&#123;...&#125; //åˆ›å»ºæ–°é¡µ static __attribute__((noinline)) id *autoreleaseNewPage(id obj) &#123;...&#125; public: //è‡ªåŠ¨é‡Šæ”¾ static inline id autorelease(id obj)&#123;...&#125; //å…¥æ ˆ static inline void *push() &#123;...&#125; //å…¼å®¹è€çš„ SDK å‡ºæ ˆæ–¹æ³• __attribute__((noinline, cold)) static void badPop(void *token)&#123;...&#125; //å‡ºæ ˆé¡µé¢ template&lt;bool allowDebug&gt; static void popPage(void *token, AutoreleasePoolPage *page, id *stop)&#123;...&#125; __attribute__((noinline, cold)) static void popPageDebug(void *token, AutoreleasePoolPage *page, id *stop)&#123;...&#125; //å‡ºæ ˆ static inline void pop(void *token)&#123;...&#125; static void init()&#123;...&#125; //æ‰“å° __attribute__((noinline, cold)) void print()&#123;...&#125; //æ‰“å°æ‰€æœ‰ __attribute__((noinline, cold)) static void printAll()&#123;...&#125; //æ‰“å°Hiwat __attribute__((noinline, cold)) static void printHiwat()&#123;...&#125; ä»å…¶å®šä¹‰ä¸­å‘ç°ï¼ŒAutoreleasePoolPage æ˜¯é›†æˆè‡ª AutoreleasePoolPageDataï¼Œä¸”è¯¥ç±»çš„å±æ€§ä¹Ÿæ˜¯æ¥è‡ªçˆ¶ç±»ï¼Œä»¥ä¸‹æ˜¯ AutoreleasePoolPage çš„å®šä¹‰ï¼š å‘ç°å…¶ä¸­æœ‰ AutoreleasePoolPage å¯¹è±¡ï¼Œæ‰€ä»¥æœ‰ä»¥ä¸‹å…³ç³»é“¾ AutoreleasePoolPage -&gt; AutoreleasePoolPageData -&gt; AutoreleasePoolPageï¼Œä»è¿™é‡Œå¯ä»¥è¯´æ˜è‡ªåŠ¨é‡Šæ”¾æ± é™¤äº†æ˜¯ä¸€ä¸ª é¡µ ï¼Œè¿˜æ˜¯ä¸€ä¸ª åŒå‘é“¾è¡¨ ç»“æ„ 1234567891011121314151617181920212223242526class AutoreleasePoolPage;struct AutoreleasePoolPageData&#123; // ç”¨æ¥æ ¡éªŒAutoreleasePoolPageçš„ç»“æ„æ˜¯å¦å®Œæ•´ magic_t const magic;//16ä¸ªå­—èŠ‚ // æŒ‡å‘æœ€æ–°æ·»åŠ çš„autoreleasedå¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œåˆå§‹åŒ–æ—¶æŒ‡å‘begin() __unsafe_unretained id *next;//8å­—èŠ‚ // æŒ‡å‘å½“å‰çº¿ç¨‹ pthread_t const thread;//8å­—èŠ‚ // æŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªç»“ç‚¹çš„parentå€¼ä¸ºnil AutoreleasePoolPage * const parent;//8å­—èŠ‚ // æŒ‡å‘å­èŠ‚ç‚¹ï¼Œæœ€åä¸€ä¸ªç»“ç‚¹çš„childå€¼ä¸ºnil AutoreleasePoolPage *child;//8å­—èŠ‚ // è¡¨ç¤ºæ·±åº¦ï¼Œä»0å¼€å§‹ï¼Œå¾€åé€’å¢1 uint32_t const depth;//4å­—èŠ‚ // è¡¨ç¤ºhigh water mark æœ€å¤§å…¥æ ˆæ•°é‡æ ‡è®° uint32_t hiwat;//4å­—èŠ‚ // åˆå§‹åŒ– AutoreleasePoolPageData(__unsafe_unretained id* _next, pthread_t _thread, AutoreleasePoolPage* _parent, uint32_t _depth, uint32_t _hiwat) : magic(), next(_next), thread(_thread), parent(_parent), child(nil), depth(_depth), hiwat(_hiwat) &#123; &#125;&#125;; å…¶ä¸­ AutoreleasePoolPageData ç»“æ„ä½“çš„å†…å­˜å¤§å°ä¸º 56 å­—èŠ‚ï¼š å±æ€§ magic çš„ç±»å‹æ˜¯ magic_t ç»“æ„ä½“ï¼Œæ‰€å å†…å­˜å¤§å°ä¸º m[4]ï¼Œæ‰€å å†…å­˜ï¼ˆå³4*4=16å­—èŠ‚ï¼‰ å±æ€§ nextï¼ˆæŒ‡é’ˆï¼‰ã€threadï¼ˆå¯¹è±¡ï¼‰ã€parentï¼ˆå¯¹è±¡ï¼‰ã€childï¼ˆå¯¹è±¡ï¼‰å‡å  8 å­—èŠ‚ï¼ˆå³4*8=32å­—èŠ‚ï¼‰ å±æ€§ depthã€hiwat ç±»å‹ä¸º unit32_tï¼Œå®é™…ç±»å‹æ˜¯ unsigned int ç±»å‹ï¼Œå‡å  4 å­—èŠ‚ï¼ˆå³2*4=8å­—èŠ‚ï¼‰ objc_autoreleasePoolPush æºç åˆ†æè¿›å…¥ push æºç å®ç°ï¼Œæœ‰ä»¥ä¸‹é€»è¾‘ åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰ pool å¦‚æœæ²¡æœ‰ï¼Œåˆ™é€šè¿‡ autoreleaseNewPage æ–¹æ³•åˆ›å»º å¦‚æœæœ‰ï¼Œåˆ™é€šè¿‡ autoreleaseFast å‹æ ˆ å“¨å…µå¯¹è±¡ 12345678910111213141516// å…¥æ ˆstatic inline void *push() &#123; id *dest; // åˆ¤æ–­æ˜¯å¦æœ‰pool if (slowpath(DebugPoolAllocation)) &#123; // Each autorelease pool starts on a new pool page.è‡ªåŠ¨é‡Šæ”¾æ± ä»æ–°æ± é¡µé¢å¼€å§‹ // å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»º dest = autoreleaseNewPage(POOL_BOUNDARY); &#125; else &#123; // å‹æ ˆä¸€ä¸ªPOOL_BOUNDARYï¼Œå³å‹æ ˆå“¨å…µ dest = autoreleaseFast(POOL_BOUNDARY); &#125; ASSERT(dest == EMPTY_POOL_PLACEHOLDER || *dest == POOL_BOUNDARY); return dest;&#125; åˆ›å»ºé¡µ autoreleaseNewPage è¿›å…¥ objc_autoreleasePoolPush -&gt; push -&gt; autoreleaseNewPage æºç å®ç°ï¼Œä¸»è¦æ˜¯é€šè¿‡ hotPage è·å–å½“å‰é¡µï¼Œåˆ¤æ–­å½“å‰é¡µæ˜¯å¦å­˜åœ¨ å¦‚æœå­˜åœ¨ï¼Œåˆ™é€šè¿‡ autoreleaseFullPage æ–¹æ³• å‹æ ˆå¯¹è±¡ å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡ autoreleaseNoPage æ–¹æ³• åˆ›å»ºé¡µ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182//åˆ›å»ºæ–°é¡µstatic __attribute__((noinline))id *autoreleaseNewPage(id obj)&#123; //è·å–å½“å‰æ“ä½œé¡µ AutoreleasePoolPage *page = hotPage(); //å¦‚æœå­˜åœ¨ï¼Œåˆ™å‹æ ˆå¯¹è±¡ if (page) return autoreleaseFullPage(obj, page); //å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºé¡µ else return autoreleaseNoPage(obj);&#125;//******** hotPageæ–¹æ³• ********//è·å–å½“å‰æ“ä½œé¡µstatic inline AutoreleasePoolPage *hotPage() &#123; //è·å–å½“å‰é¡µ AutoreleasePoolPage *result = (AutoreleasePoolPage *) tls_get_direct(key); //å¦‚æœæ˜¯ä¸€ä¸ªç©ºæ± ï¼Œåˆ™è¿”å›nilï¼Œå¦åˆ™ï¼Œè¿”å›å½“å‰çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ±  if ((id *)result == EMPTY_POOL_PLACEHOLDER) return nil; if (result) result-&gt;fastcheck(); return result;&#125;//******** autoreleaseNoPageæ–¹æ³• ********static __attribute__((noinline))id *autoreleaseNoPage(id obj)&#123; // &quot;No page&quot; could mean no pool has been pushed // or an empty placeholder pool has been pushed and has no contents yet ASSERT(!hotPage()); bool pushExtraBoundary = false; //åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºå ä½ç¬¦ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å‹æ ˆå“¨å…µæ ‡è¯†ç¬¦ç½®ä¸ºYES if (haveEmptyPoolPlaceholder()) &#123; // We are pushing a second pool over the empty placeholder pool // or pushing the first object into the empty placeholder pool. // Before doing that, push a pool boundary on behalf of the pool // that is currently represented by the empty placeholder. pushExtraBoundary = true; &#125; //å¦‚æœå¯¹è±¡ä¸æ˜¯å“¨å…µå¯¹è±¡ï¼Œä¸”æ²¡æœ‰Poolï¼Œåˆ™æŠ¥é”™ else if (obj != POOL_BOUNDARY &amp;&amp; DebugMissingPools) &#123; // We are pushing an object with no pool in place, // and no-pool debugging was requested by environment. _objc_inform(&quot;MISSING POOLS: (%p) Object %p of class %s &quot; &quot;autoreleased with no pool in place - &quot; &quot;just leaking - break on &quot; &quot;objc_autoreleaseNoPool() to debug&quot;, objc_thread_self(), (void*)obj, object_getClassName(obj)); objc_autoreleaseNoPool(obj); return nil; &#125; //å¦‚æœå¯¹è±¡æ˜¯å“¨å…µå¯¹è±¡ï¼Œä¸”æ²¡æœ‰ç”³è¯·è‡ªåŠ¨é‡Šæ”¾æ± å†…å­˜ï¼Œåˆ™è®¾ç½®ä¸€ä¸ªç©ºå ä½ç¬¦å­˜å‚¨åœ¨tlsä¸­ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ else if (obj == POOL_BOUNDARY &amp;&amp; !DebugPoolAllocation) &#123;//å¦‚æœä¼ å…¥å‚æ•°ä¸ºå“¨å…µ // We are pushing a pool with no pool in place, // and alloc-per-pool debugging was not requested. // Install and return the empty pool placeholder. return setEmptyPoolPlaceholder();//è®¾ç½®ç©ºçš„å ä½ç¬¦ &#125; // We are pushing an object or a non-placeholder&#x27;d pool. // Install the first page. //åˆå§‹åŒ–ç¬¬ä¸€é¡µ AutoreleasePoolPage *page = new AutoreleasePoolPage(nil); //è®¾ç½®pageä¸ºå½“å‰èšç„¦é¡µ setHotPage(page); // Push a boundary on behalf of the previously-placeholder&#x27;d pool. //å‹æ ˆå“¨å…µçš„æ ‡è¯†ç¬¦ä¸ºYESï¼Œåˆ™å‹æ ˆå“¨å…µå¯¹è±¡ if (pushExtraBoundary) &#123; //å‹æ ˆå“¨å…µ page-&gt;add(POOL_BOUNDARY); &#125; // Push the requested object or pool. //å‹æ ˆå¯¹è±¡ return page-&gt;add(obj);&#125; å…¶ä¸­ autoreleaseNoPage æ–¹æ³•ä¸­å‘ç° å½“å‰çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ±  æ˜¯é€šè¿‡ AutoreleasePoolPage åˆ›å»ºçš„ï¼Œå…¶å®šä¹‰ä¸­æœ‰ æ„é€ æ–¹æ³•ï¼Œè€Œæ„é€ æ–¹æ³•çš„å®ç°æ˜¯é€šè¿‡çˆ¶ç±» AutoreleasePoolPageData çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆä»ä¸Šé¢çš„å®šä¹‰ä¸­å¯ä»¥å¾—çŸ¥ï¼‰ 1234567891011121314151617181920212223242526//**********AutoreleasePoolPageæ„é€ æ–¹æ³•********** AutoreleasePoolPage(AutoreleasePoolPage *newParent) : AutoreleasePoolPageData(begin(),//å¼€å§‹å­˜å‚¨çš„ä½ç½® objc_thread_self(),//ä¼ çš„æ˜¯å½“å‰çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹æ—¶é€šè¿‡tlsè·å–çš„ newParent, newParent ? 1+newParent-&gt;depth : 0,//å¦‚æœæ˜¯ç¬¬ä¸€é¡µæ·±åº¦ä¸º0ï¼Œå¾€åæ˜¯å‰ä¸€ä¸ªçš„æ·±åº¦+1 newParent ? newParent-&gt;hiwat : 0)&#123; if (parent) &#123; parent-&gt;check(); ASSERT(!parent-&gt;child); parent-&gt;unprotect(); //this è¡¨ç¤º æ–°å»ºé¡µé¢ï¼Œå°†å½“å‰é¡µé¢çš„å­èŠ‚ç‚¹ èµ‹å€¼ä¸ºæ–°å»ºé¡µé¢ parent-&gt;child = this; parent-&gt;protect(); &#125; protect();&#125;//**********AutoreleasePoolPageDataåˆå§‹åŒ–æ–¹æ³•**********AutoreleasePoolPageData(__unsafe_unretained id* _next, pthread_t _thread, AutoreleasePoolPage* _parent, uint32_t _depth, uint32_t _hiwat) : magic(), next(_next), thread(_thread), parent(_parent), child(nil), depth(_depth), hiwat(_hiwat) &#123; &#125; å…¶ä¸­ AutoreleasePoolPageData æ–¹æ³•ä¼ å…¥çš„å‚æ•°å«ä¹‰ä¸ºï¼š begin() è¡¨ç¤º å‹æ ˆ çš„ä½ç½®ï¼ˆå³ä¸‹ä¸€ä¸ªè¦é‡Šæ”¾å¯¹è±¡çš„å‹æ ˆåœ°å€ï¼‰ã€‚å¯ä»¥é€šè¿‡æºç è°ƒå¼ beginï¼Œå‘ç°å…¶å…·ä½“å®ç°ç­‰äº é¡µé¦–åœ°å€+56ï¼Œå…¶ä¸­çš„ 56 å°±æ˜¯ç»“æ„ä½“ AutoreleasePoolPageData çš„å†…å­˜å¤§å° 123456//********begin()********//é¡µçš„å¼€å§‹ä½ç½®id * begin() &#123; //ç­‰äº é¦–åœ°å€+56ï¼ˆAutoreleasePoolPageç±»æ‰€å å†…å­˜å¤§å°ï¼‰ return (id *) ((uint8_t *)this+sizeof(*this));&#125; objc_thread_self() è¡¨ç¤ºçš„æ˜¯ å½“å‰çº¿ç¨‹ï¼Œè€Œå½“å‰çº¿ç¨‹æ—¶é€šè¿‡tlsè·å–çš„ 123456__attribute__((const))static inline pthread_t objc_thread_self()&#123; //é€šè¿‡tlsè·å–å½“å‰çº¿ç¨‹ return (pthread_t)tls_get_direct(_PTHREAD_TSD_SLOT_PTHREAD_SELF);&#125; newParent è¡¨ç¤º çˆ¶èŠ‚ç‚¹ åç»­ä¸¤ä¸ªå‚æ•°æ˜¯ é€šè¿‡çˆ¶èŠ‚ç‚¹çš„æ·±åº¦ã€æœ€å¤§å…¥æ ˆä¸ªæ•° è®¡ç®— depth ä»¥åŠ hiwat æŸ¥çœ‹è‡ªåŠ¨é‡Šæ”¾æ± å†…å­˜ç»“æ„ç”±äºåœ¨ARCæ¨¡å¼ä¸‹ï¼Œæ˜¯æ— æ³•æ‰‹åŠ¨è°ƒç”¨ autoreleaseï¼Œæ‰€ä»¥å°†Demoåˆ‡æ¢è‡³MRCæ¨¡å¼ï¼ˆBuild Settings -&gt; Object-C Automatic Refrence Counting è®¾ç½®ä¸º NOï¼‰ å®šä¹‰å¦‚ä¸‹ä»£ç  1234567891011121314//************æ‰“å°è‡ªåŠ¨é‡Šæ”¾æ± ç»“æ„************extern void _objc_autoreleasePoolPrint(void);//************è¿è¡Œä»£ç ************int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; //å¾ªç¯åˆ›å»ºå¯¹è±¡ï¼Œå¹¶åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ±  for (int i = 0; i &lt; 5; i++) &#123; NSObject *objc = [[NSObject alloc] sutorelease]; &#125; //è°ƒç”¨ _objc_autoreleasePoolPrint(); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå‘ç°æ˜¯6ä¸ªï¼Œä½†æ˜¯æˆ‘ä»¬å‹æ ˆçš„å¯¹è±¡å…¶å®åªæœ‰5ä¸ªï¼Œå…¶ä¸­çš„ POOL è¡¨ç¤º å“¨å…µï¼Œå³ è¾¹ç•Œï¼Œå…¶ç›®çš„æ˜¯ ä¸ºäº†é˜²æ­¢è¶Šç•Œ æŸ¥çœ‹è‡ªåŠ¨é‡Šæ”¾æ± çš„å†…å­˜ç»“æ„ï¼Œå‘ç°ï¼Œé¡µçš„é¦–åœ°å€ä¸ å“¨å…µå¯¹è±¡ ç›¸å·® 0x38ï¼Œè½¬æ¢æˆåè¿›åˆ¶åˆšå¥½æ˜¯ 56ï¼Œä¹Ÿå°±æ˜¯ AutoreleasePoolPage è‡ªå·±æœ¬èº«çš„å†…å­˜å¤§å° å°†ä¸Šè¿°çš„æµ‹è¯•ä»£ç çš„æ•°æ®æ”¹ä¸º 505ï¼Œå…¶å†…å­˜ç»“æ„å¦‚ä¸‹ï¼Œå‘ç°ç¬¬ä¸€é¡µæ»¡äº†ï¼Œå­˜å‚¨äº† 504 ä¸ªè¦é‡Šæ”¾çš„å¯¹è±¡ï¼Œç¬¬äºŒé¡µåªå­˜å‚¨äº†ä¸€ä¸ª åœ¨å°†æ•°æ®æ”¹ä¸º 505+506ï¼Œæ¥éªŒè¯ç¬¬äºŒé¡µæ˜¯å¦ä¹Ÿæ˜¯å­˜å‚¨äº† 504 ä¸ªå¯¹è±¡ é€šè¿‡è¿è¡Œå‘ç°ï¼Œç¬¬ä¸€é¡µå­˜å‚¨ 504ï¼Œç¬¬äºŒé¡µå­˜å‚¨ 505ï¼Œç¬¬ä¸‰é¡µå­˜å‚¨ 2ä¸ª ç»“è®º æ‰€ä»¥é€šè¿‡ä¸Šè¿°æµ‹è¯•ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š ç¬¬ä¸€é¡µå¯ä»¥å­˜æ”¾ 504 ä¸ªå¯¹è±¡ï¼Œä¸” åªæœ‰ç¬¬ä¸€é¡µæœ‰å“¨å…µï¼Œå½“ç¬¬ä¸€é¡µå‹æ ˆæ»¡äº†ï¼Œå°±ä¼šå¼€è¾Ÿæ–°çš„ä¸€é¡µ ç¬¬äºŒé¡µå¼€å§‹ï¼Œæœ€å¤šå¯ä»¥å­˜æ”¾ 505 ä¸ªå¯¹è±¡ ä¸€é¡µçš„å¤§å°ç­‰äº 505 * 8 = 4040 è¿™ä¸ªç»“è®ºåŒæ ·å¯ä»¥é€šè¿‡ AutoreleasePoolPage ä¸­çš„ SIZE æ¥å¾—åˆ°å°è¯ï¼Œä»å…¶å®šä¹‰ä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡ºï¼Œä¸€é¡µçš„å¤§å°æ˜¯ 4096 å­—èŠ‚ï¼Œè€Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­ å¯¹è±¡çš„å‹æ ˆä½ç½®ï¼Œæ˜¯ä» é¦–åœ°å€+56 å¼€å§‹çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸€é¡µä¸­å®é™…å¯ä»¥å­˜å‚¨ 4096 - 56= 4040å­—èŠ‚ï¼Œè½¬æ¢æˆå¯¹è±¡æ—¶ 4040/8 = 505 ä¸ªï¼Œå³ä¸€é¡µæœ€å¤šå¯ä»¥ å­˜å‚¨505ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­ ç¬¬ä¸€é¡µæœ‰å“¨å…µå¯¹è±¡ï¼Œåªèƒ½å­˜å‚¨ 504 ä¸ªå¯¹è±¡ï¼Œå…¶ç»“æ„å›¾ç¤ºå¦‚ä¸‹ï¼š é¢è¯•é¢˜ï¼šå“¨å…µåœ¨ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± æœ‰å‡ ä¸ª åªæœ‰ä¸€ä¸ªå“¨å…µå¯¹è±¡ï¼Œä¸”å“¨å…µåœ¨ç¬¬ä¸€é¡µ ç¬¬ä¸€é¡µæœ€å¤šå¯å­˜ 504 ä¸ªå¯¹è±¡ï¼Œç¬¬äºŒé¡µå¼€å§‹æœ€å¤šå­˜ 505 ä¸ª å‹æ ˆå¯¹è±¡ autoreleaseFast è¿›å…¥ autoreleaseFast æºç ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š è·å–å½“å‰æ“ä½œé¡µï¼Œå¹¶åˆ¤æ–­é¡µæ˜¯å¦å­˜åœ¨ä»¥åŠæ˜¯å¦æ»¡äº† å¦‚æœ é¡µå­˜åœ¨ï¼Œä¸”æœªæ»¡ï¼Œåˆ™é€šè¿‡ add æ–¹æ³•å‹æ ˆå¯¹è±¡ å¦‚æœ é¡µå­˜åœ¨ï¼Œä¸”æ»¡äº†ï¼Œåˆ™é€šè¿‡ autoreleaseFullPage æ–¹æ³•å®‰æ’æ–°çš„é¡µ å¦‚æœ é¡µä¸å­˜åœ¨ï¼Œåˆ™é€šè¿‡ autoreleaseNoPage æ–¹æ³•åˆ›å»ºæ–°é¡µ 12345678910111213141516 static inline id *autoreleaseFast(id obj)&#123; //è·å–å½“å‰æ“ä½œé¡µ AutoreleasePoolPage *page = hotPage(); //åˆ¤æ–­é¡µæ˜¯å¦æ»¡äº† if (page &amp;&amp; !page-&gt;full()) &#123; //å¦‚æœæœªæ»¡ï¼Œåˆ™å‹æ ˆ return page-&gt;add(obj); &#125; else if (page) &#123; //å¦‚æœæ»¡äº†ï¼Œåˆ™å®‰æ’æ–°çš„é¡µé¢ return autoreleaseFullPage(obj, page); &#125; else &#123; //é¡µä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºé¡µ return autoreleaseNoPage(obj); &#125;&#125; autoreleaseFullPage æ–¹æ³•è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨äºåˆ¤æ–­å½“å‰é¡µæ˜¯å¦å·²ç»å­˜å‚¨æ»¡äº†ï¼Œå¦‚æœå½“å‰é¡µå·²ç»æ»¡äº†ï¼Œé€šè¿‡ do-whileå¾ªç¯ æŸ¥æ‰¾ å­èŠ‚ç‚¹å¯¹åº”çš„é¡µï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ æ–°å»ºé¡µï¼Œå¹¶ å‹æ ˆå¯¹è±¡ 1234567891011121314151617181920212223//æ·»åŠ è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡ï¼Œå½“é¡µæ»¡çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³•static __attribute__((noinline))id *autoreleaseFullPage(id obj, AutoreleasePoolPage *page)&#123; // The hot page is full. // Step to the next non-full page, adding a new page if necessary. // Then add the object to that page. ASSERT(page == hotPage()); ASSERT(page-&gt;full() || DebugPoolAllocation); //do-whileéå†å¾ªç¯æŸ¥æ‰¾ç•Œé¢æ˜¯å¦æ»¡äº† do &#123; //å¦‚æœå­é¡µé¢å­˜åœ¨ï¼Œåˆ™å°†é¡µé¢æ›¿æ¢ä¸ºå­é¡µé¢ if (page-&gt;child) page = page-&gt;child; //å¦‚æœå­é¡µé¢ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºé¡µé¢ else page = new AutoreleasePoolPage(page); &#125; while (page-&gt;full()); //è®¾ç½®ä¸ºå½“å‰æ“ä½œé¡µé¢ setHotPage(page); //å¯¹è±¡å‹æ ˆ return page-&gt;add(obj);&#125; ä» autoreleasePoolPage åˆå§‹åŒ–æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦æ˜¯é€šè¿‡æ“ä½œ child å¯¹è±¡ï¼Œå°† å½“å‰é¡µçš„childæŒ‡å‘æ–°å»ºé¡µé¢ï¼Œç”±æ­¤å¯ä»¥å¾—å‡º é¡µæ˜¯é€šè¿‡åŒå‘é“¾è¡¨é“¾æ¥ addæ–¹æ³•è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ æ·»åŠ é‡Šæ”¾å¯¹è±¡ï¼Œå…¶åº•å±‚çš„å®ç°æ—¶é€šè¿‡ next æŒ‡é’ˆå­˜å‚¨é‡Šæ”¾å¯¹è±¡ï¼Œå¹¶å°† nextæŒ‡é’ˆé€’å¢ï¼Œè¡¨ç¤ºä¸‹ä¸€ä¸ªé‡Šæ”¾å¯¹è±¡å­˜å‚¨çš„ä½ç½®ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡º é¡µ æ˜¯é€šè¿‡ æ ˆç»“æ„å­˜å‚¨ 123456789101112//æ·»åŠ é‡Šæ”¾å¯¹è±¡id *add(id obj)&#123; ASSERT(!full()); unprotect(); //ä¼ å…¥å¯¹è±¡å­˜å‚¨çš„ä½ç½® id *ret = next; // faster than `return next-1` because of aliasing //å°†objå‹æ ˆåˆ°nextæŒ‡é’ˆä½ç½®ï¼Œç„¶ånextè¿›è¡Œ++ï¼Œå³ä¸‹ä¸€ä¸ªå¯¹è±¡å­˜å‚¨çš„ä½ç½® *next++ = obj; protect(); return ret;&#125; autoreleaseåº•å±‚åˆ†æåœ¨demoä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ autorelease æ–¹æ³•ï¼Œåœ¨MRCæ¨¡å¼ä¸‹ï¼Œå°†å¯¹è±¡å‹æ ˆåˆ°è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä¸‹é¢åˆ†æå…¶åº•å±‚å®ç° æŸ¥çœ‹ autorelease æ–¹æ³•æºç  å¦‚æœä¸æ˜¯å¯¹è±¡ æˆ–è€… æ˜¯å°å¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿”å› å¦‚æœæ˜¯å¯¹è±¡ï¼Œåˆ™è°ƒç”¨å¯¹è±¡çš„ autorelease è¿›è¡Œé‡Šæ”¾ 12345678910__attribute__((aligned(16), flatten, noinline))idobjc_autorelease(id obj)&#123; //å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿”å› if (!obj) return obj; //å¦‚æœæ˜¯å°å¯¹è±¡ï¼Œä¹Ÿç›´æ¥è¿”å› if (obj-&gt;isTaggedPointer()) return obj; return obj-&gt;autorelease();&#125; è¿›å…¥å¯¹è±¡çš„ autorelease å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940ğŸ‘‡inline id objc_object::autorelease()&#123; ASSERT(!isTaggedPointer()); //åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå®šä¹‰ç±» if (fastpath(!ISA()-&gt;hasCustomRR())) &#123; return rootAutorelease(); &#125; return ((id(*)(objc_object *, SEL))objc_msgSend)(this, @selector(autorelease));&#125;ğŸ‘‡inline id objc_object::rootAutorelease()&#123; //å¦‚æœæ˜¯å°å¯¹è±¡ï¼Œç›´æ¥è¿”å› if (isTaggedPointer()) return (id)this; if (prepareOptimizedReturn(ReturnAtPlus1)) return (id)this; return rootAutorelease2();&#125;ğŸ‘‡__attribute__((noinline,used))id objc_object::rootAutorelease2()&#123; ASSERT(!isTaggedPointer()); return AutoreleasePoolPage::autorelease((id)this);&#125;ğŸ‘‡static inline id autorelease(id obj)&#123; ASSERT(obj); ASSERT(!obj-&gt;isTaggedPointer()); //autoreleaseFast å‹æ ˆæ“ä½œ id *dest __unused = autoreleaseFast(obj); ASSERT(!dest || dest == EMPTY_POOL_PLACEHOLDER || *dest == obj); return obj;&#125; ä»è¿™é‡Œçœ‹å‡ºï¼Œæ— è®ºæ˜¯ å‹æ ˆå“¨å…µå¯¹è±¡ï¼Œè¿˜æ˜¯æ™®é€šå¯¹è±¡ï¼Œéƒ½ä¼šæ¥åˆ° autorelease æ–¹æ³•ï¼Œåªæ˜¯ åŒºåˆ«æ ‡è¯†ä¸åŒ è€Œå·² objc_autoreleasePoolPop æºç åˆ†æåœ¨ objc_autoreleasePoolPop æ–¹æ³•ä¸­æœ‰ä¸ªå‚æ•°ï¼Œåœ¨clangåˆ†ææ—¶ï¼Œå‘ç°ä¼ å…¥çš„å‚æ•°æ˜¯ push å‹æ ˆåè¿”å›çš„å“¨å…µå¯¹è±¡ï¼Œå³ ctxtï¼Œå…¶ç›®çš„æ˜¯ é¿å…å‡ºæ ˆæ··ä¹±ï¼Œé˜²æ­¢å°†åˆ«çš„å¯¹è±¡å‡ºæ ˆ è¿›å…¥ pop æºç å®ç°ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥ ç©ºé¡µé¢çš„å¤„ç†ï¼Œå¹¶ æ ¹æ®tokenè·å–page å®¹é”™å¤„ç† é€šè¿‡ popPage å‡ºæ ˆé¡µ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950//å‡ºæ ˆstatic inline voidpop(void *token)&#123; AutoreleasePoolPage *page; id *stop; //åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ç©ºå ä½ç¬¦ if (token == (void*)EMPTY_POOL_PLACEHOLDER) &#123; //å¦‚æœå½“æ˜¯ç©ºå ä½ç¬¦ // Popping the top-level placeholder pool. //è·å–å½“å‰é¡µ page = hotPage(); if (!page) &#123; // Pool was never used. Clear the placeholder. //å¦‚æœå½“å‰é¡µä¸å­˜åœ¨ï¼Œåˆ™æ¸…é™¤ç©ºå ä½ç¬¦ return setHotPage(nil); &#125; // Pool was used. Pop its contents normally. // Pool pages remain allocated for re-use as usual. //å¦‚æœå½“å‰é¡µå­˜åœ¨ï¼Œåˆ™å°†å½“å‰é¡µè®¾ç½®ä¸ºcoldPage,tokenè®¾ç½®ä¸ºcoldPageçš„å¼€å§‹ä½ç½® page = coldPage(); token = page-&gt;begin(); &#125; else &#123; //è·å–tokenæ‰€åœ¨çš„é¡µ page = pageForPointer(token); &#125; stop = (id *)token; //åˆ¤æ–­æœ€åä¸€ä¸ªä½ç½®ï¼Œæ˜¯å¦æ˜¯å“¨å…µ if (*stop != POOL_BOUNDARY) &#123; //æœ€åä¸€ä¸ªä½ç½®ä¸æ˜¯å“¨å…µï¼Œå³æœ€åä¸€ä¸ªä½ç½®æ˜¯ä¸€ä¸ªå¯¹è±¡ if (stop == page-&gt;begin() &amp;&amp; !page-&gt;parent) &#123; //å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸”æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œä»€ä¹ˆä¹Ÿä¸åš // Start of coldest page may correctly not be POOL_BOUNDARY: // 1. top-level pool is popped, leaving the cold page in place // 2. an object is autoreleased with no pool &#125; else &#123; //å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸”æœ‰çˆ¶èŠ‚ç‚¹ï¼Œåˆ™å‡ºç°äº†æ··ä¹± // Error. For bincompat purposes this is not // fatal in executables built with old SDKs. return badPop(token); &#125; &#125; if (slowpath(PrintPoolHiwat || DebugPoolAllocation || DebugMissingPools)) &#123; return popPageDebug(token, page, stop); &#125; //å‡ºæ ˆé¡µ return popPage&lt;false&gt;(token, page, stop);&#125; è¿›å…¥ popPage æºç ï¼Œå…¶ä¸­ä¼ å…¥çš„ allowDebug ä¸ºfalseï¼Œåˆ™é€šè¿‡ releaseUntil å‡ºæ ˆå½“å‰é¡µ stop ä½ç½®ä¹‹å‰çš„æ‰€æœ‰å¯¹è±¡ï¼Œå³å‡ºæ ˆä¸­çš„å¯¹è±¡ å‘é€releaseæ¶ˆæ¯ï¼Œç›´åˆ°é‡åˆ°ä¼ å…¥çš„ å“¨å…µå¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637//å‡ºæ ˆé¡µé¢template&lt;bool allowDebug&gt; static void popPage(void *token, AutoreleasePoolPage *page, id *stop)&#123; if (allowDebug &amp;&amp; PrintPoolHiwat) printHiwat(); //å‡ºæ ˆå½“å‰æ“ä½œé¡µé¢å¯¹è±¡ page-&gt;releaseUntil(stop); // memory: delete empty children åˆ é™¤ç©ºå­é¡¹ if (allowDebug &amp;&amp; DebugPoolAllocation &amp;&amp; page-&gt;empty()) &#123; // special case: delete everything during page-per-pool debugging //è°ƒè¯•æœŸé—´åˆ é™¤æ¯ä¸ªç‰¹æ®Šæƒ…å†µä¸‹çš„æ‰€æœ‰æ±  //è·å–å½“å‰é¡µé¢çš„çˆ¶èŠ‚ç‚¹ AutoreleasePoolPage *parent = page-&gt;parent; //å°†å½“å‰é¡µé¢æ€æ‰ page-&gt;kill(); //è®¾ç½®æ“ä½œé¡µé¢ä¸ºçˆ¶èŠ‚ç‚¹é¡µé¢ setHotPage(parent); &#125; else if (allowDebug &amp;&amp; DebugMissingPools &amp;&amp; page-&gt;empty() &amp;&amp; !page-&gt;parent) &#123; // special case: delete everything for pop(top) // when debugging missing autorelease pools //ç‰¹æ®Šæƒ…å†µï¼šè°ƒè¯•ä¸¢å¤±çš„è‡ªåŠ¨é‡Šæ”¾æ± æ—¶åˆ é™¤popï¼ˆtopï¼‰çš„æ‰€æœ‰å†…å®¹ page-&gt;kill(); setHotPage(nil); &#125; else if (page-&gt;child) &#123; // hysteresis: keep one empty child if page is more than half full å¦‚æœé¡µé¢å·²æ»¡ä¸€åŠä»¥ä¸Šï¼Œåˆ™ä¿ç•™ä¸€ä¸ªç©ºå­çº§ if (page-&gt;lessThanHalfFull()) &#123; page-&gt;child-&gt;kill(); &#125; else if (page-&gt;child-&gt;child) &#123; page-&gt;child-&gt;child-&gt;kill(); &#125; &#125;&#125; è¿›å…¥ releaseUntil å®ç°ï¼Œä¸»è¦æ˜¯é€šè¿‡ å¾ªç¯éå†ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦ç­‰äºstopï¼Œå…¶ç›®çš„æ˜¯ é‡Šæ”¾stopä¹‹å‰çš„æ‰€æœ‰çš„å¯¹è±¡ é¦–å…ˆé€šè¿‡ è·å–pageçš„nexté‡Šæ”¾å¯¹è±¡ï¼ˆå³pageçš„æœ€åä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œå¹¶å¯¹ next è¿›è¡Œ é€’å‡ï¼Œè·å– ä¸Šä¸€ä¸ªå¯¹è±¡ åˆ¤æ–­ æ˜¯å¦å“¨å…µå¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯åˆ™è‡ªåŠ¨è°ƒç”¨ objc_release é‡Šæ”¾ 12345678910111213141516171819202122232425262728293031323334353637383940414243//é‡Šæ”¾åˆ°stopä½ç½®ä¹‹å‰çš„æ‰€æœ‰å¯¹è±¡void releaseUntil(id *stop) &#123; // Not recursive: we don&#x27;t want to blow out the stack ä¸æ˜¯é€’å½’çš„ï¼šæˆ‘ä»¬ä¸æƒ³ç ´åå †æ ˆ // if a thread accumulates a stupendous amount of garbage //åˆ¤æ–­ä¸‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ç­‰äºstopï¼Œå¦‚æœä¸ç­‰äºï¼Œåˆ™è¿›å…¥whileå¾ªç¯ while (this-&gt;next != stop) &#123; // Restart from hotPage() every time, in case -release // autoreleased more objects æ¯æ¬¡ä»hotPageï¼ˆï¼‰é‡æ–°å¯åŠ¨ï¼Œä»¥é˜²-releaseè‡ªåŠ¨é‡Šæ”¾æ›´å¤šå¯¹è±¡ //è·å–å½“å‰æ“ä½œé¡µé¢ï¼Œå³hoté¡µé¢ AutoreleasePoolPage *page = hotPage(); // fixme I think this `while` can be `if`, but I can&#x27;t prove it //å¦‚æœå½“å‰é¡µæ˜¯ç©ºçš„ while (page-&gt;empty()) &#123; //å°†pageèµ‹å€¼ä¸ºçˆ¶èŠ‚ç‚¹é¡µ page = page-&gt;parent; //å¹¶è®¾ç½®å½“å‰é¡µä¸ºçˆ¶èŠ‚ç‚¹é¡µ setHotPage(page); &#125; page-&gt;unprotect(); //nextè¿›è¡Œ--æ“ä½œï¼Œå³å‡ºæ ˆ id obj = *--page-&gt;next; //å°†é¡µç´¢å¼•ä½ç½®ç½®ä¸ºSCRIBBLEï¼Œè¡¨ç¤ºå·²ç»è¢«é‡Šæ”¾ memset((void*)page-&gt;next, SCRIBBLE, sizeof(*page-&gt;next)); page-&gt;protect(); if (obj != POOL_BOUNDARY) &#123; //é‡Šæ”¾ objc_release(obj); &#125; &#125; //è®¾ç½®å½“å‰é¡µ setHotPage(this);#if DEBUG // we expect any children to be completely empty for (AutoreleasePoolPage *page = child; page; page = page-&gt;child) &#123; ASSERT(page-&gt;empty()); &#125;#endif&#125; è¿›å…¥ kill å®ç°ï¼Œä¸»è¦æ˜¯é”€æ¯å½“å‰é¡µï¼Œå°† å½“å‰é¡µèµ‹å€¼ä¸ºçˆ¶èŠ‚ç‚¹é¡µï¼Œå¹¶å°† çˆ¶èŠ‚ç‚¹é¡µçš„childå¯¹è±¡æŒ‡é’ˆç½®ä¸ºnil 1234567891011121314151617181920212223//é”€æ¯void kill() &#123; // Not recursive: we don&#x27;t want to blow out the stack // if a thread accumulates a stupendous amount of garbage AutoreleasePoolPage *page = this; //è·å–æœ€åä¸€ä¸ªé¡µ while (page-&gt;child) page = page-&gt;child; AutoreleasePoolPage *deathptr; do &#123; deathptr = page; //å­èŠ‚ç‚¹ å˜æˆ çˆ¶èŠ‚ç‚¹ page = page-&gt;parent; if (page) &#123; page-&gt;unprotect(); //å­èŠ‚ç‚¹ä¸ºnil page-&gt;child = nil; page-&gt;protect(); &#125; delete deathptr; &#125; while (deathptr != this);&#125; æ€»ç»“é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œé’ˆå¯¹è‡ªåŠ¨é‡Šæ”¾æ± çš„pushå’Œpopï¼Œæ€»ç»“å¦‚ä¸‹ï¼š åœ¨è‡ªåŠ¨é‡Šæ”¾æ± çš„ å‹æ ˆï¼ˆå³pushï¼‰æ“ä½œä¸­ å½“æ²¡æœ‰poolï¼Œå³åªæœ‰ç©ºå ä½ç¬¦ï¼ˆå­˜å‚¨åœ¨tlsä¸­ï¼‰æ—¶ï¼Œåˆ™åˆ›å»ºé¡µï¼Œå‹æ ˆå“¨å…µå¯¹è±¡ åœ¨é¡µä¸­ å‹æ ˆæ™®é€šå¯¹è±¡ ä¸»è¦æ˜¯é€šè¿‡ next æŒ‡é’ˆ é€’å¢ è¿›è¡Œçš„ å½“ é¡µæ»¡ äº†æ—¶ï¼Œéœ€è¦è®¾ç½®é¡µçš„ child å¯¹è±¡ä¸º æ–°å»ºé¡µ æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œautorelease å’Œ objc_autoreleasePush çš„æ•´ä½“åº•å±‚çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º åœ¨è‡ªåŠ¨é‡Šæ”¾æ± çš„ å‡ºæ ˆï¼ˆå³ popï¼‰æ“ä½œä¸­ åœ¨é¡µä¸­ å‡ºæ ˆæ™®é€šå¯¹è±¡ ä¸»è¦æ˜¯é€šè¿‡ next æŒ‡é’ˆ é€’å‡ è¿›è¡Œçš„ å½“ é¡µç©º äº†æ—¶ï¼Œéœ€è¦èµ‹å€¼é¡µçš„ parent å¯¹è±¡ä¸º å½“å‰é¡µ ç»¼ä¸Šæ‰€è¿°ï¼Œobjc_autoreleasePoolPop å‡ºæ ˆçš„æµç¨‹å¦‚ä¸‹æ‰€ç¤º Runloopå¯¹äºRunloopï¼Œä¸»è¦å…³å¿ƒçš„ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ª runoopæ˜¯ä»€ä¹ˆï¼Ÿ runloopå’Œçº¿ç¨‹æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ runloopæ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼Ÿ Runloopä»‹ç»Runloop æ˜¯æ—¶é—´æ¥æ”¶å’Œåˆ†å‘æœºåˆ¶çš„ä¸€ä¸ªå®ç°ï¼Œæ˜¯çº¿ç¨‹ç›¸å…³çš„åŸºç¡€æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸€ä¸ªRunloopå°±æ˜¯ä¸€ä¸ªæ—¶é—´å¤„ç†çš„å¾ªç¯ï¼Œç”¨æ¥ä¸åœçš„è°ƒåº¦å·¥ä½œä»¥åŠå¤„ç†è¾“å…¥äº‹ä»¶ã€‚ Runloop æœ¬è´¨æ˜¯ä¸€ä¸ª do-whileå¾ªç¯ï¼Œæ²¡äº‹åšå°±ä¼‘æ¯ï¼Œæ¥æ´»äº†å°±å¹²æ´»ã€‚ä¸æ™®é€šçš„ while å¾ªç¯æ—¶æœ‰åŒºåˆ«çš„ï¼Œæ™®é€šçš„ whileå¾ªç¯ ä¼šå¯¼è‡´CPUè¿›å…¥ å¿™ç­‰å¾…çŠ¶æ€ï¼Œå³ä¸€ç›´æ¶ˆè€—cpuï¼Œè€ŒRunloopåˆ™ä¸ä¼šï¼ŒRunloopæ˜¯ä¸€ç§ é—²ç­‰å¾…ï¼Œå³Runloopå…·å¤‡ ä¼‘çœ åŠŸèƒ½ã€‚ Runloopçš„ä½œç”¨ ä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œ å¤„ç†APPä¸­çš„å„ç§äº‹ä»¶ï¼ˆè§¦æ‘¸ã€å®šæ—¶å™¨ã€performSelectorï¼ˆä¸€ç§æ–¹æ³•çš„è°ƒç”¨æ–¹å¼ï¼‰ï¼‰ èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½ï¼Œè¯¥åšäº‹å°±åšäº‹ï¼Œè¯¥ä¼‘æ¯å°±ä¼‘æ¯ Runloopæºç åˆ†æRunloopæºç çš„ä¸‹è½½åœ°å€ ï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬ä¸‹è½½å³å¯ Runloopå’Œçº¿ç¨‹çš„å…³ç³»ä¸€èˆ¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯¹äº Runloopçš„è·å– ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ 1234// ä¸»è¿è¡Œå¾ªç¯CFRunLoopRef mainRunloop = CFRunLoopGetMain();// å½“å‰è¿è¡Œå¾ªç¯CFRunLoopRef currentRunloop = CFRunLoopGetCurrent(); è¿›å…¥ CFRunLoopGetMain æºç  1234567CFRunLoopRef CFRunLoopGetMain(void) &#123; CHECK_FOR_FORK(); static CFRunLoopRef __main = NULL; // no retain needed // pthread_main_thread_np ä¸»çº¿ç¨‹ if (!__main) __main = _CFRunLoopGet0(pthread_main_thread_np()); // no CAS needed return __main;&#125; è¿›å…¥ _CFRunLoopGet0 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051// should only be called by Foundation// t==0 is a synonym for &quot;main thread&quot; that always worksCF_EXPORT CFRunLoopRef _CFRunLoopGet0(pthread_t t) &#123; //å¦‚æœtä¸å­˜åœ¨ï¼Œåˆ™æ ‡è®°ä¸ºä¸»çº¿ç¨‹ï¼ˆå³é»˜è®¤æƒ…å†µï¼Œé»˜è®¤æ˜¯ä¸»çº¿ç¨‹ï¼‰ if (pthread_equal(t, kNilPthreadT)) &#123; t = pthread_main_thread_np(); &#125; __CFSpinLock(&amp;loopsLock); if (!__CFRunLoops) &#123; __CFSpinUnlock(&amp;loopsLock); //åˆ›å»ºå…¨å±€å­—å…¸ï¼Œæ ‡è®°ä¸ºkCFAllocatorSystemDefault CFMutableDictionaryRef dict = CFDictionaryCreateMutable(kCFAllocatorSystemDefault, 0, NULL, &amp;kCFTypeDictionaryValueCallBacks); //é€šè¿‡ä¸»çº¿ç¨‹ åˆ›å»ºä¸»è¿è¡Œå¾ªç¯ CFRunLoopRef mainLoop = __CFRunLoopCreate(pthread_main_thread_np()); //åˆ©ç”¨dictï¼Œè¿›è¡Œkey-valueç»‘å®šæ“ä½œï¼Œå³å¯ä»¥è¯´æ˜ï¼Œçº¿ç¨‹å’Œrunloopæ˜¯ä¸€ä¸€å¯¹åº”çš„ // dict : key value CFDictionarySetValue(dict, pthreadPointer(pthread_main_thread_np()), mainLoop); if (!OSAtomicCompareAndSwapPtrBarrier(NULL, dict, (void * volatile *)&amp;__CFRunLoops)) &#123; CFRelease(dict); &#125; CFRelease(mainLoop); __CFSpinLock(&amp;loopsLock); &#125; //é€šè¿‡å…¶ä»–çº¿ç¨‹è·å–runloop CFRunLoopRef loop = (CFRunLoopRef)CFDictionaryGetValue(__CFRunLoops, pthreadPointer(t)); __CFSpinUnlock(&amp;loopsLock); if (!loop) &#123; //å¦‚æœæ²¡æœ‰è·å–åˆ°ï¼Œåˆ™æ–°å»ºä¸€ä¸ªè¿è¡Œå¾ªç¯ CFRunLoopRef newLoop = __CFRunLoopCreate(t); __CFSpinLock(&amp;loopsLock); loop = (CFRunLoopRef)CFDictionaryGetValue(__CFRunLoops, pthreadPointer(t)); if (!loop) &#123; //å°†æ–°å»ºçš„runloop ä¸ çº¿ç¨‹è¿›è¡Œkey-valueç»‘å®š CFDictionarySetValue(__CFRunLoops, pthreadPointer(t), newLoop); loop = newLoop; &#125; // don&#x27;t release run loops inside the loopsLock, because CFRunLoopDeallocate may end up taking it __CFSpinUnlock(&amp;loopsLock); CFRelease(newLoop); &#125; if (pthread_equal(t, pthread_self())) &#123; _CFSetTSD(__CFTSDKeyRunLoop, (void *)loop, NULL); if (0 == _CFGetTSD(__CFTSDKeyRunLoopCntr)) &#123; _CFSetTSD(__CFTSDKeyRunLoopCntr, (void *)(PTHREAD_DESTRUCTOR_ITERATIONS-1), (void (*)(void *))__CFFinalizeRunLoop); &#125; &#125; return loop;&#125; ä»è¿™é‡Œå¯ä»¥è¯´æ˜ï¼ŒRunloop åªæœ‰ ä¸¤ç§ï¼Œä¸€ç§æ˜¯ ä¸»çº¿ç¨‹çš„ï¼Œä¸€ç§æ˜¯ å…¶ä»–çº¿ç¨‹çš„ã€‚å³Runloopå’Œçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ Runloopçš„åˆ›å»º è¿›å…¥ __CFRunLoopCreate æºç ï¼Œå…¶ä¸­ä¸»è¦æ˜¯å¯¹runloopå±æ€§çš„èµ‹å€¼æ“ä½œ 123456789101112131415161718192021222324252627282930313233static CFRunLoopRef __CFRunLoopCreate(pthread_t t) &#123; CFRunLoopRef loop = NULL; CFRunLoopModeRef rlm; uint32_t size = sizeof(struct __CFRunLoop) - sizeof(CFRuntimeBase); loop = (CFRunLoopRef)_CFRuntimeCreateInstance(kCFAllocatorSystemDefault, __kCFRunLoopTypeID, size, NULL); //å¦‚æœloopä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›NULL if (NULL == loop) &#123; return NULL; &#125; //runloopå±æ€§é…ç½® (void)__CFRunLoopPushPerRunData(loop); __CFRunLoopLockInit(&amp;loop-&gt;_lock); loop-&gt;_wakeUpPort = __CFPortAllocate(); if (CFPORT_NULL == loop-&gt;_wakeUpPort) HALT; __CFRunLoopSetIgnoreWakeUps(loop); loop-&gt;_commonModes = CFSetCreateMutable(kCFAllocatorSystemDefault, 0, &amp;kCFTypeSetCallBacks); CFSetAddValue(loop-&gt;_commonModes, kCFRunLoopDefaultMode); loop-&gt;_commonModeItems = NULL; loop-&gt;_currentMode = NULL; loop-&gt;_modes = CFSetCreateMutable(kCFAllocatorSystemDefault, 0, &amp;kCFTypeSetCallBacks); loop-&gt;_blocks_head = NULL; loop-&gt;_blocks_tail = NULL; loop-&gt;_counterpart = NULL; loop-&gt;_pthread = t;#if DEPLOYMENT_TARGET_WINDOWS loop-&gt;_winthread = GetCurrentThreadId();#else loop-&gt;_winthread = 0;#endif rlm = __CFRunLoopFindMode(loop, kCFRunLoopDefaultMode, true); if (NULL != rlm) __CFRunLoopModeUnlock(rlm); return loop;&#125; è¿›å…¥ CFRunLoopRef çš„å®šä¹‰ï¼Œæ ¹æ®å®šä¹‰å¾—çŸ¥ï¼Œå…¶å® RunLoopä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ˜¯ __CFRunLoop ç»“æ„ä½“çš„ æŒ‡é’ˆç±»å‹ 123456789101112131415161718typedef struct __CFRunLoop * CFRunLoopRef;ğŸ‘‡struct __CFRunLoop &#123; CFRuntimeBase _base; pthread_mutex_t _lock; /* locked for accessing mode list */ __CFPort _wakeUpPort; // used for CFRunLoopWakeUp Boolean _unused; volatile _per_run_data *_perRunData; // reset for runs of the run loop pthread_t _pthread; uint32_t _winthread; CFMutableSetRef _commonModes; CFMutableSetRef _commonModeItems; CFRunLoopModeRef _currentMode; CFMutableSetRef _modes; struct _block_item *_blocks_head; struct _block_item *_blocks_tail; CFTypeRef _counterpart;&#125;; ä»å®šä¹‰ä¸­å¯ä»¥å¾—å‡ºï¼Œä¸€ä¸ªRunLoopä¾èµ–äºå¤šä¸ªModeï¼Œæ„å‘³ç€ä¸€ä¸ªRunLoopéœ€è¦å¤„ç†å¤šä¸ªäº‹åŠ¡ï¼Œå³ ä¸€ä¸ªModeå¯¹åº”å¤šä¸ªitemï¼Œè€Œä¸€ä¸ªitemåŒ…å«äº† timerã€sourceã€observerï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Modeç±»å‹å…¶ä¸­ mode åœ¨è‹¹æœæ–‡æ¡£ä¸­æåŠçš„æœ‰äº”ä¸ªï¼Œè€Œåœ¨iOSä¸­å…¬å¼€æš´éœ²å‡ºæ¥çš„åªæœ‰ NSDefaultRunLoopMode å’Œ NSRunLoopCommonModesã€‚NSRunLoopCommonModes å®é™…ä¸Šæ˜¯ä¸€ä¸ª Mode çš„é›†åˆï¼Œé»˜è®¤åŒ…æ‹¬ NSDefaultRunLoopMode å’Œ NSEventTrackingRunLoopMode NSDefaultRunLoopModeï¼šé»˜è®¤çš„ modeï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯åœ¨è¿™ä¸ªmode NSConnectionReplyMode NSModalPanelRunLoopMode NSEventTrackingRunLoopModeï¼šä½¿ç”¨è¿™ä¸ªmodeå»è·Ÿè¸ªæ¥è‡ªç”¨æˆ·äº¤äº’çš„äº‹ä»¶ï¼ˆæ¯”å¦‚UITableViewä¸Šä¸‹æ»‘åŠ¨ï¼‰ NSRunLoopCommonModesï¼šä¼ªæ¨¡å¼ï¼Œçµæ´»æ€§æ›´å¥½ Source &amp; Timer &amp; Observer sourceï¼š è¡¨ç¤ºå¯ä»¥ å”¤é†’runloopçš„ä¸€äº›äº‹ä»¶ï¼Œä¾‹å¦‚ç”¨æˆ·ç‚¹å‡»äº†å±å¹•ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªrunloopï¼Œä¸»è¦åˆ†ä¸º source0 å’Œ source1 source0 è¡¨ç¤º éç³»ç»Ÿäº‹ä»¶ï¼Œå³ç”¨æˆ·è‡ªå®šä¹‰çš„äº‹ä»¶ source1 è¡¨ç¤º ç³»ç»Ÿäº‹ä»¶ï¼Œä¸»è¦è´Ÿè´£åº•å±‚çš„é€šè®¯ï¼Œå…·å¤‡å”¤é†’èƒ½åŠ› timerï¼š å°±æ˜¯å¸¸ç”¨çš„ NSTimer å®šæ—¶å™¨ä¸€ç±» observerï¼šä¸»è¦ç”¨äºç›‘å¬runloopçš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶ä½œå‡ºä¸€å®šå“åº”ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸€äº›çŠ¶æ€ 123456789101112131415typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; //è¿›å…¥RunLoop kCFRunLoopEntry = (1UL &lt;&lt; 0), //å³å°†å¤„ç†Timers kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), //å³å°†å¤„ç†Source kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), //å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), //è¢«å”¤é†’ kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), //é€€å‡ºRunLoop kCFRunLoopExit = (1UL &lt;&lt; 7), kCFRunLoopAllActivities = 0x0FFFFFFFU&#125;; éªŒè¯ï¼šrunloopå’Œmodeæ˜¯ä¸€å¯¹å¤šä¸‹é¢ï¼Œé€šè¿‡ä¸Šé¢çš„ä»£ç è°ƒå¼æ¥éªŒè¯æˆ‘ä»¬ä¸Šé¢æåŠçš„å…³ç³» é€šè¿‡lldbå‘½ä»¤è·å– mainRunLoopã€currentRunLoop çš„ currentMode po CFRunLoopCopyCurrentMode(mainRunloop) po CFRunLoopCopyCurrentMode(currentRunloop) ä»è¿™é‡Œï¼Œå¯ä»¥è¯´æ˜ï¼Œrunloopåœ¨è¿è¡Œæ—¶çš„modeåªæœ‰ä¸€ä¸ª è·å– mainRunloop çš„æ‰€æœ‰æ¨¡å‹ï¼Œå³ po CFRunLoopCopyAllModes(mainRunloop) ä»ç»“æœå¯ä»¥éªŒè¯ runloop å’Œ CFRunloopMode å…·æœ‰ ä¸€å¯¹å¤š çš„å…³ç³» éªŒè¯ï¼šmodeå’Œitemä¹Ÿæ˜¯ä¸€å¯¹å¤š åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒåŠ æ–­ç‚¹ï¼Œé€šè¿‡btæŸ¥çœ‹å †æ ˆä¿¡æ¯ï¼Œä»è¿™é‡Œçœ‹å‡ºtimerçš„itemç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š åœ¨ runloop æºç ä¸­æŸ¥çœ‹ item ç±»å‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ blockåº”ç”¨ï¼šCFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK è°ƒç”¨timerï¼šCFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION å“åº”source0ï¼šCFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION å“åº”source1ï¼šCFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION GCDä¸»é˜Ÿåˆ—ï¼šCFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE observerï¼šCFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION åœ¨è¿™é‡Œä»¥ timer ä¸ºä¾‹ï¼Œä¸€èˆ¬åˆå§‹åŒ–timeræ—¶ï¼Œéƒ½ä¼šå°†timeré€šè¿‡ addTimer:forMode: æ–¹æ³•æ·»åŠ åˆ°runloopä¸­ï¼Œäºæ˜¯åœ¨æºç ä¸­æŸ¥æ‰¾ addTimer çš„ç›¸å…³æ–¹æ³•ï¼Œå³ CFRunLoopAddTimer æ–¹æ³•ï¼Œå…¶æºç å®ç°å¦‚ä¸‹ï¼Œå…¶å®ç°ä¸»è¦åˆ¤æ–­æ˜¯å¦æ˜¯ kCFRunLoopCommonModes ï¼Œç„¶åæŸ¥æ‰¾runloopçš„modeè¿›è¡ŒåŒ¹é…å¤„ç† å…¶ä¸­ kCFRunLoopCommonModes ä¸æ˜¯ä¸€ç§æ¨¡å¼ï¼Œæ˜¯ä¸€ç§æŠ½è±¡çš„ ä¼ªæ¨¡å¼ ï¼Œæ¯” defaultMode æ›´åŠ çµæ´» é€šè¿‡ CFSetAddValue(rl-&gt;_commonModeItems, rlt); å¯ä»¥å¾—çŸ¥ï¼Œrunloop ä¸ mode æ˜¯ ä¸€å¯¹å¤š çš„ï¼ŒåŒæ—¶å¯ä»¥å¾—å‡º mode ä¸ item ä¹Ÿæ˜¯ ä¸€å¯¹å¤š çš„ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465void CFRunLoopAddTimer(CFRunLoopRef rl, CFRunLoopTimerRef rlt, CFStringRef modeName) &#123; CHECK_FOR_FORK(); if (__CFRunLoopIsDeallocating(rl)) return; if (!__CFIsValid(rlt) || (NULL != rlt-&gt;_runLoop &amp;&amp; rlt-&gt;_runLoop != rl)) return; __CFRunLoopLock(rl); // é‡ç‚¹ : kCFRunLoopCommonModes if (modeName == kCFRunLoopCommonModes) &#123; //å¦‚æœæ˜¯kCFRunLoopCommonModes ç±»å‹ CFSetRef set = rl-&gt;_commonModes ? CFSetCreateCopy(kCFAllocatorSystemDefault, rl-&gt;_commonModes) : NULL; if (NULL == rl-&gt;_commonModeItems) &#123; rl-&gt;_commonModeItems = CFSetCreateMutable(kCFAllocatorSystemDefault, 0, &amp;kCFTypeSetCallBacks); &#125; //runloopä¸mode æ˜¯ä¸€å¯¹å¤šçš„ï¼Œ modeä¸itemä¹Ÿæ˜¯ä¸€å¯¹å¤šçš„ CFSetAddValue(rl-&gt;_commonModeItems, rlt); if (NULL != set) &#123; CFTypeRef context[2] = &#123;rl, rlt&#125;; /* add new item to all common-modes */ //æ‰§è¡Œ CFSetApplyFunction(set, (__CFRunLoopAddItemToCommonModes), (void *)context); CFRelease(set); &#125; &#125; else &#123; //å¦‚æœæ˜¯écommonModeç±»å‹ //æŸ¥æ‰¾runloopçš„æ¨¡å‹ CFRunLoopModeRef rlm = __CFRunLoopFindMode(rl, modeName, true); if (NULL != rlm) &#123; if (NULL == rlm-&gt;_timers) &#123; CFArrayCallBacks cb = kCFTypeArrayCallBacks; cb.equal = NULL; rlm-&gt;_timers = CFArrayCreateMutable(kCFAllocatorSystemDefault, 0, &amp;cb); &#125; &#125; //åˆ¤æ–­modeæ˜¯å¦åŒ¹é… if (NULL != rlm &amp;&amp; !CFSetContainsValue(rlt-&gt;_rlModes, rlm-&gt;_name)) &#123; __CFRunLoopTimerLock(rlt); if (NULL == rlt-&gt;_runLoop) &#123; rlt-&gt;_runLoop = rl; &#125; else if (rl != rlt-&gt;_runLoop) &#123; __CFRunLoopTimerUnlock(rlt); __CFRunLoopModeUnlock(rlm); __CFRunLoopUnlock(rl); return; &#125; // å¦‚æœåŒ¹é…ï¼Œåˆ™å°†runloopåŠ è¿›å»ï¼Œè€Œrunloopçš„æ‰§è¡Œä¾èµ–äº [runloop run] CFSetAddValue(rlt-&gt;_rlModes, rlm-&gt;_name); __CFRunLoopTimerUnlock(rlt); __CFRunLoopTimerFireTSRLock(); __CFRepositionTimerInMode(rlm, rlt, false); __CFRunLoopTimerFireTSRUnlock(); if (!_CFExecutableLinkedOnOrAfter(CFSystemVersionLion)) &#123; // Normally we don&#x27;t do this on behalf of clients, but for // backwards compatibility due to the change in timer handling... if (rl != CFRunLoopGetCurrent()) CFRunLoopWakeUp(rl); &#125; &#125; if (NULL != rlm) &#123; __CFRunLoopModeUnlock(rlm); &#125; &#125; __CFRunLoopUnlock(rl);&#125; RunLoopæ‰§è¡Œä¼—æ‰€å‘¨çŸ¥ï¼Œrunloopçš„æ‰§è¡Œä¾èµ–äº run æ–¹æ³•ï¼Œä»ä¸‹é¢çš„å †æ ˆä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…¶åº•å±‚æ‰§è¡Œçš„æ˜¯ __CFRunLoopRun æ–¹æ³• è¿›å…¥ __CFRunLoopRun æºç ï¼Œé’ˆå¯¹ä¸åŒçš„å¯¹è±¡ï¼Œæœ‰ä¸åŒçš„å¤„ç† å¦‚æœæœ‰ observerï¼Œåˆ™è°ƒç”¨ __CFRunLoopDoOnservers å¦‚æœæœ‰ blockï¼Œåˆ™è°ƒç”¨ __CFRunLoopDoBlocks å¦‚æœæœ‰ timerï¼Œåˆ™è°ƒç”¨ __CFRunLoopDoTimers å¦‚æœæ˜¯ source0ï¼Œåˆ™è°ƒç”¨ __CFRunLoopDoSources0 å¦‚æœæ˜¯ source1ï¼Œåˆ™è°ƒç”¨ __CFRunLoopDoSources1 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/* rl, rlm are locked on entrance and exit */static int32_t __CFRunLoopRun(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFTimeInterval seconds, Boolean stopAfterHandle, CFRunLoopModeRef previousMode) &#123; ... do&#123; ... //é€šçŸ¥ Observers: å³å°†å¤„ç†timeräº‹ä»¶ if (rlm-&gt;_observerMask &amp; kCFRunLoopBeforeTimers) __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeTimers); //é€šçŸ¥ Observers: å³å°†å¤„ç†Sourceäº‹ä»¶ if (rlm-&gt;_observerMask &amp; kCFRunLoopBeforeSources) __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeSources); //å¤„ç†Blocks __CFRunLoopDoBlocks(rl, rlm); //å¤„ç†sources0 Boolean sourceHandledThisLoop = __CFRunLoopDoSources0(rl, rlm, stopAfterHandle); //å¤„ç†sources0è¿”å›ä¸ºYES if (sourceHandledThisLoop) &#123; // å¤„ç†Blocks __CFRunLoopDoBlocks(rl, rlm); &#125; ... //å¦‚æœæ˜¯timer else if (modeQueuePort != MACH_PORT_NULL &amp;&amp; livePort == modeQueuePort) &#123; CFRUNLOOP_WAKEUP_FOR_TIMER(); if (!__CFRunLoopDoTimers(rl, rlm, mach_absolute_time())) &#123; // Re-arm the next timer, because we apparently fired early __CFArmNextTimerInMode(rlm, rl); &#125; &#125; ... //å¦‚æœæ˜¯source1 CFRunLoopSourceRef rls = __CFRunLoopModeFindSourceForMachPort(rl, rlm, livePort); if (rls) &#123;#if DEPLOYMENT_TARGET_MACOSX || DEPLOYMENT_TARGET_EMBEDDED || DEPLOYMENT_TARGET_EMBEDDED_MINI mach_msg_header_t *reply = NULL; sourceHandledThisLoop = __CFRunLoopDoSource1(rl, rlm, rls, msg, msg-&gt;msgh_size, &amp;reply) || sourceHandledThisLoop; if (NULL != reply) &#123; (void)mach_msg(reply, MACH_SEND_MSG, reply-&gt;msgh_size, 0, MACH_PORT_NULL, 0, MACH_PORT_NULL); CFAllocatorDeallocate(kCFAllocatorSystemDefault, reply); &#125;#elif DEPLOYMENT_TARGET_WINDOWS sourceHandledThisLoop = __CFRunLoopDoSource1(rl, rlm, rls) || sourceHandledThisLoop;#endif &#125; ... &#125;while (0 == retVal); ...&#125; è¿›å…¥ __CFRunLoopDoTimers æºç ï¼Œä¸»è¦æ˜¯é€šè¿‡forå¾ªç¯ï¼Œå¯¹å•ä¸ªtimerè¿›è¡Œå¤„ç† 12345678910static Boolean __CFRunLoopDoTimers(CFRunLoopRef rl, CFRunLoopModeRef rlm, uint64_t limitTSR) &#123; /* DOES CALLOUT */ ... //å¾ªç¯éå†ï¼Œåšä¸‹å±‚å•ä¸ªtimerçš„æ‰§è¡Œ for (CFIndex idx = 0, cnt = timers ? CFArrayGetCount(timers) : 0; idx &lt; cnt; idx++) &#123; CFRunLoopTimerRef rlt = (CFRunLoopTimerRef)CFArrayGetValueAtIndex(timers, idx); Boolean did = __CFRunLoopDoTimer(rl, rlm, rlt); timerHandled = timerHandled || did; &#125; ...&#125; è¿›å…¥ __CFRunLoopDoTimer æºç ï¼Œä¸»è¦é€»è¾‘æ˜¯ timer æ‰§è¡Œå®Œæ¯•åï¼Œä¼šä¸»åŠ¨è°ƒç”¨ __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ å‡½æ•°ï¼Œæ­£å¥½ä¸timerå †æ ˆè°ƒç”¨çš„ä¸€è‡´ 123456// mode and rl are locked on entry and exitstatic Boolean __CFRunLoopDoTimer(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFRunLoopTimerRef rlt) &#123; ... __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__(rlt-&gt;_callout, rlt, context_info); ...&#125; timeræ‰§è¡Œæ€»ç»“ ä¸ºè‡ªå®šä¹‰çš„timerï¼Œè®¾ç½®modeï¼Œå¹¶å°†å…¶åŠ å…¥ runloop ä¸­ åœ¨runloopçš„ run æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œä¼šè°ƒç”¨ __CFRunLoopDoTimers æ‰§è¡Œæ‰€æœ‰çš„timer åœ¨ __CFRunLoopDoTimers æ–¹æ³•ä¸­ï¼Œä¼šé€šè¿‡forå¾ªç¯æ‰§è¡Œå•ä¸ªtimerçš„æ“ä½œ åœ¨ __CFRunLoopDoTimer æ–¹æ³•ä¸­ï¼Œtimeræ‰§è¡Œå®Œæ¯•åï¼Œä¼šæ‰§è¡Œå¯¹åº”çš„timerå›è°ƒå‡½æ•° ä»¥ä¸Šï¼Œæ˜¯é’ˆå¯¹ timer çš„æ‰§è¡Œåˆ†æï¼Œå¯¹äº observerã€blockã€source0ã€source1ï¼Œå…¶æ‰§è¡ŒåŸç†ä¸timeræ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å†é‡å¤è¯´æ˜ï¼Œä¸€ä¸‹æ˜¯ è‹¹æœå®˜æ–¹æ–‡æ¡£ é’ˆå¯¹runloopå¤„ç†ä¸åŒæºçš„å›¾ç¤ºï¼š RunLoopåº•å±‚ç®¡ç†ä»ä¸Šè¿°çš„å †æ ˆä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œrunåœ¨åº•å±‚çš„å®ç°è·¯å¾„ä¸º CFRunLoopRun -&gt; CFRunLoopRun -&gt; __CFRunLoopRun 12345678void CFRunLoopRun(void) &#123; /* DOES CALLOUT */ int32_t result; do &#123; // 1.0e10 : ç§‘å­¦æŠ€æœ¯ 1*10^10 result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false); CHECK_FOR_FORK(); &#125; while (kCFRunLoopRunStopped != result &amp;&amp; kCFRunLoopRunFinished != result);&#125; è¿›å…¥ CFRunLoopRunSpecific æºç ï¼Œï¼Œé¦–å…ˆæ ¹æ®modeNameæ‰¾åˆ°å¯¹åº”çš„modeï¼Œç„¶åä¸»è¦åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š å¦‚æœæ˜¯ entryï¼Œåˆ™é€šçŸ¥observerï¼Œå³å°† è¿›å…¥runloop å¦‚æœæ˜¯ exitï¼Œåˆ™é€šè¿‡observerï¼Œå³å°† é€€å‡ºrunloop å¦‚æœæ˜¯å…¶ä»–ä¸­é—´çŠ¶æ€ï¼Œä¸»è¦æ˜¯é€šè¿‡runloopå¤„ç†å„ç§æº å…¶ä¼ªä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š 1234567891011121314151617181920SInt32 CFRunLoopRunSpecific(CFRunLoopRef rl, CFStringRef modeName, CFTimeInterval seconds, Boolean returnAfterSourceHandled) &#123; /* DOES CALLOUT */ CHECK_FOR_FORK(); if (__CFRunLoopIsDeallocating(rl)) return kCFRunLoopRunFinished; __CFRunLoopLock(rl); //é¦–å…ˆæ ¹æ®modeNameæ‰¾åˆ°å¯¹åº”mode CFRunLoopModeRef currentMode = __CFRunLoopFindMode(rl, modeName, false); // é€šçŸ¥ Observers: RunLoop å³å°†è¿›å…¥ loopã€‚ __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopEntry); // å†…éƒ¨å‡½æ•°ï¼Œè¿›å…¥loop result = __CFRunLoopRun(rl, currentMode, seconds, returnAfterSourceHandled, previousMode); // é€šçŸ¥ Observers: RunLoop å³å°†é€€å‡ºã€‚ __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit); return result; &#125; è¿›å…¥ __CFRunLoopRun æºç ï¼Œç”±äºè¿™éƒ¨åˆ†ä»£ç è¾ƒå¤šï¼Œäºæ˜¯è¿™é‡Œç”¨ä¼ªä»£ç ä»£æ›¿ã€‚å…¶ä¸»è¦é€»è¾‘æ˜¯ æ ¹æ®ä¸åŒçš„äº‹ä»¶æºè¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œå½“RunLoopä¼‘çœ æ—¶ï¼Œå¯ä»¥é€šè¿‡ç›¸åº”çš„äº‹ä»¶å”¤é†’RunLoop 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788//æ ¸å¿ƒå‡½æ•°/* rl, rlm are locked on entrance and exit */static int32_t __CFRunLoopRun(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFTimeInterval seconds, Boolean stopAfterHandle, CFRunLoopModeRef previousMode)&#123; //é€šè¿‡GCDå¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç„¶åå¼€å§‹è·‘åœˆ dispatch_source_t timeout_timer = NULL; ... dispatch_resume(timeout_timer); int32_t retVal = 0; //å¤„ç†äº‹åŠ¡,å³å¤„ç†items do &#123; // é€šçŸ¥ Observers: å³å°†å¤„ç†timeräº‹ä»¶ __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeTimers); // é€šçŸ¥ Observers: å³å°†å¤„ç†Sourceäº‹ä»¶ __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeSources) // å¤„ç†Blocks __CFRunLoopDoBlocks(rl, rlm); // å¤„ç†sources0 Boolean sourceHandledThisLoop = __CFRunLoopDoSources0(rl, rlm, stopAfterHandle); // å¤„ç†sources0è¿”å›ä¸ºYES if (sourceHandledThisLoop) &#123; // å¤„ç†Blocks __CFRunLoopDoBlocks(rl, rlm); &#125; // åˆ¤æ–­æœ‰æ— ç«¯å£æ¶ˆæ¯(Source1) if (__CFRunLoopWaitForMultipleObjects(NULL, &amp;dispatchPort, 0, 0, &amp;livePort, NULL)) &#123; // å¤„ç†æ¶ˆæ¯ goto handle_msg; &#125; // é€šçŸ¥ Observers: å³å°†è¿›å…¥ä¼‘çœ  __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeWaiting); __CFRunLoopSetSleeping(rl); // ç­‰å¾…è¢«å”¤é†’ __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort, poll ? 0 : TIMEOUT_INFINITY); // user callouts now OK again __CFRunLoopUnsetSleeping(rl); // é€šçŸ¥ Observers: è¢«å”¤é†’ï¼Œç»“æŸä¼‘çœ  __CFRunLoopDoObservers(rl, rlm, kCFRunLoopAfterWaiting); handle_msg: if (è¢«timerå”¤é†’) &#123; // å¤„ç†Timers __CFRunLoopDoTimers(rl, rlm, mach_absolute_time())ï¼› &#125;else if (è¢«GCDå”¤é†’)&#123; // å¤„ç†gcd __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg); &#125;else if (è¢«source1å”¤é†’)&#123; // è¢«Source1å”¤é†’ï¼Œå¤„ç†Source1 __CFRunLoopDoSource1(rl, rlm, rls, msg, msg-&gt;msgh_size, &amp;reply) &#125; // å¤„ç†block __CFRunLoopDoBlocks(rl, rlm); if (sourceHandledThisLoop &amp;&amp; stopAfterHandle) &#123; retVal = kCFRunLoopRunHandledSource;//å¤„ç†æº &#125; else if (timeout_context-&gt;termTSR &lt; mach_absolute_time()) &#123; retVal = kCFRunLoopRunTimedOut;//è¶…æ—¶ &#125; else if (__CFRunLoopIsStopped(rl)) &#123; __CFRunLoopUnsetStopped(rl); retVal = kCFRunLoopRunStopped;//åœæ­¢ &#125; else if (rlm-&gt;_stopped) &#123; rlm-&gt;_stopped = false; retVal = kCFRunLoopRunStopped;//åœæ­¢ &#125; else if (__CFRunLoopModeIsEmpty(rl, rlm, previousMode)) &#123; retVal = kCFRunLoopRunFinished;//ç»“æŸ &#125; &#125;while (0 == retVal); return retVal;&#125; æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼ŒRunLoopçš„æ‰§è¡Œæµç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ç›¸å…³é¢è¯•é¢˜AutoreleasePoolç›¸å…³é¢è¯•é¢˜1ï¼šä¸´æ—¶å˜é‡ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ å¦‚æœåœ¨ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€èˆ¬æ˜¯ è¶…å‡ºä½œç”¨åŸŸå°±ä¼šç«‹å³é‡Šæ”¾ å¦‚æœå°†ä¸´æ—¶å˜é‡åŠ å…¥äº† è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä¼šå»¶è¿Ÿé‡Šæ”¾ï¼Œå³åœ¨ runloopä¼‘çœ /è¶…å‡ºautoreleasePoolä½œç”¨åŸŸä¹‹åä¼šé‡Šæ”¾ é¢è¯•é¢˜2ï¼šAutoreleasePoolåŸç† è‡ªåŠ¨é‡Šæ”¾æ± çš„æœ¬è´¨æ˜¯ä¸€ä¸ª autoreleasePoolPageç»“æ„ä½“å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ª æ ˆç»“æ„å­˜å‚¨çš„é¡µï¼Œæ¯ä¸€ä¸ª autoreleasePoolPage éƒ½æ˜¯ä»¥ åŒå‘é“¾è¡¨ çš„å½¢å¼é“¾æ¥ è‡ªåŠ¨é‡Šæ”¾æ± çš„ å‹æ ˆ å’Œ å‡ºæ ˆ ä¸»è¦æ˜¯é€šè¿‡ç»“æ„ä½“çš„ æ„é€ å‡½æ•° å’Œ ææ„å‡½æ•° è°ƒç”¨åº•å±‚çš„ objc_autoreleasePoolPush å’Œ objc_autoreleasePoolPopï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ autoreleasePoolPage çš„ push å’Œ pop ä¸¤ä¸ªæ–¹æ³• æ¯æ¬¡è°ƒç”¨ push æ“ä½œå…¶å®å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ autoreleasePoolPageï¼Œè€Œ autoreleasePoolPage çš„å…·ä½“æ“ä½œå°±æ˜¯æ’å…¥ä¸€ä¸ª POOL_BOUNDARY,å¹¶è¿”å›æ’å…¥ POOL_BOUNDARY çš„å†…å­˜åœ°å€ã€‚è€Œ push å†…éƒ¨è°ƒç”¨ autoreleaseFast æ–¹æ³•å¤„ç†ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µ å½“ pageå­˜åœ¨ä¸”ä¸æ»¡ æ—¶ï¼Œè°ƒç”¨addæ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³pageçš„nextæŒ‡é’ˆå¤„ï¼Œå¹¶nexté€’å¢ å½“ pageå­˜åœ¨ä¸”å·²æ»¡ æ—¶ï¼Œè°ƒç”¨ autoreleaseFullPage åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„pageï¼Œç„¶åè°ƒç”¨addæ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³pageæ ˆä¸­ å½“ pageä¸å­˜åœ¨ æ—¶ï¼Œè°ƒç”¨ autoreleaseNoPage åˆ›å»ºä¸€ä¸ªhotPageï¼Œç„¶åè°ƒç”¨addæ–¹æ³•å°†å¯¹è±¡æ·»åŠ è‡³pageæ ˆä¸­ å½“æ‰§è¡Œ pop æ—¶ï¼Œä¼šä¼ å…¥ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯pushæ“ä½œçš„è¿”å›å€¼ï¼Œå³ POOL_BOUNDARY çš„å†…å­˜åœ°å€ tokenï¼Œæ‰€ä»¥popå†…éƒ¨çš„å®ç°å°±æ˜¯æ ¹æ®tokenæ‰¾åˆ°å“¨å…µå¯¹è±¡æ‰€å¤„çš„pageä¸­ï¼Œç„¶åä½¿ç”¨ objc_release é‡Šæ”¾tokenä¹‹å‰çš„å¯¹è±¡ï¼Œå¹¶æŠŠnextæŒ‡é’ˆæŒ‡åˆ°æ­£ç¡®çš„ä½ç½® é¢è¯•é¢˜3ï¼šautoreleasePoolèƒ½å¦åµŒå¥—ä½¿ç”¨ï¼Ÿ å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œå…¶ç›®çš„æ˜¯å¯ä»¥ æ§åˆ¶åº”ç”¨ç¨‹åºçš„å†…å­˜å³°å€¼ï¼Œä½¿å…¶ä¸è¦å¤ªé«˜ å¯ä»¥åµŒå¥—çš„åŸå› æ˜¯å› ä¸ºè‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä»¥æ ˆä¸ºèŠ‚ç‚¹ï¼Œé€šè¿‡åŒå‘é“¾è¡¨çš„å½¢å¼é“¾æ¥çš„ï¼Œä¸”æ˜¯å’Œçº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ è‡ªåŠ¨é‡Šæ”¾æ± çš„ å¤šå±‚åµŒå¥— å…¶å®å°±æ˜¯ä¸åœçš„ pushå“¨å…µå¯¹è±¡ï¼Œåœ¨popæ—¶ï¼Œä¼šå…ˆé‡Šæ”¾é‡Œé¢çš„ï¼Œåœ¨é‡Šæ”¾å¤–é¢çš„ é¢è¯•é¢˜4ï¼šå“ªäº›å¯¹è±¡å¯ä»¥åŠ å…¥autoreleasePoolï¼Ÿallocåˆ›å»ºå¯ä»¥å—ï¼Ÿ ä½¿ç”¨ allocã€newã€copy å…³é”®å­—ç”Ÿæˆçš„å¯¹è±¡å’Œ retain äº†çš„å¯¹è±¡ éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œä¸ä¼šè¢«æ·»åŠ åˆ°è‡ªåŠ¨é‡Šæ”¾æ±  è®¾ç½®ä¸º autorelease çš„å¯¹è±¡ ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼Œä¼šç›´æ¥è¿›å…¥è‡ªåŠ¨é‡Šæ”¾æ±  æ‰€æœ‰ autorelease çš„å¯¹è±¡ï¼Œåœ¨å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æœ€è¿‘åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ é¢è¯•é¢˜5ï¼šautoreleasePoolçš„é‡Šæ”¾å®é™…æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ APPå¯åŠ¨åï¼Œè‹¹æœä¸»çº¿ç¨‹ runloop é‡Œé¢æ³¨å†Œäº†ä¸¤ä¸ª observerï¼Œå…¶å›è°ƒéƒ½æ˜¯ _wrapRunLoopWithAutoreleasePoolHandler()ã€‚ ç¬¬ä¸€ä¸ª observer ç›‘è§†çš„äº‹ä»¶æ˜¯ Entryï¼ˆå³å°†é”®å…¥loopï¼‰ï¼Œå…¶å›è°ƒå†…ä¼šè°ƒç”¨ _objc_autoreleasePoolPush() åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå…¶ order æ˜¯ -2147483647ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯åˆ›å»ºé‡Šæ”¾æ± å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹å‰ ç¬¬äºŒä¸ª observer ç›‘è§†äº†ä¸¤ä¸ªäº‹ä»¶ï¼šBeforeWaiting(å‡†å¤‡è¿›å…¥ä¼‘çœ )æ—¶ è°ƒç”¨_objc_autoreleasePoolPop() å’Œ _objc_autoreleasePoolPush() é‡Šæ”¾æ—§çš„æ± åˆ›å»ºæ–°çš„æ± å­ã€‚ Exitï¼ˆå³é€€å‡ºloopï¼‰æ—¶è°ƒç”¨ _objc_autoreleasePoolPop()æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™ä¸ªobserverçš„orderæ˜¯214748647ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œä¿è¯å…¶é‡Šæ”¾æ± å­å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹åã€‚ é¢è¯•é¢˜6ï¼šthreadå’ŒautoreleasePoolçš„å…³ç³»ï¼Ÿåœ¨ å®˜æ–¹æ–‡æ¡£ ä¸­ï¼Œæ‰¾åˆ°å¦‚ä¸‹è¯´æ˜ï¼š 1Each thread (including the main thread) maintains its own stack of NSAutoreleasePool objects (see Threads). As new pools are created, they get added to the top of the stack. When pools are deallocated, they are removed from the stack. Autoreleased objects are placed into the top autorelease pool for the current thread. When a thread terminates, it automatically drains all of the autorelease pools associated with itself. å¤§è‡´æ„æ€æ˜¯ï¼š æ¯ä¸ªçº¿ç¨‹ï¼ŒåŒ…æ‹¬ ä¸»çº¿ç¨‹ åœ¨å†…éƒ½ç»´æŠ¤äº† è‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± å †æ ˆç»“æ„ æ–°çš„ è‡ªåŠ¨é‡Šæ”¾æ± åœ¨è¢«åˆ›å»ºæ—¶ï¼Œä¼šè¢«æ·»åŠ åˆ° æ ˆé¡¶ï¼Œå½“è‡ªåŠ¨é‡Šæ”¾æ±  é”€æ¯æ—¶ï¼Œä¼š ä»æ ˆä¸­ç§»é™¤ å¯¹äº å½“å‰çº¿ç¨‹ æ¥è¯´ï¼Œä¼š å°†è‡ªåŠ¨é‡Šæ”¾æ± çš„å¯¹è±¡ æ”¾å…¥è‡ªåŠ¨é‡Šæ”¾æ± çš„ æ ˆé¡¶ï¼Œåœ¨çº¿ç¨‹åœæ­¢æ—¶ï¼Œä¼š è‡ªåŠ¨é‡Šæ”¾æ‰ä¸è¯¥çº¿ç¨‹ç›¸å…³è”çš„æ‰€æœ‰è‡ªåŠ¨é‡Šæ”¾æ±  æ€»ç»“ï¼š æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸ä¹‹å…³è”çš„è‡ªåŠ¨é‡Šæ”¾æ± å †æ ˆç»“æ„ï¼Œæ–°çš„poolåœ¨åˆ›å»ºæ—¶ä¼šè¢«å‹æ ˆåˆ°æ ˆé¡¶ï¼Œpoolé”€æ¯æ—¶ï¼Œä¼šè¢«å‡ºæ ˆï¼Œå¯¹äºå½“å‰çº¿ç¨‹æ¥è¯´ï¼Œé‡Šæ”¾å¯¹è±¡ä¼šè¢«å‹æ ˆåˆ°æ ˆé¡¶ï¼Œçº¿ç¨‹åœæ­¢æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾ä¸ä¹‹ç›¸å…³è”çš„è‡ªåŠ¨é‡Šæ”¾æ±  é¢è¯•é¢˜7ï¼šrunloopå’Œautoreleaseçš„å…³ç³»åœ¨ å®˜æ–¹æ–‡æ¡£ ä¸­ï¼Œæ‰¾åˆ°å¦‚ä¸‹è¯´æ˜ 1The Application Kit creates an autorelease pool on the main thread at the beginning of every cycle of the event loop, and drains it at the end, thereby releasing any autoreleased objects generated while processing an event. å¤§è‡´æ„æ€å¦‚ä¸‹ï¼š ä¸»çº¿ç¨‹çš„ runloop åœ¨æ¯æ¬¡äº‹ä»¶å¾ªç¯ä¹‹å‰ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª autoreleasePool å¹¶ä¸”ä¼šåœ¨ äº‹ä»¶å¾ªç¯ ç»“æŸæ—¶ï¼Œæ‰§è¡Œ drain æ“ä½œï¼Œé‡Šæ”¾å…¶ä¸­çš„å¯¹è±¡ RunLoopç›¸å…³é¢è¯•é¢˜1ï¼šå½“å‰æœ‰ä¸ªå­çº¿ç¨‹ï¼Œå­çº¿ç¨‹ä¸­æœ‰ä¸ªtimerï¼Œtimeræ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œï¼Œå¹¶è¿›è¡ŒæŒç»­å¤§æ‰“å°ï¼Ÿ1234567891011121314151617ZJThread *thread = [[ZJThread alloc] initWithBlock:^&#123; // thread.name = nil å› ä¸ºè¿™ä¸ªå˜é‡åªæ˜¯æ•æ‰ // ZJThread *thread = nil // thread = åˆå§‹åŒ– æ•æ‰ä¸€ä¸ªnilè¿›æ¥ NSLog(@&quot;%@---%@&quot;,[NSThread currentThread],[[NSThread currentThread] name]); [NSTimer scheduledTimerWithTimeInterval:1 repeats:YES block:^(NSTimer * _Nonnull timer) &#123; NSLog(@&quot;hello word&quot;); // é€€å‡ºçº¿ç¨‹--ç»“æœrunloopä¹Ÿåœæ­¢äº† if (self.isStopping) &#123; [NSThread exit]; &#125; &#125;]; &#125;]; thread.name = @&quot;lgcode.com&quot;; [thread start]; ä¸å¯ä»¥ï¼Œå› ä¸º å­çº¿ç¨‹çš„runloopé»˜è®¤æ˜¯ä¸å¯åŠ¨çš„ï¼Œéœ€è¦ runloop run å¯åŠ¨ï¼Œéœ€è¦å°†ä¸Šè¿°ä»£ç æ”¹æˆä¸‹é¢ï¼š 123456789101112131415161718ZJThread *thread = [[ZJThread alloc] initWithBlock:^&#123; // thread.name = nil å› ä¸ºè¿™ä¸ªå˜é‡åªæ˜¯æ•æ‰ // ZJThread *thread = nil // thread = åˆå§‹åŒ– æ•æ‰ä¸€ä¸ªnilè¿›æ¥ NSLog(@&quot;%@---%@&quot;,[NSThread currentThread],[[NSThread currentThread] name]); [NSTimer scheduledTimerWithTimeInterval:1 repeats:YES block:^(NSTimer * _Nonnull timer) &#123; NSLog(@&quot;hello word&quot;); // é€€å‡ºçº¿ç¨‹--ç»“æœrunloopä¹Ÿåœæ­¢äº† if (self.isStopping) &#123; [NSThread exit]; &#125; &#125;]; [[NSRunLoop currentRunLoop] run]; &#125;]; thread.name = @&quot;lgcode.com&quot;; [thread start]; é¢è¯•é¢˜2ï¼šrunloopå’Œçº¿ç¨‹çš„å…³ç³» æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„runloopï¼Œæ‰€ä»¥ runloopä¸çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå…¶ç»‘å®šå…³ç³»é€šè¿‡ä¸€ä¸ª å…¨å±€çš„Dictionaryå­˜å‚¨ï¼Œçº¿ç¨‹ä¸º keyï¼Œrunloopä¸º value çº¿ç¨‹ä¸­çš„runloopä¸»è¦ç”¨æ¥é‡Œçº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹runloopå¼€å¯åï¼Œä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åè¿›è¡Œä¼‘çœ çŠ¶æ€ï¼Œå½“æœ‰äº‹ä»¶è§¦å‘å”¤é†’æ—¶ï¼Œåˆå¼€å§‹å·¥ä½œï¼Œå³ æœ‰æ´»æ—¶å¹²æ´»ï¼Œæ²¡æ´»å°±ä¼‘æ¯ã€‚ ä¸»çº¿ç¨‹ çš„ runloop æ˜¯ é»˜è®¤å¼€å¯çš„ï¼Œåœ¨ç¨‹åºå¯åŠ¨ä¹‹åï¼Œä¼šä¸€ç›´è¿è¡Œï¼Œä¸ä¼šé€€å‡º å…¶ä»–çº¿ç¨‹çš„ runloopé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™æ‰‹åŠ¨å¼€å¯ é¢è¯•é¢˜3ï¼šNSRunLoop å’Œ CFRunLoopRefåŒºåˆ« NSRunLoop æ˜¯ åŸºäºCFRunLoopRef é¢å‘å¯¹è±¡çš„ APIï¼Œæ˜¯ ä¸å®‰å…¨ çš„ã€‚ CFRunLoopRef æ˜¯ åŸºäºC è¯­è¨€çš„ï¼Œæ˜¯ çº¿ç¨‹å®‰å…¨ çš„ é¢è¯•é¢˜4ï¼šRunLoopçš„modeä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿmode ä¸»è¦æ˜¯ç”¨äºæŒ‡å®šrunloopä¸­äº‹ä»¶ä¼˜å…ˆçº§çš„ é¢è¯•é¢˜5ï¼šä»¥ +scheduledTimerWithTimeInterval: çš„æ–¹å¼è§¦å‘çš„timerï¼Œåœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ©æ¶¦è¡¨æ—¶ï¼Œtimerä¼šæš‚åœå›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ timeråœæ­¢çš„åŸå› æ˜¯å› ä¸ºæ»‘åŠ¨ scrollView æ—¶ï¼Œä¸»çº¿ç¨‹çš„runloopä¼šä» NSDefaultRunLoopMode åˆ‡æ¢åˆ° NSTrackingRunLoopMode ï¼Œè€Œ timer æ˜¯æ·»åŠ åœ¨ NSDefaultRunLoopMode ä¸Šçš„ï¼Œæ‰€ä»¥timerä¸ä¼šæ‰§è¡Œ å°† timer æ”¾å…¥ NSRunLoopCommonModes ä¸­æ‰§è¡Œ","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†36ï¼šå†…å­˜ç®¡ç†ï¼ˆäºŒï¼‰å¼·å¼•ç”¨åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†36ï¼šå†…å­˜ç®¡ç†ï¼ˆäºŒï¼‰å¼·å¼•ç”¨åˆ†æ","date":"2021-05-29T06:48:15.000Z","updated":"2022-04-13T06:42:35.000Z","comments":true,"path":"2021/05/29/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†36ï¼šå†…å­˜ç®¡ç†ï¼ˆäºŒï¼‰å¼·å¼•ç”¨åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2021/05/29/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8636%EF%BC%9A%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89%E5%BC%B7%E5%BC%95%E7%94%A8%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦æ˜¯é€šè¿‡ å®šæ—¶å™¨ æ¥æ¢³ç† å¼ºå¼•ç”¨ çš„å‡ ç§è§£å†³æ–¹æ¡ˆ å¼·åº”ç”¨ï¼ˆå¼·æŒæœ‰ï¼‰å‡è®¾æœ‰ Aå’ŒB ä¸¤ä¸ªé¡µé¢ï¼Œä»A push åˆ°Bé¡µé¢ï¼Œåœ¨Bé¡µé¢ä¸­æœ‰å¦‚ä¸‹å®šæ—¶å™¨ä»£ç ï¼Œå½“ä»B pop å›åˆ°Aç•Œé¢æ—¶ï¼Œå‘ç°å®šæ—¶å™¨æ²¡æœ‰åœæ­¢ï¼Œå…¶æ–¹æ³•ä»ç„¶åœ¨æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆï¼Ÿ 12self.timer = [NSTimer timerWithTimeInterval:1 target:self selector:@selector(fireHome) userInfo:nil repeats:YES];[[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes]; å…¶ä¸»è¦åŸå› æ˜¯ Bé¡µé¢æ²¡æœ‰é‡Šæ”¾ï¼Œå³ æ²¡æœ‰æ‰§è¡Œdeallocæ–¹æ³•ï¼Œå¯¼è‡´timerä¹Ÿæ— æ³•åœæ­¢å’Œé‡Šæ”¾ è§£å†³æ–¹å¼ä¸€ é‡å†™ didMoveParentViewController æ–¹æ³• 123456789- (void)didMoveToParentViewController:(UIViewController *)parent&#123; // æ— è®ºpush è¿›æ¥ è¿˜æ˜¯ pop å‡ºå» æ­£å¸¸è·‘ // å°±ç®—ç»§ç»­push åˆ°ä¸‹ä¸€å±‚ pop å›å»è¿˜æ˜¯ç»§ç»­ if (parent == nil) &#123; [self.timer invalidate]; self.timer = nil; NSLog(@&quot;timer èµ°äº†&quot;); &#125;&#125; è§£å†³æ–¹å¼äºŒ å®šä¹‰timeræ—¶ï¼Œé‡‡ç”¨ é—­åŒ… çš„å½¢å¼ï¼Œå› æ­¤ä¸éœ€è¦æŒ‡å®štarget 12345- (void)blockTimer&#123; self.timer = [NSTimer scheduledTimerWithTimeInterval:1 repeats:YES block:^(NSTimer * _Nonnull timer) &#123; NSLog(@&quot;timer fire - %@&quot;,timer); &#125;];&#125; ç°åœ¨ï¼Œæˆ‘ä»¬ä»åº•å±‚æ¥æ·±å…¥ç ”ç©¶ï¼Œä¸ºä»€ä¹ˆ B é¡µé¢æœ‰äº† timer ä¹‹åï¼Œå¯¼è‡´ B é¡µé¢é‡Šæ”¾ä¸æ‰ï¼Œå³ä¸ä¼šèµ°åˆ° dealloc æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ timerWithTimeInterval:target:selector:userInfo:repeats: æ–¹æ³•ä¸­å¯¹targetçš„æè¿° ä»æ–‡æ¡£ä¸­å¯ä»¥çœ‹å‡ºï¼Œtimerå¯¹ä¼ å…¥çš„targetå…·æœ‰å¼·æŒæœ‰ï¼Œå³ timer æŒæœ‰ selfã€‚ç”±äºtimeræ˜¯å®šä¹‰åœ¨Bé¡µé¢ä¸­ï¼Œæ‰€ä»¥ selfä¹ŸæŒæœ‰timerï¼Œå› æ­¤ self- &gt; timer -&gt; self æ„æˆäº† å¾ªç¯å¼•ç”¨ åœ¨ OCåº•å±‚åŸç†30ï¼šBlockåº•å±‚åŸç† æ–‡ç« ä¸­ï¼Œé’ˆå¯¹å¾ªç¯å¼•ç”¨æä¾›äº†å‡ ç§è§£å†³æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡ __weak å³ å¼±å¼•ç”¨ æ¥è§£å†³ï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š 123__weak typeof(self) weakSelf = self;self.timer = [NSTimer timerWithTimeInterval:1 target:weakSelf selector:@selector(fireHome) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes]; æˆ‘ä»¬å†æ¬¡è¿è¡Œç¨‹åºï¼Œè¿è¡Œ push-pop è·³è½¬ï¼Œå‘ç° é—®é¢˜è¿˜æ˜¯å­˜åœ¨ï¼Œå³å®šæ—¶å™¨æ–¹æ³•ä»ç„¶åœ¨æ‰§è¡Œï¼Œå¹¶ æ²¡æœ‰æ‰§è¡ŒBçš„deallocæ–¹æ³•ï¼Œä¸ºä»€ä¹ˆå‘¢? æˆ‘ä»¬ä½¿ç”¨ __weak è™½ç„¶æ‰“ç ´äº† self -&gt; timer -&gt; self ä¹‹å‰çš„å¾ªç¯å¼•ç”¨ï¼Œå³å¼•ç”¨é“¾å˜æˆäº† self -&gt; timer -&gt; weakSelf -&gt; selfã€‚ä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬åˆ†æçš„å¹¶ä¸å…¨é¢ï¼Œæ­¤æ—¶è¿˜æœ‰ä¸€ä¸ª Runloopå¯¹timerçš„å¼·æŒæœ‰ï¼Œå› ä¸º Runloop çš„ ç”Ÿå‘½å‘¨æœŸ æ¯” B é¡µé¢ æ›´é•¿ï¼Œæ‰€ä»¥å¯¼è‡´äº† timeræ— æ³•é‡Šæ”¾ï¼ŒåŒæ—¶ä¹Ÿå¯¼è‡´äº† B é¡µé¢çš„ selfä¹Ÿæ— æ³•é‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œæœ€åˆå¼•ç”¨é“¾ åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š åŠ ä¸Š weakSelf ä¹‹åï¼Œå˜æˆäº†è¿™æ · weakSelf ä¸ self å¯¹äº weakSelf å’Œ self ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç–‘é—®ï¼Ÿ weakSelf ä¼šå¯¹å¼•ç”¨è®¡æ•°è¿›è¡Œ +1 æ“ä½œä¹ˆï¼Ÿ weakSelf å’Œ self çš„æŒ‡é’ˆåœ°å€ç›¸åŒä¹ˆï¼Ÿæ˜¯æŒ‡å‘åŒä¸€ç‰‡å†…å­˜ä¹ˆï¼Ÿ å¸¦ç€ç–‘é—®ï¼Œæˆ‘ä»¬åœ¨ weakSelf å‰åæ‰“å° self çš„å¼•ç”¨è®¡æ•° å› æ­¤å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šweakSelfæ²¡æœ‰å¯¹å†…å­˜è¿›è¡Œ+1æ“ä½œ ç»§ç»­æ‰“å° weakSelf å’Œ self å¯¹è±¡ï¼Œä»¥åŠæŒ‡é’ˆåœ°å€ 12345po weakSelfpo selfp &amp;weakSelfp &amp;self æ‰“å°ç»“æœå¦‚ä¸‹ ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå½“å‰ self å–åœ°å€å’Œ weakSelf å–åœ°å€çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚æ„å‘³ç€ ä¸¤ä¸ªæŒ‡é’ˆåœ°å€ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œå³ weakSelfå’Œselfçš„å†…å­˜åœ°å€æ˜¯ä¸ä¸€æ ·çš„ï¼Œéƒ½æŒ‡å‘åŒä¸€ç‰‡å†…å­˜ç©ºé—´ çš„ ä»ä¸Šé¢æ‰“å°å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶ timer æ•è·çš„æ˜¯ &lt;LGTimerViewController: 0x102c04dd0&gt; ï¼Œæ˜¯ä¸€ä¸ª å¯¹è±¡ï¼Œæ‰€ä»¥ æ— æ³•é€šè¿‡weakSelfæ¥è§£å†³å¼·æŒæœ‰ã€‚å³å¼•ç”¨é“¾å…³ç³»ä¸º ï¼šNSRunloop -&gt; timer -&gt; weakSelf(&lt;LGTimerViewController: 0x102c04dd0&gt;) ã€‚æ‰€ä»¥ RunLoopå¯¹æ•´ä¸ªå¯¹è±¡çš„ç©ºé—´æœ‰å¼·æŒæœ‰ï¼Œrunloopæ²¡åœï¼Œtimer å’Œ weakSelf æ˜¯æ— æ³•é‡Šæ”¾çš„ è€Œæˆ‘ä»¬åœ¨ block åŸç†ä¸­æåŠçš„ blockå¾ªç¯å¼•ç”¨ï¼Œä¸ timer æ˜¯ æœ‰åŒºåˆ« çš„ã€‚é€šè¿‡blockåº•å±‚åŸç†çš„æ–¹æ³• __Block_object_assign å¯çŸ¥ï¼Œblockæ•è·çš„æ˜¯ å¯¹è±¡çš„æŒ‡é’ˆåœ°å€ï¼Œå³ weakSelfæ˜¯ä¸´æ—¶å˜é‡çš„æŒ‡é’ˆåœ°å€ï¼Œè·Ÿ self æ²¡æœ‰å…³ç³»ï¼Œå› ä¸º weakSelfæ˜¯æ–°çš„åœ°å€ç©ºé—´ã€‚æ‰€ä»¥æ­¤æ—¶çš„weakSelfç›¸å½“äºä¸­é—´å€¼ã€‚å…¶å¼•ç”¨å…³ç³»é“¾ä¸º self -&gt; block -&gt; weakSelf(ä¸´æ—¶å˜é‡çš„æŒ‡é’ˆåœ°å€)ï¼Œå¯ä»¥é€šè¿‡ åœ°å€ æ‹¿åˆ° æŒ‡é’ˆ æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ«ä¸‹ block å’Œ timer å¾ªç¯å¼•ç”¨çš„æ¨¡å‹ timeræ¨¡å‹ï¼šself -&gt; timer -&gt; weakSelf -&gt; selfï¼Œå½“å‰çš„ timer æ•è·çš„æ˜¯ Bé¡µé¢çš„å†…å­˜ï¼Œå³vcå¯¹è±¡çš„å†…å­˜ï¼Œå³ weakSelfè¡¨ç¤ºçš„æ˜¯vcå¯¹è±¡ blockæ¨¡å‹ï¼šself -&gt; block -&gt; weakSelf -&gt; selfï¼Œå½“å‰çš„blockæ•è·çš„æ˜¯ æŒ‡é’ˆåœ°å€ï¼Œå³ weakSelf è¡¨ç¤ºçš„æ˜¯ æŒ‡å‘selfçš„ä¸´æ—¶å˜é‡çš„æŒ‡é’ˆåœ°å€ è§£å†³ å¼·å¼•ç”¨ï¼ˆå¼·æŒæœ‰ï¼‰æœ‰ä»¥ä¸‹å‡ ç§è§£å†³æ€è·¯ï¼šä¾èµ– ä¸­ä»‹è€…æ¨¡å¼ã€æ‰“ç ´å¼·æŒæœ‰ï¼Œå…¶ä¸­ æ¨èæ€è·¯å›› æ€è·¯ä¸€ï¼špopæ—¶åœ¨å…¶ä»–æ–¹æ³•ä¸­é”€æ¯timeræ ¹æ®å‰é¢çš„è§£é‡Šï¼Œæˆ‘ä»¬çŸ¥é“ç”±äº Runloopå¯¹timerçš„å¼·æŒæœ‰ï¼Œå¯¼è‡´äº† Runloopé—´æ¥çš„å¼·æŒæœ‰äº†selfï¼ˆå› ä¸ºtimerä¸­æ•è·çš„æ˜¯ vcå¯¹è±¡ï¼‰ã€‚æ‰€ä»¥å¯¼è‡´ dealloc æ–¹æ³•æ— æ³•æ‰§è¡Œã€‚éœ€è¦æŸ¥çœ‹åœ¨popæ—¶ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥é”€æ¯ timerã€‚è¿™ä¸ªæ–¹æ³•å°±æ˜¯ didMoveToParentViewController didMoveToParentViewController æ–¹æ³•ï¼Œæ˜¯ç”¨äºå½“ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨ä¸­æ·»åŠ æˆ–è€…ç§»é™¤ viewControlleråï¼Œå¿…é¡»è°ƒç”¨çš„æ–¹æ³•ã€‚ç›®çš„æ˜¯ä¸ºäº†å‘Šè¯‰iOSï¼Œå·²ç»å®Œæˆæ·»åŠ &#x2F;åˆ é™¤å­æ§åˆ¶å™¨çš„æ“ä½œã€‚ åœ¨Bç•Œé¢ä¸­é‡å†™ didMoveToParentViewController æ–¹æ³• 123456789- (void)didMoveToParentViewController:(UIViewController *)parent&#123; // æ— è®ºpush è¿›æ¥ è¿˜æ˜¯ pop å‡ºå» æ­£å¸¸è·‘ // å°±ç®—ç»§ç»­push åˆ°ä¸‹ä¸€å±‚ pop å›å»è¿˜æ˜¯ç»§ç»­ if (parent == nil) &#123; [self.timer invalidate]; self.timer = nil; NSLog(@&quot;timer èµ°äº†&quot;); &#125;&#125; æ€è·¯äºŒï¼šä¸­ä»‹è€…æ¨¡å¼ï¼Œå³ä¸ä½¿ç”¨selfï¼Œä¾èµ–äºå…¶ä»–å¯¹è±¡åœ¨timeræ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯ fireHome èƒ½æ‰§è¡Œï¼Œå¹¶ ä¸å…³å¿ƒtimeræ•è·target æ˜¯è°ï¼Œç”±äºè¿™é‡Œ ä¸æ–¹ä¾¿ä½¿ç”¨selfï¼ˆå› ä¸ºä¼šæœ‰å¼ºæŒæœ‰é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥ å¯ä»¥å°†targetæ¢æˆå…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚å°†targetæ¢æˆ NSObjectå¯¹è±¡ï¼Œå°† fireHome äº¤ç»™ target æ‰§è¡Œ å°†timerçš„targetç”±selfæ”¹æˆobjc 123456789101112131415161718192021// 1.å®šä¹‰æˆå…¶ä»–å¯¹è±¡@property (nonatomic, strong)id target;// 2.ä¿®æ”¹targetself.target = [[NSObject alloc] init];class_addMethod([NSObject class],@selector(fireHome),(IMP)fireHomeObjc,&quot;v@:&quot;);self.timer = [];// 3.imp- (void)fireHome&#123; num++; NSLog(@&quot;hello word - %d&quot;,num);&#125;void fireHomeObjc(id obj)&#123; NSLog(@&quot;%s -- %@&quot;,__func__,obj);&#125;// 4.dealloc- (void)dealloc&#123; NSLog(@&quot;%s&quot;,__func__);&#125; æŸ¥çœ‹è¿è¡Œç»“æœå¦‚ä¸‹ è¿è¡Œå‘ç°æ‰§è¡Œ dealloc ä¹‹åï¼Œtimerè¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œã€‚åŸå› æ˜¯ è§£å†³äº†ä¸­ä»‹è€…çš„é‡Šæ”¾ï¼Œä½†æ˜¯ æ²¡æœ‰è§£å†³ä¸­ä»‹è€…çš„å›æ”¶ï¼Œå³ self.targetçš„å›æ”¶ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼ æœ‰ç¼ºé™· å¯ä»¥é€šè¿‡åœ¨ dealloc æ–¹æ³•ä¸­ï¼Œå–æ¶ˆå®šæ—¶å™¨æ¥è§£å†³ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345- (void)dealloc&#123; [self.timer invalidate]; self.timer = nil; NSLog(@&quot;%s&quot;,__func__);&#125; è¿è¡Œä»£ç æŸ¥çœ‹ç»“æœå¦‚ä¸‹ï¼Œå‘ç° pop ä¹‹åï¼Œtimeré‡Šæ”¾ï¼Œä»è€Œä¸­ä»‹è€…ä¹Ÿä¼šè¿›è¡Œå›æ”¶é‡Šæ”¾ æ€è·¯ä¸‰ï¼šè‡ªå®šä¹‰å°è£…timerè¿™ç§æ–¹å¼æ˜¯æ ¹æ®æ€è·¯äºŒçš„åŸç†ï¼Œè‡ªå®šä¹‰å°è£…timerï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼š è‡ªå®šä¹‰timerWapper åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªtimerï¼Œå…¶targetæ˜¯è‡ªå·±ã€‚å³ timerWapper ä¸­çš„ timerï¼Œä¸€ç›´ç›‘å¬è‡ªå·±ï¼Œåˆ¤æ–­ selectorï¼Œæ­¤æ—¶çš„selectorå·²äº¤ç»™äº†ä¼ å…¥çš„targetï¼ˆå³vcå¯¹è±¡ï¼‰ï¼Œæ­¤æ—¶æœ‰ä¸€ä¸ªæ–¹æ³• fireHomeWapperï¼Œåœ¨æ–¹æ³•ä¸­ï¼Œåˆ¤æ–­targetæ˜¯å¦å­˜åœ¨ å¦‚æœ targetå­˜åœ¨ï¼Œåˆ™éœ€è¦è®©vcçŸ¥é“ï¼Œå³å‘ä¼ å…¥çš„targetå‘é€selectoræ¶ˆæ¯ï¼Œå¹¶å°†æ­¤æ—¶çš„timerä½œä¸ºå‚æ•°ä¹Ÿä¸€å¹¶ä¼ å…¥ï¼Œæ‰€ä»¥vcå°±å¯ä»¥å¾—çŸ¥ fireHome æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼æ˜¯å®šæ—¶å™¨æ–¹æ³•èƒ½å¤Ÿæ‰§è¡Œçš„åŸå›  å¦‚æœ targetä¸å­˜åœ¨ï¼Œå·²ç»é‡Šæ”¾äº†ï¼Œåˆ™é‡Šæ”¾å½“å‰çš„ timerWapper ï¼Œå³æ‰“ç ´äº†Runloopå¯¹timerWapperçš„å¼·æŒæœ‰ï¼ˆtimerWapper &lt;- x - RunLoopï¼‰ è‡ªå®šä¹‰ zj_invalidate æ–¹æ³•ä¸­é‡Šæ”¾timerã€‚è¿™ä¸ªæ–¹æ³•åœ¨vcçš„deallocæ–¹æ³•ä¸­è°ƒç”¨ï¼Œå³ vcé‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´timerWapperé‡Šæ”¾ï¼Œæ‰“ç ´äº† vc å¯¹ timerWapper çš„å¼·æŒæœ‰ï¼ˆvc -&gt; x -&gt; timerWapperï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//********** .hæ–‡ä»¶ *********@interface ZJTimerWapper : NSObject- (instancetype)zj_initWithTimeInterval:(NSTimeInterval)ti target:(id)aTarget selector:(SEL)aSelector userInfo:(nullable id)userInfo repeats:(BOOL)yesOrNo;- (void)zj_invalidate;@end//********** .mæ–‡ä»¶ ********@implementation ZJTimerWapper- (instancetype)zj_initWithTimeInterval:(NSTimeInterval)ti target:(id)aTarget selector:(SEL)aSelector userInfo:(nullable id)userInfo repeats:(BOOL)yesOrNo&#123; if (self == [super init]) &#123; // ä¼ å…¥vc self.target = aTarget; // ä¼ å…¥å®šæ—¶å™¨æ–¹æ³• self.aSelector = aSelector; if ([self.target respondsToSelector:self.aSelector]) &#123; Method method = class_getInstanceMethod([self.target class], aSelector); const char *type = method_getTypeEncoding(method); // ç»™timerWapperæ·»åŠ æ–¹æ³• class_addMethod([self class], aSelector, (IMP)fireHomeWapper, type); // å¯åŠ¨ä¸€ä¸ªtimerï¼Œtargetæ˜¯selfï¼Œå³ç›‘å¬è‡ªå·± self.timer = [NSTimer scheduledTimerWithTimeInterval:ti target:self selector:aSelector userInfo:userInfo repeats:yesOrNo]; &#125; &#125; return self;&#125;// ä¸€ç›´è·‘ runloopvoid fireHomeWapper(ZJTimerWapper *warpper)&#123; // åˆ¤æ–­targetæ˜¯å¦å­˜åœ¨ if (warpper.target) &#123; // å¦‚æœå­˜åœ¨åˆ™éœ€è¦vcçŸ¥é“ï¼Œå³å‘ä¼ å…¥çš„targetå‘é€selectoræ¶ˆæ¯ï¼Œå¹¶å°†æ­¤æ—¶çš„timerå‚æ•°ä¸€å¹¶ä¼ å…¥ï¼Œæ‰€ä»¥vcå°±å¯ä»¥å¾—çŸ¥ fireHome æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯å®šæ—¶å™¨æ–¹æ³•èƒ½å¤Ÿæ‰§è¡Œçš„åŸå›  void (*zj_msgSend)(void *,SEL, id) = (void *)objc_msgSend; zj_msgSend((__bridge void *)(warpper.target), warpper.aSelector,warpper.timer); &#125;else&#123; // å¦‚æœtargetä¸å­˜åœ¨ï¼Œå·²ç»é‡Šæ”¾ï¼Œåˆ™é‡Šæ”¾å½“å‰çš„timerWrapper [warpper.timer invalidate]; warpper.timer = nil; &#125;&#125;// åœ¨vcçš„deallocæ–¹æ³•ä¸­è°ƒç”¨ï¼Œé€šè¿‡vcé‡Šæ”¾ï¼Œä»è€Œè®©timeré‡Šæ”¾- (void)zj_invalidate&#123; [self.timer invalidate]; self.timer = nil;&#125;- (void)dealloc&#123; NSLog(@&quot;%s&quot;,__func__);&#125;@end timerWapperçš„ä½¿ç”¨ 12345678// å®šä¹‰self.timerWapper = [[ZJTimerWapper alloc] zj_initWithTimeInterval:1 target:self selector:@selector(fireHome) userInfo:nil repeats:YES];// é‡Šæ”¾- (void)dealloc&#123; [self.timerWapper zj_invalidate]; NSLog(@&quot;%s&quot;,__func__);&#125; è¿è¡Œç»“æœå¦‚ä¸‹ è¿™ç§æ–¹å¼çœ‹èµ·æ¥æ¯”è¾ƒç¹çï¼Œæ­¥éª¤å¾ˆå¤šï¼Œè€Œä¸”é’ˆå¯¹ timerWapperï¼Œéœ€è¦ä¸æ–­çš„æ·»åŠ methodï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„å¤„ç† æ€è·¯å››ï¼šåˆ©ç”¨NSProxyè™šåŸºç±»çš„å­ç±»ä¸‹é¢æ¥ä»‹ç»ä¸€ç§ timer å¼·å¼•ç”¨ æœ€å¸¸ç”¨ çš„å¤„ç†æ–¹å¼ï¼šNSProxyå­ç±» å¯ä»¥é€šè¿‡ NSProxy è™šåŸºç±»ï¼Œå¯ä»¥äº¤ç»™å…¶å­ç±»å®ç°ï¼ŒNSproxyçš„ä»‹ç»åœ¨å‰é¢çš„æ–‡ç« å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸å†é‡å¤ é¦–å…ˆå®šä¹‰ä¸€ä¸ªé›†æˆè‡ª NSProxy çš„å­ç±» 1234567891011121314151617//**********NSProxyå­ç±»**********@interface ZJProxy : NSProxy+ (instancetype)proxyWithTransformObject:(id)object;@end@interface ZJProxy()@property (nonatomic, weak) id object;@implementation ZJProxy+ (instancetype)proxyWithTransformObject:(id)object&#123; ZJProxy *proxy = [ZJProxy alloc]; proxy.object = object; return proxy;&#125;-(id)forwardingTargetForSelector:(SEL)aSelector &#123; return self.object;&#125; å°†timerä¸­çš„targetä¼ å…¥NSProxyå­ç±»å¯¹è±¡ï¼Œå³timeræŒæœ‰NSProxyå­ç±»å¯¹è±¡ 12345678910//**********è§£å†³timerå¼·æŒæœ‰çš„é—®é¢˜*********self.proxy = [ZJProxy proxyWithTransformObject:self];self.timer = [NSTimer scheduledTimerWithTimeInterval:1 target:self.proxy selector:@selector(fireHome) userInfo:nil repeats:YES];//åœ¨deallocä¸­å°†timeræ­£å¸¸é‡Šæ”¾- (void)dealloc&#123; [self.timer invalidate]; self.timer = nil; NSLog(@&quot;%s&quot;,__func__);&#125; è¿™æ ·åšçš„ç›®çš„æ˜¯å°† å¼·å¼•ç”¨çš„æ³¨æ„åŠ›è½¬ç§»æˆäº†æ¶ˆæ¯è½¬å‘ã€‚è™šåŸºç±»åªè´Ÿè´£æ¶ˆæ¯è½¬å‘ï¼Œå³ä½¿ç”¨ NSProxy ä½œä¸º ä¸­é—´ä»£ç†ã€ä¸­é—´è€… è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œå®šä¹‰ proxy å¯¹è±¡ï¼Œåœ¨deallocé‡Šæ”¾æ—¶ï¼Œè¿˜å­˜åœ¨ä¹ˆï¼Ÿ proxyå¯¹è±¡ä¼šæ­£å¸¸é‡Šæ”¾ï¼Œå› ä¸º vc æ­£å¸¸é‡Šæ”¾äº†ï¼Œæ‰€ä»¥å¯ä»¥é‡Šæ”¾å…¶æŒæœ‰è€…ï¼Œå³ timerå’Œproxyï¼Œtimerçš„é‡Šæ”¾ä¹Ÿæ‰“ç ´äº† runloopå¯¹proxyçš„å¼ºæŒæœ‰ã€‚å®Œç¾çš„è¾¾åˆ°äº† ä¸¤å±‚é‡Šæ”¾ï¼Œå³ vc -&gt; proxy &lt;- runloopï¼Œè§£é‡Šå¦‚ä¸‹ï¼š vcé‡Šæ”¾ï¼Œå¯¼è‡´äº† proxy çš„é‡Šæ”¾ deallocæ–¹æ³•ä¸­ï¼Œtimerè¿›è¡Œäº†é‡Šæ”¾ï¼Œæ‰€ä»¥runloopå¼ºå¼•ç”¨ä¹Ÿé‡Šæ”¾äº†","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†35ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸€ï¼‰TaggedPointer/retain/release/dealloc/retainCount åº•å±‚åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†35ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸€ï¼‰TaggedPointer-retain-release-dealloc-retainCount-åº•å±‚åˆ†æ","date":"2021-05-22T06:47:27.000Z","updated":"2022-04-12T06:31:59.000Z","comments":true,"path":"2021/05/22/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†35ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸€ï¼‰TaggedPointer-retain-release-dealloc-retainCount-åº•å±‚åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2021/05/22/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8635%EF%BC%9A%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89TaggedPointer-retain-release-dealloc-retainCount-%E5%BA%95%E5%B1%82%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦æ˜¯åˆ†æå†…å­˜ç®¡ç†ä¸­çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆï¼Œä»¥åŠ retainã€retainCountã€releaseã€dealloc çš„åº•å±‚æºç åˆ†æ ARC &amp; MRCiOSä¸­çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šMRC(æ‰‹åŠ¨å†…å­˜ç®¡ç†) å’Œ ARC(è‡ªåŠ¨å†…å­˜ç®¡ç†) MRC åœ¨ MRC æ—¶ä»£ï¼Œç³»ç»Ÿæ˜¯é€šè¿‡å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ¥åˆ¤æ–­ä¸€ä¸ªæ˜¯å¦é”€æ¯ï¼Œæœ‰ä»¥ä¸‹è§„åˆ™ å¯¹è±¡è¢« åˆ›å»ºæ—¶ å¼•ç”¨è®¡æ•°éƒ½ä¸º 1 å½“å¯¹è±¡ è¢«å…¶ä»–æŒ‡é’ˆå¼•ç”¨ æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ [objc retain]ï¼Œä½¿å¯¹è±¡çš„ å¼•ç”¨è®¡æ•°+1 å½“æŒ‡é’ˆå˜é‡ä¸å†ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ [objc release] æ¥ é‡Šæ”¾ å¯¹è±¡ï¼Œä½¿å¯¹è±¡çš„ å¼•ç”¨è®¡æ•°-1 å½“ä¸€ä¸ªå¯¹è±¡çš„ å¼•ç”¨è®¡æ•°ä¸º0 æ—¶ï¼Œç³»ç»Ÿå°±ä¼š é”€æ¯ è¿™ä¸ªå¯¹è±¡ æ‰€ä»¥ï¼Œåœ¨MRCæ¨¡å¼ä¸‹ï¼Œå¿…é¡»éµå®ˆï¼šè°åˆ›å»ºï¼Œè°é‡Šæ”¾ï¼Œè°å¼•ç”¨ï¼Œè°ç®¡ç† ARC ARC æ¨¡å¼æ˜¯åœ¨WWDC2011å’ŒiOS5å¼•å…¥çš„è‡ªåŠ¨ç®¡ç†æœºåˆ¶ï¼Œå³ è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼Œæ˜¯ç¼–è¯‘å™¨çš„ä¸€ç§ç‰¹æ€§ã€‚å…¶è§„åˆ™ä¸MRCä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºï¼ŒARCæ¨¡å¼ä¸‹ä¸éœ€è¦æ‰‹åŠ¨retainã€releaseã€autoreleaseï¼Œç¼–è¯‘å™¨ä¼šåœ¨é€‚å½“ä½ç½®æ’å…¥releaseå’Œautorelease å†…å­˜å¸ƒå±€æˆ‘ä»¬åœ¨å‰é¢ä»‹ç»äº† å†…å­˜äº”å¤§åŒºï¼Œå…¶å®é™¤äº† å†…å­˜åŒºï¼Œè¿˜æœ‰ å†…æ ¸åŒº å’Œ ä¿ç•™åŒºï¼Œä»¥ 4GB æ‰‹æœºä¸ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œç³»ç»Ÿå°†å…¶ä¸­çš„ 3GB ç»™äº† äº”å¤§åŒº + ä¿ç•™åŒºï¼Œå‰©ä½™çš„ 1GB ç»™å†…æ ¸åŒºä½¿ç”¨ å†…æ ¸åŒºï¼šç³»ç»Ÿç”¨æ¥è¿›è¡Œå†…æ ¸å¤„ç†æ“ä½œçš„åŒºåŸŸ äº”å¤§åŒºï¼šè¿™é‡Œä¸å†ä½œè¯´æ˜ï¼Œå…·ä½“è¯·å‚è€ƒä¸Šé¢çš„é“¾æ¥ ä¿ç•™åŒºï¼šé¢„ç•™ç»™ç³»ç»Ÿå¤„ç†nilç­‰ è¿™é‡Œæœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆäº”å¤§åŒºçš„æœ€åå†…å­˜åœ°å€æ˜¯ä» 0x00400000 å¼€å§‹çš„ã€‚å…¶ä¸»è¦åŸå› æ˜¯ 0x00000000 è¡¨ç¤º nilï¼Œä¸èƒ½ç›´æ¥ç”¨nilè¡¨ç¤ºä¸€ä¸ªæ®µï¼Œæ‰€ä»¥å•ç‹¬ç»™äº†ä¸€æ®µå†…å­˜ç”¨äº å¤„ç†nil ç­‰æƒ…å†µ å†…å­˜å¸ƒå±€ç›¸å…³é¢è¯•é¢˜é¢è¯•é¢˜1ï¼šå…¨å±€å˜é‡å’Œå±€éƒ¨å˜é‡åœ¨å†…å­˜ä¸­æ˜¯å¦æœ‰åŒºåˆ«ï¼Ÿå¦‚æœæœ‰ï¼Œæ˜¯ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æœ‰åŒºåˆ« å…¨å±€å˜é‡ ä¿å­˜åœ¨å†…å­˜çš„ å…¨å±€å­˜å‚¨åŒºï¼ˆå³bss+dataæ®µï¼‰ï¼Œå ç”¨é™æ€çš„å­˜å‚¨å•å…ƒ å±€éƒ¨å˜é‡ ä¿å­˜åœ¨ æ ˆ ä¸­ï¼Œåªæœ‰åœ¨æ‰€åœ¨ å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰åŠ¨æ€çš„ä¸ºå˜é‡åˆ†é…å­˜å‚¨å•å…ƒ é¢è¯•é¢˜2ï¼šBlockä¸­å¯ä»¥ä¿®æ”¹å…¨å±€å˜é‡ï¼Œå…¨å±€é™æ€å˜é‡ï¼Œå±€éƒ¨é™æ€å˜é‡ï¼Œå±€éƒ¨å˜é‡å—ï¼Ÿ å¯ä»¥ä¿®æ”¹ å…¨å±€å˜é‡ï¼Œå…¨å±€é™æ€å˜é‡ï¼Œå› ä¸º å…¨å±€å˜é‡ å’Œ é™æ€å…¨å±€å˜é‡ æ˜¯ å…¨å±€ çš„ï¼Œä½œç”¨åŸŸå¹¿ å¯ä»¥ä¿®æ”¹å±€éƒ¨é™æ€å˜é‡ï¼Œä¸å¯ä»¥ä¿®æ”¹å±€éƒ¨å˜é‡ å±€éƒ¨é™æ€å˜é‡ï¼ˆstaticä¿®é¥°çš„ï¼‰å’Œ å±€éƒ¨å˜é‡ï¼Œè¢«blockä»å¤–é¢æ•è·çš„ï¼Œæˆä¸º __main_block_imp_0 è¿™ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ å±€éƒ¨å˜é‡ æ˜¯ä»¥ æŒ‡é’ˆå½¢å¼ï¼Œè¢«blockæ•è·çš„ï¼Œç”±äºæ•è·çš„æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥ å¯ä»¥ä¿®æ”¹ å±€éƒ¨é™æ€å˜é‡çš„å€¼ ARCç¯å¢ƒä¸‹ï¼Œä¸€æ—¦ä½¿ç”¨ __block ä¿®é¥°å¹¶åœ¨blockä¸­ä¿®æ”¹ï¼Œå°±ä¼š è§¦å‘copyï¼Œblockå°±ä¼šä» æ ˆåŒºcopyåˆ°å †åŒºï¼Œæ­¤æ—¶çš„ blockæ˜¯å †åŒºblock ARCæ¨¡å¼ä¸‹ï¼Œblockä¸­å¼•ç”¨ idç±»å‹ çš„æ•°æ®ï¼Œæ— è®ºæœ‰æ²¡æœ‰__blockä¿®é¥°ï¼Œéƒ½ä¼šretainï¼Œå¯¹äº åŸºç¡€æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰__blockå°±æ— æ³•ä¿®æ”¹å˜é‡å€¼ï¼Œå¦‚æœæœ‰ __blockä¿®é¥°ï¼Œä¹Ÿæ˜¯åœ¨åº•å±‚ä¿®æ”¹ __block_byref_a_0 ç»“æ„ä½“ï¼Œå°†å…¶å†…éƒ¨çš„ forwarding æŒ‡é’ˆæŒ‡å‘ copyåçš„åœ°å€ï¼Œæ¥è¾¾åˆ°å€¼çš„ä¿®æ”¹ å†…å­˜ç®¡ç†æ–¹æ¡ˆå†…å­˜ç®¡ç†æ–¹æ¡ˆé™¤äº†å‰æ–‡æåŠçš„ MRC å’Œ ARCï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š Tagged Pointerï¼šä¸“é—¨ç”¨æ¥å¤„ç†å°å¯¹è±¡ï¼Œä¾‹å¦‚NSNumberã€NSDateã€å°NSStringç­‰ Nonpointer_isaï¼šéæŒ‡é’ˆç±»å‹çš„isaï¼Œä¸»è¦æ˜¯ç”¨æ¥ä¼˜åŒ–64ä½åœ°å€ï¼Œè¿™ä¸ªåœ¨ OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢ ä¸€æ–‡ä¸­ï¼Œå·²ç»ä»‹ç»äº† SideTablesï¼šæ•£åˆ—è¡¨ï¼Œåœ¨æ•£åˆ—è¡¨ä¸­ä¸»è¦æœ‰ä¸¤ä¸ªè¡¨ï¼Œåˆ†åˆ«æ˜¯ å¼•ç”¨è®¡æ•°è¡¨ã€å¼±å¼•ç”¨è¡¨ è¿™é‡Œä¸»è¦ç€é‡å€Ÿå· Tagged Pointer å’Œ SideTablesï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé¢è¯•é¢˜æ¥å¼•å…¥ Tagged Pointer é¢è¯•é¢˜ ä»¥ä¸‹ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ 123456789101112131415161718192021222324252627@interface ViewController ()@property (nonatomic,strong)dispatch_queue_t queue;@property (nonatomic,copy)NSString * nameStr;@end@implementation ViewController- (void)taggedPointerDemo&#123; self.queue = dispatch_queue_create(&quot;com.zj.cn&quot;, DISPATCH_QUEUE_CONCURRENT); for (int i = 0; i &lt; 10000; i ++) &#123; dispatch_async(self.queue, ^&#123; // alloc å † iOSä¼˜åŒ– - taggedpointer self.nameStr = [NSString stringWithFormat:@&quot;zj&quot;]; NSLog(@&quot;%@&quot;,self.nameStr); &#125;); &#125;&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; NSLog(@&quot;æ¥äº†&quot;); for (int i = 0; i &lt; 10000; i ++) &#123; dispatch_async(self.queue, ^&#123; self.nameStr = [NSString stringWithFormat:@&quot;zj_è¶ŠåŠªåŠ›ï¼Œè¶Šå¹¸è¿&quot;]; NSLog(@&quot;%@&quot;,self.nameStr); &#125;); &#125;&#125;@end è¿è¡Œä»¥ä¸Šä»£ç ï¼Œå‘ç° taggedPointerDemo å•ç‹¬è¿è¡Œæ²¡æœ‰é—®é¢˜ï¼Œå½“è§¦å‘ touchBegan æ–¹æ³•åã€‚ç¨‹åºä¼šå´©æºƒï¼Œå´©æºƒçš„åŸå› æ˜¯ å¤šæ¡çº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œè§£é‡Šï¼Œå¯¼è‡´äº† è¿‡æ¸¡é‡Šæ”¾ æ‰€ä»¥å´©æºƒã€‚å…¶æ ¹æœ¬åŸå› æ˜¯å› ä¸º nameStr åœ¨åº•å±‚çš„ç±»å‹ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒè¯•çœ‹å‡º taggedPointerDemo æ–¹æ³•ä¸­çš„ nameStr ç±»å‹æ˜¯ NSTaggedPointerStringï¼Œå­˜å‚¨åœ¨ å¸¸é‡åŒºã€‚å› ä¸º nameStr åœ¨ alloc åˆ†é…æ—¶åœ¨ å †åŒºï¼Œç”±äºè¾ƒå°ï¼Œæ‰€ä»¥ç»è¿‡xcodeåœ¨iOSä¸­çš„ä¼˜åŒ–ï¼Œæˆäº† NSTaggedPointerString ç±»å‹ï¼Œå­˜å‚¨åœ¨ å¸¸é‡åŒº touchesBegan æ–¹æ³•ä¸­çš„ nameStr ç±»å‹æ˜¯ NSCFString ç±»å‹ï¼Œå­˜å‚¨åœ¨ å †ä¸Š NSStringçš„å†…å­˜ç®¡ç† æˆ‘ä»¬å¯ä»¥é€šè¿‡NSStringåˆå§‹åŒ–çš„ä¸¤ç§æ–¹å¼ï¼Œæ¥æµ‹è¯•NSStringçš„å†…å­˜ç®¡ç† é€šè¿‡ WithString + @&quot;&quot; æ–¹å¼åˆå§‹åŒ– é€šè¿‡ WithFormat æ–¹å¼åˆå§‹åŒ– 1234567891011121314151617181920212223242526#define ZJLog(_c) NSLog(@&quot;%@ -- %p -- %@&quot;,_c,_c,[_c class]);- (void)testNSString&#123; // åˆå§‹åŒ–æ–¹å¼ä¸€ï¼šé€šè¿‡ WithString + @&quot;&quot; æ–¹å¼ NSString * s1 = @&quot;1&quot;; NSString * s2 = [[NSString alloc] initWithString:@&quot;2&quot;]; NSString * s3 = [NSString stringWithString:@&quot;3&quot;]; ZJLog(s1); ZJLog(s2); ZJLog(s3); // åˆå§‹åŒ–æ–¹å¼äºŒï¼šé€šè¿‡ WithFormat // å­—ç¬¦ä¸²é•¿åº¦åœ¨9ä»¥å†… NSString * s4 = [NSString stringWithFormat:@&quot;123456789&quot;]; NSString * s5 = [[NSString alloc] initWithFormat:@&quot;123456789&quot;]; // å­—ç¬¦ä¸²é•¿åº¦å¤§äº9 NSString * s6 = [NSString stringWithFormat:@&quot;1234567890&quot;]; NSString * s7 = [[NSString alloc] initWithFormat:@&quot;1234567890&quot;]; ZJLog(s4); ZJLog(s5); ZJLog(s6); ZJLog(s7);&#125; ä»¥ä¸‹æ˜¯è¿è¡Œçš„ç»“æœ æ‰€ä»¥ï¼Œä»ä¸Šé¢å¯ä»¥æ€»ç»“å‡ºï¼ŒNSStringçš„ å†…å­˜ç®¡ç† ä¸»è¦åˆ†ä¸º3ä¸­ __NSCFConstantStringï¼šå­—ç¬¦ä¸²å¸¸é‡åŒºï¼Œæ˜¯ä¸€ç§ ç¼–è¯‘æ—¶å¸¸é‡ï¼ŒretainCountå€¼å¾ˆå¤§ï¼Œå¯¹å…¶æ“ä½œï¼Œä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å˜åŒ–ï¼Œå­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡åŒº __NSCFStringï¼šæ˜¯åœ¨ è¿è¡Œæ—¶ åˆ›å»ºçš„ NSStringå­ç±»ï¼Œåˆ›å»ºå å¼•ç”¨è®¡æ•°ä¼šåŠ 1ï¼Œå­˜å‚¨åœ¨å †ä¸Š NSTaggedPointerStringï¼šæ ‡ç­¾æŒ‡é’ˆï¼Œæ˜¯è‹¹æœåœ¨64ä½ç¯å¢ƒä¸‹å¯¹ NSStringã€NSNumber ç­‰å¯¹è±¡åšçš„ä¼˜åŒ–ï¼Œå¯¹äºNSStringå¯¹è±¡æ¥è¯´ å½“ å­—ç¬¦ä¸²æ˜¯ç”±æ•°å­—ã€è‹±æ–‡å­—æ¯ç»„åˆä¸”é•¿åº¦å°äºç­‰äº9 æ—¶ï¼Œä¼šè‡ªåŠ¨æˆä¸º NSTaggedPointerString ç±»å‹ï¼Œå­˜å‚¨åœ¨ å¸¸é‡åŒº å½“æœ‰ ä¸­æ–‡æˆ–å…¶ä»–ç‰¹æ®Šç¬¦å· æ—¶ï¼Œä¼šç›´æ¥æˆä¸º __NSCFString ç±»å‹ï¼Œå­˜å‚¨åœ¨ å †åŒº Tagged Pointer å°å¯¹è±¡ç”±ä¸€ä¸ªNSStringçš„é¢è¯•é¢˜ï¼Œå¼•å‡ºäº† Tagged Pointer ï¼Œä¸ºäº†æ¢ç´¢å°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ï¼Œå¤„ç†æˆ‘ä»¬éœ€è¦è¿›å…¥ objc æºç ä¸­æŸ¥çœ‹ retainã€release æºç ä¸­å¯¹ Tagged Pointer å°å¯¹è±¡çš„å¤„ç† å°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å¤„ç†åˆ†æ æŸ¥çœ‹ setProperty -&gt; reallySetProperty æºç ï¼Œå…¶ä¸­æ˜¯å¯¹ æ–°å€¼retainï¼Œæ—§å€¼release è¿›å…¥ objc_retainã€objc_release æºç ï¼Œåœ¨è¿™é‡Œéƒ½åˆ¤æ–­æ˜¯å¦æ˜¯å°å¯¹è±¡ï¼Œå¦‚æœæ˜¯å°å¯¹è±¡ï¼Œåˆ™ä¸ä¼šè¿›è¡Œretainå’Œreleaseï¼Œä¼šç›´æ¥è¿”å›ï¼Œå› æ­¤å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå¦‚æœæ˜¯å°å¯¹è±¡ï¼Œä¸ä¼šè¿›è¡Œretainå’Œrelease 1234567891011121314151617181920212223//****************objc_retain****************__attribute__((aligned(16), flatten, noinline))id objc_retain(id obj)&#123; if (!obj) return obj; //åˆ¤æ–­æ˜¯å¦æ˜¯å°å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›å¯¹è±¡ if (obj-&gt;isTaggedPointer()) return obj; //å¦‚æœä¸æ˜¯å°å¯¹è±¡ï¼Œåˆ™retain return obj-&gt;retain();&#125;//****************objc_release****************__attribute__((aligned(16), flatten, noinline))void objc_release(id obj)&#123; if (!obj) return; //å¦‚æœæ˜¯å°å¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿”å› if (obj-&gt;isTaggedPointer()) return; //å¦‚æœä¸æ˜¯å°å¯¹è±¡ï¼Œåˆ™release return obj-&gt;release();&#125; å°å¯¹è±¡åœ°å€åˆ†æ ä¸€èˆ¬çš„ NSString å¯¹è±¡æŒ‡é’ˆï¼Œéƒ½æ˜¯ stringå€¼ + æŒ‡é’ˆåœ°å€ï¼Œä¸¤è€…æ˜¯ åˆ†å¼€ çš„ å¯¹äº Tagged Pointer æŒ‡é’ˆï¼Œå…¶ æŒ‡é’ˆ+å€¼ï¼Œéƒ½èƒ½åœ¨å°å¯¹è±¡ä¸­ä½“ç°ï¼Œæ‰€ä»¥ Tagged Pointerå³åŒ…å«æŒ‡é’ˆï¼Œä¹ŸåŒ…å«å€¼ åœ¨ä¹‹å‰çš„æ–‡ç« è®²ç±»åŠ è½½æ—¶ï¼Œå…¶ä¸­çš„ _read_image æºç ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å¯¹å°å¯¹è±¡è¿›è¡Œäº†å¤„ç†ï¼Œå³ initializeTaggedPointerObfuscator æ–¹æ³• è¿›å…¥ _read_image -&gt; initializeTaggedPointerObfuscator æºç å®ç° 123456789101112131415161718static voidinitializeTaggedPointerObfuscator(void)&#123; if (sdkIsOlderThan(10_14, 12_0, 12_0, 5_0, 3_0) || // Set the obfuscator to zero for apps linked against older SDKs, // in case they&#x27;re relying on the tagged pointer representation. DisableTaggedPointerObfuscation) &#123; objc_debug_taggedpointer_obfuscator = 0; &#125; //åœ¨iOS14ä¹‹åï¼Œå¯¹å°å¯¹è±¡è¿›è¡Œäº†æ··æ·†ï¼Œé€šè¿‡ä¸æ“ä½œ+_OBJC_TAG_MASKæ··æ·† else &#123; // Pull random data into the variable, then shift away all non-payload bits. arc4random_buf(&amp;objc_debug_taggedpointer_obfuscator, sizeof(objc_debug_taggedpointer_obfuscator)); objc_debug_taggedpointer_obfuscator &amp;= ~_OBJC_TAG_MASK; &#125;&#125; åœ¨å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨iOS14ä¹‹åï¼ŒTagged Pointer é‡‡ç”¨äº†æ··æ·†å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤º æˆ‘ä»¬å¯ä»¥åœ¨æºç ä¸­é€šè¿‡ objc_debug_taggedpointer_obfuscator æŸ¥æ‰¾ taggedPointer çš„ ç¼–ç  å’Œ è§£ç  ï¼Œæ¥æŸ¥çœ‹åº•å±‚æ˜¯å¦‚ä½•æ··æ·†å¤„ç†çš„ 1234567891011//ç¼–ç static inline void * _Nonnull_objc_encodeTaggedPointer(uintptr_t ptr)&#123; return (void *)(objc_debug_taggedpointer_obfuscator ^ ptr);&#125;//è§£ç static inline uintptr_t_objc_decodeTaggedPointer(const void * _Nullable ptr)&#123; return (uintptr_t)ptr ^ objc_debug_taggedpointer_obfuscator; é€šè¿‡å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œåœ¨ç¼–ç å’Œè§£ç éƒ¨åˆ†ï¼Œç»è¿‡äº† ä¸¤å±‚å¼‚æˆ–ï¼Œå…¶ç›®çš„æ˜¯ å¾—åˆ°å°å¯¹è±¡è‡ªå·±ï¼Œä¾‹å¦‚ä»¥ 1010 0001 ä¸ºä¾‹ï¼Œå‡è®¾ mask ä¸º 1010 1000 12345 1010 0001 ^0101 1000 maskï¼ˆç¼–ç ï¼‰ 1111 1001^0101 1000 maskï¼ˆè§£ç ï¼‰ 1010 0001 æ‰€ä»¥åœ¨å¤–ç•Œï¼Œä¸ºäº† è·å–å°å¯¹è±¡çš„çœŸæ˜¯åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥å°†è§£ç çš„æºç æ‹·è´åˆ°å¤–é¢ï¼Œå°†NSStringæ··æ·†éƒ¨åˆ†è¿›è¡Œ è§£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º 12345678910111213141516extern uintptr_t objc_debug_taggedpointer_obfuscator;- (void)test&#123; NSString * s1 = [NSString stringWithFormat:@&quot;a&quot;]; NSString * s2 = [NSString stringWithFormat:@&quot;b&quot;]; NSLog(@&quot;%p - %@&quot;,s1,s1); NSLog(@&quot;%p - %@&quot;,s2,s2); NSLog(@&quot;0x%lx&quot;,_objc_decodeTaggedPointer_(s2)); &#125;uintptr_t_objc_decodeTaggedPointer_(id ptr)&#123; return (uintptr_t)ptr ^ objc_debug_taggedpointer_obfuscator;&#125; æ‰“å°ç»“æœå¦‚ä¸‹ è§‚å¯Ÿè§£ç åçš„ å°å¯¹è±¡åœ°å€ï¼Œå…¶ä¸­çš„ 10 è¡¨ç¤º b çš„ ASCII ç ï¼Œå†ä»¥ NSNumber ä¸ºä¾‹ï¼ŒåŒæ ·å¯ä»¥çœ‹å‡ºï¼Œ8 å°±æ˜¯æˆ‘ä»¬å®é™…çš„å€¼ 123NSNumber * n1 = @1; NSLog(@&quot;%@ - %p - 0x%lx&quot;,n1,n1,_objc_decodeTaggedPointer_(n1)); æ‰“å°ç»“æœå¦‚ä¸‹ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬éªŒè¯äº† å°å¯¹è±¡æŒ‡é’ˆåœ°å€ä¸­ç¡®å®å­˜å‚¨äº†å€¼ã€‚ TaggedPointer æ€»ç»“ Tagged Pointer å°å¯¹è±¡ç±»å‹ï¼ˆç”¨äºå­˜å‚¨ NSNumberã€NSDateã€å°NSStringï¼‰ï¼Œå°å¯¹è±¡æŒ‡é’ˆä¸å†æ˜¯ç®€å•çš„åœ°å€ï¼Œè€Œæ˜¯ åœ°å€+å€¼ï¼Œå³ çœŸæ­£çš„å€¼ï¼Œæ‰€ä»¥ï¼Œå®é™…ä¸Š å®ƒä¸å†æ˜¯ä¸€ä¸ªå¯¹è±¡äº†ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæŠ«ç€å¯¹è±¡çš®çš„æ™®é€šå˜é‡ è€Œå·²ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥è¿›è¡Œè¯»å–ã€‚ä¼˜ç‚¹æ˜¯ å ç”¨ç©ºé—´å°ã€èŠ‚çœå†…å­˜ Tagged Pointer å°å¯¹è±¡ ä¸ä¼šè¿›å…¥retainå’Œreleaseï¼Œè€Œæ˜¯ ç›´æ¥è¿”å›äº†ï¼Œæ„å‘³ç€ ä¸éœ€è¦ARCè¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥ å¯ä»¥ç›´æ¥è¢«ç³»ç»Ÿè‡ªä¸»çš„é‡Šæ”¾å’Œå›æ”¶ Tagged Pointer çš„ å†…å­˜å¹¶ä¸å­˜å‚¨åœ¨å † ä¸­ï¼Œè€Œæ˜¯åœ¨ å¸¸é‡åŒº ä¸­ï¼Œä¹Ÿ ä¸éœ€è¦mallocå’Œfreeï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¯»å–ï¼Œç›¸æ¯”å­˜å‚¨åœ¨å †åŒºçš„æ•°æ® è¯»å–ï¼Œæ•ˆç‡ä¸Šå¿«ä¹3å€å·¦å³ï¼Œåˆ›å»º çš„æ•ˆç‡ç›¸æ¯”å †åŒº å¿«äº†è¿‘100å€å·¦å³ æ‰€ä»¥ï¼Œç»¼åˆæ¥è¯´ï¼ŒTagged Pointer çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆï¼Œæ¯”å¸¸è§„çš„å†…å­˜ç®¡ç†ï¼Œè¦å¿«çš„å¤š Tagged Pointer çš„64ä½åœ°å€ä¸­ï¼Œå‰4 ä½ä»£è¡¨ç±»å‹ï¼Œå4 ä½ä¸»è¦é€‚ç”¨äºç³»ç»Ÿåšä¸€äº›å¤„ç†ï¼Œä¸­é—´56ä½ç”¨äºå­˜å‚¨å€¼ ä¼˜åŒ–å†…å­˜å»ºè®®ï¼šå¯¹äº NSString æ¥è¯´ï¼Œå½“å­—ç¬¦ä¸² è¾ƒå° æ—¶ï¼Œå»ºè®®ç›´æ¥é€šè¿‡ @&quot;&quot; åˆå§‹åŒ–ï¼Œå› ä¸ºå­˜å‚¨åœ¨ å¸¸é‡åŒºï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œè¯»å–ï¼Œä¼šæ¯” WithFormatåˆå§‹åŒ–æ–¹å¼ æ›´åŠ å¿«é€Ÿ SideTable æ•£åˆ—è¡¨å½“ å¼•ç”¨è®¡æ•° å­˜å‚¨åˆ°ä¸€å®šå€¼æ—¶ï¼Œå¹¶ä¸ä¼šåœ¨å­˜å‚¨åˆ° Nonpointer_isa çš„ä½åŸŸçš„ extra_rc ä¸­ï¼Œè€Œæ˜¯ä¼šå­˜å‚¨åˆ° SideTableæ•£åˆ—è¡¨ä¸­ ä¸‹é¢æˆ‘ä»¬å°±æ¥ç»§ç»­æ¢ç´¢å¼•ç”¨è®¡æ•°retainçš„åº•å±‚å®ç° retainæºç åˆ†æ è¿›å…¥ objc_retain -&gt; retain -&gt; rootRetain æºç å®ç°ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ éƒ¨åˆ†é€»è¾‘ ã€ç¬¬ä¸€æ­¥ã€‘åˆ¤æ–­æ˜¯å¦ä¸º Nonapointer_isa ã€ç¬¬äºŒæ­¥ã€‘æ“ä½œå¼•ç”¨è®¡æ•° å¦‚æœä¸æ˜¯ Nonapointer_isaï¼Œåˆ™ç›´æ¥æ“ä½œ SideTable æ•£åˆ—è¡¨ï¼Œæ­¤æ—¶çš„æ•£åˆ—è¡¨å¹¶ä¸åªæœ‰ä¸€å¼ ï¼Œè€Œæ˜¯æœ‰å¾ˆå¤šå¼ ï¼ˆåç»­ä¼šåˆ†æï¼Œä¸ºä»€ä¹ˆéœ€è¦å¤šå¼ ï¼Ÿï¼‰ åˆ¤æ–­ æ˜¯å¦æ­£åœ¨é‡Šæ”¾ï¼Œå¦‚æœæ­£åœ¨é‡Šæ”¾ï¼Œåˆ™æ‰§è¡Œdeallocæµç¨‹ æ‰§è¡Œ extra_rc + 1ï¼Œå³å¼•ç”¨è®¡æ•°+1æ“ä½œï¼Œå¹¶ç»™ä¸€ä¸ªå¼•ç”¨è®¡æ•°çš„ çŠ¶æ€æ ‡è¯†carryï¼Œ ç”¨äºè¡¨ç¤º extra_rc æ˜¯å¦æ»¡äº† å¦‚æœ carry çš„çŠ¶æ€è¡¨ç¤º extac_rcçš„å¼•ç”¨è®¡æ•°æ»¡äº† ï¼Œæ­¤æ—¶éœ€è¦æ“ä½œ æ•£åˆ—è¡¨ï¼Œå³æ»¡çŠ¶æ€æ‹¿å‡ºæ¥å­˜åˆ° extra_rcï¼Œå¦ä¸€åŠå­˜åœ¨æ•£åˆ—è¡¨çš„ extrc_halfã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯å› ä¸ºå¦‚æœéƒ½å­˜å‚¨åœ¨ æ•£åˆ—è¡¨ï¼Œæ¯æ¬¡å¯¹æ•£åˆ—è¡¨æ“ä½œéƒ½éœ€è¦å¼€è§£é”ï¼Œæ“ä½œè€—æ—¶ï¼Œæ¶ˆè€—æ€§èƒ½å¤§ï¼Œè¿™ä¹ˆ å¯¹åŠåˆ† æ“ä½œçš„ç›®çš„åœ¨äº æé«˜æ€§èƒ½ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465ALWAYS_INLINE id objc_object::rootRetain(bool tryRetain, bool handleOverflow)&#123; if (isTaggedPointer()) return (id)this; bool sideTableLocked = false; bool transcribeToSideTable = false; //ä¸ºä»€ä¹ˆæœ‰isaï¼Ÿå› ä¸ºéœ€è¦å¯¹å¼•ç”¨è®¡æ•°+1ï¼Œå³retain+1ï¼Œè€Œå¼•ç”¨è®¡æ•°å­˜å‚¨åœ¨isaçš„bitsä¸­ï¼Œéœ€è¦è¿›è¡Œæ–°æ—§isaçš„æ›¿æ¢ isa_t oldisa; isa_t newisa; //é‡ç‚¹ do &#123; transcribeToSideTable = false; oldisa = LoadExclusive(&amp;isa.bits); newisa = oldisa; //åˆ¤æ–­æ˜¯å¦ä¸ºnonpointer isa if (slowpath(!newisa.nonpointer)) &#123; //å¦‚æœä¸æ˜¯ nonpointer isaï¼Œç›´æ¥æ“ä½œæ•£åˆ—è¡¨sidetable ClearExclusive(&amp;isa.bits); if (rawISA()-&gt;isMetaClass()) return (id)this; if (!tryRetain &amp;&amp; sideTableLocked) sidetable_unlock(); if (tryRetain) return sidetable_tryRetain() ? (id)this : nil; else return sidetable_retain(); &#125; // don&#x27;t check newisa.fast_rr; we already called any RR overrides //deallocæºç  if (slowpath(tryRetain &amp;&amp; newisa.deallocating)) &#123; ClearExclusive(&amp;isa.bits); if (!tryRetain &amp;&amp; sideTableLocked) sidetable_unlock(); return nil; &#125; uintptr_t carry; //æ‰§è¡Œå¼•ç”¨è®¡æ•°+1æ“ä½œï¼Œå³å¯¹bitsä¸­çš„ 1ULL&lt;&lt;45ï¼ˆarm64ï¼‰ å³extra_rcï¼Œç”¨äºè¯¥å¯¹è±¡å­˜å‚¨å¼•ç”¨è®¡æ•°å€¼ newisa.bits = addc(newisa.bits, RC_ONE, 0, &amp;carry); // extra_rc++ //åˆ¤æ–­extra_rcæ˜¯å¦æ»¡äº†ï¼Œcarryæ˜¯æ ‡è¯†ç¬¦ if (slowpath(carry)) &#123; // newisa.extra_rc++ overflowed if (!handleOverflow) &#123; ClearExclusive(&amp;isa.bits); return rootRetain_overflow(tryRetain); &#125; // Leave half of the retain counts inline and // prepare to copy the other half to the side table. if (!tryRetain &amp;&amp; !sideTableLocked) sidetable_lock(); sideTableLocked = true; transcribeToSideTable = true; //å¦‚æœextra_rcæ»¡äº†ï¼Œåˆ™ç›´æ¥å°†æ»¡çŠ¶æ€çš„ä¸€åŠæ‹¿å‡ºæ¥å­˜åˆ°extra_rc newisa.extra_rc = RC_HALF; //ç»™ä¸€ä¸ªæ ‡è¯†ç¬¦ä¸ºYESï¼Œè¡¨ç¤ºéœ€è¦å­˜å‚¨åˆ°æ•£åˆ—è¡¨ newisa.has_sidetable_rc = true; &#125; &#125; while (slowpath(!StoreExclusive(&amp;isa.bits, oldisa.bits, newisa.bits))); if (slowpath(transcribeToSideTable)) &#123; // Copy the other half of the retain counts to the side table. //å°†å¦ä¸€åŠå­˜åœ¨æ•£åˆ—è¡¨çš„rc_halfä¸­ï¼Œå³æ»¡çŠ¶æ€ä¸‹æ˜¯8ä½ï¼Œä¸€åŠå°±æ˜¯1å·¦ç§»7ä½ï¼Œå³é™¤ä»¥2 //è¿™ä¹ˆæ“ä½œçš„ç›®çš„åœ¨äºæé«˜æ€§èƒ½ï¼Œå› ä¸ºå¦‚æœéƒ½å­˜åœ¨æ•£åˆ—è¡¨ä¸­ï¼Œå½“éœ€è¦release-1æ—¶ï¼Œéœ€è¦å»è®¿é—®æ•£åˆ—è¡¨ï¼Œæ¯æ¬¡éƒ½éœ€è¦å¼€è§£é”ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚extra_rcå­˜å‚¨ä¸€åŠçš„è¯ï¼Œå¯ä»¥ç›´æ¥æ“ä½œextra_rcå³å¯ï¼Œä¸éœ€è¦æ“ä½œæ•£åˆ—è¡¨ã€‚æ€§èƒ½ä¼šæé«˜å¾ˆå¤š sidetable_addExtraRC_nolock(RC_HALF); &#125; if (slowpath(!tryRetain &amp;&amp; sideTableLocked)) sidetable_unlock(); return (id)this;&#125; é—®é¢˜1ï¼šæ•£åˆ—è¡¨ä¸ºä»€ä¹ˆåœ¨å†…å­˜æœ‰å¤šå¼ ï¼Ÿæœ€å¤šèƒ½å¤Ÿå¤šå°‘å¼ ï¼Ÿ å¦‚æœæ•£åˆ—è¡¨åªæœ‰ä¸€å¼ è¡¨ï¼Œæ„å‘³ç€å…¨å±€æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šå­˜å‚¨åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œéƒ½ä¼šè¿›è¡Œå¼€é”è§£é”ï¼ˆé”æ˜¯é”æ•´ä¸ªè¡¨çš„è¯»å†™ï¼‰ã€‚å½“å¼€é”æ—¶ï¼Œç”±äºæ‰€æœ‰æ•°æ®éƒ½åœ¨ä¸€å¼ è¡¨ï¼Œåˆ™æ„å‘³ç€ æ•°æ®ä¸å®‰å…¨ å¦‚æœ æ¯ä¸ªå¯¹è±¡éƒ½å¼€ä¸€ä¸ªè¡¨ï¼Œä¼š è€—è´¹æ€§èƒ½ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æœ‰æ— æ•°ä¸ªè¡¨ æ•£åˆ—è¡¨çš„ç±»å‹æ˜¯ SideTableï¼Œæœ‰å¦‚ä¸‹å®šä¹‰ 1234567struct SideTable &#123; spinlock_t slock;//å¼€/è§£é” RefcountMap refcnts;//å¼•ç”¨è®¡æ•°è¡¨ weak_table_t weak_table;//å¼±å¼•ç”¨è¡¨ ....&#125; é€šè¿‡æŸ¥çœ‹ sidetable_unlock æ–¹æ³•å®šä½ SideTablesï¼Œå…¶å†…éƒ¨æ˜¯é€šè¿‡ SideTablesMap çš„getæ–¹æ³•è·å–ã€‚è€Œ SideTablesMap æ˜¯é€šè¿‡ StripedMap&lt;SideTable&gt; å®šä¹‰çš„ 12345678910111213void objc_object::sidetable_unlock()&#123; //SideTablesæ•£åˆ—è¡¨å¹¶ä¸åªæ˜¯ä¸€å¼ ï¼Œè€Œæ˜¯å¾ˆå¤šå¼ ï¼Œä¸å…³è”å¯¹è±¡è¡¨ç±»ä¼¼ SideTable&amp; table = SideTables()[this]; table.unlock();&#125;ğŸ‘‡static StripedMap&lt;SideTable&gt;&amp; SideTables() &#123; return SideTablesMap.get();&#125;ğŸ‘‡static objc::ExplicitInit&lt;StripedMap&lt;SideTable&gt;&gt; SideTablesMap; ä»è€Œè¿›å…¥ StripedMap çš„å®šä¹‰ï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒåŒä¸€æ—¶é—´ï¼ŒçœŸæœºä¸­æ•£åˆ—è¡¨æœ€å¤šåªèƒ½æœ‰8å¼  é—®é¢˜2ï¼šä¸ºä»€ä¹ˆåœ¨ç”¨æ•£åˆ—è¡¨ï¼Œè€Œä¸ç”¨æ•°ç»„ã€é“¾è¡¨ï¼Ÿ æ•°ç»„ï¼šç‰¹ç‚¹åœ¨äº æŸ¥è¯¢æ–¹ä¾¿ï¼ˆå³é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼‰ï¼Œå¢åˆ æ¯”è¾ƒéº»çƒ¦ï¼ˆç±»ä¼¼äºä¹‹å‰è®²è¿‡çš„ methodListï¼Œé€šè¿‡ memcopyã€memove å¢åˆ ï¼Œéå¸¸éº»çƒ¦ï¼‰ï¼Œæ‰€ä»¥æ•°æ®çš„ç‰¹æ€§æ˜¯ è¯»å–å¿«ã€å­˜å‚¨ä¸æ–¹ä¾¿ é“¾è¡¨ï¼šç‰¹ç‚¹åœ¨äº å¢åˆ æ–¹ä¾¿ã€æŸ¥è¯¢æ…¢ï¼ˆéœ€è¦ä»å¤´å¤´èŠ‚ç‚¹å¼€å§‹éå†æŸ¥è¯¢ï¼‰ï¼Œæ‰€ä»¥é“¾è¡¨çš„ç‰¹æ€§æ˜¯ å­˜å‚¨å¿«ã€è¯»å–æ…¢ æ•£åˆ—è¡¨ ï¼š æœ¬è´¨ å°±æ˜¯ä¸€å¼  å“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œè¡¨ é›†åˆäº†æ•°ç»„å’Œé“¾è¡¨çš„é•¿å¤„ï¼Œå¢åˆ æ”¹æŸ¥éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¾‹å¦‚ æ‹‰é“¾å“ˆå¸Œè¡¨ï¼ˆåœ¨ä¹‹å‰é”çš„æ–‡ç« ä¸­ï¼Œè®²è¿‡ tls çš„å­˜å‚¨ç»“æ„å°±æ˜¯ æ‹‰é“¾å½¢å¼çš„ï¼‰ï¼Œæ˜¯æœ€å¸¸ç”¨çš„ï¼Œå¦‚ä¸‹æ‰€ç¤º å¯ä»¥ä» SideTables -&gt; StripedMap -&gt; indexForPointer ä¸­éªŒè¯æ˜¯ é€šè¿‡å˜»å“ˆå‡½æ•°è®¡ç®—å“ˆå¸Œä¸‹æ ‡ ä»¥åŠ sideTables ä¸ºä»€ä¹ˆå¯ä»¥ ä½¿ç”¨[] çš„åŸå›  æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œretain çš„åº•å±‚æµç¨‹å¦‚ä¸‹æ‰€ç¤º æ€»ç»“ï¼šretainå®Œæˆå›ç­” retain åœ¨åº•å±‚é¦–å…ˆä¼š åˆ¤æ–­æ˜¯å¦æ˜¯ Nonpointer isaï¼Œå¦‚æœ ä¸æ˜¯ï¼Œåˆ™ç›´æ¥æ“ä½œæ•£åˆ—è¡¨ï¼Œè¿›è¡Œ+1æ“ä½œ å¦‚æœ æ˜¯Nonpointer isaï¼Œè¿˜éœ€è¦ åˆ¤æ–­æ˜¯å¦æ­£åœ¨é‡Šæ”¾ï¼Œå¦‚æœæ­£åœ¨ é‡Šæ”¾ï¼Œåˆ™æ‰§è¡Œdeallocæµç¨‹ï¼Œé‡Šæ”¾å¼±å¼•ç”¨è¡¨å’Œå¼•ç”¨æŠ€æœ¯è¡¨ï¼Œæœ€åfreeé‡Šæ”¾å¯¹è±¡å†…å­˜ å¦‚æœ ä¸æ˜¯æ­£åœ¨é‡Šæ”¾ï¼Œåˆ™å¯¹Nonpointer isaè¿›è¡Œå¸¸è§„å¼•ç”¨è®¡æ•°+1ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œextra_rc åœ¨çœŸæœºä¸Šåªæœ‰ 8ä½ç”¨äºå­˜å‚¨å¼•ç”¨è®¡æ•°çš„å€¼ï¼Œå½“å­˜å‚¨ æ»¡äº† æ—¶ï¼Œéœ€è¦ å€ŸåŠ©æ•£åˆ—è¡¨ ç”¨äºå­˜å‚¨ã€‚éœ€è¦å°†æ»¡äº† extra_rc å¯¹åŠåˆ†ï¼Œä¸€åŠï¼ˆå³2^7ï¼‰å­˜å‚¨åœ¨ æ•£åˆ—è¡¨ ä¸­ï¼Œå¦ä¸€åŠè¿˜æ˜¯å­˜å‚¨åœ¨ extra_rc ä¸­ï¼Œç”¨äºå¸¸è§„çš„å¼•ç”¨è®¡æ•°çš„+1æˆ–è€…-1æ“ä½œï¼Œç„¶åå†è¿”å› release æºç åˆ†æåˆ†æäº† retain çš„åº•å±‚å®ç°ï¼Œä¸‹é¢æ¥åˆ†æ release çš„åº•å±‚å®ç° é€šè¿‡ setProperty -&gt; reallySetProperty -&gt; objc_release -&gt; release -&gt; rootRelease -&gt; rootRelease é¡ºåºï¼Œè¿›å…¥ rootRelease æºç ï¼Œå…¶æ“ä½œä¸retainç›¸å åˆ¤æ–­æ˜¯å¦æ˜¯ Nonpointer isa ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ ç›´æ¥å¯¹æ•£åˆ—è¡¨è¿›è¡Œ-1æ“ä½œ å¦‚æœæ˜¯ Nonpointer isa ï¼Œåˆ™å¯¹extra_rc ä¸­çš„å¼•ç”¨è®¡æ•°å€¼è¿›è¡Œ -1 æ“ä½œï¼Œå¹¶å­˜å‚¨æ­¤æ—¶çš„ extra_rc çŠ¶æ€åˆ° carry ä¸­ å¦‚æœæ­¤æ—¶çš„çŠ¶æ€ carry ä¸º 0ï¼Œåˆ™èµ°åˆ° underflow æµç¨‹ underflow æµç¨‹æœ‰ä»¥ä¸‹å‡ æ­¥ åˆ¤æ–­ æ•£åˆ—è¡¨ ä¸­ æ˜¯å¦å­˜å‚¨äº†ä¸€åŠçš„å¼•ç”¨è®¡æ•° å¦‚æœæ˜¯ï¼Œåˆ™ä» æ•£åˆ—è¡¨ ä¸­å–å‡º å­˜å‚¨çš„ä¸€åŠå¼•ç”¨è®¡æ•°ï¼Œè¿›è¡Œ -1æ“ä½œï¼Œç„¶åå­˜å‚¨åˆ° extra_rc ä¸­ å¦‚æœæ­¤æ—¶ extra_rc æ²¡æœ‰å€¼ï¼Œæ•£åˆ—è¡¨ä¸­ä¹Ÿæ˜¯ç©ºçš„ï¼Œåˆ™ç›´æ¥è¿›è¡Œææ„ï¼Œå³ dealloc æ“ä½œï¼Œå±äºè‡ªåŠ¨è§¦å‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132ALWAYS_INLINE bool objc_object::rootRelease(bool performDealloc, bool handleUnderflow)&#123; if (isTaggedPointer()) return false; bool sideTableLocked = false; isa_t oldisa; isa_t newisa; retry: do &#123; oldisa = LoadExclusive(&amp;isa.bits); newisa = oldisa; //åˆ¤æ–­æ˜¯å¦æ˜¯Nonpointer isa if (slowpath(!newisa.nonpointer)) &#123; //å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥æ“ä½œæ•£åˆ—è¡¨-1 ClearExclusive(&amp;isa.bits); if (rawISA()-&gt;isMetaClass()) return false; if (sideTableLocked) sidetable_unlock(); return sidetable_release(performDealloc); &#125; // don&#x27;t check newisa.fast_rr; we already called any RR overrides uintptr_t carry; //è¿›è¡Œå¼•ç”¨è®¡æ•°-1æ“ä½œï¼Œå³extra_rc-1 newisa.bits = subc(newisa.bits, RC_ONE, 0, &amp;carry); // extra_rc-- //å¦‚æœæ­¤æ—¶extra_rcçš„å€¼ä¸º0äº†ï¼Œåˆ™èµ°åˆ°underflow if (slowpath(carry)) &#123; // don&#x27;t ClearExclusive() goto underflow; &#125; &#125; while (slowpath(!StoreReleaseExclusive(&amp;isa.bits, oldisa.bits, newisa.bits))); if (slowpath(sideTableLocked)) sidetable_unlock(); return false; underflow: // newisa.extra_rc-- underflowed: borrow from side table or deallocate // abandon newisa to undo the decrement newisa = oldisa; //åˆ¤æ–­æ•£åˆ—è¡¨ä¸­æ˜¯å¦å­˜å‚¨äº†ä¸€åŠçš„å¼•ç”¨è®¡æ•° if (slowpath(newisa.has_sidetable_rc)) &#123; if (!handleUnderflow) &#123; ClearExclusive(&amp;isa.bits); return rootRelease_underflow(performDealloc); &#125; // Transfer retain count from side table to inline storage. if (!sideTableLocked) &#123; ClearExclusive(&amp;isa.bits); sidetable_lock(); sideTableLocked = true; // Need to start over to avoid a race against // the nonpointer -&gt; raw pointer transition. goto retry; &#125; // Try to remove some retain counts from the side table. //ä»æ•£åˆ—è¡¨ä¸­å–å‡ºå­˜å‚¨çš„ä¸€åŠå¼•ç”¨è®¡æ•° size_t borrowed = sidetable_subExtraRC_nolock(RC_HALF); // To avoid races, has_sidetable_rc must remain set // even if the side table count is now zero. if (borrowed &gt; 0) &#123; // Side table retain count decreased. // Try to add them to the inline count. //è¿›è¡Œ-1æ“ä½œï¼Œç„¶åå­˜å‚¨åˆ°extra_rcä¸­ newisa.extra_rc = borrowed - 1; // redo the original decrement too bool stored = StoreReleaseExclusive(&amp;isa.bits, oldisa.bits, newisa.bits); if (!stored) &#123; // Inline update failed. // Try it again right now. This prevents livelock on LL/SC // architectures where the side table access itself may have // dropped the reservation. isa_t oldisa2 = LoadExclusive(&amp;isa.bits); isa_t newisa2 = oldisa2; if (newisa2.nonpointer) &#123; uintptr_t overflow; newisa2.bits = addc(newisa2.bits, RC_ONE * (borrowed-1), 0, &amp;overflow); if (!overflow) &#123; stored = StoreReleaseExclusive(&amp;isa.bits, oldisa2.bits, newisa2.bits); &#125; &#125; &#125; if (!stored) &#123; // Inline update failed. // Put the retains back in the side table. sidetable_addExtraRC_nolock(borrowed); goto retry; &#125; // Decrement successful after borrowing from side table. // This decrement cannot be the deallocating decrement - the side // table lock and has_sidetable_rc bit ensure that if everyone // else tried to -release while we worked, the last one would block. sidetable_unlock(); return false; &#125; else &#123; // Side table is empty after all. Fall-through to the dealloc path. &#125; &#125; //æ­¤æ—¶extra_rcä¸­å€¼ä¸º0ï¼Œæ•£åˆ—è¡¨ä¸­ä¹Ÿæ˜¯ç©ºçš„ï¼Œåˆ™ç›´æ¥è¿›è¡Œææ„ï¼Œå³è‡ªåŠ¨è§¦å‘deallocæµç¨‹ // Really deallocate. //è§¦å‘deallocçš„æ—¶æœº if (slowpath(newisa.deallocating)) &#123; ClearExclusive(&amp;isa.bits); if (sideTableLocked) sidetable_unlock(); return overrelease_error(); // does not actually return &#125; newisa.deallocating = true; if (!StoreExclusive(&amp;isa.bits, oldisa.bits, newisa.bits)) goto retry; if (slowpath(sideTableLocked)) sidetable_unlock(); __c11_atomic_thread_fence(__ATOMIC_ACQUIRE); if (performDealloc) &#123; //å‘é€ä¸€ä¸ªdeallocæ¶ˆæ¯ ((void(*)(objc_object *, SEL))objc_msgSend)(this, @selector(dealloc)); &#125; return true;&#125; æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œrelease çš„åº•å±‚æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º dealloc æºç åˆ†æåœ¨ retain å’Œ release çš„åº•å±‚å®ç°ä¸­ï¼Œéƒ½æåŠäº† dealloc ææ„å‡½æ•°ï¼Œä¸‹é¢æ¥åˆ†æ dealloc çš„åº•å±‚å®ç° è¿›å…¥ dealloc -&gt; _objc_rootDealloc -&gt; rootDealloc æºç å®ç°ï¼Œä¸»è¦æœ‰ä¸¤ä»¶äº‹ï¼š æ ¹æ®æ¡ä»¶ åˆ¤æ–­æ˜¯å¦æœ‰isaã€cxxã€å…³è”å¯¹è±¡ã€è‹¥å¼•ç”¨è¡¨ã€å¼•ç”¨è®¡æ•°è¡¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ ç›´æ¥freeé‡Šæ”¾å†…å­˜ å¦‚æœæœ‰ï¼Œåˆ™è¿›å…¥ object_diapose æ–¹æ³• 1234567891011121314151617181920212223inline voidobjc_object::rootDealloc()&#123; //å¯¹è±¡è¦é‡Šæ”¾ï¼Œéœ€è¦åšå“ªäº›äº‹æƒ…ï¼Ÿ //1ã€isa - cxx - å…³è”å¯¹è±¡ - å¼±å¼•ç”¨è¡¨ - å¼•ç”¨è®¡æ•°è¡¨ //2ã€free if (isTaggedPointer()) return; // fixme necessary? //å¦‚æœæ²¡æœ‰è¿™äº›ï¼Œåˆ™ç›´æ¥free if (fastpath(isa.nonpointer &amp;&amp; !isa.weakly_referenced &amp;&amp; !isa.has_assoc &amp;&amp; !isa.has_cxx_dtor &amp;&amp; !isa.has_sidetable_rc)) &#123; assert(!sidetable_present()); free(this); &#125; else &#123; //å¦‚æœæœ‰ object_dispose((id)this); &#125;&#125; è¿›å…¥ object_dispose æºç ï¼Œå…¶ç›®çš„æœ‰ä»¥ä¸‹å‡ ä¸ª é”€æ¯å®ä¾‹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æ“ä½œ è°ƒç”¨c++ææ„å‡½æ•° åˆ é™¤å…³è”å¼•ç”¨ é‡Šæ”¾æ•£åˆ—è¡¨ æ¸…ç©ºå¼±å¼•ç”¨è¡¨ freeé‡Šæ”¾å†…å­˜ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566id object_dispose(id obj)&#123; if (!obj) return nil; //é”€æ¯å®ä¾‹è€Œä¸ä¼šé‡Šæ”¾å†…å­˜ objc_destructInstance(obj); //é‡Šæ”¾å†…å­˜ free(obj); return nil;&#125;ğŸ‘‡void *objc_destructInstance(id obj) &#123; if (obj) &#123; // Read all of the flags at once for performance. bool cxx = obj-&gt;hasCxxDtor(); bool assoc = obj-&gt;hasAssociatedObjects(); // This order is important. //è°ƒç”¨C ++ææ„å‡½æ•° if (cxx) object_cxxDestruct(obj); //åˆ é™¤å…³è”å¼•ç”¨ if (assoc) _object_remove_assocations(obj); //é‡Šæ”¾ obj-&gt;clearDeallocating(); &#125; return obj;&#125;ğŸ‘‡inline void objc_object::clearDeallocating()&#123; //åˆ¤æ–­æ˜¯å¦ä¸ºnonpointer isa if (slowpath(!isa.nonpointer)) &#123; // Slow path for raw pointer isa. //å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥é‡Šæ”¾æ•£åˆ—è¡¨ sidetable_clearDeallocating(); &#125; //å¦‚æœæ˜¯ï¼Œæ¸…ç©ºå¼±å¼•ç”¨è¡¨ + æ•£åˆ—è¡¨ else if (slowpath(isa.weakly_referenced || isa.has_sidetable_rc)) &#123; // Slow path for non-pointer isa with weak refs and/or side table data. clearDeallocating_slow(); &#125; assert(!sidetable_present());&#125;ğŸ‘‡NEVER_INLINE voidobjc_object::clearDeallocating_slow()&#123; ASSERT(isa.nonpointer &amp;&amp; (isa.weakly_referenced || isa.has_sidetable_rc)); SideTable&amp; table = SideTables()[this]; table.lock(); if (isa.weakly_referenced) &#123; //æ¸…ç©ºå¼±å¼•ç”¨è¡¨ weak_clear_no_lock(&amp;table.weak_table, (id)this); &#125; if (isa.has_sidetable_rc) &#123; //æ¸…ç©ºå¼•ç”¨è®¡æ•° table.refcnts.erase(this); &#125; table.unlock();&#125; æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œdealloc åº•å±‚çš„æµç¨‹å›¾å¦‚å›¾æ‰€ç¤º æ‰€ä»¥ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä»æœ€å¼€å§‹çš„ allocåº•å±‚åˆ†æ -&gt; retain -&gt; release -&gt; dealloc å°±å…¨éƒ¨ä¸²è”èµ·æ¥äº† retainCount æºç åˆ†æå¼•ç”¨è®¡æ•°çš„åˆ†æé€šè¿‡ä¸€ä¸ªé¢è¯•é¢˜æ¥è¯´æ˜ é¢è¯•é¢˜ï¼šallocåˆ›å»ºçš„å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸ºå¤šå°‘ï¼Ÿ å®šä¹‰å¦‚ä¸‹ä»£ç ï¼Œæ‰“å°å…¶å¼•ç”¨è®¡æ•° 12NSObject *objc = [NSObject alloc];NSLog(@&quot;%ld&quot;,CFGetRetainCount((__bridge CFTypeRef)objc)); å…¶æ‰“å°ç»“æœå¦‚ä¸‹ è¿›å…¥ retainCount -&gt; _objc_rootRetainCount -&gt; rootRetainCount æºç ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334- (NSUInteger)retainCount &#123; return _objc_rootRetainCount(self);&#125;ğŸ‘‡uintptr_t_objc_rootRetainCount(id obj)&#123; ASSERT(obj); return obj-&gt;rootRetainCount();&#125;ğŸ‘‡inline uintptr_t objc_object::rootRetainCount()&#123; if (isTaggedPointer()) return (uintptr_t)this; sidetable_lock(); isa_t bits = LoadExclusive(&amp;isa.bits); ClearExclusive(&amp;isa.bits); //å¦‚æœæ˜¯nonpointer isaï¼Œæ‰æœ‰å¼•ç”¨è®¡æ•°çš„ä¸‹å±‚å¤„ç† if (bits.nonpointer) &#123; //allocåˆ›å»ºçš„å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º0ï¼ŒåŒ…æ‹¬sideTable,æ‰€ä»¥å¯¹äºallocæ¥è¯´ï¼Œæ˜¯ 0+1=1ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé€šè¿‡retaincountè·å–çš„å¼•ç”¨è®¡æ•°ä¸º1çš„åŸå›  uintptr_t rc = 1 + bits.extra_rc; if (bits.has_sidetable_rc) &#123; rc += sidetable_getExtraRC_nolock(); &#125; sidetable_unlock(); return rc; &#125; //å¦‚æœä¸æ˜¯ï¼Œåˆ™æ­£å¸¸è¿”å› sidetable_unlock(); return sidetable_retainCount();&#125; åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æºç æ–­ç‚¹è°ƒè¯•ï¼Œæ¥æŸ¥çœ‹æ­¤æ—¶çš„ extra_rc çš„å€¼ï¼Œç»“æœå¦‚ä¸‹ ç­”æ¡ˆï¼š ç»¼ä¸Šæ‰€è¿°ï¼Œalloc åˆ›å»ºçš„å¯¹è±¡ å®é™…çš„å¼•ç”¨è®¡æ•°ä¸º0ï¼Œå…¶å¼•ç”¨è®¡æ•°æ‰“å°ç»“æœä¸º1ï¼Œæ˜¯å› ä¸ºåœ¨åº•å±‚ rootRetainCount æ–¹æ³•ä¸­ï¼Œå¼•ç”¨è®¡æ•°é»˜è®¤+1 äº†ï¼Œä½†æ˜¯è¿™é‡Œ åªæœ‰ å¯¹å¼•ç”¨è®¡æ•°çš„ è¯»å– æ“ä½œï¼Œæ˜¯æ²¡æœ‰å†™å…¥æ“ä½œçš„ï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼šä¸ºäº†é˜²æ­¢allocåˆ›å»ºçš„å¯¹è±¡è¢«é‡Šæ”¾ï¼ˆå¼•ç”¨è®¡æ•°ä¸º0ä¼šè¢«é‡Šæ”¾ï¼‰ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘é˜¶æ®µï¼Œç¨‹åºåº•å±‚é»˜è®¤è¿›è¡Œäº†+1æ“ä½œã€‚å®é™…ä¸Šåœ¨extra_rcä¸­çš„å¼•ç”¨è®¡æ•°ä»ç„¶è¯¶0 æ€»ç»“ alloc åˆ›å»ºçš„å¯¹è±¡ æ²¡æœ‰retain å’Œ release alloc åˆ›å»ºå¯¹è±¡çš„ å¼•ç”¨è®¡æ•°ä¸º0ï¼Œä¼šåœ¨ ç¼–è¯‘æ—¶æœŸï¼Œç¨‹åº é»˜è®¤åŠ 1ï¼Œæ‰€ä»¥è¯»å–å¼•ç”¨è®¡æ•°æ—¶ä¸º1","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†34ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸‰ï¼‰äºŒè¿›åˆ¶é‡æ’","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†34ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸‰ï¼‰äºŒè¿›åˆ¶é‡æ’","date":"2021-05-17T06:44:54.000Z","updated":"2023-02-28T02:40:18.130Z","comments":true,"path":"2021/05/17/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†34ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸‰ï¼‰äºŒè¿›åˆ¶é‡æ’/","link":"","permalink":"https://www.bboyzj.cn/2021/05/17/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8634%EF%BC%9A%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%EF%BC%88%E4%B8%89%EF%BC%89%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%87%8D%E6%8E%92/","excerpt":"","text":"å‰è¨€åœ¨ä¹‹å‰çš„ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œå¤§è‡´ä»‹ç»äº†ä¸€äº›åŸºæœ¬æ¦‚å¿µä»¥åŠå¯åŠ¨ä¼˜åŒ–çš„æ€è·¯ï¼Œä¸‹é¢æ¥ç€é‡ä»‹ç»ä¸€ä¸ª pre-mainé˜¶æ®µ çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå³ äºŒè¿›åˆ¶é‡æ’ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ€å¼€å§‹æ˜¯ç”±æŠ–éŸ³çš„è¿™ç¯‡æ–‡ç« æŠ–éŸ³ç ”å‘å®è·µï¼šåŸºäºäºŒè¿›åˆ¶æ–‡ä»¶é‡æ’çš„è§£å†³æ–¹æ¡ˆ APPå¯åŠ¨é€Ÿåº¦æå‡è¶…15% æå‡ºæ¥çš„ã€‚ äºŒè¿›åˆ¶é‡æ’å®ç°åœ¨è™šæ‹Ÿå†…å­˜éƒ¨åˆ†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå½“è¿›ç¨‹è®¿é—®ä¸€ä¸ªè™šæ‹Ÿå†…å­˜pageï¼Œè€Œå¯¹åº”çš„ç‰©ç†å†…å­˜ä¸å­˜åœ¨æ—¶ï¼Œä¼šè§¦å‘ ç¼ºé¡µä¸­æ–­ï¼ˆPage Faultï¼‰ï¼Œå› æ­¤é˜»å¡è¿›ç¨‹ï¼Œæ­¤æ—¶å°±éœ€è¦å…ˆåŠ è½½æ•°æ®åˆ°ç‰©ç†å†…å­˜ï¼Œç„¶åç»§ç»­è®¿é—®ï¼Œè¿™ä¸ªå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“çš„ã€‚å¦‚æœå­˜åœ¨å¤§é‡çš„ ç¼ºé¡µä¸­æ–­ï¼Œä¼šéå¸¸çš„è€—æ—¶ã€‚ åŸºäº Page faultï¼Œæˆ‘ä»¬æ€è€ƒï¼ŒAPPåœ¨å†·å´å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å¤§é‡çš„ç±»ã€åˆ†ç±»ã€ä¸‰æ–¹ç­‰éœ€è¦åŠ è½½å’Œæ‰§è¡Œï¼Œæ­¤æ—¶äº§ç”Ÿçš„ Page Fault æ‰€å¸¦æ¥çš„çš„è€—æ—¶æ˜¯å¾ˆå¤§çš„ï¼Œä»¥ å®é™…é¡¹ç›® ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œåœ¨å¯åŠ¨é˜¶æ®µçš„ Page Fault çš„æ¬¡æ•° CMD + i å¿«æ·é”®ï¼Œé€‰æ‹© System Trace ç‚¹å‡»å¯åŠ¨ï¼ˆå¯åŠ¨å‰éœ€è¦é‡å¯æ‰‹æœºï¼Œæ¸…é™¤ç¼“å­˜æ•°æ®ï¼‰ï¼Œç¬¬ä¸€ä¸ªç•Œé¢å‡ºæ¥åï¼Œåœæ‰ï¼ŒæŒ‰ç…§ä¸‹å›¾ä¸­æ“ä½œ ä»å›¾ä¸­å¯ä»¥çœ‹å‡º å®é™…é¡¹ç›® å‘ç”Ÿçš„ Page Fault æœ‰ 1101 æ¬¡ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œè¿™ä¸ªæ˜¯éå¸¸å½±å“æ€§èƒ½çš„ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡DemoæŸ¥çœ‹æ–¹æ³•åœ¨ç¼–è¯‘æ—¶æœŸçš„æ’åˆ—é¡ºåºï¼Œåœ¨ViewControllerä¸­æŒ‰ä¸‹åˆ—é¡ºåºå®šä¹‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³• 123456789101112131415161718void test1()&#123; printf(&quot;1&quot;);&#125;void test2()&#123; printf(&quot;2&quot;);&#125;- (void)viewDidLoad &#123; [super viewDidLoad]; test1();&#125;+ (void)load&#123; printf(&quot;3&quot;); test2();&#125; åœ¨ Build Setting -&gt; write Link Map File è®¾ç½®ä¸º YES CMD + B ç¼–è¯‘ Demoï¼ŒæŸ¥çœ‹ æ‰§è¡Œé¡ºåº æ‰“å°ç»“æœä¸º 3 2 1ï¼Œé‚£ä¹ˆä»£ç çš„ åŠ è½½é¡ºåº æ˜¯ä»€ä¹ˆï¼Ÿshow in finder åœ¨å¯¹åº”è·¯å¾„ä¸‹æŸ¥æ‰¾ link map æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ‰“å¼€.txtæ–‡ä»¶ï¼Œå¯ä»¥å‘ç°ç±»ä¸­ å‡½æ•°çš„åŠ è½½é¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹ çš„ï¼Œè€Œ æ–‡ä»¶ çš„é¡ºåºæ˜¯æ ¹æ® Buid Phases -&gt; Compile Source ä¸­çš„é¡ºåºåŠ è½½çš„ ä»ä¸Šé¢çš„ Page fault çš„æ¬¡æ•°ä»¥åŠåŠ è½½é¡ºåºï¼Œå¯ä»¥å‘ç°å…¶å® å¯¼è‡´ Page Fault æ¬¡æ•°è¿‡å¤šçš„æ ¹æœ¬åŸå› æ˜¯å¯åŠ¨æ—¶åˆ»éœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå¤„äºä¸åŒçš„ Page Fault å¯¼è‡´çš„ï¼Œå› æ­¤æˆ‘ä»¬çš„ä¼˜åŒ–æ€è·¯å°±æ˜¯ï¼šå°†æ‰€æœ‰å¯åŠ¨æ—¶åˆ»éœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œæ’åˆ—åœ¨ä¸€èµ·ï¼Œå³æ”¾åœ¨ä¸€ä¸ªé¡µä¸­ï¼Œè¿™æ ·å°±ä»å¤šä¸ª Page Faultå˜æˆäº†ä¸€ä¸ªPage Faultï¼Œè¿™å°±æ˜¯ äºŒè¿›åˆ¶é‡æ’ çš„æ ¸å¿ƒåŸç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š æ³¨æ„ï¼šåœ¨iOSç”Ÿæˆç¯å¢ƒä¸­çš„APPï¼Œåœ¨å‘ç”ŸPage Faultè¿›è¡Œé‡æ–°åŠ è½½æ—¶ï¼ŒiOSç³»ç»Ÿè¿˜ä¼šå¯¹å…¶åšä¸€æ¬¡ ç­¾åéªŒè¯ï¼Œå› æ­¤ iOS ç”Ÿäº§ç¯å¢ƒçš„ Page Fault æ¯” Debugç¯å¢ƒä¸‹æ‰€äº§ç”Ÿçš„è€—æ—¶æ›´å¤š äºŒè¿›åˆ¶é‡æ’å®è·µä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¿›è¡Œå…·ä½“çš„å®è·µï¼Œé¦–å…ˆå…ˆç†è§£å‡ ä¸ªåè¯ Link Map linkmap æ˜¯iOSç¼–è¯‘è¿‡ç¨‹çš„ä¸­é—´äº§ç‰©ï¼Œè®°å½•äº†äºŒè¿›åˆ¶æ–‡ä»¶çš„å¸ƒå±€ï¼Œéœ€è¦åœ¨Xcodeçš„ Build Settings é‡Œé¢å¼€å¯ Write Link Map Fileï¼ŒLink Map ä¸»è¦åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š Object Files ï¼šç”ŸæˆäºŒè¿›åˆ¶ç”¨åˆ°çš„linkå•å…ƒçš„è·¯å¾„å’Œæ–‡ä»¶ç¼–å· Sections ï¼šè®°å½•Mach-Oæ¯ä¸ªSegment/Sectionçš„åœ°å€èŒƒå›´ Symbols ï¼šæŒ‰ç…§é¡ºåºè®°å½•æ¯ä¸ªç¬¦å·çš„åœ°å€èŒƒå›´ ld ld æ˜¯Xcodeä½¿ç”¨çš„é“¾æ¥å™¨ï¼Œæœ‰ä¸€ä¸ªå‚æ•° order_fileï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ Build Settings -&gt; Order Files é…ç½®ä¸€ä¸ªåç¼€ä¸º order çš„æ–‡ä»¶è·¯å¾„ï¼Œåœ¨è¿™ä¸ª order æ–‡ä»¶ä¸­ï¼Œå°†æ‰€éœ€è¦çš„ç¬¦å·æŒ‰ç…§é¡ºåºå†™åœ¨é‡Œé¢ï¼Œåœ¨é¡¹ç›®ç¼–è¯‘æ—¶ï¼Œä¼šæ‰¾æ‰¾è¿™ä¸ªæ–‡ä»¶çš„é¡ºåºè¿›è¡ŒåŠ è½½ï¼Œä»¥æ­¤æ¥è¾¾åˆ°æˆ‘ä»¬çš„ä¼˜åŒ– æ‰€ä»¥è¯´ï¼ŒäºŒè¿›åˆ¶é‡æ’çš„æœ¬è´¨å°±æ˜¯å¯¹å¯åŠ¨åŠ è½½çš„ç¬¦å·è¿›è¡Œé‡æ–°æ’åˆ— åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŸç†æˆ‘ä»¬åŸºæœ¬å¼„æ¸…æ¥šäº†ï¼Œå¦‚æœé¡¹ç›®æ¯”è¾ƒå°ï¼Œå®Œå…¨å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª order æ–‡ä»¶ï¼Œå°†æ–¹æ³•çš„é¡ºåºæ‰‹åŠ¨æ·»åŠ ï¼Œä½†æ˜¯å¦‚æœé¡¹ç›®æ¯”è¾ƒå¤§ï¼Œè®¾è®¡åˆ°çš„æ–¹æ³•ç‰¹åˆ«å¤šï¼Œæ­¤æ—¶æˆ‘ä»¬å¦‚ä½•è·å–å¯åŠ¨è¿è¡Œçš„å‡½æ•°å‘¢ï¼Ÿæœ‰ä»¥ä¸‹å‡ ç§æ€è·¯ï¼š hook objc_msgsSendï¼šæˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°çš„æœ¬è´¨å°±æ˜¯å‘é€æ¶ˆæ¯ï¼Œåœ¨åº•å±‚éƒ½ä¼šæ¥åˆ° objc_msgSendï¼Œä½†æ˜¯ç”±äºobjc_msgSendçš„å‚æ•°æ˜¯å¯å˜çš„ï¼Œéœ€è¦é€šè¿‡ æ±‡ç¼– è·å–ï¼Œå¯¹å¼€å‘äººå‘˜è¦æ±‚è¾ƒé«˜ï¼Œè€Œä¸”ä¹Ÿåªèƒ½æ‹¿åˆ° oc å’Œ swift ä¸­ @objc åçš„æ–¹æ³• é™æ€æ‰«æï¼šæ‰«æ mach-o ç‰¹å®šæ®µå’ŒèŠ‚é‡Œé¢æ‰€å­˜å‚¨çš„ç¬¦å·ä¸€çº§å‡½æ•°æ•°æ® Clangæ’æ¡©ï¼šå³ æ‰¹é‡hookï¼Œå¯ä»¥å®ç° 100%ç¬¦å·è¦†ç›–ï¼Œå³å®Œå…¨è·å– swiftã€ocã€blockå‡½æ•° è‡ªå®šä¹‰ order æ–‡ä»¶ï¼Œæ”¹å˜æ‰§è¡Œé¡ºåº cd åˆ° Demo æ ¹ç›®å½•ï¼Œæ–°å»º orderæ–‡ä»¶ 12zhangjian@zhangjiandeMBP ~ % cd /Users/zhangjian/Desktop/Demo zhangjian@zhangjiandeMBP Demo % touch zj.order order æ–‡ä»¶ä¸­ä¹¦å†™å¦‚ä¸‹å†…å®¹ åœ¨ build setting æœç´¢ order file å°†æ ¹ç›®å½•ä¸‹çš„orderæ–‡ä»¶è·¯å¾„å¡«å…¥ï¼š./zj.order cmd + b é‡æ–°ç¼–è¯‘ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜æœ‰ä¸€ä¸ªç¬¦å·æ²¡æœ‰æ‰¾ä¸åˆ°ä¼šè‡ªåŠ¨æˆ–ç•¥æ‰ï¼Œç»§ç»­æŸ¥çœ‹ link map æ–‡ä»¶ ç”±ä¸Šå›¾å¯çŸ¥ï¼Œmainå˜æˆç¬¬ä¸€ä½ã€viewDidLoadå˜æˆç¬¬äºŒä½ã€test1å˜æˆç¬¬ä¸‰ä½ï¼Œè¿™å°±æ˜¯äºŒè¿›åˆ¶é‡æ’ Clang æ’æ¡© llvm å†…ç½®äº†ä¸€ä¸ªç®€å•çš„ä»£ç è¦†ç›–ç‡æ£€æµ‹ï¼ˆSanitizerCoverageï¼‰ï¼Œå®ƒåœ¨å‡½æ•°çº§ã€åŸºæœ¬å—çº§å’Œè¾¹ç¼˜çº§æ’å…¥å¯¹ç”¨æˆ·å®šä¹‰å‡½æ•°çš„è°ƒç”¨ï¼Œæˆ‘ä»¬è¿™é‡Œçš„æ‰¹é‡hookï¼Œå°±éœ€è¦å€ŸåŠ©äº SanitizerCoverage å…³äºclangçš„æ’æ¡©è¦†ç›–çš„å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹ï¼šclangè‡ªå¸¦ä»£ç è¦†ç›–å·¥å…· æ–‡æ¡£ä¸­æœ‰è¯¦ç»†æ¦‚è¿°ï¼Œä»¥åŠç®€çŸ­Demoæ¼”ç¤º ã€ç¬¬ä¸€æ­¥ï¼šé…ç½®ã€‘å¼€å¯ SanitizerCoverage OCé¡¹ç›®ï¼Œéœ€è¦åœ¨ï¼šBuild Settings é‡Œé¢çš„ Other C Flags ä¸­æ·»åŠ  -fsanitize-coverage=trace-pc-guard æ­¤æ—¶ CMD + B ç¼–è¯‘ï¼Œä¼šæŠ¥ä¸¤ä¸ªç¬¦å·é”™è¯¯ï¼Œè¯´æ˜æ·»åŠ äº†ä¸Šé¢å°±ä¼šè°ƒç”¨ä¸‹é¢çš„ä¸¤ä¸ªç¬¦å·ï¼š __sanitizer_cov_trace_pc_guard_init å’Œ __sanitizer_cov_trace_pc_guard ã€ç¬¬äºŒæ­¥ï¼šé‡å†™æ–¹æ³•ã€‘ å°†å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•æ‹·è´åˆ° TraceDemo é¡¹ç›®ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºå¹¶è¿è¡Œï¼Œä¼šæŠ¥é”™æ‰¾ä¸ åˆ° __sanitizer_symbolize_pcï¼Œæˆ‘ä»¬å°†å…¶æ³¨é‡Šï¼Œå†æ¬¡è¿è¡Œï¼ŒæˆåŠŸ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#import &quot;ViewController.h&quot;// trace-pc-guard-cb.cc#include &lt;stdint.h&gt;#include &lt;stdio.h&gt;#include &lt;sanitizer/coverage_interface.h&gt;@interface ViewController ()@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view.&#125;void test1()&#123; &#125;void (^block1)(void) = ^&#123; &#125;;void __sanitizer_cov_trace_pc_guard_init(uint32_t *start, uint32_t *stop) &#123; static uint64_t N; // Counter for the guards. if (start == stop || *start) return; // Initialize only once. printf(&quot;INIT: %p %p\\n&quot;, start, stop); for (uint32_t *x = start; x &lt; stop; x++) *x = ++N; // Guards should start from 1.&#125;void __sanitizer_cov_trace_pc_guard(uint32_t *guard) &#123; // å°†loadæ–¹æ³•è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥éœ€è¦æ³¨é‡Šæ‰ if (!*guard) return; // è·å–PC /* - PC å½“å‰å‡½æ•°è¿”å›ä¸Šä¸€ä¸ªè°ƒç”¨çš„åœ°å€ - 0 å½“å‰è¿™ä¸ªå‡½æ•°åœ°å€ï¼Œå³å½“å‰å‡½æ•°çš„è¿”å›åœ°å€ - 1 å½“å‰å‡½æ•°è°ƒç”¨è€…çš„åœ°å€ï¼Œå³ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›åœ°å€ */ void *PC = __builtin_return_address(0); char PcDescr[1024]; // å†æ¬¡è¿è¡Œè¿™ä¸ªç¬¦å·æ‰¾ä¸åˆ°ï¼Œæ‰¾ä¸åˆ°æˆ‘å°±ä¸è°ƒç”¨äº†å—ï¼Œåˆ æ‰ // __sanitizer_symbolize_pc(PC, &quot;%p %F %L&quot;, PcDescr, sizeof(PcDescr)); printf(&quot;guard: %p %x PC %s\\n&quot;, guard, *guard, PcDescr);&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; test1(); block1();&#125; __sanitizer_cov_trace_pc_guard_init æ–¹æ³• ç”±ä¸Šé¢è¿è¡Œç»“æœå¯çŸ¥ï¼Œstart &#x3D; 0x10204d3a0ï¼Œstop &#x3D; 0x10204d3d8,é‚£ä¹ˆè¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ å‚æ•°1 start æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æ— ç¬¦å·intlç±»å‹ï¼Œ4ä¸ªå­—èŠ‚ï¼Œç›¸å½“äºä¸€ä¸ªæ•°ç»„çš„ èµ·å§‹ä½ç½®ï¼Œå³ç¬¦å·çš„èµ·å§‹ä½ç½®ï¼ˆæ˜¯ä»é«˜ä½å¾€ä½ä½è¯»ï¼‰ å‚æ•°2 stop ï¼Œç”±äºæ•°æ®çš„åœ°å€æ˜¯å¾€ä¸‹è¯»çš„ï¼ˆå³ ä»é«˜å¾€ä½è¯»ï¼Œæ‰€ä»¥æ­¤æ—¶è·å–çš„åœ°å€å¹¶ä¸æ˜¯stopçœŸæ­£çš„åœ°å€ï¼Œè€Œæ˜¯æ ‡è®°çš„æœ€åçš„åœ°å€ï¼Œè¯»å–stopæ—¶ï¼Œç”±äºstopå äº†4ä¸ªå­—èŠ‚ï¼Œstop çœŸå®åœ°å€ &#x3D; stopæ‰“å°çš„åœ°å€-0x4ï¼‰ stop å†…å­˜åœ°å€ä¸­å­˜å‚¨çš„å€¼è¡¨ç¤ºä»€ä¹ˆï¼Ÿåœ¨å¢åŠ ä¸€ä¸ª æ–¹æ³•/block/å±æ€§ åï¼Œå‘ç°å…¶å€¼ä¹Ÿä¼šå¢åŠ å¯¹åº”çš„æ•°ï¼Œä¾‹å¦‚å¢åŠ ä¸€ä¸ª touchesBeganæ–¹æ³•ï¼Œè¿è¡Œå¹¶æ‰“å°å¾—åˆ° INIT: 0x104f0d3a8 0x104f0d3e4ï¼Œé‡æ–°æŸ¥çœ‹ start å’Œ stop çš„å€¼ï¼š ç”±æ­¤å¯è§ å¢åŠ ä¸€ä¸ªæ–¹æ³• å¯¹åº” stopå€¼å°±å¢åŠ ä¸€ä¸ª ã€ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡è¿”å›åœ°å€æ‹¿åˆ°ç¬¦å·ã€‘ __sanitizer_cov_trace_pc_guard æ–¹æ³•ï¼Œä¸»è¦æ˜¯æ•è·æ‰€æœ‰çš„å¯åŠ¨æ—¶åˆ»çš„ç¬¦å·ï¼Œå°†æ‰€æœ‰ç¬¦å·å…¥é˜Ÿ å‚æ•° guard æ˜¯ä¸€ä¸ª å“¨å…µï¼Œå‘Šè¯‰æˆ‘ä»¬æ˜¯ ç¬¬å‡ ä¸ªè¢«è°ƒç”¨çš„ å¼•å…¥åº“ #import &lt;dlfcn.h&gt; ï¼Œå¹¶ç‚¹å‡»å±å¹•å¯ä»¥é€šè¿‡è¿”å›åœ°å€æ‹¿åˆ°ç¬¦å· 123456789101112131415void __sanitizer_cov_trace_pc_guard(uint32_t *guard) &#123; if (!*guard) return; // å½“å‰è¿”å›ä¸Šä¸€ä¸ªè°ƒç”¨çš„åœ°å€ void *PC = __builtin_return_address(0); // é€šè¿‡è¿”å›åœ°å€PCï¼Œè·å–ç¬¦å· Dl_info info; dladdr(PC, &amp;info); printf(&quot;frame:%s \\nfbase:%p \\nsname:%s \\nsaddr:%p\\n\\n&quot;,info.dli_fname,info.dli_fbase,info.dli_sname,info.dli_saddr); char PcDescr[1024]; // å†æ¬¡è¿è¡Œè¿™ä¸ªç¬¦å·æ‰¾ä¸åˆ°ï¼Œæ‰¾ä¸åˆ°æˆ‘å°±ä¸è°ƒç”¨äº†å—ï¼Œåˆ æ‰ // y__sanitizer_symbolize_pc(PC, &quot;%p %F %L&quot;, PcDescr, sizeof(PcDescr)); // printf(&quot;guard: %p %x PC %s\\n&quot;, guard, *guard, PcDescr);&#125; æŸ¥çœ‹æ‰“å°ç»“æœ 123456789101112131415161718// æ–‡ä»¶çš„å†…å­˜åœ°å€frame:/private/var/containers/Bundle/Application/A9B590E7-FC2A-4C54-85C1-FFFE55ACE448/TraceDemo.app/TraceDemo // æ–‡ä»¶å†…å­˜åœ°å€fbase:0x10251c000 // ç¬¦å·åç§°sname:-[ViewController touchesBegan:withEvent:] // èµ·å§‹ä½ç½®åœ°å€saddr:0x102521b78frame:/private/var/containers/Bundle/Application/A9B590E7-FC2A-4C54-85C1-FFFE55ACE448/TraceDemo.app/TraceDemo fbase:0x10251c000 sname:test1 saddr:0x1025219e0frame:/private/var/containers/Bundle/Application/A9B590E7-FC2A-4C54-85C1-FFFE55ACE448/TraceDemo.app/TraceDemo fbase:0x10251c000 sname:block1_block_invoke saddr:0x1025219fc ã€ç¬¬å››æ­¥ï¼šåˆ›å»ºé˜Ÿåˆ—ä¿å­˜ç¬¦å·ã€‘ å¼•å…¥å¤´æ–‡ä»¶ #import &lt;OSAtomic.h&gt;ï¼Œç¬¦å·çš„å­˜å‚¨éœ€è¦å€ŸåŠ©äºé“¾è¡¨ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰é“¾è¡¨èŠ‚ç‚¹ ZJNode é€šè¿‡ OSQueueHead åˆ›å»ºåŸå­é˜Ÿåˆ—ï¼Œå…¶ç›®çš„æ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨ é€šè¿‡ OSAtomicEnqueue æ–¹æ³•å°† node å…¥é˜Ÿï¼Œé€šè¿‡é“¾è¡¨ next æŒ‡é’ˆå¯ä»¥è®¿é—®ä¸‹ä¸€ä¸ªç¬¦å· 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// åŸå­é˜Ÿåˆ—-çº¿ç¨‹å®‰å…¨static OSQueueHead symbolList = OS_ATOMIC_QUEUE_INIT;// å®šä¹‰ç¬¦å·ç»“æ„ä½“ï¼Œä»¥é“¾è¡¨çš„å½¢å¼typedef struct&#123; // æŒ‡é’ˆ8ä¸ªå­—èŠ‚ void *pc; void *next;&#125;ZJNode;void __sanitizer_cov_trace_pc_guard(uint32_t *guard) &#123; // å°†loadæ–¹æ³•è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥éœ€è¦æ³¨é‡Šæ‰ if (!*guard) return; // å½“å‰è¿”å›ä¸Šä¸€ä¸ªè°ƒç”¨çš„åœ°å€ void *PC = __builtin_return_address(0); // åˆ›å»ºç»“æ„ä½“ ZJNode * node = malloc(sizeof(ZJNode)); *node = (ZJNode)&#123;PC,NULL&#125;; // åŠ å…¥ç»“æ„ä½“ // ç¬¦å·çš„è®¿é—®ä¸æ˜¯é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼Œæ˜¯é€šè¿‡é“¾è¡¨çš„nextæŒ‡é’ˆï¼Œæ‰€ä»¥éœ€è¦å€Ÿç”¨offsetofï¼ˆç»“æ„ä½“ç±»å‹ï¼Œä¸‹ä¸€ä¸ªçš„åœ°å€å³nextï¼‰ OSAtomicEnqueue(&amp;symbolList, node, offsetof(ZJNode, next)); // é€šè¿‡è¿”å›åœ°å€PCï¼Œè·å–ç¬¦å· Dl_info info; dladdr(PC, &amp;info); // printf(&quot;frame:%s \\nfbase:%p \\nsname:%s \\nsaddr:%p\\n\\n&quot;,info.dli_fname,info.dli_fbase,info.dli_sname,info.dli_saddr); char PcDescr[1024]; // å†æ¬¡è¿è¡Œè¿™ä¸ªç¬¦å·æ‰¾ä¸åˆ°ï¼Œæ‰¾ä¸åˆ°æˆ‘å°±ä¸è°ƒç”¨äº†å—ï¼Œåˆ æ‰ // y__sanitizer_symbolize_pc(PC, &quot;%p %F %L&quot;, PcDescr, sizeof(PcDescr)); // printf(&quot;guard: %p %x PC %s\\n&quot;, guard, *guard, PcDescr);&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; while (YES) &#123; // ä¸€æ¬¡å¾ªç¯ï¼ä¹Ÿä¼šè¢«HOOKä¸€æ¬¡ ZJNode * node = OSAtomicDequeue(&amp;symbolList, offsetof(ZJNode, next)); if (node == NULL) &#123; break; &#125; Dl_info info = &#123;0&#125;; dladdr(node-&gt;pc, &amp;info); printf(&quot;%s \\n&quot;,info.dli_sname); &#125;&#125; ã€ç¬¬äº”æ­¥ï¼šè§£å†³æ­»å¾ªç¯é—®é¢˜ã€‘ å½“æˆ‘ä»¬é‡æ–°è¿è¡Œï¼Œç‚¹å‡»å±å¹•ï¼Œä¼šå‘ç°ä¸€ç›´é‡æ–°æ‰“å°ï¼Œå‡ºç°æ­»å¾ªç¯ touchesBegan æˆ‘ä»¬æ‰“å¼€æ±‡ç¼–è°ƒå¼ï¼Œå‘ç°æœ‰ 3 ä¸ª __sanitizer_cov_trace_pc_guard è°ƒç”¨ ç¬¬ä¸€æ¬¡ bl æ˜¯ touchBeginï¼›ç¬¬äºŒæ¬¡æ˜¯å› ä¸º while å¾ªç¯ï¼Œå³åªè¦æ˜¯ è·³è½¬ï¼Œå°±ä¼šè¢« hookï¼Œå³æœ‰ bl&#x2F;b çš„æŒ‡ä»¤ï¼Œå°±ä¼šè¢« hookï¼›ç¬¬ä¸‰æ¬¡å°± printf è§£å†³æ–¹å¼ï¼šå°† Build Setting ä¸­çš„ Other C Flags çš„ -fsanitize-coverage=trace-pc-guard æ”¹æˆ -fsanitize-coverage=func,trace-pc-guardï¼Œå†æ¬¡è¿è¡Œï¼Œçœ‹ä¸‹é¢çš„ç»“æœæ˜¾ç¤ºå·²ç»æ²¡æœ‰æ­»å¾ªç¯äº† ç”±ä¸Šé¢çš„ç»“æœå¯çŸ¥ï¼Œè¿˜æœ‰å‡ ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼šé‡å¤ã€é¡ºåºæ˜¯åçš„ï¼Œå¹¶ä¸”æ²¡æœ‰load ã€ç¬¬å…­æ­¥ï¼šç”Ÿæˆæ•°ç»„å»é‡ã€å–åã€‘ æ·»åŠ  + load æ–¹æ³•ï¼ˆéœ€è¦æ³¨é‡Šæ‰if (!*guard) return;è¿™å¥ä»£ç ï¼‰ã€è°ƒç”¨testã€blockæ–¹æ³•ï¼Œé‡æ–°ç‚¹å‡»å±å¹•å¹¶æŸ¥çœ‹ç»“æœ 1234567891011121314151617+ (void)load&#123; &#125;- (void)viewDidLoad &#123; [super viewDidLoad]; test();&#125;void test()&#123; block();&#125;void (^block)(void) = ^&#123; &#125;; æŸ¥çœ‹æ‰“å°ç»“æœ å–åã€å»é‡ 1234567891011121314151617181920212223242526272829303132333435363738- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; // å®šä¹‰æ•°ç»„ NSMutableArray&lt;NSString *&gt; * symbolNames = [NSMutableArray array]; while (YES) &#123; ZJNode * node = OSAtomicDequeue(&amp;symbolList, offsetof(ZJNode, next)); if (node == NULL) &#123; break; &#125; Dl_info info = &#123;0&#125;; dladdr(node-&gt;pc, &amp;info);// printf(&quot;%s \\n&quot;,info.dli_sname); // è½¬æˆå­—ç¬¦ä¸² NSString * name = @(info.dli_sname); if ([name hasPrefix:@&quot;+[&quot;] || [name hasPrefix:@&quot;-[&quot;]) &#123; // å¦‚æœæ˜¯ocæ–¹æ³•åç§°ç›´æ¥å­˜ [symbolNames addObject:name]; continue; &#125; // å¦‚æœä¸æ˜¯ocç›´æ¥åŠ ä¸ª_å­˜ [symbolNames addObject:[@&quot;_&quot; stringByAppendingString:name]]; &#125; // åå‘éå†æ•°ç»„ symbolNames = (NSMutableArray&lt;NSString *&gt; *)[[symbolNames reverseObjectEnumerator] allObjects]; // å»é‡ NSEnumerator * enumerator = [symbolNames reverseObjectEnumerator]; NSMutableArray * funcs = [NSMutableArray arrayWithCapacity:symbolNames.count]; NSString * name; while (name = [enumerator nextObject])&#123; // æ•°ç»„ä¸­ä¸åŒ…å«name if (![funcs containsObject:name]) &#123; [funcs addObject:name]; &#125; &#125; NSLog(@&quot;%@&quot;,funcs);&#125; é‡æ–°è¿è¡Œï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœ ã€ç¬¬ä¸ƒæ­¥ï¼šç”Ÿæˆorderæ–‡ä»¶ã€‘ æ•°ç»„è½¬æˆå­—ç¬¦ä¸² 12// æ•°ç»„è½¬æˆå­—ç¬¦ä¸² NSString * funcStr = [symbolNames componentsJoinedByString:@&quot;\\n&quot;]; å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ 123456// å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ // æ–‡ä»¶è·¯å¾„ NSString * filePath = [NSTemporaryDirectory() stringByAppendingPathComponent:@&quot;zj.order&quot;]; // æ–‡ä»¶å†…å®¹ NSData * fileContents = [funcStr dataUsingEncoding:NSUTF8StringEncoding]; [[NSFileManager defaultManager] createFileAtPath:filePath contents:fileContents attributes:nil]; ã€ç¬¬å…«æ­¥ï¼šæ‰¾åˆ°orderæ–‡ä»¶ï¼Œå¹¶é…ç½®orderæ–‡ä»¶ã€‘ CMD + shift + 2 -&gt; Devices -&gt; TraceDemo -&gt; Download Container å°†æ–‡ä»¶ä¸‹è½½åˆ°æ¡Œé¢ -&gt; æ˜¾ç¤ºåŒ…å†…å®¹ -&gt; tmp -&gt; æ‰¾åˆ° zj.order é…ç½® zj.order åˆ°é¡¹ç›®ä¸­ï¼Œé¦–å…ˆ link map è®¾å€¼ä¸º YESï¼Œé…ç½®å‰ï¼š å°† zj.orderæ”¾åœ¨æ ¹ç›®å½•ï¼Œé…ç½® order file ä¸º ./zj.order ï¼Œé…ç½®åï¼š æ­¤æ—¶å‘ç°é…ç½®åçš„æ‰§è¡Œé¡ºåºå’Œé…ç½®å‰çš„æ‰§è¡Œé¡ºåºæœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼Œæ­¤æ—¶æ­¤æ—¶ äºŒè¿›åˆ¶é‡æ’æˆåŠŸã€‚ è¡¥å…… å¦‚æœæ˜¯Swifté¡¹ç›®ï¼Œè¿˜éœ€è¦é¢å¤–åœ¨ Other Swift Flags ä¸­åŠ å…¥ -sanitize-coverage=func å’Œ -sanitize=undefined OC å’Œ swift æ··ç¼– OC ä¸­å¼•å…¥å¤´æ–‡ä»¶ æŒ‰ç…§ä¸Šé¢çš„è¿›è¡Œé…ç½®å¹¶æŸ¥çœ‹ zj.order","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†33ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰ä¼˜åŒ–å»ºè®®","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†33ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰ä¼˜åŒ–å»ºè®®","date":"2021-05-11T07:19:40.000Z","updated":"2023-02-28T02:20:54.178Z","comments":true,"path":"2021/05/11/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†33ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰ä¼˜åŒ–å»ºè®®/","link":"","permalink":"https://www.bboyzj.cn/2021/05/11/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8633%EF%BC%9A%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE/","excerpt":"","text":"å†·å¯åŠ¨å’Œçƒ­å¯åŠ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸€èˆ¬æ˜¯æŒ‡ ä»ç”¨æˆ·ç‚¹å‡»APPå›¾æ ‡ åˆ° è¿›å…¥åˆ°APPé¡µé¢ çš„è¿‡ç¨‹ï¼Œä¸€èˆ¬åœ¨iOSå¼€å‘ä¸­åˆ†ä¸º å†·å¯åŠ¨ å’Œ çƒ­å¯åŠ¨ å†·å¯åŠ¨ï¼šç”¨æˆ·å°† è®¾å¤‡é‡å¯ æˆ–è€…æ˜¯ æ‰‹åŠ¨killæ‰APPè¿›ç¨‹ï¼Œåˆæˆ–è€…æ˜¯ APPé•¿æ—¶é—´æœªæ‰“å¼€è¿‡ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å¯åŠ¨APPå›¾æ ‡çš„è¿‡ç¨‹ï¼Œè¿™æ—¶éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ è¿›ç¨‹ åˆ†é…ç»™APPï¼Œå¹¶ä¸”å†…å­˜ä¸­ ä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œå¿…é¡»ä»ç£ç›˜ä¸­è½½å…¥æ•°æ®åˆ°å†…å­˜ä¸­çš„è¿‡ç¨‹ã€‚ çƒ­å¯åŠ¨ï¼šç”¨æˆ·åœ¨ä½¿ç”¨APPè¿‡ç¨‹ä¸­ï¼ŒæŒ‰ä¸‹ Homeé”®ï¼ŒAPPä¸ä¼šç«‹å³è¢«killæ‰ï¼Œè€Œæ˜¯å­˜æ´»ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´é‡Œç”¨æˆ·å†æ‰“å¼€APPï¼Œæ­¤æ—¶APPè¿˜åœ¨é€€åˆ°åå°å‰çš„çŠ¶æ€ï¼ŒAPPè¿›ç¨‹è¿˜åœ¨ç³»ç»Ÿä¸­ï¼Œæ— éœ€å¼€å¯æ–°çš„è¿›ç¨‹ï¼ŒAPPä¹Ÿä¸ä¼šé‡æ–°åŠ è½½æ•°æ®åˆ°å†…å­˜ä¸­çš„è¿‡ç¨‹ã€‚ å¯åŠ¨ä¼˜åŒ–æ¦‚å¿µWWDC 2016 ä¸­é¦–æ¬¡å‡ºç°äº†APPå¯åŠ¨ä¼˜åŒ–çš„è¯é¢˜ï¼Œå…¶ä¸­æåˆ°ï¼š Appå¯åŠ¨æœ€ä½³é€Ÿåº¦æ˜¯400msä»¥å†… ï¼Œå› ä¸ºä»ç‚¹å‡»Appå›¾æ ‡å¯åŠ¨ï¼Œç„¶å Launch Screen å‡ºç°å†æ¶ˆå¤±çš„æ—¶é—´å°±æ˜¯400msã€‚ Appå¯åŠ¨æœ€æ…¢ä¸å¾—å¤§äº20s ï¼Œå¦åˆ™è¿›ç¨‹ä¼šè¢«ç³»ç»Ÿæ€æ­» æˆ‘ä»¬è¿™é‡Œæ‰€è¯´çš„å¯åŠ¨ä¼˜åŒ–ï¼Œä¸€èˆ¬æ˜¯æŒ‡ å†·å¯åŠ¨ æƒ…å†µä¸‹çš„å¯åŠ¨ä¼˜åŒ–ï¼Œæ˜¯æŒ‡ç”¨æˆ·å”¤èµ·Appå¼€å§‹åˆ°AppDelegate ä¸­çš„ didFinishLaunchingWithOptions æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¸ºæ­¢ï¼Œå¹¶ä»¥ main() å‡½æ•°ä¸ºåˆ†ç•Œç‚¹ï¼Œåˆ†ä¸º pre-main å’Œ main() ä¸¤ä¸ªé˜¶æ®µï¼š pre-main é˜¶æ®µï¼šæ˜¯æŒ‡ä»ç”¨æˆ·å”¤èµ·Appåˆ° main() å‡½æ•°æ‰§è¡Œä¹‹å‰çš„è¿‡ç¨‹ main() é˜¶æ®µï¼šæ˜¯æŒ‡ main() å‡½æ•°å¼€å§‹æ‰§è¡Œåˆ° didFinishLaunchingWithOptions æ–¹æ³•æ‰§è¡Œç»“æŸçš„è¿‡ç¨‹ æ‰€ä»¥ï¼Œ pre-main() + main() çš„è¿‡ç¨‹å°±æ˜¯ä»ç”¨æˆ·ç‚¹å‡»Appå›¾æ ‡åˆ°ç”¨æˆ·èƒ½çœ‹åˆ°ä¸»ç•Œé¢çš„è¿‡ç¨‹ï¼Œå³éœ€è¦ä¼˜åŒ–çš„éƒ¨åˆ†ã€‚ pre-main()å¯åŠ¨ä¼˜åŒ–æˆ‘ä»¬åœ¨å‰é¢ OCåº•å±‚åŸç†15ï¼šdyldæºç åˆ†æ ä¸­ï¼Œå·²ç»äº†è§£äº†dyldçš„åŠ è½½æµç¨‹ï¼Œpre-main() é˜¶æ®µçš„ å¯åŠ¨æ—¶é—´ å°±æ˜¯ dyldåŠ è½½è¿‡ç¨‹çš„æ—¶é—´ é’ˆå¯¹ pre-main() é˜¶æ®µçš„å¯åŠ¨æ—¶é—´ï¼Œè‹¹æœæä¾›äº†APPå¯åŠ¨æ—¶é—´æ£€æµ‹æ–¹æ³•ï¼Œåœ¨ Product -&gt; Scheme -&gt; Edit Scheme -&gt; Environment Variables ç‚¹å‡» + å·æ·»åŠ ç¯å¢ƒå˜é‡ DYLD_PRINT_STATISTICS è®¾ä¸º 1ï¼Œå¦‚ä¸‹å›¾ï¼š ç„¶åè¿è¡Œï¼Œä»¥ä¸‹æ˜¯ æ‰‹æœºå‹å·iPhone11 14.4.2 å¯åŠ¨çš„æˆ‘ç›®å‰æ­£åœ¨å¼€å‘çš„ç”µå•†é¡¹ç›®çš„pre-main()æ—¶é—´ï¼š å¦‚æœæƒ³è¦æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼Œå°±è®¾ç½® DYLD_PRINT_STATISTICS_DETAILS ä¸º 1ï¼Œå¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š è¯´æ˜pre-main é˜¶æ®µæ€»å…±ç”¨æ—¶ 1.3s dylib loading time (åŠ¨æ€åº“è€—æ—¶)ï¼šä¸»è¦æ˜¯åŠ è½½åŠ¨æ€åº“ï¼Œç”¨æ—¶ 336.24ms rebase/binding time (åç§»ä¿®æ­£&#x2F;ç¬¦å·ç»‘å®šè€—æ—¶)ï¼Œè€—æ—¶ 61.26ms rebaseï¼ˆåç§»ä¿®æ­£ï¼‰ï¼šä»»ä½•ä¸€ä¸ªAppç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨äºŒè¿›åˆ¶æ–‡ä»¶å†…éƒ¨æ‰€æœ‰çš„æ–¹æ³•ã€å‡½æ•°è°ƒç”¨ï¼Œéƒ½æœ‰ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€æ˜¯åœ¨ å½“å‰äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„åç§»åœ°å€ã€‚ä¸€æ—¦åœ¨è¿è¡Œæ—¶åˆ»ï¼ˆå³è¿è¡Œåˆ°å†…å­˜ä¸­ï¼‰ï¼Œæ¯æ¬¡ç³»ç»Ÿéƒ½ä¼š éšæœºåˆ†é…ä¸€ä¸ªASLR(Address Space Layout Randomizationï¼Œèµ‹å€¼ç©ºé—´å¸ƒå±€éšæœºåŒ–)åœ°å€å€¼ï¼ˆæ˜¯ä¸€ä¸ªå®‰å…¨æœºåˆ¶ï¼Œä¼šåˆ†é…ä¸€ä¸ªéšæœºçš„æ•°å€¼ï¼Œæ’å…¥åœ¨äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼€å¤´ï¼‰ï¼Œä¾‹å¦‚ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªtestæ–¹æ³•ï¼Œåç§»å€¼æ˜¯ 0x001ï¼Œè€Œéšæœºåˆ†é…çš„ ASLR æ˜¯ 0x1000ï¼Œå¦‚æœæƒ³è®¿é—®testæ–¹æ³•ï¼Œå…¶å†…å­˜åœ°å€ï¼ˆå³çœŸæ˜¯åœ°å€ï¼‰å˜ä¸º ASLR+åç§»å€¼ = è¿è¡Œæ—¶ç¡®å®šçš„å†…å­˜åœ°å€ï¼ˆå³0x1000 + 0x0001 = 0x1001ï¼‰ bindingï¼ˆç»‘å®šï¼‰ï¼šä¾‹å¦‚ NSLogæ–¹æ³•ï¼Œåœ¨ç¼–è¯‘æ—¶æœŸ ç”Ÿæˆçš„ mach-oæ–‡ä»¶ä¸­ï¼Œä¼šåˆ›å»ºä¸€ä¸ªç¬¦å· !NSLogï¼ˆç›®å‰æŒ‡å‘ä¸€ä¸ªéšæœºçš„åœ°å€ï¼‰ï¼Œç„¶ååœ¨è¿è¡Œæ—¶ï¼ˆä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ˜¯ä¸€ä¸ªé•œåƒæ–‡ä»¶ï¼‰ï¼Œä¼šå°†çœŸæ­£çš„åœ°å€ç»™ç¬¦å·ï¼ˆå³åœ¨å†…å­˜ä¸­å°†åœ°å€ä¸ç¬¦å·è¿›è¡Œç»‘å®šï¼Œæ˜¯ dyld åšçš„ï¼Œä¹Ÿç§°ä¸º åŠ¨æ€åº“ç¬¦å·ç»‘å®šï¼‰ï¼Œä¸€å¥è¯æ¦‚æ‹¬ï¼šç»‘å®šå°±æ˜¯ç»™ç¬¦å·èµ‹å€¼çš„è¿‡ç¨‹ Objc setup timeï¼ˆOCç±»æ³¨å†Œçš„è€—æ—¶ï¼‰ï¼šOC ç±»è¶Šå¤šï¼Œè¶Šè€—æ—¶ initializer time ï¼šï¼ˆæ‰§è¡Œloadå’Œæ„é€ å‡½æ•°çš„è€—æ—¶ï¼‰ é’ˆå¯¹è¿™å‡ éƒ¨ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŒ–å»ºè®®ï¼š å°½é‡ å°‘ç”¨å¤–éƒ¨åŠ¨æ€åº“ï¼Œè‹¹æœå®˜æ–¹å»ºè®®è‡ªå®šä¹‰çš„åŠ¨æ€åº“æœ€å¥½ ä¸è¦è¶…è¿‡6ä¸ªï¼Œå¦‚æœè¶…è¿‡6ä¸ªï¼Œéœ€è¦ åˆå¹¶ åŠ¨æ€åº“ å‡å°‘ OC ç±»ï¼Œå› ä¸ºç±»è¶Šå¤šï¼Œè¶Šè€—æ—¶ å°†ä¸å¿…é¡»åœ¨ +load æ–¹æ³•ä¸­åšçš„äº‹æƒ…å»¶è¿Ÿåˆ° +initialize ä¸­ï¼Œå°½é‡ä¸è¦ç”¨ C++ è™šå‡½æ•° å¦‚æœæ˜¯Swiftï¼Œå°½é‡ä½¿ç”¨ struct main å‡½æ•°é˜¶æ®µçš„ä¼˜åŒ–åœ¨ main å‡½æ•°ä¹‹åçš„ didFinishLaunching æ–¹æ³•ä¸­ï¼Œä¸»è¦æ˜¯æ‰§è¡Œäº†å„ç§ä¸šåŠ¡ï¼Œæœ‰å¾ˆå¤šå¹¶ä¸æ˜¯å¿…é¡»åœ¨è¿™é‡Œæ‰§è¡Œçš„ï¼Œè¿™ç§ä¸šåŠ¡æˆ‘ä»¬å¯ä»¥é‡‡å– å»¶è¿ŸåŠ è½½ï¼Œé˜²æ­¢å½±å“å¯åŠ¨æ—¶é—´ åœ¨ didFinishLaunching ä¸­çš„ä¸šåŠ¡ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ ã€ç¬¬ä¸€ç±»ã€‘åˆå§‹åŒ–ç¬¬ä¸‰æ–¹sdk ã€ç¬¬äºŒç±»ã€‘Appè¿è¡Œç¯å¢ƒé…ç½® ã€ç¬¬ä¸‰ç±»ã€‘è‡ªå·±å·¥å…·ç±»çš„åˆå§‹åŒ–ç­‰ mainå‡½æ•°é˜¶æ®µçš„ä¼˜åŒ–å»ºè®®ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š å‡å°‘å¯åŠ¨åˆå§‹åŒ–çš„æµç¨‹ï¼Œèƒ½æ‡’åŠ è½½çš„æ‡’åŠ è½½ï¼Œèƒ½å»¶è¿Ÿçš„å»¶è¿Ÿï¼Œèƒ½æ”¾åå°åˆå§‹åŒ–çš„æ”¾åå°ï¼Œå°½é‡å°‘å ç”¨ä¸»çº¿ç¨‹çš„å¯åŠ¨æ—¶é—´ ä¼˜åŒ–ä»£ç é€»è¾‘ï¼Œå»é™¤éå¿…é¡»çš„ä»£ç é€»è¾‘ï¼Œå‡å°‘æ¯ä¸ªæµç¨‹çš„æ¶ˆè€—æ—¶é—´ å¯åŠ¨é˜¶æ®µèƒ½ ä½¿ç”¨å¤šçº¿ç¨‹ æ¥åˆå§‹åŒ–çš„ï¼Œå°±ä½¿ç”¨å¤šçº¿ç¨‹ å°½é‡ ä½¿ç”¨çº¯ä»£ç  æ¥è¿›è¡ŒUIæ¡†æ¶çš„æ­å»ºï¼Œå°¤å…¶æ˜¯ä¸»UIæ¡†æ¶ï¼Œä¾‹å¦‚ UITabBarControllerï¼Œå°½é‡é¿å…ä½¿ç”¨Xibæˆ–è€…SBï¼Œç›¸æ¯”çº¯ä»£ç è€Œè¨€ï¼Œè¿™ç§æ›´è€—æ—¶ åˆ é™¤åºŸå¼ƒç±»ã€æ–¹æ³•","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†32ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸€ï¼‰åŸºæœ¬æ¦‚å¿µ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†32ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸€ï¼‰åŸºæœ¬æ¦‚å¿µ","date":"2021-05-04T06:44:11.000Z","updated":"2022-04-11T06:09:39.000Z","comments":true,"path":"2021/05/04/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†32ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸€ï¼‰åŸºæœ¬æ¦‚å¿µ/","link":"","permalink":"https://www.bboyzj.cn/2021/05/04/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8632%EF%BC%9A%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96%EF%BC%88%E4%B8%80%EF%BC%89%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/","excerpt":"","text":"å‰è¨€æ—©æœŸçš„ æ•°æ®è®¿é—® æ˜¯ç›´æ¥é€šè¿‡ ç‰©ç†åœ°å€ è®¿é—® ç‰©ç†å†…å­˜ï¼Œè€Œç‰©ç†å†…å­˜æ˜¯æœ‰ å›ºå®šå¤§å°çš„ï¼Œè¿™ç§æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š 1.å†…å­˜ä¸å¤Ÿç”¨ 2.å†…å­˜æ•°æ®çš„å®‰å…¨é—®é¢˜ å†…å­˜ä¸å¤Ÿç”¨çš„è§£å†³æ–¹æ¡ˆï¼šè™šæ‹Ÿå†…å­˜é’ˆå¯¹é—®é¢˜1ï¼Œæˆ‘ä»¬åœ¨ è¿›ç¨‹å’Œç‰©ç†å†…å­˜ ä¹‹é—´å¢åŠ ä¸€ä¸ª ä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å°±æ˜¯æ‰€è°“çš„ è™šæ‹Ÿå†…å­˜ï¼Œä¸»è¦ç”¨äºè§£å†³å½“å¤šä¸ªè¿›ç¨‹åŒæ—¶å­˜åœ¨æ—¶ï¼Œå¯¹ç‰©ç†å†…å­˜çš„ç®¡ç†ï¼Œæé«˜äº†CPUçš„åˆ©ç”¨ç‡ï¼Œä½¿å¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶ã€æŒ‰éœ€åŠ è½½ï¼Œæ‰€ä»¥è™šæ‹Ÿå†…å­˜å…¶æœ¬è´¨å°±æ˜¯ ä¸€å¼ è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€å¯¹åº”å…³ç³»çš„æ˜ å°„è¡¨ æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ è™šæ‹Ÿå†…å­˜ï¼Œå…¶åœ°å€éƒ½æ˜¯ ä»0å¼€å§‹ï¼Œåˆ°æœ€åç»“æŸï¼Œå¤§å°æ˜¯ 4Gå›ºå®šçš„ï¼Œæ¯ä¸ªè™šæ‹Ÿå†…å­˜åˆåˆ’åˆ†ä¸ºä¸€ä¸ªä¸€ä¸ªçš„ é¡µï¼Œæ‰€æœ‰é¡µæ”¾åœ¨ä¸€èµ·ç»„æˆ é¡µè¡¨ï¼Œç»Ÿç§° è™šæ‹Ÿå†…å­˜åˆ†é¡µç®¡ç†ï¼Œé¡µçš„å¤§å°åœ¨ iOSä¸­æ˜¯16Kï¼ŒLinuxã€MacOSç­‰æ˜¯4Kï¼Œæ¯æ¬¡åŠ è½½éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½åŠ è½½çš„ï¼Œè¿›ç¨‹é—´æ˜¯æ— æ³•äº’ç›¸è®¿é—®çš„ï¼Œä¿è¯äº†è¿›ç¨‹é—´æ•°æ®çš„å®‰å…¨æ€§ã€‚ ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œåªæœ‰éƒ¨åˆ†åŠŸèƒ½æ˜¯æ´»è·ƒçš„ï¼Œæ‰€ä»¥åªéœ€è¦ å°†è¿›ç¨‹ä¸­æ´»è·ƒçš„éƒ¨åˆ†æ”¾å…¥ç‰©ç†å†…å­˜ï¼Œé¿å…ç‰©ç†å†…å­˜çš„æµªè´¹ å½“ CPU éœ€è¦ è®¿é—®æ•°æ® æ—¶ï¼Œé¦–å…ˆæ˜¯è®¿é—®è™šæ‹Ÿå†…å­˜ï¼Œç„¶åé€šè¿‡è™šæ‹Ÿå†…å­˜åœ°å€å¯»å€ï¼Œè¿™ä¸ªè™šæ‹Ÿåœ°å€åœ¨è¢«é€åˆ°å†…å­˜æ¡ä¹‹å‰å…ˆè½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼Œè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹å« åœ°å€ç¿»è¯‘ï¼ˆéœ€è¦CPUçš„ç¡¬ä»¶MMUå’Œæ“ä½œç³»ç»Ÿé…åˆï¼‰ï¼Œå³å¯ä»¥ç†è§£ä¸ºåœ¨ è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€å¯¹åº”è¡¨ ä¸­æ‰¾åˆ°å¯¹åº”çš„ ç‰©ç†åœ°å€ï¼Œç„¶åå¯¹ç›¸åº”çš„ç‰©ç†åœ°å€è¿›è¡Œè®¿é—® å¦‚æœåœ¨è®¿é—®æ—¶ï¼Œè™šæ‹Ÿåœ°å€çš„å†…å®¹æœªåŠ è½½åˆ°ç‰©ç†å†…å­˜ï¼Œä¼šå‘ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼ˆpagefaultï¼‰ï¼Œå°†å½“å‰è¿›ç¨‹é˜»å¡æ‰ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿéœ€è¦å…ˆå°†æ•°æ®è½½å…¥åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå¿«ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°ï¼ˆæ¯é¡µ16Kï¼‰ï¼Œç„¶åå†å¯»å€ï¼Œè¿›è¡Œè¯»å–ã€‚è¿™æ ·å°±é¿å…äº†å†…å­˜æµªè´¹ã€‚ å¦‚æœåœ¨è®¿é—®æ—¶ï¼Œç‰©ç†å†…å­˜æ»¡äº†ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† æ–°æ•°æ®å°†æ—§æ•°æ®è¦†ç›– å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜é—´çš„å…³ç³»ï¼š å†…å­˜æ•°æ®å®‰å…¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼šASLRæŠ€æœ¯åœ¨ä¸Šé¢è§£é‡Šçš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†è™šæ‹Ÿå†…å­˜çš„èµ·å§‹åœ°å€ä¸å¤§å°éƒ½æ˜¯å›ºå®šçš„ï¼Œè¿™æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬è®¿é—®æ—¶ï¼Œå…¶æ•°æ®çš„åœ°å€ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬çš„æ•°æ®éå¸¸å®¹æ˜“è¢«ç ´è§£ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥è‹¹æœä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨iOS4.3å¼€å§‹å¼•å…¥äº† ASLRæŠ€æœ¯ã€‚ ASLR çš„æ¦‚å¿µï¼šï¼ˆAddress Space Layout Randomizationï¼‰åœ°å€ç©ºé—´é…ç½®éšæœºåŠ è½½ï¼Œæ˜¯ä¸€ç§ é’ˆå¯¹ç¼“å†²åŒºæº¢å‡º çš„ å®‰å…¨ä¿æŠ¤æŠ€æœ¯ï¼Œé€šè¿‡å¯¹å †ã€æ ˆã€å…±äº«åº“æ˜ å°„ç­‰çº¿æ€§åŒºå¸ƒå±€çš„éšæœºåŒ–ï¼Œé€šè¿‡å¢åŠ æ”»å‡»è€…é¢„æµ‹ç›®çš„åœ°å€çš„éš¾åº¦ï¼Œé˜²æ­¢æ”»å‡»è€…ç›´æ¥å®šä½æ”»å‡»ä»£ç ä½ç½®ï¼Œè¾¾åˆ°é˜»æ­¢æº¢å‡ºæ”»å‡»çš„ç›®çš„çš„ä¸€ç§æŠ€æœ¯ã€‚ å…¶ç›®çš„é€šè¿‡ åˆ©ç”¨éšæœºæ–¹å¼é…ç½®æ•°æ®åœ°å€ç©ºé—´ï¼Œä½¿æŸäº›æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚Appç™»å½•æ³¨å†Œã€æ”¯ä»˜ç›¸å…³ä»£ç ï¼‰é…ç½®åˆ°ä¸€ä¸ªæ¶æ„ç¨‹åºæ— æ³•äº‹å…ˆè·çŸ¥çš„åœ°å€ï¼Œä»¤æ”»å‡»è€…éš¾ä»¥è¿›è¡Œæ”»å‡» ç”±äºASLRçš„å­˜åœ¨ï¼Œå¯¼è‡´å¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€é“¾æ¥åº“åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„ è®°è½½åœ°å€æ¯æ¬¡å¯åŠ¨éƒ½ä¸å›ºå®š ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç¼–è¯‘æ—¶æ¥ä¿®å¤é•œåƒä¸­çš„èµ„æºæŒ‡é’ˆï¼Œæ¥æŒ‡å‘æ­£ç¡®çš„åœ°å€ï¼Œå³ æ­£ç¡®çš„å†…å­˜åœ°å€ = ASLRåœ°å€ + åç§»å€¼ å¯æ‰§è¡Œæ–‡ä»¶ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œå…¶å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ä¹Ÿä¸åŒï¼Œç³»ç»Ÿå†…æ ¸ å°† å¯æ‰§è¡Œæ–‡ä»¶ è¯»å–åˆ° å†…å­˜ï¼Œç„¶åæ ¹æ®å¯æ‰§è¡Œæ–‡ä»¶çš„ å¤´ç­¾åï¼ˆmagicé­”æ•°ï¼‰åˆ¤æ–­äºŒè¿›åˆ¶æ–‡ä»¶çš„æ ¼å¼ã€‚ å¯æ‰§è¡Œæ–‡ä»¶ é­”æ•° ç”¨é€” PE32&#x2F;PE32+ MZ Windowsçš„å¯æ‰§è¡Œæ–‡ä»¶ ELF \\x7FFLF Linuxå’Œå¤§éƒ¨åˆ†UNIXçš„å¯æ‰§è¡Œæ–‡ä»¶å’Œåº“æ–‡ä»¶ è„šæœ¬ #! ä¸»è¦ç”¨äºshellè„šæœ¬ï¼Œä¹Ÿæœ‰ä¸€äº›è§£é‡Šå™¨è„šæœ¬ä½¿ç”¨è¿™ä¸ªæ ¼å¼ï¼Œè¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ï¼Œ#!åé¢æŒ‡å‘çœŸæ­£çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¯”å¦‚pythonï¼‰ï¼Œè€Œè„šæœ¬å…¶ä»–å†…å®¹ï¼Œéƒ½è¢«å½“åšè¾“å…¥ä¼ é€’ç»™è¿™ä¸ªå‘½ä»¤ é€šç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼ˆèƒ–äºŒè¿›åˆ¶æ ¼å¼ï¼‰ Oxcafebabe(å°ç«¯) åŒ…å«å¤šç§æ¶æ„æ”¯æŒçš„Mach-Oæ ¼å¼ï¼ŒiOSå’ŒOS Xæ”¯æŒçš„æ ¼å¼ Mach-O 0xfeedface(32ä½) 0xfeedfacf(64ä½) iOSå’ŒOS Xæ”¯æŒçš„æ ¼å¼ å…¶ä¸­ PEã€ELFã€Mach-O è¿™ä¸‰ç§å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼éƒ½æ˜¯ COFF(Command file format)æ ¼å¼çš„å˜ç§ï¼ŒCOFFçš„ä¸»è¦è´¡çŒ®æ˜¯ç›®æ ‡æ–‡ä»¶é‡Œé¢ å¼•å…¥äº† æ®µ çš„æœºåˆ¶ï¼Œä¸åŒçš„ç›®æ ‡æ–‡ä»¶å¯ä»¥æ‹¥æœ‰ä¸åŒæ•°é‡å’Œä¸åŒç±»å‹çš„ æ®µã€ é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶å› ä¸ºä¸åŒçš„CPUå¹³å°æ”¯æŒçš„æŒ‡ä»¤ä¸åŒï¼Œæ¯”å¦‚ arm64 å’Œ x86ï¼Œè‹¹æœä¸­çš„é€šç”¨äºŒè¿›åˆ¶æ ¼å¼å°±æ˜¯ å°†å¤šç§æ¶æ„çš„Mach-Oæ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç„¶åç³»ç»Ÿæ ¹æ®è‡ªå·±çš„CPUå¹³å°ï¼Œé€‰æ‹©åˆé€‚çš„ Mach-Oï¼Œæ‰€ä»¥ é€šç”¨äºŒè¿›åˆ¶æ ¼å¼åˆè¢«ç§°ä¸º èƒ–äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šç”¨äºŒè¿›åˆ¶æ ¼å¼çš„å®šä¹‰åœ¨ &lt;Mach-O/fat.h&gt;ä¸­ï¼Œå¯ä»¥ä¸‹è½½xnu ï¼Œç„¶åæ ¹æ® xnu -&gt;EXTERNAL_HEADERS -&gt;mach-oä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œé€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶å¼€å§‹çš„ Fat Header æ˜¯ fat_header ç»“æ„ä½“ï¼Œè€Œ Fat Archs æ˜¯è¡¨ç¤ºé€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æœ‰å¤šå°‘ä¸ª Mach-Oï¼Œå•ä¸ª Mach-O çš„æè¿°æ˜¯é€šè¿‡ fat_arch ç»“æ„ä½“ã€‚ä¸¤ä¸ªç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021/* - magicï¼šå¯ä»¥è®©ç³»ç»Ÿå†…æ ¸è¯»å–è¯¥æ–‡ä»¶æ—¶çŸ¥é“æ˜¯é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ - nfat_archï¼šè¡¨æ˜ä¸‹é¢æœ‰å¤šä¸ªfat_archç»“æ„ä½“ï¼Œå³é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«å¤šå°‘ä¸ªMach-O */struct fat_header &#123; uint32_t magic; /* FAT_MAGIC */ uint32_t nfat_arch; /* number of structs that follow */&#125;;/* fat_archæ˜¯æè¿°Mach-O - cputype å’Œ cpusubtypeï¼šè¯´æ˜Mach-Oé€‚ç”¨çš„å¹³å° - offsetï¼ˆåç§»ï¼‰ã€sizeï¼ˆå¤§å°ï¼‰ã€alignï¼ˆé¡µå¯¹é½ï¼‰æè¿°äº†Mach-OäºŒè¿›åˆ¶ä½äºé€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶çš„ä½ç½® */struct fat_arch &#123; cpu_type_t cputype; /* cpu specifier (int) */ cpu_subtype_t cpusubtype; /* machine specifier (int) */ uint32_t offset; /* file offset to this object file */ uint32_t size; /* size of this object file */ uint32_t align; /* alignment as a power of 2 */&#125;; æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿° é€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯è‹¹æœå…¬å¸æå‡ºçš„ä¸€ç§æ–°çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å­˜å‚¨ç»“æ„ï¼Œå¯ä»¥ åŒæ—¶å­˜å‚¨å¤šç§æ¶æ„çš„äºŒè¿›åˆ¶æŒ‡ä»¤ï¼Œä½¿CPUåœ¨è¯»å–è¯¥äºŒè¿›åˆ¶æ–‡ä»¶æ—¶å¯ä»¥è‡ªåŠ¨æ£€æµ‹å¹¶é€‰ç”¨åˆé€‚çš„æ¶æ„ï¼Œä»¥æœ€ç†æƒ³çš„æ–¹å¼è¿›è¡Œè¯»å–ã€‚ ç”±äºé€šç”¨äºŒè¿›åˆ¶æ–‡ä»¶ä¼šåŒæ—¶å­˜å‚¨å¤šç§æ¶æ„ï¼Œæ‰€ä»¥æ¯”å•ä¸€æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å¾ˆå¤šï¼Œä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ï¼Œä½†ç”±äºç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ï¼Œä¸ç›¸å…³çš„æ¶æ„ä»£ç ä¸ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œä¸”æ‰§è¡Œæ•ˆç‡é«˜äº† è¿˜å¯ä»¥é€šè¿‡æŒ‡ä»¤æ¥è¿›è¡ŒMach-Oçš„åˆå¹¶ä¸æ‹†åˆ† æŸ¥çœ‹å½“å‰Mach-Oçš„æ¶æ„ï¼šlipo -info MachOæ–‡ä»¶ åˆå¹¶ï¼šlipo -create MachO1 MachO2 -output è¾“å‡ºæ–‡ä»¶è·¯å¾„ æ‹†åˆ†ï¼šlipo MachOæ–‡ä»¶ â€“thin æ¶æ„ â€“output è¾“å‡ºæ–‡ä»¶è·¯å¾„ Mach-Oæ–‡ä»¶Mach-Oæ–‡ä»¶æ˜¯Mach Objectæ–‡ä»¶æ ¼å¼çš„ç¼©å†™ï¼Œå®ƒæ˜¯ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ã€åŠ¨æ€åº“ã€ç›®æ ‡ä»£ç çš„æ–‡ä»¶æ ¼å¼ã€‚ä½œä¸ºa.outæ ¼å¼çš„æ›¿ä»£ï¼ŒMach-Oæ ¼å¼æä¾›äº†æ›´å¼ºçš„æ‰©å±•æ€§ï¼Œä»¥åŠæ›´å¿«çš„ç¬¦å·è¡¨ä¿¡æ¯è®¿é—®é€Ÿåº¦ ç†Ÿæ‚‰Mach-Oæ–‡ä»¶æ ¼å¼ï¼Œæœ‰åŠ©äºæ›´å¥½çš„ç†è§£è‹¹æœåº•å±‚çš„è¿è¡Œæœºåˆ¶ï¼Œæ›´å¥½çš„æŒæ¡dyldåŠ è½½Mach-Oçš„æ­¥éª¤ã€‚ æŸ¥çœ‹Mach-Oæ–‡ä»¶ å¦‚æœæƒ³è¦æŸ¥çœ‹å…·ä½“çš„ Mach-O æ–‡ä»¶ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ ä¸¤ç§ æ–¹å¼ï¼Œæ¨è ä½¿ç”¨ ç¬¬äºŒç§ æ–¹å¼ï¼Œæ›´ç›´è§‚ï¼š ã€æ–¹å¼ä¸€ã€‘otoolç»ˆç«¯å‘½ä»¤ï¼šotool -l Mach-Oæ–‡ä»¶å ã€æ–¹å¼äºŒã€‘MachOView å·¥å…·ï¼ˆæ¨èï¼‰ï¼šå°†Mach-Oå¯æ‰§è¡Œæ–‡ä»¶æ‹–åŠ¨åˆ°MachOViewå·¥å…·æ‰“å¼€ï¼š Mach-Oæ–‡ä»¶æ ¼å¼å¯¹äºOS X å’Œ iOSæ¥è¯´ï¼ŒMach-Oæ˜¯å…¶å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ–‡ä»¶ç±»å‹ Excutableï¼šå¯æ‰§è¡Œæ–‡ä»¶ Dylibï¼šåŠ¨æ€é“¾æ¥åº“ Bundleï¼šæ— æ³•è¢«é“¾æ¥çš„åŠ¨æ€åº“ï¼Œåªèƒ½åœ¨è¿è¡Œæ—¶ä½¿ç”¨dlopenåŠ è½½ Imageï¼šæŒ‡çš„æ˜¯Excutableã€Dylibå’ŒBundleçš„ä¸€ç§ Frameworkï¼šåŒ…å«Dylibã€èµ„æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶çš„é›†åˆ ä¸‹é¢å›¾ç¤ºæ˜¯Mach-Oé•œåƒæ–‡ä»¶æ ¼å¼ï¼š ä»¥ä¸Šæ˜¯Mach-Oæ–‡ä»¶çš„æ ¼å¼ï¼Œä¸€ä¸ªå®Œæˆçš„Mach-Oæ–‡ä»¶ä¸»è¦åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼š Header Mach-Oå¤´éƒ¨ï¼šä¸»è¦æ˜¯Mach-Oçš„cpuæ¶æ„ï¼Œæ–‡ä»¶ç±»å‹ä»¥åŠåŠ è½½å‘½ä»¤ç­‰ä¿¡æ¯ Load Commands åŠ è½½å‘½ä»¤ï¼šæè¿°äº†æ–‡ä»¶ä¸­æ•°æ®çš„å…·ä½“ç»„ç»‡ç»“æ„ï¼Œä¸åŒçš„æ•°æ®ç±»å‹ä½¿ç”¨ä¸åŒçš„åŠ è½½å‘½ä»¤è¡¨ç¤º Data æ•°æ®ï¼šæ•°æ®ä¸­çš„æ¯ä¸ªæ®µï¼ˆsegmentï¼‰çš„æ•°æ®éƒ½ä¿å­˜åœ¨è¿™é‡Œï¼Œæ®µçš„æ¦‚å¿µä¸ELFæ–‡ä»¶ä¸­æ®µçš„æ¦‚å¿µç±»ä¼¼ã€‚æ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†ï¼Œå®ƒä»¬æ”¾ç½®äº†å…·ä½“çš„æ•°æ®ä¸ä»£ç ï¼Œä¸»è¦åŒ…å«ä»£ç ï¼Œæ•°æ®ï¼Œä¾‹å¦‚ç¬¦å·è¡¨ï¼ŒåŠ¨æ€ç¬¦å·è¡¨ç­‰ç­‰ HeaderMach-Oçš„HeaderåŒ…å«äº†æ•´ä¸ªMach-Oæ–‡ä»¶çš„å…³é”®ä¿¡æ¯ï¼Œä½¿å¾—CPUèƒ½å¿«é€ŸçŸ¥é“Mac-Oçš„åŸºæœ¬ä¿¡æ¯ï¼Œå…¶åœ¨Mach.hï¼ˆè·¯å¾„åŒå‰æ–‡çš„fat.hä¸€è‡´ï¼‰é’ˆå¯¹32ä½å’Œ64ä½æ¶æ„çš„cpuï¼Œåˆ†åˆ«ä½¿ç”¨äº†mach_headerå’Œmach_header_64ç»“æ„ä½“æ¥æè¿°Mach-Oå¤´éƒ¨ã€‚mach_headeræ˜¯è¿æ¥å™¨åŠ è½½æ—¶æœ€å…ˆè¯»å–çš„å†…å®¹ï¼Œå†³å®šäº†ä¸€äº›åŸºç¡€æ¶æ„ã€ç³»ç»Ÿç±»å‹ã€æŒ‡ä»¤æ¡æ•°ç­‰ä¿¡æ¯ï¼Œè¿™é‡ŒæŸ¥çœ‹64ä½æ¶æ„çš„mach_header_64ç»“æ„ä½“å®šä¹‰ï¼Œç›¸æ¯”äº32ä½æ¶æ„çš„mach_headerï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªreservedä¿ç•™å­—æ®µ 123456789101112131415161718192021/* - magicï¼š0xfeedface(32ä½) 0xfeedfacf(64ä½)ï¼Œç³»ç»Ÿå†…æ ¸ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯mach-oæ ¼å¼ - cputypeï¼šCPUç±»å‹ï¼Œæ¯”å¦‚ARM - cpusubtypeï¼šCPUçš„å…·ä½“ç±»å‹ï¼Œä¾‹å¦‚arm64ã€armv7 - filetypeï¼šç”±äºå¯æ‰§è¡Œæ–‡ä»¶ã€ç›®æ ‡æ–‡ä»¶ã€é™æ€åº“å’ŒåŠ¨æ€åº“ç­‰éƒ½æ˜¯mach-oæ ¼å¼ï¼Œæ‰€ä»¥éœ€è¦filetypeæ¥è¯´æ˜mach-oæ–‡ä»¶æ˜¯å±äºå“ªç§æ–‡ä»¶ - ncmdsï¼šsizeofcmdsï¼šLoadCommandsåŠ è½½å‘½ä»¤çš„æ¡æ•°ï¼ˆåŠ è½½å‘½ä»¤ç´§è·Ÿheaderä¹‹åï¼‰ - sizeofcmdsï¼šLoadCommandsåŠ è½½å‘½ä»¤çš„å¤§å° - flagsï¼šæ ‡å¿—ä½æ ‡è¯†äºŒè¿›åˆ¶æ–‡ä»¶æ”¯æŒçš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯å’Œç³»ç»ŸåŠ è½½ã€é“¾æ¥æœ‰å…³ - reservedï¼šä¿ç•™å­—æ®µ */struct mach_header_64 &#123; uint32_t magic; /* mach magic number identifier */ cpu_type_t cputype; /* cpu specifier */ cpu_subtype_t cpusubtype; /* machine specifier */ uint32_t filetype; /* type of file */ uint32_t ncmds; /* number of load commands */ uint32_t sizeofcmds; /* the size of all the load commands */ uint32_t flags; /* flags */ uint32_t reserved; /* reserved */&#125;; å…¶ä¸­filetypeä¸»è¦è®°å½•Mach-Oçš„æ–‡ä»¶ç±»å‹ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§: 12345#define MH_OBJECT 0x1 /* ç›®æ ‡æ–‡ä»¶*/#define MH_EXECUTE 0x2 /* å¯æ‰§è¡Œæ–‡ä»¶*/#define MH_DYLIB 0x6 /* åŠ¨æ€åº“*/#define MH_DYLINKER 0x7 /* åŠ¨æ€é“¾æ¥å™¨*/#define MH_DSYM 0xa /* å­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶ç¬¦å·ä¿¡æ¯ï¼Œç”¨äºdebugåˆ†æ*/ ç›¸å¯¹åº”çš„ï¼ŒHeaderåœ¨MachOViewä¸­çš„å±•ç¤ºå¦‚ä¸‹: Load Commandsåœ¨Mach-Oæ–‡ä»¶ä¸­ï¼ŒLoad Commandsä¸»è¦æ˜¯ç”¨äº åŠ è½½æŒ‡ä»¤ï¼Œå…¶å¤§å°å’Œæ•°ç›®åœ¨Headerä¸­å·²ç»è¢«æä¾›ï¼Œå…¶åœ¨Mach.hä¸­çš„å®šä¹‰å¦‚ä¸‹: 123456789/* load_commandç”¨äºåŠ è½½æŒ‡ä»¤ - cmd åŠ è½½å‘½ä»¤çš„ç±»å‹ - cmdsize åŠ è½½å‘½ä»¤çš„å¤§å° */struct load_command &#123; uint32_t cmd; /* type of load command */ uint32_t cmdsize; /* total size of command in bytes */&#125;; æˆ‘ä»¬åœ¨MachOViewä¸­æŸ¥çœ‹Load Commandsï¼Œå…¶ä¸­è®°å½•äº†å¾ˆå¤šä¿¡æ¯ï¼Œä¾‹å¦‚åŠ¨æ€é“¾æ¥å™¨çš„ä½ç½®ã€ç¨‹åºçš„å…¥å£ã€ä¾èµ–åº“çš„ä¿¡æ¯ã€ä»£ç çš„ä½ç½®ã€ç¬¦å·è¡¨çš„ä½ç½®ç­‰ç­‰ï¼Œå¦‚ä¸‹æ‰€ç¤º: å…¶ä¸­LC_SEGMENT_64çš„ç±»å‹segment_command_64å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031/* segment_command æ®µåŠ è½½å‘½ä»¤ - cmdï¼šè¡¨ç¤ºåŠ è½½å‘½ä»¤ç±»å‹ï¼Œ - cmdsizeï¼šè¡¨ç¤ºåŠ è½½å‘½ä»¤å¤§å°ï¼ˆè¿˜åŒ…æ‹¬äº†ç´§è·Ÿå…¶åçš„nsectsä¸ªsectionçš„å¤§å°ï¼‰ - segnameï¼š16ä¸ªå­—èŠ‚çš„æ®µåå­— - vmaddrï¼šæ®µçš„è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ - vmsizeï¼šæ®µçš„è™šæ‹Ÿå†…å­˜å¤§å° - fileoffï¼šæ®µåœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ - filesizeï¼šæ®µåœ¨æ–‡ä»¶ä¸­çš„å¤§å° - maxprotï¼šæ®µé¡µé¢æ‰€éœ€è¦çš„æœ€é«˜å†…å­˜ä¿æŠ¤ï¼ˆ4 = rï¼Œ2 = wï¼Œ1 = xï¼‰ - initprotï¼šæ®µé¡µé¢åˆå§‹çš„å†…å­˜ä¿æŠ¤ - nsectsï¼šæ®µä¸­sectionæ•°é‡ - flagsï¼šå…¶ä»–æ‚é¡¹æ ‡å¿—ä½ - ä»fileoffï¼ˆåç§»ï¼‰å¤„ï¼Œå–filesizeå­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæ”¾åˆ°å†…å­˜çš„vmaddrå¤„çš„vmsizeå­—èŠ‚ã€‚ï¼ˆfileoffå¤„åˆ°filesizeå­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå°±æ˜¯â€œæ®µâ€ï¼‰ - æ¯ä¸€ä¸ªæ®µçš„æƒé™ç›¸åŒï¼ˆæˆ–è€…è¯´ï¼Œç¼–è¯‘æ—¶å€™ï¼Œç¼–è¯‘å™¨æŠŠç›¸åŒæƒé™çš„æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œæˆä¸ºæ®µï¼‰ï¼Œå…¶æƒé™æ ¹æ®initprotåˆå§‹åŒ–ã€‚initprotæŒ‡å®šäº†å¦‚ä½•é€šè¿‡è¯»/å†™/æ‰§è¡Œä½åˆå§‹åŒ–é¡µé¢çš„ä¿æŠ¤çº§åˆ« - æ®µçš„ä¿æŠ¤è®¾ç½®å¯ä»¥åŠ¨æ€æ”¹å˜ï¼Œä½†æ˜¯ä¸èƒ½è¶…è¿‡maxprotä¸­æŒ‡å®šçš„å€¼ï¼ˆåœ¨iOSä¸­ï¼Œ+xå’Œ+wæ˜¯äº’æ–¥çš„ï¼‰ */struct segment_command_64 &#123; /* for 64-bit architectures */ uint32_t cmd; /* LC_SEGMENT_64 */ uint32_t cmdsize; /* includes sizeof section_64 structs */ char segname[16]; /* segment name */ uint64_t vmaddr; /* memory address of this segment */ uint64_t vmsize; /* memory size of this segment */ uint64_t fileoff; /* file offset of this segment */ uint64_t filesize; /* amount to map from the file */ vm_prot_t maxprot; /* maximum VM protection */ vm_prot_t initprot; /* initial VM protection */ uint32_t nsects; /* number of sections in segment */ uint32_t flags; /* flags */&#125;; DataLoad Commands åå°±æ˜¯DataåŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸå­˜å‚¨äº†å…·ä½“çš„åªè¯»ã€å¯è¯»å†™ä»£ç ï¼Œä¾‹å¦‚æ–¹æ³•ã€ç¬¦å·è¡¨ã€å­—ç¬¦è¡¨ã€ä»£ç æ•°æ®ã€è¿æ¥å™¨æ‰€éœ€çš„æ•°æ®ï¼ˆé‡å®šå‘ã€ç¬¦å·ç»‘å®šç­‰ï¼‰ã€‚ä¸»è¦æ˜¯å­˜å‚¨å…·ä½“çš„æ•°æ®ã€‚å…¶ä¸­å¤§å¤šæ•°çš„Mach-Oæ–‡ä»¶å‡åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ®µï¼š __TEXT ä»£ç æ®µï¼šåªè¯»ï¼ŒåŒ…æ‹¬å‡½æ•°ï¼Œå’Œåªè¯»çš„å­—ç¬¦ä¸² __DATA æ•°æ®æ®µï¼šè¯»å†™ï¼ŒåŒ…æ‹¬å¯è¯»å†™çš„å…¨å±€å˜é‡ç­‰ __LINKEDITï¼š __LINKEDITåŒ…å«äº†æ–¹æ³•å’Œå˜é‡çš„å…ƒæ•°æ®ï¼ˆä½ç½®ï¼Œåç§»é‡ï¼‰ï¼Œä»¥åŠä»£ç ç­¾åç­‰ä¿¡æ¯ã€‚ åœ¨DataåŒºä¸­ï¼ŒSectionå äº†å¾ˆå¤§çš„æ¯”ä¾‹ï¼ŒSectionåœ¨Mach.hä¸­æ˜¯ä»¥ç»“æ„ä½“section_64ï¼ˆåœ¨arm64æ¶æ„ä¸‹ï¼‰è¡¨ç¤ºï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930/* SectionèŠ‚åœ¨MachOä¸­é›†ä¸­ä½“ç°åœ¨TEXTå’ŒDATAä¸¤æ®µé‡Œ. - sectnameï¼šå½“å‰sectionçš„åç§° - segnameï¼šsectionæ‰€åœ¨çš„segmentåç§° - addrï¼šå†…å­˜ä¸­èµ·å§‹ä½ç½® - sizeï¼šsectionå¤§å° - offsetï¼šsectionçš„æ–‡ä»¶åç§» - alignï¼šå­—èŠ‚å¤§å°å¯¹é½ - reloffï¼šé‡å®šä½å…¥å£çš„æ–‡ä»¶åç§» - nrelocï¼šé‡å®šä½å…¥å£æ•°é‡ - flagsï¼šæ ‡å¿—ï¼Œsectionçš„ç±»å‹å’Œå±æ€§ - reserved1ï¼šä¿ç•™ï¼ˆç”¨äºåç§»é‡æˆ–ç´¢å¼•ï¼‰ - reserved2ï¼šä¿ç•™ï¼ˆç”¨äºcountæˆ–sizeofï¼‰ - reserved3ï¼šä¿ç•™ */struct section_64 &#123; /* for 64-bit architectures */ char sectname[16]; /* name of this section */ char segname[16]; /* segment this section goes in */ uint64_t addr; /* memory address of this section */ uint64_t size; /* size in bytes of this section */ uint32_t offset; /* file offset of this section */ uint32_t align; /* section alignment (power of 2) */ uint32_t reloff; /* file offset of relocation entries */ uint32_t nreloc; /* number of relocation entries */ uint32_t flags; /* flags (section type and attributes)*/ uint32_t reserved1; /* reserved (for offset or index) */ uint32_t reserved2; /* reserved (for count or sizeof) */ uint32_t reserved3; /* reserved */&#125;; Sectionåœ¨MachOViewä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦é›†ä¸­ä½“ç°åœ¨TEXTå’ŒDATAä¸¤æ®µé‡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å…¶ä¸­å¸¸è§çš„sectionï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸€äº›ï¼š æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼ŒMach-Oçš„æ ¼å¼å¦‚ä¸‹ï¼š","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†31ï¼šLLVMç¼–è¯‘æµç¨‹&Clandæ’ä»¶å¼€å‘","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†31ï¼šLLVMç¼–è¯‘æµç¨‹-Clandæ’ä»¶å¼€å‘","date":"2021-04-29T06:43:46.000Z","updated":"2022-03-08T03:56:25.000Z","comments":true,"path":"2021/04/29/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†31ï¼šLLVMç¼–è¯‘æµç¨‹-Clandæ’ä»¶å¼€å‘/","link":"","permalink":"https://www.bboyzj.cn/2021/04/29/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8631%EF%BC%9ALLVM%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B-Cland%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/","excerpt":"","text":"","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†30ï¼šBlockåº•å±‚åŸç†","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†30ï¼šBlockåº•å±‚åŸç†","date":"2021-04-22T06:46:32.000Z","updated":"2022-11-07T01:13:07.000Z","comments":true,"path":"2021/04/22/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†30ï¼šBlockåº•å±‚åŸç†/","link":"","permalink":"https://www.bboyzj.cn/2021/04/22/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8630%EF%BC%9ABlock%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/","excerpt":"","text":"Blockç±»å‹block ä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼š å…¨å±€åŒºã€å †åŒºã€æ ˆåŒº __NSGlobalBlock__ ï¼šå…¨å±€blockï¼Œå­˜å‚¨åœ¨ å…¨å±€åŒº 123void(^block)(void) = ^&#123; NSLog(@&quot;ZJ&quot;);&#125;; æ­¤æ—¶çš„blockæ— å‚æ•°ï¼Œä¹Ÿæ— è¿”å›å€¼ï¼Œå±äºå…¨å±€blockï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š __NSMallocBlock__ ï¼šå †åŒºblockï¼Œå› ä¸ºblockå³æ˜¯ å‡½æ•° ï¼Œä¹Ÿæ˜¯ å¯¹è±¡ 1234567- (void)mallocBlock&#123; int a = 10; void(^ block)(void) = ^&#123; NSLog(@&quot;ZJ - %d&quot;,a); &#125;; NSLog(@&quot;%@&quot;,block);&#125; æ­¤æ—¶çš„blockä¼šè®¿é—®å¤–éƒ¨å˜é‡ï¼Œå³ åº•å±‚æ‹·è´a ï¼Œæ‰€ä»¥æ˜¯ å †åŒºblock 12021-08-02 11:11:56.986272+0800 001---Blockæ·±å…¥æµ…å‡º[1126:696422] &lt;__NSMallocBlock__: 0x2800e3c00&gt; __NSStackBlock__ ï¼šblockæœ¬èº«é»˜è®¤æ˜¯ æ ˆblock 123456789101112// æ ˆblock- (void)stackBlock&#123; __block int a = 10; void(^block)(void) = ^&#123; a = 20; NSLog(@&quot;ZJ - %d&quot;,a); &#125;; NSLog(@&quot;%@&quot;,^&#123; a = 20; NSLog(@&quot;ZJ - %d&quot;,a); &#125;);&#125; ã€å°çŸ¥è¯†ç‚¹ã€‘ï¼šå½“blockå†…éƒ¨éœ€è¦ä¿®æ”¹æˆ–è®¿é—®å¤–éƒ¨å˜é‡aæ—¶ï¼Œå¤–éƒ¨å˜é‡éœ€è¦é¢å¤–ç”¨ __block ä¿®é¥°ï¼Œå¦åˆ™ä¿®æ”¹ä¸äº† æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»“æœ: 12021-08-02 11:15:47.243001+0800 001---Blockæ·±å…¥æµ…å‡º[1131:698266] &lt;__NSMallocBlock__: 0x28037a700&gt; ä¸ºä»€ä¹ˆï¼Ÿå±…ç„¶è¿˜æ˜¯ __NSMallocBlock__ ï¼Œå †åŒºï¼Ÿç­”ï¼šå› ä¸ºåœ¨ ARC ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬åŠ äº† copy æ“ä½œã€‚åœ¨ å±€éƒ¨å˜é‡a åœ¨æ²¡æœ‰å¤„ç†ï¼ˆå³æ²¡æœ‰ æ‹·è´ ä¹‹å‰ï¼‰æ˜¯ æ ˆåŒºblockï¼Œå¤„ç†ä¹‹åï¼ˆå³ æ‹·è´ ä¹‹åï¼‰æ˜¯ å †åŒºblockï¼Œç›®å‰çš„æ ˆåŒºblockè¶Šæ¥è¶Šå°‘äº†ã€‚ å½“æˆ‘ä»¬å…³æ‰ARCå¦‚ä¸‹ï¼š å†æ¥æ‰“å°ä¸€ä¸‹ç»“æœï¼š ã€æ€»ç»“ã€‘ blockç›´æ¥å­˜å‚¨åœ¨ å…¨å±€åŒº å¦‚æœ blockè®¿é—®å¤–ç•Œå˜é‡ ï¼Œå¹¶è¿›è¡Œblockç›¸åº”æ‹·è´ï¼Œå³ copy åœ¨ ARC ç¯å¢ƒä¸‹ï¼Œå­˜å‚¨åœ¨å †åŒº åœ¨ éARC ç¯å¢ƒä¸‹ï¼Œå­˜å‚¨åœ¨æ ˆåŒº Blockå˜é‡æ•è·ä¸ºäº†ä¿è¯Blockå†…éƒ¨èƒ½å¤Ÿæ­£å¸¸è®¿é—®å¤–éƒ¨å˜é‡ï¼Œblockæœ‰ä¸ªè‡ªåŠ¨æ•è·å¤–éƒ¨å˜é‡çš„æœºåˆ¶ 1ã€auto ç±»å‹å±€éƒ¨å˜é‡ï¼šå±€éƒ¨å˜é‡æˆªè· æ˜¯å€¼æˆªè·ã€‚ ä¾‹å­ï¼š 1234567NSInteger num = 3;NSInteger(^block)(NSInteger) = ^NSInteger(NSInteger n)&#123; // num = 4; // ç¼–è¯‘å™¨æŠ¥é”™ return n*num;&#125;;num = 1;NSLog(@&quot;%zd&quot;,block(2)); æŸ¥çœ‹æ‰“å°ç»“æœï¼š 12è¿™é‡Œçš„è¾“å‡ºæ˜¯6è€Œä¸æ˜¯2ï¼ŒåŸå› å°±æ˜¯å¯¹å±€éƒ¨å˜é‡numçš„æˆªè·æ˜¯å€¼æˆªè·ã€‚åŒæ ·ï¼Œåœ¨blocké‡Œå¦‚æœä¿®æ”¹å˜é‡numï¼Œä¹Ÿæ˜¯æ— æ•ˆçš„ï¼Œç”šè‡³ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ 2ã€ static ç±»å‹å±€éƒ¨å˜é‡ï¼šå±€éƒ¨é™æ€å˜é‡æˆªè·æ˜¯ æŒ‡é’ˆæˆªè· ä¾‹å­ï¼š 1234567// é™æ€å˜é‡-æŒ‡é’ˆæ•è·static int a = 10;NSInteger(^Sblock)(NSInteger) = ^NSInteger(NSInteger n)&#123; return n*a;&#125;;a = 1;NSLog(@&quot;%zd&quot;,Sblock(2)); æ‰“å°ç»“æœï¼š 12020-08-02 00:49:30.467652+0800 OC-Blockåˆæ¢[15224:868821] 2 ç»“è®º: 1é™æ€å±€éƒ¨å˜é‡æˆªè·çš„æ˜¯æŒ‡é’ˆï¼Œåœ¨å¤–éƒ¨ä¿®æ”¹ä¸º1ï¼Œå¯¹blockæœ‰å½±å“ 3ã€__blockä¿®é¥°çš„å˜é‡: __block å˜é‡æˆªè·æ˜¯ æŒ‡é’ˆæˆªè·,å¹¶ä¸”ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ç»“æ„ä½“å¯¹è±¡ ä¾‹å­ï¼š 1234567// __blockä¿®é¥°å˜é‡-æŒ‡é’ˆæ•è·__block NSInteger n = 3;void(^Bblock)(void) = ^&#123; NSLog(@&quot;%zd&quot;,n); // __blockä¿®é¥°å˜é‡&#125;;n = 4;Bblock(); æ‰“å°ç»“æœ: 12020-08-02 01:01:44.760288+0800 OC-Blockåˆæ¢[15345:878899] 4 ç»“è®ºï¼š 1__blockä¿®é¥°çš„å˜é‡ä¹Ÿæ˜¯ä»¥æŒ‡é’ˆå½¢å¼æˆªè·çš„ è§£é‡Šï¼š__block æ˜¯å°†å¤–éƒ¨å˜é‡åŒ…è£…æˆäº†ä¸€ä¸ªå¯¹è±¡å¹¶å°† n å­˜åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼Œå®é™…ä¸Šblockå¤–é¢çš„ n çš„åœ°å€ä¹Ÿæ˜¯æŒ‡å‘è¿™ä¸ªå¯¹è±¡ä¸­å­˜å‚¨çš„ n çš„ï¼Œè€Œblockåº•å±‚æ˜¯æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„ï¼Œæ‰€ä»¥å½“å¤–éƒ¨æ›´æ”¹næ—¶ï¼Œblocké‡Œé¢é€šè¿‡æŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå¯¹è±¡è¿›è€Œæ‰¾åˆ°nï¼Œç„¶åè·å–åˆ°nçš„å€¼ï¼Œæ‰€ä»¥nå‘ç”Ÿäº†å˜åŒ–ã€‚ 4ã€å…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡ï¼šä¸æˆªè·,ç›´æ¥å–å€¼ ä¾‹å­: 123456789101112NSInteger num1 = 3; // å…¨å±€å˜é‡static NSInteger num2 = 30; // é™æ€å…¨å±€å˜é‡- (void)blockTest&#123; void(^block)(void) = ^&#123; NSLog(@&quot;%zd&quot;,num1); // å…¨å±€å˜é‡ NSLog(@&quot;%zd&quot;,num2); // å…¨å±€é™æ€å˜é‡ &#125;; num1 = 4; num2 = 40; block();&#125; æ‰“å°ç»“æœï¼š 122020-08-02 01:01:44.760418+0800 OC-Blockåˆæ¢[15345:878899] 42020-08-02 01:01:44.760514+0800 OC-Blockåˆæ¢[15345:878899] 40 ç»“è®ºï¼š 1å…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡æ˜¯ä¸æˆªè·,ç›´æ¥å–å€¼ 5ã€å¯¹è±¡ï¼šå¯¹è±¡ç±»å‹çš„ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå€¼æˆªå– ä¾‹å­ï¼š 12345678910111213- (void)blockTest1&#123; // å±€éƒ¨å¯¹è±¡ NSMutableArray * arr = [NSMutableArray arrayWithObjects:@1,@2, nil]; void(^block)(void) = ^&#123; NSLog(@&quot;%@&quot;,arr); [arr addObject:@(4)]; NSLog(@&quot;%@&quot;,arr); &#125;; [arr addObject:@3]; arr = nil; block();&#125; æŸ¥çœ‹æ‰“å°ç»“æœ: 12345678910112020-08-11 10:41:59.416461+0800 OC-Blockå˜é‡æˆªè·çš„åŸç†[31602:1829372] ( 1, 2, 3)2020-08-11 10:41:59.416882+0800 OC-Blockå˜é‡æˆªè·çš„åŸç†[31602:1829372] ( 1, 2, 3, 4) ç»“è®º: 1å±€éƒ¨å¯¹è±¡å˜é‡ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆªè·çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆï¼Œåœ¨å¤–éƒ¨å°†å…¶ç½®ä¸ºnilï¼Œå¯¹blockæ²¡æœ‰å½±å“ï¼Œè€Œè¯¥å¯¹è±¡è°ƒç”¨æ–¹æ³•ä¼šå½±å“ Blockå¾ªç¯å¼•ç”¨ æ­£å¸¸é‡Šæ”¾ï¼šæ˜¯æŒ‡AæŒæœ‰Bçš„å¼•ç”¨ï¼Œå½“Aè°ƒç”¨deallocæ–¹æ³•ï¼Œç»™Bå‘é€releaseä¿¡å·ï¼ŒBæ”¶åˆ°releaseä¿¡å·ï¼Œå¦‚æœæ­¤æ—¶Bçš„retainCountï¼ˆå³å¼•ç”¨è®¡æ•°ï¼‰ä¸º0æ—¶ï¼Œåˆ™è°ƒç”¨Bçš„deallocæ–¹æ³• å¾ªåå¼•ç”¨ï¼šAã€Bäº’ç›¸æŒæœ‰ï¼Œæ‰€æœ‰å¯¼è‡´Aæ— æ³•è°ƒç”¨deallocæ–¹æ³•ç»™Bå‘é€releaseä¿¡å·ï¼Œè€ŒBä¹Ÿæ— æ³•æ¥æ”¶åˆ°releaseä¿¡å·ï¼Œæ‰€ä»¥Aã€Bæ­¤æ—¶éƒ½æ— æ³•é‡Šæ”¾ å…³ç³»å›¾å¦‚ä¸‹ï¼š Blockå¾ªç¯å¼•ç”¨è§£å†³è¯·é—®ä¸‹é¢ä¸¤æ®µä»£ç æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨ï¼Ÿ12345678910// ä»£ç ä¸€self.name = @&quot;ZJ&quot;;self.block = ^&#123; NSLog(@&quot;%@&quot;,self.name);&#125;; // ä»£ç äºŒ[UIView animateWithDuration:1 animations:^&#123; NSLog(@&quot;%@&quot;,self.name);&#125;]; ã€ä»£ç ä¸€ã€‘ï¼šå‘ç”Ÿäº† å¾ªç¯å¼•ç”¨ï¼Œå› ä¸ºåœ¨ block å†…éƒ¨ä½¿ç”¨äº† å¤–éƒ¨å˜é‡nameï¼Œå¯¼è‡´ blockæŒæœ‰äº†selfï¼Œè€Œ self åŸæœ¬æ˜¯æŒæœ‰ block çš„ï¼Œæ‰€ä»¥å¯¼è‡´ selfå’Œblockçš„ç›¸äº’æŒæœ‰ï¼Œå³ self -&gt; name -&gt; block -&gt; selfã€‚ ã€ä»£ç äºŒã€‘ï¼šæ²¡å‘ç”Ÿ å¾ªç¯å¼•ç”¨ ï¼Œè™½ç„¶ä½¿ç”¨äº† å¤–éƒ¨å˜é‡nameï¼Œä½†æ˜¯ selfå¹¶æ²¡æœ‰æŒæœ‰animation çš„ block,ä»…ä»…åªæœ‰ block æŒæœ‰ self ï¼Œä¸æ„æˆäº’ç›¸æŒæœ‰ï¼Œå³ block -&gt; self -&gt; nameã€‚ è§£å†³å¾ªç¯å¼•ç”¨å¸¸è§çš„å‡ ç§æ–¹å¼ ã€æ–¹å¼ä¸€ã€‘ï¼š weak-strong-dance å¼ºå¼±å…±èˆ ã€æ–¹å¼äºŒã€‘ï¼š __block ä¿®é¥°å¯¹è±¡ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯åœ¨blockå†…éƒ¨éœ€è¦ ç½®ç©º å¯¹è±¡ï¼Œè€Œä¸” blockå¿…é¡»è°ƒç”¨ï¼‰ ã€æ–¹å¼ä¸‰ã€‘ï¼š ä¼ é€’ å¯¹è±¡self ä½œä¸ºblockçš„å‚æ•°ï¼Œæä¾›ç»™blockå†…éƒ¨ä½¿ç”¨ ã€æ–¹å¼å››ã€‘ï¼š ä½¿ç”¨ NSProxy 1ã€ã€æ–¹å¼ä¸€ã€‘ï¼šweak-strong-dance å¦‚æœblockå†…éƒ¨å¹¶æœªåµŒå¥—blockï¼Œç›´æ¥ä½¿ç”¨ __weak ä¿®é¥° self å³å¯ï¼š 12345678typedef void(^ZJBlock)(void);...@property (nonatomic, copy) ZJBlock block;... __weak typeof(self) weakSelf = self;self.block = ^&#123; NSLog(@&quot;%@&quot;,weakSelf.name);&#125;; æ­¤æ—¶çš„ weakSelf å’Œ self æŒ‡å‘åŒä¸€ç‰‡ å†…å­˜ç©ºé—´ï¼Œä¸”ä½¿ç”¨ __weakä¸ä¼šå¯¼è‡´selfçš„å¼•ç”¨è®¡æ•°å‘ç”Ÿå˜åŒ–ï¼Œå¯ä»¥é€šè¿‡æ‰“å° weakSelf å’Œ self çš„æŒ‡é’ˆåœ°å€å’Œå¼•ç”¨è®¡æ•°æ¥éªŒè¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š è¿è¡Œä¸‹é¢çš„ä»£ç ï¼š 12345678910// blockNSLog(@&quot;%ld&quot;,(long)CFGetRetainCount((__bridge CFTypeRef)(self)));__weak typeof(self) weakSelf = self;NSLog(@&quot;%ld&quot;,CFGetRetainCount((__bridge CFTypeRef)(self)));self.block = ^&#123; NSLog(@&quot;%@&quot;,weakSelf.name);&#125;;NSLog(@&quot;%p - %p&quot;,weakSelf,self);NSLog(@&quot;%ld&quot;,(long)CFGetRetainCount((__bridge CFTypeRef)(self.block)));NSLog(@&quot;%ld&quot;,(long)CFGetRetainCount((__bridge CFTypeRef)(self))); å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š å¦‚æœ block å†…éƒ¨åµŒå¥— blockï¼Œéœ€è¦åŒæ—¶ä½¿ç”¨ __weak å’Œ __strong 12345678__weak typeof(self) weakSelf = self;self.block = ^&#123; __strong typeof(weakSelf) strongSelf = weakSelf; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; NSLog(@&quot;%@&quot;,strongSelf.name); &#125;);&#125;;self.block(); å…¶ä¸­ strongSelf æ˜¯ä¸€ä¸ª ä¸´æ—¶å˜é‡ ï¼Œåœ¨blockçš„ä½œç”¨åŸŸå†…ï¼Œå³å†…éƒ¨ blockæ‰§è¡Œå®Œ å°±é‡Šæ”¾ strongSelf è¿™ç§æ–¹å¼å±äº æ‰“ç ´selfå¯¹blockçš„å¼ºå¼•ç”¨ï¼Œä¾èµ–äº ä¸­ä»‹è€…æ¨¡å¼ï¼Œå±äºè‡ªåŠ¨ç½®ä¸º nilï¼Œå³ è‡ªåŠ¨é‡Šæ”¾ 2ã€ã€æ–¹å¼äºŒã€‘ï¼š__blockä¿®é¥°å˜é‡ è¿™ç§æ–¹å¼åŒæ ·ä¾èµ–äº ä¸­ä»‹è€…æ¨¡å¼ï¼Œå±äº æ‰‹åŠ¨é‡Šæ”¾ï¼Œæ˜¯é€šè¿‡ __block ä¿®é¥°å¯¹è±¡ï¼Œä¸»è¦æ˜¯å› ä¸º __block ä¿®é¥°çš„å¯¹è±¡æ—¶å¯ä»¥æ”¹å˜çš„ 12345678__block ViewController * vc = self;self.block = ^&#123; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; NSLog(@&quot;%@&quot;,vc.name); vc = nil; &#125;);&#125;;self.block(); éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ blockå¿…é¡»è°ƒç”¨ï¼Œå¦‚æœä¸è°ƒç”¨blockï¼Œvcå°±ä¸ä¼šè¢«ç½®ç©ºï¼Œé‚£ä¹ˆä¾æ—§æ˜¯å¾ªç¯å¼•ç”¨ï¼Œself å’Œ block éƒ½ä¸ä¼šè¢«é‡Šæ”¾ 3ã€ã€æ–¹å¼ä¸‰ã€‘ï¼šå¯¹è±¡selfä½œä¸ºå‚æ•° ä¸»è¦æ˜¯å°† å¯¹è±¡selfä½œä¸ºå‚æ•° ï¼Œæä¾›ç»™blockå†…éƒ¨ä½¿ç”¨ï¼Œä¸ä¼šæœ‰å¼•ç”¨è®¡æ•°é—®é¢˜ï¼š 123456self.block = ^(BlockViewController * vc) &#123; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; NSLog(@&quot;%@&quot;,vc.name); &#125;);&#125;;self.block(self); 4ã€ã€æ–¹å¼å››ã€‘ï¼šNSProxyè™šæ‹Ÿç±» oc æ˜¯åªèƒ½ å•ç»§æ‰¿ çš„è¯­è¨€ï¼Œä½†æ˜¯å®ƒæ˜¯ åŸºäºè¿è¡Œæ—¶çš„æœºåˆ¶ï¼Œæ‰€ä»¥é€šè¿‡ NSProxy æ¥å®ç° ä¼ªå¤šç»§æ‰¿ ï¼Œå¡«è¡¥äº†å¤šç»§æ‰¿çš„ç©ºç™½ NSProxy å’Œ NSObject æ˜¯åŒçº§çš„ä¸€ä¸ªç±»ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªè™šæ‹Ÿç±»ï¼Œåªæ˜¯å®ç°äº†NSObject çš„åè®® NSProxy å…¶å®æ˜¯ä¸€ä¸ª æ¶ˆæ¯é‡å®šå‘å°è£…çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç±»ä¼¼äºä¸€ä¸ª ä»£ç†äººï¼Œä¸­é—´ä»¶ï¼Œå¯ä»¥é€šè¿‡ç»§æ‰¿å®ƒï¼Œå¹¶é‡å†™ä¸¤ä¸ªæ–¹æ³•æ¥å®ç°æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªå®ä¾‹ 12- (void)forwardInvocation:(NSInvocation *)invocation;- (nullable NSMethodSignature *)methodSignatureForSelector:(SEL)sel NS_SWIFT_UNAVAILABLE(&quot;NSInvocation and related APIs not available&quot;); ä½¿ç”¨åœºæ™¯ NSProxy çš„ä½¿ç”¨åœºæ™¯ä¸»è¦æœ‰ä¸¤ç§ï¼š å®ç° å¤šç»§æ‰¿ åŠŸèƒ½ è§£å†³äº† NSTimer &amp; CADisplayLink åˆ›å»ºæ—¶ å¯¹selfå¼ºå¼•ç”¨ çš„é—®é¢˜ï¼Œå‚è€ƒ YYKit çš„ YYWeakProxyã€‚ å¾ªç¯å¼•ç”¨è§£å†³åŸæ¥ ä¸»è¦æ˜¯é€šè¿‡è‡ªå®šä¹‰ NSProxy ç±»çš„å¯¹è±¡æ¥ä»£æ›¿ selfï¼Œå¹¶ä½¿ç”¨æ–¹æ³•å®ç°æ¶ˆæ¯è½¬å‘ ä¸‹é¢æ˜¯ NSProxy å­ç±»çš„å®ç°ä»¥åŠä½¿ç”¨çš„åœºæ™¯ï¼š ã€åœºæ™¯ä¸€ã€‘ï¼šå¤šç»§æ‰¿ è‡ªå®šä¹‰ä¸€ä¸ª NSProxy çš„å­ç±» ZJProxy 1234567891011121314151617181920212223242526272829303132333435363738@interface ZJProxy : NSProxy- (id)transformObjc:(NSObject *)objc;+ (instancetype)proxyWithObjc:(id)objc;@end@interface ZJProxy ()@property(nonatomic, weak, readonly) NSObject *objc;@end@implementation ZJProxy- (id)transformObjc:(NSObject *)objc&#123; _objc = objc; return self;&#125;+ (instancetype)proxyWithObjc:(id)objc&#123; return [[self alloc] transformObjc:objc];&#125;// 1.è·å–targetç±»ä¸­çš„selæ–¹æ³•çš„æ–¹æ³•ç­¾å- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel &#123; return [self.objc methodSignatureForSelector:sel];&#125;// 2. ç±»ä¼¼äºæ–¹æ³•é‡å®šå‘- (void)forwardInvocation:(NSInvocation *)invocation &#123; // åˆ¤æ–­objcæ˜¯å¦å®ç°äº†è¯¥æ–¹æ³• if ([self.objc respondsToSelector:invocation.selector]) &#123; // è®©objcè°ƒç”¨è¯¥æ–¹æ³• [invocation invokeWithTarget:self.objc]; &#125;else &#123; // æ‰¾ä¸åˆ°è¯¥æ–¹æ³• [invocation doesNotRecognizeSelector:invocation.selector]; &#125;&#125;- (BOOL)respondsToSelector:(SEL)aSelector&#123; return [self.objc respondsToSelector:aSelector];&#125;@end è‡ªå®šä¹‰ Cat å’Œ Dog ç±» 12345678910111213141516171819//********Catç±»********@interface Cat : NSObject@end@implementation Cat- (void)eat&#123; NSLog(@&quot;çŒ«åƒé±¼&quot;);&#125;@end//********Dogç±»********@interface Dog : NSObject@end@implementation Dog- (void)shut&#123; NSLog(@&quot;ç‹—å«&quot;);&#125;@end é€šè¿‡ ZJProxy å®ç° å¤šç»§æ‰¿ 123456789Dog * dog = [[Dog alloc] init];Cat * cat = [[Cat alloc] init];ZJProxy *proxy = [ZJProxy alloc]; [proxy transformObjc:cat];[proxy performSelector:@selector(eat)]; [proxy transformObjc:dog];[proxy performSelector:@selector(shut)]; ã€åœºæ™¯äºŒã€‘ï¼šé€šè¿‡ ZJProxy è§£å†³ NSTimerè®¡æ—¶å™¨ä¸­selfå¼ºå¼•ç”¨ é—®é¢˜ 12self.timer = [NSTimer timerWithTimeInterval:1 target:[ZJProxy proxyWithObjc:self] selector:@selector(print) userInfo:nil repeats:YES];[[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes]; åˆ«å¿˜äº†åœ¨ dealloc ä¸­è°ƒç”¨ [self.timer invalidate] ã€åœºæ™¯ä¸‰ã€‘ï¼šé€šè¿‡ ZJProxy è§£å†³ CADisplayLinkè®¡æ—¶å™¨ä¸­selfå¼ºå¼•ç”¨ é—®é¢˜ 12self.link = [CADisplayLink displayLinkWithTarget:[ZJProxy proxyWithObjc:self] selector:@selector(linkMethod:)];[self.link addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes]; åŒæ ·ï¼Œåˆ«å¿˜äº†åœ¨ dealloc ä¸­è°ƒç”¨ [self.link invalidate] æ€»ç»“å¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹å¼ï¼Œä»æ ¹æœ¬ä¸Šæ¥è¯´å°±ä¸¤ç§ï¼Œä»¥ self -&gt; block -&gt; self ä¸ºä¾‹ï¼š æ‰“ç ´ self å¯¹ block çš„å¼ºå¼•ç”¨ï¼Œå¯ä»¥blockå±æ€§ä¿®é¥°ç¬¦ä½¿ç”¨ weakï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´blcokè¿˜æ²¡æœ‰åˆ›å»ºå®Œå°±é‡Šæ”¾äº†ï¼Œæ‰€ä»¥ä»è¿™é‡Œæ‰“ç ´å¼ºå¼•ç”¨è¡Œä¸é€šã€‚ æ‰“ç ´ block å¯¹ self çš„å¼ºå¼•ç”¨ï¼Œä¸»è¦å°±æ˜¯selfçš„ä½œç”¨åŸŸå’Œblockçš„ä½œç”¨åŸŸçš„ é€šè®¯ï¼Œé€šè®¯æœ‰ ä»£ç†ã€ä¼ å€¼ã€é€šçŸ¥ã€ä¼ å‚ ç­‰å‡ ç§æ–¹å¼ï¼Œç”¨äºè§£å†³å¾ªç¯å¼•ç”¨ã€‚ weak-strong-dance __blockï¼ˆblockå†…å¯¹è±¡ç½®ç©ºï¼Œä¸”è°ƒç”¨blockï¼‰ å°†å¯¹è±¡ self ä½œä¸ºblockçš„å‚æ•° é€šè¿‡ NSProxy å­ç±»ä»£æ›¿ self Block åº•å±‚æœ¬è´¨ä¸»è¦æ˜¯é€šè¿‡ clangã€æ–­ç‚¹è°ƒè¯• ç­‰æ–¹å¼åˆ†æBlockåº•å±‚ æœ¬è´¨ å®šä¹‰ block.c æ–‡ä»¶ 12345678#include &quot;stdio.h&quot;int main()&#123; void(^block)(void) = ^&#123; printf(&quot;ZJ&quot;); &#125;; return 0;&#125; åˆ° block.c æ–‡ä»¶ç›®å½•ï¼Œé€šè¿‡ xcrun -sdk iphonesimulator clang -arch x86_64 -rewrite-objc block.cï¼Œå°† block.c ç¼–è¯‘æˆ block.appï¼Œå…¶ä¸­blockåœ¨åº•å±‚è¢«ç¼–è¯‘æˆäº†ä¸€ä¸‹çš„å½¢å¼ï¼š 1234int main()&#123; void(*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA)); return 0;&#125; ç®€åŒ–åï¼š 12345// æ„é€ å‡½æ•°void(*block)(void) = __main_block_impl_0(__main_block_func_0, &amp;__main_block_desc_0_DATA));// blockè°ƒç”¨æ‰§è¡Œblock-&gt;FuncPtr(block); ç›¸å½“äº block ç­‰äº __main_block_impl_0ï¼Œæ˜¯ä¸€ä¸ª å‡½æ•° æŸ¥çœ‹__main_block_impl_0ï¼Œæ˜¯ä¸€ä¸ª ç»“æ„ä½“ï¼ŒåŒæ—¶å¯ä»¥è¯´æ˜ block æ˜¯ä¸€ä¸ª__main_block_impl_0 ç±»å‹çš„ å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ block èƒ½å¤Ÿ %@ æ‰“å°çš„åŸå›  123456789101112131415161718// blockä»£ç å—çš„ç»“æ„ä½“ç±»å‹struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;// block_implçš„ç»“æ„ä½“ç±»å‹struct __block_impl &#123; void *isa; int Flags; int Reserved; void *FuncPtr;&#125;; ã€æ€»ç»“ã€‘ï¼šblock çš„ æœ¬è´¨ æ˜¯ å¯¹è±¡ã€å‡½æ•°ã€ç»“æ„ä½“ï¼Œç”±äºblockå‡½æ•°æ²¡æœ‰åç§°ï¼Œä¹Ÿè¢«ç§°ä¸º åŒ¿åå‡½æ•° block é€šè¿‡ clang ç¼–è¯‘åçš„æºç é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šä»¥ block ä¿®é¥°çš„å˜é‡ä¸ºä¾‹ï¼š 1ã€blockä¸ºä»€ä¹ˆéœ€è¦è°ƒç”¨ï¼Ÿ åœ¨åº•å±‚blockçš„ç±»å‹ __main_block_imp_0 ç»“æ„ä½“ï¼Œé€šè¿‡å…¶åŒåæ„é€ å‡½æ•°åˆ›å»ºï¼Œç¬¬ä¸€ä¸ªä¼ å…¥çš„blockå†…éƒ¨å®ç°ä»£ç å—ï¼Œå³ __main_block_func_0ï¼Œç”¨ fp è¡¨ç¤ºï¼Œç„¶åèµ‹å€¼ç»™ impl å±æ€§ï¼Œç„¶ååœ¨ main ä¸­è¿›è¡Œäº†è°ƒç”¨ï¼Œè¿™ä¹Ÿæ˜¯blockä¸ºä»€ä¹ˆéœ€è¦è°ƒç”¨çš„åŸå› ã€‚å¦‚æœä¸è°ƒç”¨ï¼Œblockå†…éƒ¨å®ç°çš„ä»£ç å—å°†æ— æ³•æ‰§è¡Œï¼Œå¯ä»¥æ€»ç»“ä»¥ä¸‹ä¸¤ç‚¹ï¼š å‡½æ•°å£°æ˜ï¼šå³blockå†…éƒ¨å®ç°å£°æ˜äº†ä¸€ä¸ªå‡½æ•° __main_block_func_0 æ‰§è¡Œå…·ä½“çš„å‡½æ•°å®ç°ï¼šé€šè¿‡è°ƒç”¨blockçš„FuncPstræŒ‡é’ˆï¼Œè°ƒç”¨block 2ã€blockæ˜¯å¦‚ä½•è·å–å¤–ç•Œå˜é‡çš„ å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå¹¶åœ¨blockä¸­è°ƒç”¨ 1234567int main()&#123; int a = 10; void(^block)(void) = ^&#123; printf(&quot;ZJ - %ld&quot;,a); &#125;; return 0;&#125; åº•å±‚ç¼–è¯‘å 123456789101112131415161718192021222324252627struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; int a; // ç¼–è¯‘æ—¶å°±è‡ªåŠ¨ç”Ÿæˆäº†ç›¸åº”çš„å˜é‡ __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _a, int flags=0) : a(_a) &#123; impl.isa = &amp;_NSConcreteStackBlock; // blockçš„isaé»˜è®¤æ˜¯stackBlock impl.Flags = flags; impl.FuncPtr = fp; // å‡½æ•°æŒ‡é’ˆèµ‹å€¼ Desc = desc; &#125;&#125;;static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; int a = __cself-&gt;a; // bound by copy å€¼æ‹·è´ï¼Œå³ a = 10ï¼Œæ­¤æ—¶çš„aäºä¼ å…¥çš„__cselfçš„aå¹¶ä¸æ˜¯åŒä¸€ä¸ª printf(&quot;ZJ - %ld&quot;,a); &#125;static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size;&#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;;int main()&#123; int a = 10; void(*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, a)); return 0;&#125; __main_block_func_0 ä¸­çš„ a æ˜¯ å€¼æ‹·è´ï¼Œå¦‚æœæ­¤æ—¶åœ¨blockå†…éƒ¨å®ç°ä¸­åš a++ æ“ä½œï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼Œä¼šé€ æˆç¼–è¯‘å™¨çš„ä»£ç æ­§ä¹‰ï¼Œå³æ­¤æ—¶çš„ a æ˜¯åªè¯»çš„ æ€»ç»“ï¼š blockæ•è·å¤–ç•Œå˜é‡æ—¶ï¼Œåœ¨ å†…éƒ¨ä¼šè‡ªåŠ¨ç”ŸæˆåŒä¸€ä¸ªå±æ€§æ¥ä¿å­˜ __blockçš„åŸç† å¯¹ a åŠ ä¸€ä¸ª __blockï¼Œç„¶ååœ¨blockä¸­å¯¹ a è¿›è¡Œ ++ æ“ä½œ 12345678int main()&#123; __block int a = 10; void(^block)(void) = ^&#123; a ++; printf(&quot;ZJ - %ld&quot;,a); &#125;; return 0;&#125; åº•å±‚ç¼–è¯‘å¦‚ä¸‹ï¼š mainä¸­çš„ a æ˜¯é€šè¿‡å¤–ç•Œå˜é‡å°è£…çš„ å¯¹è±¡ __main_block_impl_0 ä¸­ï¼Œå°† å¯¹è±¡a çš„åœ°å€ &amp;a ç»™æ„é€ å‡½æ•° åœ¨ __main_block_func_0 å†…éƒ¨å¯¹açš„å¤„ç†æ˜¯ æŒ‡é’ˆæ‹·è´ï¼Œæ­¤æ—¶åˆ›å»ºçš„å¯¹è±¡aä¸ä¼ å…¥å¯¹è±¡çš„a æŒ‡å‘åŒä¸€ç‰‡å†…å­˜ç©ºé—´ 1234567891011121314151617181920212223242526272829303132333435363738// __blockä¿®é¥°çš„å¤–ç•Œå˜é‡ç»“æ„ä½“struct __Block_byref_a_0 &#123; void *__isa;__Block_byref_a_0 *__forwarding; int __flags; int __size; int a;&#125;;// __blockçš„ç»“æ„ä½“ç±»å‹struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; __Block_byref_a_0 *a; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_a_0 *_a, int flags=0) : a(_a-&gt;__forwarding) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;// blockå†…éƒ¨å®ç°static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; __Block_byref_a_0 *a = __cself-&gt;a; // bound by ref æŒ‡é’ˆæ‹·è´ï¼Œæ­¤æ—¶å¯¹è±¡a ä¸ __cselfå¯¹è±¡çš„aæŒ‡å‘åŒä¸€ç‰‡åœ°å€ç©ºé—´ // ç­‰åŒäº å¤–ç•Œçš„a++ (a-&gt;__forwarding-&gt;a) ++; printf(&quot;ZJ - %ld&quot;,(a-&gt;__forwarding-&gt;a)); &#125;int main()&#123; // __Block_byref_a_0 æ˜¯ç»“æ„ä½“ï¼Œa ç­‰äº ç»“æ„ä½“çš„èµ‹å€¼ï¼Œå³å¤–ç•Œå˜é‡a å°è£…æˆå¯¹è±¡ // &amp;a æ˜¯å¤–ç•Œå˜é‡açš„åœ°å€ __attribute__((__blocks__(byref))) __Block_byref_a_0 a = &#123;(void*)0,(__Block_byref_a_0 *)&amp;a, 0, sizeof(__Block_byref_a_0), 10&#125;; // _main_block_img_0ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°&amp;aï¼Œæ˜¯å°è£…å¯¹è±¡açš„åœ°å€ void(*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_a_0 *)&amp;a, 570425344)); return 0;&#125; æ€»ç»“ï¼š å¤–ç•Œå˜é‡ ä¼šç”Ÿæˆ __block_byref_a_0 ç»“æ„ä½“ ç»“æ„ä½“ç”¨æ¥ ä¿å­˜åŸå§‹å˜é‡çš„æŒ‡é’ˆå’Œå€¼ å°†å˜é‡ç”Ÿæˆçš„ ç»“æ„ä½“å¯¹è±¡çš„æŒ‡é’ˆåœ°å€ï¼Œä¼ é€’ç»™blockï¼Œç„¶ååœ¨blockå†…éƒ¨å°±å¯ä»¥å¯¹å¤–ç•Œå˜é‡è¿›è¡Œæ“ä½œäº† ä¸¤ç§æ‹·è´å¯¹æ¯”ï¼š å€¼æ‹·è´ï¼š-æ·±æ‹·è´ï¼Œåªæ˜¯æ‹·è´å€¼ï¼Œä¸”æ‹·è´çš„å€¼ä¸å¯ä»¥æ›´æ”¹ï¼ŒæŒ‡å‘ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œæ¡ˆåˆ—ä¸­æ™®é€šå˜é‡aå°±æ˜¯å€¼æ‹·è´ æŒ‡é’ˆæ‹·è´ï¼š-æµ…æ‹·è´ï¼Œç”Ÿæˆçš„å¯¹è±¡æŒ‡å‘åŒä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œæ¡ˆåˆ—ä¸­ç»è¿‡__blockä¿®é¥°çš„å˜é‡aå°±æ˜¯ æŒ‡é’ˆæ‹·è´ blockåº•å±‚çš„çœŸæ­£ç±»å‹åˆ†æblockæºç æ‰€åœ¨ä½ç½® è¿è¡Œä¸‹é¢çš„ä»£ç ï¼Œå¹¶å¼€å¯ Always Show Disassemblyåæ±‡ç¼– 12345int a = 10;void(^block)(void) = ^&#123; NSLog(@&quot;ZJ = %d&quot;,a);&#125;;block(); é€šè¿‡åœ¨blockå¤„æ‰“æ–­ç‚¹ï¼Œåˆ†æè¿è¡Œæ—¶çš„block åŠ  objc_retainBlock ç¬¦å·æ–­ç‚¹ï¼Œå‘ç°ä¼šèµ°åˆ° _Block_copy åŠ  _Block_copy ç¬¦å·æ–­ç‚¹ï¼Œè¿è¡Œæ—¶åœ¨ libsystem_blocks.dylib æºç ä¸­ å¯ä»¥åˆ°è‹¹æœå¼€æºç½‘ç«™ä¸‹è½½æœ€æ–°çš„ libcloseure-074 æºç ï¼Œé€šè¿‡æŸ¥çœ‹ _Block_copy çš„æºç å®ç°ï¼Œå‘ç°blockåº•å±‚çš„çœŸæ­£ç±»å‹æ˜¯_Block_layout Blockçš„çœŸæ­£ç±»å‹æŸ¥çœ‹ Block_layout ç±»å‹çš„å®šä¹‰ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼š 1234567891011121314// Block ç»“æ„ä½“struct Block_layout &#123; // æŒ‡å‘è¡¨æ˜blockç±»å‹çš„ç±» void *isa; // 8å­—èŠ‚ // ç”¨æ¥ä½œæ ‡è¯†ç¬¦çš„ï¼Œç±»ä¼¼äºisaä¸­çš„ä½åŸŸ,æŒ‰bitä½è¡¨ç¤ºä¸€äº›blockçš„é™„åŠ ä¿¡æ¯ volatile int32_t flags; // contains ref count 4å­—èŠ‚ // ä¿ç•™ä¿¡æ¯ï¼Œå¯ä»¥ç†è§£é¢„ç•™ä½ç½®ï¼Œç”¨äºå­˜å‚¨blockå†…éƒ¨å˜é‡ä¿¡æ¯ int32_t reserved; // 4å­—èŠ‚ // å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å…·ä½“çš„blockå®ç°çš„è°ƒç”¨åœ°å€ BlockInvokeFunction invoke; // blockçš„é™„åŠ ä¿¡æ¯ struct Block_descriptor_1 *descriptor; // imported variables&#125;; isaï¼šæŒ‡å‘è¡¨æ˜blockç±»å‹çš„ç±» flagsï¼šæ ‡è¯†ç¬¦ï¼ŒæŒ‰bitä½è¡¨ç¤ºä¸€äº›blockçš„é™„åŠ ä¿¡æ¯ï¼Œç±»ä¼¼äºisaä¸­çš„ä½åŸŸï¼Œå…¶ä¸­flags çš„ç§ç±»æœ‰ä»¥ä¸‹å‡ ç§ï¼Œä¸»è¦é‡ç‚¹å…³æ³¨ BLOCK_HAS_COPY_DISPOSE å’Œ BLOCK_HAS_SIGNATUREã€‚BLOCK_HAS_COPY_DISPOSE å†³å®šæ˜¯å¦æœ‰Block_descriptor_2ã€‚BLOCK_HAS_SIGNATURE å†³å®šæ˜¯å¦æœ‰Block_descriptor_3ï¼š ç¬¬1 ä½ - BLOCK_DEALLOCATINGï¼Œé‡Šæ”¾æ ‡è®°ï¼Œ-èˆ¬å¸¸ç”¨ BLOCK_NEEDS_FREE åš ä½ä¸ æ“ä½œï¼Œä¸€åŒä¼ å…¥ Flags ï¼Œ å‘ŠçŸ¥è¯¥ block å¯é‡Šæ”¾ã€‚ ä½16ä½ - BLOCK_REFCOUNT_MASKï¼Œå­˜å‚¨å¼•ç”¨è®¡æ•°çš„å€¼;æ˜¯ä¸€ä¸ªå¯é€‰ç”¨å‚æ•° ç¬¬24ä½ - BLOCK_NEEDS_FREEï¼Œä½16æ˜¯å¦æœ‰æ•ˆçš„æ ‡å¿—ï¼Œç¨‹åºæ ¹æ®å®ƒæ¥å†³å®šæ˜¯å¦å¢åŠ æˆ–æ˜¯å‡å°‘å¼•ç”¨è®¡æ•°ä½çš„ å€¼; ç¬¬25ä½ - BLOCK_HAS_COPY_DISPOSEï¼Œæ˜¯å¦æ‹¥æœ‰æ‹·è´è¾…åŠ©å‡½æ•°(a copy helper function); ç¬¬26ä½ - BLOCK_IS_GCï¼Œæ˜¯å¦æ‹¥æœ‰ block ææ„å‡½æ•°; ç¬¬27ä½ï¼Œæ ‡å¿—æ˜¯å¦æœ‰åƒåœ¾å›æ”¶; ç¬¬28ä½ - BLOCK_IS_GLOBALï¼Œæ ‡å¿—æ˜¯å¦æ˜¯å…¨å±€block; ç¬¬30ä½ - BLOCK_HAS_SIGNATUREï¼Œä¸ BLOCK_USE_STRET ç›¸å¯¹ï¼Œåˆ¤æ–­å½“å‰ block æ˜¯å¦æ‹¥æœ‰ä¸€ä¸ªç­¾åã€‚ç”¨äº runtime æ—¶åŠ¨æ€è°ƒç”¨ã€‚ 123456789101112131415161718192021222324// æ³¨é‡Š: flags æ ‡è¯†// Values for Block_layout-&gt;flags to describe block objectsenum &#123; // é‡Šæ”¾æ ‡è®°ï¼Œä¸€èˆ¬å¸¸ç”¨äºBLOCK_BYREF_NEEDS_FREEåšä½ä¸è¿ç®—ï¼Œä¸€åŒä¼ å…¥flagsï¼Œå‘ŠçŸ¥è¯¥blockå¯é‡Šæ”¾ BLOCK_DEALLOCATING = (0x0001), // runtime // å­˜å‚¨å¼•ç”¨å¼•ç”¨è®¡æ•°çš„ å€¼ï¼Œæ˜¯ä¸€ä¸ªå¯é€‰ç”¨å‚æ•° BLOCK_REFCOUNT_MASK = (0xfffe), // runtime // ä½16ä½æ˜¯å¦æœ‰æ•ˆçš„æ ‡å¿—ï¼Œç¨‹åºæ ¹æ®å®ƒæ¥å†³å®šæ˜¯å¦å¢åŠ æˆ–è€…å‡å°‘å¼•ç”¨è®¡æ•°ä½çš„å€¼ BLOCK_NEEDS_FREE = (1 &lt;&lt; 24), // runtime // æ˜¯å¦æ‹¥æœ‰æ‹·è´è¾…åŠ©å‡½æ•°ï¼Œï¼ˆa copy helper functionï¼‰å†³å®šblock_description_2 BLOCK_HAS_COPY_DISPOSE = (1 &lt;&lt; 25), // compiler // æ˜¯å¦æ‹¥æœ‰block C++ææ„å‡½æ•° BLOCK_HAS_CTOR = (1 &lt;&lt; 26), // compiler: helpers have C++ code // æ ‡å¿—æ˜¯å¦æœ‰åƒåœ¾å›æ”¶ï¼ŒOSX BLOCK_IS_GC = (1 &lt;&lt; 27), // runtime // æ ‡å¿—æ˜¯å¦æ˜¯å…¨å±€block BLOCK_IS_GLOBAL = (1 &lt;&lt; 28), // compiler // ä¸BLOCK_HAS_SIGNATUREç›¸å¯¹ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰blockæ‹¥æœ‰ä¸€ä¸ªç­¾åï¼Œç”¨äºruntimeæ—¶åŠ¨æ€è°ƒç”¨ BLOCK_USE_STRET = (1 &lt;&lt; 29), // compiler: undefined if !BLOCK_HAS_SIGNATURE // æ˜¯å¦æœ‰ç­¾å BLOCK_HAS_SIGNATURE = (1 &lt;&lt; 30), // compiler // ä½¿ç”¨æœ‰æ‹“å±•ï¼Œå†³å®šblock_description_3 BLOCK_HAS_EXTENDED_LAYOUT=(1 &lt;&lt; 31) // compiler&#125;; reservedï¼šä¿ç•™ä¿¡æ¯ï¼Œå¯ä»¥ç†è§£é¢„ç•™ä½ç½®ï¼ŒçŒœæµ‹æ˜¯ç”¨äºå­˜å‚¨blockå†…éƒ¨å˜é‡ä¿¡æ¯ invokeï¼šæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘blockçš„æ‰§è¡Œä»£ç  descriptorï¼š blockçš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚ä¿ç•™å˜é‡æ•°ã€blockçš„å¤§å°ã€è¿›è¡Œcopyæˆ–disposeçš„è¾…åŠ©å‡½æ•°æŒ‡é’ˆã€‚æœ‰ä¸‰ç±»ï¼š Block_descriptor_1 æ˜¯å¿…é€‰çš„ Block_descriptor_2 å’Œ Block_descriptor_3 éƒ½æ˜¯å¯é€‰çš„ 12345678910111213141516171819#define BLOCK_DESCRIPTOR_1 1struct Block_descriptor_1 &#123; uintptr_t reserved;//ä¿ç•™ä¿¡æ¯ uintptr_t size;//blockå¤§å°&#125;;#define BLOCK_DESCRIPTOR_2 1struct Block_descriptor_2 &#123; // requires BLOCK_HAS_COPY_DISPOSE BlockCopyFunction copy;//æ‹·è´å‡½æ•°æŒ‡é’ˆ BlockDisposeFunction dispose;&#125;;#define BLOCK_DESCRIPTOR_3 1struct Block_descriptor_3 &#123; // requires BLOCK_HAS_SIGNATURE const char *signature;//ç­¾å const char *layout; // contents depend on BLOCK_HAS_EXTENDED_LAYOUT å¸ƒå±€&#125;; ä»¥ä¸Šå…³äº descriptor çš„å¯ä»¥ä»å…¶æ„é€ å‡½æ•°ä¸­ä½“ç°ï¼Œå…¶ä¸­ Block_descriptor_2 å’ŒBlock_descriptor_3 éƒ½æ˜¯é€šè¿‡ Block_descriptor_1 çš„åœ°å€ï¼Œç»è¿‡å†…å­˜å¹³ç§»å¾—åˆ°çš„ 1234567891011121314151617181920212223242526static struct Block_descriptor_1 * _Block_descriptor_1(struct Block_layout *aBlock)&#123; return aBlock-&gt;descriptor;//é»˜è®¤æ‰“å°&#125;#endif// æ³¨é‡Š:Block çš„æè¿° : copy å’Œ dispose å‡½æ•°static struct Block_descriptor_2 * _Block_descriptor_2(struct Block_layout *aBlock)&#123; if (! (aBlock-&gt;flags &amp; BLOCK_HAS_COPY_DISPOSE)) return NULL; uint8_t *desc = (uint8_t *)aBlock-&gt;descriptor;//descriptor_1çš„åœ°å€ desc += sizeof(struct Block_descriptor_1);//é€šè¿‡å†…å­˜å¹³ç§»è·å– return (struct Block_descriptor_2 *)desc;&#125;// æ³¨é‡Š: Block çš„æè¿° : ç­¾åç›¸å…³static struct Block_descriptor_3 * _Block_descriptor_3(struct Block_layout *aBlock)&#123; if (! (aBlock-&gt;flags &amp; BLOCK_HAS_SIGNATURE)) return NULL; uint8_t *desc = (uint8_t *)aBlock-&gt;descriptor; desc += sizeof(struct Block_descriptor_1); if (aBlock-&gt;flags &amp; BLOCK_HAS_COPY_DISPOSE) &#123; desc += sizeof(struct Block_descriptor_2); &#125; return (struct Block_descriptor_3 *)desc;&#125; blockå†…å­˜å˜åŒ–1ã€æ²¡æœ‰å¤–éƒ¨å˜é‡çš„ block: æ‰“æ–­ç‚¹è¿è¡Œï¼Œèµ°åˆ° objc_retainBlockï¼Œblockæ–­ç‚¹å¤„è¯»å–å¯„å­˜å™¨ x0ï¼Œæ­¤æ—¶ block æ˜¯ å…¨å±€blockï¼Œå³ __NSGlobalBlock__ï¼š 2ã€å¢åŠ å¤–éƒ¨å˜é‡açš„blockï¼š åŒä¸Šï¼Œæ‰§è¡Œåˆ°ç¬¦å·æ–­ç‚¹ objc_retainBlockï¼Œå¾—åˆ°çš„ block æ˜¯ æ ˆblockï¼Œå³__NSStackBlockï¼š å¢åŠ  _Block_copy ç¬¦å·æ–­ç‚¹å¹¶æ–­ä½ï¼Œç›´æ¥åœ¨æœ€åçš„ ret åŠ æ–­ç‚¹ï¼Œè¯»å– x0ï¼Œå‘ç°ç»è¿‡ _Block_copy ä¹‹åï¼Œå˜æˆäº† å †blockï¼Œå³ __NSMallocBlock__ï¼Œä¸»è¦æ˜¯å› ä¸ºblockåœ°å€å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸ºå † block: è°ƒç”¨æƒ…å†µ åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡æ–­ç‚¹æ¥éªŒè¯ register read x0 è¯»å–x0ï¼Œä¸ºå †block register read x9 è¯»å–x9 register read x11 ï¼Œæ­¤æ—¶æ˜¯æŒ‡å‘ä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œç”¨äºå­˜å‚¨ _block_invoke æŒ‰ä½ control + step intoï¼Œè¿›å…¥ _block_invokeï¼Œå¯ä»¥å¾—å‡ºæ˜¯é€šè¿‡å†…å­˜å¹³ç§»å¾—åˆ°çš„blockå†…éƒ¨å®ç° å‰é¢æåˆ°çš„ Block_layout çš„ç»“æ„ä½“æºç ,ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸ªå±æ€§ invokeï¼Œå³blockçš„æ‰§è¡Œè€…ï¼Œæ˜¯ä» isa çš„é¦–åœ°å€å¹³ç§» 16 å­—èŠ‚å–åˆ° invokeï¼Œç„¶åè¿›è¡Œè°ƒç”¨æ‰§è¡Œçš„ ç­¾å ç»§ç»­æ“ä½œï¼Œè¯»å– x0 å¯„å­˜å™¨,çœ‹å†…å­˜å¸ƒå±€,é€šè¿‡ å†…å­˜å¹³ç§» 3*8 å°±å¯è·å¾— Block_layout çš„å±æ€§ descriptor,ä¸»è¦æ˜¯ä¸ºäº†æŸ¥çœ‹æ˜¯å¦æœ‰ Block_descriptor_2 å’Œ Block_descriptor_3ï¼Œå…¶ä¸­3ä¸­æœ‰blockçš„ç­¾å register read x0ï¼Œè¯»å–å¯„å­˜å™¨x0 po 0x00000002828a2160 ï¼Œ æ‰“å°block x/8gx 0x00000002828a2160 ï¼Œå³æ‰“å°blockå†…å­˜æƒ…å†µ x/8gx 0x00000001008a0010 ï¼Œ æŸ¥çœ‹descriptorçš„å†…å­˜æƒ…å†µï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ª0x000000010089f395 è¡¨ç¤ºç­¾å åˆ¤æ–­æ˜¯å¦æœ‰ Block_descriptor_2ï¼Œå³flagsçš„ BLOCK_HAS_COPY_DISPOSEï¼ˆæ‹·è´è¾…åŠ©å‡½æ•°ï¼‰æ˜¯å¦æœ‰å€¼ p/x 1&lt;&lt;25 ï¼Œå³1å·¦ç§»25ä½ï¼Œå…¶åå…­è¿›åˆ¶ä¸º 0x2000000 p 0x02000000 &amp; 0x00000000c1000002 ï¼Œå³ BLOCK_HAS_COPY_DISPOSE &amp; flags ï¼Œç­‰äº0ï¼Œè¡¨ç¤ºæ²¡æœ‰ Block_descriptor_2 åˆ¤æ–­æ˜¯å¦æœ‰ Block_descriptor_3 p/x 1&lt;&lt;30ï¼Œå³1å·¦ç§»30ä½ p 0x40000000 &amp; 0x00000000c1000002 ï¼Œå³ BLOCK_HAS_SIGNATURE &amp; flags ï¼Œæœ‰å€¼ï¼Œè¯´æ˜æœ‰ Block_descriptor_3 p (char *)0x000000010089f395 â€“ è·å– Block_descriptor_3 ä¸­çš„å±æ€§ signature ç­¾å po [NSMethodSignature signatureWithObjCTypes:&quot;v8@?0&quot;] ï¼Œå³æ‰“å°ç­¾å å…¶ä¸­ç­¾åçš„éƒ¨åˆ†è¯´æ˜å¦‚ä¸‹: 12345678910111213141516//æ— è¿”å›å€¼return value: -------- -------- -------- -------- type encoding (v) &#x27;v&#x27; flags &#123;&#125; modifiers &#123;&#125; frame &#123;offset = 0, offset adjust = 0, size = 0, size adjust = 0&#125; memory &#123;offset = 0, size = 0&#125;argument 0: -------- -------- -------- -------- //encoding = (@),ç±»å‹æ˜¯ @? type encoding (@) &#x27;@?&#x27; //@æ˜¯isObject ï¼Œï¼Ÿæ˜¯isBlockï¼Œä»£è¡¨ isBlockObject flags &#123;isObject, isBlock&#125; modifiers &#123;&#125; frame &#123;offset = 0, offset adjust = 0, size = 8, size adjust = 0&#125; //æ‰€åœ¨åç§»ä½ç½®æ˜¯8å­—èŠ‚ memory &#123;offset = 0, size = 8&#125; blockçš„ç­¾åä¿¡æ¯ç±»ä¼¼äºæ–¹æ³•çš„ç­¾åä¿¡æ¯ï¼Œä¸»è¦æ˜¯ä½“ç°blockçš„è¿”å›å€¼ï¼Œå‚æ•°ä»¥åŠç±»å‹ç­‰ä¿¡æ¯ blockä¸‰æ¬¡copyåˆ†æ_Block_copyæºç åˆ†æ è¿›å…¥ _Block_copy æºç ï¼Œå°† block ä»æ ˆåŒºæ‹·è´è‡³å †åŒº å¦‚æœéœ€è¦é‡Šæ”¾ï¼Œåˆ™ç›´æ¥é‡Šæ”¾ å¦‚æœæ˜¯ globalBlock â€“ ä¸éœ€è¦copyï¼Œç›´æ¥è¿”å› åä¹‹ï¼Œåªæœ‰ä¸¤ç§æƒ…å†µï¼šæ ˆåŒºblock or å †åŒºblockï¼Œç”±äºå †åŒºblockéœ€è¦ç”³è¯·ç©ºé—´ï¼Œå‰é¢å¹¶æ²¡æœ‰ç”³è¯·ç©ºé—´çš„ç›¸å…³ä»£ç ï¼Œæ‰€ä»¥åªèƒ½æ˜¯ æ ˆåŒºblock: é€šè¿‡ malloc ç”³è¯·å†…å­˜ç©ºé—´ç”¨äºæ¥æ”¶block é€šè¿‡ memmove å°†blockæ‹·è´è‡³æ–°ç”³è¯·çš„å†…å­˜ä¸­ è®¾ç½®blockå¯¹è±¡çš„ç±»å‹ä¸ºå †åŒºblockï¼Œå³ result-&gt;isa = _NSConcreteMallocBlock 12345678910111213141516171819202122232425262728293031323334353637// Copy, or bump refcount, of a block. If really copying, call the copy helper if present.// é‡ç‚¹æç¤º: è¿™é‡Œæ˜¯æ ¸å¿ƒé‡ç‚¹ blockçš„æ‹·è´æ“ä½œ: æ ˆBlock -&gt; å †Blockvoid *_Block_copy(const void *arg) &#123; struct Block_layout *aBlock; if (!arg) return NULL; // The following would be better done as a switch statement aBlock = (struct Block_layout *)arg;//å¼ºè½¬ä¸ºBlock_layoutç±»å‹å¯¹è±¡ï¼Œé˜²æ­¢å¯¹å¤–ç•Œé€ æˆå½±å“ if (aBlock-&gt;flags &amp; BLOCK_NEEDS_FREE) &#123;//æ˜¯å¦éœ€è¦é‡Šæ”¾ // latches on high latching_incr_int(&amp;aBlock-&gt;flags); return aBlock; &#125; else if (aBlock-&gt;flags &amp; BLOCK_IS_GLOBAL) &#123;//å¦‚æœæ˜¯å…¨å±€blockï¼Œç›´æ¥è¿”å› return aBlock; &#125; else &#123;//ä¸ºæ ˆblock æˆ–è€… å †blockï¼Œç”±äºå †åŒºéœ€è¦ç”³è¯·å†…å­˜ï¼Œæ‰€ä»¥åªå¯èƒ½æ˜¯æ ˆåŒº // Its a stack block. Make a copy. å®ƒæ˜¯ä¸€ä¸ªå †æ ˆå—blockï¼Œæ‹·è´ã€‚ struct Block_layout *result = (struct Block_layout *)malloc(aBlock-&gt;descriptor-&gt;size);//ç”³è¯·ç©ºé—´å¹¶æ¥æ”¶ if (!result) return NULL; //é€šè¿‡memmoveå†…å­˜æ‹·è´ï¼Œå°† aBlock æ‹·è´è‡³result memmove(result, aBlock, aBlock-&gt;descriptor-&gt;size); // bitcopy first#if __has_feature(ptrauth_calls) // Resign the invoke pointer as it uses address authentication. result-&gt;invoke = aBlock-&gt;invoke;//å¯ä»¥ç›´æ¥è°ƒèµ·invoke#endif // reset refcount result-&gt;flags &amp;= ~(BLOCK_REFCOUNT_MASK|BLOCK_DEALLOCATING); // XXX not needed å‘ŠçŸ¥å¯é‡Šæ”¾ result-&gt;flags |= BLOCK_NEEDS_FREE | 2; // logical refcount 1 _Block_call_copy_helper(result, aBlock); // Set isa last so memory analysis tools see a fully-initialized object. result-&gt;isa = _NSConcreteMallocBlock;//è®¾ç½®blockå¯¹è±¡ç±»å‹ä¸ºå †åŒºblock return result; &#125;&#125; _Block_ovject_assignåˆ†æ æƒ³è¦åˆ†æblockçš„ä¸‰å±‚copyï¼Œé¦–å…ˆéœ€è¦çŸ¥é“å¤–éƒ¨å˜é‡çš„ç§ç±»æœ‰å“ªäº›ï¼Œå…¶ä¸­ç”¨çš„æœ€å¤šçš„æ˜¯ BLOCK_FIELD_IS_OBJECT å’Œ BLOCK_FIELD_IS_BYREF 1234567891011121314151617// æ³¨é‡Š: Block æ•è·çš„å¤–ç•Œå˜é‡çš„ç§ç±»// Runtime support functions used by compiler when generating copy/dispose helpers// Values for _Block_object_assign() and _Block_object_dispose() parametersenum &#123; // see function implementation for a more complete description of these fields and combinations //æ™®é€šå¯¹è±¡ï¼Œå³æ²¡æœ‰å…¶ä»–çš„å¼•ç”¨ç±»å‹ BLOCK_FIELD_IS_OBJECT = 3, // id, NSObject, __attribute__((NSObject)), block, ... //blockç±»å‹ä½œä¸ºå˜é‡ BLOCK_FIELD_IS_BLOCK = 7, // a block variable //ç»è¿‡__blockä¿®é¥°çš„å˜é‡ BLOCK_FIELD_IS_BYREF = 8, // the on stack structure holding the __block variable //weak å¼±å¼•ç”¨å˜é‡ BLOCK_FIELD_IS_WEAK = 16, // declared __weak, only used in byref copy helpers //è¿”å›çš„è°ƒç”¨å¯¹è±¡ - å¤„ç†block_byrefå†…éƒ¨å¯¹è±¡å†…å­˜ä¼šåŠ çš„ä¸€ä¸ªé¢å¤–æ ‡è®°ï¼Œé…åˆflagsä¸€èµ·ä½¿ç”¨ BLOCK_BYREF_CALLER = 128, // called from __block (byref) copy/dispose support routines.&#125;; è€Œ _Block_object_assign æ˜¯åœ¨åº•å±‚ç¼–è¯‘ä»£ç ä¸­ï¼Œå¤–éƒ¨å˜é‡æ‹·è´æ—¶è°ƒç”¨çš„æ–¹æ³•å°±æ˜¯å®ƒ è¿›å…¥ _Block_object_assign æºç  å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œåˆ™äº¤ç»™ ç³»ç»Ÿarcå¤„ç†ï¼Œå¹¶æ‹·è´ å¯¹è±¡æŒ‡é’ˆï¼Œå³ å¼•ç”¨è®¡æ•°+1ï¼Œæ‰€ä»¥å¤–ç•Œå˜é‡ä¸èƒ½é‡Šæ”¾ å¦‚æœæ˜¯ blockç±»å‹ çš„å˜é‡ï¼Œåˆ™é€šè¿‡ _Block_copy æ“ä½œï¼Œå°†blockä»æ ˆåŒºæ‹·è´åˆ°å †åŒº å¦‚æœæ˜¯ __blockä¿®é¥° çš„å˜é‡ï¼Œè°ƒç”¨ _Block_byref_copy å‡½æ•° è¿›è¡Œå†…å­˜æ‹·è´ä»¥åŠå¸¸è§„å¤„ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647static struct Block_byref *_Block_byref_copy(const void *arg) &#123; //å¼ºè½¬ä¸ºBlock_byrefç»“æ„ä½“ç±»å‹ï¼Œä¿å­˜ä¸€ä»½ struct Block_byref *src = (struct Block_byref *)arg; if ((src-&gt;forwarding-&gt;flags &amp; BLOCK_REFCOUNT_MASK) == 0) &#123; // src points to stack ç”³è¯·å†…å­˜ struct Block_byref *copy = (struct Block_byref *)malloc(src-&gt;size); copy-&gt;isa = NULL; // byref value 4 is logical refcount of 2: one for caller, one for stack copy-&gt;flags = src-&gt;flags | BLOCK_BYREF_NEEDS_FREE | 4; // blockå†…éƒ¨æŒæœ‰çš„Block_byref å’Œ å¤–ç•Œçš„Block_byref æ‰€æŒæœ‰çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ__blockä¿®é¥°çš„å˜é‡å…·æœ‰ä¿®æ”¹èƒ½åŠ› // copy å’Œ scr çš„åœ°å€æŒ‡é’ˆè¾¾åˆ°äº†å®Œç¾çš„åŒä¸€ä»½æ‹·è´ï¼Œç›®å‰åªæœ‰æŒæœ‰èƒ½åŠ› copy-&gt;forwarding = copy; // patch heap copy to point to itself src-&gt;forwarding = copy; // patch stack to point to heap copy copy-&gt;size = src-&gt;size; // å¦‚æœæœ‰copyèƒ½åŠ› if (src-&gt;flags &amp; BLOCK_BYREF_HAS_COPY_DISPOSE) &#123; // Trust copy helper to copy everything of interest // If more than one field shows up in a byref block this is wrong XXX //Block_byref_2æ˜¯ç»“æ„ä½“ï¼Œ__blockä¿®é¥°çš„å¯èƒ½æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡é€šè¿‡byref_keepä¿å­˜ï¼Œåœ¨åˆé€‚çš„æ—¶æœºè¿›è¡Œè°ƒç”¨ struct Block_byref_2 *src2 = (struct Block_byref_2 *)(src+1); struct Block_byref_2 *copy2 = (struct Block_byref_2 *)(copy+1); copy2-&gt;byref_keep = src2-&gt;byref_keep; copy2-&gt;byref_destroy = src2-&gt;byref_destroy; if (src-&gt;flags &amp; BLOCK_BYREF_LAYOUT_EXTENDED) &#123; struct Block_byref_3 *src3 = (struct Block_byref_3 *)(src2+1); struct Block_byref_3 *copy3 = (struct Block_byref_3*)(copy2+1); copy3-&gt;layout = src3-&gt;layout; &#125; // ç­‰ä»·äº __Block_byref_id_object_copy (*src2-&gt;byref_keep)(copy, src); &#125; else &#123; // Bitwise copy. // This copy includes Block_byref_3, if any. memmove(copy+1, src+1, src-&gt;size - sizeof(*src)); &#125; &#125; // already copied to heap else if ((src-&gt;forwarding-&gt;flags &amp; BLOCK_BYREF_NEEDS_FREE) == BLOCK_BYREF_NEEDS_FREE) &#123; latching_incr_int(&amp;src-&gt;forwarding-&gt;flags); &#125; return src-&gt;forwarding;&#125; è¿›å…¥ _Block_byref_copy æºç  å°†ä¼ å…¥çš„å¯¹è±¡ï¼Œå¼ºè½¬ä¸º Block_byref ç»“æ„ä½“ç±»å‹å¯¹è±¡ï¼Œä¿å­˜ä¸€ä»½ æ²¡æœ‰å°†å¤–ç•Œå˜é‡æ‹·è´åˆ°å †ï¼Œéœ€è¦ç”³è¯·å†…å­˜ï¼Œå…¶è¿›è¡Œæ‹·è´ å¦‚æœå·²ç»æ‹·è´è¿‡äº†ï¼Œåˆ™è¿›è¡Œå¤„ç†å¹¶è¿”å› å…¶ä¸­ copy å’Œsrcçš„ forwarding æŒ‡é’ˆéƒ½æŒ‡å‘åŒä¸€ç‰‡å†…å­˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ__blockä¿®é¥°çš„å¯¹è±¡å…·æœ‰ä¿®æ”¹èƒ½åŠ›çš„åŸå›  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647static struct Block_byref *_Block_byref_copy(const void *arg) &#123; //å¼ºè½¬ä¸ºBlock_byrefç»“æ„ä½“ç±»å‹ï¼Œä¿å­˜ä¸€ä»½ struct Block_byref *src = (struct Block_byref *)arg; if ((src-&gt;forwarding-&gt;flags &amp; BLOCK_REFCOUNT_MASK) == 0) &#123; // src points to stack ç”³è¯·å†…å­˜ struct Block_byref *copy = (struct Block_byref *)malloc(src-&gt;size); copy-&gt;isa = NULL; // byref value 4 is logical refcount of 2: one for caller, one for stack copy-&gt;flags = src-&gt;flags | BLOCK_BYREF_NEEDS_FREE | 4; //blockå†…éƒ¨æŒæœ‰çš„Block_byref å’Œ å¤–ç•Œçš„Block_byref æ‰€æŒæœ‰çš„å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ__blockä¿®é¥°çš„å˜é‡å…·æœ‰ä¿®æ”¹èƒ½åŠ› //copy å’Œ scr çš„åœ°å€æŒ‡é’ˆè¾¾åˆ°äº†å®Œç¾çš„åŒä¸€ä»½æ‹·è´ï¼Œç›®å‰åªæœ‰æŒæœ‰èƒ½åŠ› copy-&gt;forwarding = copy; // patch heap copy to point to itself src-&gt;forwarding = copy; // patch stack to point to heap copy copy-&gt;size = src-&gt;size; //å¦‚æœæœ‰copyèƒ½åŠ› if (src-&gt;flags &amp; BLOCK_BYREF_HAS_COPY_DISPOSE) &#123; // Trust copy helper to copy everything of interest // If more than one field shows up in a byref block this is wrong XXX //Block_byref_2æ˜¯ç»“æ„ä½“ï¼Œ__blockä¿®é¥°çš„å¯èƒ½æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡é€šè¿‡byref_keepä¿å­˜ï¼Œåœ¨åˆé€‚çš„æ—¶æœºè¿›è¡Œè°ƒç”¨ struct Block_byref_2 *src2 = (struct Block_byref_2 *)(src+1); struct Block_byref_2 *copy2 = (struct Block_byref_2 *)(copy+1); copy2-&gt;byref_keep = src2-&gt;byref_keep; copy2-&gt;byref_destroy = src2-&gt;byref_destroy; if (src-&gt;flags &amp; BLOCK_BYREF_LAYOUT_EXTENDED) &#123; struct Block_byref_3 *src3 = (struct Block_byref_3 *)(src2+1); struct Block_byref_3 *copy3 = (struct Block_byref_3*)(copy2+1); copy3-&gt;layout = src3-&gt;layout; &#125; //ç­‰ä»·äº __Block_byref_id_object_copy (*src2-&gt;byref_keep)(copy, src); &#125; else &#123; // Bitwise copy. // This copy includes Block_byref_3, if any. memmove(copy+1, src+1, src-&gt;size - sizeof(*src)); &#125; &#125; // already copied to heap else if ((src-&gt;forwarding-&gt;flags &amp; BLOCK_BYREF_NEEDS_FREE) == BLOCK_BYREF_NEEDS_FREE) &#123; latching_incr_int(&amp;src-&gt;forwarding-&gt;flags); &#125; return src-&gt;forwarding;&#125; ä»£ç è°ƒè¯• å®šä¹‰ä¸€ä¸ª __block ä¿®é¥°çš„ NSStringå¯¹è±¡ï¼š 12345678 __block NSString * zj_name = [NSString stringWithFormat:@&quot;ZJ&quot;];void (^block1)(void) = ^&#123; // block_copy zj_name = @&quot;ZJ&quot;; NSLog(@&quot;ZJ - %@&quot;,zj_name); // block å†…å­˜&#125;;block1(); xcrunç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š ç¼–è¯‘åçš„ zj_name æ¯”æ™®é€šå˜é‡å¤šäº† __Block_byref_id_object_copy_131 å’Œ __Block_byref_id_object_dispose_131 __Block_byref_zj_name_0 ç»“æ„ä½“ä¸­å¤šäº† __Block_byref_id_object_copy å’Œ __Block_byref_id_object_dispose 1234567891011121314151617181920212223242526272829303132//********ç¼–è¯‘åçš„zj_name******** __Block_byref_zj_name_0 zj_name = &#123;(void*)0, (__Block_byref_zj_name_0 *)&amp;zj_name, 33554432, sizeof(__Block_byref_zj_name_0), __Block_byref_id_object_copy_131, __Block_byref_id_object_dispose_131, ((NSString * _Nonnull (*)(id, SEL, NSString * _Nonnull, ...))(void *)objc_msgSend)((id)objc_getClass(&quot;NSString&quot;), sel_registerName(&quot;stringWithFormat:&quot;), (NSString *)&amp;__NSConstantStringImpl__var_folders_hr_l_56yp8j4y11491njzqx6f880000gn_T_main_9f330d_mi_0)&#125;; //********__Block_byref_zj_name_0ç»“æ„ä½“********struct __Block_byref_zj_name_0 &#123; void *__isa;__Block_byref_zj_name_0 *__forwarding; int __flags; int __size; void (*__Block_byref_id_object_copy)(void*, void*); void (*__Block_byref_id_object_dispose)(void*); // 5*8 = 40 NSString *zj_name;&#125;; //********__Block_byref_id_object_copy_131******** //blockè‡ªèº«æ‹·è´ï¼ˆ_Block_copyï¼‰ -- __block brefç»“æ„ä½“æ‹·è´(_Block_object_assign) -- _Block_object_assignä¸­å¯¹å¤–éƒ¨å˜é‡ï¼ˆå­˜å‚¨åœ¨brefï¼‰æ‹·è´ä¸€ä»½åˆ°å†…å­˜static void __Block_byref_id_object_copy_131(void *dst, void *src) &#123; // dst å¤–éƒ¨æ•è·çš„å˜é‡ï¼Œå³ç»“æ„ä½“ - 5*8 = 40ï¼Œç„¶åå°±æ‰¾åˆ°äº†zj_name(zj_nameåœ¨brefåˆå§‹åŒ–æ—¶å°±èµ‹å€¼äº†) _Block_object_assign((char*)dst + 40, *(void * *) ((char*)src + 40), 131);&#125; //********__Block_byref_id_object_dispose_131********static void __Block_byref_id_object_dispose_131(void *src) &#123; _Block_object_dispose(*(void * *) ((char*)src + 40), 131);&#125; é€šè¿‡ libclosure-74 å¯ç¼–è¯‘æºç æ–­ç‚¹è°ƒè¯•ï¼Œå…³é”®æ–¹æ³•çš„æ‰§è¡Œé¡ºåºä¸ºï¼š_Block_copy -&gt; _Block_byref_copy -&gt; _Block_object_assign,æ­£å¥½å¯¹åº”ä¸Šè¿°çš„ä¸‰å±‚copy ç»¼ä¸Šæ‰€è¿°ï¼Œblockæ˜¯å¦‚ä½•å–åˆ° zj_name çš„ï¼Ÿ é€šè¿‡ _Block_copy æ–¹æ³•ï¼Œå°†blockæ‹·è´ä¸€ä»½è‡³å †åŒº é€šè¿‡ _Block_object_assign æ–¹æ³•æ­£å¸¸æ‹·è´ï¼Œå› ä¸º__blockä¿®é¥°çš„å¤–ç•Œå˜é‡åœ¨åº•å±‚æ˜¯ Block_byref ç»“æ„ä½“ å‘ç°å¤–éƒ¨å˜é‡è¿˜å­˜æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œä»brefä¸­å–å‡ºç›¸åº”å¯¹è±¡zj_nameï¼Œæ‹·è´è‡³blockç©ºé—´ï¼Œæ‰èƒ½ä½¿ç”¨ï¼ˆç›¸åŒç©ºé—´æ‰èƒ½ä½¿ç”¨ï¼Œä¸åŒåˆ™ä¸èƒ½ä½¿ç”¨ï¼‰ã€‚æœ€åé€šè¿‡ å†…å­˜å¹³ç§» å°±å¾—åˆ°äº† zj_nameï¼Œæ­¤æ—¶çš„zj_name å’Œ å¤–ç•Œçš„zj_nameæ˜¯åŒä¸€ç‰‡å†…å­˜ç©ºé—´ï¼ˆä»_Block_object_assign æ–¹æ³•ä¸­çš„ *dest = object çœ‹å‡ºï¼‰ ä¸‰å±‚copyæ€»ç»“ æ€»ä¸Šæ‰€è¿°ï¼Œblockä¸‰å±‚æ‹·è´æ˜¯æŒ‡ä»¥ä¸‹ä¸‰å±‚ï¼š ã€ç¬¬ä¸€å±‚ã€‘é€šè¿‡ _Block_copy å®ç°å¯¹è±¡çš„ è‡ªèº«æ‹·è´ï¼Œä» æ ˆåŒº æ‹·è´åˆ° å †åŒº ã€ç¬¬äºŒå±‚ã€‘é€šè¿‡ _Block_byref_copy æ–¹æ³•ï¼Œå°†å¯¹è±¡æ‹·è´ä¸º Block_byref ç»“æ„ä½“ç±»å‹ ã€ç¬¬ä¸‰å±‚ã€‘é€šè¿‡ _Block_object_assign æ–¹æ³•ï¼Œå¯¹ __block ä¿®é¥°çš„ å½“å‰å˜é‡çš„æ‹·è´ æ³¨ï¼šåªæœ‰ __blockä¿®é¥° çš„å¯¹è±¡ï¼Œblockå³copyæ‰æœ‰ä¸‰å±‚ _Block_object_disposeåˆ†æ åŒä¸€èˆ¬çš„ retain å’Œ release ä¸€æ ·ï¼Œ_Block_object_dispose å…¶æœ¬è´¨ä¸»è¦æ˜¯ retainï¼Œæ‰€ä»¥å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ª releaseï¼Œå³ _Block_object_dispose æ–¹æ³•ï¼Œå…¶æºç å®ç°å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯é€šè¿‡åŒºåˆ†blockç§ç±»ï¼Œè¿›è¡Œä¸åŒé‡Šæ”¾æ“ä½œ 123456789101112131415161718192021222324// When Blocks or Block_byrefs hold objects their destroy helper routines call this entry point// to help dispose of the contents å½“Blocksæˆ–Block_byrefsæŒæœ‰å¯¹è±¡æ—¶ï¼Œå…¶é”€æ¯åŠ©æ‰‹ä¾‹ç¨‹å°†è°ƒç”¨æ­¤å…¥å£ç‚¹ä»¥å¸®åŠ©å¤„ç½®å†…å®¹void _Block_object_dispose(const void *object, const int flags) &#123; switch (os_assumes(flags &amp; BLOCK_ALL_COPY_DISPOSE_FLAGS)) &#123; case BLOCK_FIELD_IS_BYREF | BLOCK_FIELD_IS_WEAK: case BLOCK_FIELD_IS_BYREF://__blockä¿®é¥°çš„å˜é‡ï¼Œå³brefç±»å‹çš„ // get rid of the __block data structure held in a Block _Block_byref_release(object); break; case BLOCK_FIELD_IS_BLOCK://blockç±»å‹çš„å˜é‡ _Block_release(object) ; break; case BLOCK_FIELD_IS_OBJECT://æ™®é€šå¯¹è±¡ _Block_release_object(object); break; case BLOCK_BYREF_CALLER | BLOCK_FIELD_IS_OBJECT: case BLOCK_BYREF_CALLER | BLOCK_FIELD_IS_BLOCK: case BLOCK_BYREF_CALLER | BLOCK_FIELD_IS_OBJECT | BLOCK_FIELD_IS_WEAK: case BLOCK_BYREF_CALLER | BLOCK_FIELD_IS_BLOCK | BLOCK_FIELD_IS_WEAK: break; default: break; &#125;&#125; è¿›å…¥ _Block_byref_release æºç ï¼Œä¸»è¦å°±æ˜¯å¯¹è±¡ã€å˜é‡çš„é‡Šæ”¾é”€æ¯ 12345678910111213141516171819static void _Block_byref_release(const void *arg) &#123; //å¯¹è±¡å¼ºè½¬ä¸ºBlock_byrefç±»å‹ç»“æ„ä½“ struct Block_byref *byref = (struct Block_byref *)arg; // dereference the forwarding pointer since the compiler isn&#x27;t doing this anymore (ever?) byref = byref-&gt;forwarding;//å–æ¶ˆæŒ‡é’ˆå¼•ç”¨ if (byref-&gt;flags &amp; BLOCK_BYREF_NEEDS_FREE) &#123; int32_t refcount = byref-&gt;flags &amp; BLOCK_REFCOUNT_MASK; os_assert(refcount); if (latching_decr_int_should_deallocate(&amp;byref-&gt;flags)) &#123; if (byref-&gt;flags &amp; BLOCK_BYREF_HAS_COPY_DISPOSE) &#123;//æ˜¯å¦æœ‰æ‹·è´è¾…åŠ©å‡½æ•° struct Block_byref_2 *byref2 = (struct Block_byref_2 *)(byref+1); (*byref2-&gt;byref_destroy)(byref);//é”€æ¯æ‹·è´å¯¹è±¡ &#125; free(byref);//é‡Šæ”¾ &#125; &#125;&#125; æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼ŒBlockçš„ ä¸‰å±‚copy çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†29ï¼šé”çš„åŸç†","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†29ï¼šé”çš„åŸç†","date":"2021-04-10T06:46:18.000Z","updated":"2022-04-08T07:28:09.000Z","comments":true,"path":"2021/04/10/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†29ï¼šé”çš„åŸç†/","link":"","permalink":"https://www.bboyzj.cn/2021/04/10/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8629%EF%BC%9A%E9%94%81%E7%9A%84%E5%8E%9F%E7%90%86/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦ä»‹ç»å¸¸è§çš„é”ï¼Œä»¥åŠ synchronizedã€NSLockã€é€’å½’é”ã€æ¡ä»¶é” çš„åº•å±‚åˆ†æ é”å€Ÿé‰´ä¸€å¼ é”çš„æ€§èƒ½æ•°æ®å¯¹æ¯”å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤º å¯ä»¥çœ‹å‡ºï¼Œå›¾ä¸­é”çš„æ€§èƒ½ä»é«˜åˆ°åº•ä¾æ¬¡æ˜¯ï¼šOSSPinLock(è‡ªæ—‹é”) -&gt; dispatch_semaphone(ä¿¡å·é‡) -&gt; ptread_mutex(äº’æ–¥é”) -&gt; OSSPinLock(è‡ªæ—‹é”) -&gt; NSCondition(æ¡ä»¶é”) -&gt; pthread_mutex(recusive äº’æ–¥é”) -&gt; NSRecursiveLock(é€’å½’é”) -&gt; NSConditionLock(æ¡ä»¶é”) -&gt; synchronized(äº’æ–¥é”) å›¾ä¸­å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š ã€è‡ªæ—‹é”ã€‘ï¼šåœ¨è‡ªæ—‹é”ä¸­ï¼Œçº¿ç¨‹ä¼šåå¤æ£€æŸ¥å˜é‡æ˜¯å¦å¯ç”¨ã€‚ç”±äºçº¿ç¨‹è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€è‡´ä¿æŒæ‰§è¡Œï¼Œæ‰€ä»¥æ˜¯ä¸€ç§å¿™ç­‰å¾…ã€‚ä¸€æ—¦è·å–äº†è‡ªæ—‹é”ï¼Œçº¿ç¨‹ å°±ä¼šä¸€ç›´ä¿æŒè¯¥é”ï¼Œç›´åˆ°æ˜¾ç¤ºé‡Šæ”¾è‡ªæ—‹é”ã€‚è‡ªæ—‹é”é¿å…äº†è¿›ç¨‹ä¸Šä¸‹æ–‡çš„è°ƒåº¦å¼€é”€ï¼Œå› æ­¤å¯¹äº çº¿ç¨‹åªä¼šé˜»å¡å¾ˆçŸ­æ—¶é—´çš„åœºåˆ æ˜¯ æœ‰æ•ˆ çš„ã€‚å¯¹äºiOSå±æ€§çš„ä¿®é¥°ç¬¦ atomicï¼Œè‡ªå¸¦ä¸€æŠŠè‡ªæ—‹é” OSSpinLock atomic ã€äº’æ–¥é”ã€‘ï¼šäº’æ–¥é” æ˜¯ä¸€ç§ç”¨äº å¤šçº¿ç¨‹ç¼–ç¨‹ ä¸­ï¼Œé˜²æ­¢ä¸¤æ¡çº¿ç¨‹åŒæ—¶å¯¹åŒä¸€å…¬å…±èµ„æºï¼ˆä¾‹å¦‚å…¨å±€å˜é‡ï¼‰è¿›è¡Œè¯»å†™çš„æœºåˆ¶ï¼Œè¯¥ç›®çš„æ˜¯é€šè¿‡ å°†ä»£ç åˆ‡æˆä¸€ä¸ªä¸ªä¸´ç•ŒåŒº è€Œè¾¾æˆ @synchroized NSLock pthread_mutex ã€æ¡ä»¶é”ã€‘ï¼šæ¡ä»¶é” å°±æ˜¯ æ¡ä»¶å˜é‡ï¼Œå½“è¿›ç¨‹çš„æŸäº› èµ„æºè¦æ±‚ä¸æ»¡è¶³ æ—¶å°± è¿›å…¥ä¼‘çœ ï¼Œå³é”ä½äº†ï¼Œå½“ èµ„æºè¢«åˆ†é…åˆ°äº†ï¼Œæ¡ä»¶é”æ‰“å¼€äº†ï¼Œè¿›ç¨‹ç»§ç»­è¿›è¡Œ NSCondition NSConditionLock ã€é€’å½’é”ã€‘ï¼šé€’å½’é”å°±æ˜¯ åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŠ é”Næ¬¡è€Œä¸ä¼šå¼•å‘æ­»é”ã€‚é€’å½’é”æ˜¯ ç‰¹æ®Šçš„äº’æ–¥é”ï¼Œå³æ˜¯ å¸¦æœ‰é€’å½’æ€§è´¨çš„äº’æ–¥é” pthread_mutex(recursive) NSRecursiveLock ã€ä¿¡å·é‡ã€‘ï¼šä¿¡å·é‡ æ˜¯ä¸€ç§ æ›´é«˜çº§çš„åŒæ­¥æœºåˆ¶ï¼Œäº’æ–¥é” å¯ä»¥è¯´æ˜¯ semaphoreåœ¨å–å€¼0/1æ—¶çš„ç‰¹ä¾‹ï¼Œä¿¡å·é‡å¯ä»¥æœ‰æ›´å¤šçš„å–å€¼ç©ºé—´ï¼Œç”¨æ¥ å®ç°æ›´åŠ å¤æ‚çš„åŒæ­¥ï¼Œè€Œä¸æ˜¯å•å•çš„çº¿ç¨‹é—´äº’æ–¥ dispatch_semaphore ã€è¯»å†™é”ã€‘ï¼šè¯»å†™é”å®é™…æ˜¯ä¸€ç§ ç‰¹æ®Šçš„è‡ªæ—‹é”ã€‚å°†å¯¹å…±äº«èµ„æºçš„è®¿é—®åˆ†æˆ è¯»è€… å’Œ å†™è€…ï¼Œè¯»è€… åªå¯¹å…±äº«èµ„æº è¿›è¡Œè¯»è®¿é—®ï¼Œå†™è€… åˆ™éœ€è¦å¯¹å…±äº«èµ„æº è¿›è¡Œå†™æ“ä½œï¼Œè¿™ç§é”ç›¸å¯¹äºè‡ªæ—‹é”è€Œè¨€ï¼Œèƒ½ æé«˜å¹¶å‘æ€§ ä¸€ä¸ªè¯»å†™é”åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªå†™è€…æˆ–è€…å¤šä¸ªè¯»è€…ï¼Œä½†ä¸èƒ½å³æœ‰è¯»è€…åˆæœ‰å†™è€…ï¼Œåœ¨è¯»å†™é”ä¿æŒæœŸé—´ä¹Ÿæ˜¯æŠ¢å å¤±æ•ˆçš„ å¦‚æœ è¯»å†™é”å½“å‰æ²¡æœ‰è¯»è€…ï¼Œä¹Ÿæ²¡æœ‰å†™è€…ï¼Œé‚£ä¹ˆå†™è€… å¯ä»¥ç«‹åˆ»è·å– è¯»å†™é”ï¼Œå¦åˆ™å®ƒå¿…é¡»è‡ªæ—‹ åœ¨é‚£é‡Œï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å†™è€…æˆ–è¯»è€…ï¼Œå¦‚æœè¯»å†™é”æ²¡æœ‰å†™è€…ï¼Œé‚£ä¹ˆè¯»è€…å¯ä»¥ ç«‹å³è·å–è¯»å†™é” å…¶å® åŸºæœ¬çš„é” å°±åŒ…æ‹¬ä¸‰ç±»ï¼šè‡ªæ—‹é”ã€äº’æ–¥é”ã€è¯»å†™é”ï¼Œå…¶ä»–çš„æ¯”å¦‚ æ¡ä»¶é”ã€é€’å½’é”ã€ä¿¡å·é‡ éƒ½æ˜¯ ä¸Šå±‚çš„å°è£…å’Œå®ç° OSSpinLockï¼ˆè‡ªæ—‹é”ï¼‰è‡ªä» OSSpinLock å‡ºç°å®‰å…¨é—®é¢˜ï¼Œåœ¨iOS10ä¹‹åå°±è¢«åºŸå¼ƒäº†ï¼Œè‡ªæ—‹é”ä¹‹æ‰€æœ‰ä¸å®‰å…¨ï¼Œæ˜¯å› ä¸º è·å–é”åï¼Œçº¿ç¨‹ä¼šä¸€ç›´å¤„äºå¿™ç­‰å¾…ï¼Œé€ æˆäº† ä»»åŠ¡çš„ä¼˜å…ˆçº§åè½¬ã€‚ å…¶ä¸­çš„å¿™ç­‰å¾…æœºåˆ¶å¯èƒ½ä¼šé€ æˆ é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸€ç›´runingç­‰å¾…ï¼Œå ç”¨æ—¶é—´ç‰‡ï¼Œè€Œ ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡æ— æ³•æŠ¢å æ—¶é—´ç‰‡ï¼Œä¼šé€ æˆä¸€ç›´ä¸èƒ½å®Œæˆï¼Œé”æœªé‡Šæ”¾çš„æƒ…å†µ åœ¨ OSSpinLock è¢«åºŸå¼ƒåï¼Œå…¶æ›¿ä»£æ–¹æ¡ˆæ˜¯å†…éƒ¨å°è£…äº† os_unfair_lockï¼Œè€Œ os_unfair_lock åœ¨åŠ é”æ—¶ä¼šå¤„äº ä¼‘çœ çŠ¶æ€ï¼Œè€Œä¸æ˜¯è‡ªæ—‹é”çš„å¿™ç­‰å¾…çŠ¶æ€ atomicï¼ˆåŸå­é”ï¼‰atomic é€‚ç”¨äºOCä¸­å±æ€§çš„ä¿®é¥°ç¬¦ï¼Œå…¶ è‡ªå¸¦ä¸€æŠŠè‡ªæ—‹é”ï¼Œä½†æ˜¯è¿™ä¸ªä¸€èˆ¬åŸºæœ¬ä¸ä½¿ç”¨ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ nonatomic åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåŠ setter æ–¹æ³•ä¼šæ ¹æ®ä¿®é¥°ç¬¦è°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå…¶ä¸­æœ€åä¼šç»Ÿä¸€è°ƒç”¨ reallySetProperty æ–¹æ³•ï¼Œå…¶ä¸­å°±æœ‰ atomic å’Œ éatomic çš„æ“ä½œ 123456789101112131415161718static inline void reallySetProperty(id self, SEL _cmd, id newValue, ptrdiff_t offset, bool atomic, bool copy, bool mutableCopy)&#123; ... id *slot = (id*) ((char*)self + offset); ... if (!atomic) &#123; // æœªåŠ é” oldValue = *slot; *slot = newValue; &#125; else &#123; // åŠ é” spinlock_t&amp; slotlock = PropertyLocks[slot]; slotlock.lock(); oldValue = *slot; *slot = newValue; slotlock.unlock(); &#125; ...&#125; ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹äº atomic ä¿®é¥°çš„å±æ€§ï¼Œè¿›è¡Œäº† spinlock_t åŠ é”å¤„ç†ï¼Œä½†æ˜¯åœ¨å‰æ–‡ä¸­æåˆ° OSSpinLock å·²ç»åºŸå¼ƒäº†ï¼Œè¿™é‡Œçš„ spinlock_t åœ¨åº•å±‚æ˜¯é€šè¿‡ os_unfair_lock æ›¿ä»£äº† OSSpinLock å®ç°çš„åŠ é”ã€‚åŒæ—¶ä¸ºäº† é˜²æ­¢å“ˆå¸Œå†²çªï¼Œè¿˜æ˜¯ç”¨äº† åŠ ç› æ“ä½œ 123456using spinlock_t = mutex_tt&lt;LOCKDEBUG&gt;;class mutex_tt : nocopy_t &#123; os_unfair_lock mLock; ...&#125; getter æ–¹æ³•ä¸­å¯¹ atomic çš„å¤„ç†ï¼ŒåŒ setter æ˜¯å¤§è‡´ç›¸åŒçš„ 123456789101112131415161718id objc_getProperty(id self, SEL _cmd, ptrdiff_t offset, BOOL atomic) &#123; if (offset == 0) &#123; return object_getClass(self); &#125; // Retain release world id *slot = (id*) ((char*)self + offset); if (!atomic) return *slot; // Atomic retain release world spinlock_t&amp; slotlock = PropertyLocks[slot]; slotlock.lock(); // åŠ é” id value = objc_retain(*slot); slotlock.unlock(); // è§£é” // for performance, we (safely) issue the autorelease OUTSIDE of the spinlock. return objc_autoreleaseReturnValue(value);&#125; synchronized(äº’æ–¥é€’å½’é”) å¼€å¯æ±‡ç¼–æ¨¡å¼ï¼Œå‘ç° @synchronized åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šèµ°åº•å±‚çš„ objc_sync_enter å’Œ objc_sync_exit æ–¹æ³• ä¹Ÿå¯ä»¥é€šè¿‡ clangï¼ŒæŸ¥çœ‹åº•å±‚ç¼–è¯‘ä»£ç  é€šè¿‡å¯¹ objc_sync_enter æ–¹æ³•ç¬¦å·æ–­ç‚¹ï¼ŒæŸ¥çœ‹åº•å±‚æ‰€åœ¨çš„æºç åº“ï¼Œé€šè¿‡æ–­ç‚¹å‘ç°åœ¨objcæºç ä¸­ï¼Œå³ libpbjc.A.dylib objc_sync_enter &amp; objc_sync_exit åˆ†æ è¿›å…¥ objc_sync_enter æºç å®ç° å¦‚æœobjå­˜åœ¨ï¼Œåˆ™é€šè¿‡ id2data æ–¹æ³•è·å–å“åº”çš„ SyncDataï¼Œå¯¹ threadCountã€lockCount è¿›è¡Œ é€’å¢ æ“ä½œ å¦‚æœobjä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ objc_sync_nilï¼Œé€šè¿‡ç¬¦å·æ–­ç‚¹å¾—çŸ¥ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢ä»€ä¹ˆéƒ½æ²¡åšï¼Œç›´æ¥returnäº† 123456789101112131415161718int objc_sync_enter(id obj)&#123; int result = OBJC_SYNC_SUCCESS; if (obj) &#123; // ä¼ å…¥ä¸ä¸ºnil SyncData* data = id2data(obj, ACQUIRE); // é‡ç‚¹ ASSERT(data); data-&gt;mutex.lock(); // åŠ é” &#125; else &#123; // ä¼ å…¥nil // @synchronized(nil) does nothing if (DebugNilSync) &#123; _objc_inform(&quot;NIL SYNC DEBUG: @synchronized(nil); set a breakpoint on objc_sync_nil to debug&quot;); &#125; objc_sync_nil(); &#125; return result;&#125; è¿›å…¥ objc_sync_exit æºç å®ç° å¦‚æœobjå­˜åœ¨ï¼Œåˆ™è°ƒç”¨ id2data æ–¹æ³•è·å–å¯¹åº”çš„SyncDataï¼Œå¯¹ threadCountã€lockCount è¿›è¡Œ é€’å‡ æ“ä½œ å¦‚æœobjä¸å­˜åœ¨ï¼Œä»€ä¹ˆä¹Ÿä¸åš 123456789101112131415161718192021// End synchronizing on &#x27;obj&#x27;. ç»“æŸå¯¹â€œ objâ€çš„åŒæ­¥// Returns OBJC_SYNC_SUCCESS or OBJC_SYNC_NOT_OWNING_THREAD_ERRORint objc_sync_exit(id obj)&#123; int result = OBJC_SYNC_SUCCESS; if (obj) &#123;//objä¸ä¸ºnil SyncData* data = id2data(obj, RELEASE); if (!data) &#123; result = OBJC_SYNC_NOT_OWNING_THREAD_ERROR; &#125; else &#123; bool okay = data-&gt;mutex.tryUnlock();//è§£é” if (!okay) &#123; result = OBJC_SYNC_NOT_OWNING_THREAD_ERROR; &#125; &#125; &#125; else &#123;//objä¸ºnilæ—¶ï¼Œä»€ä¹ˆä¹Ÿä¸åš // @synchronized(nil) does nothing &#125; return result;&#125; é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå®ç°é€»è¾‘çš„å¯¹æ¯”ï¼Œå‘ç°å®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œåœ¨objå­˜åœ¨æ—¶ï¼Œéƒ½ä¼šé€šè¿‡ id2data æ–¹æ³•ï¼Œè·å– SyncData è¿›å…¥ SyncData çš„å®šä¹‰ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸»è¦ç”¨æ¥è¡¨ç¤ºä¸€ä¸ª çº¿ç¨‹dataï¼Œç±»ä¼¼äº é“¾è¡¨ç»“æ„ï¼Œæœ‰nextæŒ‡å‘ï¼Œä¸”å°è£…äº† recursive_mutex_t å±æ€§ï¼Œå¯ä»¥ç¡®è®¤ @synchronized ç¡®å®æ˜¯ä¸€ä¸ª é€’å½’äº’æ–¥é” 123456typedef struct alignas(CacheLineSize) SyncData &#123; struct SyncData* nextData; DisguisedPtr&lt;objc_object&gt; object; // ç±»ä¼¼é“¾è¡¨ç»“æ„ int32_t threadCount; // number of THREADS using this block recursive_mutex_t mutex; // é€’å½’é”&#125; SyncData; è¿›å…¥ SyncCache çš„å®šä¹‰ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨çº¿ç¨‹ï¼Œå…¶ä¸­ list[0] è¡¨ç¤º å½“å‰çº¿ç¨‹çš„é“¾è¡¨dataï¼Œä¸»è¦ç”¨äºå­˜å‚¨ SyncData å’Œ lockCount 12345678910typedef struct &#123; SyncData *data; unsigned int lockCount; // number of times THIS THREAD locked this block&#125; SyncCacheItem;typedef struct SyncCache &#123; unsigned int allocated; unsigned int used; SyncCacheItem list[0];&#125; SyncCache; id2data åˆ†æ è¿›å…¥ id2data æºç ï¼Œä»ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ åŠ é”å’Œè§£é” éƒ½å¤ç”¨çš„æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170static SyncData* id2data(id object, enum usage why)&#123; spinlock_t *lockp = &amp;LOCK_FOR_OBJ(object); SyncData **listp = &amp;LIST_FOR_OBJ(object); SyncData* result = NULL;#if SUPPORT_DIRECT_THREAD_KEYS //tlsï¼ˆThread Local Storageï¼Œæœ¬åœ°å±€éƒ¨çš„çº¿ç¨‹ç¼“å­˜ï¼‰ // Check per-thread single-entry fast cache for matching object bool fastCacheOccupied = NO; //é€šè¿‡KVCæ–¹å¼å¯¹çº¿ç¨‹è¿›è¡Œè·å– çº¿ç¨‹ç»‘å®šçš„data SyncData *data = (SyncData *)tls_get_direct(SYNC_DATA_DIRECT_KEY); //å¦‚æœçº¿ç¨‹ç¼“å­˜ä¸­æœ‰dataï¼Œæ‰§è¡Œifæµç¨‹ if (data) &#123; fastCacheOccupied = YES; //å¦‚æœåœ¨çº¿ç¨‹ç©ºé—´æ‰¾åˆ°äº†data if (data-&gt;object == object) &#123; // Found a match in fast cache. uintptr_t lockCount; result = data; //é€šè¿‡KVCè·å–lockCountï¼ŒlockCountç”¨æ¥è®°å½• è¢«é”äº†å‡ æ¬¡ï¼Œå³ è¯¥é”å¯åµŒå¥— lockCount = (uintptr_t)tls_get_direct(SYNC_COUNT_DIRECT_KEY); if (result-&gt;threadCount &lt;= 0 || lockCount &lt;= 0) &#123; _objc_fatal(&quot;id2data fastcache is buggy&quot;); &#125; switch(why) &#123; case ACQUIRE: &#123; //objc_sync_enterèµ°è¿™é‡Œï¼Œä¼ å…¥çš„æ˜¯ACQUIRE -- è·å– lockCount++;//é€šè¿‡lockCountåˆ¤æ–­è¢«é”äº†å‡ æ¬¡ï¼Œå³è¡¨ç¤º å¯é‡å…¥ï¼ˆé€’å½’é”å¦‚æœå¯é‡å…¥ï¼Œä¼šæ­»é”ï¼‰ tls_set_direct(SYNC_COUNT_DIRECT_KEY, (void*)lockCount);//è®¾ç½® break; &#125; case RELEASE: //objc_sync_exitèµ°è¿™é‡Œï¼Œä¼ å…¥çš„whyæ˜¯RELEASE -- é‡Šæ”¾ lockCount--; tls_set_direct(SYNC_COUNT_DIRECT_KEY, (void*)lockCount); if (lockCount == 0) &#123; // remove from fast cache tls_set_direct(SYNC_DATA_DIRECT_KEY, NULL); // atomic because may collide with concurrent ACQUIRE OSAtomicDecrement32Barrier(&amp;result-&gt;threadCount); &#125; break; case CHECK: // do nothing break; &#125; return result; &#125; &#125;#endif // Check per-thread cache of already-owned locks for matching object SyncCache *cache = fetch_cache(NO);//åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦æœ‰è¯¥çº¿ç¨‹ //å¦‚æœcacheä¸­æœ‰ï¼Œæ–¹å¼ä¸çº¿ç¨‹ç¼“å­˜ä¸€è‡´ if (cache) &#123; unsigned int i; for (i = 0; i &lt; cache-&gt;used; i++) &#123;//éå†æ€»è¡¨ SyncCacheItem *item = &amp;cache-&gt;list[i]; if (item-&gt;data-&gt;object != object) continue; // Found a match. result = item-&gt;data; if (result-&gt;threadCount &lt;= 0 || item-&gt;lockCount &lt;= 0) &#123; _objc_fatal(&quot;id2data cache is buggy&quot;); &#125; switch(why) &#123; case ACQUIRE://åŠ é” item-&gt;lockCount++; break; case RELEASE://è§£é” item-&gt;lockCount--; if (item-&gt;lockCount == 0) &#123; // remove from per-thread cache ä»cacheä¸­æ¸…é™¤ä½¿ç”¨æ ‡è®° cache-&gt;list[i] = cache-&gt;list[--cache-&gt;used]; // atomic because may collide with concurrent ACQUIRE OSAtomicDecrement32Barrier(&amp;result-&gt;threadCount); &#125; break; case CHECK: // do nothing break; &#125; return result; &#125; &#125; // Thread cache didn&#x27;t find anything. // Walk in-use list looking for matching object // Spinlock prevents multiple threads from creating multiple // locks for the same new object. // We could keep the nodes in some hash table if we find that there are // more than 20 or so distinct locks active, but we don&#x27;t do that now. //ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œæ‰€æœ‰ç¼“å­˜éƒ½æ‰¾ä¸åˆ° lockp-&gt;lock(); &#123; SyncData* p; SyncData* firstUnused = NULL; for (p = *listp; p != NULL; p = p-&gt;nextData) &#123;//cacheä¸­å·²ç»æ‰¾åˆ° if ( p-&gt;object == object ) &#123;//å¦‚æœä¸ç­‰äºç©ºï¼Œä¸”ä¸objectç›¸ä¼¼ result = p;//èµ‹å€¼ // atomic because may collide with concurrent RELEASE OSAtomicIncrement32Barrier(&amp;result-&gt;threadCount);//å¯¹threadCountè¿›è¡Œ++ goto done; &#125; if ( (firstUnused == NULL) &amp;&amp; (p-&gt;threadCount == 0) ) firstUnused = p; &#125; // no SyncData currently associated with object æ²¡æœ‰ä¸å½“å‰å¯¹è±¡å…³è”çš„SyncData if ( (why == RELEASE) || (why == CHECK) ) goto done; // an unused one was found, use it ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œæ²¡æœ‰æ‰¾åˆ° if ( firstUnused != NULL ) &#123; result = firstUnused; result-&gt;object = (objc_object *)object; result-&gt;threadCount = 1; goto done; &#125; &#125; // Allocate a new SyncData and add to list. // XXX allocating memory with a global lock held is bad practice, // might be worth releasing the lock, allocating, and searching again. // But since we never free these guys we won&#x27;t be stuck in allocation very often. posix_memalign((void **)&amp;result, alignof(SyncData), sizeof(SyncData));//åˆ›å»ºèµ‹å€¼ result-&gt;object = (objc_object *)object; result-&gt;threadCount = 1; new (&amp;result-&gt;mutex) recursive_mutex_t(fork_unsafe_lock); result-&gt;nextData = *listp; *listp = result; done: lockp-&gt;unlock(); if (result) &#123; // Only new ACQUIRE should get here. // All RELEASE and CHECK and recursive ACQUIRE are // handled by the per-thread caches above. if (why == RELEASE) &#123; // Probably some thread is incorrectly exiting // while the object is held by another thread. return nil; &#125; if (why != ACQUIRE) _objc_fatal(&quot;id2data is buggy&quot;); if (result-&gt;object != object) _objc_fatal(&quot;id2data is buggy&quot;);#if SUPPORT_DIRECT_THREAD_KEYS if (!fastCacheOccupied) &#123; //åˆ¤æ–­æ˜¯å¦æ”¯æŒæ ˆå­˜ç¼“å­˜ï¼Œæ”¯æŒåˆ™é€šè¿‡KVCå½¢å¼èµ‹å€¼ å­˜å…¥tls // Save in fast thread cache tls_set_direct(SYNC_DATA_DIRECT_KEY, result); tls_set_direct(SYNC_COUNT_DIRECT_KEY, (void*)1);//lockCount = 1 &#125; else #endif &#123; // Save in thread cache ç¼“å­˜ä¸­å­˜ä¸€ä»½ if (!cache) cache = fetch_cache(YES);//ç¬¬ä¸€æ¬¡å­˜å‚¨æ—¶ï¼Œå¯¹çº¿ç¨‹è¿›è¡Œäº†ç»‘å®š cache-&gt;list[cache-&gt;used].data = result; cache-&gt;list[cache-&gt;used].lockCount = 1; cache-&gt;used++; &#125; &#125; return result;&#125; ã€ç¬¬ä¸€æ­¥ã€‘é¦–é¡µåœ¨ tls å³ çº¿ç¨‹ç¼“å­˜ ä¸­æŸ¥æ‰¾ åœ¨ tls_get_direct æ–¹æ³•ä¸­ä»¥ çº¿ç¨‹ä¸ºkeyï¼Œé€šè¿‡ KVC çš„æ–¹å¼è·å–ä¸ä¹‹ç»‘å®šçš„ SyncDataï¼Œå³çº¿ç¨‹ dataï¼Œå…¶ä¸­çš„ tls()ï¼Œè¡¨ç¤º æœ¬åœ°å±€éƒ¨çš„çº¿ç¨‹ç¼“å­˜ åˆ¤æ–­è·å–çš„dataæ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠåˆ¤æ–­dataä¸­æ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„objct å¦‚æœéƒ½æ‰¾åˆ°äº†ï¼Œåœ¨ tls_get_direct æ–¹æ³•ä¸­ä»¥KVCçš„æ–¹å¼è·å– lockcountï¼Œç”¨æ¥è®°å½• å¯¹è±¡è¢«é”äº†å‡ æ¬¡ï¼ˆå³é”çš„åµŒå¥—æ¬¡æ•°ï¼‰ å¦‚æœdataä¸­çš„ threadCount å°äºç­‰äº0ï¼Œæˆ–è€… lockCount å°äºç­‰äº0æ—¶ï¼Œåˆ™ç›´æ¥å´©æºƒ é€šè¿‡ä¼ å…¥çš„ whyï¼Œåˆ¤æ–­æ“ä½œç±»å‹ å¦‚æœæ˜¯ ACQUIREï¼Œè¡¨ç¤ºåŠ é”ï¼Œåˆ™è¿›è¡ŒlockCount++ï¼Œå¹¶ä¿å­˜åˆ°tlsç¼“å­˜ å¦‚æœæ˜¯ RELEASEï¼Œè¡¨ç¤ºé‡Šæ”¾ï¼Œåˆ™è¿›è¡ŒlockCount++ï¼Œå¹¶ä¿å­˜åˆ°tlsç¼“å­˜ï¼Œå¦‚æœ lockCount ç­‰äº 0ï¼Œä»tlsä¸­ ç§»é™¤ çº¿ç¨‹data å¦‚æœæ˜¯ CHECKï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸åš ã€ç¬¬äºŒæ­¥ã€‘å¦‚æœ tls ä¸­æ²¡æœ‰ï¼Œåˆ™åœ¨ cacheç¼“å­˜ ä¸­æŸ¥æ‰¾ é€šè¿‡ fetch_cache æ–¹æ³•æŸ¥æ‰¾cacheç¼“å­˜ä¸­æ˜¯å¦æœ‰çº¿ç¨‹ å¦‚æœæœ‰ï¼Œåˆ™éå†cacheæ€»è¡¨ï¼Œè¯»å–å‡ºçº¿ç¨‹å¯¹åº”çš„ SyncCacheItem ä» SyncCacheItem ä¸­å–å‡º dataï¼Œç„¶ååç»­æ­¥éª¤ä¸tlsçš„åŒ¹é…æ˜¯ä¸€è‡´çš„ ã€ç¬¬ä¸‰æ­¥ã€‘å¦‚æœcacheä¸­ä¹Ÿæ²¡æœ‰ï¼Œå³ ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œåˆ™åˆ›å»º SyncDataï¼Œå¹¶å­˜å‚¨åˆ°ç›¸åº”ç¼“å­˜ä¸­ å¦‚æœåœ¨cacheä¸­æ‰¾åˆ°çº¿ç¨‹ï¼Œä¸”ä¸objectç›¸ç­‰ï¼Œåˆ™è¿›è¡Œ èµ‹å€¼ã€ä»¥åŠ threadCount++ å¦‚æœåœ¨cacheä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ threadCount ç­‰äº 1. æ‰€ä»¥åœ¨ id2data æ–¹æ³•ä¸­ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç§æƒ…å†µ ã€ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œæ²¡æœ‰é”ã€‘ threadCount &#x3D; 1 lockCount &#x3D; 1 å­˜å‚¨åˆ° tls ã€ä¸æ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œä¸”æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‘ tlsä¸­æœ‰æ•°æ®ï¼Œåˆ™ lockCount++ å­˜å‚¨åˆ° tls ã€ä¸æ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œä¸”æ˜¯ä¸åŒçº¿ç¨‹ã€‘ å…¨å±€çº¿ç¨‹ç©ºé—´ è¿›è¡ŒæŸ¥æ‰¾çº¿ç¨‹ threadCount++ lockCount++ å­˜å‚¨åˆ° cache tlså’Œcacheè¡¨ç»“æ„ é’ˆå¯¹tlså’Œcacheç¼“å­˜ï¼Œåº•å±‚çš„è¡¨ç»“æ„å¦‚ä¸‹æ‰€ç¤º å“ˆå¸Œè¡¨ ç»“æ„ä¸­é€šè¿‡ SyncList ç»“æ„æ¥ç»„è£… å¤šçº¿ç¨‹ çš„æƒ…å†µ SyncData é€šè¿‡ é“¾è¡¨ çš„å½¢å¼ç»„è£… å½“å‰å¯é‡å…¥ çš„æƒ…å†µ ä¸‹å±‚é€šè¿‡ tlsçº¿ç¨‹ç¼“å­˜ã€cacheç¼“å­˜ æ¥è¿›è¡Œ å¤„ç† åº•å±‚ä¸»è¦æœ‰ä¸¤ä¸ªä¸œè¥¿ï¼šlockCountã€threadCountï¼Œè§£å†³äº†é€’å½’äº’æ–¥é”ï¼Œè§£å†³äº†åµŒå¥—å¯é‡å…¥ @synchronized å‘ç‚¹ä¸‹é¢ä»£ç è¿™æ ·å†™ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ 12345678910 - (void)zj_testSync&#123; _testArray = [NSMutableArray array]; for (int i = 0; i &lt; 200000; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; @synchronized (self.testArray) &#123; self.testArray = [NSMutableArray array]; &#125; &#125;); &#125;&#125; è¿è¡Œç»“æœå‘ç°ï¼Œè¿è¡Œå°±å´©æºƒ å´©æºƒçš„ä¸»è¦åŸå› æ˜¯ testArray åœ¨æŸä¸€ç¬é—´å˜æˆäº†nilï¼Œä»@synchronizedåº•å±‚æµç¨‹å¯çŸ¥ï¼Œå¦‚æœ åŠ é”çš„å¯¹è±¡æˆäº†nilï¼Œæ˜¯é”ä¸ä½çš„ï¼Œç›¸å½“äºä¸‹é¢è¿™ç§æƒ…å†µï¼Œblockå†…éƒ¨ä¸åœçš„retainã€releaseï¼Œä¼šåœ¨æŸä¸€ç¬é—´ ä¸Šä¸€ä¸ªæœªreleaseï¼Œä¸‹ä¸€ä¸ªå·²ç»å‡†å¤‡releaseï¼Œè¿™æ ·ä¼šå¯¼è‡´ é‡æŒ‡é’ˆ çš„äº§ç”Ÿ 12345678- (void)zj_crash&#123; _testArray = [NSMutableArray array]; for (int i = 0; i &lt; 200000; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; _testArray = [NSMutableArray array]; &#125;); &#125;&#125; å¯ä»¥æ ¹æ®ä¸Šé¢çš„ä»£ç ï¼Œæ‰“å¼€ edit scheme -&gt; run -&gt; Diagnostics ä¸­å‹¾é€‰ Zombie Objectsï¼Œæ¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨åƒµå°¸å¯¹è±¡ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤º æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ @synchronized(self)ï¼Œä¸»è¦æ˜¯å› ä¸º _testArray çš„æŒæœ‰è€…æ˜¯ self æ³¨æ„ï¼šé‡æŒ‡é’ˆ vs è¿‡åº¦é‡Šæ”¾ é‡æŒ‡é’ˆï¼šæ˜¯æŒ‡ç”±äºè¿‡åº¦é‡Šæ”¾äº§ç”Ÿçš„æŒ‡é’ˆè¿˜åœ¨è¿›è¡Œæ“ä½œ è¿‡åº¦é‡Šæ”¾ï¼šæ¯æ¬¡éƒ½ä¼š retain å’Œ release æ€»ç»“ @synchronized åœ¨åº•å±‚å°è£…çš„æ˜¯ä¸€æŠŠ é€’å½’é”ï¼Œæ‰€ä»¥è¿™ä¸ªé”æ˜¯ é€’å½’äº’æ–¥é” @synchronized çš„å¯é‡å…¥ï¼Œå³å¯ åµŒå¥—ï¼Œä¸»è¦æ˜¯ç”±äº lockCount å’Œ threadCount çš„æ­é… @synchronized ä½¿ç”¨ é“¾è¡¨ çš„åŸå› æ˜¯ é“¾è¡¨æ–¹ä¾¿ä¸‹ä¸€ä¸ªdataçš„æ’å…¥ ä½†æ˜¯ç”±äºåº•å±‚ä¸­ é“¾è¡¨æŸ¥è¯¢ã€ç¼“å­˜çš„æŸ¥æ‰¾ä»¥åŠé€’å½’ï¼Œæ˜¯éå¸¸ è€—å†…å­˜ ä»¥åŠ æ€§èƒ½ çš„ï¼Œå¯¼è‡´ æ€§èƒ½ä½ï¼Œæ‰€ä»¥åœ¨å‰æ–‡ä¸­ï¼Œè¯¥é”çš„æ’ååœ¨æœ€å ä¸èƒ½ä½¿ç”¨ éOCå¯¹è±¡ ä½œä¸ºåŠ é”å¯¹è±¡ï¼Œå› ä¸ºå…¶ object çš„å‚æ•°ä¸º id @synchronized(self) è¿™ç§é€‚ç”¨äº åµŒå¥—æ¬¡æ•°è¾ƒå°‘ çš„åœºæ™¯ã€‚è¿™é‡Œé”ä½çš„å¯¹è±¡ä¹Ÿ å¹¶ä¸æ°¸è¿œæ˜¯selfï¼Œè¿™é‡Œéœ€è¦è¯»è€…æ³¨æ„ å¦‚æœé”åµŒå¥—æ¬¡æ•°è¾ƒå¤šï¼Œå³ é”selfè¿‡å¤šï¼Œä¼šå¯¼è‡´åº•å±‚çš„æŸ¥æ‰¾éå¸¸éº»çƒ¦ï¼Œå› ä¸ºå…¶åº•å±‚æ˜¯é“¾è¡¨è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰€ä»¥ä¼šç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥ä½¿ç”¨ NSLockã€ä¿¡å·é‡ ç­‰ NSLockNSLock æ˜¯å¯¹ ä¸‹å±‚phread_mutex çš„å°è£…ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š 123NSLock *lock = [[NSLock alloc] init];[lock lock];[lock unlock]; ç›´æ¥è¿›å…¥ NSLock å®šä¹‰æŸ¥çœ‹ï¼Œå…¶éµå¾ªäº† NSLocking åè®®ï¼Œä¸‹é¢æ¥æ¢ç´¢ NSLock çš„åº•å±‚å®ç° NSLockåº•å±‚åˆ†æ é€šè¿‡åŠ ç¬¦å·æ–­ç‚¹ lock åˆ†æï¼Œå‘ç°å…¶æºç åœ¨ Foundation æ¡†æ¶ä¸­ ç”±äºOCçš„ Foundation æ¡†æ¶ä¸å¼€æºï¼Œæ‰€ä»¥è¿™é‡Œå€ŸåŠ© Swift çš„å¼€æºæ¡†æ¶ Foundation æ¥åˆ†æ NSLock çš„åº•å±‚å®ç°ï¼Œå…¶åŸç†ä¸OCæ˜¯å¤§è‡´ç›¸åŒçš„ é€šè¿‡æºç å®ç°å¯ä»¥çœ‹å‡ºï¼Œåº•å±‚æ˜¯é€šè¿‡ pthread_mutex äº’æ–¥é”å®ç°çš„ï¼Œå¹¶ä¸”åœ¨initæ–¹æ³•ä¸­ï¼Œè¿˜åšäº†ä¸€äº›å…¶ä»–æ“ä½œï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨NSLockæ—¶éœ€è¦ä½¿ç”¨initåˆå§‹åŒ– å›åˆ°å‰æ–‡çš„æ€§èƒ½å›¾ä¸­ï¼Œå¯ä»¥çœ‹å‡º NSLock çš„æ€§èƒ½ä»…æ¬¡äº pthread_mutexï¼ˆäº’æ–¥é”ï¼‰ï¼Œéå¸¸æ¥è¿‘ ä½¿ç”¨å¼Šç«¯è¯·é—®ä¸‹é¢blockåµŒå¥—blockçš„ä»£ç ä¸­ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ 123456789101112for (int i= 0; i&lt;100; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; static void (^testMethod)(int); testMethod = ^(int value)&#123; if (value &gt; 0) &#123; NSLog(@&quot;current value = %d&quot;,value); testMethod(value - 1); &#125; &#125;; testMethod(10); &#125;);&#125; åœ¨æœªåŠ é”ä¹‹å‰ï¼Œå…¶ä¸­currentæ‰“å°çš„ç»“æœæ•°æ®æ··ä¹±ï¼Œä¸»è¦åŸå› æ˜¯å¤šçº¿ç¨‹å¯¼è‡´çš„ å¦‚æœåƒä¸‹é¢è¿™æ ·åŠ é”ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ 123456789101112131415NSLock * lock = [[NSLock alloc] init];for (int i= 0; i&lt;100; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; static void (^testMethod)(int); testMethod = ^(int value)&#123; [lock lock]; if (value &gt; 0) &#123; NSLog(@&quot;current value = %d&quot;,value); testMethod(value - 1); &#125; &#125;; testMethod(10); [lock unlock]; &#125;);&#125; ä¼šå‡ºç°ä¸€ç›´ç­‰å¾…çš„æƒ…å†µï¼Œä¸»è¦æ˜¯å› ä¸º åµŒå¥—ä½¿ç”¨çš„é€’å½’ï¼Œä½¿ç”¨ NSLockï¼ˆç®€å•çš„äº’æ–¥é”ï¼Œå¦‚æœæ²¡æœ‰å›æ¥ï¼Œä¼šä¸€ç›´ç¡è§‰ç­‰å¾…ï¼‰ï¼Œå³ä¼šå­˜åœ¨ä¸€ç›´åŠ lockï¼Œç­‰ä¸åˆ°unlockçš„å µå¡æƒ…å†µ æ‰€ä»¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è§£å†³ ä½¿ç”¨ NSLock 12345678910111213141516NSLock * lock = [[NSLock alloc] init];for (int i= 0; i&lt;100; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; static void (^testMethod)(int); [lock lock]; testMethod = ^(int value)&#123; if (value &gt; 0) &#123; NSLog(@&quot;current value = %d&quot;,value); testMethod(value - 1); &#125;else &#123; [lock unlock]; &#125; &#125;; testMethod(10); &#125;);&#125; ä½¿ç”¨ @synchronized 1234567891011121314for (int i= 0; i&lt;100; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; static void (^testMethod)(int); testMethod = ^(int value)&#123; @synchronized (self) &#123; if (value &gt; 0) &#123; NSLog(@&quot;current value = %d&quot;,value); testMethod(value - 1); &#125; &#125; &#125;; testMethod(10); &#125;);&#125; ä½¿ç”¨é€’å½’é” NSRecursiveLock 123456789101112131415NSRecursiveLock * lock = [[NSRecursiveLock alloc] init];for (int i= 0; i&lt;100; i++) &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; static void (^testMethod)(int); [lock lock]; // åŠ é” testMethod = ^(int value)&#123; if (value &gt; 0) &#123; NSLog(@&quot;current value = %d&quot;,value); testMethod(value - 1); &#125; [lock unlock]; &#125;; testMethod(10); &#125;);&#125; pthread_mutexpthread_mutex å°±æ˜¯ äº’æ–¥é”æœ¬èº«ï¼Œå½“é”è¢«å ç”¨ï¼Œå…¶ä»–çº¿ç¨‹ç”³è¯·é”æ—¶ï¼Œä¸ä¼šä¸€ç›´å¿™ç­‰å¾…ï¼Œè€Œæ˜¯ é˜»å¡çº¿ç¨‹å¹¶ç¡çœ  ä½¿ç”¨ 123456789101112131415161718# å¯¼å…¥å¤´æ–‡ä»¶#import &lt;tphread.j&gt;// å…¨å±€å£°æ˜äº’æ–¥é”phread_mutex_t _lock;// åˆå§‹åŒ–äº’æ–¥é”pthread_mutex_init(&amp;_lock, NULL);// åŠ é”pthread_mutex_lock(&amp;_lock);// è¿™é‡Œéœ€è¦çº¿ç¨‹å®‰å…¨æ“ä½œ// è§£é”pthread_mutex_unlock(&amp;_lock);// é‡Šæ”¾é”pthread_mutex_destroy(&amp;_lock); NSRecursiveLockNSRecursiveLock åœ¨åº•å±‚ä¹Ÿæ˜¯å¯¹ pthread_mutex çš„å°è£…ï¼Œå¯ä»¥é€šè¿‡ swift çš„ Foundation æºç æŸ¥çœ‹ å¯¹æ¯” NSLock å’Œ NSRecursiveLockï¼Œå…¶åº•å±‚å®ç°å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼ŒåŒºåˆ«åœ¨äºinitæ—¶ï¼ŒNSRecursiveLock æœ‰ä¸€ä¸ªæ ‡è¯† PTHREAD_MUTEX_RECURSIVE ï¼Œè€Œ NSLock æ˜¯é»˜è®¤çš„ é€’å½’é” ä¸»è¦æ˜¯ç”¨äº è§£å†³ä¸€äº›åµŒå¥—å½¢å¼ï¼Œå…¶ä¸­å¾ªç¯åµŒå¥—å±…å¤š NSConditionNSCondition æ˜¯ä¸€ä¸ª æ¡ä»¶é”ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨è¾ƒå°‘ï¼Œä¸ä¿¡å·é‡æœ‰ç‚¹ç›¸ä¼¼ï¼šçº¿ç¨‹1 éœ€è¦æ»¡è¶³æ¡ä»¶æ‰ä¼šå¾€ä¸‹èµ°ï¼Œå¦åˆ™ä¼šå µå¡ç­‰å¾…ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³ï¼Œç»å…¸æ¨¡å‹æ˜¯ ç”Ÿäº§æ¶ˆè´¹è€…æ¨¡å‹ NSConditionçš„å¯¹è±¡ å®é™…ä¸Šä½œä¸ºä¸€ä¸ª é” å’Œä¸€ä¸ª çº¿ç¨‹æ£€æŸ¥å™¨ é” ä¸»è¦ä¸ºäº† å½“æ£€æµ‹æ¡ä»¶æ—¶ä¿æŠ¤æ•°æ®æºï¼Œæ‰§è¡Œæ¡ä»¶å¼•å‘çš„ä»»åŠ¡ çº¿ç¨‹æ£€æŸ¥å™¨ ä¸»è¦æ˜¯ æ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦ç»§ç»­è¿è¡Œçº¿ç¨‹ï¼Œå³çº¿ç¨‹æ˜¯å¦è¢« é˜»å¡ ä½¿ç”¨ 1234567891011121314// åˆå§‹åŒ–NSCondition *condition = [[NSCondition alloc] init]// ä¸€èˆ¬ç”¨äºå¤šçº¿ç¨‹åŒæ—¶è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®æºï¼Œä¿è¯åœ¨åŒä¸€ æ—¶é—´å†…æ•°æ®æºåªè¢«è®¿é—®ã€ä¿®æ”¹ä¸€æ¬¡ï¼Œå…¶ä»–çº¿ç¨‹çš„å‘½ä»¤éœ€è¦åœ¨lock å¤–ç­‰å¾…ï¼Œåªåˆ° unlock ï¼Œæ‰å¯è®¿é—®[condition lock];// ä¸lock åŒæ—¶ä½¿ç”¨[condition unlock];// è®©å½“å‰çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€[condition wait];// CPUå‘ä¿¡å·å‘Šè¯‰çº¿ç¨‹ä¸ç”¨åœ¨ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œ[condition signal]; åº•å±‚åˆ†æé€šè¿‡swiftçš„Foundationæºç æŸ¥çœ‹ NSCondition çš„åº•å±‚å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748open class NSCondition: NSObject, NSLocking &#123; internal var mutex = _MutexPointer.allocate(capacity: 1) internal var cond = _ConditionVariablePointer.allocate(capacity: 1) //åˆå§‹åŒ– public override init() &#123; pthread_mutex_init(mutex, nil) pthread_cond_init(cond, nil) &#125; //ææ„ deinit &#123; pthread_mutex_destroy(mutex) pthread_cond_destroy(cond) mutex.deinitialize(count: 1) cond.deinitialize(count: 1) mutex.deallocate() cond.deallocate() &#125; //åŠ é” open func lock() &#123; pthread_mutex_lock(mutex) &#125; //è§£é” open func unlock() &#123; pthread_mutex_unlock(mutex) &#125; //ç­‰å¾… open func wait() &#123; pthread_cond_wait(cond, mutex) &#125; //ç­‰å¾… open func wait(until limit: Date) -&gt; Bool &#123; guard var timeout = timeSpecFrom(date: limit) else &#123; return false &#125; return pthread_cond_timedwait(cond, mutex, &amp;timeout) == 0 &#125; //ä¿¡å·ï¼Œè¡¨ç¤ºç­‰å¾…çš„å¯ä»¥æ‰§è¡Œäº† open func signal() &#123; pthread_cond_signal(cond) &#125; //å¹¿æ’­ open func broadcast() &#123; // æ±‡ç¼–åˆ†æ - çŒœ (å¤šçœ‹å¤šç©) pthread_cond_broadcast(cond) // wait signal &#125; open var name: String?&#125; å…¶åº•å±‚ä¹Ÿæ˜¯å¯¹ä¸‹å±‚ pthread_mutex çš„å°è£… NSCondition æ˜¯å¯¹ mutex å’Œ cond çš„ä¸€ç§å°è£…ï¼ˆcondå°±æ˜¯ç”¨äºè®¿é—®å’Œæ“ä½œç‰¹å®šç±»å‹æ•°æ®çš„æŒ‡é’ˆï¼‰ wait æ“ä½œä¼š é˜»å¡çº¿ç¨‹ï¼Œä½¿å…¶è¿›å…¥ ä¼‘çœ çŠ¶æ€ï¼Œç›´è‡³è¶…æ—¶ signal æ“ä½œæ˜¯ å”¤é†’ ä¸€ä¸ªæ­£åœ¨ä¼‘çœ ç­‰å¾…çš„çº¿ç¨‹ broadcast ä¼šå”¤é†’æ‰€æœ‰åœ¨ç­‰å¾…çš„çº¿ç¨‹ NSConditionLockNSConditionLock æ˜¯æ¡ä»¶é”ï¼Œä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹è·å–é”ï¼Œå…¶ä»–çº¿ç¨‹ä¸€å®šç­‰å¾… ç›¸æ¯” NSConditionLock è€Œè¨€ï¼ŒNSCondition ä½¿ç”¨æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ NSConditionLock ,å…¶ä½¿ç”¨å¦‚ä¸‹ 12345678910111213141516// åˆå§‹åŒ–NSConditionLock * conditionLock = [[NSConditionLock alloc] initWithCondition:2];// è¡¨ç¤º conditionLock æœŸå¾…è·å¾—é”ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹è·å¾—é”(ä¸éœ€è¦åˆ¤æ–­å†…éƒ¨çš„ condition) é‚£å®ƒèƒ½æ‰§è¡Œæ­¤è¡Œä»¥ä¸‹ä»£ç ï¼Œå¦‚æœå·²ç»æœ‰å…¶ä»–çº¿ç¨‹è·å¾—é”(å¯èƒ½æ˜¯æ¡ä»¶é”ï¼Œæˆ–è€…æ— æ¡ä»¶ é”)ï¼Œåˆ™ç­‰å¾…ï¼Œç›´è‡³å…¶ä»–çº¿ç¨‹è§£é”[conditionLock lock]; // è¡¨ç¤ºå¦‚æœæ²¡æœ‰å…¶ä»–çº¿ç¨‹è·å¾—è¯¥é”ï¼Œä½†æ˜¯è¯¥é”å†…éƒ¨çš„ conditionä¸ç­‰äºAæ¡ä»¶ï¼Œå®ƒä¾ç„¶ä¸èƒ½è·å¾—é”ï¼Œä»ç„¶ç­‰å¾…ã€‚å¦‚æœå†…éƒ¨çš„conditionç­‰äºAæ¡ä»¶ï¼Œå¹¶ä¸” æ²¡æœ‰å…¶ä»–çº¿ç¨‹è·å¾—è¯¥é”ï¼Œåˆ™è¿›å…¥ä»£ç åŒºï¼ŒåŒæ—¶è®¾ç½®å®ƒè·å¾—è¯¥é”ï¼Œå…¶ä»–ä»»ä½•çº¿ç¨‹éƒ½å°†ç­‰å¾…å®ƒä»£ç çš„ å®Œæˆï¼Œç›´è‡³å®ƒè§£é”ã€‚[conditionLock lockWhenCondition:Aæ¡ä»¶]; // è¡¨ç¤ºé‡Šæ”¾é”ï¼ŒåŒæ—¶æŠŠå†…éƒ¨çš„conditionè®¾ç½®ä¸ºAæ¡ä»¶[conditionLock unlockWithCondition:Aæ¡ä»¶]; // è¡¨ç¤ºå¦‚æœè¢«é”å®š(æ²¡è·å¾— é”)ï¼Œå¹¶è¶…è¿‡è¯¥æ—¶é—´åˆ™ä¸å†é˜»å¡çº¿ç¨‹ã€‚ä½†æ˜¯æ³¨æ„:è¿”å›çš„å€¼æ˜¯NO,å®ƒæ²¡æœ‰æ”¹å˜é”çš„çŠ¶æ€ï¼Œè¿™ä¸ªå‡½ æ•°çš„ç›®çš„åœ¨äºå¯ä»¥å®ç°ä¸¤ç§çŠ¶æ€ä¸‹çš„å¤„ç†return = [conditionLock lockWhenCondition:Aæ¡ä»¶ beforeDate:Aæ—¶é—´];// å…¶ä¸­æ‰€è°“çš„conditionå°±æ˜¯æ•´æ•°ï¼Œå†…éƒ¨é€šè¿‡æ•´æ•°æ¯”è¾ƒæ¡ä»¶ NSConditionLock ï¼Œå…¶æœ¬è´¨å°±æ˜¯ NSCondition + Lockï¼Œä»¥ä¸‹æ˜¯å…¶swiftçš„åº•å±‚å®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576open class NSConditionLock : NSObject, NSLocking &#123; internal var _cond = NSCondition() internal var _value: Int internal var _thread: _swift_CFThreadRef? public convenience override init() &#123; self.init(condition: 0) &#125; public init(condition: Int) &#123; _value = condition &#125; open func lock() &#123; let _ = lock(before: Date.distantFuture) &#125; open func unlock() &#123; _cond.lock() _thread = nil _cond.broadcast() _cond.unlock() &#125; open var condition: Int &#123; return _value &#125; open func lock(whenCondition condition: Int) &#123; let _ = lock(whenCondition: condition, before: Date.distantFuture) &#125; open func `try`() -&gt; Bool &#123; return lock(before: Date.distantPast) &#125; open func tryLock(whenCondition condition: Int) -&gt; Bool &#123; return lock(whenCondition: condition, before: Date.distantPast) &#125; open func unlock(withCondition condition: Int) &#123; _cond.lock() _thread = nil _value = condition _cond.broadcast() _cond.unlock() &#125; open func lock(before limit: Date) -&gt; Bool &#123; _cond.lock() while _thread != nil &#123; if !_cond.wait(until: limit) &#123; _cond.unlock() return false &#125; &#125; _thread = pthread_self() _cond.unlock() return true &#125; open func lock(whenCondition condition: Int, before limit: Date) -&gt; Bool &#123; _cond.lock() while _thread != nil || _value != condition &#123; if !_cond.wait(until: limit) &#123; _cond.unlock() return false &#125; &#125; _thread = pthread_self() _cond.unlock() return true &#125; open var name: String?&#125; é€šè¿‡æºç å¯ä»¥çœ‹å‡º NSConditionLock æ˜¯ NSCondition çš„å°è£… NSConditionLock å¯ä»¥ è®¾å€¼é”æ¡ä»¶ï¼Œå³ NSConditionå€¼ï¼Œè€Œ NSConditionåªæ˜¯ä¿¡å·çš„é€šçŸ¥ è°ƒè¯•éªŒè¯ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼Œè°ƒè¯• NSConditionLock åº•å±‚æµç¨‹ 12345678910111213141516171819202122- (void)zj_testConditonLock&#123; // ä¿¡å·é‡ NSConditionLock * conditionLock = [[NSConditionLock alloc] initWithCondition:2]; dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^&#123; [conditionLock lockWhenCondition:1]; // conditoion = 1 å†…éƒ¨ Condition åŒ¹é… NSLog(@&quot;çº¿ç¨‹ 1&quot;); [conditionLock unlockWithCondition:0]; &#125;); dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0), ^&#123; [conditionLock lockWhenCondition:2]; sleep(0.1); NSLog(@&quot;çº¿ç¨‹ 2&quot;); [conditionLock unlockWithCondition:1]; // _value = 2 -&gt; 1 &#125;); dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; [conditionLock lock]; NSLog(@&quot;çº¿ç¨‹ 3&quot;); [conditionLock unlock]; &#125;);&#125; æŸ¥çœ‹æ‰“å°ç»“æœ æ‰“å°ç»“æœåˆ†æ çº¿ç¨‹1 è°ƒç”¨ [conditionLock lockWhenCondition:1]ï¼Œæ­¤æ—¶å› ä¸ºä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥ä¼š è¿›å…¥waitingçŠ¶æ€ï¼Œå½“è¿›å…¥åˆ°waitingæ—¶ï¼Œä¼šé‡Šæ”¾å½“å‰çš„äº’æ–¥é” æ­¤æ—¶å½“å‰çš„ çº¿ç¨‹3 è°ƒç”¨ [conditionLock lock]ï¼Œæœ¬è´¨ä¸Šæ˜¯è°ƒç”¨ [NSConditionLock lockBeforeDate:]ï¼Œè¿™é‡Œ ä¸éœ€è¦å¯¹æ¯”æ¡ä»¶å€¼ï¼Œæ‰€ä»¥ çº¿ç¨‹3å…ˆæ‰“å° æ¥ä¸‹æ¥ çº¿ç¨‹2 æ‰§è¡Œ [conditionLock lockWhenCondition:2]ï¼Œå› ä¸º æ»¡è¶³æ¡ä»¶å€¼ï¼Œæ‰€ä»¥ çº¿ç¨‹2ä¼šæ‰“å°ï¼Œæ‰“å°å®Œæˆåè°ƒç”¨ [conditionLock unlockWithCondition:1]ï¼Œè¿™ä¸ªæ—¶å€™å°†valueè®¾ç½®ä¸º 1ï¼Œå¹¶å‘é€boradcastï¼Œæ­¤æ—¶ çº¿ç¨‹1 æ¥æ”¶åˆ°å½“å‰çš„ä¿¡å·ï¼Œå”¤é†’æ‰§è¡Œå¹¶æ‰“å° è‡ªæ­¤å½“å‰æ‰“å› ä¸ºï¼šçº¿ç¨‹3-&gt;çº¿ç¨‹2-&gt;çº¿ç¨‹1 [conditionLock lockWhenCondition:] è¿™é‡Œä¼šæ ¹æ®ä¼ å…¥çš„ conditionå€¼ å’Œ Valueå€¼è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœ ä¸ç›¸ç­‰ï¼Œè¿™é‡Œ å°±ä¼šé˜»å¡ï¼Œè¿›å…¥çº¿ç¨‹æ± ï¼Œå¦åˆ™çš„è¯å°±ç»§ç»­ä»£ç æ‰§è¡Œ [conditionLock unlockWithCondition:1] ï¼Œè¿™é‡Œä¼š å…ˆæ›´æ”¹å½“å‰çš„valueå€¼ï¼Œç„¶åè¿›è¡Œä¸Šå¸‚ã€‚ç„¶å è¿›è¡Œå¹¿æ’­ï¼Œå”¤é†’å½“å‰çš„çº¿ç¨‹ æ€§èƒ½æ€»ç»“ OSSpinLockè‡ªæ—‹é” ç”±äºå®‰å…¨æ€§é—®é¢˜ï¼Œåœ¨iOS10ä¹‹åå·²ç»è¢«åºŸå¼ƒï¼Œå…¶åº•å±‚çš„å®ç°ç”¨ os_unfair_lock æ›¿ä»£ ä½¿ç”¨ OSSpinLock åŠæ‰€ç¤ºï¼Œä¼šå¤„äº å¿™ç­‰å¾…çŠ¶æ€ è€Œ os_unfair_lock æ˜¯å¤„äº ä¼‘çœ çŠ¶æ€ atomicåŸå­é” è‡ªå¸¦ä¸€æŠŠè‡ªæ—‹é”ï¼Œåªèƒ½ä¿è¯ setterã€getter æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨æ›´å¤šçš„è¿˜æ˜¯ nonatomic ä¿®é¥°å±æ€§ atomicï¼šå½“å±æ€§åœ¨è°ƒç”¨ setterã€getter æ–¹æ³•æ—¶ï¼Œä¼šåŠ ä¸Š è‡ªæ—‹é”OSSpinLockï¼Œç”¨äºä¿è¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å±æ€§çš„è¯»æˆ–å†™ï¼Œé¿å…äº†å±æ€§è¯»å†™ä¸åŒæ­¥çš„é—®é¢˜ï¼Œç”±äºæ˜¯åº•å±‚ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„äº’æ–¥é”ä»£ç ï¼Œä¼šå¯¼è‡´æ•ˆç‡ç›¸å¯¹è¾ƒä½ nonatomicï¼šå½“å±æ€§åœ¨è°ƒç”¨ setterã€getter æ–¹æ³•æ—¶ï¼Œä¸ä¼šåŠ ä¸Šè‡ªæ—‹é”ï¼Œå³ çº¿ç¨‹ä¸å®‰å…¨ï¼Œç”±äºç¼–è¯‘å™¨ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆäº’æ–¥é”ä»£ç ï¼Œå¯ä»¥ æé«˜æ•ˆç‡ @synchronized åœ¨åº•å±‚ç»´æŠ¤äº†ä¸€ä¸ª å“ˆå¸Œè¡¨ è¿›è¡Œçº¿ç¨‹dataçš„å­˜å‚¨ï¼Œé€šè¿‡ é“¾è¡¨ è¡¨ç¤º å¯é‡å…¥ï¼ˆå³åµŒå¥—ï¼‰çš„ç‰¹æ€§ï¼Œè™½ç„¶æ€§èƒ½è¾ƒä½ï¼Œä½†ç”±äºç®€å•å¥½ç”¨ï¼Œä½¿ç”¨é¢‘ç‡é«˜ NSLockã€NSRecursiveLock åº•å±‚æ˜¯å¯¹ pthread_mutex çš„å°è£… NSCondition å’Œ NSConditionLock æ˜¯æ¡ä»¶é”ï¼Œåº•å±‚éƒ½æ˜¯å¯¹ pthread_mutex çš„å°è£…ï¼Œå½“æ»¡è¶³æŸä¸€æ¡ä»¶æ—¶æ‰èƒ½è¿›è¡Œæ“ä½œï¼Œå’Œä¿¡å·é‡ dispatch_semphore ç±»ä¼¼ é”çš„ä½¿ç”¨åœºæ™¯ å¦‚æœåªæ˜¯ ç®€å• çš„ä½¿ç”¨ï¼Œä¾‹å¦‚æ¶‰åŠçº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ NSLock å³å¯ã€‚ å¦‚æœæ˜¯ å¾ªç¯åµŒå¥—ï¼Œæ¨èä½¿ç”¨ @synchronized ï¼Œä¸»è¦æ˜¯å› ä¸ºä½¿ç”¨ é€’å½’é” çš„æ€§èƒ½ä¸èƒ½ä½¿ç”¨ @synchronized çš„æ€§èƒ½ï¼ˆå› ä¸ºåœ¨ @synchronized ä¸­æ— è®ºæ€ä¹ˆé‡å…¥ï¼Œéƒ½æ²¡æœ‰å…³ç³»ï¼Œè€Œ NSRecursiveLockå¯èƒ½ä¼šå‡ºç°å´©æºƒç°è±¡ï¼‰ åœ¨ å¾ªç¯åµŒå¥— ä¸­ï¼Œå¦‚æœé€’å½’é”æŒæ¡çš„å¾ˆå¥½ï¼Œåˆ™å»ºè®®ä½¿ç”¨ é€’å½’é”ï¼Œå› ä¸ºæ€§èƒ½å¥½ å¦‚æœæ˜¯ å¾ªç¯åµŒå¥—ï¼Œå¹¶ä¸”è¿˜æœ‰ å¤šçº¿ç¨‹å½±å“ï¼Œä¾‹å¦‚æœ‰ç­‰å¾…ã€æ­»é”ç°è±¡æ—¶ï¼Œå»ºè®® ä½¿ç”¨ @synchronized","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†28ï¼šGCDä¹‹åº•å±‚åŸç†åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†28ï¼šGCDä¹‹åº•å±‚åŸç†åˆ†æ","date":"2021-04-05T06:46:07.000Z","updated":"2022-04-02T00:42:48.000Z","comments":true,"path":"2021/04/05/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†28ï¼šGCDä¹‹åº•å±‚åŸç†åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2021/04/05/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8628%EF%BC%9AGCD%E4%B9%8B%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/","excerpt":"","text":"","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†27ï¼šGCDä¹‹ NSThread & GCD & NSOperation","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†27ï¼šGCDä¹‹ NSThread & GCD & NSOperation","date":"2021-03-23T06:59:47.000Z","updated":"2023-02-24T16:13:35.534Z","comments":true,"path":"2021/03/23/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†27ï¼šGCDä¹‹ NSThread & GCD & NSOperation/","link":"","permalink":"https://www.bboyzj.cn/2021/03/23/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8627%EF%BC%9AGCD%E4%B9%8B%20NSThread%20&%20GCD%20&%20NSOperation/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯ä»‹ç» NSThreadã€GCDã€NSOperation å¸¸è§çš„ä½¿ç”¨æ–¹å¼ NSThreadNSThread æ˜¯è‹¹æœå®˜æ–¹æä¾› é¢å‘å¯¹è±¡ çš„çº¿ç¨‹æ“ä½œæŠ€æœ¯ï¼Œæ˜¯å¯¹ thread çš„ä¸Šå±‚å°è£…ï¼Œæ¯”è¾ƒåå‘äºåº•å±‚ï¼Œç®€å•æ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡ï¼Œä½¿ç”¨é¢‘ç‡è¾ƒå°‘ åˆ›å»ºçº¿ç¨‹ çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ é€šè¿‡ init åˆå§‹åŒ–æ–¹å¼åˆ›å»ºï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨ é€šè¿‡ detachNewThreadSelector æ„é€ å™¨æ–¹å¼åˆ›å»º é€šè¿‡ performSelector... æ–¹å¼åˆ›å»ºï¼Œä¸»è¦æ˜¯ç”¨äºè·å– ä¸»çº¿ç¨‹ï¼Œä»¥åŠ åå°çº¿ç¨‹ 12345678910111213141516171819202122- (void)createNSThread&#123; // æ–¹å¼ä¸€ï¼šåˆå§‹åŒ–æ–¹å¼ï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨ NSString * threadName1 = @&quot;NSThread1&quot;; NSThread * thread1 = [[NSThread alloc] initWithTarget:self selector:@selector(doSomething:) object:threadName1]; [thread1 start]; // æ–¹å¼äºŒï¼šæ„é€ å™¨æ–¹å¼ï¼Œè‡ªåŠ¨å¯åŠ¨ NSString * threadName2 = @&quot;NSThread2&quot;; [NSThread detachNewThreadSelector:@selector(doSomething:) toTarget:self withObject:threadName2]; // æ–¹å¼ä¸‰ï¼šperformSelector...æ–¹æ³•åˆ›å»º NSString * threadName3 = @&quot;NSThread3&quot;; [self performSelectorInBackground:@selector(doSomething:) withObject:threadName3]; // æ–¹å¼å››ï¼šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ NSString * threadName4 = @&quot;NSThread4&quot;; [self performSelectorOnMainThread:@selector(doSomething:) withObject:threadName4 waitUntilDone:YES];&#125;- (void)doSomething:(NSObject *)objc&#123; NSLog(@&quot;%@ - %@&quot;, objc, [NSThread currentThread]);&#125; å±æ€§ 12345- thread.executing // çº¿ç¨‹æ˜¯å¦åœ¨æ‰§è¡Œ- thread.isCancelled // çº¿ç¨‹æ˜¯å¦å–æ¶ˆ- thread.isFinished // çº¿ç¨‹æ˜¯å¦å®Œæˆ- thread.isMainThread // æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹- thread.threadPriority // çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå–å€¼è¿”å›0.0~1.0é»˜è®¤ä¼˜å…ˆçº§æ˜¯0.5ï¼Œ1.0ä¾¿æ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼ŒCPUè°ƒåº¦çš„è¯„ç‡é«˜ ç±»æ–¹æ³• å¸¸ç”¨çš„ç±»æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š currentThreadï¼šè·å–å½“å‰çº¿ç¨‹ sleepâ€¦ï¼šé˜»å¡çº¿ç¨‹ exitï¼šé€€å‡ºçº¿ç¨‹ mainThreadï¼šè·å–ä¸»çº¿ç¨‹ 1234567891011121314151617- (void)threadClassMethod&#123; // å½“å‰çº¿ç¨‹ [NSThread currentThread]; // å¦‚æœnumber = 1ï¼Œåˆ™è¡¨ç¤ºåœ¨ä¸»çº¿ç¨‹ï¼Œå¦åˆ™åœ¨å­çº¿ç¨‹ NSLog(@&quot;%@&quot;,[NSThread currentThread]); // é˜»å¡ä¼‘çœ  [NSThread sleepForTimeInterval:2]; // ä¼‘çœ 2s [NSThread sleepUntilDate:[NSDate date]]; // ä¼‘çœ åˆ°æŒ‡å®šæ—¶é—´ // å…¶ä»– [NSThread exit]; // é€€å‡ºçº¿ç¨‹ [NSThread isMainThread]; // åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºä¸»çº¿ç¨‹ [NSThread isMultiThreaded]; // åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºå¤šçº¿ç¨‹ NSThread * mainThread = [NSThread mainThread]; // ä¸»çº¿ç¨‹å¯¹è±¡ NSLog(@&quot;%@&quot;,mainThread);&#125; å®é™…ä½¿ç”¨ æ ¹æ®è‹¥â¼²ä¸ªurlå¼‚æ­¥åŠ è½½å¤šå¼ å›¾â½šï¼Œç„¶ååœ¨éƒ½ä¸‹è½½å®Œæˆååˆæˆâ¼€å¼ æ•´å›¾ï¼ŸGCDå¦‚ä½•å®ç°ï¼Ÿ dispatch_group_t + dispatch_group_enter + dispatch_group_leave + dispatch_group_notify 123456789101112131415161718192021222324-(void)Btn&#123; NSString *str = @&quot;http://www.jianshu.com/p/6930f335adba&quot;; NSURL *url = [NSURL URLWithString:str]; NSURLRequest *request = [NSURLRequest requestWithURL:url]; NSURLSession *session = [NSURLSession sharedSession]; // åˆ›å»ºçº¿ç¨‹ç»„ dispatch_group_t downloadGroup = dispatch_group_create(); for (int i=0; i&lt;10; i++) &#123; // enter dispatch_group_enter(downloadGroup); // ä¸‹è½½å›¾ç‰‡ NSURLSessionDataTask * task = [session dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123; NSLog(@&quot;%d---%d&quot;,i,i); // ç¦»å¼€ dispatch_group_leave(downloadGroup); &#125;]; [task resume]; &#125; dispatch_group_notify(downloadGroup, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;end&quot;); &#125;);&#125; dispatch_group_enterï¼šé€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚dispatch_group_leaveï¼šé€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚dispatch_group_notifyï¼šé€šçŸ¥çº¿ç¨‹ç»„ä¸­çš„ä»»åŠ¡éƒ½å®Œæˆäº† 10ä¸ªç½‘ç»œè¯·æ±‚é¡ºåºå›è°ƒ? dispatch_semaphore_tï¼šä¿¡å·é‡ 123456789101112131415161718192021222324-(void)Btn&#123; NSString *str = @&quot;http://www.jianshu.com/p/6930f335adba&quot;; NSURL *url = [NSURL URLWithString:str]; NSURLRequest *request = [NSURLRequest requestWithURL:url]; NSURLSession *session = [NSURLSession sharedSession]; dispatch_semaphore_t sem = dispatch_semaphore_create(0); for (int i=0; i&lt;10; i++) &#123; NSURLSessionDataTask *task = [session dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123; NSLog(@&quot;%d---%d&quot;,i,i); dispatch_semaphore_signal(sem); &#125;]; [task resume]; // è®©å¾ªç¯ç­‰å¾… dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER); &#125; dispatch_async(dispatch_get_main_queue(), ^&#123; NSLog(@&quot;end&quot;); &#125;);&#125; GCDdispatch_after 123456789- (void)testAfter&#123; /* dispatch_afterè¡¨ç¤ºåœ¨æŸé˜Ÿåˆ—ä¸­çš„blcokå»¶è¿Ÿæ‰§è¡Œ åº”ç”¨åœºæ™¯ï¼šåœ¨ä¸»é˜Ÿåˆ—ä¸Šå»¶è¿Ÿæ‰§è¡Œä¸€å‘ä»»åŠ¡ï¼Œå¦‚viewDidloadä¹‹åå»¶è¿Ÿ1sï¼Œæç¤ºä¸€ä¸ªalertviewï¼ˆæ˜¯å»¶è¿ŸåŠ å…¥åˆ°é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯å»¶è¿Ÿæ‰§è¡Œï¼‰ */ dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; NSLog(@&quot;1såè¾“å‡º&quot;); &#125;);&#125; dispath_once 1234567891011- (void)testOnce&#123; /* dispatch_onceä¿è¯APPåœ¨è¿è¡ŒæœŸé—´ï¼Œblockä¸­çš„ä»£ç åªæ‰§è¡Œæœ‰ä¸€æ¬¡ åº”ç”¨åœºæ™¯ï¼šå•ä¾‹ã€method_swizzling */ static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; // åˆ›å»ºå•ä¾‹ã€method swizzledæˆ–å…¶ä»–æœåŠ¡ NSLog(@&quot;åˆ›å»ºå•ä¾‹&quot;); &#125;);&#125; dispach_apply 12345678910111213141516171819202122- (void)testApply&#123; /* dispatch_applyå°†æŒ‡å®šçš„blockè¿½åŠ åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­é‡å¤æ‰§è¡Œï¼Œå¹¶ç­‰åˆ°å…¨éƒ¨çš„å¤„ç†æ‰§è¡Œç»“æŸ - ç›¸å½“äºçº¿ç¨‹å®‰å…¨çš„forå¾ªç¯ åº”ç”¨åœºæ™¯ï¼šç”¨æ¥æ‹‰å–ç½‘ç»œæ•°æ®åæå‰ç®—å‡ºå„ä¸ªæ§ä»¶çš„å¤§å°ï¼Œé˜²æ­¢ç»˜åˆ¶æ—¶è®¡ç®—ï¼Œæé«˜è¡¨å•æ»‘åŠ¨æµç•…æ€§ - æ·»åŠ åˆ°ä¸²è¡Œé˜Ÿåˆ—ä¸­ â€”â€” æŒ‰åºæ‰§è¡Œ - æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­ â€”â€” æ­»é” - æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ â€”â€” ä¹±åºæ‰§è¡Œ - æ·»åŠ éƒ½å…¨å±€é˜Ÿåˆ—ä¸­ â€”â€” ä¹±åºæ‰§è¡Œ */ dispatch_queue_t queue = dispatch_queue_create(&quot;ZJ&quot;, DISPATCH_QUEUE_SERIAL); NSLog(@&quot;dispatch_applyå‰&quot;); /* param1ï¼šé‡å¤çš„æ¬¡æ•° param2ï¼šè¿½åŠ çš„é˜Ÿåˆ— param3ï¼šæ‰§è¡Œä»»åŠ¡ */ dispatch_apply(10, queue, ^(size_t index) &#123; NSLog(@&quot;dispatch_apply çš„çº¿ç¨‹ %zu - %@&quot;, index, [NSThread currentThread]); &#125;); NSLog(@&quot;dispatch_applyå&quot;);&#125; dispatch_group_t æœ‰ä»¥ä¸‹ä¸¤ç§ä½¿ç”¨æ–¹å¼ æ–¹å¼ä¸€ï¼šä½¿ç”¨ dispatch_group_t + dispatch_group_notify 12345678910111213141516171819202122232425- (void)testGroup1&#123; /* dispatch_group_tï¼šè°ƒåº¦ç»„å°†ä»»åŠ¡åˆ†ç»„æ‰§è¡Œï¼Œèƒ½ç›‘å¬ä»»åŠ¡ç»„å®Œæˆï¼Œå¹¶è®¾ç½®ç­‰å¾…æ—¶é—´ åº”ç”¨åœºæ™¯ï¼šå¤šä¸ªæ¥å£è¯·æ±‚ä¹‹ååˆ·æ–°é¡µé¢ */ dispatch_group_t group = dispatch_group_create(); dispatch_queue_t queue = dispatch_queue_create(0, 0); dispatch_group_async(group, queue, ^&#123; NSLog(@&quot;è¯·æ±‚ä¸€å®Œæˆ&quot;); &#125;); dispatch_group_async(group, queue, ^&#123; NSLog(@&quot;è¯·æ±‚äºŒå®Œæˆ&quot;); &#125;); dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;åˆ·æ–°é¡µé¢&quot;); &#125;);&#125;// ****æ‰“å°ç»“æœ****2022-02-22 14:54:43.783327+0800 NSThread_Demo[4902:3701318] è¯·æ±‚ä¸€å®Œæˆ2022-02-22 14:54:43.783404+0800 NSThread_Demo[4902:3701318] è¯·æ±‚äºŒå®Œæˆ2022-02-22 14:54:43.783432+0800 NSThread_Demo[4902:3701318] åˆ·æ–°é¡µé¢ ã€æ–¹å¼äºŒã€‘ä½¿ç”¨ dispatch_group_enter + dispatch_group_leave + dispatch_group_notify 12345678910111213141516171819202122232425262728- (void)testGroup2&#123; /* dispatch_group_enter å’Œ dispatch_group_leave æˆå¯¹å‡ºç°ï¼Œä½¿è¿›å‡ºç»„çš„é€»è¾‘æ›´åŠ æ¸…æ™° */ dispatch_group_t group = dispatch_group_create(); dispatch_queue_t queue = dispatch_queue_create(0, 0); dispatch_group_enter(group); dispatch_async(queue, ^&#123; NSLog(@&quot;è¯·æ±‚ä¸€å®Œæˆ&quot;); dispatch_group_leave(group); &#125;); dispatch_group_enter(group); dispatch_async(queue, ^&#123; NSLog(@&quot;è¯·æ±‚äºŒå®Œæˆ&quot;); dispatch_group_leave(group); &#125;); dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;åˆ·æ–°é¡µé¢&quot;); &#125;);&#125;// ****æ‰“å°ç»“æœ****2022-02-22 15:13:39.981715+0800 NSThread_Demo[4906:3707145] è¯·æ±‚ä¸€å®Œæˆ2022-02-22 15:13:39.981788+0800 NSThread_Demo[4906:3707145] è¯·æ±‚äºŒå®Œæˆ2022-02-22 15:13:39.987105+0800 NSThread_Demo[4906:3707122] åˆ·æ–°é¡µé¢ åœ¨æ–¹å¼äºŒçš„åŸºç¡€ä¸Šå¢åŠ è¶…æ—¶ dispatch_group_wait 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950- (void)testGroup3&#123; /* long dispatch_group_wait(dispatch_group_t group, dispatch_time_t timeout) groupï¼šéœ€è¦ç­‰å¾…çš„è°ƒåº¦ç»„ timeoutï¼šç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼ˆå³ç­‰å¤šä¹…ï¼‰ - è®¾ç½®ä¸º DISPATCH_TIME_NOWæ„å‘³ç€ä¸ç­‰å¾…ç›´æ¥åˆ¤å®šè°ƒåº¦ç»„æ˜¯å¦æ‰§è¡Œå®Œæ¯• - è®¾ç½®ä¸º DISPATCH_TIME_FOREVERåˆ™ä¼šé˜»å¡å½“å‰è°ƒåº¦ç»„ï¼Œç›´åˆ°è°ƒåº¦ç»„æ‰§è¡Œå®Œæ¯• è¿”å›å€¼ï¼šä¸ºlong ç±»å‹ - è¿”å›å€¼ä¸º0 â€”â€” åœ¨æŒ‡å®šæ—¶é—´å†…è°ƒåº¦ç»„å®Œæˆäº†ä»»åŠ¡ - è¿”å›å€¼ä¸ä¸º0 â€”â€” åœ¨æŒ‡å®šæ—¶é—´å†…è°ƒåº¦ç»„æ²¡æœ‰æŒ‰æ—¶å®Œæˆä»»åŠ¡ */ dispatch_group_t group = dispatch_group_create(); dispatch_queue_t queue = dispatch_get_global_queue(0, 0); dispatch_group_enter(group); dispatch_async(queue, ^&#123; NSLog(@&quot;è¯·æ±‚ä¸€å®Œæˆ&quot;); dispatch_group_leave(group); &#125;); dispatch_group_enter(group); dispatch_async(queue, ^&#123; NSLog(@&quot;è¯·æ±‚äºŒå®Œæˆ&quot;); dispatch_group_leave(group); &#125;); // long timeout = dispatch_group_wait(group, DISPATCH_TIME_NOW); // ç«‹å³// long timeout = dispatch_group_wait(group, DISPATCH_TIME_FOREVER); // æ²¡é™åˆ¶ long timeout = dispatch_group_wait(group, dispatch_time(DISPATCH_TIME_NOW, 1 *NSEC_PER_SEC)); // 1så NSLog(@&quot;timeout = %ld&quot;,timeout); if (timeout == 0) &#123; NSLog(@&quot;æŒ‰æ—¶å®Œæˆä»»åŠ¡&quot;); &#125;else &#123; NSLog(@&quot;è¶…æ—¶&quot;); &#125; dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123; NSLog(@&quot;åˆ·æ–°é¡µé¢&quot;); &#125;);&#125;// ****æ‰“å°ç»“æœ****2022-02-22 15:25:03.528855+0800 NSThread_Demo[4915:3711930] è¯·æ±‚ä¸€å®Œæˆ2022-02-22 15:25:03.528859+0800 NSThread_Demo[4915:3711929] è¯·æ±‚äºŒå®Œæˆ2022-02-22 15:25:03.528923+0800 NSThread_Demo[4915:3711910] timeout = 02022-02-22 15:25:03.528946+0800 NSThread_Demo[4915:3711910] æŒ‰æ—¶å®Œæˆä»»åŠ¡2022-02-22 15:25:03.534554+0800 NSThread_Demo[4915:3711910] åˆ·æ–°é¡µé¢ dispatch_barrier_sync &amp; dispatch_barrier_async æ …æ å‡½æ•°ï¼Œä¸»è¦æœ‰ä¸¤ç§ä½¿ç”¨åœºæ™¯ï¼šä¸²è¡Œé˜Ÿåˆ—ã€å¹¶å‘é˜Ÿåˆ— 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384- (void)testBarrier&#123; /* dispatch_barrier_sync &amp; dispatch_barrier_async åº”ç”¨åœºæ™¯ï¼šåŒæ­¥é” ç­‰æ …æ å‰è¿½åŠ åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†è®²æ …æ åçš„ä»»åŠ¡è¿½åŠ åˆ°é˜Ÿåˆ—ä¸­ ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å…ˆæ‰§è¡Œæ …æ å‰ä»»åŠ¡ï¼Œåœ¨æ‰§è¡Œæ …æ ä»»åŠ¡ï¼Œæœ€åæ‰§è¡Œæ …æ åä»»åŠ¡ - dispatch_barrier_asyncï¼šå‰é¢çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ¥åˆ°è¿™é‡Œ - dispatch_barrier_syncï¼šä½œç”¨ç›¸åŒï¼Œä½†æ˜¯è¿™ä¸ªä¼šå µå¡çº¿ç¨‹ï¼Œå½±å“åé¢çš„ä»»åŠ¡æ‰§è¡Œ - dispatch_barrier_asyncï¼šå¯ä»¥æ§åˆ¶é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº - dispatch_barrier_syncï¼šä¸ä»…é˜»å¡äº†é˜Ÿåˆ—çš„æ‰§è¡Œï¼Œä¹Ÿé˜»å¡äº†çº¿ç¨‹çš„æ‰§è¡Œï¼ˆå°½é‡å°‘ç”¨ï¼‰ */// [self testBarrier1]; [self testBarrier2];&#125;- (void)testBarrier1&#123; // ä¸²è¡Œé˜Ÿåˆ—ä½¿ç”¨æ …æ å‡½æ•° dispatch_queue_t queue = dispatch_queue_create(&quot;ZJ&quot;, DISPATCH_QUEUE_SERIAL); NSLog(@&quot;å¼€å§‹ - %@&quot;,[NSThread currentThread]); dispatch_async(queue, ^&#123; sleep(2); NSLog(@&quot;å»¶è¿Ÿ2sçš„ä»»åŠ¡1 - %@&quot;, [NSThread currentThread]); &#125;); NSLog(@&quot;ç¬¬ä¸€æ¬¡ç»“æŸ - %@&quot;,[NSThread currentThread]); // æ …æ å‡½æ•°çš„ä½œç”¨æ˜¯è®²é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿›è¡Œåˆ†ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å…³æ³¨ä»»åŠ¡1ã€ä»»åŠ¡2 dispatch_barrier_async(queue, ^&#123; NSLog(@&quot;----------æ …æ ä»»åŠ¡----------%@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;æ …æ ç»“æŸ - %@&quot;,[NSThread currentThread]); dispatch_async(queue, ^&#123; sleep(2); NSLog(@&quot;å»¶è¿Ÿ2sçš„ä»»åŠ¡2 - %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;ç¬¬äºŒæ¬¡ç»“æŸ - %@&quot;,[NSThread currentThread]);&#125;// ****æ‰“å°ç»“æœ****2022-02-22 16:27:58.036179+0800 NSThread_Demo[4930:3731173] å¼€å§‹ - &lt;_NSMainThread: 0x282bfc800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:27:58.036253+0800 NSThread_Demo[4930:3731173] ç¬¬ä¸€æ¬¡ç»“æŸ - &lt;_NSMainThread: 0x282bfc800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:27:58.036278+0800 NSThread_Demo[4930:3731173] æ …æ ç»“æŸ - &lt;_NSMainThread: 0x282bfc800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:27:58.036303+0800 NSThread_Demo[4930:3731173] ç¬¬äºŒæ¬¡ç»“æŸ - &lt;_NSMainThread: 0x282bfc800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:28:00.041655+0800 NSThread_Demo[4930:3731195] å»¶è¿Ÿ2sçš„ä»»åŠ¡1 - &lt;NSThread: 0x282bfaa80&gt;&#123;number = 4, name = (null)&#125;2022-02-22 16:28:00.042098+0800 NSThread_Demo[4930:3731195] ----------æ …æ ä»»åŠ¡----------&lt;NSThread: 0x282bfaa80&gt;&#123;number = 4, name = (null)&#125;2022-02-22 16:28:02.047479+0800 NSThread_Demo[4930:3731195] å»¶è¿Ÿ2sçš„ä»»åŠ¡2 - &lt;NSThread: 0x282bfaa80&gt;&#123;number = 4, name = (null)&#125;// testBarrier2- (void)testBarrier2&#123; // å¹¶å‘é˜Ÿåˆ—ä½¿ç”¨æ …æ å‡½æ•° dispatch_queue_t queue = dispatch_queue_create(&quot;ZJ&quot;, DISPATCH_QUEUE_CONCURRENT); NSLog(@&quot;å¼€å§‹ - %@&quot;,[NSThread currentThread]); dispatch_async(queue, ^&#123; sleep(2); NSLog(@&quot;å»¶è¿Ÿ2sçš„ä»»åŠ¡1 - %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;ç¬¬ä¸€æ¬¡ç»“æŸ - %@&quot;,[NSThread currentThread]); // ç”±äºå¹¶å‘é˜Ÿåˆ—å¼‚æ­¥ä»»åŠ¡æ—¶ä¹±åºæ‰§è¡Œå®Œæ¯•çš„ï¼Œæ‰€ä»¥ä½¿ç”¨æ …æ å‡½æ•°å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶é˜Ÿåˆ—å†…ä»»åŠ¡æ‰§è¡Œçš„é¡ºåº dispatch_barrier_async(queue, ^&#123; NSLog(@&quot;----------æ …æ ä»»åŠ¡----------%@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;æ …æ ç»“æŸ - %@&quot;,[NSThread currentThread]); dispatch_async(queue, ^&#123; sleep(2); NSLog(@&quot;å»¶è¿Ÿ2sçš„ä»»åŠ¡2 - %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;ç¬¬äºŒæ¬¡ç»“æŸ - %@&quot;,[NSThread currentThread]);&#125;// ****æ‰“å°ç»“æœ****2022-02-22 16:24:07.750567+0800 NSThread_Demo[4927:3729822] å¼€å§‹ - &lt;_NSMainThread: 0x2809c8800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:24:07.750635+0800 NSThread_Demo[4927:3729822] ç¬¬ä¸€æ¬¡ç»“æŸ - &lt;_NSMainThread: 0x2809c8800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:24:07.750665+0800 NSThread_Demo[4927:3729822] æ …æ ç»“æŸ - &lt;_NSMainThread: 0x2809c8800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:24:07.750685+0800 NSThread_Demo[4927:3729822] ç¬¬äºŒæ¬¡ç»“æŸ - &lt;_NSMainThread: 0x2809c8800&gt;&#123;number = 1, name = main&#125;2022-02-22 16:24:09.756044+0800 NSThread_Demo[4927:3729837] å»¶è¿Ÿ2sçš„ä»»åŠ¡1 - &lt;NSThread: 0x2809840c0&gt;&#123;number = 5, name = (null)&#125;2022-02-22 16:24:09.756553+0800 NSThread_Demo[4927:3729837] ----------æ …æ ä»»åŠ¡----------&lt;NSThread: 0x2809840c0&gt;&#123;number = 5, name = (null)&#125;2022-02-22 16:24:11.761825+0800 NSThread_Demo[4927:3729837] å»¶è¿Ÿ2sçš„ä»»åŠ¡2 - &lt;NSThread: 0x2809840c0&gt;&#123;number = 5, name = (null)&#125; dispatch_semaphore_t ä¿¡å·é‡ä¸»è¦ä½œç”¨äºåŒæ­¥é”ï¼Œç”¨äºæ§åˆ¶ GCD æœ€å¤§å¹¶å‘æ•° 12345678910111213141516171819202122232425262728- (void)testSemaphore&#123; /* åº”ç”¨åœºæ™¯ï¼šåŒæ­¥é”ï¼Œæ§åˆ¶GCDæœ€å¤§å¹¶å‘æ•° - dispatch_semphore_create()ï¼šåˆ›å»ºä¿¡å·é‡ - dispatch_semphore_wait()ï¼šç­‰å¾…ä¿¡å·é‡ï¼Œä¿¡å·é‡å‡1ï¼Œå½“ä¿¡å·é‡ &lt; 0 æ—¶ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ ¹æ®ä¼ å…¥çš„ç­‰å¾…æ—¶é—´å†³å®šæ¥ä¸‹æ¥çš„æ“ä½œï¼Œå¦‚æœæ°¸ä¹…ç­‰å¾…å°†ç­‰åˆ°ä¿¡å·(signal)æ‰èƒ½æ‰§è¡Œä¸‹å» - dispatch_semphore_signal()ï¼šé‡Šæ”¾ä¿¡å·é‡ï¼Œä¿¡å·é‡åŠ 1ï¼Œå½“ä¿¡å·é‡ &gt;= 0 ä¼šæ‰§è¡Œwaitä¹‹åçš„ä»£ç  */ dispatch_queue_t queue = dispatch_queue_create(&quot;ZJ&quot;, DISPATCH_QUEUE_CONCURRENT); for (int i = 0; i &lt; 10; i ++) &#123; dispatch_async(queue, ^&#123; NSLog(@&quot;å½“å‰ - %dï¼Œçº¿ç¨‹ - %@&quot;,i,[NSThread currentThread]); &#125;); &#125; // åˆ©ç”¨ä¿¡å·é‡æ¥æ”¹å†™ dispatch_semaphore_t sem = dispatch_semaphore_create(0); for (int i = 0; i &lt; 10; i ++) &#123; dispatch_async(queue, ^&#123; NSLog(@&quot;å½“å‰ - %d çº¿ç¨‹ - %@&quot;,i,[NSThread currentThread]); dispatch_semaphore_signal(sem); &#125;); dispatch_semaphore_wait(sem, DISPATCH_TIME_FOREVER); &#125; &#125; ç”±ä¸Šé¢çš„ä»£ç å¯çŸ¥ï¼Œåœ¨ä½¿ç”¨ä¿¡å·é‡ä¹‹å‰çš„æ‰“å°ç»“æœæ˜¯æ— åºçš„ï¼š 123456789102022-02-23 08:59:56.276005+0800 NSThread_Demo[5019:3790181] å½“å‰ - 1ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825f0c00&gt;&#123;number = 4, name = (null)&#125;2022-02-23 08:59:56.276005+0800 NSThread_Demo[5019:3790180] å½“å‰ - 0ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825f0080&gt;&#123;number = 3, name = (null)&#125;2022-02-23 08:59:56.276048+0800 NSThread_Demo[5019:3790182] å½“å‰ - 3ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825e5180&gt;&#123;number = 7, name = (null)&#125;2022-02-23 08:59:56.276079+0800 NSThread_Demo[5019:3790181] å½“å‰ - 4ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825f0c00&gt;&#123;number = 4, name = (null)&#125;2022-02-23 08:59:56.276081+0800 NSThread_Demo[5019:3790184] å½“å‰ - 2ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825eca40&gt;&#123;number = 6, name = (null)&#125;2022-02-23 08:59:56.276110+0800 NSThread_Demo[5019:3790181] å½“å‰ - 7ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825f0c00&gt;&#123;number = 4, name = (null)&#125;2022-02-23 08:59:56.276093+0800 NSThread_Demo[5019:3790182] å½“å‰ - 6ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825e5180&gt;&#123;number = 7, name = (null)&#125;2022-02-23 08:59:56.276157+0800 NSThread_Demo[5019:3790182] å½“å‰ - 9ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825e5180&gt;&#123;number = 7, name = (null)&#125;2022-02-23 08:59:56.276172+0800 NSThread_Demo[5019:3790185] å½“å‰ - 5ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825f0440&gt;&#123;number = 5, name = (null)&#125;2022-02-23 08:59:56.276185+0800 NSThread_Demo[5019:3790181] å½“å‰ - 8ï¼Œçº¿ç¨‹ - &lt;NSThread: 0x2825f0c00&gt;&#123;number = 4, name = (null)&#125; ç”±ä¸Šé¢çš„ä»£ç å¯çŸ¥ï¼Œåœ¨ä½¿ç”¨ä¿¡å·é‡ä¹‹åï¼Œæ‰“å°çš„ç»“æœæ˜¯æœ‰åºçš„ï¼Œå¦‚ä¸‹ï¼š 123456789102022-02-23 08:59:56.276197+0800 NSThread_Demo[5019:3790186] å½“å‰ - 0 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.276416+0800 NSThread_Demo[5019:3790186] å½“å‰ - 1 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.276572+0800 NSThread_Demo[5019:3790186] å½“å‰ - 2 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.276706+0800 NSThread_Demo[5019:3790186] å½“å‰ - 3 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.276828+0800 NSThread_Demo[5019:3790186] å½“å‰ - 4 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.276934+0800 NSThread_Demo[5019:3790186] å½“å‰ - 5 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.276997+0800 NSThread_Demo[5019:3790186] å½“å‰ - 6 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.277125+0800 NSThread_Demo[5019:3790186] å½“å‰ - 7 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.277179+0800 NSThread_Demo[5019:3790186] å½“å‰ - 8 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125;2022-02-23 08:59:56.277298+0800 NSThread_Demo[5019:3790186] å½“å‰ - 9 çº¿ç¨‹ - &lt;NSThread: 0x2825f3880&gt;&#123;number = 8, name = (null)&#125; dispatch_source_t dispatch_source_t ä¸»è¦ç”¨äºè®¡æ—¶æ“ä½œï¼Œå…¶åŸå› æ˜¯å› ä¸ºå®ƒåˆ›å»ºçš„timerä¸ä¾èµ–äºRunloopï¼Œä¸”è®¡æ—¶ç²¾å‡†åº¦æ¯” NSTimer é«˜ï¼Œdispatch_source_t æœ‰ä¸€ç‚¹å¿…é¡»è¦è®¾å€¼ä¸ºå±æ€§ï¼Œå¦åˆ™ä¼šè¢«ç«‹å³é‡Šæ”¾ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657- (void)testSource&#123; /* dispatch_source åº”ç”¨åœºæ™¯ï¼šGCDTimer åœ¨iOSå¼€å‘ä¸­ä¸€èˆ¬ä½¿ç”¨NSTimeræ¥å¤„ç†å®šæ—¶é€»è¾‘ï¼Œä½†NSTimeræ˜¯ä¾èµ–Runloopçš„ï¼Œè€ŒRunloopå¯ä»¥è¿è¡Œåœ¨ä¸åŒçš„æ¨¡å¼ä¸‹ å¦‚æœNSTimeræ·»åŠ åœ¨ä¸€ç§æ¨¡å¼ä¸‹ï¼Œå½“Runloopè¿è¡Œåœ¨å…¶ä»–æ¨¡å¼ä¸‹çš„æ—¶å€™ï¼Œå®šæ—¶å™¨å°±æŒ‚æœºäº† dispatch_sourceæ˜¯ä¸€ç§åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥ç”¨æ¥ç›‘å¬ä¸€äº›åº•å±‚çš„ç³»ç»Ÿäº‹ä»¶ - Timer Dispatch Sourceï¼šå®šæ—¶å™¨äº‹ä»¶æºï¼Œç”¨æ¥ç”Ÿæˆå‘¨æœŸæ€§çš„é€šçŸ¥æˆ–å›è°ƒ - Signal Dispatch Sourceï¼šç›‘å¬ä¿¡å·äº‹ä»¶æºï¼Œå½“æœ‰UNIXä¿¡å·å‘ç”Ÿæ—¶ä¼šé€šçŸ¥ - Descriptor Dispatch Sourceï¼šç›‘å¬æ–‡ä»¶æˆ–socketäº‹ä»¶æºï¼Œå½“æ–‡ä»¶æˆ–socketæ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ä¼šé€šçŸ¥ - Process Dispatch Sourceï¼šç›‘å¬è¿›ç¨‹äº‹ä»¶æºï¼Œä¸è¿›ç¨‹ç›¸å…³çš„äº‹ä»¶é€šçŸ¥ - Mach port Dispatch Sourceï¼šç›‘å¬Machç«¯å£äº‹ä»¶æº - Custom Dispatch Sourceï¼šç›‘å¬è‡ªå®šä¹‰äº‹ä»¶æº ä¸»è¦ä½¿ç”¨çš„API: - dispatch_source_createï¼šåˆ›å»ºæ—¶é—´æº - dispatch_source_set_event_handlerï¼šè®¾å€¼æ•°æ®æºå›è°ƒ - dispatch_source_merge_dataï¼šè®¾å€¼äº‹ä»¶æºæ•°æ® - dispatch_source_get_dataï¼šè·å–äº‹ä»¶æºæ•°æ® - dispatch_resumeï¼šç»§ç»­ - dispatch_suspendï¼šæŒ‚èµ· - dispatch_cancleï¼šå–æ¶ˆ */ // åˆ›å»ºé˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;ZJ&quot;, DISPATCH_QUEUE_SERIAL); // åˆ›å»ºtimer self.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue); // è®¾ç½®timeré¦–æ¬¡æ‰§è¡Œäº‹ä»¶ï¼Œé—´éš”ï¼Œç²¾ç¡®åº¦ dispatch_source_set_timer(self.timer, dispatch_time(DISPATCH_TIME_NOW, 2.0 * NSEC_PER_SEC), 1.0 * NSEC_PER_SEC, 0); // è®¾ç½®timerå›è°ƒäº‹ä»¶ dispatch_source_set_event_handler(self.timer, ^&#123; NSLog(@&quot;GCDTimer&quot;); &#125;); // é»˜è®¤æ˜¯æŒ‚èµ·çŠ¶æ€ï¼Œéœ€è¦æ‰‹åŠ¨æ¿€æ´» dispatch_resume(self.timer);&#125;// æ‰“å°ç»“æœ2022-02-23 10:01:59.795986+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:00.795906+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:01.795952+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:02.795970+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:03.796053+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:04.796022+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:05.796038+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:06.796074+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:07.796115+0800 NSThread_Demo[5145:3819354] GCDTimer2022-02-23 10:02:08.796159+0800 NSThread_Demo[5145:3819355] GCDTimer2022-02-23 10:02:09.796130+0800 NSThread_Demo[5145:3819355] GCDTimer2022-02-23 10:02:10.796167+0800 NSThread_Demo[5145:3819355] GCDTimer2022-02-23 10:02:11.796161+0800 NSThread_Demo[5145:3819355] GCDTimer2022-02-23 10:02:12.796162+0800 NSThread_Demo[5145:3819355] GCDTimer2022-02-23 10:02:13.796169+0800 NSThread_Demo[5145:3819355] GCDTimer... NSOperationNSOperation æ˜¯åŸºäº GCD ä¹‹ä¸Šçš„æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œ NSOpetation éœ€è¦é…åˆ NSOpetationQueue æ¥å®ç°å¤šçº¿ç¨‹ NSOpetation å®ç°å¤šçº¿ç¨‹çš„æ­¥éª¤å¦‚ä¸‹ï¼š åˆ›å»ºä»»åŠ¡ï¼šå…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ° NSOperation å¯¹è±¡ä¸­ã€‚ åˆ›å»ºé˜Ÿåˆ—ï¼šåˆ›å»º NSOperationQueueã€‚ å°†ä»»åŠ¡åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼šå°† NSOperation å¯¹è±¡æ·»åŠ åˆ° NSOperationQueue ä¸­ã€‚ 1234567891011- (void)testBaseNSOperation&#123; // å¤„ç†äº‹åŠ¡ NSInvocationOperation * op = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(handleInvocation:) object:@&quot;ZJ&quot;]; // åˆ›å»ºé˜Ÿåˆ— NSOperationQueue * queue = [[NSOperationQueue alloc] init]; // æ“ä½œåŠ å…¥é˜Ÿåˆ— [queue addOperation:op];&#125;- (void)handleInvocation:(id)operation&#123; NSLog(@&quot;%@ - %@&quot;,operation,[NSThread currentThread]);&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNSOperation æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå®é™…è¿ç”¨æ—¶ä¸­éœ€è¦ä½¿ç”¨å®ƒçš„å­ç±»ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼š ä½¿ç”¨å­ç±» NSInvocationOperation 12345- (void)createNSOperation&#123; // åˆ›å»º NSInvocationOperation å¯¹è±¡å¹¶å…³è”æ–¹æ³•ï¼Œä¹‹åstart NSInvocationOperation * invocationOperation = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(doSomething:) object:@&quot;ZJ&quot;]; [invocationOperation start];&#125; ä½¿ç”¨å­ç±» NSBlockOperation 123456789101112131415161718192021222324252627- (void)testBlockOperationExecution&#123; // é€šè¿‡ addExecutionBlock è¿™ä¸ªæ–¹æ³•å¯ä»¥è®© NSBlockOperation å®ç°å¤šçº¿ç¨‹ // NSBlockOperation åˆ›å»ºæ—¶ block ä¸­çš„ä»»åŠ¡æ˜¯ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œè€Œè¿ç”¨ addExecutionBlock åŠ å…¥çš„ä»»åŠ¡æ˜¯åœ¨å­çº¿ç¨‹æ‰§è¡Œçš„ NSBlockOperation * blockOperation = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;main task = &gt;currentThread: %@&quot;,[NSThread currentThread]); &#125;]; [blockOperation addExecutionBlock:^&#123; NSLog(@&quot;task1 = &gt;currentThread: %@&quot;,[NSThread currentThread]); &#125;]; [blockOperation addExecutionBlock:^&#123; NSLog(@&quot;task2 = &gt;currentThread: %@&quot;,[NSThread currentThread]); &#125;]; [blockOperation addExecutionBlock:^&#123; NSLog(@&quot;task3 = &gt;currentThread: %@&quot;,[NSThread currentThread]); &#125;]; [blockOperation start];&#125;// æ‰“å°ç»“æœ2022-02-23 13:48:54.022671+0800 NSThread_Demo[5246:3887949] main task = &gt;currentThread: &lt;_NSMainThread: 0x281598800&gt;&#123;number = 1, name = main&#125;2022-02-23 13:48:54.022688+0800 NSThread_Demo[5246:3887974] task1 = &gt;currentThread: &lt;NSThread: 0x2815c8180&gt;&#123;number = 4, name = (null)&#125;2022-02-23 13:48:54.022786+0800 NSThread_Demo[5246:3887971] task2 = &gt;currentThread: &lt;NSThread: 0x2815da480&gt;&#123;number = 5, name = (null)&#125;2022-02-23 13:48:54.022786+0800 NSThread_Demo[5246:3887976] task3 = &gt;currentThread: &lt;NSThread: 0x2815dc0c0&gt;&#123;number = 6, name = (null)&#125; å®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…ä»»åŠ¡ 1234567891011121314151617181920212223// è‡ªå®šä¹‰ç»§æ‰¿è‡ªNSOperationçš„å­ç±»@interface ZJOperation : NSOperation@end@implementation ZJOperation- (void)main&#123; for (int i = 0; i &lt; 3; i ++) &#123; NSLog(@&quot;NSOperationçš„å­ç±»ï¼š%@&quot;,[NSThread currentThread]); &#125;&#125;@end// ä½¿ç”¨- (void)testZJOperation&#123; // è¿ç”¨é›†æˆè‡ªNSOperationçš„å­ç±»ï¼Œé¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé›†æˆè‡ªNSOperationçš„ç±»ï¼Œç„¶åé‡å†™å®ƒçš„mainæ–¹æ³• ZJOperation * operation = [[ZJOperation alloc] init]; [operation start];&#125;// æ‰“å°ç»“æœ2022-02-25 15:16:22.694568+0800 NSThread_Demo[5696:4241286] NSOperationçš„å­ç±»ï¼š&lt;_NSMainThread: 0x282180800&gt;&#123;number = 1, name = main&#125;2022-02-25 15:16:22.694645+0800 NSThread_Demo[5696:4241286] NSOperationçš„å­ç±»ï¼š&lt;_NSMainThread: 0x282180800&gt;&#123;number = 1, name = main&#125;2022-02-25 15:16:22.694670+0800 NSThread_Demo[5696:4241286] NSOperationçš„å­ç±»ï¼š&lt;_NSMainThread: 0x282180800&gt;&#123;number = 1, name = main&#125; NSOperationQueueNSOperationQueueæ·»åŠ äº‹åŠ¡ NSOperationQueue æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—ã€å…¶ä»–é˜Ÿåˆ—ã€‚å…¶ä»–é˜Ÿåˆ—åŒ…å«äº† ä¸²è¡Œå’Œå¹¶å‘ã€‚ ä¸»é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ— ä¸Šçš„ä»»åŠ¡æ—¶åœ¨ ä¸»çº¿ç¨‹ æ‰§è¡Œçš„ å…¶ä»–é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰ï¼šåŠ å…¥åˆ° éé˜Ÿåˆ— ä¸­çš„ä»»åŠ¡ é»˜è®¤å°±æ˜¯å¹¶å‘ï¼Œå¼€å¯å¤šçº¿ç¨‹ 12345678910111213141516171819202122232425262728293031- (void)testNSOperationQueue&#123; /* NSInvocationOperation å’Œ NSBlockOperation ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼š - å‰è€…ç±»ä¼¼targetå½¢å¼ - åè€…ç±»ä¼¼blockå½¢å¼â€”â€”å‡½æ•°å¼ç¼–ç¨‹ï¼Œä¸šåŠ¡é€»è¾‘ä»£ç å¯è¯»æ€§æ›´é«˜ NSOperationQueue æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ ä»»åŠ¡ä¸€ã€ä»»åŠ¡äºŒçš„å®Œæˆé¡ºåºä¸ç¡®å®š */ // åˆå§‹åŒ–äº‹åŠ¡ NSBlockOperation * bo = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;ä»»åŠ¡1â€”â€”%@&quot;,[NSThread currentThread]); &#125;]; // æ·»åŠ äº‹åŠ¡ [bo addExecutionBlock:^&#123; NSLog(@&quot;ä»»åŠ¡2â€”â€”%@&quot;,[NSThread currentThread]); &#125;]; // å›è°ƒç›‘å¬ bo.completionBlock = ^&#123; NSLog(@&quot;å®Œæˆäº†!!!&quot;); &#125;; NSOperationQueue * queue = [[NSOperationQueue alloc] init]; [queue addOperation:bo]; NSLog(@&quot;äº‹åŠ¡æ·»åŠ åŠ è¿›äº†NSOperationQueue&quot;);&#125;// æ‰“å°ç»“æœ2022-02-25 15:28:17.704473+0800 NSThread_Demo[5720:4246238] äº‹åŠ¡æ·»åŠ åŠ è¿›äº†NSOperationQueue2022-02-25 15:28:17.704513+0800 NSThread_Demo[5720:4246260] ä»»åŠ¡1â€”â€”&lt;NSThread: 0x282f6c340&gt;&#123;number = 5, name = (null)&#125;2022-02-25 15:28:17.704552+0800 NSThread_Demo[5720:4246260] ä»»åŠ¡2â€”â€”&lt;NSThread: 0x282f6c340&gt;&#123;number = 5, name = (null)&#125;2022-02-25 15:28:17.704602+0800 NSThread_Demo[5720:4246260] å®Œæˆäº†!!! è®¾å€¼æ‰§è¡Œé¡ºåº 123456789101112131415- (void)testQueueSequence&#123; NSOperationQueue * queue = [[NSOperationQueue alloc] init]; for (int i = 0; i &lt; 5; i ++) &#123; [queue addOperationWithBlock:^&#123; NSLog(@&quot;%@ --- %d&quot;,[NSThread currentThread],i); &#125;]; &#125;&#125;// æ‰“å°ç»“æœ2022-03-08 09:11:03.759862+0800 NSThread_Demo[4217:3030339] &lt;NSThread: 0x281b90240&gt;&#123;number = 3, name = (null)&#125; --- 12022-03-08 09:11:03.760398+0800 NSThread_Demo[4217:3030384] &lt;NSThread: 0x281be7a80&gt;&#123;number = 7, name = (null)&#125; --- 32022-03-08 09:11:03.760526+0800 NSThread_Demo[4217:3030340] &lt;NSThread: 0x281b830c0&gt;&#123;number = 6, name = (null)&#125; --- 22022-03-08 09:11:03.760655+0800 NSThread_Demo[4217:3030339] &lt;NSThread: 0x281b90240&gt;&#123;number = 3, name = (null)&#125; --- 42022-03-08 09:11:03.760697+0800 NSThread_Demo[4217:3030343] &lt;NSThread: 0x281b84280&gt;&#123;number = 5, name = (null)&#125; --- 0 è®¾ç½®ä¼˜å…ˆçº§123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051- (void)testOperationQuality&#123; /* NSOperationè®¾å€¼ä¼˜å…ˆçº§åªä¼šè®©CPUæœ‰æ›´é«˜çš„å‡ ç‡è°ƒç”¨ï¼Œä¸æ˜¯è¯´è®¾å€¼é«˜å°±ä¸€å®šå…¨éƒ¨å…ˆå®Œæˆ - ä¸é€‚ç”¨sleep â€”â€” é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å…ˆäºä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ - ä½¿ç”¨sleepè¿›è¡Œå»¶æ—¶ â€”â€” é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡æ…¢äºä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ */ NSBlockOperation * bo1 = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 5; i ++) &#123; // sleep(1); NSLog(@&quot;ç¬¬ä¸€ä¸ªæ“ä½œ %d --- %@&quot;,i,[NSThread currentThread]); &#125; &#125;]; // è®¾ç½®æœ€é«˜ä¼˜å…ˆçº§ bo1.qualityOfService = NSQualityOfServiceUserInteractive; NSBlockOperation * bo2 = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 5; i ++) &#123; NSLog(@&quot;ç¬¬äºŒä¸ªæ“ä½œ %d --- %@&quot;,i,[NSThread currentThread]); &#125; &#125;]; // è®¾ç½®æœ€ä½ä¼˜å…ˆçº§ bo2.qualityOfService = NSQualityOfServiceBackground; NSOperationQueue * queue = [[NSOperationQueue alloc] init]; [queue addOperation:bo1]; [queue addOperation:bo2];&#125;// ä¸ä½¿ç”¨sleepçš„æ‰“å°ç»“æœ2022-03-08 09:23:44.072325+0800 NSThread_Demo[4220:3035578] ç¬¬ä¸€ä¸ªæ“ä½œ 0 --- &lt;NSThread: 0x2826ac100&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:23:44.072420+0800 NSThread_Demo[4220:3035578] ç¬¬ä¸€ä¸ªæ“ä½œ 1 --- &lt;NSThread: 0x2826ac100&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:23:44.072448+0800 NSThread_Demo[4220:3035578] ç¬¬ä¸€ä¸ªæ“ä½œ 2 --- &lt;NSThread: 0x2826ac100&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:23:44.072516+0800 NSThread_Demo[4220:3035578] ç¬¬ä¸€ä¸ªæ“ä½œ 3 --- &lt;NSThread: 0x2826ac100&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:23:44.072447+0800 NSThread_Demo[4220:3035582] ç¬¬äºŒä¸ªæ“ä½œ 0 --- &lt;NSThread: 0x2826a8300&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:23:44.072555+0800 NSThread_Demo[4220:3035578] ç¬¬ä¸€ä¸ªæ“ä½œ 4 --- &lt;NSThread: 0x2826ac100&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:23:44.073242+0800 NSThread_Demo[4220:3035582] ç¬¬äºŒä¸ªæ“ä½œ 1 --- &lt;NSThread: 0x2826a8300&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:23:44.073345+0800 NSThread_Demo[4220:3035582] ç¬¬äºŒä¸ªæ“ä½œ 2 --- &lt;NSThread: 0x2826a8300&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:23:44.073484+0800 NSThread_Demo[4220:3035582] ç¬¬äºŒä¸ªæ“ä½œ 3 --- &lt;NSThread: 0x2826a8300&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:23:44.073546+0800 NSThread_Demo[4220:3035582] ç¬¬äºŒä¸ªæ“ä½œ 4 --- &lt;NSThread: 0x2826a8300&gt;&#123;number = 5, name = (null)&#125;// ä½¿ç”¨sleepçš„æ‰“å°ç»“æœ2022-03-08 09:25:01.471850+0800 NSThread_Demo[4223:3036749] ç¬¬äºŒä¸ªæ“ä½œ 0 --- &lt;NSThread: 0x282c1de40&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:25:01.472242+0800 NSThread_Demo[4223:3036749] ç¬¬äºŒä¸ªæ“ä½œ 1 --- &lt;NSThread: 0x282c1de40&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:25:01.472334+0800 NSThread_Demo[4223:3036749] ç¬¬äºŒä¸ªæ“ä½œ 2 --- &lt;NSThread: 0x282c1de40&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:25:01.472867+0800 NSThread_Demo[4223:3036749] ç¬¬äºŒä¸ªæ“ä½œ 3 --- &lt;NSThread: 0x282c1de40&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:25:01.473057+0800 NSThread_Demo[4223:3036749] ç¬¬äºŒä¸ªæ“ä½œ 4 --- &lt;NSThread: 0x282c1de40&gt;&#123;number = 4, name = (null)&#125;2022-03-08 09:25:02.472831+0800 NSThread_Demo[4223:3036750] ç¬¬ä¸€ä¸ªæ“ä½œ 0 --- &lt;NSThread: 0x282c4c080&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:25:03.474228+0800 NSThread_Demo[4223:3036750] ç¬¬ä¸€ä¸ªæ“ä½œ 1 --- &lt;NSThread: 0x282c4c080&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:25:04.475736+0800 NSThread_Demo[4223:3036750] ç¬¬ä¸€ä¸ªæ“ä½œ 2 --- &lt;NSThread: 0x282c4c080&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:25:05.477191+0800 NSThread_Demo[4223:3036750] ç¬¬ä¸€ä¸ªæ“ä½œ 3 --- &lt;NSThread: 0x282c4c080&gt;&#123;number = 5, name = (null)&#125;2022-03-08 09:25:06.478576+0800 NSThread_Demo[4223:3036750] ç¬¬ä¸€ä¸ªæ“ä½œ 4 --- &lt;NSThread: 0x282c4c080&gt;&#123;number = 5, name = (null)&#125; è®¾ç½®å¹¶å‘æ•°123456789101112131415161718192021222324- (void)testOperationMaxCount&#123; /* åœ¨GCDä¸­åªèƒ½ä½¿ç”¨ä¿¡å·é‡æ¥è®¾ç½®å¹¶å‘æ•° è€ŒNSOperationè½»æ˜“å°±èƒ½è®¾ç½®å¹¶å‘æ•° é€šè¿‡è®¾ç½®maxConcurrentOperationCountæ¥æ§åˆ¶å•æ¬¡é˜Ÿåˆ—å»æ‰§è¡Œçš„ä»»åŠ¡æ•° */ NSOperationQueue * queue = [[NSOperationQueue alloc] init]; queue.name = @&quot;Felix&quot;; queue.maxConcurrentOperationCount = 2; for (int i = 0; i &lt; 5; i ++) &#123; [queue addOperationWithBlock:^&#123; [NSThread sleepForTimeInterval:2]; NSLog(@&quot;%d -- %@&quot;,i,[NSThread currentThread]); &#125;]; &#125;&#125;// æŸ¥çœ‹æ‰“å°ç»“æœ2022-03-08 11:12:55.459322+0800 NSThread_Demo[4293:3074227] 0 -- &lt;NSThread: 0x283260080&gt;&#123;number = 4, name = (null)&#125;2022-03-08 11:12:55.459326+0800 NSThread_Demo[4293:3074223] 1 -- &lt;NSThread: 0x283264140&gt;&#123;number = 3, name = (null)&#125;2022-03-08 11:12:57.463085+0800 NSThread_Demo[4293:3074223] 3 -- &lt;NSThread: 0x283264140&gt;&#123;number = 3, name = (null)&#125;2022-03-08 11:12:57.464903+0800 NSThread_Demo[4293:3074227] 2 -- &lt;NSThread: 0x283260080&gt;&#123;number = 4, name = (null)&#125;2022-03-08 11:12:59.468845+0800 NSThread_Demo[4293:3074225] 4 -- &lt;NSThread: 0x2832724c0&gt;&#123;number = 6, name = (null)&#125; æ·»åŠ ä¾èµ–123456789101112131415161718192021222324252627282930- (void)testOperationDependency&#123; NSOperationQueue * queue = [[NSOperationQueue alloc] init]; NSBlockOperation * bo1 = [NSBlockOperation blockOperationWithBlock:^&#123; [NSThread sleepForTimeInterval:0.5]; NSLog(@&quot;è¯·æ±‚token&quot;); &#125;]; NSBlockOperation * bo2 = [NSBlockOperation blockOperationWithBlock:^&#123; [NSThread sleepForTimeInterval:0.5]; NSLog(@&quot;æ‹¿ç€tokenï¼Œè¯·æ±‚æ•°æ®1&quot;); &#125;]; NSBlockOperation * bo3 = [NSBlockOperation blockOperationWithBlock:^&#123; [NSThread sleepForTimeInterval:0.5]; NSLog(@&quot;æ‹¿ç€æ•°æ®1ï¼Œè¯·æ±‚æ•°æ®2&quot;); &#125;]; [bo2 addDependency:bo1]; [bo3 addDependency:bo2]; [queue addOperations:@[bo1,bo2,bo3] waitUntilFinished:YES]; NSLog(@&quot;æ‰§è¡Œå®Œæˆäº†ï¼Ÿæˆ‘è¦å¹²å…¶ä»–äº‹æƒ…äº†&quot;);&#125;// æŸ¥çœ‹æ‰“å°ç»“æœ2022-03-08 11:17:14.425701+0800 NSThread_Demo[4295:3076256] è¯·æ±‚token2022-03-08 11:17:14.931254+0800 NSThread_Demo[4295:3076255] æ‹¿ç€tokenï¼Œè¯·æ±‚æ•°æ®12022-03-08 11:17:15.436695+0800 NSThread_Demo[4295:3076258] æ‹¿ç€æ•°æ®1ï¼Œè¯·æ±‚æ•°æ®22022-03-08 11:17:15.437079+0800 NSThread_Demo[4295:3076238] æ‰§è¡Œå®Œæˆäº†ï¼Ÿæˆ‘è¦å¹²å…¶ä»–äº‹æƒ…äº† çº¿ç¨‹é—´é€šè®¯123456789101112131415- (void)testOperationNoti&#123; NSOperationQueue * queue = [[NSOperationQueue alloc] init]; queue.name = @&quot;Felix&quot;; [queue addOperationWithBlock:^&#123; NSLog(@&quot;è¯·æ±‚ç½‘ç»œ%@ -- %@&quot;,[NSOperationQueue currentQueue],[NSThread currentThread]); [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123; NSLog(@&quot;åˆ·æ–°UI%@ -- %@&quot;,[NSOperationQueue currentQueue],[NSThread currentThread]); &#125;]; &#125;];&#125;// æŸ¥çœ‹æ‰“å°ç»“æœ2022-03-08 11:20:27.970126+0800 NSThread_Demo[4297:3077823] è¯·æ±‚ç½‘ç»œ&lt;NSOperationQueue: 0x10bd087d0&gt;&#123;name = &#x27;Felix&#x27;&#125; -- &lt;NSThread: 0x28206b140&gt;&#123;number = 4, name = (null)&#125;2022-03-08 11:20:27.976293+0800 NSThread_Demo[4297:3077803] åˆ·æ–°UI&lt;NSOperationQueue: 0x10d005570&gt;&#123;name = &#x27;NSOperationQueue Main Queue&#x27;&#125; -- &lt;_NSMainThread: 0x28206c880&gt;&#123;number = 1, name = main&#125;","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†26ï¼šGCDä¹‹å‡½æ•°ä¸é˜Ÿåˆ—","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†26ï¼šGCDä¹‹å‡½æ•°ä¸é˜Ÿåˆ—","date":"2021-03-10T06:45:48.000Z","updated":"2022-03-08T03:55:35.000Z","comments":true,"path":"2021/03/10/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†26ï¼šGCDä¹‹å‡½æ•°ä¸é˜Ÿåˆ—/","link":"","permalink":"https://www.bboyzj.cn/2021/03/10/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8626%EF%BC%9AGCD%E4%B9%8B%E5%87%BD%E6%95%B0%E4%B8%8E%E9%98%9F%E5%88%97/","excerpt":"","text":"GCDç®€ä»‹1ã€ä»€ä¹ˆæ˜¯GCDï¼Ÿ å…¨ç§°æ˜¯ Grand Central Dispatchï¼Œçº¯ C è¯­è¨€ï¼Œæä¾›äº†éå¸¸å¼ºå¤§çš„å‡½æ•° 2ã€GCD çš„ä¼˜åŠ¿ GCD æ˜¯è‹¹æœå…¬å¸ä¸ºå¤šæ ¸çš„å¹¶è¡Œè¿ç®—æå‡ºçš„è§£å†³æ–¹æ¡ˆ GCD ä¼šè‡ªåŠ¨åˆ©ç”¨æ›´å¤šçš„ CPU å†…æ ¸ï¼ˆæ¯”å¦‚åŒæ ¸ã€å››æ ¸ï¼‰ GCD ä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„å£°æ˜å‘¨æœŸï¼ˆåˆ›å»ºçº¿ç¨‹ã€è°ƒåº¦ä»»åŠ¡ã€é”€æ¯çº¿ç¨‹ï¼‰ ç¨‹åºå‘˜åªéœ€è¦å‘Šè¯‰ GCD æƒ³è¦æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ï¼Œä¸éœ€è¦ç¼–å†™ä»»ä½•çº¿ç¨‹ç®¡ç†ä»£ç  ã€é‡ç‚¹ã€‘ç”¨ä¸€å¥è¯æ€»ç»“ GCD ï¼š å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œå¹¶ä¸”æŒ‡å®šæ‰§è¡Œä»»åŠ¡çš„å‡½æ•°ã€‚ GCD æ ¸å¿ƒåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼ŒGCDä¸€èˆ¬å†™æˆä¸‹é¢çš„å½¢å¼ 123diaptch_async(dispatch_queue_create(&quot;com.zj.Queue&quot;,NULL)), ^&#123; NSLog(@&quot;GCDåŸºæœ¬ä½¿ç”¨&quot;)&#125;); å°†ä¸Šè¿°ä»£ç æ‹†åˆ†ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ¥ç†è§£ GCD çš„ æ ¸å¿ƒï¼Œä¸»è¦æ˜¯ç”± ä»»åŠ¡ + é˜Ÿåˆ— + å‡½æ•° æ„æˆ 123456789//*****GCDåŸºç¡€å†™æ³•*****// åˆ›å»ºä»»åŠ¡dispatch_block_t block= ^&#123; NSLog(@&quot;hello GCD&quot;);&#125;// åˆ›å»ºé˜Ÿåˆ—dispatch_queue_t queue = dispatch_queue_create(&quot;com.zj.Queue&quot;,NULL);// å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œå¹¶æŒ‡å®šå‡½æ•°æ‰§è¡Œdispatch_async(queue,block); dispatch_block_tï¼šåˆ›å»ºä»»åŠ¡ dispatch_queue_tï¼šåˆ›å»ºé˜Ÿåˆ— dispatch_asyncï¼šå‡½æ•° å‡½æ•°å’Œé˜Ÿåˆ—1ã€åœ¨GCDä¸­å‡½æ•°æŒ‰ç…§æ‰§è¡Œæ–¹å¼åˆ†ä¸º åŒæ­¥å‡½æ•° å’Œ å¼‚æ­¥å‡½æ•° åŒæ­¥å‡½æ•°ï¼šdispatch_sync å¿…é¡»ç­‰å¾…å½“å‰è¯­å¥æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ ä¸ä¼šå¼€å¯çº¿ç¨‹ï¼Œå³ä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ› åœ¨å½“å‰æ‰§è¡Œ block ä»»åŠ¡ å¼‚æ­¥å‡½æ•°ï¼šdispatch_async ä¼šå¼€å¯æ–°çš„çº¿ç¨‹æ‰§è¡Œ block ä»»åŠ¡ å¼‚æ­¥æ˜¯å¤šçº¿ç¨‹çš„ä»£åè¯ ç»¼ä¸Šæ‰€è¿°ï¼Œä¸¤ç§æ‰§è¡Œæ–¹å¼çš„ ä¸»è¦åŒºåˆ« æœ‰ä¸¤ç‚¹ï¼š æ˜¯å¦ç­‰å¾… é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯• æ˜¯å¦å…·å¤‡å¼€å¯æ–°çº¿ç¨‹ çš„èƒ½åŠ› 2ã€é˜Ÿåˆ— åœ¨GCDä¸­é˜Ÿåˆ—æ˜¯ç”¨æ¥ å­˜æ”¾ä»»åŠ¡ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ çº¿æ€§è¡¨ï¼Œéµå¾ª FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ åŸåˆ™ï¼Œæ–°ä»»åŠ¡æ€»æ˜¯è¢« æ’å…¥åˆ°é˜Ÿå°¾ï¼Œè€Œä»»åŠ¡çš„è¯»å–æ˜¯ä» é˜Ÿé¦–å¼€å§‹è¯»å–ï¼Œæ¯è¯»ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ™é˜Ÿåˆ—ä¸­é‡Šæ”¾ä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é˜Ÿåˆ—ä¸»è¦åˆ†ä¸º ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰ å’Œ å¹¶å‘é˜Ÿåˆ—(Concurrent Dispatch Queue) ä¸¤ç§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ä¸²è¡Œé˜Ÿåˆ—ï¼šæ¯æ¬¡ åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œç­‰å¾…ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œå³åªå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼ˆé€šä¿—ç†è§£ï¼šåŒä¸€æ—¶åˆ»åªè°ƒåº¦ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼‰ ä½¿ç”¨ dispatch_queue_create(&quot;xxx&quot;,DISPATCH_QUEUE_SERIAL) åˆ›å»ºä¸²è¡Œé˜Ÿåˆ— å…¶ä¸­ DISPATCH_QUEUE_SERIAL ä¹Ÿå¯ä»¥ç”¨ NULL è¡¨ç¤ºï¼Œè¿™ä¸¤ç§å‡è¡¨ç¤º é»˜è®¤çš„ä¸²è¡Œé˜Ÿåˆ— 1234// ä¸²è¡Œé˜Ÿåˆ—çš„è·å–æ–¹æ³•dispatch_queue_t serialQueue1 = dispatch_queue_create(&quot;com.ZJ.Queue&quot;,DISPATCH_QUQUQ_SERIAL);dispatch_quque_t serialQuquq2 = dispatch_ququq_create(&quot;com.ZJ.Queue&quot;,Null); å¹¶å‘é˜Ÿåˆ—ï¼šä¸€æ¬¡å¯ä»¥ å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå³ å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼ˆé€šä¿—ç†è§£ï¼šåŒæ„æ—¶åˆ»å¯ä»¥è°ƒåº¦å¤šä¸ªä»»åŠ¡æ‰§è¡Œï¼‰ ä½¿ç”¨ dispach_queue_create(&quot;xxx&quot;,DISPATCH_QUQUQ_CONCURRENT) åˆ›å»ºå¹¶å‘é˜Ÿåˆ— æ³¨æ„ï¼šå¹¶å‘é˜Ÿåˆ— çš„å¹¶å‘åŠŸèƒ½ åªæœ‰åœ¨å¼‚æ­¥å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ 12// å¹¶å‘é˜Ÿåˆ—çš„è·å–æ–¹æ³•dispatch_quque_t concurrentQueue = dispatch_quque_create(&quot;com.ZJ.Queue&quot;,DISPATCH_QUQUE_CONCURRENT); ä¸»é˜Ÿåˆ— å’Œ å…¨å±€å¹¶å‘é˜Ÿåˆ—åœ¨GCDä¸­ï¼Œé’ˆå¯¹è¿™ä¸¤ç§é˜Ÿåˆ—ï¼Œåˆ†åˆ«æä¾›äº† ä¸»é˜Ÿåˆ—ï¼ˆMain Dispatch Queueï¼‰ å’Œ å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼ˆGlobal Dispatch Queueï¼‰ ä¸»é˜Ÿåˆ—ï¼ˆMain Dispatch Queueï¼‰ï¼šGCD ä¸­æä¾›çš„ ç‰¹æ®Šçš„ä¸²è¡Œé˜Ÿåˆ— ä¸“é—¨ç”¨æ¥ åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒåº¦ä»»åŠ¡çš„ä¸²è¡Œé˜Ÿåˆ—ï¼Œä¾èµ–äºä¸»çº¿ç¨‹ã€ä¸»Runloopï¼Œåœ¨mainå‡½æ•°è°ƒç”¨ä¹‹å‰ è‡ªåŠ¨åˆ›å»º ä¸ä¼šå¼€å¯çº¿ç¨‹ å¦‚æœå½“å‰ä¸»çº¿ç¨‹æ­£åœ¨æœ‰ä»»åŠ¡æ‰§è¡Œï¼Œé‚£ä¹ˆæ— è®ºä¸»é˜Ÿåˆ—ä¸­å½“å‰è¢«æ·»åŠ äº†ä»€ä¹ˆä»»åŠ¡ï¼Œéƒ½ä¸ä¼šè¢«è°ƒç”¨ ä½¿ç”¨ dispatch_get_main_queue() è·å¾— ä¸»é˜Ÿåˆ— é€šå¸¸åœ¨è¿”å› ä¸»çº¿ç¨‹ æ›´æ–°UI æ—¶ä½¿ç”¨ 12// ä¸»é˜Ÿåˆ—çš„è·å–æ–¹æ³•dispatch_queue_t mainQueue = dispatch_get_main_queue(); å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼ˆGlobal Dispatch Queueï¼‰ï¼šGCD æä¾›çš„é»˜è®¤çš„ å¹¶å‘é˜Ÿåˆ— ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ï¼Œè‹¹æœæä¾›äº†å…¨å±€é˜Ÿåˆ— åœ¨ä½¿ç”¨å¤šçº¿ç¨‹å¼€å‘æ—¶ï¼Œå¦‚æœå¯¹é˜Ÿåˆ—æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œåœ¨æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å…¨å±€é˜Ÿåˆ— ä½¿ç”¨ dispatch_get_global_queue è·å–å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œæœ€ç®€å•çš„æ˜¯ dispatch_get_global_queue(0,0) ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤º é˜Ÿåˆ—ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¼˜å…ˆçº§æœª DISPATCH_QUEUE_PRIORITY_DEFAULT=0ï¼Œåœ¨iOS9ä¹‹åï¼Œå·²ç»è¢« æœåŠ¡è´¨é‡ï¼ˆquality-of-serviceï¼‰ å–ä»£ ç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨ 0 12345678// å…¨é›†å¹¶å‘é˜Ÿåˆ—çš„è·å–æ–¹æ³•dispatch_queue_t globalQueue = dispatch_get_global_queue(0,0);// ä¼˜å…ˆçº§ä»é«˜åˆ°åº•ï¼ˆå¯¹åº”çš„æœåŠ¡è´¨é‡ï¼‰ä¾æ¬¡ä¸º- DISPATCH_QUEUE_PRIORITY_HIGH: QOS_CLASS_USER_INITIATED- DISPATCH_QUEUE_PRIORITY_DEFAULT: QOS_CLASS_DEFAULT- DISPATCH_QUEUE_PRIORITY_LOW: QOS_CLASS_UTILITY- DISPATCH_QUEUE_PRIORITY_BACKGROUND: QOS_CLASS_BACKGROUND å…¨å±€å¹¶å‘é˜Ÿåˆ— + ä¸»é˜Ÿåˆ— é…åˆä½¿ç”¨åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œ å…¨å±€é˜Ÿåˆ— + å¹¶å‘é˜Ÿåˆ— ä¸€èˆ¬æ˜¯è¿™æ ·é…åˆä½¿ç”¨çš„ 1234567// ä¸»é˜Ÿåˆ— + å…¨å±€å¹¶å‘é˜Ÿåˆ— çš„æ—¥å¸¸ä½¿ç”¨dispatch_async(dispatch_get_global_queue(0,0), ^&#123; // æ‰§è¡Œè€—æ—¶æ“ä½œ dispatch_async(dispatch_get_main_queue(),^&#123; // å›åˆ°ä¸»çº¿ç¨‹è¿›è¡ŒUIæ“ä½œ &#125;);&#125;); å‡½æ•°ä¸é˜Ÿåˆ—çš„ä¸åŒç»„åˆ ä¸²è¡Œé˜Ÿåˆ— + åŒæ­¥å‡½æ•° ã€ä»»åŠ¡ æŒ‰é¡ºåºæ‰§è¡Œã€‘ï¼šä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä¸ä¼šå¼€è¾Ÿæ–°çº¿ç¨‹ 12345678910// ä¸²è¡Œé˜Ÿåˆ— + åŒæ­¥å‡½æ•°- (void)test1&#123; NSLog(@&quot;ä¸²è¡Œ + åŒæ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t serialQueue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_SERIAL); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_sync(serialQueue, ^&#123; NSLog(@&quot;ä¸²è¡Œ + åŒæ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 1234562022-01-12 15:13:39.595134+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4500:155055] ä¸²è¡Œ + åŒæ­¥ï¼š&lt;_NSMainThread: 0x6000025d00c0&gt;&#123;number = 1, name = main&#125;2022-01-12 15:13:39.595275+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4500:155055] ä¸²è¡Œ + åŒæ­¥ï¼š0 - &lt;_NSMainThread: 0x6000025d00c0&gt;&#123;number = 1, name = main&#125;2022-01-12 15:13:39.595388+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4500:155055] ä¸²è¡Œ + åŒæ­¥ï¼š1 - &lt;_NSMainThread: 0x6000025d00c0&gt;&#123;number = 1, name = main&#125;2022-01-12 15:13:39.595512+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4500:155055] ä¸²è¡Œ + åŒæ­¥ï¼š2 - &lt;_NSMainThread: 0x6000025d00c0&gt;&#123;number = 1, name = main&#125;2022-01-12 15:13:39.595639+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4500:155055] ä¸²è¡Œ + åŒæ­¥ï¼š3 - &lt;_NSMainThread: 0x6000025d00c0&gt;&#123;number = 1, name = main&#125;2022-01-12 15:13:39.595759+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4500:155055] ä¸²è¡Œ + åŒæ­¥ï¼š4 - &lt;_NSMainThread: 0x6000025d00c0&gt;&#123;number = 1, name = main&#125; ä¸²è¡Œé˜Ÿåˆ— + å¼‚æ­¥å‡½æ•° ã€ä»»åŠ¡ æŒ‰é¡ºåºæ‰§è¡Œã€‘ï¼šä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¼š å¼€è¾Ÿæ–°çº¿ç¨‹ 12345678910// ä¸²è¡Œé˜Ÿåˆ— + å¼‚æ­¥å‡½æ•°- (void)test2&#123; NSLog(@&quot;ä¸²è¡Œ + å¼‚æ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t serialQueue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, NULL); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_async(serialQueue, ^&#123; NSLog(@&quot;ä¸²è¡Œ + å¼‚æ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 1234562022-01-12 15:20:12.884840+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4590:160591] ä¸²è¡Œ + å¼‚æ­¥ï¼š&lt;_NSMainThread: 0x600000ee4140&gt;&#123;number = 1, name = main&#125;2022-01-12 15:20:12.885010+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4590:160734] ä¸²è¡Œ + å¼‚æ­¥ï¼š0 - &lt;NSThread: 0x600000eb01c0&gt;&#123;number = 3, name = (null)&#125;2022-01-12 15:20:12.885136+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4590:160734] ä¸²è¡Œ + å¼‚æ­¥ï¼š1 - &lt;NSThread: 0x600000eb01c0&gt;&#123;number = 3, name = (null)&#125;2022-01-12 15:20:12.885262+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4590:160734] ä¸²è¡Œ + å¼‚æ­¥ï¼š2 - &lt;NSThread: 0x600000eb01c0&gt;&#123;number = 3, name = (null)&#125;2022-01-12 15:20:12.885392+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4590:160734] ä¸²è¡Œ + å¼‚æ­¥ï¼š3 - &lt;NSThread: 0x600000eb01c0&gt;&#123;number = 3, name = (null)&#125;2022-01-12 15:20:12.885538+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4590:160734] ä¸²è¡Œ + å¼‚æ­¥ï¼š4 - &lt;NSThread: 0x600000eb01c0&gt;&#123;number = 3, name = (null)&#125; å¹¶å‘é˜Ÿåˆ— + åŒæ­¥å‡½æ•° ã€ä»»åŠ¡ æŒ‰é¡ºåºæ‰§è¡Œã€‘ï¼šä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ 12345678910// å¹¶å‘é˜Ÿåˆ— + åŒæ­¥å‡½æ•°- (void)test3&#123; NSLog(@&quot;å¹¶å‘ + åŒæ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_CONCURRENT); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_sync(serialQueue, ^&#123; NSLog(@&quot;å¹¶å‘ + åŒæ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 12345622-01-12 15:23:15.939687+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4630:163688] å¹¶å‘ + åŒæ­¥ï¼š&lt;_NSMainThread: 0x600000de8000&gt;&#123;number = 1, name = main&#125;2022-01-12 15:23:15.939830+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4630:163688] å¹¶å‘ + åŒæ­¥ï¼š0 - &lt;_NSMainThread: 0x600000de8000&gt;&#123;number = 1, name = main&#125;2022-01-12 15:23:15.939922+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4630:163688] å¹¶å‘ + åŒæ­¥ï¼š1 - &lt;_NSMainThread: 0x600000de8000&gt;&#123;number = 1, name = main&#125;2022-01-12 15:23:15.940014+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4630:163688] å¹¶å‘ + åŒæ­¥ï¼š2 - &lt;_NSMainThread: 0x600000de8000&gt;&#123;number = 1, name = main&#125;2022-01-12 15:23:15.940102+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4630:163688] å¹¶å‘ + åŒæ­¥ï¼š3 - &lt;_NSMainThread: 0x600000de8000&gt;&#123;number = 1, name = main&#125;2022-01-12 15:23:15.940217+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4630:163688] å¹¶å‘ + åŒæ­¥ï¼š4 - &lt;_NSMainThread: 0x600000de8000&gt;&#123;number = 1, name = main&#125; å¹¶å‘é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•° ã€ä»»åŠ¡ ä¹±åºæ‰§è¡Œã€‘ï¼šä»»åŠ¡æ‰§è¡Œæ— é¡ºåºï¼Œä¼š å¼€è¾Ÿæ–°çº¿ç¨‹ 12345678910// å¹¶å‘é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•°- (void)test4&#123; NSLog(@&quot;å¹¶å‘ + å¼‚æ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_CONCURRENT); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_async(serialQueue, ^&#123; NSLog(@&quot;å¹¶å‘ + å¼‚æ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 1234562022-01-12 15:26:35.249949+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4716:166604] å¹¶å‘ + å¼‚æ­¥ï¼š&lt;_NSMainThread: 0x600003344740&gt;&#123;number = 1, name = main&#125;2022-01-12 15:26:35.250144+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4716:166729] å¹¶å‘ + å¼‚æ­¥ï¼š0 - &lt;NSThread: 0x60000332c100&gt;&#123;number = 7, name = (null)&#125;2022-01-12 15:26:35.250153+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4716:166735] å¹¶å‘ + å¼‚æ­¥ï¼š1 - &lt;NSThread: 0x600003300d40&gt;&#123;number = 6, name = (null)&#125;2022-01-12 15:26:35.250174+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4716:166734] å¹¶å‘ + å¼‚æ­¥ï¼š3 - &lt;NSThread: 0x60000330f0c0&gt;&#123;number = 4, name = (null)&#125;2022-01-12 15:26:35.250238+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4716:166731] å¹¶å‘ + å¼‚æ­¥ï¼š4 - &lt;NSThread: 0x600003328040&gt;&#123;number = 8, name = (null)&#125;2022-01-12 15:26:35.250277+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[4716:166733] å¹¶å‘ + å¼‚æ­¥ï¼š2 - &lt;NSThread: 0x600003305c40&gt;&#123;number = 3, name = (null)&#125; ä¸»é˜Ÿåˆ— + åŒæ­¥å‡½æ•° ã€é€ æˆ æ­»é”ã€‘ï¼šä»»åŠ¡ ç›¸äº’ç­‰å¾…ï¼Œé€ æˆ æ­»é” é€ æˆæ­»é”çš„åŸå› åˆ†æå¦‚ä¸‹ï¼š ä¸»é˜Ÿåˆ—æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œé¡ºåºä¸ºï¼š NSLogä»»åŠ¡ - åŒæ­¥block æ‰§è¡ŒNSLogä»»åŠ¡åï¼Œæ‰§è¡ŒåŒæ­¥çš„blockï¼Œä¼šå°† ä»»åŠ¡1ï¼ˆå³ i=1ï¼‰ åŠ å…¥åˆ°ä¸»é˜Ÿåˆ—ï¼Œä¸»é˜Ÿåˆ—é¡ºåºä¸º ï¼šNSLogä»»åŠ¡ - åŒæ­¥block - ä»»åŠ¡1 ä»»åŠ¡1 çš„æ‰§è¡Œéœ€è¦ ç­‰å¾…åŒæ­¥blockæ‰§è¡Œå®Œæ¯• æ‰ä¼šæ‰§è¡Œï¼Œè€Œ åŒæ­¥block çš„æ‰§è¡Œéœ€è¦ ç­‰å¾…ä»»åŠ¡1æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥å°±é€ æˆäº† äº’ç›¸ç­‰å¾… çš„æƒ…å†µï¼Œå³é€ æˆ æ­»é”å´©æºƒã€‚ ã€æ­»é”ç°è±¡ã€‘ ä¸»çº¿ç¨‹ å› ä¸ºä½  åŒæ­¥å‡½æ•° çš„åŸå›  ç­‰ç€å…ˆæ‰§è¡Œä»»åŠ¡ ä¸»é˜Ÿåˆ—ç­‰ç€ä¸»çº¿ç¨‹çš„ä»»åŠ¡ æ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ ä¸»é˜Ÿåˆ—å’Œä¸»çº¿ç¨‹ç›¸äº’ç­‰å¾… ä¼šé€ æˆæ­»é” ä¸»é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•° ã€ä»»åŠ¡ æŒ‰é¡ºåºæ‰§è¡Œã€‘ï¼šä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¸å¼€è¾Ÿçº¿ç¨‹ 12345678910// ä¸»é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•°- (void)test6&#123; NSLog(@&quot;ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t mainQueue = dispatch_get_main_queue(); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_async(mainQueue, ^&#123; NSLog(@&quot;ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 1234562022-01-12 16:27:53.197940+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[5926:204672] ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š&lt;_NSMainThread: 0x600001880000&gt;&#123;number = 1, name = main&#125;2022-01-12 16:27:53.213528+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[5926:204672] ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š0 - &lt;_NSMainThread: 0x600001880000&gt;&#123;number = 1, name = main&#125;2022-01-12 16:27:53.213718+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[5926:204672] ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š1 - &lt;_NSMainThread: 0x600001880000&gt;&#123;number = 1, name = main&#125;2022-01-12 16:27:53.213879+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[5926:204672] ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š2 - &lt;_NSMainThread: 0x600001880000&gt;&#123;number = 1, name = main&#125;2022-01-12 16:27:53.214016+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[5926:204672] ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š3 - &lt;_NSMainThread: 0x600001880000&gt;&#123;number = 1, name = main&#125;2022-01-12 16:27:53.214196+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[5926:204672] ä¸»é˜Ÿåˆ— + å¼‚æ­¥ï¼š4 - &lt;_NSMainThread: 0x600001880000&gt;&#123;number = 1, name = main&#125; å…¨å±€å¹¶å‘é˜Ÿåˆ— + åŒæ­¥å‡½æ•° ã€ä»»åŠ¡ æŒ‰é¡ºåºæ‰§è¡Œã€‘ï¼šä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ‰§è¡Œï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ 12345678910// å…¨å±€å¹¶å‘é˜Ÿåˆ— + åŒæ­¥å‡½æ•°- (void)test7&#123; NSLog(@&quot;å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t globalQueue = dispatch_get_global_queue(0, 0); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_sync(globalQueue, ^&#123; NSLog(@&quot;å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 1234562022-01-12 16:32:08.207844+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6000:209221] å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š&lt;_NSMainThread: 0x60000031c140&gt;&#123;number = 1, name = main&#125;2022-01-12 16:32:08.207992+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6000:209221] å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š0 - &lt;_NSMainThread: 0x60000031c140&gt;&#123;number = 1, name = main&#125;2022-01-12 16:32:08.208098+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6000:209221] å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š1 - &lt;_NSMainThread: 0x60000031c140&gt;&#123;number = 1, name = main&#125;2022-01-12 16:32:08.208280+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6000:209221] å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š2 - &lt;_NSMainThread: 0x60000031c140&gt;&#123;number = 1, name = main&#125;2022-01-12 16:32:08.208400+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6000:209221] å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š3 - &lt;_NSMainThread: 0x60000031c140&gt;&#123;number = 1, name = main&#125;2022-01-12 16:32:08.208504+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6000:209221] å…¨å±€å¹¶å‘ + åŒæ­¥ï¼š4 - &lt;_NSMainThread: 0x60000031c140&gt;&#123;number = 1, name = main&#125; å…¨å±€å¹¶å‘é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•° ã€ä»»åŠ¡ ä¹±åºæ‰§è¡Œã€‘ï¼šä»»åŠ¡ä¹±åºæ‰§è¡Œï¼Œä¼šå¼€è¾Ÿæ–°çº¿ç¨‹ 12345678910// å…¨å±€å¹¶å‘é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•°- (void)test8&#123; NSLog(@&quot;å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š%@&quot;,[NSThread currentThread]); dispatch_queue_t globalQueue = dispatch_get_global_queue(0, 0); for (int i = 0; i &lt; 5; i ++) &#123; dispatch_async(globalQueue, ^&#123; NSLog(@&quot;å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š%d - %@&quot;,i,[NSThread currentThread]); &#125;); &#125;&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 1234562022-01-12 16:34:18.147614+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6082:211916] å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š&lt;_NSMainThread: 0x600002cd8340&gt;&#123;number = 1, name = main&#125;2022-01-12 16:34:18.147839+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6082:212058] å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š1 - &lt;NSThread: 0x600002cdcdc0&gt;&#123;number = 4, name = (null)&#125;2022-01-12 16:34:18.147859+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6082:212057] å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š0 - &lt;NSThread: 0x600002c97640&gt;&#123;number = 3, name = (null)&#125;2022-01-12 16:34:18.147880+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6082:212052] å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š2 - &lt;NSThread: 0x600002cb9140&gt;&#123;number = 7, name = (null)&#125;2022-01-12 16:34:18.147880+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6082:212053] å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š3 - &lt;NSThread: 0x600002c972c0&gt;&#123;number = 5, name = (null)&#125;2022-01-12 16:34:18.147892+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6082:212055] å…¨å±€å¹¶å‘ + å¼‚æ­¥ï¼š4 - &lt;NSThread: 0x600002c80000&gt;&#123;number = 8, name = (null)&#125; æ€»ç»“ å‡½æ•°\\é˜Ÿåˆ— ä¸²è¡Œé˜Ÿåˆ— å¹¶å‘é˜Ÿåˆ— ä¸»é˜Ÿåˆ— å…¨å±€å¹¶å‘é˜Ÿåˆ— åŒæ­¥å‡½æ•° é¡ºåºæ‰§è¡Œï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ é¡ºåºæ‰§è¡Œï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ æ­»é” é¡ºåºæ‰§è¡Œï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ å¼‚æ­¥å‡½æ•° é¡ºåºæ‰§è¡Œï¼Œå¼€è¾Ÿæ–°çº¿ç¨‹ ä¹±åºæ‰§è¡Œï¼Œå¼€è¾Ÿæ–°çº¿ç¨‹ é¡ºåºæ‰§è¡Œï¼Œä¸å¼€ç ´æ–°çº¿ç¨‹ ä¹±åºæ‰§è¡Œï¼Œå¼€è¾Ÿå…ˆçº¿ç¨‹ ç›¸å…³é¢è¯•é¢˜è§£æ ã€é¢è¯•é¢˜-1ã€‘ï¼šå¹¶è¡Œé˜Ÿåˆ— + å¼‚æ­¥å‡½æ•° ä¸‹é¢ä»£ç çš„è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ 123456789101112131415- (void)interview01&#123; // å¹¶å‘é˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_CONCURRENT); NSLog(@&quot;1 %@&quot;,[NSThread currentThread]); // è€—æ—¶ dispatch_async(queue, ^&#123; NSLog(@&quot;2 %@&quot;,[NSThread currentThread]); // è€—æ—¶ dispatch_async(queue, ^&#123; NSLog(@&quot;3 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;4 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;5 %@&quot;,[NSThread currentThread]);&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 123452022-01-12 16:50:01.867461+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6319:225209] 1 &lt;_NSMainThread: 0x6000023f4840&gt;&#123;number = 1, name = main&#125;2022-01-12 16:50:01.867626+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6319:225209] 5 &lt;_NSMainThread: 0x6000023f4840&gt;&#123;number = 1, name = main&#125;2022-01-12 16:50:01.867695+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6319:225342] 2 &lt;NSThread: 0x600002399ec0&gt;&#123;number = 6, name = (null)&#125;2022-01-12 16:50:01.867840+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6319:225342] 4 &lt;NSThread: 0x600002399ec0&gt;&#123;number = 6, name = (null)&#125;2022-01-12 16:50:01.867852+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[6319:225345] 3 &lt;NSThread: 0x6000023a8b00&gt;&#123;number = 4, name = (null)&#125; å¼‚æ­¥å‡½æ•° å¹¶ ä¸ä¼šé˜»å¡ ä¸»é˜Ÿåˆ—ï¼Œä¼šå¼€è¾Ÿæ–°çº¿ç¨‹ æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ ä»£ç åˆ†æï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢çº¿è¡¨ç¤ºä»»åŠ¡çš„æ‰§è¡Œé¡ºåº ä¸»çº¿ç¨‹ çš„ä»»åŠ¡é˜Ÿåˆ—ä¸ºï¼šä»»åŠ¡1ã€å¼‚æ­¥block1ã€ä»»åŠ¡5ï¼Œå…¶ä¸­ å¼‚æ­¥block1 ä¼šæ¯”è¾ƒè€—è´¹æ€§èƒ½ï¼Œä»»åŠ¡1 å’Œ ä»»åŠ¡5 çš„ä»»åŠ¡å¤æ‚åº¦æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ ä»»åŠ¡1 å’Œ ä»»åŠ¡5 ä¼˜å…ˆäº å¼‚æ­¥block1 æ‰§è¡Œ åœ¨ å¼‚æ­¥block1 ä¸­ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸ºï¼šä»»åŠ¡2ã€å¼‚æ­¥block2ã€ä»»åŠ¡4ï¼Œå…¶ä¸­ block2 ç›¸å¯¹æ¯”è¾ƒè€—è´¹æ€§èƒ½ï¼Œä»»åŠ¡2 å’Œ ä»»åŠ¡4 å¤æ‚åº¦ä¸€æ ·ï¼Œæ‰€ä»¥ ä»»åŠ¡2 å’Œ ä»»åŠ¡4 ä¼˜å…ˆäº block2 æ‰§è¡Œ æœ€åæ‰§è¡Œ block2 ä¸­çš„ ä»»åŠ¡3 åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç° ä»»åŠ¡2 ä¼˜å…ˆ ä»»åŠ¡1 å’Œ ä»»åŠ¡5 æ‰§è¡Œï¼ŒåŸå› æ˜¯å‡ºç°äº†å½“å‰ä¸»çº¿ç¨‹å¡é¡¿æˆ–è€…å»¶è¿Ÿ çš„æƒ…å†µ ä»£ç ä¿®æ”¹ ã€ä¿®æ”¹1ã€‘ï¼šå°† å¹¶è¡Œé˜Ÿåˆ— æ”¹æˆ ä¸²è¡Œé˜Ÿåˆ—ï¼Œå¯¹ç»“æœæ²¡æœ‰ä»»ä½•å½±å“ï¼Œé¡ºåºä»ç„¶æ˜¯ 15243 ã€ä¿®æ”¹2ã€‘ï¼šåœ¨ ä»»åŠ¡5 ä¹‹å‰ï¼Œä¼‘çœ 2sï¼Œå³ sleep(2)ï¼Œæ‰§è¡Œçš„é¡ºåºä¸ºï¼š12435ï¼ŒåŸå› æ˜¯å› ä¸º I&#x2F;O çš„æ‰“å°ï¼Œç›¸æ¯”äºä¼‘çœ  2sï¼Œå¤æ‚åº¦æ›´ç®€å•ï¼Œæ‰€ä»¥ å¼‚æ­¥block1 ä¼šä¼˜å…ˆäºä»»åŠ¡5æ‰§è¡Œã€‚å½“ç„¶å¦‚æœä¸»é˜Ÿåˆ—é˜»å¡ï¼Œä¼šå‡ºç°å…¶ä»–çš„æ‰§è¡Œé¡ºåºã€‚ ã€é¢è¯•é¢˜-2ã€‘ï¼šå¹¶å‘é˜Ÿåˆ— + å¼‚æ­¥å‡½æ•°åµŒå¥—åŒæ­¥å‡½æ•° ä¸‹é¢ä»£ç çš„è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ 123456789101112131415- (void)interview2&#123; // å¹¶å‘é˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_CONCURRENT); NSLog(@&quot;1 %@&quot;,[NSThread currentThread]); //å¼‚æ­¥å‡½æ•° dispatch_async(queue, ^&#123; NSLog(@&quot;2 %@&quot;,[NSThread currentThread]); // åŒæ­¥å‡½æ•° dispatch_sync(queue, ^&#123; NSLog(@&quot;3 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;4 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;5 %@&quot;,[NSThread currentThread]);&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ 123452022-01-12 17:37:11.034204+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[7126:263322] 1 &lt;_NSMainThread: 0x600000074300&gt;&#123;number = 1, name = main&#125;2022-01-12 17:37:11.034340+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[7126:263322] 5 &lt;_NSMainThread: 0x600000074300&gt;&#123;number = 1, name = main&#125;2022-01-12 17:37:11.034378+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[7126:263438] 2 &lt;NSThread: 0x600000039c40&gt;&#123;number = 3, name = (null)&#125;2022-01-12 17:37:11.034494+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[7126:263438] 3 &lt;NSThread: 0x600000039c40&gt;&#123;number = 3, name = (null)&#125;2022-01-12 17:37:11.034625+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[7126:263438] 4 &lt;NSThread: 0x600000039c40&gt;&#123;number = 3, name = (null)&#125; ä»£ç åˆ†æï¼š ä»»åŠ¡1ã€block1ã€ä»»åŠ¡5 çš„åˆ†æå’Œå‰é¢ä¸€è‡´ï¼Œæ‰§è¡Œé¡ºåºä¸ºï¼šä»»åŠ¡1 ä»»åŠ¡5 block1 åœ¨ å¼‚æ­¥block1 ä¸­ï¼Œä»»åŠ¡2ã€block2ã€ä»»åŠ¡4 çš„æ‰§è¡Œé¡ºåºï¼Œç”±äº block2 æ˜¯åŒæ­¥å‡½æ•°ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥ ä»»åŠ¡4 éœ€è¦ç­‰å¾… block2 ä¸­çš„ ä»»åŠ¡3 æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥å¼‚æ­¥blockä¸­çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼šä»»åŠ¡2ã€ä»»åŠ¡3ã€ä»»åŠ¡4 ã€é¢è¯•é¢˜-3ã€‘ï¼šä¸²è¡Œé˜Ÿåˆ— + å¼‚æ­¥å‡½æ•°åµŒå¥—åŒæ­¥å‡½æ•° ä¸‹é¢ä»£ç çš„è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ 123456789101112131415- (void)interview3&#123; // ä¸²è¡Œé˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_SERIAL); NSLog(@&quot;1 %@&quot;,[NSThread currentThread]); //å¼‚æ­¥å‡½æ•° dispatch_async(queue, ^&#123; NSLog(@&quot;2 %@&quot;,[NSThread currentThread]); // åŒæ­¥å‡½æ•° dispatch_sync(queue, ^&#123; NSLog(@&quot;3 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;4 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;5 %@&quot;,[NSThread currentThread]);&#125; è¿è¡Œä»£ç ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœå¦‚ä¸‹ åˆ†æï¼š å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²ä»£è¡¨ä»»åŠ¡æ‰§è¡Œé¡ºåºï¼Œé»„è‰²çº¿è¡¨ç¤ºç­‰å¾… é¦–å…ˆï¼Œåœ¨ä¸»çº¿ç¨‹ä¸Šæœ‰ ä»»åŠ¡1ã€å¼‚æ­¥blockã€ä»»åŠ¡5ï¼Œé¦–å…ˆæ‰§è¡Œ ä»»åŠ¡1ï¼Œç”±äº å¼‚æ­¥block å¤æ‚åº¦é«˜äº ä»»åŠ¡5ï¼Œå› æ­¤ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ ä»»åŠ¡1 -&gt; ä»»åŠ¡5 -&gt; å¼‚æ­¥block åœ¨å¼‚æ­¥blockä¸­ï¼Œå¼€å¯äº†æ–°çš„çº¿ç¨‹ï¼Œæ‰§è¡Œé¡ºåºé¦–å…ˆæ˜¯ ä»»åŠ¡2ï¼Œç„¶åæ˜¯ åŒæ­¥blockï¼ŒåŒæ­¥å‡½æ•°ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥æ‰§è¡Œ ä»»åŠ¡4 éœ€è¦ ç­‰å¾…ä»»åŠ¡3å®Œæˆï¼Œç”±äº ä»»åŠ¡3çš„æ‰§è¡Œï¼Œéœ€è¦ ç­‰å¾…å¼‚æ­¥blockå®Œæˆï¼Œå¼‚æ­¥blockå®Œæˆéœ€è¦ ç­‰å¾…ä»»åŠ¡4å®Œæˆï¼Œ å› æ­¤å°±ä¼šé€ æˆ ä»»åŠ¡4ç­‰å¾…ä»»åŠ¡3ï¼Œä»»åŠ¡3ç­‰å¾…ä»»åŠ¡4ï¼Œå³ äº’ç›¸ç­‰å¾… çš„å±€é¢ï¼Œå°±ä¼šé€ æˆ æ­»é”ï¼Œè¿™é‡Œæœ‰ä¸ªé‡ç‚¹æ˜¯ å…³é”®çš„å †æ ˆslow ä¿®æ”¹ å»æ‰ä»»åŠ¡4ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ è¿˜æ˜¯ä¼šæ­»é”ï¼Œå› ä¸º ä»»åŠ¡3ç­‰å¾…çš„æ˜¯å¼‚æ­¥blockæ‰§è¡Œå®Œæ¯•ï¼Œè€Œå¼‚æ­¥blockç­‰å¾…ä»»åŠ¡3å®Œæˆ 4ã€ã€é¢è¯•é¢˜4-æ–°æµªã€‘ï¼šå¼‚æ­¥å‡½æ•° + åŒæ­¥å‡½æ•° + å¹¶å‘é˜Ÿåˆ— ä¸‹é¢ä»£ç æ‰§è¡Œçš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆç­”æ¡ˆæ˜¯ACï¼‰Aï¼š1230789Bï¼š1237890Cï¼š3120798Dï¼š2137890 12345678910111213141516171819202122232425262728- (void)interview04&#123; // å¹¶å‘é˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_CONCURRENT); dispatch_async(queue, ^&#123; // è€—æ—¶ NSLog(@&quot;1 %@&quot;,[NSThread currentThread]); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;2 %@&quot;,[NSThread currentThread]); &#125;); // åŒæ­¥ dispatch_sync(queue, ^&#123; NSLog(@&quot;3 %@&quot;,[NSThread currentThread]); &#125;); NSLog(@&quot;0 %@&quot;,[NSThread currentThread]); dispatch_async(queue, ^&#123; NSLog(@&quot;7 %@&quot;,[NSThread currentThread]); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;8 %@&quot;,[NSThread currentThread]); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;9 %@&quot;,[NSThread currentThread]); &#125;);&#125; æ‰“å°ç»“æœæ˜¯ï¼š ï¼ˆ1ã€2ã€3æ— åºï¼‰ 0 ï¼ˆ7ã€8ã€9æ— åºï¼‰ï¼Œå¯ä»¥ç¡®å®šçš„ 0 ä¸€å®šåœ¨ 3 ä¹‹åï¼Œ åœ¨789ä¹‹å‰ åˆ†æï¼š ä»»åŠ¡1 å’Œ ä»»åŠ¡2 æ˜¯ç”±äº å¼‚æ­¥å‡½æ•° + å¹¶å‘é˜Ÿåˆ—ï¼Œä¼šå¼€å¯çº¿ç¨‹ï¼Œæ‰€ä»¥æ²¡æœ‰å›ºå®šé¡ºåº ä»»åŠ¡7ã€ä»»åŠ¡8ã€ä»»åŠ¡9åŒç†ï¼Œä¼šå¼€å¯çº¿ç¨‹ï¼Œæ‰€ä»¥æ²¡æœ‰å›ºå®šé¡ºåº ä»»åŠ¡3 æ˜¯ åŒæ­¥å‡½æ•° + å¹¶å‘é˜Ÿåˆ—ï¼ŒåŒæ­¥å‡½æ•°ä¼š é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ä¹Ÿåªä¼šé˜»å¡0ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ç¡®å®šçš„æ˜¯ 0ä¸€å®šåœ¨3ä¹‹åï¼Œåœ¨789ä¹‹å‰ ä»¥ä¸‹æ˜¯ä¸åŒçš„æ‰“å°ç»“æœï¼š 12345672022-01-14 14:45:42.843292+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775240] 3 &lt;_NSMainThread: 0x600001198a00&gt;&#123;number = 1, name = main&#125;2022-01-14 14:45:42.843329+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775341] 1 &lt;NSThread: 0x600001189cc0&gt;&#123;number = 5, name = (null)&#125;2022-01-14 14:45:42.843361+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775340] 2 &lt;NSThread: 0x600001195a40&gt;&#123;number = 7, name = (null)&#125;2022-01-14 14:45:42.843415+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775240] 0 &lt;_NSMainThread: 0x600001198a00&gt;&#123;number = 1, name = main&#125;2022-01-14 14:45:42.843546+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775340] 7 &lt;NSThread: 0x600001195a40&gt;&#123;number = 7, name = (null)&#125;2022-01-14 14:45:42.843628+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775341] 8 &lt;NSThread: 0x600001189cc0&gt;&#123;number = 5, name = (null)&#125;2022-01-14 14:45:42.843653+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18838:775343] 9 &lt;NSThread: 0x60000119ce80&gt;&#123;number = 6, name = (null)&#125; 123456782022-01-14 14:50:18.831754+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:780910] 3 &lt;_NSMainThread: 0x600000054a00&gt;&#123;number = 1, name = main&#125;2022-01-14 14:50:18.831835+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:781015] 2 &lt;NSThread: 0x600000010e00&gt;&#123;number = 6, name = (null)&#125;2022-01-14 14:50:18.831801+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:781016] 1 &lt;NSThread: 0x600000052340&gt;&#123;number = 5, name = (null)&#125;2022-01-14 14:50:18.831887+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:780910] 0 &lt;_NSMainThread: 0x600000054a00&gt;&#123;number = 1, name = main&#125;2022-01-14 14:50:18.832053+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:781016] 7 &lt;NSThread: 0x600000052340&gt;&#123;number = 5, name = (null)&#125;2022-01-14 14:50:18.832058+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:781015] 8 &lt;NSThread: 0x600000010e00&gt;&#123;number = 6, name = (null)&#125;2022-01-14 14:50:18.832082+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18899:781019] 9 &lt;NSThread: 0x600000011b80&gt;&#123;number = 3, name = (null)&#125; 12345672022-01-14 14:51:47.433576+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784384] 3 &lt;_NSMainThread: 0x6000030280c0&gt;&#123;number = 1, name = main&#125;2022-01-14 14:51:47.433577+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784516] 2 &lt;NSThread: 0x6000030741c0&gt;&#123;number = 4, name = (null)&#125;2022-01-14 14:51:47.433578+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784518] 1 &lt;NSThread: 0x60000304d540&gt;&#123;number = 6, name = (null)&#125;2022-01-14 14:51:47.433718+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784384] 0 &lt;_NSMainThread: 0x6000030280c0&gt;&#123;number = 1, name = main&#125;2022-01-14 14:51:47.433880+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784518] 7 &lt;NSThread: 0x60000304d540&gt;&#123;number = 6, name = (null)&#125;2022-01-14 14:51:47.433890+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784513] 9 &lt;NSThread: 0x600003040000&gt;&#123;number = 5, name = (null)&#125;2022-01-14 14:51:47.433891+0800 GCDä¹‹å‡½æ•°å’Œé˜Ÿåˆ—[18934:784516] 8 &lt;NSThread: 0x6000030741c0&gt;&#123;number = 4, name = (null)&#125; 5ã€ã€é¢è¯•é¢˜-5-ç¾å›¢ã€‘ï¼šä¸‹é¢ä»£ç ä¸­ï¼Œé˜Ÿåˆ—çš„ç±»å‹æœ‰å‡ ç§ï¼Ÿ 1234567891011// ä¸²è¡Œé˜Ÿåˆ— - Serial Dispatch Queuedispatch_queue_t serialQueue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, NULL); // å¹¶å‘é˜Ÿåˆ— - Concurrent Dispatch Queuedispatch_queue_t concurrentQueue = dispatch_queue_create(&quot;com.ZJ.Queue&quot;, DISPATCH_QUEUE_CONCURRENT); // ä¸»é˜Ÿåˆ— - Main Dispatch Queuedispatch_queue_t mainQueue = dispatch_get_main_queue(); // å…¨å±€å¹¶å‘é˜Ÿåˆ— - Global Dispatch Queuedispatch_queue_t globalQueue = dispatch_get_global_queue(0, 0); é˜Ÿåˆ—æ€»å…±æœ‰ä¸¤ç§ï¼šä¸²è¡Œé˜Ÿåˆ— å’Œ å¹¶å‘é˜Ÿåˆ— ä¸²è¡Œé˜Ÿåˆ—ï¼šserialQueueã€mainQueue å¹¶å‘é˜Ÿåˆ—ï¼šconcurrentQueueã€globalQueue","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†25ï¼šå¤šçº¿ç¨‹åŸç†æ¢ç´¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†25ï¼šå¤šçº¿ç¨‹åŸç†æ¢ç´¢","date":"2021-02-21T01:35:17.000Z","updated":"2023-02-24T15:37:23.453Z","comments":true,"path":"2021/02/21/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†25ï¼šå¤šçº¿ç¨‹åŸç†æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2021/02/21/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8625%EF%BC%9A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"å‰è¨€æœ¬æ–‡çš„ç›®çš„åœ¨äºäº†è§£è¿›ç¨‹ã€çº¿ç¨‹ã€å¤šçº¿ç¨‹ã€çº¿ç¨‹æ±  ç­‰çš„åŸºæœ¬æ¦‚å¿µåŠåŸç† çº¿ç¨‹å’Œè¿›ç¨‹çš„å®šä¹‰çº¿ç¨‹ çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ è¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰ä¸€æ¡çº¿ç¨‹ ç¨‹åºå¯åŠ¨ä¼šé»˜è®¤å¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œè¿™æ¡çº¿ç¨‹è¢«ç§°ä¸ºä¸»çº¿ç¨‹ æˆ–è€… UIçº¿ç¨‹ è¿›ç¨‹ è¿›ç¨‹ æ˜¯æŒ‡åœ¨ ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åº æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨çš„ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†… é€šè¿‡æ´»åŠ¨ç›‘è§†å™¨å¯ä»¥æŸ¥çœ‹Macç³»ç»Ÿä¸­æ‰€å¼€å¯çš„çº¿ç¨‹ æ‰€ä»¥ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼šè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ï¼Œè€Œçº¿ç¨‹æ˜¯ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚åœ¨iOSä¸­æ˜¯å•è¿›ç¨‹å¼€å‘ï¼Œä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªAPPï¼Œè¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¦‚ï¼šå¾®ä¿¡ã€æ”¯ä»˜å®ã€qqç­‰ï¼Œè¿™äº›éƒ½å±äºä¸åŒçš„è¿›ç¨‹ã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»è¿›ç¨‹å’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»ä¸»è¦æ¶‰åŠä¸¤ä¸ªæ–¹é¢ï¼š åœ°å€ç©ºé—´ åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´ è€Œè¿›ç¨‹ä¹‹é—´åˆ™æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ èµ„æºæ‹¥æœ‰ åŒä¸€ä¸ªè¿›ç¨‹å†…çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œå¦‚å†…å­˜ã€I&#x2F;Oã€cpuç­‰ ä½†æ˜¯è¿›ç¨‹ä¹‹é—´èµ„æºæ˜¯ç‹¬ç«‹çš„ è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»å°±ç›¸å½“äºå·¥å‚å’Œæµæ°´çº¿çš„å…³ç³»ï¼Œå·¥å‚å’Œå·¥å‚ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œå·¥å‚ä¸­çš„æµæ°´çº¿æ˜¯å…±äº«å·¥å‚çš„èµ„æºçš„ï¼Œå³è¿›ç¨‹ç›¸å½“äºä¸€ä¸ªå·¥å‚ï¼Œçº¿ç¨‹ç›¸å½“äºå·¥å‚ä¸­çš„ä¸€æ¡æµæ°´çº¿ é’ˆå¯¹è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š 1ã€å¤šè¿›ç¨‹è¦æ¯”å¤šçº¿ç¨‹å¥å£® ä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“ è€Œä¸€ä¸ªçº¿ç¨‹å´©æºƒåæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰ 2ã€ä½¿ç”¨åœºæ™¯ï¼šé¢‘ç¹åˆ‡æ¢ã€å¹¶å‘æ“ä½œ è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œå°å·çš„èµ„æºå¤§ã€æ•ˆç‡é«˜ï¼Œæ‰€ä»¥è®¾è®¡åˆ°é¢‘ç¹åˆ‡æ¢æ—¶ï¼Œä½¿ç”¨çº¿ç¨‹è¦å¥½ä¸è¿›ç¨‹ åŒæ ·ï¼Œå¦‚æœè¦æ±‚åŒæ—¶è¿›è¡Œå¹¶åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œï¼Œåªèƒ½ç”¨çº¿ç¨‹ï¼Œä¸èƒ½ç”¨è¿›ç¨‹ 3ã€æ‰§è¡Œè¿‡ç¨‹ æ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºå…¥å£ ä½†æ˜¯çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾èµ–å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ§åˆ¶ 4ã€çº¿ç¨‹æ˜¯å¤„ç†å™¨è°ƒåº¦çš„åŸºæœ¬å•å…ƒï¼Œä½†è¿›ç¨‹ä¸æ˜¯ 5ã€çº¿ç¨‹æ²¡æœ‰åœ°å€ç©ºé—´ï¼Œçº¿ç¨‹åŒ…å«åœ¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ çº¿ç¨‹ å’Œ Runloop çš„å…³ç³» runloopä¸çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸€ä¸ªrunloopå¯¹åº”ä¸€ä¸ªæ ¸å¿ƒçš„çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¯´æ ¸å¿ƒçš„ï¼Œæ˜¯å› ä¸ºrunloopæ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä½†æ˜¯æ ¸å¿ƒçš„åªèƒ½æœ‰ä¸€ä¸ªï¼Œä»–ä»¬çš„å…³ç³»ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å­—å…¸é‡Œ runloopæ˜¯ç”¨æ¥ç®¡ç†çº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹çš„runloopè¢«å¼€å¯åï¼Œçº¿ç¨‹ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œæœ‰äº†ä»»åŠ¡å°±ä¼šè¢«å”¤é†’å»æ‰§è¡Œä»»åŠ¡ã€‚ runloopåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶è¢«åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶è¢«é”€æ¯ å¯¹äºä¸»çº¿ç¨‹æ¥è¯´ï¼Œrunloopåœ¨ç¨‹åºå·²å¯åŠ¨å°±é»˜è®¤åˆ›å»ºå¥½äº† å¯¹äºå­çº¿ç¨‹æ¥è¯´ï¼Œrunloopæ˜¯æ¥åŠ è½½çš„ï¼Œåªæœ‰å½“æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šåˆ›å»ºï¼Œæ‰€ä»¥åœ¨å­çº¿ç¨‹ä½¿ç”¨å®šæ—¶å™¨è¦æ³¨æ„ï¼Œç¡®ä¿å­çº¿ç¨‹çš„runloopè¢«åˆ›å»ºï¼Œä¸ç„¶å®šæ—¶å™¨ä¸ä¼šå›è°ƒ å¤šçº¿ç¨‹å¤šçº¿ç¨‹åŸç† å¯¹äº å•æ ¸CPUï¼ŒåŒä¸€æ—¶é—´ï¼ŒCPUåªèƒ½å¤„ç†ä¸€æ¡çº¿ç¨‹ï¼Œå³åªæœ‰ä¸€æ¡çº¿ç¨‹åœ¨å·¥ä½œ iOSä¸­çš„å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå…¶æœ¬è´¨æ˜¯CPUåœ¨å¤šä¸ªä»»åŠ¡é—´ç›´æ¥è¿›è¡Œå¿«é€Ÿåˆ‡æ¢ï¼Œç”±äºCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ï¼Œå°±é€ æˆäº†å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæœï¼Œå…¶ä¸­å¥‡å¹»çš„æ—¶é—´é—´éš”å°±æ˜¯æ—¶é—´ç‰‡ å¤šçº¿ç¨‹æ„ä¹‰ ä¼˜ç‚¹ èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ èƒ½é€‚å½“æé«˜èµ„æºçš„åˆ©ç”¨ç‡ï¼Œå¦‚CPUã€å†…å­˜ çº¿ç¨‹ä¸Šçš„ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨é”€æ¯ ç¼ºç‚¹ å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å ç”¨512KB å¦‚æœå¼€å¯å¤§é‡çº¿ç¨‹ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œé™ä½ç¨‹åºçš„æ€§èƒ½ çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒç”¨çº¿ç¨‹ä¸Šçš„å¼€é”€è¶Šå¤§ ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼Œæ¯”å¦‚çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œå¤šçº¿ç¨‹çš„æ•°æ®å…±äº« å¤šçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¤šçº¿ç¨‹çš„å£°æ˜å‘¨æœŸä¸»è¦åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ï¼šæ–°å»º-å°±ç»ª-è¿è¡Œ-é˜»å¡-æ­»äº¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ–°å»ºï¼šä¸»è¦æ˜¯å®ä¾‹åŒ–çº¿ç¨‹å¯¹è±¡ å°±ç»ªï¼šçº¿ç¨‹å¯¹è±¡ è°ƒç”¨startæ–¹æ³•ï¼Œå°†çº¿ç¨‹å¯¹è±¡ åŠ å…¥å¯è°ƒåº¦çº¿ç¨‹æ± ï¼Œç­‰å¾…CPUçš„è°ƒç”¨ï¼Œå³ è°ƒç”¨startæ–¹æ³•ï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè¿›å…¥ å°±ç»ªçŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç»CPUè°ƒåº¦åæ‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ä»å°±ç»ªçŠ¶æ€è¿›å…¥ è¿è¡ŒçŠ¶æ€ è¿è¡Œï¼šCPUè´Ÿè´£è°ƒåº¦å¯è°ƒåº¦çº¿ç¨‹çš„æ‰§è¡Œï¼Œåœ¨çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œå…¶çŠ¶æ€å¯èƒ½ä¼šåœ¨å°±ç»ªå’Œè¿è¡Œä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œè¿™ä¸ªå˜åŒ–æ˜¯ç”±CPUè´Ÿè´£ï¼Œå¼€å‘äººå‘˜ä¸èƒ½å¹²é¢„ é˜»å¡ï¼šå½“æ»¡è¶³æŸä¸ªé¢„å®šæ¡ä»¶æ—¶ï¼Œå¯ä»¥ ä½¿ç”¨ä¼‘çœ ã€å³sleepã€æˆ–è€…åŒæ­¥é”ï¼Œé˜»å¡çº¿ç¨‹æ‰§è¡Œï¼Œå½“è¿›å…¥sleepæ—¶ï¼Œä¼šé‡æ–°å°† çº¿ç¨‹åŠ å…¥å°±ç»ª ä¸­ï¼Œä¸‹é¢å…³äºä¼‘çœ çš„æ—¶é—´è®¾ç½®ï¼Œéƒ½æ˜¯ NSThread çš„ sleepUnilDate ï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æŒ‡å®šçš„æ—¶é—´ä¸ºæ­¢ï¼Œå³ &#96;ä¼‘çœ åˆ°æŒ‡å®šæ—¶é—´ sleepForTimeInervalï¼šåœ¨ç»™å®šçš„æ—¶é—´é—´éš”å†…ä¼‘çœ çº¿ç¨‹ï¼Œå³ æŒ‡å®šä¼‘çœ æ—¶é•¿ åŒæ­¥é”ï¼š@synchronized(self) æ­»äº¡ï¼šåˆ†ä¸ºä¸¤ç§æƒ…å†µ æ­£å¸¸æ­»äº¡ï¼Œå³çº¿ç¨‹æ‰§è¡Œå®Œæ¯• éæ­£å¸¸æ­»äº¡ï¼Œå³å½“æ»¡è¶³æŸä¸ªæ¡ä»¶åï¼Œåœ¨çº¿ç¨‹å†…éƒ¨ï¼ˆæˆ–ä¸»çº¿ç¨‹ä¸­ï¼‰ç»ˆæ­¢æ‰§è¡Œï¼ˆè°ƒç”¨exitæ–¹æ³•ç­‰é€€å‡ºï¼‰ ç®€è¦è¯´æ˜ï¼šå°±æ˜¯å¤„äº è¿è¡Œä¸­çš„çº¿ç¨‹ æ‹¥æœ‰ä¸€æ®µå¯ä»¥æ‰§è¡Œçš„äº‹ä»¶ï¼ˆæˆä¸º æ—¶é—´ç‰‡ï¼‰ å¦‚æœ æ—¶é—´ç‰‡ç”¨å°½ï¼Œçº¿ç¨‹å°±ä¼šè¿›å…¥ å°±ç»ªçŠ¶æ€é˜Ÿåˆ— å¦‚æœ æ—¶é—´ç‰‡æ²¡æœ‰ç”¨å°½ï¼Œä¸”éœ€è¦å¼€å§‹ ç­‰å¾…æŸäº‹ä»¶ï¼Œå°±ä¼šè¿›å…¥ é˜»å¡çŠ¶æ€é˜Ÿåˆ— ç­‰å¾…äº‹ä»¶å‘ç”Ÿåï¼Œçº¿ç¨‹åˆé‡æ–°è¿›å…¥ å°±ç»ªçŠ¶æ€é˜Ÿåˆ— æ¯å½“ä¸€ä¸ª çº¿ç¨‹ç¦»å¼€è¿è¡Œï¼Œå³æ‰§è¡Œå®Œæ¯•æˆ–è€…å¼ºåˆ¶é€€å‡ºåï¼Œä¼šé‡æ–° ä»å°±ç»ªçŠ¶æ€é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œ çº¿ç¨‹çš„ exit å’Œ cancel è¯´æ˜ï¼š exitï¼šä¸€æ—¦å¼ºè¡Œç»ˆæ­¢çº¿ç¨‹ï¼Œåç»­çš„æ‰€æœ‰ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œ 1- cancelï¼šå–æ¶ˆå½“å‰çº¿ç¨‹ï¼Œä½†æ˜¯ä¸èƒ½å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ ã€é¢è¯•é¢˜ã€‘çº¿ç¨‹çš„ä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ˜¯ä¸æ˜¯æ„å‘³ç€ä»»åŠ¡çš„æ‰§è¡Œè¶Šå¿«ï¼Ÿ ç­”ï¼šå¹¶ä¸æ˜¯ï¼Œçº¿ç¨‹æ‰§è¡Œçš„å¿«æ…¢ï¼Œé™¤äº†è¦çœ‹ä¼˜å…ˆçº§ï¼Œè¿˜éœ€è¦æŸ¥çœ‹ èµ„æºçš„å¤§å°ï¼ˆå³ä»»åŠ¡çš„å¤æ‚åº¦ï¼‰ã€ä»¥åŠ CPUè°ƒåº¦ æƒ…å†µï¼Œåœ¨NSThreadä¸­ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§ threadPriority å·²ç»è¢«æœåŠ¡è´¨é‡ qualityOfService å–ä»£ï¼Œä¸€ä¸‹æ˜¯ç›¸å…³çš„æšä¸¾å€¼ï¼š çº¿ç¨‹æ± çš„åŸç† ã€ç¬¬ä¸€æ­¥ã€‘åˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦éƒ½æ­£åœ¨æ‰§è¡Œä»»åŠ¡ è¿”å›NOï¼Œåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹å»æ‰§è¡Œ è¿”å›YESï¼Œè¿›å…¥ã€ç¬¬äºŒæ­¥ã€‘ ã€ç¬¬äºŒæ­¥ã€‘åˆ¤æ–­çº¿ç¨‹æ± å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²ç»é¥±æ»¡ è¿”å›NOï¼Œå°†ä»»åŠ¡å­˜å‚¨åˆ°å·¥ä½œé˜Ÿåˆ—ï¼Œç­‰å¾…CPUè°ƒåº¦ è¿”å›YESï¼Œè¿›å…¥ã€ç¬¬ä¸‰æ­¥ã€‘ ã€ç¬¬ä¸‰æ­¥ã€‘åˆ¤æ–­çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦éƒ½å‡ºäºæ‰§è¡ŒçŠ¶æ€ è¿”å›NOï¼Œå®‰æ’å¯è°ƒåº¦çº¿ç¨‹æ± ä¸­ç©ºé—²çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ è¿”å›YESï¼Œè¿›å…¥ã€ç¬¬å››æ­¥ã€‘ ã€ç¬¬å››æ­¥ã€‘äº¤ç»™é¥±å’Œç­–ç•¥å»æ‰§è¡Œï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼ˆåœ¨iOSä¸­å¹¶æ²¡æœ‰æ‰¾åˆ°ä»¥ä¸‹4ä¸­ç­–ç•¥ï¼‰ AbortPolicyï¼šç›´æ¥æŠ›å‡ºRejectedExecutionExeceptionå¼‚å¸¸æ¥é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ CallerRunsPolicy ï¼šå°†ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€… DisOldestPolicyï¼šä¸¢æ‰ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ DisCardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆiOSä¸­çš„å¤šçº¿ç¨‹å®ç°æ–¹å¼ï¼Œä¸»è¦æœ‰å››ç§ï¼špthreadã€NSThreadã€GCDã€NSOperationï¼Œæ±‡æ€»å¦‚å›¾æ‰€ç¤ºï¼š æ–¹æ¡ˆ ç®€ä»‹ è¯­è¨€ çº¿ç¨‹çš„å£°æ˜å‘¨æœŸ ä½¿ç”¨é¢‘ç‡ Pthread 1ã€ä¸€å¥—é€šç”¨çš„å¤šçº¿ç¨‹API 2ã€ä½¿ç”¨ä¸Unix&#x2F;Linus&#x2F;windowsç­‰ç³»ç»Ÿ 3ã€è·¨å¹³å°ã€å¯ç§»æ¤ 4ã€ä½¿ç”¨éš¾åº¦å¤§ C ç¨‹åºå‘˜ç®¡ç† å‡ ä¹ä¸ç”¨ NSThread 1ã€ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡ 2ã€ä½¿ç”¨ç®€å•ï¼Œå¯ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡ OC ç¨‹åºå‘˜ç®¡ç† å¶å°”ä½¿ç”¨ GCD 1ã€æ—¨åœ¨æ›¿ä»£GCDç­‰çº¿ç¨‹æŠ€æœ¯ 2ã€å……åˆ†åˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸ C è‡ªåŠ¨ç®¡ç† ç»å¸¸ä½¿ç”¨ NSOperation 1ã€åŸºäºGCDï¼ˆåº•å±‚æ˜¯GCDï¼‰ 2ã€æ¯”GCDå¤šäº†ä¸€äº›æ›´ç®€å•å®ç”¨çš„åŠŸèƒ½ 3ã€ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡ OC è‡ªåŠ¨ç®¡ç† ç»å¸¸ä½¿ç”¨ ä¸‹é¢æ˜¯å››ç§æ–¹æ¡ˆçš„ç®€å•ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162// *********1: pthread*********pthread_t threadId = NULL;//cå­—ç¬¦ä¸²char *cString = &quot;HelloCode&quot;;/** pthread_create åˆ›å»ºçº¿ç¨‹ å‚æ•°ï¼š 1. pthread_tï¼šè¦åˆ›å»ºçº¿ç¨‹çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œé€šå¸¸å¼€å‘çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ° C è¯­è¨€çš„ç»“æ„ä½“ï¼Œç±»å‹åç¼€ `_t / Ref` ç»“å°¾ åŒæ—¶ä¸éœ€è¦ `*` 2. çº¿ç¨‹çš„å±æ€§ï¼Œnil(ç©ºå¯¹è±¡ - OC ä½¿ç”¨çš„) / NULL(ç©ºåœ°å€ï¼ŒC ä½¿ç”¨çš„) 3. çº¿ç¨‹è¦æ‰§è¡Œçš„`å‡½æ•°åœ°å€` void *: è¿”å›ç±»å‹ï¼Œè¡¨ç¤ºæŒ‡å‘ä»»æ„å¯¹è±¡çš„æŒ‡é’ˆï¼Œå’Œ OC ä¸­çš„ id ç±»ä¼¼ (*): å‡½æ•°å (void *): å‚æ•°ç±»å‹ï¼Œvoid * 4. ä¼ é€’ç»™ç¬¬ä¸‰ä¸ªå‚æ•°(å‡½æ•°)çš„`å‚æ•°` */int result = pthread_create(&amp;threadId, NULL, pthreadTest, cString);if (result == 0) &#123; NSLog(@&quot;æˆåŠŸ&quot;);&#125; else &#123; NSLog(@&quot;å¤±è´¥&quot;);&#125; //*********2ã€NSThread*********[NSThread detachNewThreadSelector:@selector(threadTest) toTarget:self withObject:nil]; //*********3ã€GCD*********dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; [self threadTest];&#125;); //*********4ã€NSOperation*********[[[NSOperationQueue alloc] init] addOperationWithBlock:^&#123; [self threadTest];&#125;];// å‡½æ•°æ–¹æ³•- (void)threadTest&#123; NSLog(@&quot;begin&quot;); NSInteger count = 1000 * 100; for (NSInteger i = 0; i &lt; count; i++) &#123; // æ ˆåŒº NSInteger num = i; // å¸¸é‡åŒº NSString *name = @&quot;zhang&quot;; // å †åŒº NSString *myName = [NSString stringWithFormat:@&quot;%@ - %zd&quot;, name, num]; NSLog(@&quot;%@&quot;, myName); &#125; NSLog(@&quot;over&quot;);&#125;void *pthreadTest(void *para)&#123; // æ¥ C è¯­è¨€çš„å­—ç¬¦ä¸² // NSLog(@&quot;===&gt; %@ %s&quot;, [NSThread currentThread], para); // __bridge å°† C è¯­è¨€çš„ç±»å‹æ¡¥æ¥åˆ° OC çš„ç±»å‹ NSString *name = (__bridge NSString *)(para); NSLog(@&quot;===&gt;%@ %@&quot;, [NSThread currentThread], name); return NULL;&#125; C å’Œ OC çš„æ¡¥æ¥å…¶ä¸­æ¶‰åŠCä¸OCçš„æ¡¥æ¥ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ __bridgeåªåšç±»å‹è½¬æ¢ï¼Œä½†æ˜¯ä¸ä¿®æ”¹å¯¹è±¡ï¼ˆå†…å­˜ï¼‰ç®¡ç†æƒ __bridge_retained(ä¹Ÿå¯ä»¥ä½¿ç”¨CFBridgingRetain)å°†Object-Cçš„å¯¹è±¡è½¬æ¢ä¸ºCore Foundationçš„å¯¹è±¡ï¼ŒåŒæ—¶å°†å¯¹è±¡ï¼ˆå†…å­˜ï¼‰çš„ç®¡ç†æƒäº¤ç»™æˆ‘ä»¬ï¼Œåç»­éœ€è¦ä½¿ç”¨ CFReleaseæˆ–ç›¸å…³æ–¹æ³•æ¥é‡Šæ”¾å¯¹è±¡ __bridge_transfer(ä¹Ÿå¯ä»¥ä½¿ç”¨ CFBridgingRelease)å°† Core Foundation çš„å¯¹è±¡ è½¬æ¢ä¸º Object-Cçš„å¯¹è±¡ï¼ŒåŒæ—¶å°† å¯¹è±¡ï¼ˆå†…å­˜ï¼‰çš„ç®¡ç†æƒäº¤ç»™ARC çº¿ç¨‹å®‰å…¨é—®é¢˜å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€å—å†…å­˜èµ„æºæ—¶ï¼Œå®¹æ˜“å¼•å‘æ•°æ®é”™ä¹± å’Œ æ•°æ®å®‰å…¨é—®é¢˜ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š äº’æ–¥é”ï¼ˆå³åŒæ­¥é”ï¼‰ï¼š@synchronized è‡ªæ—‹é” äº’æ–¥é” ç”¨äºä¿æŠ¤ä¸´ç•ŒåŒºï¼Œç¡®ä¿ åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€æ¡çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œ å¦‚æœä»£ç ä¸­ åªæœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦åŠ é”ï¼Œå¤§å¤šæ•°éƒ½ä½¿ç”¨ selfï¼Œè¿™æ ·å¯ä»¥é¿å…å•ç‹¬å†åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡ åŠ å…¥äº’æ–¥é”çš„ä»£ç ï¼Œå½“æ–°çº¿ç¨‹è®¿é—®æ—¶ï¼Œå¦‚æœå‘ç°å…¶ä»–çº¿ç¨‹æ­£åœ¨æ‰§è¡Œé”å®šçš„ä»£ç ï¼Œæ–°çº¿ç¨‹å°±ä¼šè¿›å…¥ ä¼‘çœ  é’ˆå¯¹äº’æ–¥é”ï¼Œè¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š äº’æ–¥é”çš„ é”å®šèŒƒå›´ï¼Œåº”è¯¥å°½é‡å°ï¼Œé”å®šèŒƒå›´è¶Šå¤§ï¼Œæ•ˆç‡è¶Šå·® èƒ½å¤Ÿ åŠ é”çš„ä»»æ„ NSObject å¯¹è±¡ é”å¯¹è±¡ä¸€å®šè¦ä¿è¯æ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½å¤Ÿè®¿é—® è‡ªæ—‹é” è‡ªæ—‹é” ä¸ äº’æ–¥é” ç±»ä¼¼ï¼Œä½†å®ƒä¸æ˜¯é€šè¿‡ä¼‘çœ ä½¿çº¿ç¨‹é˜»å¡ï¼Œè€Œæ˜¯ åœ¨è·å–é”ä¹‹å‰ä¸€ç›´å¤„äºå¿™ç­‰ï¼ˆå³åŸåœ°æ‰“è½¬ï¼Œæˆä¸ºè‡ªæ—‹ï¼‰é˜»å¡çŠ¶æ€ ä½¿ç”¨åœºæ™¯ï¼šé”æŒæœ‰çš„æ—¶é—´çŸ­ï¼Œåˆ‡çº¿ç¨‹ä¸å¸Œæœ›åœ¨é‡æ–°è°ƒåº¦ä¸ŠèŠ±å¤ªå¤šæˆæœ¬æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨è‡ªæ—‹é”ï¼Œå±æ€§ä¿®é¥°ç¬¦ atomicï¼Œæœ¬èº«å°±æœ‰ä¸€æŠŠ è‡ªæ—‹é” åŠ å…¥äº†è‡ªæ—‹é”ï¼Œå½“æ–°çº¿ç¨‹è®¿é—®ä»£ç æ—¶ï¼Œå¦‚æœå‘ç°æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨é”å®šä»£ç ï¼Œæ–°çº¿ç¨‹ä¼šç”¨ æ­»å¾ªç¯ çš„æ–¹æ³•ï¼Œä¸€ç›´ç­‰å¾…é”å®šçš„ä»£ç æ‰§è¡Œå®Œæˆï¼Œå³ ä¸åœçš„å°è¯•æ‰§è¡Œä»£ç ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ ã€é¢è¯•é¢˜ã€‘ï¼šè‡ªæ—‹é” vs äº’æ–¥é” åŒï¼šåœ¨åŒä¸€æ—¶é—´ï¼Œä¿è¯äº†åªæœ‰ä¸€æ¡çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå³ä¿è¯äº†ç›¸åº” åŒæ­¥ çš„åŠŸèƒ½ ä¸åŒï¼š äº’æ–¥é”ï¼šå‘ç°å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œå½“å‰çº¿ç¨‹ä¼‘çœ ï¼ˆå³å°±ç»ªçŠ¶æ€ï¼‰ ï¼Œè¿›å…¥ç­‰å¾…æ‰§è¡Œï¼Œå³æŒ‚èµ·ï¼Œä¸€ç›´ç­‰å…¶ä»–çº¿ç¨‹æ‰“å¼€åï¼Œç„¶åå”¤é†’æ‰§è¡Œ è‡ªæ—‹é”ï¼šå‘ç°å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œå½“å‰çº¿ç¨‹ ä¸€ç›´è¯¢é—®ï¼ˆå³ä¸€ç›´è®¿é—®ï¼‰ï¼Œå¤„äºå¿™ç­‰çŠ¶æ€ï¼Œè€—è´¹çš„æ€§èƒ½æ¯”è¾ƒé«˜ åœºæ™¯ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦åŒºåˆ†ï¼Œä½¿ç”¨ä¸åŒçš„é”ï¼Œä½†åˆ¤æ–­è¡¥å…¨æ—¶ï¼Œæ›´å¤šçš„æ˜¯ä½¿ç”¨äº’æ–¥é”å»å¤„ç† å½“å‰çš„ä»»åŠ¡çŠ¶æ€æ¯”è¾ƒ çŸ­å°ç²¾æ‚æ—¶ï¼Œç”¨è‡ªæ—‹é” åä¹‹çš„ï¼Œç”¨äº’æ–¥é” atomic åŸå­é” &amp; nonatomic éåŸå­é”atomic å’Œ nonatomic ä¸»è¦ç”¨äºå±æ€§çš„ä¿®é¥°ï¼Œä»¥ä¸‹æ˜¯ç›¸å…³çš„ä¸€äº›è¯´æ˜ï¼š atomic æ˜¯ åŸå­å±æ€§ï¼Œæ˜¯ä¸º å¤šçº¿ç¨‹å¼€å‘å‡†å¤‡çš„ï¼Œæ˜¯é»˜è®¤å±æ€§ ä»…ä»…åœ¨å±æ€§çš„ setter æ–¹æ³•ä¸­ï¼Œå¢åŠ äº† é”ï¼ˆè‡ªæ—‹é”ï¼‰ï¼Œèƒ½å¤Ÿ ä¿è¯åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€æ¡çº¿ç¨‹ å¯¹å±æ€§è¿›è¡Œ å†™ æ“ä½œ åŒä¸€æ—¶é—´å•ï¼ˆçº¿ç¨‹ï¼‰å†™å¤šï¼ˆçº¿ç¨‹ï¼‰è¯» çš„ çº¿ç¨‹å¤„ç†æŠ€æœ¯ Macå¼€å‘ä¸­å¸¸ç”¨ nonatomic æ˜¯ éåŸå­å±æ€§ æ²¡æœ‰é” ï¼Œ æ€§èƒ½é«˜ ç§»åŠ¨ç«¯å¼€å‘å¸¸ç”¨ ã€é¢è¯•é¢˜ã€‘ atomic å’Œ nonatmicåŒºåˆ« nonatomic éåŸå­å±æ€§ éçº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå†…å­˜å°çš„ç§»åŠ¨è®¾å¤‡ atomic åŸå­å±æ€§ï¼Œçº¿ç¨‹å®‰å…¨ ï¼Œé’ˆå¯¹å¤šçº¿ç¨‹è®¾è®¡çš„ï¼Œé»˜è®¤å€¼ ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿå†™å…¥ï¼Œä½†æ˜¯åŒä¸€ä¸ªæ—¶é—´å¤šä¸ªçº¿ç¨‹éƒ½å¯ä»¥å–å€¼ atomicæœ¬èº«å°±æœ‰ä¸€æŠŠé”ï¼ˆè‡ªæ—‹é”ï¼‰ï¼Œå•å†™å¤šè¯»ï¼šå•ä¸ªçº¿ç¨‹å†™å…¥ï¼Œå¤šä¸ªçº¿ç¨‹è¯»å– çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æ¶ˆè€—å¤§é‡çš„èµ„æº iOSå¼€å‘å»ºè®® æ‰€æœ‰å±æ€§éƒ½å£°æ˜ä¸ºnonatomic å°½é‡é¿å…å¤šçº¿ç¨‹æŠ¢å¤ºåŒä¸€å—èµ„æºï¼Œå°½é‡å°†åŠ é”ã€èµ„æºæŠ¢å¤ºçš„ä¸šåŠ¡é€»è¾‘äº¤ç»™æœåŠ¡å™¨å¤„ç†ï¼Œå‡å°ç§»åŠ¨ç«¯å®¢æˆ·ç«¯çš„å‹åŠ›ä½  çº¿ç¨‹é—´çš„é€šè®¯åœ¨Threading Programming Guide æ–‡æ¡£ä¸­ï¼ŒæåŠï¼Œçº¿ç¨‹é—´çš„é€šè®¯æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ ç›´æ¥æ¶ˆæ¯ä¼ é€’ï¼šé€šè¿‡performSelectorçš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå¯ä»¥å®ç°ç”±æŸä¸€çº¿ç¨‹æŒ‡å®šåœ¨å¦å¤–çš„çº¿ç¨‹ä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œå› ä¸ºä»»åŠ¡çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯ç›®æ ‡çº¿ç¨‹ï¼Œè¿™ç§æ–¹å¼å‘é€çš„æ¶ˆæ¯å°†ä¼šè‡ªåŠ¨çš„è¢«åºåˆ—åŒ– å…¨å±€å˜é‡ã€å…±äº«å†…å­˜å—å’Œå¯¹è±¡ï¼šåœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„å¦ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨å…¨å±€å˜é‡ï¼Œå…±äº«å¯¹è±¡æˆ–å…±äº«å†…å­˜å—ï¼Œå°½ç®¡å…±äº«å˜é‡å³å¿«é€Ÿåˆç®€å•ï¼Œä½†æ˜¯å®ƒä»¬æ¯”ç›´æ¥æ¶ˆæ¯ä¼ é€’æ›´è„†å¼±ï¼Œå¿…é¡»ä½¿ç”¨é”æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ä»”ç»†ä¿æŠ¤å…±äº«å˜é‡ï¼Œä»¥ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´ç«äº‰çŠ¶å†µï¼Œæ•°æ®æŸåæˆ–å´©æºƒã€‚ æ¡ä»¶æ‰§è¡Œ: æ¡ä»¶æ˜¯ä¸€ç§åŒæ­¥å·¥å…·ï¼Œå¯ç”¨äºæ§åˆ¶çº¿ç¨‹ä½•æ—¶æ‰§è¡Œä»£ç çš„ç‰¹å®šéƒ¨åˆ†ã€‚æ‚¨å¯ä»¥å°†æ¡ä»¶è§†ä¸ºå…³å®ˆï¼Œè®©çº¿ç¨‹ä»…åœ¨æ»¡è¶³æŒ‡å®šæ¡ä»¶æ—¶è¿è¡Œã€‚ Runloop sources: ä¸€ä¸ªè‡ªå®šä¹‰çš„ Runloop source é…ç½®å¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹ä¸Šæ”¶åˆ°ç‰¹å®šçš„åº”ç”¨ç¨‹åºæ¶ˆæ¯ã€‚ç”±äº Runloop source æ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œå› æ­¤åœ¨æ— äº‹å¯åšæ—¶ï¼Œçº¿ç¨‹ä¼šè‡ªåŠ¨è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œä»è€Œæé«˜äº†çº¿ç¨‹çš„æ•ˆç‡ Ports and socketsï¼šåŸºäº ç«¯å£çš„é€šä¿¡ æ˜¯åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„ä¸€ç§æ›´ä¸ºå¤æ‚çš„æ–¹æ³•ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ç§ éå¸¸å¯é çš„æŠ€æœ¯ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç«¯å£å’Œå¥—æ¥å­—å¯ç”¨äºä¸å¤–éƒ¨å®ä½“ï¼ˆä¾‹å¦‚å…¶ä»–è¿›ç¨‹å’ŒæœåŠ¡ï¼‰è¿›è¡Œé€šä¿¡ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä½¿ç”¨ Runloop source æ¥å®ç°ç«¯å£ï¼Œå› æ­¤å½“ç«¯å£ä¸Šæ²¡æœ‰æ•°æ®ç­‰å¾…æ—¶ï¼Œçº¿ç¨‹å°†è¿›å…¥ç¡çœ çŠ¶æ€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç«¯å£é€šè®¯éœ€è¦å°†ç«¯å£åŠ å…¥åˆ° ä¸»çº¿ç¨‹çš„Runloopä¸­ï¼Œå¦åˆ™ä¸ä¼šèµ°åˆ°ç«¯å£å›è°ƒæ–¹æ³• æ¶ˆæ¯é˜Ÿåˆ—: ä¼ ç»Ÿçš„å¤šå¤„ç†æœåŠ¡å®šä¹‰äº†å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é˜Ÿåˆ—æŠ½è±¡ï¼Œç”¨äºç®¡ç†ä¼ å…¥å’Œä¼ å‡ºæ•°æ®ã€‚å°½ç®¡æ¶ˆæ¯é˜Ÿåˆ—æ—¢ç®€å•åˆæ–¹ä¾¿ï¼Œä½†æ˜¯å®ƒä»¬ä¸å¦‚å…¶ä»–ä¸€äº›é€šä¿¡æŠ€æœ¯é«˜æ•ˆ Cocoa åˆ†å¸ƒå¼å¯¹è±¡: åˆ†å¸ƒå¼å¯¹è±¡æ˜¯ä¸€ç§ Cocoa æŠ€æœ¯ï¼Œå¯æä¾›åŸºäºç«¯å£çš„é€šä¿¡çš„é«˜çº§å®ç°ã€‚å°½ç®¡å¯ä»¥å°†è¿™ç§æŠ€æœ¯ç”¨äºçº¿ç¨‹é—´é€šä¿¡ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®ä¸è¦è¿™æ ·åšï¼Œå› ä¸ºå®ƒä¼šäº§ç”Ÿå¤§é‡å¼€é”€ã€‚åˆ†å¸ƒå¼å¯¹è±¡æ›´é€‚åˆä¸å…¶ä»–è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œå°½ç®¡åœ¨è¿™äº›è¿›ç¨‹ä¹‹é—´è¿›è¡Œäº‹åŠ¡çš„å¼€é”€ä¹Ÿå¾ˆé«˜","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†24ï¼šå†…å­˜äº”å¤§åŒº","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†24ï¼šå†…å­˜äº”å¤§åŒº","date":"2021-02-14T08:38:08.000Z","updated":"2023-03-02T11:13:00.448Z","comments":true,"path":"2021/02/14/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†24ï¼šå†…å­˜äº”å¤§åŒº/","link":"","permalink":"https://www.bboyzj.cn/2021/02/14/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8624%EF%BC%9A%E5%86%85%E5%AD%98%E4%BA%94%E5%A4%A7%E5%8C%BA/","excerpt":"","text":"å‰è¨€åœ¨iOSä¸­ï¼Œå†…å­˜ä¸»è¦åˆ†ä¸º æ ˆåŒºã€å †åŒºã€å…¨å±€åŒºã€å¸¸é‡åŒºã€ä»£ç åŒº äº”ä¸ªåŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ ˆåŒºä¹‰ æ ˆæ˜¯ ç³»ç»Ÿæ•°æ®ç»“æ„ï¼Œå…¶å¯¹åº”çš„ è¿›ç¨‹æˆ–è€…çº¿ç¨‹æ˜¯å”¯ä¸€çš„ æ ˆæ˜¯ å‘ä½åœ°å€æ‰©å±• çš„æ•°æ®ç»“æ„ æ ˆæ˜¯ä¸€å— è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œéµå¾ª å…ˆè¿›åå‡ºï¼ˆFILOï¼‰ åŸåˆ™ æ ˆåŒºä¸€èˆ¬åœ¨ è¿è¡Œæ—¶ åˆ†é… å­˜å‚¨ æ ˆåŒºæ˜¯ç”± ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å¹¶é‡Šæ”¾çš„ï¼Œä¸»è¦æ¥å­˜å‚¨ å±€éƒ¨å˜é‡ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚å‡½æ•°çš„éšè—å‚æ•°ï¼ˆid self, SEL _cmdï¼‰ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šå› ä¸ºæ ˆæ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å¹¶é‡Šæ”¾çš„ï¼Œä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥å¿«é€Ÿé«˜æ•ˆ ç¡®å®šï¼šæ ˆçš„&#96;å†…å­˜å¤§å°æœ‰é™åˆ¶ï¼Œæ•°æ®ä¸çµæ´» iOSä¸»çº¿ç¨‹å¤§å°æ˜¯1MB å…¶ä»–çº¿ç¨‹æ˜¯512KB MACåªæœ‰8MB ä»¥ä¸Šå†…å­˜å¤§å°çš„è¯´æ˜ï¼Œåœ¨Threading Programming Guide ä¸­æœ‰ç›¸å…³è¯´æ˜ï¼Œå¦‚ä¸‹å›¾ï¼š å †åŒº*å®šä¹‰ å †æ˜¯å‘é«˜åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ å †æ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œç±»ä¼¼äºé“¾è¡¨ç»“æ„ï¼ˆä¾¿äºå¢åˆ ï¼Œä¸ä¾¿äºæŸ¥è¯¢ï¼‰ï¼Œéµå¾ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰åŸåˆ™ å †çš„åœ°å€ç©ºé—´åœ¨iOSä¸­æ˜¯æ˜¯åŠ¨æ€çš„ å †åŒºçš„åˆ†é…ä¸€èˆ¬æ˜¯ä»¥åœ¨è¿è¡Œæ—¶åˆ†é… *å­˜å‚¨ å †åŒºæ˜¯ç”±ç¨‹åºå‘˜åŠ¨æ€åˆ†é…å’Œé‡Šæ”¾çš„ï¼Œå¦‚æœç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸåï¼Œå¯èƒ½ç”±æ“ä½œç³»ç»Ÿå›æ”¶ï¼Œä¸»è¦ç”¨äºå­˜æ”¾ï¼š OCä¸­ä½¿ç”¨allocæˆ–è€…newå¼€è¾Ÿç©ºé—´åˆ›å»ºå¯¹è±¡ Cè¯­è¨€ä¸­ä½¿ç”¨mallocã€callocã€reallocåˆ†é…çš„ç©ºé—´ï¼Œéœ€è¦freeé‡Šæ”¾ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šçµæ´»æ–¹ä¾¿ï¼Œæ•°æ®é€‚åº”é¢å¹¿æ³› ç¼ºç‚¹ï¼šéœ€æ‰‹åŠ¨ç®¡ç†ã€é€Ÿåº¦æ…¢ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ å½“éœ€è¦è®¿é—®å †ä¸­æ•°æ®æ—¶ï¼Œä¸€èˆ¬éœ€è¦å…ˆé€šè¿‡å¯¹è±¡è¯»å–åˆ°æ ˆåŒºçš„æŒ‡é’ˆåœ°å€ï¼Œç„¶åé€šè¿‡æŒ‡é’ˆåœ°å€è®¿é—®å †åŒº å…¨å±€åŒºï¼ˆé™æ€åŒºï¼Œå³.bss &amp; .dataï¼‰å…¨å±€åŒºæ˜¯ç¼–è¯‘æ—¶åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ­¤å†…å­˜ä¸­çš„æ•°æ®ä¸€ç›´å­˜åœ¨ï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ï¼Œä¸»è¦å­˜ï¼š æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå³BSSåŒºï¼ˆ.bssï¼‰ å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå³DATAåŒºï¼ˆ.dataï¼‰ å…¶ä¸­ï¼Œå…¨å±€å˜é‡æ˜¯æŒ‡å˜é‡å€¼å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€ä¿®æ”¹ï¼Œè€Œé™æ€å˜é‡æ˜¯staticä¿®é¥°çš„å˜é‡ï¼ŒåŒ…å«é™æ€å±€éƒ¨å˜é‡å’Œé™æ€å…¨å±€å˜é‡ å¸¸é‡åŒºï¼ˆå³.rodataï¼‰å¸¸é‡åŒºæ˜¯ç¼–è¯‘æ—¶åˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œåœ¨ç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ï¼Œä¸»è¦å­˜æ”¾ï¼š å·²ç»ä½¿ç”¨äº†çš„ï¼Œä¸”æ²¡æœ‰æŒ‡å‘çš„å­—ç¬¦ä¸²å¸¸é‡ å­—ç¬¦ä¸²å¸¸é‡å› ä¸ºå¯èƒ½åœ¨ç¨‹åºä¸­è¢«å¤šæ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±ä¼šæå‰åˆ†é…å†…å­˜ ä»£ç åŒºï¼ˆå³.textï¼‰ä»£ç åŒºæ˜¯ç”±ç¼–è¯‘æ—¶åˆ†é…ï¼Œä¸»è¦ç”¨äºå­˜æ”¾ç¨‹åºè¿è¡Œæ—¶çš„ä»£ç ï¼Œä»£ç ä¼šè¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶å­˜è¿›å†…å­˜çš„ å†…å­˜äº”å¤§åŒºéªŒè¯è¿è¡Œä¸‹é¢çš„ä¸€æ®µä»£ç ï¼Œçœ‹çœ‹å˜é‡åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•åˆ†é…çš„ï¼š 1234567891011121314int a = 10; // å…¨å±€åŒºï¼ˆå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼‰char * b; // å…¨å±€åŒº(æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡)- (void)test&#123; NSInteger i = 123; // æ ˆåŒºï¼ˆå±€éƒ¨å˜é‡ï¼‰ NSLog(@&quot;içš„å†…å­˜åœ°å€ï¼š%p&quot;, &amp;i); NSString *string = @&quot;ZJ&quot;; // å¸¸é‡åŒºï¼ˆå­—ç¬¦ä¸²å¸¸é‡ï¼‰ NSLog(@&quot;stringçš„å†…å­˜åœ°å€ï¼š%p&quot;, string); NSLog(@&quot;&amp;stringçš„å†…å­˜åœ°å€ï¼š%p&quot;, &amp;string); NSObject *obj = [[NSObject alloc] init]; // å †åŒºï¼ˆallocå¯¹è±¡ï¼‰ NSLog(@&quot;objçš„å†…å­˜åœ°å€ï¼š%p&quot;, obj); NSLog(@&quot;&amp;objçš„å†…å­˜åœ°å€ï¼š%p&quot;, &amp;obj); &#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123452022-03-11 14:34:25.438913+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] içš„å†…å­˜åœ°å€ï¼š0x16f6f5a182022-03-11 14:34:25.438976+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] stringçš„å†…å­˜åœ°å€ï¼š0x1007100982022-03-11 14:34:25.438997+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] &amp;stringçš„å†…å­˜åœ°å€ï¼š0x16f6f5a102022-03-11 14:34:25.439014+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] objçš„å†…å­˜åœ°å€ï¼š0x280fa0bc02022-03-11 14:34:25.439031+0800 å†…å­˜äº”å¤§åŒº[70321:4340509] &amp;objçš„å†…å­˜åœ°å€ï¼š0x16f6f5a08 å¯¹äºå±€éƒ¨å˜é‡iï¼Œ å­˜æ”¾åœ¨æ ˆåŒº å¯¹äºå­—ç¬¦ä¸²å¯¹è±¡stringï¼Œåˆ†åˆ«æ‰“å°äº†stringå¾—å¯¹è±¡åœ°å€å’Œstringå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ stringçš„å¯¹è±¡åœ°å€æ˜¯æ˜¯å­˜æ”¾åœ¨å¸¸é‡åŒº stringå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ï¼Œæ˜¯å­˜æ”¾åœ¨æ ˆåŒº å¯¹äºallocåˆ›å»ºçš„å¯¹è±¡objï¼Œåˆ†åˆ«æ‰“å°äº†objå¾—å¯¹è±¡åœ°å€å’Œobjå¯¹è±¡çš„æŒ‡é’ˆåœ°å€ objçš„å¯¹è±¡åœ°å€æ˜¯å­˜æ”¾åœ¨å †åŒº objå¯¹è±¡çš„æŒ‡é’ˆåœ°å€æ˜¯å­˜æ”¾åœ¨æ ˆåŒº å‡½æ•°æ ˆ å‡½æ•°æ ˆ åˆç§°ä¸º æ ˆåŒºï¼Œåœ¨å†…å­˜ä¸­ä»é«˜åœ°å€å¾€ä½åœ°å€åˆ†é…ï¼Œä¸å †åŒºç›¸å¯¹ï¼Œå…·ä½“å›¾ç¤ºè¯·çœ‹ä¸Šé¢ æ ˆå¸§ æ˜¯æŒ‡ å‡½æ•°ï¼ˆè¿è¡Œä¸­ä¸”æœªå®Œæˆï¼‰å ç”¨çš„ä¸€å—ç‹¬ç«‹çš„è¿ç»­å†…å­˜åŒºåŸŸ åº”ç”¨ä¸­æ–°åˆ›å»ºçš„ æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸“ç”¨çš„æ ˆç©ºé—´ï¼Œæ ˆå¯ä»¥åœ¨çº¿ç¨‹æœŸé—´è‡ªç”±ä½¿ç”¨ï¼Œè€Œçº¿ç¨‹ä¸­æœ‰åƒåƒä¸‡ä¸‡çš„å‡½æ•°è°ƒç”¨ï¼Œè¿™äº›å‡½æ•° å…±äº« è¿›ç¨‹çš„è¿™ä¸ª æ ˆç©ºé—´ã€‚æ¯ä¸ªå‡½æ•°æ‰€ä½¿ç”¨çš„æ ˆç©ºé—´æ˜¯ä¸€ä¸ªæ ˆå¸§ï¼Œæ‰€æœ‰æ ˆå¸§å°±ç»„æˆäº†è¿™ä¸ªçº¿ç¨‹å®Œæˆçš„æ ˆ å‡½æ•°è°ƒç”¨æ˜¯å‘ç”Ÿåœ¨æ ˆä¸Š çš„ï¼Œæ¯ä¸ª å‡½æ•°çš„ç›¸å…³ä¿¡æ¯ï¼ˆä¾‹å¦‚å±€éƒ¨å˜é‡ã€è°ƒç”¨è®°å½•ç­‰ï¼‰éƒ½ å­˜å‚¨åœ¨ä¸€ä¸ªæ ˆå¸§ ä¸­ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ å‡½æ•°è°ƒç”¨ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªä¸å…¶ç›¸å…³çš„æ ˆå¸§ï¼Œç„¶åå°†å…¶ æ ˆå¸§å‹å…¥å‡½æ•°æ ˆï¼Œè€Œå½“å‡½æ•° æ‰§è¡Œç»“æŸï¼Œåˆ™å°†æ­¤å‡½æ•°å¯¹åº”çš„ æ ˆå¸§å‡ºæ ˆå¹¶é‡Šæ”¾æ‰ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ˜¯ç»å…¸å›¾- ARMçš„æ ˆå¸§å¸ƒå±€æ–¹å¼ å…¶ä¸­ main stack frame ä¸ºè°ƒç”¨å‡½æ•°çš„æ ˆå¸§ func1 stack frame ä¸ºå½“å‰ å½“å‰å‡½æ•°ï¼ˆè¢«è°ƒç”¨è€…ï¼‰çš„æ ˆå¸§ æ ˆåº• åœ¨ é«˜ åœ°å€ï¼Œæ ˆå‘ä¸‹å¢é•¿ FP å°±æ˜¯ æ ˆåŸºå€ï¼Œå®ƒæŒ‡å‘å‡½æ•°çš„ æ ˆå¸§èµ·å§‹åœ°å€ SP åˆ™æ˜¯å‡½æ•°çš„ æ ˆæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘ æ ˆé¡¶ çš„ä½ç½® ARMå‹æ ˆ çš„ é¡ºåº å¾ˆæ˜¯è§„åˆ™ï¼ˆä¹Ÿæ¯”è¾ƒå®¹æ˜“è¢«é»‘å®¢æ”»ç ´ï¼‰ï¼Œä¾æ¬¡ä¸º å½“å‰å‡½æ•°æŒ‡é’ˆPCã€è¿”å›æŒ‡é’ˆLRã€æ ˆæŒ‡é’ˆSPã€æ ˆåŸºå€FPã€ä¼ å…¥å‚æ•°ä¸ªæ•°åŠæŒ‡é’ˆã€æœ¬åœ°å˜é‡ å’Œ ä¸´æ—¶å˜é‡ã€‚å¦‚æœå‡½æ•°å‡†å¤‡è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œè·³è½¬ä¹‹å‰ä¸´æ—¶å˜é‡åŒºå…ˆè¦ä¿å­˜å¦ä¸€ä¸ªå‡½æ•°çš„å‚æ•° ARM ä¹Ÿå¯ä»¥ ç”¨æ ˆåŸºå€å’Œæ ˆæŒ‡é’ˆæ˜ç¡®æ ‡ç¤ºæ ˆå¸§çš„ä½ç½®ï¼Œæ ˆæŒ‡é’ˆSPä¸€ç›´ç§»åŠ¨ï¼ŒARMçš„ç‰¹ç‚¹æ˜¯ï¼Œä¸¤ä¸ªæ ˆç©ºé—´å†…çš„åœ°å€ï¼ˆSP+FPï¼‰å‰é¢ï¼Œå¿…ç„¶æœ‰ä¸¤ä¸ªä»£ç åœ°å€ï¼ˆPC+LPï¼‰æ˜ç¡®æ ‡ç¤ºç€è°ƒç”¨å‡½æ•°ä½ç½®å†…çš„æŸä¸ªåœ°å€ å †æ ˆæº¢å‡ºä¸€èˆ¬æƒ…å†µä¸‹åº”ç”¨ç¨‹åºæ˜¯ä¸éœ€è¦è€ƒè™‘å †å’Œæ ˆçš„å¤§å°çš„ï¼Œä½†æ˜¯äº‹å®ä¸Šå †å’Œæ ˆä¸æ˜¯æ— ä¸Šé™çš„ï¼Œè¿‡å¤šçš„é€’å½’ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼Œè¿‡å¤šçš„allocå˜é‡ä¼šå¯¼è‡´å †æº¢å‡º æ‰€ä»¥ é¢„é˜²å †æ ˆæº¢å‡º çš„æ–¹æ³•ï¼š é¿å…å±‚æ¬¡è¿‡æ·± çš„ é€’å½’ è°ƒç”¨ ä¸è¦ä½¿ç”¨è¿‡å¤šçš„å±€éƒ¨å˜é‡ï¼Œæ§åˆ¶å±€éƒ¨å˜é‡çš„å¤§å° é¿å…åˆ†é… å ç”¨ç©ºé—´ å¤ªå¤§çš„å¯¹è±¡ï¼Œå¹¶ åŠæ—¶é‡Šæ”¾ å®åœ¨ä¸è¡Œï¼Œé€‚å½“çš„æƒ…æ™¯ä¸‹ è°ƒç”¨ç³»ç»ŸAPIä¿®æ”¹çº¿ç¨‹çš„å †æ ˆå¤§å° æ ˆå¸§ç¤ºä¾‹æè¿°ä¸‹é¢ä»£ç çš„æ ˆå¸§å˜åŒ– æ ˆå¸§ç¨‹åºç¤ºä¾‹ 1234567891011int Add(int x,int y) &#123; int z = 0; z = x + y; return z;&#125;int main() &#123; int a = 10; int b = 20; int ret = Add(a, b);&#125; ç¨‹åºæ‰§è¡Œæ—¶ï¼Œæ ˆåŒºä¸­æ ˆå¸§çš„å˜åŒ–å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†23ï¼šKVOåº•å±‚åŸç†åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†23ï¼šKVOåº•å±‚åŸç†åˆ†æ","date":"2021-01-25T08:34:11.000Z","updated":"2022-04-25T03:21:28.000Z","comments":true,"path":"2021/01/25/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†23ï¼šKVOåº•å±‚åŸç†åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2021/01/25/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8623%EF%BC%9AKVO%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€KVO å…¨ç§° Key Value Observingï¼Œä¸­æ–‡åä¸º é”®å€¼è§‚å¯Ÿï¼ŒKVOæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒ å…è®¸å°†å…¶ä»–å¯¹è±¡çš„æŒ‡å®šå±æ€§çš„æ›´æ”¹é€šçŸ¥ç»™å¯¹è±¡ åœ¨ key Value Observing Programming Guide å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€å¥è¯ï¼šç†è§£KVOä¹‹å‰ï¼Œå¿…é¡»å…ˆç†è§£ KVCï¼ˆå³KVOæ˜¯åŸºäºKVCåŸºç¡€ä¹‹ä¸Šï¼‰ 123In order to understand key-value observing, you must first understand key-value coding.KVCæ˜¯é”®å€¼ç¼–ç ï¼Œåœ¨å¯¹è±¡åˆ›å»ºå®Œæˆåï¼Œå¯ä»¥åŠ¨æ€çš„ç»™å¯¹è±¡å±æ€§èµ‹å€¼ï¼Œè€ŒKVOæ˜¯é”®å€¼è§‚å¯Ÿï¼Œæä¾›äº†ä¸€ç§ç›‘å¬æœºåˆ¶ï¼Œå½“æŒ‡å®šçš„å¯¹è±¡çš„å±æ€§è¢«ä¿®æ”¹åï¼Œåˆ™å¯¹è±¡ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œæ‰€ä»¥å¯ä»¥çœ‹å‡ºKVOæ˜¯åŸºäºKVCçš„åŸºç¡€ä¸Šå¯¹å±æ€§åŠ¨æ€å˜åŒ–çš„ç›‘å¬ åœ¨iOSæ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ ä½¿ç”¨KVOæ¥ç›‘å¬å¯¹è±¡å±æ€§çš„å˜åŒ–ï¼Œå¹¶åŠæ—¶ä½œå‡ºå“åº”ï¼Œå³å½“æŒ‡å®šçš„è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§è¢«ä¿®æ”¹åï¼ŒKVO ä¼šè‡ªåŠ¨é€šçŸ¥å“åº”çš„ç®¡æ“¦ç€ï¼Œé‚£ä¹ˆ KVO ä¸ NSNotificationCenter æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ç›¸åŒç‚¹ ä¸¤è€…çš„å®ç°åŸç† éƒ½æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œéƒ½æ˜¯ç”¨äº ç›‘å¬ éƒ½èƒ½ å®ç°ä¸€å¯¹å¤š çš„æ“ä½œ ä¸åŒç‚¹ KVOåªèƒ½ç”¨äºç›‘å¬å¯¹è±¡å±æ€§çš„å˜åŒ–ï¼Œå¹¶ä¸”å±æ€§åéƒ½æ˜¯é€šè¿‡ NSString æ¥æŸ¥æ‰¾ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¸®ä½ æ£€æµ‹å¯¹é”™å’Œè¡¥å…¨ï¼Œçº¯æ‰‹æ•²ä¼šæ¯”è¾ƒå®¹æ˜“å‡ºé”™ NSNotification çš„ å‘é€ç›‘å¬ï¼ˆpostï¼‰ çš„æ“ä½œ æˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼ŒKVOç”±ç³»ç»Ÿæ§åˆ¶ KVO å¯ä»¥ è®°å½•æ–°æ—§å€¼å˜åŒ– KVO ä½¿ç”¨åŸºæœ¬ä½¿ç”¨KVOçš„åŸºæœ¬ä½¿ç”¨ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š æ³¨å†Œè§‚å¯Ÿè€… addObserver:forKeyPath:option:context 1[self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:NULL]; å®ç°KVOå›è°ƒ observerValueForKeyPath:ofObject:change:context 12345- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123; if ([keyPath isEqualToString:@&quot;name&quot;]) &#123; NSLog(@&quot;%@&quot;,change); &#125;&#125; ç§»é™¤è§‚å¯Ÿè€… removeObserver:forKeyPath:context 1[self.person removeObserver:self forKeyPath:@&quot;name&quot; context:NULL]; context ä½¿ç”¨åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œé’ˆå¯¹ å‚æ•°context æœ‰å¦‚ä¸‹è¯´æ˜ï¼š å¤§è‡´å«ä¹‰å°±æ˜¯ï¼šaddObserver:forKeyPath:option:context: æ–¹æ³•ä¸­çš„ ä¸Šä¸‹æ–‡context æŒ‡é’ˆåŒ…å«ä»»æ„æ•°æ®ï¼Œè¿™äº›æ•°æ®å°†åœ¨å“åº”çš„æ›´æ”¹é€šçŸ¥ä¸­ä¼ é€’å›è§‚å¯Ÿè€…ã€‚å¯ä»¥é€šè¿‡ æŒ‡å®šcontextä¸ºNULLï¼Œä»è€Œ ä¾é keyPath å³ é”®è·¯å¾„å­—ç¬¦ä¸² ä¼ æ¥çš„ç¡®å®šæ›´æ”¹é€šçŸ¥çš„æ¥æºï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¯èƒ½å¯¼è‡´å¯¹è±¡çš„çˆ¶ç±»ç”±äºä¸åŒçš„åŸå› ä¹Ÿè§‚å¯Ÿåˆ°ç›¸åŒçš„é”®è·¯å¾„è€Œå¯¼è‡´é—®é¢˜ã€‚æ‰€ä»¥å¯ä»¥ä¸ºæ¯ä¸ªè§‚å¯Ÿåˆ°çš„ keyPath åˆ›å»ºä¸€ä¸ªä¸åŒçš„ contextï¼Œä»è€Œ å®Œå…¨ä¸éœ€è¦è¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œä»è€Œå¯ä»¥æ›´æœ‰æ•ˆåœ°è¿›è¡Œé€šçŸ¥è§£æ é€šä¿—çš„è®²ï¼Œcontextä¸Šä¸‹æ–‡ ä¸»è¦æ˜¯ç”¨äº åŒºåˆ†ä¸åŒå¯¹è±¡çš„åŒåå±æ€§ï¼Œä»è€Œåœ¨KVOå›è°ƒæ–¹æ³•ä¸­å¯ä»¥ ç›´æ¥ä½¿ç”¨contextè¿›è¡ŒåŒºåˆ†ï¼Œå¯ä»¥å¤§å¤§æé«˜æ€§èƒ½ï¼Œä»¥åŠä»£ç çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”æ›´åŠ å®‰å…¨ contextä½¿ç”¨æ€»ç»“ ä¸ä½¿ç”¨ contextï¼Œä½¿ç”¨ keyPath åŒºåˆ†é€šçŸ¥æ¥æº 12// contextçš„ç±»å‹æ˜¯ nullable void *ï¼Œåº”è¯¥æ˜¯NULLï¼Œè€Œä¸æ˜¯nil[self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:NULL]; ä½¿ç”¨ context åŒºåˆ†é€šçŸ¥æ¥æº Personç±»ä¸­å¢åŠ ä¸¤ä¸ªå±æ€§ 12@property (nonatomic,copy)NSString * name;@property (nonatomic,copy)NSString * nick; DetailViewControllerç±»ä¸­ä»£ç å®ç° 1234567891011121314151617181920// å®šä¹‰contextstatic void * PersonNickContext = &amp;PersonNickContext;static void * PersonNameContext = &amp;PersonNameContext;// æ³¨å†Œè§‚å¯Ÿè€…[self.person addObserver:self forKeyPath:@&quot;nick&quot; options:NSKeyValueObservingOptionNew context:PersonNickContext];[self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:PersonNameContext]; // KVOå›è°ƒ- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123; if (context == PersonNickContext) &#123; NSLog(@&quot;%@&quot;,change); &#125;else if (context == PersonNameContext)&#123; NSLog(@&quot;%@&quot;,change); &#125;&#125;// KVOç§»é™¤[self.person removeObserver:self forKeyPath:@&quot;name&quot;];[self.person removeObserver:self forKeyPath:@&quot;nick&quot;]; ç§»é™¤KVOé€šçŸ¥çš„å¿…è¦æ€§åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œé’ˆå¯¹ KVOç§»é™¤ æœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š åˆ é™¤è§‚å¯Ÿè€…æ—¶ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š è¦æ±‚è¢«ç§»é™¤ä¸ºè§‚å¯Ÿè€…ï¼ˆå¦‚æœå°šæœªæ³¨å†Œä¸ºè§‚å¯Ÿè€…ï¼‰ä¼šå¯¼è‡´ NSRangeExceptionï¼Œæ‚¨å¯ä»¥å¯¹ removeObserver:forKeyPath:context: è¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œä»¥å¯¹åº”å¯¹ addObserver:forKeyPath:option:context: çš„è°ƒç”¨ï¼Œæˆ–è€…å¦‚æœåœ¨æ‚¨çš„åº”ç”¨ä¸­ä¸å¯è¡Œï¼Œåˆ™å°† removeObserver:forKeyPath:context: è°ƒç”¨åœ¨ try/catchå— å†…å¤„ç†æ½œåœ¨çš„å¼‚å¸¸ é‡Šæ”¾åï¼Œè§‚å¯Ÿè€…ä¸ä¼šè‡ªåŠ¨å°†å…¶è‡ªèº«ç§»é™¤ã€‚è¢«è§‚å¯Ÿå¯¹è±¡ç»§ç»­å‘é€é€šçŸ¥ï¼Œè€Œæˆ–ç•¥äº†è§‚å¯Ÿè€…çš„çŠ¶æ€ã€‚ä½†æ˜¯ï¼Œä¸å‘é€åˆ°å·²é‡Šæ”¾å¯¹è±¡çš„ä»»ä½•å…¶ä»–æ¶ˆæ¯ä¸€æ ·ï¼Œæ›´æ”¹é€šçŸ¥ä¼šè§¦å‘å†…å­˜è®¿é—®å¼‚å¸¸ã€‚å› æ­¤ï¼Œæ‚¨ å¯ä»¥ç¡®ä¿è§‚å¯Ÿè€…åœ¨ä»å†…å­˜ä¸­æ¶ˆå¤±ä¹‹å‰å°†è‡ªå·±ç§»é™¤ è¯¥åè®®æ— æ³•è¯¢é—®å¯¹è±¡æ˜¯è§‚å¯Ÿè€…è¿˜æ˜¯è¢«è§‚å¯Ÿè€…ã€‚æ„é€ ä»£ç ä»¥é¿å…å‘å¸ƒç›¸å…³çš„é”™è¯¯ã€‚ä¸€ç§å…¸å‹çš„æ¨¡å¼æ˜¯åœ¨è§‚å¯Ÿè€…åˆå§‹åŒ–æœŸé—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨initæˆ–viewDidLoadä¸­æ³¨å†Œä¸ºè§‚å¯Ÿè€…ï¼‰ï¼Œå¹¶åœ¨é‡Šæ”¾è¿‡ç¨‹ä¸­ï¼ˆé€šå¸¸ åœ¨deallocä¸­æ³¨é”€ï¼‰ï¼Œä»¥ç¡®ä¿æˆå¯¹å’Œæœ‰åºæ·»åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…ï¼Œå¹¶ç¡®ä¿è§‚å¯Ÿè€…åœ¨æ³¨å†Œä¹‹å‰è¢«å–æ¶ˆæ³¨å†Œï¼Œä»å†…å­˜ä¸­é‡Šæ”¾å‡ºæ¥ æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼ŒKVOæ³¨å†Œè§‚å¯Ÿè€…å’Œç§»é™¤è§‚å¯Ÿè€…æ—¶éœ€è¦æˆå¯¹å‡ºç°çš„ï¼Œå¦‚æœ åªæ³¨å†Œä¸ç§»é™¤ï¼Œä¼šå‡ºç°ç±»ä¼¼é‡æŒ‡é’ˆçš„å´©æºƒï¼ˆEXC_BAD_ACCESSï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å´©æºƒçš„åŸå› æ˜¯ï¼Œç”±äº ç¬¬ä¸€æ¬¡æ³¨å†ŒKVOè§‚å¯Ÿè€…æ²¡æœ‰ç§»é™¤ï¼Œå†æ¬¡è¿›å…¥é¡µé¢ï¼Œä¼š ç¬¬äºŒæ¬¡æ³¨å†ŒKVOè§‚å¯Ÿè€…ï¼Œå¯¼è‡´ KVOè§‚å¯Ÿè€…çš„é‡å¤æ³¨å†Œï¼Œè€Œä¸”ç¬¬ä¸€æ¬¡çš„é€šçŸ¥å¯¹è±¡è¿˜åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰è¿›è¡Œé‡Šæ”¾ï¼Œæ­¤æ—¶æ¥æ”¶åˆ°å±æ€§å€¼å˜åŒ–çš„é€šçŸ¥ï¼Œä¼šå‡ºç° æ‰¾ä¸åˆ°åŸæœ‰çš„é€šçŸ¥å¯¹è±¡ï¼Œåªèƒ½æ‰¾åˆ°ç°æœ‰çš„é€šçŸ¥å¯¹è±¡ï¼Œå³ç¬¬äºŒæ¬¡KVOæ³¨å†Œçš„è§‚å¯Ÿè€…ï¼Œæ‰€ä»¥ å¯¼è‡´äº†ç±»ä¼¼é‡æŒ‡é’ˆçš„å´©æºƒï¼Œå³ä¸€ç›´ä¿æŒç€ä¸€ä¸ª é‡é€šçŸ¥ï¼Œä¸”ä¸€ç›´åœ¨ç›‘å¬ æ³¨ï¼šè¿™é‡Œçš„å´©æºƒæ¡ˆä¾‹æ˜¯é€šè¿‡ å•ä¾‹å¯¹è±¡ å®ç°ï¼ˆå´©æºƒæœ‰å¾ˆå¤§çš„å‡ ç‡ï¼Œä¸æ˜¯æ¯æ¬¡å¿…ç°ï¼‰ï¼Œå› ä¸ºå•ä¾‹å¯¹è±¡åœ¨å†…å­˜æ˜¯å¸¸é©»çš„ï¼Œé’ˆå¯¹ä¸€èˆ¬çš„ç±»å¯¹è±¡ï¼Œè²Œä¼¼ä¸ç§»é™¤ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸ºäº†é˜²æ­¢çº¿ä¸Šæ„å¤–ï¼Œå»ºè®®è¿˜æ˜¯ç§»é™¤æ¯”è¾ƒå¥½ KVOçš„è‡ªåŠ¨è§¦å‘ä¸æ‰‹åŠ¨è§¦å‘KVOè§‚å¯Ÿè€…çš„ å¼€å¯å’Œå…³é—­ æœ‰ä¸¤ç§æ–¹å¼ï¼šè‡ªåŠ¨å’Œæ‰‹åŠ¨ è‡ªåŠ¨å¼€å…³ï¼Œè¿”å› NO å°±æ˜¯ç›‘å¬ä¸åˆ°ï¼Œè¿”å› YES è¡¨ç¤ºç›‘å¬ 1234// è‡ªåŠ¨å¼€å…³+ (BOOL) automaticallyNotifiesObserversForKey:(NSString *)key&#123; return YES;&#125; è‡ªåŠ¨å¼€å…³å…³é—­çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ æ‰‹åŠ¨å¼€å…³ç›‘å¬ 12345678910111213// è‡ªåŠ¨å…³é—­æ—¶ï¼Œæ‰‹åŠ¨å¼€å¯- (void)setName:(NSString *)name&#123; // æ‰‹åŠ¨å¼€å…³ [self willChangeValueForKey:@&quot;name&quot;]; _name = name; // çˆ¶ç±»çš„setteræ–¹æ³• [self didChangeValueForKey:@&quot;name&quot;];&#125;// æŸ¥çœ‹æ‰“å°ç»“æœ2022-03-09 10:27:56.006156+0800 KVO_Demo[4580:3263311] &#123; kind = 1; new = &quot;hello world&quot;;&#125; ä½¿ç”¨æ‰‹åŠ¨å¼€å…³çš„å¥½å¤„å°±æ˜¯ä½ æƒ³ç›‘å¬å°±ç›‘å¬ï¼Œä¸æƒ³ç›‘å¬å…³é—­å³å¯ï¼Œæ¯”è‡ªåŠ¨è§¦å‘æ›´æ–¹ä¾¿çµæ´» KVOè§‚å¯Ÿï¼šä¸€å¯¹å¤šKVOè§‚å¯Ÿä¸­çš„ ä¸€å¯¹å¤šï¼Œæ„æ€æ˜¯é€šè¿‡ æ³¨å†Œä¸€ä¸ªKVOè§‚å¯Ÿè€…ï¼Œå¯ä»¥ ç›‘å¬å¤šä¸ªå±æ€§çš„å˜åŒ– ä»¥ä¸‹è½½è¿›åº¦ä¸ºä¾‹ï¼Œæ¯”å¦‚ç›®å‰æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦æ ¹æ® æ€»çš„ä¸‹è½½é‡totalData å’Œ å½“å‰ä¸‹è½½é‡currentData æ¥è®¡ç®— å½“å‰çš„ä¸‹è½½è¿›åº¦downloadProcessï¼Œå®ç°å¦‚ä¸‹ï¼š ã€åˆäºŒä¸ºä¸€è§‚å¯Ÿæ³•ã€‘ï¼š åˆ†åˆ«è§‚å¯Ÿ æ€»çš„ä¸‹è½½é‡totalData å’Œ å½“å‰ä¸‹è½½é‡currentData ä¸¤ä¸ªå±æ€§ï¼Œå½“å…¶ä¸­ä¸€ä¸ªå‘ç”Ÿå˜åŒ– è®¡ç®—å½“å‰ä¸‹è½½é‡è¿›åº¦downloadProcessï¼Œå®ç° keyPathsForValueAffectingValueForKey æ–¹æ³•ï¼Œå°†ä¸¤ä¸ªè§‚å¯Ÿåˆä¸ºä¸€ä¸ªè§‚å¯Ÿï¼Œå³ è§‚å¯Ÿå½“å‰ä¸‹è½½è¿›åº¦currentProcess 12345678910111213141516171819202122232425262728293031@interface Person : NSObject@property (nonatomic,copy)NSString * name;@property (nonatomic,copy)NSString * nick;@property (nonatomic,assign)double totalData;@property (nonatomic,assign)double currentData;@property (nonatomic,copy)NSString * downloadProcess; // ä¸‹è½½è¿›åº¦@property (nonatomic,strong)NSMutableArray * mArr; // å¯å˜æ•°ç»„+ (instancetype)shareInstance;@end@implementation Person+ (instancetype)shareInstance&#123; static Person * person = nil; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; person = [[Person alloc] init]; &#125;); return person;&#125;#pragma mark -2.åˆäºŒä¸ºä¸€çš„è§‚å¯Ÿæ³•+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key&#123; NSSet * keyPaths = [super keyPathsForValuesAffectingValueForKey:key]; if ([key isEqualToString:@&quot;downloadProcess&quot;]) &#123; NSArray * affectingKeys = @[@&quot;totalData&quot;,@&quot;currentData&quot;]; keyPaths = [keyPaths setByAddingObjectsFromArray:affectingKeys]; &#125; return keyPaths;&#125;@end æ³¨å†ŒKVOè§‚å¯Ÿè€…ï¼Œå½“ currentDataæ”¹å˜ æ—¶ï¼Œè®¡ç®— å½“å‰ä¸‹è½½è¿›åº¦downloadProcess 123456789101112131415161718192021// 2.åˆäºŒä¸ºä¸€çš„è§‚å¯Ÿæ³•[self.person addObserver:self forKeyPath:@&quot;downloadProcess&quot; options:NSKeyValueObservingOptionNew context:NULL]; - (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; // 2.åˆäºŒä¸ºä¸€çš„è§‚å¯Ÿæ³• self.person.currentData += 1; self.person.totalData = 100;&#125;#pragma mark -KVOå›è°ƒ- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123; // 2.åˆäºŒä¸ºä¸€çš„è§‚å¯Ÿæ³• Person * person = (Person *)object; NSLog(@&quot;%f&quot;,person.currentData/person.totalData);&#125;#pragma mark -delloc-(void)dealloc&#123; // 2.åˆäºŒä¸ºä¸€çš„è§‚å¯Ÿæ³• [self.person removeObserver:self forKeyPath:@&quot;downloadProcess&quot;];&#125; KVOè§‚å¯Ÿå¯å˜æ•°ç»„KVO æ˜¯ åŸºäºKVC åŸºç¡€ ä¹‹ä¸Š çš„ï¼Œæ‰€ä»¥ å¯å˜æ•°ç»„ å¦‚æœ ç›´æ¥æ·»åŠ æ•°æ®ï¼Œæ˜¯ ä¸ä¼šè°ƒç”¨setteræ–¹æ³• çš„ï¼Œæ‰€æœ‰ å¯¹å¯å˜æ•°ç»„çš„KVOè§‚å¯Ÿ ä¸‹é¢è¿™ç§æ–¹å¼ æ˜¯ä¸ç”Ÿæ•ˆ çš„ï¼Œå³ç›´æ¥é€šè¿‡ [self.person.mArr addObject:@&quot;1&quot;]; åƒæ•°ç»„æ·»åŠ å…ƒç´ ï¼Œæ˜¯ ä¸ä¼šè§¦å‘KVO é€šçŸ¥å›è°ƒçš„ï¼Œå¦‚ä¸‹ä»£ç æ˜¯ä¸ä¼šé€šçŸ¥å›è°ƒçš„ï¼š Person.h ä¸­ 123@interface Person : NSObject@property (nonatomic,strong)NSMutableArray * mArr; // å¯å˜æ•°ç»„@end DetailViewController.m ä¸­ 12345678910111213141516171819// å¯å˜æ•°ç»„self.person.mArr = [NSMutableArray arrayWithCapacity:1];[self.person addObserver:self forKeyPath:@&quot;mArr&quot; options:NSKeyValueObservingOptionNew context:NULL];- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; // å¯å˜æ•°ç»„ [self.person.mArr addObject:@&quot;1&quot;];&#125;#pragma mark -KVOå›è°ƒ- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123; // å¯å˜æ•°ç»„ NSLog(@&quot;%@&quot;,change);&#125;-(void)dealloc&#123; // å¯å˜æ•°ç»„ [self.person removeObserver:self forKeyPath:@&quot;mArr&quot;];&#125; åœ¨ KVCå®˜æ–¹æ–‡æ¡£ä¸­ï¼Œé’ˆå¯¹ å¯å˜æ•°ç»„çš„é›†åˆ ç±»å‹ï¼Œæœ‰å¦‚ä¸‹è¯´æ˜ï¼Œå³è®¿é—®é›†åˆå¯¹è±¡éœ€è¦é€šè¿‡ mutableArrayValueForKey æ–¹æ³•ï¼Œè¿™æ ·æ‰èƒ½ å°†å…ƒç´ æ·»åŠ åˆ°å¯å˜æ•°ç»„ä¸­ å› æ­¤ï¼Œéœ€è¦å°†ä¸Šé¢ å¯å˜æ•°ç»„ æ·»åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œæ”¹ä¸ºå¦‚ä¸‹ï¼š 1234- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; // å¯å˜æ•°ç»„ [[self.person mutableArrayValueForKey:@&quot;mArr&quot;] addObject:@&quot;1&quot;];&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå…ƒç´ è¢«æ·»åŠ åˆ°å¯å˜æ•°ç»„äº†ï¼š 12345672022-03-09 10:11:24.697680+0800 KVO_Demo[4557:3255716] &#123; indexes = &quot;&lt;_NSCachedIndexSet: 0x2826d91c0&gt;[number of indexes: 1 (in 1 ranges), indexes: (0)]&quot;; kind = 2; // æ’å…¥ new = ( 1 );&#125; å…¶ä¸­çš„ kind è¡¨ç¤º é”®å€¼å˜åŒ–çš„ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ 4 ç§ï¼š 123456typedef NS_ENUM(NSUInteger, NSKeyValueChange) &#123; NSKeyValueChangeSetting = 1, // è®¾å€¼ NSKeyValueChangeInsertion = 2, // æ’å…¥ NSKeyValueChangeRemoval = 3, // ç§»é™¤ NSKeyValueChangeReplacement = 4, // æ›¿æ¢&#125;; ä¸€èˆ¬çš„ å±æ€§ ä¸ é›†åˆ çš„KVOè§‚å¯Ÿæ˜¯ç”±åŒºåˆ«çš„ï¼Œå…¶ kindä¸åŒï¼Œä»¥ å±æ€§name å’Œ å¯å˜æ•°ç»„ ä¸ºä¾‹ å±æ€§ çš„ kind ä¸€èˆ¬æ˜¯ è®¾å€¼ å¯å˜æ•°ç»„ çš„ kind ä¸€èˆ¬æ˜¯ æ’å…¥ KVOçš„åº•å±‚åŸç†æ¢ç´¢å®˜æ–¹æ–‡æ¡£è¯´æ˜ åœ¨KVOçš„å®˜æ–¹æ–‡æ¡£ä½¿ç”¨æŒ‡å—ä¸­ï¼Œæœ‰å¦‚ä¸‹è¯´æ˜ KVO æ˜¯ä½¿ç”¨ isa-swizzling çš„æŠ€æœ¯å®ç°çš„ é¡¾åæ€ä¹‰ï¼ŒisaæŒ‡é’ˆæŒ‡å‘ç»´æŠ¤åˆ†é…è¡¨çš„å¯¹è±¡çš„ç±»ã€‚è¯¥åˆ†é…è¡¨å®è´¨ä¸ŠåŒ…å«æŒ‡å‘è¯¥ç±»å®ç°çš„æ–¹æ³•çš„æŒ‡é’ˆä»¥åŠå…¶ä»–æ•°æ® å½“ä¸ºå¯¹è±¡çš„å±æ€§ æ³¨å†Œè§‚å¯Ÿè€…æ—¶ï¼Œå°† ä¿®æ”¹ è§‚å¯Ÿè€…å¯¹è±¡çš„ isaæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸­é—´ç±» è€Œä¸æ˜¯çœŸå®ç±»ã€‚ç»“æœï¼Œisa æŒ‡é’ˆçš„å€¼ä¸ä¸€å®šåæ˜ å®ä¾‹çš„å®é™…ç±» ä½ ä¸åº”è¯¥ä¾é isaæŒ‡é’ˆæ¥ç¡®å®šç±»çš„æˆå‘˜å˜é‡ï¼Œç›¸åï¼Œä½ åº”è¯¥ ä½¿ç”¨classæ–¹æ³•æ¥ç¡®å®šå¯¹è±¡å®ä¾‹çš„ç±» ä»£ç è°ƒå¼æ¢ç´¢KVOåªå¯¹å±æ€§è§‚å¯Ÿåœ¨ ZJPerson ä¸­æœ‰ä¸€ä¸ª æˆå‘˜å˜é‡name å’Œ å±æ€§nickï¼Œåˆ†åˆ«æ³¨å†ŒKVOè§‚å¯Ÿè€…ï¼Œè§¦å‘å±æ€§å˜åŒ–æ—¶ï¼Œä¼šæœ‰ä»€ä¹ˆç°è±¡ï¼Ÿ åˆ›å»º ZJPerson ç±»ï¼Œå£°æ˜ æˆå‘˜å˜é‡name å’Œ å±æ€§nick 1234567@interface ZJPerson : NSObject&#123; @public NSString * name;&#125;@property (nonatomic,copy)NSString * nick;@end åˆ†åˆ«ä¸º æˆå‘˜å˜é‡name å’Œ å±æ€§nick æ³¨å†Œè§‚å¯Ÿè€… 12345678910- (void)viewDidLoad &#123; [super viewDidLoad]; self.view.backgroundColor = [UIColor orangeColor]; self.person = [[ZJPerson alloc] init]; [self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:NULL]; [self.person addObserver:self forKeyPath:@&quot;nick&quot; options:NSKeyValueObservingOptionNew context:NULL]; &#125; KVOè§¦å‘é€šçŸ¥æ“ä½œ 1234- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; self.person-&gt;name = @&quot;ZJ&quot;; self.person.nick = @&quot;XJ&quot;;&#125; KVOæ¥æ”¶é€šçŸ¥æ“ä½œ 1234- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context&#123; NSLog(@&quot;%@&quot;,change);&#125; è¿è¡Œç»“æœå¦‚ä¸‹ 12342022-03-09 14:33:59.443356+0800 002--KVOåŸç†æ¢è®¨[4675:3328750] &#123; kind = 1; new = XJ;&#125; ç»“è®ºï¼šKVOå¯¹ æˆå‘˜å˜é‡nameä¸è§‚å¯Ÿï¼Œåªå¯¹ å±æ€§nameè§‚å¯Ÿï¼Œå±æ€§å’Œæˆå‘˜å˜é‡çš„åŒºåˆ«åœ¨äº å±æ€§å¤šäº†ä¸€ä¸ªsetteræ–¹æ³•ï¼Œè€Œ KVOæ°å¥½è§‚å¯Ÿçš„æ˜¯setteræ–¹æ³• ä¸­é—´ç±»æ ¹æ®å®˜æ–¹æ–‡æ¡£æ‰€è¿°ï¼Œåœ¨ æ³¨å†ŒKVOè§‚å¯Ÿè€…åï¼Œè§‚å¯Ÿè€…å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘ä¼šå‘ç”Ÿæ”¹å˜ æ³¨å†Œè§‚å¯Ÿè€…ä¹‹å‰ï¼š å®ä¾‹å¯¹è±¡person çš„ isa æŒ‡é’ˆæŒ‡å‘ ZJPerson æ³¨å†Œè§‚å¯Ÿè€…ä¹‹åï¼šå®ä¾‹å¯¹è±¡person çš„ isa æŒ‡é’ˆæŒ‡å‘ NSKVONotifing_ZJPerson ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨æ³¨å†Œè§‚å¯Ÿè€…åï¼Œå®ä¾‹å¯¹è±¡ çš„ isa æŒ‡é’ˆ æŒ‡å‘ ç”± ZJPersonç±» å˜ä¸ºäº† NSKVONotifying_ZJPersonä¸­é—´ç±»ï¼Œå³å®ä¾‹å¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘å‘ç”Ÿäº†å˜åŒ– åˆ¤æ–­ä¸­é—´ç±»æ˜¯å¦æ˜¯ æ´¾ç”Ÿç±» å³ å­ç±»ï¼Ÿé‚£ä¹ˆè¿™ä¸ªåŠ¨æ€ç”Ÿæˆçš„ä¸­é—´ç±» NSKVONotifying_ZJPerson å’Œ ZJPerson æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿä¸‹é¢é€šè¿‡ä»£ç æ¥éªŒè¯ å¯ä»¥é€šè¿‡ä¸‹é¢å°è£…çš„æ–¹æ³•ï¼Œè·å–ZJPersonçš„ç›¸å…³ç±» 123456789101112131415161718192021222324252627// æ·»åŠ KVOä¹‹å‰[self printClasses:[ZJPerson class]]; // æ·»åŠ è§‚å¯Ÿè€…[self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:NULL];[self.person addObserver:self forKeyPath:@&quot;nick&quot; options:NSKeyValueObservingOptionNew context:NULL]; // æ·»åŠ KVOä¹‹å[self printClasses:[ZJPerson class]];#pragma mark -éå†ç±»ä»¥åŠå­ç±»- (void)printClasses:(Class)cls&#123; // æ³¨å†Œç±»çš„æ€»æ•° int count = objc_getClassList(NULL, 0); // åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œ å…¶ä¸­åŒ…å«ç»™å®šå¯¹è±¡ NSMutableArray * mArr = [NSMutableArray arrayWithObject:cls]; // è·å–æ‰€æœ‰å·²æ³¨å†Œçš„ç±» Class * classes = (Class*)malloc(sizeof(Class)*count); objc_getClassList(classes, count); for (int i = 0; i &lt; count; i ++) &#123; if (cls == class_getSuperclass(classes[i])) &#123; [mArr addObject:classes[i]]; &#125; &#125; free(classes); NSLog(@&quot;classes = %@&quot;, mArr);&#125; æ‰“å°ç»“æœå¦‚ä¸‹ï¼š ä»æ‰“å°ç»“æœå¯ä»¥å¾—å‡ºï¼ŒNSKVONotifying_ZJPerson æ˜¯ ZJPerson çš„å­ç±» ä¸­é—´ç±»ä¸­æœ‰ä»€ä¹ˆï¼Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è·å– NSKVONotifying_ZJPerson ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³• 12345678910111213141516171819// éå†æ–¹æ³•[self printClassAllMethod:objc_getClass(&quot;NSKVONotifying_ZJPerson&quot;)]; #pragma mark -éå†æ–¹æ³•- (void)printClassAllMethod:(Class)cls&#123; unsigned int count = 0; // è·å–ä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰å®ä¾‹æ–¹æ³• Method * methodList = class_copyMethodList(cls, &amp;count); for (int i = 0; i &lt; count; i ++) &#123; // è·å–å•ä¸ªæ–¹æ³• Method method = methodList[i]; // æ–¹æ³•ç¼–å· SEL sel = method_getName(method); // æ–¹æ³•å®ç° IMP imp = class_getMethodImplementation(cls, sel); NSLog(@&quot;%@ - %p&quot;,NSStringFromSelector(sel),imp); &#125; free(methodList);&#125; æŸ¥çœ‹æ‰“å°ç»“æœ ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºæœ‰å››ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ setNickã€classã€deallocã€_isKVOAï¼Œè¿™äº›æ–¹æ³•æ˜¯ ç»§æ‰¿ è¿˜æ˜¯ é‡å†™ï¼Ÿ åœ¨ ZJStudent(ç»§æ‰¿è‡ªZJPerson) ä¸­é‡å†™ setNick æ–¹æ³•ï¼Œè·å– ZJStudent ç±»çš„æ‰€æœ‰æ–¹æ³• ç”±æ‰“å°ç»“æœå¯çŸ¥ï¼Œå¦‚æœæ˜¯ç»§æ‰¿é‚£ä¹ˆ NSKVONotifying_ZJPerson æ‰“å°çš„æ–¹æ³•åº”è¯¥ä¸ ZJPerson æ‰“å°çš„ç»“æœä¸€è‡´ è·å– ZJPerson å’Œ NSKVONotifying_ZJPerson çš„æ–¹æ³•åˆ—è¡¨è¿›è¡Œå¯¹æ¯” ã€ç»“è®ºã€‘ ç»¼ä¸Šæ‰€è¿°ï¼Œæœ‰å¦‚ä¸‹ç»“è®ºï¼š NSKVONotifying_ZJPerson ä¸­é—´ç±» é‡å†™ äº† çˆ¶ç±»ZJPerson çš„ setNick æ–¹æ³• NSKVONotifying_ZJPerson ä¸­é—´ç±» é‡å†™ äº† åŸºç±»NSObject çš„ classã€deallocã€_isKVOA æ–¹æ³• å…¶ä¸­ dealloc æ˜¯é‡Šæ”¾æ–¹æ³• _isKVOA åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯ KVOç±» deallocä¸­ç§»é™¤è§‚å¯Ÿè€…åï¼ŒisaæŒ‡å‘è°ï¼Œä»¥åŠä¸­é—´ç±»æ˜¯å¦ä¼šé”€æ¯ï¼Ÿ ç§»é™¤è§‚å¯Ÿè€…å‰ï¼šå®ä¾‹å¯¹è±¡çš„isa æŒ‡å‘ä»æ˜¯ NSKVONotifying_ZJPersonä¸­é—´ç±» ç§»é™¤è§‚å¯Ÿè€…ä¹‹åï¼šå®ä¾‹å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘æ›´æ”¹ä¸º ZJPersonç±» æ‰€ä»¥ï¼Œåœ¨ ç§»é™¤KVOè§‚å¯Ÿè€…åï¼Œisa çš„æŒ‡å‘ç”± KSKVONotifying_ZJPerson å˜æˆäº† ZJPerson é‚£ä¹ˆä¸­é—´ç±»ä»åˆ›å»ºåï¼Œåˆ°deallocæ–¹æ³•ä¸­ç§»é™¤è§‚å¯Ÿè€…ä¹‹åï¼ŒKSKVONotifying_ZJPerson æ˜¯å¦è¿˜å­˜åœ¨ï¼Ÿ åœ¨ä¸Šä¸€ä¸ªç•Œé¢æ‰“å° ZJPerson çš„å­ç±»æƒ…å†µï¼Œç”¨äºåˆ¤æ–­ä¸­é—´ç±»æ˜¯å¦é”€æ¯ é€šè¿‡å­ç±»çš„æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºï¼Œä¸­é—´ç±»ä¸€æ—¦ç”Ÿæˆï¼Œæ²¡æœ‰ç§»é™¤ï¼Œæ²¡æœ‰é”€æ¯ï¼Œè¿˜åœ¨å†…å­˜ä¸­ï¼Œä¸»è¦æ˜¯è€ƒè™‘ é‡ç”¨ çš„æƒ³æ³•ï¼Œå³ ä¸­é—´ç±»æ³¨å†Œåˆ°å†…å­˜ä¸­ï¼Œä¸ºäº†è€ƒè™‘åç»­çš„é‡ç”¨é—®é¢˜ï¼Œæ‰€ä»¥ä¸­é—´ç±»ä¸€ç›´å­˜åœ¨ æ€»ç»“ç»¼ä¸Šæ‰€è¿°ï¼Œå…³äº ä¸­é—´ç±»ï¼Œæœ‰å¦‚ä¸‹è¯´æ˜ï¼š å®ä¾‹å¯¹è±¡isa çš„æŒ‡å‘ åœ¨æ³¨å†ŒKVOè§‚å¯Ÿè€…ä¹‹åï¼Œç”± åŸæœ‰ç±» æ›´æ”¹ä¸º ä¸­é—´ç±» ä¸­é—´ç±» é‡å†™äº†è§‚å¯Ÿ å±æ€§setteræ–¹æ³•ã€classã€deallocã€_isKVOA æ–¹æ³• dealloc æ–¹æ³•ä¸­ï¼Œç§»é™¤KVOè§‚å¯Ÿè€…ä¹‹åï¼Œå®ä¾‹å¯¹è±¡isa æŒ‡å‘ç”± ä¸­é—´ç±» æ›´æ”¹ä¸º åŸæœ‰ç±» ä¸­é—´ç±» ä»åˆ›å»ºåï¼Œå°±ä¸€ç›´ å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ä¼šè¢«é”€æ¯ è‡ªå®šä¹‰KVOè‡ªå®šä¹‰KVOçš„æµç¨‹ï¼Œåªæ˜¯åœ¨ç³»ç»Ÿçš„åŸºç¡€ä¸Šé’ˆå¯¹å…¶éƒ¨åˆ†åšäº†ä¸€äº›ä¼˜åŒ–å¤„ç†ã€‚ æ¨¡æ‹Ÿç³»ç»Ÿ å®ç° KVOè‡ªåŠ¨é”€æ¯æœºåˆ¶ å°† å“åº”å¼å’Œå‡½æ•°å¼ æ•´åˆ åœ¨ç³»ç»Ÿä¸­ï¼Œæ³¨å†Œè§‚å¯Ÿè€…å’ŒKVOå“åº”å±äº å“åº”å¼ç¼–ç¨‹ï¼Œæ˜¯åˆ†å¼€å†™çš„ï¼Œåœ¨è‡ªå®šä¹‰ä¸ºäº†ä»£ç æ›´å¥½çš„åè°ƒï¼Œä½¿ç”¨ block çš„å½¢å¼ï¼Œå°†æ³¨å†Œå’Œå›è°ƒçš„é€»è¾‘ç»„åˆåœ¨ä¸€èµ·ï¼Œå³é‡‡ç”¨ å‡½æ•°å¼å˜æˆ æ–¹å¼ é‚£ä¹ˆå¦‚ä½•å®ç°è‡ªå®šä¹‰KVOå‘¢ï¼Ÿåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š æ³¨å†Œè§‚å¯Ÿè€… 12345678// å®šä¹‰blcocktypedef void(^ZJKVOBlock)(id observer,NSString * keyPath,id oldValue,id newValue);// åˆ›å»ºä¸€ä¸ª NSObject+ZJKVOçš„åˆ†ç±»ï¼Œæ³¨å†Œè§‚å¯Ÿè€…@interface NSObject (ZJKVO)- (void)zj_addObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath block:(ZJKVOBlock)block;- (void)zj_removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath;@end KVOç›‘å¬ è¿™éƒ¨åˆ†ä¸»è¦æ˜¯é€šè¿‡ é‡å†™setteræ–¹æ³•ï¼Œåœ¨ä¸­é—´ç±»çš„setteræ–¹æ³•ä¸­ï¼Œé€šè¿‡ block æ–¹å¼ä¼ é€’ç»™å¤–éƒ¨è¿›è¡Œå“åº” ç§»é™¤è§‚å¯Ÿè€… 1- (void)zj_removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath; æ³¨å†Œè§‚å¯Ÿè€…åœ¨æ³¨å†Œè§‚å¯Ÿè€…æ­¥éª¤ä¸­ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥æ“ä½œï¼š 1ã€éªŒè¯æ˜¯å¦å­˜åœ¨ setter æ–¹æ³•ï¼Œç›®çš„æ˜¯ ä¸è®©å®ä¾‹è¿›æ¥ 2ã€åŠ¨æ€ç”Ÿæˆå­ç±»ï¼Œå°†éœ€è¦é‡å†™çš„ class æ–¹æ³•æ·»åŠ åˆ°ä¸­é—´ç±»ä¸­ 3ã€ isa æŒ‡å‘åŸæœ‰ç±»ï¼Œæ”¹ä¸º æŒ‡å‘ä¸­é—´ç±» 4ã€ ä¿å­˜ä¿¡æ¯ï¼šè¿™é‡Œç”¨çš„æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨mapï¼Œéœ€è¦åˆ›å»ºä¿¡æ¯çš„ modelæ¨¡å‹ç±» ã€æ³¨æ„ã€‘ï¼š å…³äº objc_msgSend çš„æ£€æŸ¥å…³é—­ï¼štarget -&gt; Build Setting -&gt; Enable Strict Checking of objc_msgsend Calls è®¾ç½®ä¸º NO KVOå“åº” ä¸»è¦æ˜¯ç»™ å­ç±» åŠ¨æ€æ·»åŠ  setter æ–¹æ³•ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†åœ¨ setteræ–¹æ³• ä¸­å‘çˆ¶ç±»å‘é€æ¶ˆæ¯ï¼Œå‘ŠçŸ¥å…¶å±æ€§å€¼çš„å˜åŒ– é€šè¿‡ç³»ç»Ÿçš„ objc_msgSendSuper å¼ºåˆ¶ç±»å‹è½¬æ¢è‡ªå®šä¹‰çš„æ¶ˆæ¯å‘é€ zj_msgSendSuper å‘ŠçŸ¥vcå»å“åº”ï¼šè·å–ä¿¡æ¯ï¼Œé€šè¿‡blockä¼ é€’ ç§»é™¤è§‚å¯Ÿè€…ä¸ºäº†é¿å…åœ¨å¤–ç•Œä¸æ–­çš„è°ƒç”¨ removeObserver æ–¹æ³•ï¼Œåœ¨è‡ªå®šä¹‰ KVO ä¸­å®ç° è‡ªåŠ¨ç§»é™¤è§‚å¯Ÿè€… 1ã€å®ç° zj_removeObserver:forKeyPath: æ–¹æ³•ï¼Œä¸»è¦æ˜¯æ¸…ç©ºæ•°ç»„ï¼Œä»¥åŠ isa æŒ‡å‘æ›´æ”¹ 2ã€åœ¨å­ç±»ä¸­é‡å†™ dealloc æ–¹æ³•ï¼Œå½“å­ç±»é”€æ¯æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨deallocæ–¹æ³•ï¼ˆåœ¨åŠ¨æ€ç”Ÿæˆå­ç±»çš„æ–¹æ³•ä¸­æ·»åŠ ï¼‰ å…¶ä¸»è¦åŸç†æ˜¯ï¼šZJPerson å‘é€æ¶ˆæ¯é‡Šæ”¾å³ dealloc äº†ï¼Œå°±ä¼šè‡ªåŠ¨èµ°åˆ°é‡å†™çš„ zj_dealloc æ–¹æ³•ä¸­ï¼ˆåŸå› æ˜¯personå¯¹è±¡çš„ isa æŒ‡å‘å˜äº†ï¼‰ï¼ŒæŒ‡å‘ä¸­é—´ç±»ï¼Œä½†æ˜¯å®ä¾‹å¯¹è±¡çš„åœ°å€æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å­ç±»çš„é‡Šæ”¾ï¼Œç›¸å½“äºé‡Šæ”¾äº†å¤–ç•Œçš„personï¼Œè€Œé‡å†™çš„ zj_dealloc ç›¸å½“äºæ˜¯ é‡å†™äº†ZJPerson çš„ dealloc æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šèµ°åˆ° zj_dealloc æ–¹æ³•ä¸­ï¼Œè¾¾åˆ°è‡ªåŠ¨ç§»é™¤è§‚å¯Ÿè€…çš„ç›®çš„ã€‚ å®Œæ•´çš„ä»£ç  ã€NSObject+ZJKVO.hã€‘ 1234567typedef void(^ZJKVOBlock)(id observer,NSString *keyPath,id oldValue,id newValue);@interface NSObject (LGKVO)- (void)zj_addObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath block:(LGKVOBlock)block;- (void)zj_removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath;@end ã€NSObject+ZJKVO.mã€‘ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170#import &quot;NSObject+ZJKVO.h&quot;#import &lt;objc/message.h&gt;static NSString *const kZJKVOPrefix = @&quot;ZJKVONotifying_&quot;;static NSString *const kZJKVOAssiociateKey = @&quot;kZJKVO_AssiociateKey&quot;;#*****ä¿¡æ¯model*****@interface ZJInfo : NSObject@property (nonatomic,weak)NSObject * observer;@property (nonatomic,copy)NSString * keyPath;@property (nonatomic,copy)ZJKVOBlock handleBlock;@end@implementation ZJInfo- (instancetype)initWitObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath handleBlock:(ZJKVOBlock)block&#123; if (self=[super init]) &#123; _observer = observer; _keyPath = keyPath; _handleBlock = block; &#125; return self;&#125;@end@implementation NSObject (ZJKVO)- (void)zj_addObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath block:(ZJKVOBlock)block&#123; // 1.éªŒè¯æ˜¯å¦å­˜åœ¨setteræ–¹æ³•ï¼šä¸è®©å®ä¾‹è¿›æ¥ [self judgeSetterMethodFromKeyPath:keyPath]; // 2.åŠ¨æ€ç”Ÿæˆå­ç±» Class newClass = [self createChildClassWithKeyPath:keyPath]; // 3.isaçš„æŒ‡å‘ : ZJKVONotifying_ZJPerson object_setClass(self, newClass); // 4.ä¿å­˜ä¿¡æ¯ ZJInfo * info = [[ZJInfo alloc] initWitObserver:observer forKeyPath:keyPath handleBlock:block]; NSMutableArray * mArray = objc_getAssociatedObject(self, (__bridge const void * _Nonnull)(kZJKVOAssiociateKey)); if (!mArray) &#123; mArray = [NSMutableArray arrayWithCapacity:1]; objc_setAssociatedObject(self, (__bridge const void * _Nonnull)(kZJKVOAssiociateKey), mArray, OBJC_ASSOCIATION_RETAIN_NONATOMIC); &#125; [mArray addObject:info];&#125;#pragma mark -ç§»é™¤è§‚å¯Ÿè€…- (void)zj_removeObserver:(NSObject *)observer forKeyPath:(NSString *)keyPath&#123; NSMutableArray *observerArr = objc_getAssociatedObject(self, (__bridge const void * _Nonnull)(kZJKVOAssiociateKey)); if (observerArr.count&lt;=0) &#123; return; &#125; for (ZJInfo *info in observerArr) &#123; if ([info.keyPath isEqualToString:keyPath]) &#123; [observerArr removeObject:info]; objc_setAssociatedObject(self, (__bridge const void * _Nonnull)(kZJKVOAssiociateKey), observerArr, OBJC_ASSOCIATION_RETAIN_NONATOMIC); break; &#125; &#125; if (observerArr.count&lt;=0) &#123; // æŒ‡å›ç»™çˆ¶ç±» Class superClass = [self class]; object_setClass(self, superClass); &#125;&#125;#pragma mark - éªŒè¯æ˜¯å¦å­˜åœ¨setteræ–¹æ³•- (void)judgeSetterMethodFromKeyPath:(NSString *)keyPath&#123; Class superClass = object_getClass(self); // è·å–ç±»Person SEL setterSeletor = NSSelectorFromString(setterForGetter(keyPath)); Method setterMethod = class_getInstanceMethod(superClass, setterSeletor); if (!setterMethod) &#123; @throw [NSException exceptionWithName:NSInvalidArgumentException reason:[NSString stringWithFormat:@&quot;è€é“æ²¡æœ‰å½“å‰%@çš„setter&quot;,keyPath] userInfo:nil]; &#125;&#125;#pragma mark -åŠ¨æ€ç”Ÿæˆå­ç±»- (Class)createChildClassWithKeyPath:(NSString *)keyPath&#123; // è·å–åŸæœ¬çš„ç±»åï¼ˆPersonï¼‰ NSString * oldClassName = NSStringFromClass([self class]); // æ‹¼æ¥å­ç±»ç±»åï¼ˆZJKVONotifying_Personï¼‰ NSString * newClassName = [NSString stringWithFormat:@&quot;%@%@&quot;,kZJKVOPrefix,oldClassName]; // è·å–å­ç±» Class newClass = NSClassFromString(newClassName); // é˜²æ­¢é‡å¤åˆ›å»ºç”Ÿæˆæ–°ç±» if (newClass) return newClass; /** * å¦‚æœå†…å­˜ä¸å­˜åœ¨,åˆ›å»ºç”Ÿæˆ * å‚æ•°ä¸€: çˆ¶ç±» * å‚æ•°äºŒ: æ–°ç±»çš„åå­— * å‚æ•°ä¸‰: æ–°ç±»çš„å¼€è¾Ÿçš„é¢å¤–ç©ºé—´ */ // 2.1 : ç”³è¯·ç±»ï¼ˆZJKVONotifying_Personï¼‰ newClass = objc_allocateClassPair([self class], newClassName.UTF8String, 0); // 2.2 : æ³¨å†Œç±» objc_registerClassPair(newClass); // 2.3.1 : æ·»åŠ class : classçš„æŒ‡å‘æ˜¯ZJPerson SEL classSEL = NSSelectorFromString(@&quot;class&quot;); Method classMethod = class_getInstanceMethod([self class], classSEL); const char *classTypes = method_getTypeEncoding(classMethod); class_addMethod(newClass, classSEL, (IMP)zj_class, classTypes); // 2.3.2 : æ·»åŠ setter SEL setterSEL = NSSelectorFromString(setterForGetter(keyPath)); // è·å–sel Method setterMethod = class_getInstanceMethod([self class], setterSEL); // è·å–setterå®ä¾‹æ–¹æ³• const char *setterTypes = method_getTypeEncoding(setterMethod); // æ–¹æ³•ç­¾å class_addMethod(newClass, setterSEL, (IMP)zj_setter, setterTypes); // æ·»åŠ ä¸€ä¸ªsetteræ–¹æ³• // 2.3.3 : æ·»åŠ dealloc SEL deallocSEL = NSSelectorFromString(@&quot;dealloc&quot;); Method deallocMethod = class_getInstanceMethod([self class], deallocSEL); const char *deallocTypes = method_getTypeEncoding(deallocMethod); class_addMethod(newClass, deallocSEL, (IMP)zj_dealloc, deallocTypes); return newClass;&#125;#pragma mark -é‡å†™classæ–¹æ³•ï¼Œä¸ºäº†ä¸ç³»ç»Ÿç±»å¯¹å¤–ä¿æŒä¸€è‡´Class zj_class(id self,SEL _cmd)&#123; return class_getSuperclass(object_getClass(self));&#125;#pragma mark -æ·»åŠ setteræ–¹æ³•static void zj_setter(id self,SEL _cmd,id newValue)&#123; NSString *keyPath = getterForSetter(NSStringFromSelector(_cmd)); id oldValue = [self valueForKey:keyPath]; // 4: æ¶ˆæ¯è½¬å‘ : è½¬å‘ç»™çˆ¶ç±» // é€šè¿‡ç³»ç»Ÿå¼ºåˆ¶ç±»å‹è½¬æ¢è‡ªå®šä¹‰objc_msgSendSuper void (*zj_msgSendSuper)(void *,SEL , id) = (void *)objc_msgSendSuper; // å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ struct objc_super superStruct = &#123; .receiver = self, // æ¶ˆæ¯æ¥æ”¶è€…ä¸ºå½“å‰çš„self .super_class = class_getSuperclass(object_getClass(self)), // å½“ç¬¬ä¸€æ¬¡å¿«æ·æŸ¥æ‰¾çš„ç±»ä¸ºçˆ¶ç±» &#125;; // è°ƒç”¨è‡ªå®šä¹‰çš„æ”¾æ¶ˆæ¯å‡½æ•° zj_msgSendSuper(&amp;superStruct,_cmd,newValue); // 5: ä¿¡æ¯æ•°æ®å›è°ƒ NSMutableArray *mArray = objc_getAssociatedObject(self, (__bridge const void * _Nonnull)(kZJKVOAssiociateKey)); for (ZJInfo *info in mArray) &#123; if ([info.keyPath isEqualToString:keyPath] &amp;&amp; info.handleBlock) &#123; info.handleBlock(info.observer, keyPath, oldValue, newValue); &#125; &#125;&#125;#pragma mark - ä»getæ–¹æ³•è·å–setæ–¹æ³•çš„åç§° key -&gt; setKey:static NSString *setterForGetter(NSString *getter)&#123; if (getter.length &lt;= 0) &#123; return nil;&#125; NSString *firstString = [[getter substringToIndex:1] uppercaseString]; NSString *leaveString = [getter substringFromIndex:1]; return [NSString stringWithFormat:@&quot;set%@%@:&quot;,firstString,leaveString];&#125;#pragma mark - ä»setæ–¹æ³•è·å–getteræ–¹æ³•çš„åç§° set&lt;Key&gt;:===&gt; keystatic NSString *getterForSetter(NSString *setter)&#123; if (setter.length &lt;= 0 || ![setter hasPrefix:@&quot;set&quot;] || ![setter hasSuffix:@&quot;:&quot;]) &#123; return nil;&#125; NSRange range = NSMakeRange(3, setter.length-4); NSString *getter = [setter substringWithRange:range]; NSString *firstString = [[getter substringToIndex:1] lowercaseString]; return [getter stringByReplacingCharactersInRange:NSMakeRange(0, 1) withString:firstString];&#125;#pragma mark -é‡å†™deallocstatic void zj_dealloc(id self,SEL _cmd)&#123; NSLog(@&quot;[%@ dealloc]&quot;,self); Class superClass = [self class]; object_setClass(self, superClass);&#125;@end æ€»ç»“ç»¼ä¸Šæ‰€è¿°ï¼Œè‡ªå®šä¹‰KVOå¤§è‡´åˆ†ä¸ºä¸€ä¸‹å‡ æ­¥ï¼š æ³¨å†Œè§‚å¯Ÿè€… &amp; å“åº” éªŒè¯æ˜¯å¦å­˜åœ¨ setter æ–¹æ³• åŠ¨æ€ç”Ÿæˆå­ç±»ï¼Œéœ€è¦é‡å†™ classã€setter æ–¹æ³• åœ¨å­ç±»çš„setteræ–¹æ³•ä¸­å‘çˆ¶ç±»å‘æ¶ˆæ¯ï¼Œå³ è‡ªå®šä¹‰æ¶ˆæ¯å‘é€ isaåŸæœ‰ç±»æŒ‡å‘ä¸­é—´ç±» ä¿å­˜ä¿¡æ¯ è®©è§‚å¯Ÿè€… å“åº” ç§»é™¤è§‚å¯Ÿè€… æ›´æ”¹ isaæŒ‡å‘ ä¸ºåŸæœ‰ç±» é‡å†™å­ç±»çš„ dealloc æ–¹æ³•","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†22ï¼šKVCåº•å±‚åŸç†åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†22ï¼šKVCåº•å±‚åŸç†åˆ†æ","date":"2021-01-17T08:33:44.000Z","updated":"2022-04-24T08:39:28.000Z","comments":true,"path":"2021/01/17/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†22ï¼šKVCåº•å±‚åŸç†åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2021/01/17/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8622%EF%BC%9AKVC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€KVC çš„å…¨ç§°æ˜¯ Key-Value-Coding ï¼Œç¿»è¯‘æˆä¸­æ–‡æ˜¯ é”®å€¼ç¼–ç  ï¼Œé”®å€¼ç¼–ç æ˜¯ç”±NSKeyValueCoding éæ­£å¼åè®®å¯åŠ¨çš„ä¸€ç§æœºåˆ¶ï¼Œå¯¹è±¡é‡‡ç”¨è¯¥åè®®æ¥é—´æ¥è®¿é—®å…¶å±æ€§ã€‚æ—¢å¯ä»¥é€šè¿‡ä¸€ä¸ª å­—ç¬¦ä¸²Keyæ¥è®¿é—®æŸä¸ªå±æ€§ã€‚è¿™ç§é—´æ¥è®¿é—®æœºåˆ¶è¡¥å……äº†å®ä¾‹å˜é‡åŠå…¶ç›¸å…³çš„è®¿é—®å™¨æ–¹æ³•æ‰€æä¾›çš„ç›´æ¥è®¿é—®ã€‚ KVCç›¸å…³APIå¸¸ç”¨æ–¹æ³• ä¸»è¦æœ‰ä»¥ä¸‹å››ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š é€šè¿‡ key è®¾å€¼&#x2F;å–å€¼ 12345// é€šè¿‡keyæ¥å–å€¼- (nullable id)valueForKey:(NSString *)key;// é€šè¿‡keyæ¥è®¾å€¼- (void)setValue:(nullable id)value forKey:(NSString *)key; é€šè¿‡ keyPathï¼ˆå³è·¯ç”±ï¼‰è®¾å€¼&#x2F;å–å€¼ 12345// é€šè¿‡keyPathæ¥å–å€¼-(nullable id)valueForKeyPath:(NSString *)keyPath;// é€šè¿‡keyPathæ¥è®¾å€¼-(void)setValue:(nullable id)value forKeyPath:(NSString *)keyPath; å…¶ä»–æ–¹æ³• 123é»˜è®¤è¿”å›YESï¼Œè¡¨ç¤ºå¦‚æœæ²¡æœ‰æ‰¾åˆ°Set&lt;Key&gt;æ–¹æ³•çš„è¯ï¼Œä¼šæŒ‰ç…§_keyï¼Œ_iskeyï¼Œkeyï¼Œiskeyçš„é¡ºåºæœç´¢æˆå‘˜ï¼Œè®¾ç½®æˆNOå°±ä¸è¿™æ ·æœç´¢æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®å®ä¾‹å˜é‡+(BOOL)accessInstanceVariablesDirectly; 12KVCæä¾›å±æ€§å€¼æ­£ç¡®æ€§éªŒè¯çš„APIï¼Œå®ƒå¯ä»¥ç”¨æ¥æ£€æŸ¥setçš„å€¼æ˜¯å¦æ­£ç¡®ã€ä¸ºä¸æ­£ç¡®çš„å€¼åšä¸€ä¸ªæ›¿æ¢å€¼æˆ–è€…æ‹’ç»è®¾ç½®æ–°å€¼å¹¶è¿”å›é”™è¯¯åŸå› ã€‚- (BOOL)validateValue:(inout id __nullable * __nonnull)ioValue forKey:(NSString *)inKey error:(out NSError **)outError; 12è¿™æ˜¯é›†åˆæ“ä½œçš„APIï¼Œé‡Œé¢è¿˜æœ‰ä¸€ç³»åˆ—è¿™æ ·çš„APIï¼Œå¦‚æœå±æ€§æ˜¯ä¸€ä¸ªNSMutableArrayï¼Œé‚£ä¹ˆå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥è¿”å›ã€‚- (NSMutableArray *)mutableArrayValueForKey:(NSString *)key; 12å¦‚æœKeyä¸å­˜åœ¨ï¼Œä¸”KVCæ— æ³•æœç´¢åˆ°ä»»ä½•å’ŒKeyæœ‰å…³çš„å­—æ®µæˆ–è€…å±æ€§ï¼Œåˆ™ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé»˜è®¤æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚- (nullable id)valueForUndefinedKey:(NSString *)key; 12å’Œä¸Šä¸€ä¸ªæ–¹æ³•ä¸€æ ·ï¼Œä½†è¿™ä¸ªæ–¹æ³•æ˜¯è®¾å€¼ã€‚- (void)setValue:(nullable id)value forUndefinedKey:(NSString *)key; 12å¦‚æœä½ åœ¨SetValueæ–¹æ³•æ—¶é¢ç»™Valueä¼ nilï¼Œåˆ™ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•- (void)setNilValueForKey:(NSString *)key; 12è¾“å…¥ä¸€ç»„key,è¿”å›è¯¥ç»„keyå¯¹åº”çš„Valueï¼Œå†è½¬æˆå­—å…¸è¿”å›ï¼Œç”¨äºå°†Modelè½¬åˆ°å­—å…¸ã€‚- (NSDictionary&lt;NSString *, id&gt; *)dictionaryWithValuesForKeys:(NSArray&lt;NSString *&gt; *)keys; KVCè®¾å€¼åº•å±‚åŸç†åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œé’ˆå¯¹å¯¹è±¡å±æ€§çš„èµ‹å€¼ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ ç›´æ¥é€šè¿‡ setter æ–¹æ³•èµ‹å€¼ é€šè¿‡ KVCé”®å€¼ç¼–ç  çš„ç›¸å…³APIèµ‹å€¼ 12345ZJPerson * person = [[ZJPerson alloc] init];// 1.ä¸€èˆ¬setteræ–¹æ³•person.name = @&quot;ZJ_å“ˆå“ˆ&quot;;// 2.KVCæ–¹æ³•[person setValue:@&quot;ZJ_å˜»å˜»&quot; forKey:@&quot;name&quot;]; ä¸‹é¢é’ˆå¯¹ä½¿ç”¨æœ€å¤šçš„KVCè®¾å€¼æ–¹æ³•ï¼šseValue:forKeyï¼Œæ¥è¿›è¡Œåº•å±‚åŸç†çš„æ¢ç´¢ é¦–å…ˆè¿›å…¥ seValue:forKey çš„å£°æ˜ï¼Œå‘ç°æ˜¯åœ¨ Foundation æ¡†æ¶ä¸­ï¼Œè€ŒFoundation æ¡†æ¶æ˜¯ä¸å¼€æºçš„ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥å»æ¢ç´¢åº•å±‚ï¼š é€šè¿‡ Hopper åæ±‡ç¼–ï¼ŒæŸ¥çœ‹ä¼ªä»£ç  é€šè¿‡è‹¹æœ å®˜æ–¹æ–‡æ¡£ Github æœç´¢æ˜¯å¦æœ‰ç›¸å…³çš„demo åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ Key-Value Coding Programming Guide è‹¹æœå®˜æ–¹æ–‡æ¡£æ¥ç ”ç©¶ï¼Œé’ˆå¯¹è®¾å€¼æµç¨‹ï¼Œæœ‰å¦‚ä¸‹è¯´æ˜ å½“è°ƒç”¨ seValue:forKey è®¾å€¼å±æ€§ value æ—¶ï¼Œå…¶åº•å±‚çš„æ‰§è¡Œæµç¨‹ä¸ºï¼š ã€ç¬¬ä¸€æ­¥ã€‘ é¦–å…ˆæŸ¥æ‰¾æ˜¯å¦æœ‰è¿™ä¸‰ç§ setter æ–¹æ³•ï¼ŒæŒ‰ç…§æŸ¥æ‰¾é¡ºåºä¸º set&lt;Key&gt; ã€_set&lt;Key&gt;ã€setIs&lt;Key&gt; å¦‚æœ æœ‰å…¶ä¸­ä»»æ„ä¸€ä¸ª setteræ–¹æ³•ï¼Œåˆ™ ç›´æ¥è®¾å€¼å±æ€§çš„valueï¼ˆæ³¨æ„ï¼škeyæ˜¯æŒ‡æˆåŠŸå˜é‡åï¼Œé¦–å­—æ¯çš„å¤§å°å†™éœ€è¦ç¬¦åˆKVCçš„å‘½åè§„èŒƒï¼‰ å¦‚æœéƒ½ æ²¡æœ‰ ï¼Œåˆ™è¿›å…¥ ã€ç¬¬äºŒæ­¥ã€‘ ã€ç¬¬äºŒæ­¥ã€‘ å¦‚æœæ²¡æœ‰ç¬¬ä¸€æ­¥çš„ä¸‰ä¸ªç®€å•çš„setteræ–¹æ³•ï¼Œåˆ™æŸ¥æ‰¾accessInstanceVariablesDirectly æ˜¯å¦è¿”å› YES å¦‚æœè¿”å› YESï¼Œåˆ™æŸ¥æ‰¾é—´æ¥è®¿é—®çš„å®ä¾‹å˜é‡è¿›è¡Œèµ‹å€¼ï¼ŒæŸ¥æ‰¾é¡ºåºä¸ºï¼š_&lt;key&gt;ã€_is&lt;Key&gt;ã€&lt;key&gt;ã€is&lt;Key&gt; å¦‚æœæ‰¾åˆ°å…¶ä¸­ä»»æ„ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œåˆ™èµ‹å€¼ å¦‚æœéƒ½æ²¡æœ‰ï¼Œåˆ™è¿›å…¥ ã€ç¬¬ä¸‰æ­¥ã€‘ å¦‚æœè¿”å›NOï¼Œåˆ™è¿›å…¥ ã€ç¬¬ä¸‰æ­¥ã€‘ ã€ç¬¬ä¸‰æ­¥ã€‘ å¦‚æœ setteræ–¹æ³• æˆ–è€… å®ä¾‹å˜é‡ éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œè¯¥å¯¹è±¡çš„seValue:forUnderfinedKey:æ–¹æ³•ï¼Œé»˜è®¤æŠ›å‡ºNSUnderfinedKeyExceptionç±»å‹çš„å¼‚å¸¸ ç»¼ä¸Šæ‰€è¿°ï¼ŒKVCé€šè¿‡ seValue:forKey æ–¹æ³•è®¾å€¼çš„æµç¨‹ï¼Œä»¥ZJPersonçš„å¯¹è±¡personçš„å±æ€§nameä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š KVCå–å€¼åº•å±‚åŸç†åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£åˆ†æKVCå–å€¼çš„åº•å±‚åŸç† å½“è°ƒç”¨ valueForKey æ—¶ï¼Œå…¶åº•å±‚çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š ã€ç¬¬ä¸€æ­¥ã€‘ é¦–å…ˆæŸ¥æ‰¾ getter æ–¹æ³•ï¼ŒæŒ‰ç…§ï¼šget&lt;Key&gt;ã€&lt;key&gt;ã€is&lt;Key&gt;ã€_&lt;key&gt; çš„æ–¹æ³•é¡ºåºæŸ¥æ‰¾ å¦‚æœ æ‰¾åˆ° ï¼Œåˆ™è¿›å…¥ ã€ç¬¬äº”æ­¥ã€‘ å¦‚æœ æ²¡æœ‰æ‰¾åˆ° ï¼Œåˆ™è¿›å…¥ ã€ç¬¬äºŒæ­¥ã€‘ ã€ç¬¬äºŒæ­¥ã€‘ å¦‚æœç¬¬ä¸€æ­¥ä¸­çš„ getter æ–¹æ³•æ²¡æœ‰æ‰¾åˆ°ï¼ŒKVCä¼šæŸ¥æ‰¾ï¼šcountOf&lt;Key&gt;ã€objectIn&lt;Key&gt; AtIndex:ã€&lt;key&gt;AtIndex: å¦‚æœæ‰¾åˆ° countOf&lt;Key&gt; å’Œå…¶ä»–ä¸¤ä¸ªä¸­çš„ä¸€ä¸ªï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªå“åº”æ‰€æœ‰ NSArray æ–¹æ³•çš„ é›†åˆä»£ç†å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ï¼Œå³ NSKeyValueArrayï¼Œæ˜¯NSArray çš„å­ç±»ã€‚ä»£ç†å¯¹è±¡éšåå°†æ¥æ”¶åˆ°çš„æ‰€æœ‰ NSArray æ¶ˆæ¯è½¬æ¢ä¸ºcountOf&lt;Key&gt;ã€objectIn&lt;Key&gt; AtIndex:ã€&lt;key&gt;AtIndex: æ¶ˆæ¯çš„æŸç§ç»„åˆï¼Œç”¨æ¥åˆ›å»ºé”®å€¼ç¼–ç å¯¹è±¡ã€‚å¦‚æœåŸå§‹å¯¹è±¡è¿˜å®ç°äº†ä¸€ä¸ªåä¸º get&lt;Key&gt;ï¼šrangeï¼šä¹‹ç±»çš„å¯é€‰æ–¹æ³•ï¼Œåˆ™ä»£ç†å¯¹è±¡ä¹Ÿå°†åœ¨é€‚å½“æ—¶ä½¿ç”¨è¯¥æ–¹æ³•ï¼ˆæ³¨æ„ï¼šæ–¹æ³•åçš„å‘½åè§„åˆ™è¦ç¬¦åˆKVCçš„æ ‡å‡†å‘½åæ–¹æ³•ï¼ŒåŒ…æ‹¬æ–¹æ³•ç­¾åã€‚ï¼‰ å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸‰ä¸ªè®¿é—®æ•°ç»„ï¼Œåˆ™ç»§ç»­è¿›å…¥ ã€ç¬¬ä¸‰æ­¥ã€‘ ã€ç¬¬ä¸‰æ­¥ã€‘ å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸Šé¢çš„å‡ ç§æ–¹æ³•ï¼Œåˆ™ä¼šåŒæ—¶æŸ¥æ‰¾ countOf &lt;Key&gt;ï¼ŒenumeratorOf&lt;Key&gt;å’ŒmemberOf&lt;Key&gt; è¿™ä¸‰ä¸ªæ–¹æ³• å¦‚æœè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ‰¾åˆ°ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªå“åº” æ‰€æœ‰NSSetæ–¹æ³•çš„é›†åˆä»£ç†å¯¹è±¡ ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ï¼Œæ­¤ä»£ç†å¯¹è±¡éšåå°†å…¶æ”¶åˆ°çš„æ‰€æœ‰ NSSet æ¶ˆæ¯è½¬æ¢ä¸º countOf&lt;Key&gt;ï¼ŒenumeratorOf&lt;Key&gt;å’ŒmemberOf&lt;Key&gt;ï¼š æ¶ˆæ¯çš„æŸç§ç»„åˆï¼Œç”¨äºåˆ›å»ºå®ƒçš„å¯¹è±¡ å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›å…¥ ã€ç¬¬å››æ­¥ã€‘ ã€ç¬¬å››æ­¥ã€‘ å¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œæ£€æŸ¥ç±»æ–¹æ³• InstanceVariablesDirectly æ˜¯å¦ YESï¼Œä¾æ¬¡æœç´¢ _&lt;key&gt;ï¼Œ_is&lt;Key&gt;ï¼Œ&lt;key&gt; æˆ– is&lt;Key&gt; çš„å®ä¾‹å˜é‡ å¦‚æœæœåˆ°ï¼Œç›´æ¥è·å–å®ä¾‹å˜é‡çš„å€¼ï¼Œè¿›å…¥ ã€ç¬¬äº”æ­¥ã€‘ ã€ç¬¬äº”æ­¥ã€‘ æ ¹æ®æœç´¢åˆ°çš„å±æ€§å€¼çš„ç±»å‹ï¼Œè¿”å›ä¸åŒçš„ç»“æœ å¦‚æœæ˜¯å¯¹è±¡æŒ‡é’ˆï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœ å¦‚æœæ˜¯ NSNumberæ”¯æŒ çš„æ ‡é‡ç±»å‹ï¼Œåˆ™å°†å…¶ å­˜å‚¨åœ¨NSNumberå®ä¾‹ ä¸­å¹¶è¿”å›å®ƒ å¦‚æœæ˜¯æ˜¯ NSNumberä¸æ”¯æŒ çš„æ ‡é‡ç±»å‹ï¼Œè¯· è½¬æ¢ä¸ºNSValueå¯¹è±¡ å¹¶è¿”å›è¯¥å¯¹è±¡ ã€ç¬¬å…­æ­¥ã€‘ å¦‚æœä¸Šé¢5æ­¥çš„æ–¹æ³• å‡å¤±è´¥ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œè¯¥å¯¹è±¡çš„valueForUndefinedKey: æ–¹æ³•ï¼Œé»˜è®¤æŠ›å‡º NSUndefinedKeyException ç±»å‹çš„å¼‚å¸¸ ç»¼ä¸Šæ‰€è¿°ï¼ŒKVCé€šè¿‡ valueForKey: æ–¹æ³•å–å€¼çš„æµç¨‹ä»¥è®¾å€¼ ZJPerson çš„å¯¹è±¡personçš„å±æ€§ name ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è‡ªå®šä¹‰KVCåŸç†ï¼šé€šè¿‡ç»™ NSObject æ·»åŠ  åˆ†ç±»ZJKVCï¼Œå®ç°è‡ªå®šä¹‰çš„ zj_setValueï¼šforKeyï¼š å’Œ zj_valueForKeyï¼š æ–¹æ³•ï¼Œæ ¹æ®è‹¹æœå®˜æ–¹æ–‡æ¡£æä¾›çš„æŸ¥æ‰¾è§„åˆ™è¿›è¡Œå®ç°ï¼š 123456@interface NSObject (ZJKVC)// è®¾å€¼- (void)zj_setValue:(nullable id)value forKey:(NSString *)key;// å–å€¼- (nullable id)zj_valueForKey:(NSString *)key;@end è‡ªå®šä¹‰KVCè®¾å€¼è‡ªå®šä¹‰KVCè®¾å€¼ 1ã€åˆ¤æ–­ keyéç©º 2ã€æŸ¥æ‰¾ setter æ–¹æ³•ï¼Œé¡ºåºæ˜¯ï¼šsetXXXã€_setXXXã€setIsXXX 3ã€åˆ¤æ–­æ˜¯å¦å“åº” accessInstanceVariablesDirectly æ–¹æ³•ï¼Œå³é—´æ¥è®¿é—®å®ä¾‹å˜é‡ è¿”å› YESï¼Œç»§ç»­ä¸‹ä¸€æ­¥è®¾å€¼ è¿”å› NOï¼Œåˆ™å´©æºƒ 4ã€é—´æ¥è®¿é—®å˜é‡èµ‹å€¼ï¼ˆåªä¼šèµ°ä¸€æ¬¡ï¼‰ï¼Œé¡ºåºæ˜¯ï¼š_keyã€_isKeyã€keyã€isKey å®šä¹‰ä¸€ä¸ªæ‰‹æœºå®ä¾‹å˜é‡çš„å¯å˜æ•°ç»„ é€šè¿‡class_getInstanceVariable æ–¹æ³•ï¼Œè·å–å“åº”çš„ivar é€šè¿‡object_setIvaræ–¹æ³•ï¼Œå¯¹å“åº”çš„ivarè®¾å€¼å€¼ 5ã€å¦‚æœæ‰¾ä¸åˆ°ç›¸å…³å®ä¾‹å˜é‡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263@implementation NSObject (ZJKVC)// è®¾å€¼- (void)zj_setValue:(nullable id)value forKey:(NSString *)key&#123; // 1.åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ if (key == nil || key.length == 0) &#123; return; &#125; // 2.æ‰¾setteræ–¹æ³•ï¼Œé¡ºåºæ˜¯ï¼šsetXXXã€_setXXXã€setIsXXX NSString * Key = key.capitalizedString; // key è¦å¤§å†™ NSString * setKey = [NSString stringWithFormat:@&quot;set%@:&quot;, Key]; NSString * _setKey = [NSString stringWithFormat:@&quot;_set%@:&quot;, Key]; NSString * setIsKey = [NSString stringWithFormat:@&quot;setIs%@:&quot;, Key]; // åˆ¤æ–­æ˜¯å¦æœ‰æ–¹æ³• if ([self zj_performSelectorWithMethodName:setKey value:value]) &#123; NSLog(@&quot;*************%@*************&quot;, setKey); return; &#125;else if ([self zj_performSelectorWithMethodName:_setKey value:value]) &#123; NSLog(@&quot;*************%@*************&quot;, _setKey); return; &#125;if([self zj_performSelectorWithMethodName:setIsKey value:value])&#123; NSLog(@&quot;*************%@*************&quot;, setIsKey); return; &#125; // 3ã€åˆ¤æ–­æ˜¯å¦å“åº”accessInstanceVariablesDirectlyæ–¹æ³•ï¼Œå³é—´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œè¿”å›YESï¼Œç»§ç»­ä¸‹ä¸€æ­¥è®¾å€¼ï¼Œå¦‚æœæ˜¯NOï¼Œåˆ™å´©æºƒ if (![self.class accessInstanceVariablesDirectly]) &#123; @throw [NSException exceptionWithName:@&quot;ZJUnKnownKeyException&quot; reason:[NSString stringWithFormat:@&quot;***[%@ valueForUnderfinedKey:] this class is not key value coding-compliant for the key name.***&quot;] userInfo:nil]; &#125; // 4.é—´æ¥è®¿é—®å˜é‡èµ‹å€¼ï¼Œé¡ºåºä¸ºï¼š_keyã€_isKeyã€keyã€isKey // 4.1 å®šä¹‰ä¸€ä¸ªæ‰‹æœºå®ä¾‹å˜é‡çš„å¯å˜æ•°ç»„ NSMutableArray * mArray = [self getIvarListName]; // _keyã€_isKeyã€keyã€isKey NSString * _key = [NSString stringWithFormat:@&quot;_%@:&quot;, Key]; NSString * _isKey = [NSString stringWithFormat:@&quot;_is%@:&quot;, Key]; NSString * isKey = [NSString stringWithFormat:@&quot;is%@:&quot;, Key]; if ([mArray containsObject:_key]) &#123; // 4.2 è·å–å“åº”çš„ ivar Ivar ivar = class_getInstanceVariable([self class], _key.UTF8String); // 4.3 å¯¹ç›¸åº”çš„ ivar è®¾å€¼å€¼ object_setIvar(self, ivar, value); return; &#125;else if ([mArray containsObject:_isKey]) &#123; Ivar ivar = class_getInstanceVariable([self class], _isKey.UTF8String); object_setIvar(self, ivar, value); return; &#125;else if ([mArray containsObject:key]) &#123; Ivar ivar = class_getInstanceVariable([self class], key.UTF8String); object_setIvar(self, ivar, value); return; &#125;else if ([mArray containsObject:isKey]) &#123; Ivar ivar = class_getInstanceVariable([self class], isKey.UTF8String); object_setIvar(self, ivar, value); return; &#125; // 5.å¦‚æœæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸ @throw [NSException exceptionWithName:@&quot;ZJUnknownKeyException&quot; reason:[NSString stringWithFormat:@&quot;****[%@ %@]: this class is not key value coding-compliant for the key name.****&quot;,self,NSStringFromSelector(_cmd)] userInfo:nil];&#125; ç›¸å…³æ–¹æ³• 123456789101112131415161718192021222324#pragma mark - ç›¸å…³æ–¹æ³•- (BOOL)zj_performSelectorWithMethodName:(NSString *)methodName value:(id)value&#123; if ([self respondsToSelector:NSSelectorFromString(methodName)]) &#123;#pragma clang diagnostic push // å¦‚æœä½ ç¡®å®šä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„è¯­å¥æ¥å¿½ç•¥æ‰è¿™æ¡è­¦å‘Š#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot; [self performSelector:NSSelectorFromString(methodName) withObject:value];#pragma clang diagnostic pop return YES; &#125; return NO;&#125;- (id)performSelectorWithMethodName:(NSString *)methodName&#123; if ([self respondsToSelector:NSSelectorFromString(methodName)]) &#123;#pragma clang diagnostic push // å¦‚æœä½ ç¡®å®šä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„è¯­å¥æ¥å¿½ç•¥æ‰è¿™æ¡è­¦å‘Š#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot; return [self performSelector:NSSelectorFromString(methodName) ];#pragma clang diagnostic pop &#125; return nil;&#125; è·å–æˆå‘˜å˜é‡ 123456789101112131415161718192021222324#pragma mark -è·å–æˆå‘˜å˜é‡å- (NSMutableArray *)getIvarListName&#123; // åˆ›å»ºå¯å˜æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ivaræˆå‘˜å˜é‡ NSMutableArray * mArray = [NSMutableArray arrayWithCapacity:1]; unsigned int count = 0; // è·å–ç±»çš„æˆå‘˜å˜é‡åˆ—è¡¨ Ivar * ivars = class_copyIvarList([self class], &amp;count); // éå†æˆå‘˜å˜é‡åˆ—è¡¨ for (int i = 0; i&lt;count; i++) &#123; Ivar ivar = ivars[i]; // è·å–æˆå‘˜å˜é‡åå­—å­—ç¬¦ const char * ivarNameChar = ivar_getName(ivar); // å°†å­—ç¬¦è½¬æ¢æˆå­—ç¬¦ä¸² NSString * ivarName = [NSString stringWithUTF8String:ivarNameChar]; NSLog(@&quot;ivarName == %@&quot;, ivarName); // å­˜å…¥å¯å˜æ•°ç»„ [mArray addObject:ivarName]; &#125; //é‡Šæ”¾æˆå‘˜å˜é‡åˆ—è¡¨ free(ivars); return mArray;&#125;@end è‡ªå®šä¹‰KVCå–å€¼ 1ã€åˆ¤æ–­ keyéç©º 2ã€æŸ¥æ‰¾ç›¸åº”æ–¹æ³•ï¼Œé¡ºåºæ˜¯ get&lt;Key&gt;ã€&lt;key&gt;ã€countOf&lt;Key&gt;ã€objectIn&lt;Key&gt;AtIndex 3ã€åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿç›´æ¥èµ‹å€¼å®ä¾‹å˜é‡ï¼Œå³åˆ¤æ–­æ˜¯å¦å“åº” accessInstanceVariablesDirectly æ–¹æ³•ï¼Œé—´æ¥è®¿é—®å®ä¾‹å˜é‡ è¿”å› YESï¼Œç»§ç»­ä¸‹ä¸€æ­¥å–å€¼ è¿”å› NOï¼Œåˆ™å´©æºƒ 4ã€é—´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œé¡ºåºæ˜¯ _&lt;key&gt;ã€_is&lt;Key&gt;ã€&lt;key&gt;ã€is&lt;Key&gt; å®šä¹‰ä¸€ä¸ªæ‰‹æœºå®ä¾‹å˜é‡çš„å¯å˜æ•°ç»„ é€šè¿‡class_getInstanceVariableæ–¹æ³•ï¼Œè·å–ç›¸åº”çš„ivar é€šè¿‡object_getIvaræ–¹æ³•ï¼Œè¿”å›ç›¸åº”çš„ivarçš„å€¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970#pragma mark -å–å€¼- (nullable id)zj_valueForKey:(NSString *)key&#123; // 1ã€åˆ¤æ–­éç©º if (key == nil || key.length == 0) &#123; return nil; &#125; // 2ã€æ‰¾åˆ°ç›¸å…³æ–¹æ³•ï¼šget&lt;Key&gt;ã€&lt;key&gt;ã€countOf&lt;Key&gt; ã€objectIn&lt;Key&gt;AtIndex // key è¦å¤§å†™ NSString * Key = key.capitalizedString; // æ‹¼æ¥æ–¹æ³• NSString * getKey = [NSString stringWithFormat:@&quot;get%@&quot;,Key]; NSString * countOfKey = [NSString stringWithFormat:@&quot;countOf%@&quot;,Key]; NSString * objectInKeyAtIndex = [NSString stringWithFormat:@&quot;objectIn%@AtIndex:&quot;,Key];#pragma clang diagnostic push#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot; if ([self respondsToSelector:NSSelectorFromString(getKey)]) &#123; return [self performSelector:NSSelectorFromString(getKey)]; &#125;else if ([self respondsToSelector:NSSelectorFromString(key)])&#123; return [self performSelector:NSSelectorFromString(key)]; &#125; // é›†åˆç±»å‹ else if ([self respondsToSelector:NSSelectorFromString(countOfKey)])&#123; if ([self respondsToSelector:NSSelectorFromString(objectInKeyAtIndex)]) &#123; int num = (int)[self performSelector:NSSelectorFromString(countOfKey)]; NSMutableArray *mArray = [NSMutableArray arrayWithCapacity:1]; for (int i = 0; i&lt;num-1; i++) &#123; num = (int)[self performSelector:NSSelectorFromString(countOfKey)]; &#125; for (int j = 0; j&lt;num; j++) &#123; id objc = [self performSelector:NSSelectorFromString(objectInKeyAtIndex) withObject:@(num)]; [mArray addObject:objc]; &#125; return mArray; &#125; &#125;#pragma clang diagnostic pop // 3ã€åˆ¤æ–­æ˜¯å¦å“åº”`accessInstanceVariablesDirectly`æ–¹æ³•ï¼Œå³é—´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼Œè¿”å›YESï¼Œç»§ç»­ä¸‹ä¸€æ­¥è®¾å€¼ï¼Œå¦‚æœæ˜¯NOï¼Œåˆ™å´©æºƒ if (![self.class accessInstanceVariablesDirectly]) &#123; @throw [NSException exceptionWithName:@&quot;ZJLUnKnownKeyException&quot; reason:[NSString stringWithFormat:@&quot;****[%@ valueForUndefinedKey:]: this class is not key value coding-compliant for the key name.****&quot;,self] userInfo:nil]; &#125; // 4.æ‰¾ç›¸å…³å®ä¾‹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œé¡ºåºä¸ºï¼š_&lt;key&gt;ã€ _is&lt;Key&gt;ã€ &lt;key&gt;ã€ is&lt;Key&gt; // 4.1 å®šä¹‰ä¸€ä¸ªæ”¶é›†å®ä¾‹å˜é‡çš„å¯å˜æ•°ç»„ NSMutableArray *mArray = [self getIvarListName]; // ä¾‹å¦‚ï¼š_name -&gt; _isName -&gt; name -&gt; isName NSString * _key = [NSString stringWithFormat:@&quot;_%@&quot;,key]; NSString * _isKey = [NSString stringWithFormat:@&quot;_is%@&quot;,Key]; NSString * isKey = [NSString stringWithFormat:@&quot;is%@&quot;,Key]; if ([mArray containsObject:_key]) &#123; Ivar ivar = class_getInstanceVariable([self class], _key.UTF8String); return object_getIvar(self, ivar);; &#125;else if ([mArray containsObject:_isKey]) &#123; Ivar ivar = class_getInstanceVariable([self class], _isKey.UTF8String); return object_getIvar(self, ivar);; &#125;else if ([mArray containsObject:key]) &#123; Ivar ivar = class_getInstanceVariable([self class], key.UTF8String); return object_getIvar(self, ivar);; &#125;else if ([mArray containsObject:isKey]) &#123; Ivar ivar = class_getInstanceVariable([self class], isKey.UTF8String); return object_getIvar(self, ivar);; &#125; return @&quot;&quot;;&#125; ä½¿ç”¨è·¯ç”±è®¿é—®ï¼Œå³keyPathåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æœ‰å¯èƒ½æ˜¯è‡ªå®šä¹‰ç±»æˆ–è€…å…¶ä»–çš„å¤æ‚æ•°æ®ç±»å‹ï¼Œä¸€èˆ¬çš„æ“ä½œæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡KVCè·å–è¯¥å±æ€§ï¼Œç„¶åå†é€šè¿‡KVCè·å–è‡ªå®šä¹‰ç±»çš„å±æ€§ï¼Œå°±æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜æœ‰å¦ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ KeyPath å³è·¯ç”±ï¼Œæ¶‰åŠä¸€ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š setValue:forKeyPath: å’Œ valueForKeyPath: 1234// é€šè¿‡KeyPathæ¥è®¾å€¼- (void)setValue:(nullable id)value forKeyPath:(NSString *)keyPath;// é€šè¿‡KeyPathæ¥å–å€¼- (nullable id)valueForKeyPath:(NSString *)kePath; å‚è€ƒå¦‚ä¸‹çš„æ¡ˆä¾‹ 123456789101112131415161718192021222324252627// ZJPersonç±»@interface ZJPerson : NSObject@property (nonatomic, copy) NSString *age;@property (nonatomic, strong) ZJStudent *student;@end// ZJStudentç±»@interface ZJStudent : NSObject@property (nonatomic, copy) NSString *name;@endint main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; ZJPerson *person = [[ZJPerson alloc] init]; ZJStudent *student = [ZJStudent alloc]; student.name = @&quot;ZJ&quot;; person.student = student; //æ ¹æ®kvc - keyPathè·¯ç”±ä¿®æ”¹studentçš„subjectå±æ€§çš„å€¼ [person setValue:@&quot;å˜»å˜»&quot; forKeyPath:@&quot;student.name&quot;]; NSLog(@&quot;%@&quot;,[person valueForKeyPath:@&quot;student.name&quot;]); &#125; return 0;&#125;//*************æ‰“å°ç»“æœ*************2021-5-27 09:55:08.512833+0800 001-KVCç®€ä»‹[58089:6301894] æ”¹å˜å‰ï¼šZJ2021-5-27 09:55:08.512929+0800 001-KVCç®€ä»‹[58089:6301894] æ”¹å˜åï¼šå˜»å˜» KVCçš„ä½¿ç”¨åœºæ™¯ 1ã€åŠ¨æ€è®¾å€¼å’Œå–å€¼ å¸¸ç”¨çš„å¯ä»¥é€šè¿‡ setValue:forKey: å’Œ valueForKey: ä¹Ÿå¯ä»¥é€šè¿‡è·¯ç”±çš„æ–¹å¼ setValue:forKeyPath: å’Œ valueForKeyPath: 2ã€é€šè¿‡KVCè®¿é—®å’Œä¿®æ”¹ç§æœ‰å˜é‡ åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯¹äºç±»çš„ç§æœ‰å±æ€§ï¼Œåœ¨å¤–éƒ¨å®šä¹‰çš„å¯¹è±¡ï¼Œæ˜¯ æ— æ³•ç›´æ¥è®¿é—®ç§æœ‰å±æ€§çš„ï¼Œä½†æ˜¯å¯¹äºKVCè€Œè¨€ï¼Œä¸€ä¸ªå¯¹è±¡æ²¡æœ‰è‡ªå·±çš„éšç§ï¼Œæ‰€ä»¥å¯ä»¥ é€šè¿‡KVCä¿®æ”¹å’Œè®¿é—®ä»»ä½•ç§æœ‰å±æ€§ 3ã€å¤šå€¼æ“ä½œï¼ˆmodelå’Œå­—å…¸äº’è½¬ï¼‰ modelå’Œå­—å…¸çš„è½¬æ¢å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ä¸ªKVCçš„APIå®ç° 123456// å­—å…¸è½¬æ¨¡å‹- (void)setValuesForKeysWithDictionary:(NSDictionary&lt;NSString *, id&gt; *)keyedValues;// æ¨¡å‹è½¬å­—å…¸- (NSDictionary&lt;NSString *, id&gt; *)dictionaryWithValuesForKeys:(NSArray&lt;NSString *&gt; *)keys; 4ã€ä¿®æ”¹ä¸€äº›ç³»ç»Ÿç©ºé—´çš„å†…éƒ¨å±æ€§ åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¾ˆå¤šUIæ§ä»¶éƒ½æ˜¯åœ¨å…¶å†…éƒ¨ç”±å¤šä¸ªUIç©ºé—´ç»„åˆè€Œæˆï¼Œè¿™äº›å†…éƒ¨æ§ä»¶è‹¹æœå¹¶æ²¡æœ‰æä¾›è®¿é—®çš„APIï¼Œä½†æ˜¯ä½¿ç”¨KVCå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸¸ç”¨çš„å°±æ˜¯ è‡ªå®šä¹‰tabbarã€ä¸ªæ€§åŒ–UITextFieldä¸­çš„placeHolderText 5ã€ç”¨KVCå®ç°é«˜é˜¶æ¶ˆæ¯ä¼ é€’ åœ¨å¯¹å®¹å™¨ç±»ä½¿ç”¨KVCæ—¶ï¼ŒvalueForKey: å°†ä¼šè¢«ä¼ é€’ç»™å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯å¯¹å®¹å™¨æœ¬èº«è¿›è¡Œæ“ä½œï¼Œç»“æœä¼šè¢«æ·»åŠ åˆ°è¿”å›çš„å®¹å™¨ä¸­ï¼Œè¿™æ ·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œé›†åˆ æ¥è¿”å› å¦ä¸€ä¸ªé›†åˆ å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122// KVCå®ç°é«˜é˜¶æ¶ˆæ¯ä¼ é€’- (void)transmitMsg&#123; NSArray *arrStr = @[@&quot;english&quot;, @&quot;franch&quot;, @&quot;chinese&quot;]; NSArray *arrCapStr = [arrStr valueForKey:@&quot;capitalizedString&quot;]; for (NSString *str in arrCapStr) &#123; NSLog(@&quot;%@&quot;, str); &#125; NSArray *arrCapStrLength = [arrCapStr valueForKeyPath:@&quot;capitalizedString.length&quot;]; for (NSNumber *length in arrCapStrLength) &#123; NSLog(@&quot;%ld&quot;, (long)length.integerValue); &#125;&#125;//********æ‰“å°ç»“æœ********2021-5-27 11:33:43.377672+0800 CJLCustom[60035:6380757] English2021-5-27 11:33:43.377773+0800 CJLCustom[60035:6380757] Franch2021-5-27 11:33:43.377860+0800 CJLCustom[60035:6380757] Chinese2021-5-27 11:33:43.378233+0800 CJLCustom[60035:6380757] 72021-5-27 11:33:43.378327+0800 CJLCustom[60035:6380757] 62021-5-27 11:33:43.378417+0800 CJLCustom[60035:6380757] 7","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†21ï¼šMethod-Swizzlingæ–¹æ³•äº¤æ¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†21ï¼šMethod-Swizzlingæ–¹æ³•äº¤æ¢","date":"2021-01-10T07:22:47.000Z","updated":"2022-03-15T02:55:37.000Z","comments":true,"path":"2021/01/10/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†21ï¼šMethod-Swizzlingæ–¹æ³•äº¤æ¢/","link":"","permalink":"https://www.bboyzj.cn/2021/01/10/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8621%EF%BC%9AMethod-Swizzling%E6%96%B9%E6%B3%95%E4%BA%A4%E6%8D%A2/","excerpt":"","text":"method-swizzling æ˜¯ä»€ä¹ˆï¼Ÿ method-swizzling çš„å«ä¹‰æ˜¯ æ–¹æ³•äº¤æ¢ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ åœ¨è¿è¡Œæ—¶å°†ä¸€ä¸ªæ–¹æ³•çš„å®ç°æ›¿æ¢æˆå¦ä¸€ä¸ªæ–¹æ³•çš„å®ç°ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ iOSé»‘é­”æ³• åœ¨OCä¸­å°±æ˜¯ åˆ©ç”¨method-swizzlingå®ç°AOPï¼Œå…¶ä¸­ AOP(Aspect Oriented Programingï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ï¼ŒåŒºåˆ«äº OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰ OOPå’ŒAOPéƒ½æ˜¯ä¸€ç§ç¼–ç¨‹çš„æ€æƒ³ OOPç¼–ç¨‹æ€æƒ³æ›´åŠ å€¾å‘äºå¯¹ä¸šåŠ¡æ¨¡å—çš„å°è£…ï¼Œåˆ’åˆ†å‡ºæ›´åŠ æ¸…æ™°çš„é€»è¾‘å•å…ƒ è€ŒAOPæ˜¯é¢å‘åˆ‡é¢è¿›è¡Œæå–å°è£…ï¼Œæå–å„ä¸ªæ¨¡å—ä¸­çš„å…¬å…±éƒ¨åˆ†ï¼Œæé«˜æ¨¡å—çš„å¤ç”¨ç‡ï¼Œé™ä½ä¸šåŠ¡ä¹‹é—´çš„è€¦åˆæ€§ æ¯ä¸ªç±» éƒ½ç»´æŠ¤è€…ä¸€ä¸ª æ–¹æ³•åˆ—è¡¨ï¼Œå³ method_list,method_list ä¸­æœ‰ä¸åŒçš„ æ–¹æ³• å³ Methodï¼Œæ¯ä¸ªæ–¹æ³•ä¸­åŒ…å«äº†æ–¹æ³•çš„ sel å’Œ IMPï¼Œæ–¹æ³•äº¤æ¢å°±æ˜¯ å°†selå’ŒIMPåŸæœ¬çš„å¯¹åº”æ–­å¼€ï¼Œå¹¶å°†selå’Œæ–°çš„IMPç”Ÿæˆå¯¹åº”å…³ç³» å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œäº¤æ¢å‰åçš„ sel å’Œ IMP çš„å¯¹åº”å…³ç³»ï¼š method-swizzling æ¶‰åŠçš„ç›¸å…³API é€šè¿‡ sel è·å–æ–¹æ³• Method class_getInstanceMethodï¼šè·å–å®ä¾‹æ–¹æ³• class_getClassMethodï¼šè·å–ç±»æ–¹æ³• method_getImplementationï¼šè·å–ä¸€ä¸ªæ–¹æ³•çš„å®ç° method_setImplementationï¼šè®¾ç½®ä¸€ä¸ªæ–¹æ³•çš„å®ç° method_getTypeEncodingï¼šè·å–æ–¹æ³•å®ç°çš„ç¼–ç ç±»å‹ class_addMethodï¼šæ·»åŠ æ–¹æ³•å®ç° class_replaceMethodï¼šç”¨ä¸€ä¸ªæ–¹æ³•çš„å®ç°ï¼Œæ›¿æ¢å¦ä¸€ä¸ªæ–¹æ³•çš„å®ç°ï¼Œå³ aIMP æŒ‡å‘ bIMPï¼Œä½†æ˜¯ bIMP ä¸ä¸€å®šæŒ‡å‘ aIMP method_exchangeImplementationsï¼šäº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°ï¼Œå³ aIMP -&gt; bIMPï¼ŒbIMP -&gt; aIMP å‘ç‚¹1ï¼šmethod-swizzling ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸€æ¬¡æ€§çš„é—®é¢˜æ‰€è°“çš„ä¸€æ¬¡æ€§å°±æ˜¯ï¼šmethod-swizzling å†™åœ¨ load æ–¹æ³•ä¸­ï¼Œè€Œ load æ–¹æ³•ä¼šä¸»åŠ¨è°ƒç”¨å¤šæ¬¡ï¼Œè¿™æ ·ä¼š å¯¼è‡´æ–¹æ³•çš„é‡å¤äº¤æ¢ï¼Œä½¿æ–¹æ³• sel çš„æŒ‡å‘åˆæ¢å¤æˆåŸæ¥çš„ imp çš„é—®é¢˜ ã€è§£å†³æ–¹æ¡ˆã€‘ å¯ä»¥é€šè¿‡ å•ä¾‹è®¾è®¡ åŸåˆ™ï¼Œä½¿æ–¹æ³•äº¤æ¢ åªæ‰§è¡Œä¸€æ¬¡ï¼Œåœ¨ OC ä¸­å¯ä»¥é€šè¿‡ dispatch_once å®ç°å•ä¾‹ 123456+ (void)load&#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; [ZJRuntimeTool zj_methodSwizzlingWithClass:self oriSEL:@selector(helloworld) swizzledSEL:@selector(sayHello)]; &#125;);&#125; å‘ç‚¹2ï¼šå­ç±»æ²¡æœ‰å®ç°ï¼Œçˆ¶ç±»å®ç°äº†åœ¨ä¸‹é¢çš„è¿™æ®µä»£ç ä¸­ï¼ŒZJPerson ä¸­å®ç°äº† personInstanceMethodï¼Œè€Œ ZJStudent ç»§æ‰¿è‡ª ZJPersonï¼Œæ²¡æœ‰å®ç° personInstanceMethodï¼Œè¿è¡Œä¸‹é¢çš„è¿™æ®µä»£ç ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ 12345678910111213141516171819202122232425262728293031323334353637// ***ZJPersonç±»****@interface ZJPerson : NSObject- (void)personInstanceMethod;@end@implementation ZJPerson- (void)personInstanceMethod&#123; NSLog(@&quot;personå¯¹è±¡æ–¹æ³•:%s&quot;,__func__);&#125;@end// ******ZJStudentç±»******@interface ZJStudent : ZJPerson- (void)helloword;+ (void)sayHello;@end@implementation ZJStudent- (void)helloword&#123; NSLog(@&quot;studentå¯¹è±¡æ–¹æ³•:%s&quot;,__func__);&#125;+ (void)sayHello&#123; NSLog(@&quot;studentç±»æ–¹æ³•:%s&quot;,__func__);&#125;@end//*****VC****@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; // é»‘é­”æ³•å‘ç‚¹äºŒï¼šå­ç±»æ²¡æœ‰å®ç° - çˆ¶ç±»å®ç° ZJStudent * student = [[ZJStudent alloc] init]; [student personInstanceMethod]; ZJPerson * person = [[ZJPerson alloc] init]; [person personInstanceMethod];&#125;@end å…¶ä¸­ï¼Œæ–¹æ³•äº¤æ¢ä»£ç å¦‚ä¸‹ï¼Œæ˜¯é€šè¿‡ ZJStudent çš„åˆ†ç±» ZJ å®ç° 1234567891011121314151617181920// ****ZJStudent+ZJåˆ†ç±»*****@interface ZJStudent (ZJ)@end@implementation ZJStudent (ZJ)+ (void)load&#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; [ZJRuntimeTool zj_methodSwizzlingWithClass:self oriSEL:@selector(personInstanceMethod) swizzledSEL:@selector(zj_studentInstanceMethod)]; &#125;);&#125;// personInstanceMethod æˆ‘éœ€è¦çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•çš„ä¸€äº›ä¸œè¥¿// ç»™ä½ åŠ ä¸€ä¸ªpersonInstanceMethod æ–¹æ³•// imp- (void)zj_studentInstanceMethod&#123; // æ˜¯å¦ä¼šäº§ç”Ÿé€’å½’ï¼Ÿ ä¸ä¼šäº§ç”Ÿé€’å½’ï¼ŒåŸå› æ˜¯zj_studentInstanceMethod ä¼šèµ° oriIMP,å³personInstanceMethodçš„å®ç°ä¸­å» [self zj_studentInstanceMethod]; NSLog(@&quot;ZJStudentåˆ†ç±»æ·»åŠ çš„zjå¯¹è±¡æ–¹æ³•ï¼š%s&quot;,__func__);&#125;@end ä¸‹é¢æ˜¯å°è£…å¥½çš„ method-swizzling æ–¹æ³• 12345678910111213@interface ZJRuntimeTool : NSObject+ (void)zj_methodSwizzlingWithClass:(Class)cls oriSEL:(SEL)oriSEL swizzledSEL:(SEL)swizzledSEL;@end@implementation ZJRuntimeTool+ (void)zj_methodSwizzlingWithClass:(Class)cls oriSEL:(SEL)oriSEL swizzledSEL:(SEL)swizzledSEL&#123; if (!cls) &#123; NSLog(@&quot;ä¼ å…¥çš„äº¤æ¢ç±»ä¸èƒ½ä¸ºç©º&quot;); &#125; Method oriMethod = class_getInstanceMethod(cls, oriSEL); Method swiMethod = class_getInstanceMethod(cls, swizzledSEL); method_exchangeImplementations(oriMethod, swiMethod);&#125;@end é€šè¿‡å®é™…ä»£ç çš„è°ƒè¯•ï¼Œå‘ç°ä¼šåœ¨pè°ƒç”¨ personInstanceMethod æ–¹æ³•æ—¶å´©æºƒï¼Œä¸‹é¢æ¥è¿›è¡Œè¯¦ç»†è¯´æ˜ [student personInstanceMethod]; ä¸­ä¸æŠ¥é”™æ˜¯å› ä¸º student ä¸­çš„ imp äº¤æ¢æˆäº† zj_studentInstanceMethodï¼Œè€Œ ZJStudent ä¸­æœ‰è¿™ä¸ªæ–¹æ³•ï¼ˆåœ¨ZJåˆ†ç±»ä¸­ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šæŠ¥é”™ å´©æºƒçš„ç‚¹åœ¨äº [person personInstanceMethod];ï¼Œå…¶æœ¬è´¨åŸå› ï¼šZJStudent çš„åˆ†ç±»ZJ ä¸­è¿›è¡Œäº†æ–¹æ³•äº¤æ¢ï¼Œå°† person ä¸­çš„ IMP äº¤æ¢æˆäº† ZJStudent ä¸­çš„ zj_studentInstanceMethodï¼Œä½†æ˜¯ ZJPerson ä¸­æ²¡æœ‰ zj_studentInstanceMethodæ–¹æ³•ï¼Œå³ ç›¸å…³çš„IMPæ‰¾ä¸åˆ°ï¼Œæ‰€ä»¥å°±å´©æºƒäº† ã€ä¼˜åŒ–ï¼šé¿å…impæ‰¾ä¸åˆ°ã€‘ é€šè¿‡ class_addMethod å°è¯•æ·»åŠ ä½ è¦äº¤æ¢çš„æ–¹æ³• å¦‚æœ æ·»åŠ æˆåŠŸï¼Œå³ç±»ä¸­æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œåˆ™é€šè¿‡ class_replaceMethod è¿›è¡Œ æ›¿æ¢ï¼Œå…¶å†…éƒ¨ä¼šè°ƒç”¨ class_addMethod è¿›è¡Œæ·»åŠ  å¦‚æœæ·»åŠ ä¸æˆåŠŸï¼Œå³ç±»ä¸­æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œåˆ™é€šè¿‡ method_exchangeImplementations è¿›è¡Œ äº¤æ¢ 12345678910111213141516171819+ (void)zj_methodSwizzlingWithClass:(Class)cls oriSEL:(SEL)oriSEL swizzledSEL:(SEL)swizzledSEL&#123; if (!cls) &#123; NSLog(@&quot;ä¼ å…¥çš„äº¤æ¢ç±»ä¸èƒ½ä¸ºç©º&quot;); &#125; Method oriMethod = class_getInstanceMethod(cls, oriSEL); Method swiMethod = class_getInstanceMethod(cls, swizzledSEL); // ä¸€èˆ¬äº¤æ¢æ–¹æ³•ï¼šäº¤æ¢è‡ªå·±æœ‰çš„æ–¹æ³• // äº¤æ¢è‡ªå·±æ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼š // é¦–å…ˆï¼šä¼šå…ˆå°è¯•ç»™è‡ªå·±æ·»åŠ è¦äº¤æ¢çš„æ–¹æ³• - personInstanceMethod(SEL) -&gt; swiMethod(IMP) // ç„¶åå†å°†çˆ¶ç±»çš„IMPç»™swizzle personInstanceMethod(IMP) -&gt; swizzledSEL BOOL success = class_addMethod(cls, oriSEL, method_getImplementation(swiMethod), method_getTypeEncoding(oriMethod)); if (success) &#123; // è‡ªå·±æ²¡æœ‰ - äº¤æ¢ - æ²¡æœ‰çˆ¶ç±»è¿›è¡Œå¤„ç†ï¼ˆé‡å†™ä¸€ä¸ªï¼‰ class_replaceMethod(cls, swizzledSEL, method_getImplementation(oriMethod), method_getTypeEncoding(oriMethod)); &#125;else &#123; // è‡ªå·±æœ‰ method_exchangeImplementations(oriMethod, swiMethod); &#125;&#125; ä¸‹é¢æ˜¯ class_replaceMethodã€class_addMethodã€method_exchangeImplementations çš„æºç å®ç° å…¶ä¸­ class_replaceMethod å’Œ class_addMethod ä¸­éƒ½è°ƒç”¨äº† addMethod æ–¹æ³•ï¼ŒåŒºåˆ«åœ¨äº bool å€¼çš„åˆ¤æ–­ï¼Œä¸‹é¢æ˜¯ addMethod çš„æºç å®ç°ã€‚ å‘ç‚¹3ï¼šå­ç±»æ²¡æœ‰å®ç°ï¼Œçˆ¶ç±»ä¹Ÿæ²¡æœ‰å®ç°ï¼Œä¸‹é¢çš„è°ƒç”¨æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿåœ¨è°ƒç”¨ personInstanceMethod æ–¹æ³•æ—¶ï¼Œçˆ¶ç±» ZJPerson ä¸­åªæœ‰å£°æ˜ï¼Œæ²¡æœ‰å®ç°ï¼Œå­ç±» ZJStudent ä¸­å³æ²¡æœ‰å£°æ˜ï¼Œä¹Ÿæ²¡æœ‰å®ç° 123456// å°†çˆ¶ç±» ZJPerson å®ç°æ³¨é‡Š@implementation ZJPerson//- (void)personInstanceMethod&#123;// NSLog(@&quot;personå¯¹è±¡æ–¹æ³•:%s&quot;,__func__);//&#125;@end ç»è¿‡è°ƒè¯•ï¼Œå‘ç°è¿è¡Œä»£ç ä¼šå´©æºƒï¼ŒæŠ¥é”™ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š åŸå› æ˜¯ï¼šæ ˆæº¢å‡ºï¼Œé€’å½’æ­»å¾ªç¯ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‘ç”Ÿé€’å½’å‘¢ï¼Ÿ ä¸»è¦æ˜¯å› ä¸º personInstanceMethod æ²¡æœ‰å®ç°ï¼Œç„¶ååœ¨æ–¹æ³•äº¤æ¢åï¼Œå§‹ç»ˆæ‰¾ä¸åˆ° oriMethodï¼Œç„¶åäº¤æ¢äº†ä¸ªå¯‚å¯ï¼Œå³äº¤æ¢å¤±è´¥ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ personInstanceMethod(oriMethod)æ—¶ï¼Œä¹Ÿå°±æ˜¯ oriMethod ä¼šè¿›å…¥ ZJ ä¸­ zj_studentInstanceMethod æ–¹æ³•ï¼Œç„¶åè¿™ä¸ªæ–¹æ³•ä¸­åˆè°ƒç”¨äº† zj_studentInstanceMethodï¼Œæ­¤æ—¶çš„ zj_studentInstanceMethod å¹¶æ²¡æœ‰æŒ‡å‘ oriMethodï¼Œç„¶åå¯¼è‡´äº† è‡ªå·±è°ƒè‡ªå·±ï¼Œå³é€’å½’æ­»å¾ªç¯ ã€ä¼˜åŒ–ï¼šé¿å…é€’å½’æ­»å¾ªç¯ã€‘ å¦‚æœ oriMethod ä¸ºç©ºï¼Œä¸ºäº†é¿å…æ–¹æ³•äº¤æ¢æ²¡æœ‰æ„ä¹‰ï¼Œè€Œè¢«åºŸå¼ƒï¼Œéœ€è¦åšä¸€äº›äº‹æƒ… é€šè¿‡ class_addMethod ç»™ oriSEL æ·»åŠ  swiMethod æ–¹æ³• é€šè¿‡ method_setImplementation å°† swiMethod çš„ IMP æŒ‡å‘ ä¸åšä»»ä½•äº‹çš„ç©ºå®ç° 1234567891011121314151617181920212223242526+ (void)zj_methodSwizzlingWithClass:(Class)cls oriSEL:(SEL)oriSEL swizzledSEL:(SEL)swizzledSEL&#123; if (!cls) &#123; NSLog(@&quot;ä¼ å…¥çš„äº¤æ¢ç±»ä¸èƒ½ä¸ºç©º&quot;); &#125; Method oriMethod = class_getInstanceMethod(cls, oriSEL); Method swiMethod = class_getInstanceMethod(cls, swizzledSEL); // å¦‚æœæ²¡æœ‰ oriMethod if (!oriMethod) &#123; // åœ¨oriMethodä¸ºnilæ—¶ï¼Œæ›¿æ¢åå°†swizzledSELå¤åˆ¶ä¸€ä¸ªä¸åšä»»ä½•äº‹çš„ç©ºå®ç° class_addMethod(cls, oriSEL, method_getImplementation(swiMethod), method_getTypeEncoding(swiMethod)); method_setImplementation(swiMethod, imp_implementationWithBlock(^(id self,SEL _cmd)&#123;&#125;)); &#125; // ä¸€èˆ¬äº¤æ¢æ–¹æ³•ï¼šäº¤æ¢è‡ªå·±æœ‰çš„æ–¹æ³• // äº¤æ¢è‡ªå·±æ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼š // é¦–å…ˆï¼šä¼šå…ˆå°è¯•ç»™è‡ªå·±æ·»åŠ è¦äº¤æ¢çš„æ–¹æ³• - personInstanceMethod(SEL) -&gt; swiMethod(IMP) // ç„¶åå†å°†çˆ¶ç±»çš„IMPç»™swizzle personInstanceMethod(IMP) -&gt; swizzledSEL BOOL success = class_addMethod(cls, oriSEL, method_getImplementation(swiMethod), method_getTypeEncoding(swiMethod)); if (success) &#123; // è‡ªå·±æ²¡æœ‰ - äº¤æ¢ - æ²¡æœ‰çˆ¶ç±»è¿›è¡Œå¤„ç†ï¼ˆé‡å†™ä¸€ä¸ªï¼‰ class_replaceMethod(cls, swizzledSEL, method_getImplementation(oriMethod), method_getTypeEncoding(oriMethod)); &#125;else &#123; // è‡ªå·±æœ‰ method_exchangeImplementations(oriMethod, swiMethod); &#125;&#125; method-swizzling ç±»æ–¹æ³•ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„method-swizzlingçš„åŸç†æ˜¯ç±»ä¼¼çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ç±»æ–¹æ³•å­˜åœ¨ å…ƒç±» ä¸­ï¼Œæ‰€ä»¥å¯ä»¥åšå¦‚ä¸‹æ“ä½œ ZJStudent ä¸­åªæœ‰ç±»æ–¹æ³• sayHello çš„å£°æ˜ï¼Œæ²¡æœ‰å®ç° 12345@interface ZJStudent : ZJPerson+ (void)sayHello;@end@implementation ZJStudent@end åœ¨ZJStudentçš„åˆ†ç±»çš„loadæ–¹æ³•ä¸­å®ç°ç±»æ–¹æ³•çš„äº¤æ¢æ–¹æ³• 1234567891011//*****ZJStudent(ZJ)+ (void)load&#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; [ZJRuntimeTool zj_bestClassMethodSwizzlingWithClass:self oriSEL:@selector(sayHello) swizzledSEL:@selector(zj_studentClassMethod)]; &#125;);&#125;+ (void)zj_studentClassMethod&#123; NSLog(@&quot;ZJStudentåˆ†ç±»æ·»åŠ çš„lgç±»æ–¹æ³•:%s&quot;,__func__); [[self class] zj_studentClassMethod];&#125; å°è£…çš„ æ–¹æ³•äº¤æ¢ å¦‚ä¸‹ï¼š éœ€è¦é€šè¿‡ class_getClassMethod æ–¹æ³• è·å–ç±»æ–¹æ³• åœ¨è°ƒç”¨ class_addMethod å’Œ class_replaceMethod æ–¹æ³•æ·»åŠ å’Œæ›¿æ¢æ—¶ï¼Œéœ€è¦ä¼ å…¥çš„ç±»æ˜¯ å…ƒç±»ï¼Œå…ƒç±»å¯ä»¥é€šè¿‡ object_getClass æ–¹æ³•è·å–ç±»çš„å…ƒç±» 12345678910111213141516171819202122232425262728+ (void)zj_bestClassMethodSwizzlingWithClass:(Class)cls oriSEL:(SEL)oriSEL swizzledSEL:(SEL)swizzledSEL&#123; if (!cls) NSLog(@&quot;ä¼ å…¥çš„äº¤æ¢ç±»ä¸èƒ½ä¸ºç©º&quot;); Method oriMethod = class_getClassMethod([cls class], oriSEL); Method swiMethod = class_getClassMethod([cls class], swizzledSEL); if (!oriMethod) &#123; // é¿å…åŠ¨ä½œæ²¡æœ‰æ„ä¹‰ // åœ¨oriMethodä¸ºnilæ—¶ï¼Œæ›¿æ¢åå°†swizzledSELå¤åˆ¶ä¸€ä¸ªä¸åšä»»ä½•äº‹çš„ç©ºå®ç°,ä»£ç å¦‚ä¸‹: class_addMethod(object_getClass(cls), oriSEL, method_getImplementation(swiMethod), method_getTypeEncoding(swiMethod)); method_setImplementation(swiMethod, imp_implementationWithBlock(^(id self, SEL _cmd)&#123; NSLog(@&quot;æ¥äº†ä¸€ä¸ªç©ºçš„ imp&quot;); &#125;)); &#125; // ä¸€èˆ¬äº¤æ¢æ–¹æ³•: äº¤æ¢è‡ªå·±æœ‰çš„æ–¹æ³• -- èµ°ä¸‹é¢ å› ä¸ºè‡ªå·±æœ‰æ„å‘³æ·»åŠ æ–¹æ³•å¤±è´¥ // äº¤æ¢è‡ªå·±æ²¡æœ‰å®ç°çš„æ–¹æ³•: // é¦–å…ˆç¬¬ä¸€æ­¥:ä¼šå…ˆå°è¯•ç»™è‡ªå·±æ·»åŠ è¦äº¤æ¢çš„æ–¹æ³• :personInstanceMethod (SEL) -&gt; swiMethod(IMP) // ç„¶åå†å°†çˆ¶ç±»çš„IMPç»™swizzle personInstanceMethod(imp) -&gt; swizzledSEL //oriSEL:personInstanceMethod BOOL didAddMethod = class_addMethod(object_getClass(cls), oriSEL, method_getImplementation(swiMethod), method_getTypeEncoding(swiMethod)); if (didAddMethod) &#123; class_replaceMethod(object_getClass(cls), swizzledSEL, method_getImplementation(oriMethod), method_getTypeEncoding(oriMethod)); &#125;else&#123; method_exchangeImplementations(oriMethod, swiMethod); &#125;&#125; è°ƒç”¨å¦‚ä¸‹ 12345- (void)viewDidLoad &#123; [super viewDidLoad]; [ZJStudent sayHello];&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œç”±äºç¬¦åˆ æ–¹æ³•æ²¡æœ‰å®ç°ï¼Œæ‰€ä»¥æˆ–èµ°åˆ° ç©ºçš„imp ä¸­ 122022-03-14 15:48:59.225558+0800 Method-Swizzling[5512:3942308] ZJStudentåˆ†ç±»æ·»åŠ çš„lgç±»æ–¹æ³•:+[ZJStudent(ZJ) zj_studentClassMethod]2022-03-14 15:48:59.225602+0800 Method-Swizzling[5512:3942308] æ¥äº†ä¸€ä¸ªç©ºçš„ imp method-swizzling åº”ç”¨method-swizzling æœ€å¸¸ç”¨åˆ°çš„æ˜¯ é˜²æ­¢å´©æºƒã€å­—å…¸ã€æ•°ç»„ç­‰è¶Šç•Œã€‚ åœ¨iOSä¸­ï¼ŒNSNumberã€NSArrayã€NSDictionary ç­‰è¿™äº›éƒ½æ˜¯ç±»æ—ï¼Œä¸€ä¸ª NSArray çš„å®ç°å¯èƒ½ç”± å¤šä¸ªç±»ç»„æˆï¼Œæ‰€ä»¥å¦‚æœæƒ³å¯¹ NSArrayè¿›è¡Œswizzlingï¼Œå¿…é¡»è·å–åˆ°å…¶â€œçœŸèº«â€è¿›è¡Œswizzlingï¼Œç›´æ¥å¯¹NSArrayè¿›è¡Œæ“ä½œæ˜¯æ— æ•ˆçš„ ä¸‹é¢åˆ—ä¸¾äº† NSArray å’Œ NSDictionary æœ¬ç±»çš„ç±»åï¼Œå¯ä»¥é€šè¿‡ Runtime å‡½æ•°æ¥å–å‡ºæœ¬ç±» NSArray: __NSArrayI NSMutableArray: __NSArrayM NSDictionary: __NSDictionaryI NSMutableDicionary: __NSDictionaryM ã€ä»¥NSArrayä¸ºä¾‹ã€‘ åˆ›å»ºä¸€ä¸ªNSArrayåˆ†ç±» NSArray+ZJ 12345678910111213141516171819202122232425262728@implementation NSArray (ZJ)// Swizzlingæ ¸å¿ƒä»£ç // é¡»è¦æ³¨æ„çš„æ˜¯ï¼Œå¥½å¤šåŒçª—åé¦ˆä¸‹é¢ä»£ç ä¸èµ·åšç”¨ï¼Œå½¢æˆè¿™ä¸ªé—®é¢˜çš„ç¼˜ç”±å¤§å¤šéƒ½æ˜¯å…¶è°ƒç”¨äº†super loadæ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„loadæ–¹æ³•ä¸­ï¼Œä¸è¯¥è¯¥è°ƒç”¨çˆ¶ç±»çš„loadæ–¹æ³•ã€‚+ (void)load &#123; Method fromMethod = class_getInstanceMethod(objc_getClass(&quot;__NSArrayI&quot;), @selector(objectAtIndex:)); Method toMethod = class_getInstanceMethod(objc_getClass(&quot;__NSArrayI&quot;), @selector(cm_objectAtIndex:)); method_exchangeImplementations(fromMethod, toMethod);&#125;// ä¸ºäº†ä¸å’Œç³»ç»Ÿçš„æ–¹æ³•å†²çªï¼Œæˆ‘é€šå¸¸éƒ½ä¼šåœ¨swizzlingæ–¹æ³•å‰é¢åŠ å‰ç¼€- (id)cm_objectAtIndex:(NSUInteger)index &#123; // åˆ¤æ–­ä¸‹æ ‡æ˜¯å¦è¶Šç•Œï¼Œè‹¥æ˜¯è¶Šç•Œå°±è¿›å…¥å¼‚å¸¸æ‹¦æˆª if (self.count-1 &lt; index) &#123; @try &#123; return [self cm_objectAtIndex:index]; &#125; @catch (NSException *exception) &#123; // åœ¨å´©æºƒåä¼šæ‰“å°å´©æºƒä¿¡æ¯ã€‚è‹¥æ˜¯æ˜¯çº¿ä¸Šï¼Œèƒ½å¤Ÿåœ¨è¿™é‡Œå°†å´©æºƒä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨ NSLog(@&quot;---------- %s Crash Because Method %s ----------\\n&quot;, class_getName(self.class), __func__); NSLog(@&quot;%@&quot;, [exception callStackSymbols]); return nil; &#125; @finally &#123;&#125; &#125; // è‹¥æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œåˆ™æ­£å¸¸è¿›è¡Œæ–¹æ³•è°ƒç”¨ else &#123; return [self cm_objectAtIndex:index]; &#125;&#125; æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œä¼šè¾“å‡ºå´©æºƒæ—¥å¿—ï¼Œä½†æ˜¯å®é™…ä¸ä¼šå´©æºƒ","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†20ï¼šOCåº•å±‚é¢è¯•é¢˜è§£æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†20ï¼šOCåº•å±‚é¢è¯•é¢˜è§£æ","date":"2020-12-15T07:22:19.000Z","updated":"2022-04-08T07:10:46.000Z","comments":true,"path":"2020/12/15/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†20ï¼šOCåº•å±‚é¢è¯•é¢˜è§£æ/","link":"","permalink":"https://www.bboyzj.cn/2020/12/15/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8620%EF%BC%9AOC%E5%BA%95%E5%B1%82%E9%9D%A2%E8%AF%95%E9%A2%98%E8%A7%A3%E6%9E%90/","excerpt":"","text":"ã€é¢è¯•é¢˜1ã€‘Runtime Associate æ–¹æ³•å…³ç³»çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨deallocä¸­é‡Šæ”¾ï¼Ÿå½“æˆ‘ä»¬å¯¹è±¡é‡Šæ”¾æ—¶ï¼Œä¼šè°ƒç”¨ dealloc C++å‡½æ•°é‡Šæ”¾ï¼šobjc_cxxDestruce ç§»é™¤å…³è”å±æ€§ï¼š_object_remove_associations å°†å¼±å¼•ç”¨è‡ªåŠ¨è®¾å€¼nilï¼šweak_clear_no_lock(&amp;table_weak_tableã€‚(id)this); å¼•ç”¨è®¡æ•°å¤„ç†ï¼štable_refcnts_erase(this) é”€æ¯å¯¹è±¡ï¼šfree(obj) æ‰€ä»¥ï¼Œå…³è”å¯¹è±¡ ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç§»é™¤ï¼Œä¼šåœ¨å¯¹è±¡ææ„å³ dealloc æ—¶é‡Šæ”¾ deallocæºç  deallocçš„æºç æŸ¥æ‰¾è·¯å¾„ï¼šdealloc -&gt; _objc_rootDealloc -&gt; rootDealloc -&gt; object_disposeï¼ˆé‡Šæ”¾å¯¹è±¡ï¼‰ -&gt; objc_destructInstance -&gt; _object_remove_assocations åœ¨objcæºç ä¸­æœç´¢ dealloc çš„æºç å®ç° è¿›å…¥ _objc_rootDealloc æºç å®ç°ï¼Œä¸»è¦æ˜¯å¯¹ å¯¹è±¡è¿›è¡Œææ„ è¿›å…¥ rootDealloc æºç å®ç°ï¼Œå‘ç°å…¶ä¸­æœ‰ å…³è”å±æ€§æ—¶è®¾ç½®boolå€¼ï¼Œå½“æœ‰è¿™äº›æ¡ä»¶æ—¶ï¼Œéœ€è¦è¿›å…¥elseæµç¨‹ è¿›å…¥ object_dispose æºç å®ç°ï¼Œä¸»è¦æ˜¯ é”€æ¯å®ä¾‹å¯¹è±¡ è¿›å…¥ objc_destructInstance æºç å®ç°ï¼Œåœ¨è¿™é‡Œæœ‰ä¸€å¤„å…³è”å±æ€§çš„æ–¹æ³• è¿›å…¥ _object_remove_assocations æºç ï¼Œå…³è”å±æ€§çš„ç§»é™¤ï¼Œä¸»è¦æ˜¯ ä»å…¨å±€å“ˆå¸Œmapä¸­æ‹›å¾…ç›¸å…³å¯¹è±¡çš„è¿­ä»£å™¨ï¼Œç„¶åå°†è¿­ä»£å™¨ä¸­å…³è”å±æ€§ï¼Œä»å¤´åˆ°å°¾çš„ç§»é™¤ ã€é¢è¯•2ã€‘æ–¹æ³•çš„è°ƒç”¨é¡ºåºç±»çš„æ–¹æ³• å’Œ åˆ†ç±»æ–¹æ³• é‡åï¼Œå¦‚æœè°ƒç”¨ï¼Œæ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ å¦‚æœåŒåæ–¹æ³•æ˜¯ æ™®é€šæ–¹æ³•ï¼ŒåŒ…æ‹¬ initialize â€“ å…ˆè°ƒç”¨åˆ†ç±»æ–¹æ³• å› ä¸º åˆ†ç±»çš„æ–¹æ³•æ˜¯åœ¨ç±»realizeä¹‹åattachè¿›å»çš„ï¼Œæ’åœ¨ç±»çš„æ–¹æ³•çš„å‰é¢ï¼Œæ‰€ä»¥ ä¼˜å…ˆè°ƒç”¨åˆ†ç±»çš„æ–¹æ³•ï¼ˆæ³¨æ„ï¼šä¸æ˜¯åˆ†ç±»è¦†ç›–ä¸»ç±»ï¼ï¼ï¼‰ï¼Œæ‰€ä»¥ä½ çœ‹åˆ°çš„åªæœ‰ ç±»çš„initialize * `initialize` æ–¹æ³•ä»€ä¹ˆæ—¶å€™è°ƒç”¨ï¼Ÿ`initialize` æ–¹æ³•ä¹Ÿæ˜¯ `ä¸»åŠ¨è°ƒç”¨`ï¼Œå³ `ç¬¬ä¸€æ¬¡æ¶ˆæ¯æ—¶` è°ƒç”¨ï¼Œä¸ºäº†ä¸å½±å“æ•´ä¸ªloadï¼Œå¯ä»¥å°†éœ€è¦ `æå‰åŠ è½½çš„æ•°æ®` å†™åˆ° `initialize` ä¸­ å¦‚æœåŒåæ–¹æ³•æ˜¯ load æ–¹æ³• â€“ å…ˆ ä¸»ç±»loadï¼Œå åˆ†ç±»loadï¼ˆåˆ†ç±»ä¹‹é—´ï¼Œçœ‹ç¼–è¯‘çš„é¡ºåºï¼‰ åŸå› ï¼šå‚è€ƒ iOS-åº•å±‚åŸç†18ï¼šç±»çš„åŠ è½½ï¼ˆä¸‹ï¼‰ æ–‡ç« ä¸­çš„ load_images åŸç†åˆ†æ ã€é¢è¯•3ã€‘Runtimeæ˜¯ä»€ä¹ˆï¼Ÿ runtime æ˜¯ç”± Cå’ŒC++ æ±‡ç¼–å®ç°çš„ä¸€å¥— APIï¼Œä¸º OC è¯­è¨€åŠ å…¥äº† é¢å‘å¯¹è±¡ã€ä»¥åŠè¿è¡Œæ—¶çš„åŠŸèƒ½ è¿è¡Œæ—¶æ˜¯æŒ‡å°† æ•°æ®ç±»å‹çš„ç¡®å®šç”±ç¼–è¯‘æ—¶æ¨åˆ°äº†è¿è¡Œæ—¶ ä¸¾ä¾‹ï¼šextension å’Œ category çš„åŒºåˆ« å¹³æ—¶ç¼–å†™çš„ OC ä»£ç ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶å®æœ€ç»ˆä¼šè½¬å˜æˆ runtime çš„ Cè¯­è¨€ä»£ç ï¼Œruntimeæ˜¯OCçš„å¹•åå·¥ä½œè€… 1. categoryç±»åˆ«ã€åˆ†ç±» ä¸“é—¨ç”¨æ¥ç»™ç±»æ·»åŠ æ–°çš„æ–¹æ³• ä¸èƒ½ç»™ç±»æ·»åŠ æˆå‘˜å˜é‡ï¼Œæ·»åŠ äº†æˆå‘˜å±æ€§ï¼Œä¹Ÿæ— æ³•å–åˆ° æ³¨æ„ï¼šå…¶å® å¯ä»¥é€šè¿‡runtimeç»™åˆ†ç±»æ·»åŠ å±æ€§ï¼Œå³å±æ€§å…³è”ï¼Œé‡å†™setterã€getteræ–¹æ³• åˆ†ç±»ä¸­ç”¨ @property å®šä¹‰å˜é‡ï¼Œåªä¼šç”Ÿæˆ å˜é‡çš„ setterã€getter æ–¹æ³•çš„ å£°æ˜ï¼Œä¸èƒ½ç”Ÿæˆæ–¹æ³•å®ç°å’Œå¸¦ä¸‹åˆ’çº¿çš„æˆå‘˜å˜é‡ 2. extension ç±»æ‰©å±• å¯ä»¥è¯´æˆæ˜¯ ç‰¹æ®Šçš„ç±»ï¼Œä¹Ÿå¯ä»¥ç§°ä½œ åŒ¿åçš„ç±» å¯ä»¥ ç»™ç±»æ·»åŠ æˆå‘˜å±æ€§ï¼Œä½†æ˜¯ æ˜¯ç§æœ‰å˜é‡ å¯ä»¥ ç»™ç±»æ·»åŠ æ–¹æ³•ï¼Œä¹Ÿæ˜¯ ç§æœ‰æ–¹æ³• ã€é¢è¯•4ã€‘æ–¹æ³•çš„æœ¬è´¨ï¼Œselæ˜¯ä»€ä¹ˆï¼ŸIMPæ˜¯ä»€ä¹ˆï¼Ÿä¸¤è€…ä¹‹é—´çš„å…³ç³»åˆæ˜¯ä»€ä¹ˆï¼Ÿ æ–¹æ³•çš„æœ¬è´¨ï¼šå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªæµç¨‹ å¿«é€ŸæŸ¥æ‰¾ï¼ˆobjc_msgSendï¼‰-&gt; cache_t ç¼“å­˜æ¶ˆæ¯ä¸­æŸ¥æ‰¾ æ…¢é€ŸæŸ¥æ‰¾ - é€’å½’è‡ªå·±|çˆ¶ç±» -&gt; lookUpImpOrForward æŸ¥æ‰¾ä¸åˆ°æ¶ˆæ¯ -&gt; åŠ¨æ€æ–¹æ³•è§£æ - resolveInstanceMethod æ¶ˆæ¯å¿«é€Ÿè½¬å‘ - forwardingTargetForSelector æ¶ˆæ¯æ…¢é€Ÿè½¬å‘ - methodSignatureForSelector &amp; forwardInvocation sel æ˜¯ æ–¹æ³•ç¼–å· - åœ¨ read_images æœŸé—´å°±ç¼–è¯‘è¿›äº†å†…å­˜ï¼Œç›¸å½“äºä¸€æœ¬ä¹¦çš„ ç›®å½•title imp æ˜¯ å‡½æ•°å®ç°æŒ‡é’ˆï¼Œæ‰¾impå°±æ˜¯æ‰¾å‡½æ•°çš„è¿‡ç¨‹ï¼Œç›¸å½“äº ä¹¦æœ¬çš„é¡µç  æŸ¥æ‰¾å…·ä½“çš„å‡½æ•°å°±æ˜¯æƒ³çœ‹è¿™æœ¬ä¹¦å…·ä½“ç¯‡ç« çš„å†…å®¹ é¦–å…ˆçŸ¥é“æƒ³çœ‹ä»€ä¹ˆï¼Œå³ç›®å½• title-sel æ ¹æ®ç›®å½•æŸ¥æ‰¾åˆ°å¯¹åº”çš„é¡µç  - imp é€šè¿‡é¡µç å»ç¿»åˆ°å…·ä½“çš„å†…å®¹ ã€é¢è¯•5ã€‘èƒ½å¦åƒç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦åƒè¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿ ä¸èƒ½ åƒç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ åªè¦ç±»æ²¡æœ‰æ³¨å†Œåˆ°å†…å­˜è¿˜æ˜¯å¯ä»¥æ·»åŠ çš„ å¯ä»¥ æ·»åŠ å±æ€§+æ–¹æ³• ã€åŸå› ã€‘ ï¼šç¼–è¯‘å¥½çš„å®ä¾‹å˜é‡å­˜å‚¨çš„ä½ç½®æ˜¯roï¼Œä¸€æ—¦ç¼–è¯‘å®Œæˆï¼Œå†…å­˜ç»“æ„å°±å®Œå…¨ç¡®å®šäº† ã€é¢è¯•6ã€‘[self class] å’Œ [super class]çš„åŒºåˆ«ä»¥åŠåŸç†åˆ†æ [self class] å°±æ˜¯å‘é€æ¶ˆæ¯ objc_msgSendï¼Œæ¶ˆæ¯æ¥æ”¶è€…æ˜¯ selfï¼Œæ–¹æ³•ç¼–å·æ˜¯ class [super class] æœ¬è´¨å°±æ˜¯ objc_msgSendSuperï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…è¿˜æ˜¯ selfï¼Œæ–¹æ³•ç¼–å· classï¼Œåœ¨è¿è¡Œæ—¶ï¼Œåº•å±‚è°ƒç”¨çš„æ˜¯ _objc_msgSendSuper2ã€é‡ç‚¹!!!ã€‘ åªæ˜¯ objc_msgSendSuper2 ä¼šæ›´å¿«ï¼Œç›´æ¥è·³è¿‡ self çš„æŸ¥æ‰¾ ã€ä»£ç è°ƒè¯•ã€‘ ZJPerson ä¸­çš„ init æ–¹æ³•ä¸­æ‰“å°è¿™ä¸¤ç§ class è°ƒç”¨ è¿›å…¥ [self class] ä¸­çš„ class æºç  å…¶åº•å±‚æ˜¯ è·å–å¯¹è±¡çš„isaï¼Œå½“å‰çš„ å¯¹è±¡æ˜¯ZJPersonï¼Œå…¶isaæ˜¯å…¶åŒåçš„ ZJPersonï¼Œæ‰€ä»¥ [self class] æ‰“å°çš„æ˜¯ ZJPerson [super class]ä¸­ï¼Œå…¶ä¸­ super æ˜¯è¯­æ³•çš„ å…³é”®å­—ï¼Œå¯ä»¥é€šè¿‡ clang çœ‹ super çš„æœ¬è´¨ï¼Œè¿™æ˜¯ ç¼–è¯‘æ—¶ çš„åº•å±‚æºç ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯æ¥æ”¶è€…ï¼Œæ˜¯ä¸€ä¸ª __rw_objc_super ç»“æ„ åº•å±‚æºç ä¸­æœç´¢ __rw_objc_superï¼Œæ˜¯ä¸€ä¸ªä¸­é—´ç»“æ„ä½“ objcä¸­æœç´¢ objc_msgSendSuperï¼ŒæŸ¥çœ‹å…¶éšè—å‚æ•° æœç´¢ struct objc_super é€šè¿‡ clang çš„åº•å±‚ç¼–è¯‘ä»£ç å¯çŸ¥ï¼Œå½“å‰ æ¶ˆæ¯çš„æ¥æ”¶è€… æ˜¯ selfï¼Œè€Œ self ç­‰äº ZJPersonï¼Œæ‰€ä»¥ [super class] è¿›å…¥ class æ–¹æ³•æ¥æºåï¼Œå…¶ä¸­çš„ selfæ˜¯initåçš„å®ä¾‹å¯¹è±¡ï¼Œå®ä¾‹å¯¹è±¡çš„ isa æŒ‡å‘çš„æ˜¯æœ¬ç±»ï¼Œå³æ¶ˆæ¯æ¥æ”¶è€…æ˜¯ ZJPersonæœ¬ç±» æˆ‘ä»¬å†æ¥çœ‹ [super class] åœ¨è¿è¡Œæ—¶æ˜¯å¦å¦‚ä¸Šä¸€æ­¥çš„åº•å±‚ç¼–ç æ‰€ç¤ºï¼Œæ˜¯ objc_msgSendSuperï¼Œæ‰“å¼€æ±‡ç¼–è°ƒè¯•ï¼Œè°ƒè¯•ç»“æœå¦‚ä¸‹ æœç´¢ objc_msgSendSuper2ï¼Œä»æ³¨é‡Šå¾—çŸ¥ï¼Œæ˜¯ ä»ç±»å¼€å§‹æŸ¥æ‰¾çš„ï¼Œè€Œä¸æ˜¯çˆ¶ç±» æŸ¥çœ‹ objc_msgSendSuper2 çš„æ±‡ç¼–æºç ï¼Œæ˜¯ä» superclass ä¸­çš„ cache ä¸­æŸ¥æ‰¾æ–¹æ³• 12345678ENTRY _objc_msgSendSuper2UNWIND _objc_msgSendSuper2, NoFrameldp p0, p16, [x0] // p0 = real receiver, p16 = class å–å‡ºreceiver å’Œ classldr p16, [x16, #SUPERCLASS] // p16 = class-&gt;superclassCacheLookup NORMAL, _objc_msgSendSuper2//cacheä¸­æŸ¥æ‰¾--å¿«é€ŸæŸ¥æ‰¾END_ENTRY _objc_msgSendSuper2 ã€å®Œæˆå›ç­”ã€‘ [self class] æ–¹æ³•è°ƒç”¨çš„æœ¬è´¨æ˜¯ å‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨classçš„æ¶ˆæ¯æµç¨‹ï¼Œæ‹¿åˆ° å…ƒç±»çš„ç±»å‹ï¼Œåœ¨è¿™é‡Œæ˜¯å› ä¸ºç±»å·²ç»åŠ è½½åˆ°å†…å­˜ï¼Œæ‰€ä»¥åœ¨è¯»å–æ—¶æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç±»å‹æ˜¯åœ¨ map_images çš„ readClass æ—¶å·²ç»åŠ å…¥è¡¨ä¸­ï¼Œæ‰€ä»¥æ‰“å°ä¸º ZJPerson [super class] æ‰“å°çš„æ˜¯ ZJPersonï¼ŒåŸå› æ˜¯å½“å‰çš„ super æ˜¯ä¸€ä¸ª å…³é”®å­—ï¼Œåœ¨è¿™é‡Œåªæ˜¯è°ƒç”¨ objc_msgSendSuper2ï¼Œå…¶å®ä»–çš„æ¶ˆæ¯æ¥æ”¶è€…å’Œ[self class]æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯ ZJPerson ã€é¢è¯•7ã€‘å†…å­˜å¹³ç§»é—®é¢˜ZJPersonä¸­æœ‰ä¸€ä¸ª å±æ€§zj_name å’Œ å®ä¾‹æ–¹æ³•saySomethingï¼Œé€šè¿‡ä¸‹é¢ä»£ç è¿™ç§æ–¹å¼èƒ½å¦è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ 1234567891011121314@interface ZJPerson : NSObject@property (nonatomic,copy)NSString * zj_name;- (void)saySomething;@end@implementation ZJPerson- (void)saySomething&#123; NSLog(@&quot;%s&quot;,__func__);&#125;@end// ä¸ä¸€èˆ¬çš„è°ƒç”¨å®ä¾‹çš„æ–¹æ³•Class cls = [ZJPerson class];void *zj = &amp;cls;[(__bridge id)zj saySomething]; ã€ä»£ç è°ƒè¯•ã€‘ æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­çš„è°ƒç”¨æ–¹å¼æ˜¯ä¸‹é¢è¿™ç§ 123// å¸¸è§çš„è°ƒç”¨å®ä¾‹æ–¹æ³•ZJPerson * person = [[ZJPerson alloc] init];[person saySomething]; é€šè¿‡è¿è¡Œå‘ç°ï¼Œæ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š 122022-03-16 10:30:27.686250+0800 load+initialize-demo[6296:4626148] -[ZJPerson saySomething]2022-03-16 10:30:27.686295+0800 load+initialize-demo[6296:4626148] -[ZJPerson saySomething] [person saySomething] çš„æœ¬è´¨æ˜¯ å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆå½“å‰çš„ person æ˜¯ä»€ä¹ˆï¼Ÿ person çš„ isa æŒ‡å‘ç±» ZJPersonï¼Œ å³ person çš„é¦–åœ°å€ æŒ‡å‘ ZJPerson çš„é¦–åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ZJPerson çš„å†…å­˜å¹³ç§»æ‰¾åˆ° cacheï¼Œåœ¨ cache ä¸­æŸ¥æ‰¾æ–¹æ³• [(__bridge id)zj saySomething] ä¸­çš„ zj æ˜¯æ¥è‡ªäº ZJPerson è¿™ä¸ªç±»ï¼Œç„¶åæœ‰ä¸€ä¸ªæŒ‡é’ˆ zjï¼Œå°†å…¶ æŒ‡å‘ZJPersonçš„é¦–åœ°å€ æ‰€ä»¥ï¼Œperson æ˜¯æŒ‡å‘ ZJPeron ç±»çš„ç»“æ„ï¼Œzj ä¹Ÿæ˜¯æŒ‡å‘ ZJPerson ç±»çš„ç»“æ„ï¼Œç„¶åéƒ½æ˜¯åœ¨ ZJPerson ä¸­çš„ methodList ä¸­æŸ¥æ‰¾æ–¹æ³• ä¿®æ”¹ï¼šsaySomethingé‡Œé¢æœ‰å±æ€§ self.zj_name çš„æ‰“å°12345678910111213- (void)saySomething&#123; NSLog(@&quot;%s - %@&quot;,__func__,self.zj_name);&#125;// ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼è°ƒç”¨// æ–¹å¼ä¸€Class cls = [ZJPerson class];void *zj = &amp;cls;[(__bridge id)zj saySomething]; // æ–¹å¼äºŒZJPerson * person = [[ZJPerson alloc] init];[person saySomething]; æŸ¥çœ‹è¿™ä¸¤ç§è°ƒç”¨æ–¹å¼çš„æ‰“å°ç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤º zj æ–¹å¼çš„è°ƒç”¨æ‰“å°çš„ zj_name æ˜¯ &lt;ViewController: 0x100e06eb0&gt; person æ–¹å¼è°ƒç”¨æ‰“å°çš„ zj_name æ˜¯ (null) ä¸ºä»€ä¹ˆä¼šå‡ºç°æ‰“å°ä¸ä¸€è‡´çš„æƒ…å†µï¼Ÿ å…¶ä¸­ person æ–¹å¼çš„ zj_name æ˜¯ç”±äº selfæŒ‡å‘personçš„å†…éƒ¨ç»“æ„ï¼Œç„¶åé€šè¿‡ å†…å­˜å¹³ç§»8å­—èŠ‚ï¼Œå–å‡ºå»zj_nameï¼Œå³ selfæŒ‡é’ˆé¦–åœ°å€å¹³ç§»8å­—èŠ‚è·å– ã€æ–¹å¼ä¸€ã€‘å…¶ä¸­ zj æŒ‡é’ˆä¸­æ²¡æœ‰ä»»ä½•ï¼Œæ‰€ä»¥ zjè¡¨ç¤º8å­—èŠ‚æŒ‡é’ˆï¼Œself.zj_name çš„è·å–ï¼Œç›¸å½“äº zjé¦–åœ°å€çš„æŒ‡é’ˆä¹Ÿéœ€è¦å¹³ç§»8å­—èŠ‚æ‰¾zj_nameï¼Œé‚£ä¹ˆæ­¤æ—¶çš„zjçš„æŒ‡é’ˆåœ°å€æ˜¯å¤šå°‘ï¼Ÿå¹³ç§»8å­—èŠ‚è·å–çš„æ˜¯ä»€ä¹ˆï¼Ÿ zj æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ˜¯å­˜åœ¨ æ ˆ ä¸­çš„ï¼Œæ ˆæ˜¯ä¸€ä¸ª å…ˆè¿›åå‡º çš„ç»“æ„ï¼Œå‚æ•°ä¼ å…¥å°±æ˜¯ä¸€ä¸ªä¸æ–­å‹æ ˆçš„è¿‡ç¨‹ å…¶ä¸­ éšè—å‚æ•°ä¼šå‹å…¥æ ˆï¼Œä¸”æ¯ä¸ªå‡½æ•°éƒ½ä¼šæœ‰ä¸¤ä¸ªéšè—å‚æ•° (id self,sel _cmd)ï¼Œå¯ä»¥é€šè¿‡ clang æŸ¥çœ‹åº•å±‚ç¼–è¯‘ éšè—å‚æ•°å‹æ ˆ çš„è¿‡ç¨‹ï¼Œå…¶åœ°å€æ˜¯ é€’å‡ çš„ï¼Œè€Œ æ ˆæ˜¯ä»é«˜åœ°å€ -&gt; ä½åœ°å€åˆ†é… çš„ï¼Œå³ åœ¨æ ˆä¸­ï¼Œå‚æ•°ä¼šä»å‰å¾€åä¸€ç›´å‹ superé€šè¿‡clangæŸ¥çœ‹åº•å±‚çš„ç¼–è¯‘ï¼Œæ˜¯ objc_msgSendSuperï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç»“æ„ä½“ __rw_objc_superï¼ˆself,class_getSuperclassï¼‰ï¼Œé‚£ä¹ˆç»“æ„ä½“ä¸­çš„å±æ€§æ—¶å¦‚ä½•å‹æ ˆçš„ï¼Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œåˆ¤æ–­ç»“æ„ä½“å†…éƒ¨æˆå‘˜çš„å‹æ ˆæƒ…å†µ p &amp;person3 p *(NSNumber **)0x000000016d2f59f0 p *(NSNumber **)0x000000016d2f59f8 1234struct zj_struct&#123; NSNumber *num1; NSNumber *num2;&#125;zj_struct; æ‰€ä»¥å›¾ä¸­å¯ä»¥å¾—åˆ° 20å…ˆåŠ å…¥ï¼Œå†åŠ å…¥10ï¼Œå› æ­¤ ç»“æ„ä½“å†…éƒ¨ çš„å‹æ ˆæƒ…å†µæ˜¯ ä½åœ°å€ -&gt; é«˜ åœ°å€ï¼Œé€’å¢ çš„ï¼Œæ ˆä¸­ ç»“æ„ä½“å†…éƒ¨ çš„æˆå‘˜æ˜¯ åå‘ å‹å…¥æ ˆï¼Œå³ ä½åœ°å€ -&gt; é«˜åœ°å€ï¼Œæ˜¯é€’å¢çš„ æ‰€ä»¥åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ ˆä¸­ ä»é«˜åœ°å€åˆ°ä½åœ°å€ çš„é¡ºåºçš„ï¼šself -&gt; _cmd -&gt; (id)class_getSuperclass(objc_getClass(&quot;ViewController&quot;)) -&gt; self -&gt; cls -&gt; zj -&gt; person self å’Œ _cmd æ˜¯ viewDidLoad æ–¹æ³•çš„ä¸¤ä¸ªéšè—çš„å‚æ•°ï¼Œæ˜¯é«˜åœ°å€ -&gt; ä½åœ°å€ æ­£å‘å‹æ ˆ çš„ class_getSuperClass å’Œ self ä¸º objc_msgSendSuper2 ä¸­çš„ç»“æ„ä½“æˆå‘˜ï¼Œæ˜¯ä»æœ€åä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå³ä½åœ°å€ -&gt; é«˜åœ°å€ åå‘å‹æ ˆ çš„ å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç æ‰“å°ä¸‹æ ˆçš„å­˜å‚¨æ˜¯å¦å¦‚ä¸Šé¢æ‰€è¯´ å…¶ä¸­ä¸ºä»€ä¹ˆ class_getSuperclass æ˜¯ viewControllerï¼Œå› ä¸º objc_msgSendSuper2 è¿”å›çš„æ˜¯ å½“å‰ç±»ï¼Œä¸¤ä¸ªselfï¼Œå¹¶ä¸æ˜¯åŒä¸€ä¸ªselfï¼Œè€Œæ˜¯æ ˆçš„æŒ‡é’ˆä¸åŒï¼Œä½†æ˜¯æŒ‡å‘åŒä¸€ç‰‡å†…å­˜ç©ºé—´ [(__bridge id)zj saySomething] è°ƒç”¨æ—¶ï¼Œæ­¤æ—¶çš„ zj æ˜¯ ZJPersonï¼š0x16bbc1a08 ï¼Œæ‰€ä»¥ saySomething æ–¹æ³•ä¸­ä¼ å…¥çš„ self è¿˜æ˜¯ ZJPerson ï¼Œä½†å¹¶ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è®¤ä¸ºçš„ ZJPersonï¼Œä½¿æˆ‘ä»¬å½“å‰ ä¼ å…¥çš„æ¶ˆæ¯æ¥æ”¶è€…ï¼Œå³ ZJPersonï¼š0x16bbc1a08ï¼Œæ˜¯ZJPersonçš„å®ä¾‹å¯¹è±¡ï¼Œæ­¤æ—¶æ“ä½œä¸æ™®é€šçš„ZJPersonæ˜¯ä¸€è‡´çš„ï¼Œå³ ZJPersonçš„åœ°å€å†…å­˜å¹³ç§»8å­—èŠ‚ æ™®é€špersonæµç¨‹ï¼šperson -&gt; zj_name -&gt; å†…å­˜å¹³ç§»8å­—èŠ‚ zjæµç¨‹ï¼š0x16bbc1a08 + 0x8 - &gt; 0x16bbc1a10ï¼Œå³ä¸º selfï¼ŒæŒ‡å‘ &lt;ViewController: 0x10470a370&gt;ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å…¶ä¸­ person ä¸ ZJPerson çš„å…³ç³»æ˜¯ personæ˜¯ä»¥ZJPersonä¸ºæ¨¡æ¿å®ä¾‹åŒ–å¯¹è±¡ï¼Œå³allocæœ‰ä¸€ä¸ªæŒ‡é’ˆåœ°å€ï¼ŒæŒ‡å‘isaï¼ŒisaæŒ‡å‘ZJPersonï¼Œå®ƒä»¬ä¹‹é—´å…³è”æ˜¯ç”±ä¸€ä¸ªisaæŒ‡å‘ è€Œzjä¹Ÿæ˜¯æŒ‡å‘ZJPersonçš„å…³ç³»ï¼Œç¼–è¯‘å™¨ä¼šäººä¸º zjä¹Ÿæ˜¯ZJPersonçš„ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œå³ zjç›¸å½“äºisaï¼Œå³é¦–åœ°å€ï¼ŒæŒ‡å‘ZJPersonï¼Œå…·æœ‰å’Œpersonä¸€æ ·çš„æ•ˆæœï¼Œç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å·²ç»å®Œå…¨å°†ç¼–è¯‘å™¨éª—è¿‡äº†ï¼Œå³zjä¹Ÿæœ‰zj_nameï¼Œç”±äº personæŸ¥æ‰¾zj_nameæ˜¯é€šè¿‡å†…å­˜åœ°å€å¹³ç§»8å­—èŠ‚ï¼Œæ‰€ä»¥zjä¹Ÿæ˜¯é€šè¿‡å†…å­˜åœ°å€å¹³ç§»8å­—èŠ‚å»æŸ¥æ‰¾zj_nameã€‚ å“ªäº›ä¸œè¥¿åœ¨æ ˆé‡Œï¼Ÿå“ªäº›åœ¨å †é‡Œï¼Ÿ alloc çš„å¯¹è±¡éƒ½åœ¨ å † ä¸­ æŒ‡é’ˆã€å¯¹è±¡ åœ¨ æ ˆ ä¸­ï¼Œä¾‹å¦‚ personæŒ‡å‘çš„ç©ºé—´ åœ¨ å † ä¸­ï¼Œpersonæ‰€åœ¨çš„ç©ºé—´åœ¨ æ ˆ ä¸­ ä¸´æ—¶å˜é‡ åœ¨ æ ˆ ä¸­ å±æ€§å€¼ åœ¨ å †ï¼Œå±æ€§éšå¯¹è±¡æ˜¯åœ¨ æ ˆ ä¸­ ã€æ³¨æ„ã€‘ å † æ˜¯ä»å°åˆ°å¤§ï¼Œå³ä½åœ°å€ -&gt; é«˜åœ°å€ æ ˆ æ˜¯ä»å¤§åˆ°å°ï¼Œå³ä»é«˜åœ°å€ -&gt; ä½åœ°å€åˆ†é… å‡½æ•°éšè—å‚æ•°ä¼š ä»å‰å¾€å ä¸€ç›´å‹ï¼Œå³ ä»é«˜åœ°å€ -&gt; ä½åœ°å€ å¼€å§‹å…¥æ ˆã€‚ ç»“æ„ä½“å†…éƒ¨æˆå‘˜æ˜¯ ä»ä½åœ°å€ -&gt; é«˜åœ°å€ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå†…å­˜åœ°å€æœ‰å¦‚ä¸‹è§„åˆ™ 0x60 å¼€å¤´è¡¨ç¤ºåœ¨ å † ä¸­ 0x70 å¼€å¤´çš„åœ°å€è¡¨ç¤ºåœ¨ æ ˆ ä¸­ 0x10 å¼€å¤´çš„åœ°å€è¡¨ç¤ºåœ¨ å…¨å±€åŒºåŸŸ ä¸­ ã€é¢è¯•8ã€‘runtimeæ˜¯å¦‚ä½•å®ç°weakçš„ï¼Œä¸ºä»€ä¹ˆå¯ä»¥è‡ªåŠ¨ç½®ä¸ºnilï¼Ÿ é€šè¿‡ sideTable æ‰¾åˆ°æˆ‘ä»¬çš„ weak_table weak_table æ ¹æ® referent æ‰¾åˆ°æˆ–åˆ›å»º weak_entry_t ç„¶å append_referrerï¼ˆentry,referrerï¼‰ å°†æˆ‘çš„æ–°å¼±å¼•ç”¨çš„å¯¹è±¡åŠ è¿›å»entry æœ€å weak_entry_insertï¼ŒæŠŠ entry åŠ å…¥åˆ°æˆ‘ä»¬çš„ weak_table åº•å±‚æºç è°ƒç”¨æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†19ï¼šç±»æ‰©å±•ä¸å…³è”å¯¹è±¡","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†19ï¼šç±»æ‰©å±•ä¸å…³è”å¯¹è±¡","date":"2020-11-29T07:22:06.000Z","updated":"2022-03-10T01:09:42.000Z","comments":true,"path":"2020/11/29/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†19ï¼šç±»æ‰©å±•ä¸å…³è”å¯¹è±¡/","link":"","permalink":"https://www.bboyzj.cn/2020/11/29/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8619%EF%BC%9A%E7%B1%BB%E6%89%A9%E5%B1%95%E4%B8%8E%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/","excerpt":"","text":"","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†18ï¼šç±»çš„åŠ è½½ï¼ˆä¸‹ï¼‰","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†18ï¼šç±»çš„åŠ è½½ï¼ˆä¸‹ï¼‰","date":"2020-11-19T07:21:46.000Z","updated":"2022-03-10T01:09:48.000Z","comments":true,"path":"2020/11/19/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†18ï¼šç±»çš„åŠ è½½ï¼ˆä¸‹ï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2020/11/19/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8618%EF%BC%9A%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%EF%BC%88%E4%B8%8B%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†17ï¼šç±»çš„åŠ è½½ï¼ˆä¸Šï¼‰","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†17ï¼šç±»çš„åŠ è½½ï¼ˆä¸Šï¼‰","date":"2020-11-03T07:21:34.000Z","updated":"2022-03-10T01:09:54.000Z","comments":true,"path":"2020/11/03/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†17ï¼šç±»çš„åŠ è½½ï¼ˆä¸Šï¼‰/","link":"","permalink":"https://www.bboyzj.cn/2020/11/03/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8617%EF%BC%9A%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%EF%BC%88%E4%B8%8A%EF%BC%89/","excerpt":"","text":"","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†16ï¼šdyldä¸objcçš„å…³è”","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†16ï¼šdyldä¸objcçš„å…³è”","date":"2020-10-20T07:21:21.000Z","updated":"2023-02-25T20:57:46.222Z","comments":true,"path":"2020/10/20/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†16ï¼šdyldä¸objcçš„å…³è”/","link":"","permalink":"https://www.bboyzj.cn/2020/10/20/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8616%EF%BC%9Adyld%E4%B8%8Eobjc%E7%9A%84%E5%85%B3%E8%81%94/","excerpt":"","text":"å‰è¨€æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ç†è§£ dyld ä¸ objc æ˜¯å¦‚ä½•å…³è”çš„ï¼Ÿ åœ¨ä¸Šä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¢³ç†äº† dyld çš„åŠ è½½æµç¨‹ï¼Œä¸‹é¢æ¥è¯¦ç»†ä»‹ç»ä¸‹ dyld å’Œ objc çš„å…³è” _objc_init æºç è§£æé¦–å…ˆï¼Œæ¥çœ‹ä¸‹libObjcä¸­çš„_objc_initæ–¹æ³•æºç  12345678910111213141516171819202122232425262728293031323334353637void _objc_init(void)&#123; static bool initialized = false; if (initialized) return; initialized = true; // fixme defer initialization until an objc-using image is found? //è¯»å–å½±å“è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥æ‰“å¼€ç¯å¢ƒå˜é‡å¸®åŠ© export OBJC_HELP = 1 environ_init(); //å…³äºçº¿ç¨‹keyçš„ç»‘å®šï¼Œä¾‹å¦‚çº¿ç¨‹æ•°æ®çš„ææ„å‡½æ•° tls_init(); //è¿è¡ŒC++é™æ€æ„é€ å‡½æ•°ï¼Œåœ¨dyldè°ƒç”¨æˆ‘ä»¬çš„é™æ€ææ„å‡½æ•°ä¹‹å‰ï¼Œlibcä¼šè°ƒç”¨_objc_init(),å› æ­¤æˆ‘ä»¬å¿…é¡»è‡ªå·±åš static_init(); //runtimeè¿è¡Œæ—¶ç¯å¢ƒåˆå§‹åŒ–ï¼Œé‡Œé¢ä¸»è¦æ˜¯unattachedCategoriesã€allocatedClasses -- åˆ†ç±»åˆå§‹åŒ– runtime_init(); //åˆå§‹åŒ–libobjcçš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ exception_init(); //ç¼“å­˜æ¡ä»¶åˆå§‹åŒ– cache_init(); //å¯åŠ¨å›è°ƒæœºåˆ¶ï¼Œé€šå¸¸è¿™ä¸ä¼šåšä»€ä¹ˆï¼Œå› ä¸ºæ‰€æœ‰çš„åˆå§‹åŒ–éƒ½æ˜¯æƒ°æ€§çš„ï¼Œä½†æ˜¯å¯¹äºæŸäº›è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šè¿«ä¸åŠå¾…åœ°åŠ è½½trampolines dylib _imp_implementationWithBlock_init(); /* _dyld_objc_notify_register -- dyld æ³¨å†Œçš„åœ°æ–¹ - ä»…ä¾›objcè¿è¡Œæ—¶ä½¿ç”¨ - æ³¨å†Œå¤„ç†ç¨‹åºï¼Œä»¥ä¾¿åœ¨æ˜ å°„ã€å–æ¶ˆæ˜ å°„ å’Œåˆå§‹åŒ–objcé•œåƒæ–‡ä»¶æ—¶ä½¿ç”¨ï¼Œdyldå°†ä½¿ç”¨åŒ…å«objc_image_infoçš„é•œåƒæ–‡ä»¶æ•°ç»„ï¼Œå›è°ƒ mapped å‡½æ•° map_images:dyldå°†imageé•œåƒæ–‡ä»¶åŠ è½½è¿›å†…å­˜æ—¶ï¼Œä¼šè§¦å‘è¯¥å‡½æ•° load_imagesï¼šdyldåˆå§‹åŒ–imageä¼šè§¦å‘è¯¥å‡½æ•° unmap_imageï¼šdyldå°†imageç§»é™¤æ—¶ä¼šè§¦å‘è¯¥å‡½æ•° */ _dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);#if __OBJC2__ didCallDyldNotifyRegister = true;#endif&#125; æ ¹æ®æºç æ‰€çŸ¥ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š environ_initï¼šåˆå§‹åŒ–ä¸€ç³»åˆ—ç¯å¢ƒå˜é‡ï¼Œå¹¶è¯»å–å½±å“è¿è¡Œæ—¶çš„ç¯å¢ƒå˜é‡ tls_initï¼šå…³äºçº¿ç¨‹keyçš„ç»‘å®š static_initï¼šè¿è¡ŒC++é™æ€æ„é€ å‡½æ•°ï¼ˆåªä¼šè¿è¡Œç³»ç»Ÿçº§åˆ«çš„æ„é€ å‡½æ•°ï¼‰ï¼Œåœ¨dyldè°ƒç”¨é™æ€ææ„å‡½æ•°ä¹‹å‰ï¼Œlibcä¼šè°ƒç”¨_objc_init runtime_initï¼šruntimeè¿è¡Œæ—¶ç¯å¢ƒåˆå§‹åŒ–ï¼Œé‡Œé¢æ“ä½œæ˜¯unattachedCategoriesã€allocatedClassesï¼ˆè¡¨çš„åˆå§‹åŒ–ï¼‰ exception_initï¼šåˆå§‹åŒ–libObjcçš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿ cache_initï¼š cacheç¼“å­˜åˆå§‹åŒ– _imp_implementationWithBlock_init ï¼šå¯åŠ¨å›è°ƒæœºåˆ¶ï¼Œé€šå¸¸è¿™ä¸ä¼šåšä»€ä¹ˆï¼Œå› ä¸ºæ‰€æœ‰çš„åˆå§‹åŒ–éƒ½æ˜¯æƒ°æ€§çš„ï¼Œä½†æ˜¯å¯¹äºæŸäº›è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šè¿«ä¸åŠå¾…åœ°åŠ è½½trampolines dylib _dyld_objc_notify_registerï¼š dyldçš„æ³¨å†Œ ä¸‹é¢ä¸»è¦é’ˆå¯¹ä»¥ä¸Šå‡ éƒ¨åˆ†é…åˆæºç è¿›è¡Œè¯´æ˜ environ_initæ–¹æ³•ï¼šç¯å¢ƒå˜é‡åˆå§‹åŒ–environ_initæ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œå…¶ä¸­çš„å…³é”®ä»£ç æ˜¯ for å¾ªç¯ 123456789101112void environ_init(void) &#123; //...çœç•¥éƒ¨åˆ†é€»è¾‘if (PrintHelp || PrintOptions) &#123; //...çœç•¥éƒ¨åˆ†é€»è¾‘ for (size_t i = 0; i &lt; sizeof(Settings)/sizeof(Settings[0]); i++) &#123; const option_t *opt = &amp;Settings[i]; if (PrintHelp) _objc_inform(&quot;%s: %s&quot;, opt-&gt;env, opt-&gt;help); if (PrintOptions &amp;&amp; *opt-&gt;var) _objc_inform(&quot;%s is set&quot;, opt-&gt;env); &#125; &#125;&#125; æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼å¯ä»¥æ‰“å°æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ å°†forå¾ªç¯å•ç‹¬æ‹¿å‡ºæ¥ï¼Œå»é™¤æ‰€æœ‰æ¡ä»¶ï¼Œæ‰“å°ç¯å¢ƒå˜é‡ é€šè¿‡ç»ˆç«¯å‘½ä»¤export OBJC_hrlp &#x3D; 1,æ‰“å°ç¯å¢ƒå˜é‡ è¿™äº›ç¯å¢ƒå˜é‡ï¼Œå‡å¯ä»¥é€šè¿‡target â€“ Edit Scheme â€“ Run â€“Arguments â€“ Environment Variablesé…ç½®ï¼Œå…¶ä¸­å¸¸ç”¨çš„ç¯å¢ƒå˜é‡ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªï¼ˆç¯å¢ƒå˜é‡æ±‡æ€»è§æ–‡æœ«ï¼ï¼‰ï¼š DYLD_PRINT_STATISTICSï¼šè®¾ç½® DYLD_PRINT_STATISTICS ä¸ºYESï¼Œæ§åˆ¶å°å°±ä¼šæ‰“å° App çš„åŠ è½½æ—¶é•¿ï¼ŒåŒ…æ‹¬æ•´ä½“åŠ è½½æ—¶é•¿å’ŒåŠ¨æ€åº“åŠ è½½æ—¶é•¿ï¼Œå³mainå‡½æ•°ä¹‹å‰çš„å¯åŠ¨æ—¶é—´ï¼ˆæŸ¥çœ‹pre-mainè€—æ—¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®äº†è§£å…¶è€—æ—¶éƒ¨åˆ†ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¯åŠ¨ä¼˜åŒ–ã€‚ OBJC_DISABLE_NONPOINTER_ISAï¼šæœç»ç”Ÿæˆç›¸åº”çš„nonpointer isaï¼ˆnonpointer isaæŒ‡é’ˆåœ°å€ æœ«å°¾ä¸º1 ï¼‰ï¼Œç”Ÿæˆçš„éƒ½æ˜¯æ™®é€šçš„isa OBJC_PRINT_LOAD_METHODSï¼šæ‰“å° Class åŠ Category çš„ + (void)load æ–¹æ³•çš„è°ƒç”¨ä¿¡æ¯ NSDoubleLocalizedStringsï¼šé¡¹ç›®åšå›½é™…åŒ–æœ¬åœ°åŒ–(Localized)çš„æ—¶å€™æ˜¯ä¸€ä¸ªæŒºè€—æ—¶çš„å·¥ä½œï¼Œæƒ³è¦æ£€æµ‹å›½é™…åŒ–ç¿»è¯‘å¥½çš„è¯­è¨€æ–‡å­—UIä¼šå˜æˆä»€ä¹ˆæ ·å­ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªå¯åŠ¨é¡¹ã€‚å¯ä»¥è®¾ç½® NSDoubleLocalizedStrings ä¸ºYESã€‚ NSShowNonLocalizedStringsï¼šåœ¨å®Œæˆå›½é™…åŒ–çš„æ—¶å€™ï¼Œå¶å°”ä¼šæœ‰ä¸€äº›å­—ç¬¦ä¸²æ²¡æœ‰åšæœ¬åœ°åŒ–ï¼Œè¿™æ—¶å°±å¯ä»¥è®¾ç½®NSShowNonLocalizedStrings ä¸ºYESï¼Œæ‰€æœ‰æ²¡æœ‰è¢«æœ¬åœ°åŒ–çš„å­—ç¬¦ä¸²å…¨éƒ½ä¼šå˜æˆå¤§å†™ã€‚ ç¯å¢ƒå˜é‡ - OBJC_DISABLE_NONPOINTER_ISAä»¥OBJC_DISABLE_NONPOINTER_ISAä¸ºä¾‹ï¼Œå°†å…¶è®¾ç½®ä¸ºYESï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º æœªè®¾ç½® OBJC_DISABLE_NONPOINTER_ISAå‰ï¼Œ isaåœ°å€çš„äºŒè¿›åˆ¶æ‰“å°ï¼Œæœ«å°¾ä¸º1 è®¾ç½®OBJC_DISABLE_NONPOINTER_ISAç¯å¢ƒå˜é‡åï¼Œæœ«å°¾å˜æˆäº†0 æ‰€ä»¥OBJC_DISABLE_NONPOINTER_ISAå¯ä»¥æ§åˆ¶isaä¼˜åŒ–å¼€å…³ï¼Œä»è€Œä¼˜åŒ–æ•´ä¸ªå†…å­˜ç»“æ„ ç¯å¢ƒå˜é‡ - OBJC_PRINT_LOAD_METHODS é…ç½®æ‰“å°load æ–¹æ³•çš„ç¯å¢ƒå˜é‡OBJC_PRINT_LOAD_METHODSï¼Œè®¾ç½®ä¸ºYES åœ¨LGPersonç±»ä¸­é‡å†™+loadå‡½æ•°ï¼Œè¿è¡Œç¨‹åºï¼Œloadå‡½æ•°çš„æ‰“å°å¦‚ä¸‹ æ‰€ä»¥ï¼ŒOBJC_PRINT_LOAD_METHODSå¯ä»¥ç›‘æ§æ‰€æœ‰çš„+loadæ–¹æ³•ï¼Œä»è€Œå¤„ç†å¯åŠ¨ä¼˜åŒ–ï¼ˆåç»­ä¼šæ€»ç»“ä¸‹å¯åŠ¨ä¼˜åŒ–æ–¹æ³•ï¼‰ tls_initï¼šçº¿ç¨‹keyçš„ç»‘å®šä¸»è¦æ˜¯æœ¬åœ°çº¿ç¨‹æ± çš„åˆå§‹åŒ–ä»¥åŠææ„ï¼Œæºç å¦‚ä¸‹ 12345678void tls_init(void)&#123;#if SUPPORT_DIRECT_THREAD_KEYS//æœ¬åœ°çº¿ç¨‹æ± ï¼Œç”¨æ¥è¿›è¡Œå¤„ç† pthread_key_init_np(TLS_DIRECT_KEY, &amp;_objc_pthread_destroyspecific);//åˆå§‹init#else _objc_pthread_key = tls_create(&amp;_objc_pthread_destroyspecific);//ææ„#endif&#125; static_initï¼šè¿è¡Œç³»ç»Ÿçº§åˆ«çš„C++é™æ€æ„é€ å‡½æ•°ä¸»è¦æ˜¯è¿è¡Œç³»ç»Ÿçº§åˆ«çš„C++é™æ€æ„é€ å‡½æ•°ï¼Œåœ¨dyldè°ƒç”¨æˆ‘ä»¬çš„é™æ€æ„é€ å‡½æ•°ä¹‹å‰ï¼Œlibcè°ƒç”¨_objc_initæ–¹æ³•ï¼Œå³ç³»ç»Ÿçº§åˆ«çš„C++æ„é€ å‡½æ•° å…ˆäº è‡ªå®šä¹‰çš„C++æ„é€ å‡½æ•° è¿è¡Œ 12345678static void static_init()&#123; size_t count; auto inits = getLibobjcInitializers(&amp;_mh_dylib_header, &amp;count); for (size_t i = 0; i &lt; count; i++) &#123; inits[i](); &#125;&#125; runtime_initï¼šè¿è¡Œæ—¶ç¯å¢ƒåˆå§‹åŒ–ä¸»è¦æ˜¯è¿è¡Œæ—¶çš„åˆå§‹åŒ–ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šåˆ†ç±»åˆå§‹åŒ–ã€ç±»çš„è¡¨åˆå§‹åŒ–ï¼ˆåç»­ä¼šè¯¦ç»†è®²è§£å¯¹åº”çš„å‡½æ•°ï¼‰ 12345void runtime_init(void)&#123; objc::unattachedCategories.init(32); objc::allocatedClasses.init(); //åˆå§‹åŒ– -- å¼€è¾Ÿçš„ç±»çš„è¡¨&#125; exception_initï¼šåˆå§‹åŒ–libobjcçš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿä¸»è¦æ˜¯åˆå§‹åŒ–libobjcçš„å¼‚å¸¸å¤„ç†ç³»ç»Ÿï¼Œæ³¨å†Œå¼‚å¸¸å¤„ç†çš„å›è°ƒï¼Œä»è€Œç›‘æ§å¼‚å¸¸çš„å¤„ç†ï¼Œæºç å¦‚ä¸‹ 1234void exception_init(void)&#123; old_terminate = std::set_terminate(&amp;_objc_terminate);&#125; å½“æœ‰crashï¼ˆcrashæ˜¯æŒ‡ç³»ç»Ÿå‘ç”Ÿçš„ä¸å…è®¸çš„ä¸€äº›æŒ‡ä»¤ï¼Œç„¶åç³»ç»Ÿç»™çš„ä¸€äº›ä¿¡å·ï¼‰å‘ç”Ÿæ—¶ï¼Œä¼šæ¥åˆ°_objc_terminateæ–¹æ³•ï¼Œèµ°åˆ°uncaught_handleræ‰”å‡ºå¼‚å¸¸ 1234567891011121314151617181920212223242526272829303132333435/************************************************************************ _objc_terminate* Custom std::terminate handler.** The uncaught exception callback is implemented as a std::terminate handler. * 1. Check if there&#x27;s an active exception* 2. If so, check if it&#x27;s an Objective-C exception* 3. If so, call our registered callback with the object.* 4. Finally, call the previous terminate handler.**********************************************************************/static void (*old_terminate)(void) = nil;static void _objc_terminate(void)&#123; if (PrintExceptions) &#123; _objc_inform(&quot;EXCEPTIONS: terminating&quot;); &#125; if (! __cxa_current_exception_type()) &#123; // No current exception. (*old_terminate)(); &#125; else &#123; // There is a current exception. Check if it&#x27;s an objc exception. @try &#123; __cxa_rethrow(); &#125; @catch (id e) &#123; // It&#x27;s an objc object. Call Foundation&#x27;s handler, if any. (*uncaught_handler)((id)e);//æ‰”å‡ºå¼‚å¸¸ (*old_terminate)(); &#125; @catch (...) &#123; // It&#x27;s not an objc object. Continue to C++ terminate. (*old_terminate)(); &#125; &#125;&#125; æœç´¢uncaught_handlerï¼Œåœ¨appå±‚ä¼šä¼ å…¥ä¸€ä¸ªå‡½æ•°ç”¨äºå¤„ç†å¼‚å¸¸ï¼Œä»¥ä¾¿äºè°ƒç”¨å‡½æ•°ï¼Œç„¶åå›åˆ°åŸæœ‰çš„appå±‚ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­fnå³ä¸ºä¼ å…¥çš„å‡½æ•°ï¼Œå³ uncaught_handler ç­‰äº fn 12345678objc_uncaught_exception_handler objc_setUncaughtExceptionHandler(objc_uncaught_exception_handler fn)&#123;// fnä¸ºè®¾ç½®çš„å¼‚å¸¸å¥æŸ„ ä¼ å…¥çš„å‡½æ•°ï¼Œä¸ºå¤–ç•Œç»™çš„ objc_uncaught_exception_handler result = uncaught_handler; uncaught_handler = fn; //èµ‹å€¼ return result;&#125; crashåˆ†ç±»crashçš„ä¸»è¦åŸå› æ˜¯æ”¶åˆ°äº†æœªå¤„ç†çš„ä¿¡å·ï¼Œä¸»è¦æ¥æºäºä¸‰ä¸ªåœ°æ–¹ï¼š kernel å†…æ ¸ å…¶ä»–è¿›è¡Œ Appæœ¬èº« æ‰€ä»¥ç›¸å¯¹åº”çš„ï¼Œcrashä¹Ÿåˆ†ä¸ºäº†3ç§ Machå¼‚å¸¸ï¼šæ˜¯æŒ‡æœ€åº•å±‚çš„å†…æ ¸çº§å¼‚å¸¸ã€‚ç”¨æˆ·æ€çš„å¼€å‘è€…å¯ä»¥ç›´æ¥é€šè¿‡Mach APIè®¾ç½®threadï¼Œtaskï¼Œhostçš„å¼‚å¸¸ç«¯å£ï¼Œæ¥æ•è·Machå¼‚å¸¸ã€‚ Unixä¿¡å·ï¼šåˆç§°BSD ä¿¡å·ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰æ•è·Machå¼‚å¸¸ï¼Œåˆ™ä¼šè¢«hostå±‚çš„æ–¹æ³•ux_exception()å°†å¼‚å¸¸è½¬æ¢ä¸ºå¯¹åº”çš„UNIXä¿¡å·ï¼Œå¹¶é€šè¿‡æ–¹æ³•threadsignal()å°†ä¿¡å·æŠ•é€’åˆ°å‡ºé”™çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡æ–¹æ³•signal(x, SignalHandler)æ¥æ•è·singleã€‚ NSException åº”ç”¨çº§å¼‚å¸¸ï¼šå®ƒæ˜¯æœªè¢«æ•è·çš„Objective-Cå¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºå‘è‡ªèº«å‘é€äº†SIGABRTä¿¡å·è€Œå´©æºƒï¼Œå¯¹äºæœªæ•è·çš„Objective-Cå¼‚å¸¸ï¼Œæ˜¯å¯ä»¥é€šè¿‡try catchæ¥æ•è·çš„ï¼Œæˆ–è€…é€šè¿‡NSSetUncaughtExceptionHandler()æœºåˆ¶æ¥æ•è·ã€‚ é’ˆå¯¹åº”ç”¨çº§å¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œå¼‚å¸¸æ•è·çš„å‡½æ•°ï¼Œå³NSSetUncaughtExceptionHandleræœºåˆ¶,å®ç°çº¿ç¨‹ä¿æ´», æ”¶é›†ä¸Šä¼ å´©æºƒæ—¥å¿— åº”ç”¨çº§crashæ‹¦æˆªæ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œä¼šé’ˆå¯¹crashè¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œå³appä»£ç ä¸­ç»™ä¸€ä¸ªå¼‚å¸¸å¥æŸ„NSSetUncaughtExceptionHandlerï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ç»™ç³»ç»Ÿï¼Œå½“å¼‚å¸¸å‘ç”Ÿåï¼Œè°ƒç”¨å‡½æ•°ï¼ˆå‡½æ•°ä¸­å¯ä»¥çº¿ç¨‹ä¿æ´»ã€æ”¶é›†å¹¶ä¸Šä¼ å´©æºƒæ—¥å¿—ï¼‰ï¼Œç„¶åå›åˆ°åŸæœ‰çš„appå±‚ä¸­ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ä¸Šè¿°æ–¹å¼åªé€‚åˆæ”¶é›†åº”ç”¨çº§å¼‚å¸¸ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ç”¨è‡ªå®šä¹‰çš„å‡½æ•°æ›¿ä»£è¯¥ExceptionHandlerå³å¯ cache_initï¼šç¼“å­˜åˆå§‹åŒ–ä¸»è¦æ˜¯ç¼“å­˜åˆå§‹åŒ–ï¼Œæºç å¦‚ä¸‹ 1234567891011121314151617void cache_init()&#123;#if HAVE_TASK_RESTARTABLE_RANGES mach_msg_type_number_t count = 0; kern_return_t kr; while (objc_restartableRanges[count].location) &#123; count++; &#125; //ä¸ºå½“å‰ä»»åŠ¡æ³¨å†Œä¸€ç»„å¯é‡æ–°å¯åŠ¨çš„ç¼“å­˜ kr = task_restartable_ranges_register(mach_task_self(), objc_restartableRanges, count); if (kr == KERN_SUCCESS) return; _objc_fatal(&quot;task_restartable_ranges_register failed (result 0x%x: %s)&quot;, kr, mach_error_string(kr));#endif // HAVE_TASK_RESTARTABLE_RANGES&#125; _imp_implementationWithBlock_initï¼šå¯åŠ¨å›è°ƒæœºåˆ¶è¯¥æ–¹æ³•ä¸»è¦æ˜¯å¯åŠ¨å›è°ƒæœºåˆ¶ï¼Œé€šå¸¸è¿™ä¸ä¼šåšä»€ä¹ˆï¼Œå› ä¸ºæ‰€æœ‰çš„åˆå§‹åŒ–éƒ½æ˜¯æƒ°æ€§çš„ï¼Œä½†æ˜¯å¯¹äºæŸäº›è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šè¿«ä¸åŠå¾…åœ°åŠ è½½libobjc-trampolines.dylibï¼Œå…¶æºç å¦‚ä¸‹ 123456789101112131415161718192021void_imp_implementationWithBlock_init(void)&#123;#if TARGET_OS_OSX // Eagerly load libobjc-trampolines.dylib in certain processes. Some // programs (most notably QtWebEngineProcess used by older versions of // embedded Chromium) enable a highly restrictive sandbox profile which // blocks access to that dylib. If anything calls // imp_implementationWithBlock (as AppKit has started doing) then we&#x27;ll // crash trying to load it. Loading it here sets it up before the sandbox // profile is enabled and blocks it. // åœ¨æŸäº›è¿›ç¨‹ä¸­æ¸´æœ›åŠ è½½libobjc-trampolines.dylibã€‚ä¸€äº›ç¨‹åºï¼ˆæœ€è‘—åçš„æ˜¯åµŒå…¥å¼Chromiumçš„è¾ƒæ—©ç‰ˆæœ¬ä½¿ç”¨çš„QtWebEngineProcessï¼‰å¯ç”¨äº†ä¸¥æ ¼é™åˆ¶çš„æ²™ç®±é…ç½®æ–‡ä»¶ï¼Œä»è€Œé˜»æ­¢äº†å¯¹è¯¥dylibçš„è®¿é—®ã€‚å¦‚æœæœ‰ä»»ä½•è°ƒç”¨imp_implementationWithBlockçš„æ“ä½œï¼ˆå¦‚AppKitå¼€å§‹æ‰§è¡Œçš„æ“ä½œï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†åœ¨å°è¯•åŠ è½½å®ƒæ—¶å´©æºƒã€‚å°†å…¶åŠ è½½åˆ°æ­¤å¤„å¯åœ¨å¯ç”¨æ²™ç®±é…ç½®æ–‡ä»¶ä¹‹å‰å¯¹å…¶è¿›è¡Œè®¾ç½®å¹¶é˜»æ­¢å®ƒã€‚ // This fixes EA Origin (rdar://problem/50813789) // and Steam (rdar://problem/55286131) if (__progname &amp;&amp; (strcmp(__progname, &quot;QtWebEngineProcess&quot;) == 0 || strcmp(__progname, &quot;Steam Helper&quot;) == 0)) &#123; Trampolines.Initialize(); &#125;#endif&#125; _dyld_objc_notify_registerï¼šdyldæ³¨å†Œ_dyld_objc_notify_registeræ–¹æ³• è¿™ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°åœ¨ iOS-åº•å±‚åŸç† 15-1ï¼šdyldåŠ è½½æµç¨‹ å·²ç»æœ‰è¯¦ç»†è¯´æ˜ï¼Œå…¶æºç å®ç°æ˜¯åœ¨dyldæºç ä¸­ï¼Œä»¥ä¸‹æ˜¯_dyld_objc_notify_registeræ–¹æ³•çš„å£°æ˜ 12345678910111213//// Note: only for use by objc runtime// Register handlers to be called when objc images are mapped, unmapped, and initialized.// Dyld will call back the &quot;mapped&quot; function with an array of images that contain an objc-image-info section.// Those images that are dylibs will have the ref-counts automatically bumped, so objc will no longer need to// call dlopen() on them to keep them from being unloaded. During the call to _dyld_objc_notify_register(),// dyld will call the &quot;mapped&quot; function with already loaded objc images. During any later dlopen() call,// dyld will also call the &quot;mapped&quot; function. Dyld will call the &quot;init&quot; function when dyld would be called// initializers in that image. This is when objc calls any +load methods in that image.//void _dyld_objc_notify_register(_dyld_objc_notify_mapped mapped, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmapped); ä»æ³¨é‡Šä¸­ï¼Œå¯ä»¥å¾—å‡ºï¼š ä»…ä¾›objcè¿è¡Œæ—¶ä½¿ç”¨ æ³¨å†Œå¤„ç†ç¨‹åºï¼Œä»¥ä¾¿åœ¨æ˜ å°„ã€å–æ¶ˆæ˜ å°„å’Œåˆå§‹åŒ–objcå›¾åƒæ—¶è°ƒç”¨ dyldå°†ä¼šé€šè¿‡ä¸€ä¸ªåŒ…å«objc-image-infoçš„é•œåƒæ–‡ä»¶çš„æ•°ç»„å›è°ƒmappedå‡½æ•° æ–¹æ³•ä¸­çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºçš„å«ä¹‰å¦‚ä¸‹ï¼š map_imagesï¼šdyldå°†imageï¼ˆé•œåƒæ–‡ä»¶ï¼‰åŠ è½½è¿›å†…å­˜æ—¶ï¼Œä¼šè§¦å‘è¯¥å‡½æ•° load_imageï¼šdyldåˆå§‹åŒ–imageä¼šè§¦å‘è¯¥å‡½æ•° unmap_imageï¼šdyldå°†imageç§»é™¤æ—¶ï¼Œä¼šè§¦å‘è¯¥å‡½æ•° dyldä¸Objcçš„å…³è”å…¶æ–¹æ³•çš„æºç å®ç°ä¸è°ƒç”¨å¦‚ä¸‹ï¼Œå³dyldä¸Objcçš„å…³è”å¯ä»¥é€šè¿‡æºç ä½“ç° 1234567891011===&gt; dyldæºç --å…·ä½“å®ç°void _dyld_objc_notify_register(_dyld_objc_notify_mapped mapped, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmapped)&#123; dyld::registerObjCNotifiers(mapped, init, unmapped);&#125;ğŸ”½===&gt; libobjcæºç ä¸­--è°ƒç”¨_dyld_objc_notify_register(&amp;map_images, load_images, unmap_image); ä»ä¸Šå¯ä»¥å¾—å‡º mapped ç­‰ä»·äº map_images init ç­‰ä»·äº load_images unmapped ç­‰ä»·äº unmap_image åœ¨iOS-åº•å±‚åŸç† 15-1ï¼šdyldåŠ è½½æµç¨‹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†load_imagesæ˜¯åœ¨notifySingleæ–¹æ³•ä¸­ï¼Œé€šè¿‡sNotifyObjCInitè°ƒç”¨çš„ï¼Œå¦‚ä¸‹æ‰€ç¤º ç„¶åé€šè¿‡æŸ¥æ‰¾sNotifyObjCInitï¼Œæœ€ç»ˆæ‰¾åˆ°äº†_dyld_objc_notify_register â€“&gt; registerObjCNotifiers,åœ¨è¯¥æ–¹æ³•ä¸­å°†_dyld_objc_notify_registerä¼ å…¥çš„å‚æ•°èµ‹å€¼ç»™äº†3ä¸ªå›è°ƒæ–¹æ³• æ‰€ä»¥ æœ‰ä»¥ä¸‹ç­‰ä»·å…³ç³» sNotifyObjCMapped &#x3D;&#x3D; mapped &#x3D;&#x3D; map_images sNotifyObjCInit &#x3D;&#x3D; init &#x3D;&#x3D; load_images sNotifyObjCUnmapped &#x3D;&#x3D; unmapped &#x3D;&#x3D; unmap_image map_imagesè°ƒç”¨æ—¶æœº å…³äºload_imagesçš„è°ƒç”¨æ—¶æœºå·²ç»åœ¨dyldåŠ è½½æµç¨‹ä¸­è®²è§£è¿‡äº†ï¼Œä¸‹é¢ä»¥map_imagesä¸ºä¾‹ï¼Œçœ‹çœ‹å…¶è°ƒç”¨æ—¶æœº dyldä¸­å…¨å±€æœç´¢ sNotifyObjcMapped ï¼šregisterObjCNotifiers â€“ notifyBatchPartial â€“ sNotifyObjCMapped å…¨å±€æœç´¢notifyBatchPartialï¼Œåœ¨registerObjCNotifiersæ–¹æ³•ä¸­è°ƒç”¨ æ‰€ä»¥æœ‰ä»¥ä¸‹ç»“è®ºï¼šmap_imagesæ˜¯å…ˆäºload_imagesè°ƒç”¨ï¼Œå³å…ˆmap_images ï¼Œå†load_images dyldä¸Objcå…³è”ç»“åˆdyldåŠ è½½æµç¨‹ï¼Œdyldä¸Objcçš„å…³è”å¦‚ä¸‹å›¾æ‰€ç¤º åœ¨dyldä¸­æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸º æ·»åŠ è§‚å¯Ÿè€… åœ¨objcä¸­dyldæ³¨å†Œï¼Œå¯ä»¥ç†è§£ä¸ºå‘é€é€šçŸ¥ è§¦å‘å›è°ƒï¼Œå¯ä»¥ç†è§£ä¸ºæ‰§è¡Œé€šçŸ¥selector é™„å½•ç¯å¢ƒå˜é‡æ±‡æ€»","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†15ï¼šdyldæºç åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†15-1ï¼šdyldåŠ è½½æµç¨‹","date":"2020-10-10T13:02:58.000Z","updated":"2023-02-25T20:29:31.347Z","comments":true,"path":"2020/10/10/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†15-1ï¼šdyldåŠ è½½æµç¨‹/","link":"","permalink":"https://www.bboyzj.cn/2020/10/10/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8615-1%EF%BC%9Adyld%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B/","excerpt":"","text":"å‰è¨€æœ¬æ–‡çš„ç›®çš„ä¸»è¦æ˜¯åˆ†æ dyld çš„åŠ è½½æµç¨‹ï¼Œäº†è§£åœ¨ main å‡½æ•°ä¹‹å‰ï¼Œåº•å±‚è¿˜åšäº†ä»€ä¹ˆ å°å­ åˆ›å»ºä¸€ä¸ªprojectï¼Œåœ¨ViewControllerä¸­é‡å†™äº† loadæ–¹æ³•ï¼Œåœ¨mainä¸­åŠ äº†ä¸€ä¸ª C++æ–¹æ³•ï¼Œå³ kcFUncï¼Œè¯·é—®å®ƒä»¬çš„æ‰“å°å…ˆåé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ VCä¸­ä»£ç ï¼š main.m ä¸­å®ç°ï¼š è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ loadã€kcFuncã€mainçš„æ‰“å°é¡ºåºï¼Œä¸‹é¢æ˜¯æ‰“å°ç»“æœï¼Œé€šè¿‡ç»“æœå¯ä»¥çœ‹å‡ºå…¶é¡ºåºæ˜¯ load --&gt; C++æ–¹æ³• --&gt; main é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Ÿä¸ºä»€ä¹ˆæ˜¯è¿™ä¹ˆä¸€ä¸ªé¡ºåºï¼ŸæŒ‰ç…§å¸¸è§„çš„æ€ç»´ç†è§£ï¼Œmainä¸æ˜¯å…¥å£å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯mainæœ€å…ˆæ‰§è¡Œï¼Ÿ ä¸‹é¢æ ¹æ®è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥æ¢ç´¢åœ¨èµ°åˆ°mainä¹‹å‰ï¼Œåˆ°åº•è¿˜åšäº†ä»€ä¹ˆã€‚ ç¼–è¯‘è¿‡ç¨‹åŠåº“åœ¨åˆ†æappå¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£iOSappä»£ç çš„ ç¼–è¯‘è¿‡ç¨‹ä»¥åŠ åŠ¨æ€åº“å’Œé™æ€åº“ã€‚ ç¼–è¯‘è¿‡ç¨‹å…¶ä¸­ ç¼–è¯‘è¿‡ç¨‹ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š æºæ–‡ä»¶ï¼šè½½å…¥.hã€.mã€.cppç­‰æ–‡ä»¶ é¢„å¤„ç†ï¼šæ›¿æ¢å®ï¼Œåˆ é™¤æ³¨é‡Šï¼Œå±•å¼€å¤´æ–‡ä»¶ï¼Œäº§ç”Ÿ.iæ–‡ä»¶ ç¼–è¯‘ï¼šå°†.iæ–‡ä»¶è½¬æ¢ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œäº§ç”Ÿ.sæ–‡ä»¶ æ±‡ç¼–ï¼šå°†æ±‡ç¼–æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç æ–‡ä»¶ï¼Œäº§ç”Ÿ.oæ–‡ä»¶ é“¾æ¥ï¼šå¯¹.oæ–‡ä»¶ä¸­å¼•ç”¨å…¶ä»–åº“çš„åœ°æ–¹è¿›è¡Œå¼•ç”¨ï¼Œç”Ÿæˆæœ€åçš„ å¯æ‰§è¡Œæ–‡ä»¶ MachO é™æ€åº“ å’Œ åŠ¨æ€åº“ é™æ€åº“ï¼šåœ¨é“¾æ¥é˜¶æ®µï¼Œä¼šå°†å¯æ±‡ç¼–ç”Ÿæˆçš„ç›®æ ‡ç¨‹åºä¸å¼•ç”¨çš„åº“ä¸€èµ·é“¾æ¥æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶å½“ä¸­ã€‚æ­¤æ—¶çš„é™æ€åº“å°±ä¸ä¼šåœ¨æ”¹å˜äº†ï¼Œå› ä¸ºå®ƒæ˜¯ ç¼–è¯‘æ—¶è¢«ç›´æ¥æ‹·è´ä¸€ä»½ï¼Œå¤åˆ¶åˆ°ç›®æ ‡ç¨‹åºé‡Œçš„ å¥½å¤„ï¼šç¼–è¯‘å®Œæˆåï¼Œåº“æ–‡ä»¶å®é™…ä¸Šå°±æ²¡æœ‰ä½œç”¨äº†ï¼Œç›®æ ‡ç¨‹åºæ²¡æœ‰å¤–éƒ¨ä¾èµ–ï¼Œç›´æ¥å°±å¯ä»¥è¿è¡Œ ç¼ºç‚¹ï¼šç”±äºé™æ€åº“ä¼šæœ‰ä¸¤ä»½ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ ç›®æ ‡ç¨‹åºçš„ä½“ç§¯å¢å¤§ï¼Œå¯¹å†…å­˜ã€æ€§èƒ½ã€é€Ÿåº¦æ¶ˆè€—å¾ˆå¤§ åŠ¨æ€åº“ï¼šç¨‹åºç¼–è¯‘æ—¶å¹¶ä¸ä¼šé“¾æ¥åˆ°ç›®æ ‡ç¨‹åºä¸­ï¼Œç›®æ ‡ç¨‹åºåªä¼šå­˜å‚¨æŒ‡å‘åŠ¨æ€åº“çš„å¼•ç”¨ï¼Œåœ¨ ç¨‹åºè¿è¡Œæ—¶æ‰è¢«è½½å…¥ ä¼˜åŠ¿ï¼š å‡å°‘æ‰“åŒ…ä¹‹åappçš„å¤§å°ï¼šå› ä¸ºä¸éœ€è¦æ‹·è´è‡³ç›®æ ‡ç¨‹åºä¸­ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“ç›®æ ‡ç¨‹åºçš„ä½“ç§¯ï¼Œä¸é™æ€åº“ç›¸æ¯”ï¼Œå‡å°‘äº†appçš„ä½“ç§¯å¤§å° å…±äº«å†…å­˜ï¼ŒèŠ‚çº¦èµ„æºï¼šåŒä¸€ä»½åº“å¯ä»¥è¢«å¤šä¸ªç¨‹åºä½¿ç”¨ é€šè¿‡ æ›´æ–°åŠ¨æ€åº“ï¼Œè¾¾åˆ°æ›´æ–°ç¨‹åº çš„ç›®çš„ï¼šç”±äºè¿è¡Œæ—¶æ‰è½½å…¥çš„ç‰¹æ€§ï¼Œå¯ä»¥éšæ—¶å¯¹åº“è¿›è¡Œæ›¿æ¢ï¼Œè€Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç  ç¼ºç‚¹ï¼šåŠ¨æ€è½½å…¥ä¼šå¸¦æ¥ä¸€éƒ¨åˆ†æ€§èƒ½æŸå¤±ï¼Œä½¿ç”¨åŠ¨æ€åº“ä¹Ÿä¼šä½¿å¾—ç¨‹åºä¾èµ–äºå¤–éƒ¨ç¯å¢ƒï¼Œå¦‚æœç¯å¢ƒç¼ºå°‘äº†åŠ¨æ€åº“ï¼Œæˆ–è€…åº“çš„ç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºæ— æ³•è¿è¡Œ é™æ€åº“å’ŒåŠ¨æ€åº“çš„å›¾ç¤ºå¦‚å›¾æ‰€ç¤º: dyldåŠ è½½æµç¨‹åˆ†ææ ¹æ® dyld æºç ï¼Œä»¥åŠ libobjcã€libSystemã€libdispatch æºç ååŒåˆ†æ ä»€ä¹ˆæ˜¯dyldï¼Ÿ dyldï¼ˆthe dynamic link editorï¼‰æ˜¯è‹¹æœçš„ åŠ¨æ€é“¾æ¥å™¨ï¼Œæ˜¯è‹¹æœæ“ä½œç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨appè¢«ç¼–è¯‘æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼çš„ Mach-O æ–‡ä»¶åï¼Œäº¤ç”± dyldè´Ÿè´£è¿æ¥ï¼ŒåŠ è½½ç¨‹åº æ‰€ä»¥ App çš„å¯åŠ¨æµç¨‹å›¾å¦‚ä¸‹ï¼š appå¯åŠ¨çš„èµ·å§‹ç‚¹ åœ¨å‰æ–‡çš„demoä¸­ï¼Œåœ¨loadæ–¹æ³•å¤„åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œé€šè¿‡btå †æ ˆä¿¡æ¯æŸ¥çœ‹appå¯åŠ¨æ˜¯ä»å“ªé‡Œå¼€å§‹çš„ ã€appå¯åŠ¨èµ·ç‚¹ã€‘ï¼šé€šè¿‡ç¨‹åºè¿è¡Œå‘ç°ï¼Œæ˜¯ä» dyld ä¸­çš„ _dyld_start å¼€å§‹çš„ï¼Œæ‰€ä»¥éœ€è¦å» OpenSource ä¸‹è½½ä¸€ä»½dyldçš„æºç æ¥è¿›è¡Œåˆ†æ ä¹Ÿå¯ä»¥é€šè¿‡xcodeå·¦ä¾§çš„å †æ ˆä¿¡æ¯æ¥æ‰¾åˆ°å…¥å£ dyld::_mainå‡½æ•°æºç åˆ†æ åœ¨ dyld-750.6 æºç ä¸­æŸ¥æ‰¾ _dyld_start,æŸ¥æ‰¾ arm64æ¶æ„ å‘ç°ï¼Œæ˜¯ç”±æ±‡ç¼–å®ç°ï¼Œé€šè¿‡æ±‡ç¼–æ³¨é‡Šå‘ç°ä¼šè°ƒç”¨ dyldbootstrap::start(app_mh, argc, argv, dyld_mh, &amp;startGlue) æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ª C++ æ–¹æ³•ï¼ˆä»¥arm64æ¶æ„ä¸ºä¾‹ï¼‰ æºç ä¸­æœç´¢ dyldbootstrap æ‰¾åˆ°å‘½åä½œç”¨ç©ºé—´ï¼Œå†åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾ start æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ˜¯è¿”å›å€¼çš„è°ƒç”¨äº† dyldçš„main å‡½æ•°ï¼Œå…¶ä¸­ macho_header æ˜¯ Mach-O çš„å¤´éƒ¨ï¼Œè€Œ dyld åŠ è½½çš„æ–‡ä»¶å°±æ˜¯ Mach-O ç±»å‹çš„ï¼Œå³ Mach-O ç±»å‹æ˜¯ å¯æ‰§è¡Œæ–‡ä»¶ç±»å‹ï¼Œç”±å››éƒ¨åˆ†ç»„æˆï¼šMach-Oå¤´éƒ¨ã€Load Commandã€sectionã€Other Dataï¼Œå¯ä»¥é€šè¿‡ MachOView æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶ä¿¡æ¯ è¿›å…¥ dyld::_main çš„æºç å®ç°ï¼Œç‰¹åˆ«é•¿ï¼Œå¤§çº¦600å¤šè¡Œï¼Œå¦‚æœå¯¹dyldåŠ è½½æµç¨‹ä¸å¤ªäº†è§£çš„ç«¥é‹ï¼Œå¯ä»¥æ ¹æ® _main å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œåæ¨ï¼Œè¿™é‡Œå°±å¤šä½œè¯´æ˜ã€‚åœ¨ _main å‡½æ•°ä¸­ä¸»è¦åšäº†ä¸€ä¸‹å‡ ä»¶äº‹æƒ…ï¼š ã€ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå˜é‡é…ç½®ã€‘ï¼šæ ¹æ®ç¯å¢ƒå˜é‡è®¾ç½®ç›¸åº”çš„å€¼ä»¥åŠè·å–å½“å‰è¿è¡Œæ¶æ„ ã€ç¬¬äºŒæ­¥ï¼šå…±äº«ç¼“å­˜ã€‘ï¼šæ£€æŸ¥æ˜¯å¦å¼€å¯äº†å…±äº«ç¼“å­˜ï¼Œä»¥åŠå…±äº«ç¼“å­˜æ˜¯å¦æ˜ å°„åˆ°å…±äº«åŒºåŸŸï¼Œä¾‹å¦‚ UIKitã€CoreFoundation ç­‰ ã€ç¬¬ä¸‰æ­¥ï¼šä¸»ç¨‹åºçš„åˆå§‹åŒ–ã€‘ï¼šè°ƒç”¨ instantiateFromLoadedImage å‡½æ•°å®ä¾‹åŒ–äº†ä¸€ä¸ªImageLoader å¯¹è±¡ ã€ç¬¬å››æ­¥ï¼šæ’å…¥åŠ¨æ€åº“ã€‘ï¼šéå†DYLD_INSERT_LIBRARIESç¯å¢ƒå˜é‡ï¼Œè°ƒç”¨loadInsertedDylibåŠ è½½ ã€ç¬¬äº”æ­¥ï¼šlink ä¸»ç¨‹åºã€‘ ã€ç¬¬å…­æ­¥ï¼šlink åŠ¨æ€åº“ã€‘ ã€ç¬¬ä¸ƒæ­¥ï¼šå¼±ç¬¦å·ç»‘å®šã€‘ ã€ç¬¬å…«æ­¥ï¼šæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ã€‘ ã€ç¬¬ä¹æ­¥ï¼šå¯»æ‰¾ä¸»ç¨‹åºå…¥å£å³mainå‡½æ•°ã€‘ï¼šä»Load Commandè¯»å–LC_MAINå…¥å£ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±è¯»å–LC_UNIXTHREADï¼Œè¿™æ ·å°±æ¥åˆ°äº†æ—¥å¸¸å¼€å‘ä¸­ç†Ÿæ‚‰çš„mainå‡½æ•°äº† ä¸‹é¢ä¸»è¦åˆ†æä¸‹ã€ç¬¬ä¸‰æ­¥ã€‘å’Œã€ç¬¬å…«æ­¥ã€‘ sMainExecutable è¡¨ç¤ºä¸»ç¨‹åºå˜é‡ï¼ŒæŸ¥çœ‹å…¶èµ‹å€¼ï¼Œæ˜¯é€šè¿‡ instantiateFromLoadedImage æ–¹æ³•åˆå§‹åŒ– è¿›å…¥ instantiateFromLoadedImage æºç ï¼Œå…¶ä¸­åˆ›å»º ä¸€ä¸ªImageLoader å®ä¾‹å¯¹è±¡ï¼Œé€šè¿‡instantiateMainExecutable æ–¹æ³•åˆ›å»º è¿›å…¥ instantiateMainExecutable æºç ï¼Œå…¶ä½œç”¨æ˜¯ä¸ºä¸»å¯æ‰§è¡Œæ–‡ä»¶åˆ›å»ºæ˜ åƒï¼Œè¿”å›ä¸€ä¸ªImageLoader ç±»å‹çš„imageå¯¹è±¡ï¼Œå³ä¸»ç¨‹åºã€‚å…¶ä¸­ sniffLoadCommands å‡½æ•°æ—¶è·å– Mach-O ç±»å‹æ–‡ä»¶çš„ Load Command çš„ç›¸å…³ä¿¡æ¯ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå„ç§æ ¡éªŒ ã€ç¬¬å…«æ­¥ï¼šæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•ã€‘ è¿›å…¥ initializeMainExecutable æºç ,ä¸»è¦æ˜¯å¾ªç¯éå†ï¼Œéƒ½ä¼šæ‰§è¡ŒrunInitializersæ–¹æ³• å…¨å±€æœç´¢ runInitializers (cons,æ‰¾åˆ°å¦‚ä¸‹æºç ï¼Œå…¶æ ¸å¿ƒä»£ç æ˜¯processInitializerså‡½æ•°çš„è°ƒç”¨ è¿›å…¥ processInitializers å‡½æ•°çš„æºç å®ç°ï¼Œå…¶ä¸­å¯¹é•œåƒåˆ—è¡¨è°ƒç”¨recursiveInitialization å‡½æ•°è¿›è¡Œé€’å½’å®ä¾‹åŒ– å…¨å±€æœç´¢recursiveInitialization(conså‡½æ•°,å…¶æºç å®ç°å¦‚ä¸‹ åœ¨è¿™é‡Œï¼Œéœ€è¦åˆ†æˆä¸¤éƒ¨åˆ†æ¢ç´¢ï¼Œä¸€éƒ¨åˆ†æ˜¯notifySingleå‡½æ•°ï¼Œä¸€éƒ¨åˆ†æ˜¯doInitializationå‡½æ•°ï¼Œé¦–å…ˆæ¢ç´¢notifySingleå‡½æ•° notifySingle å‡½æ•° å…¨å±€æœç´¢ notifySingle(å‡½æ•°,å…¶é‡ç‚¹æ˜¯(*sNotifyObjCInit)(image-&gt;getRealPath(), image-&gt;machHeader());è¿™å¥ å…¨å±€æœç´¢ sNotifyObjCInitï¼Œå‘ç°æ²¡æœ‰æ‰¾åˆ°å®ç°ï¼Œæœ‰èµ‹å€¼æ“ä½œ æœç´¢ registerObjCNotifiers åœ¨å“ªé‡Œè°ƒç”¨äº†ï¼Œå‘ç°åœ¨ _dyld_objc_notify_register è¿›è¡Œäº†è°ƒç”¨ æ³¨æ„ï¼š_dyld_objc_notify_register çš„å‡½æ•°éœ€è¦åœ¨ libobjc æºç ä¸­æœç´¢ åœ¨ objc4-781 æºç ä¸­æœç´¢ _dyld_objc_notify_registerï¼Œå‘ç°åœ¨ _objc_init æºç ä¸­è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼Œå¹¶ä¼ å…¥äº†å‚æ•°ï¼Œæ‰€ä»¥ sNotifyObjCInit çš„èµ‹å€¼çš„å°±æ˜¯ objc ä¸­çš„load_imagesï¼Œè€Œ load_images ä¼šè°ƒç”¨æ‰€æœ‰çš„ +load æ–¹æ³•ã€‚æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼ŒnotifySingle æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•° loadå‡½æ•°åŠ è½½ä¸‹é¢æˆ‘ä»¬è¿›å…¥ load_images çš„æºç çœ‹çœ‹å…¶å®ç°ï¼Œä»¥æ­¤æ¥è¯æ˜ load_images ä¸­è°ƒç”¨äº†æ‰€æœ‰çš„loadå‡½æ•° é€šè¿‡objcæºç ä¸­_objc_initæºç å®ç°ï¼Œè¿›å…¥load_imagesçš„æºç å®ç° è¿›å…¥ call_load_methods æºç å®ç°ï¼Œå¯ä»¥å‘ç°å…¶æ ¸å¿ƒæ˜¯é€šè¿‡ do-while å¾ªç¯è°ƒç”¨ +load æ–¹æ³• è¿›å…¥ call_class_loads æºç å®ç°ï¼Œäº†è§£åˆ°è¿™é‡Œè°ƒç”¨çš„ load æ–¹æ³•è¯å®æˆ‘ä»¬å‰æ–‡æåŠçš„ç±»çš„loadæ–¹æ³• æ‰€ä»¥ï¼Œload_images è°ƒç”¨äº†æ‰€æœ‰çš„ load å‡½æ•°ï¼Œä»¥ä¸Šçš„æºç åˆ†æè¿‡ç¨‹æ­£å¥½å¯¹åº”å †æ ˆçš„æ‰“å°ä¿¡æ¯ ã€æ€»ç»“ã€‘loadçš„æºç é“¾ä¸ºï¼š_dyld_start -&gt; dyldbootstrap::start -&gt; dyld::_main -&gt; dyld::initializeMainExecutable -&gt; ImageLoader::runInitializers -&gt; ImageLoader::processInitializers -&gt; ImageLoader::recursiveInitialization -&gt; dyld::notifySingle(æ˜¯ä¸€ä¸ªå›è°ƒå¤„ç†) -&gt; sNotifyObjCInit â€“&gt; load_images(libobjc.A.dylib) é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œ_objc_init æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„å‘¢ï¼Ÿè¯·æ¥ç€å¾€ä¸‹çœ‹ doInitialization å‡½æ•° èµ°åˆ° objc çš„ _objc_init å‡½æ•°ï¼Œå‘ç°èµ°ä¸é€šäº†ï¼Œæˆ‘ä»¬å›é€€åˆ° recursiveInitialization é€’å½’å‡½æ•°çš„æºç å®ç°ï¼Œå‘ç°æˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªå‡½æ•° doInitialization è¿›å…¥doInitializationå‡½æ•°çš„æºç å®ç° è¿™é‡Œä¹Ÿéœ€è¦åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯ doImageInit å‡½æ•°ï¼Œä¸€éƒ¨åˆ†æ˜¯ doModInitFunctions å‡½æ•° è¿›å…¥ doImageInit æºç å®ç°ï¼Œå…¶æ ¸å¿ƒä¸»è¦æ˜¯forå¾ªç¯åŠ è½½æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒlibSystemçš„åˆå§‹åŒ–å¿…é¡»å…ˆè¿è¡Œ è¿›å…¥ doModInitFunctions æºç å®ç°ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­åŠ è½½äº†æ‰€æœ‰ Cxx æ–‡ä»¶ èµ°åˆ°è¿™é‡Œï¼Œè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°_objc_initçš„è°ƒç”¨ï¼Ÿæ€ä¹ˆåŠå‘¢ï¼Ÿæ”¾å¼ƒå—ï¼Ÿå½“ç„¶ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡_objc_initåŠ ä¸€ä¸ªç¬¦å·æ–­ç‚¹æ¥æŸ¥çœ‹è°ƒç”¨_objc_initå‰çš„å †æ ˆä¿¡æ¯ï¼Œ _objc_init åŠ ä¸€ä¸ªç¬¦å·æ–­ç‚¹ï¼Œè¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹_objc_initæ–­ä½åçš„å †æ ˆä¿¡æ¯ åœ¨libsystemä¸­æŸ¥æ‰¾libSystem_initializerï¼ŒæŸ¥çœ‹å…¶ä¸­çš„å®ç° æ ¹æ®å‰é¢çš„å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬å‘ç°èµ°çš„æ˜¯ libSystem_initializer ä¸­ä¼šè°ƒç”¨libdispatch_init å‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„æºç æ˜¯åœ¨ libdispatch å¼€æºåº“ä¸­çš„ï¼Œåœ¨libdispatchä¸­æœç´¢libdispatch_init è¿›å…¥ _os_object_init æºç å®ç°ï¼Œå…¶æºç å®ç°è°ƒç”¨äº† _objc_init å‡½æ•° ç»“åˆä¸Šé¢çš„åˆ†æï¼Œä»åˆå§‹åŒ–_objc_initæ³¨å†Œçš„_dyld_objc_notify_registerçš„å‚æ•°2ï¼Œå³load_imagesï¼Œåˆ°sNotifySingle â€“&gt; sNotifyObjCInie&#x3D;å‚æ•°2 åˆ°sNotifyObjcInit()è°ƒç”¨ï¼Œå½¢æˆäº†ä¸€ä¸ªé—­ç¯ æ‰€ä»¥å¯ä»¥ç®€å•çš„ç†è§£ä¸ºsNotifySingleè¿™é‡Œæ˜¯æ·»åŠ é€šçŸ¥å³addObserverï¼Œ_objc_initä¸­è°ƒç”¨_dyld_objc_notify_registerç›¸å½“äºå‘é€é€šçŸ¥ï¼Œå³pushï¼Œè€ŒsNotifyObjcInitç›¸å½“äºé€šçŸ¥çš„å¤„ç†å‡½æ•°ï¼Œå³selector ã€æ€»ç»“ã€‘ï¼š_objc_initçš„æºç é“¾ï¼š_dyld_start â€“&gt; dyldbootstrap::start â€“&gt; dyld::_main â€“&gt; dyld::initializeMainExecutable â€“&gt; ImageLoader::runInitializers â€“&gt; ImageLoader::processInitializers â€“&gt; ImageLoader::recursiveInitialization â€“&gt; doInitialization â€“&gt;libSystem_initializerï¼ˆlibSystem.B.dylibï¼‰ â€“&gt; _os_object_initï¼ˆlibdispatch.dylibï¼‰ â€“&gt; _objc_init(libobjc.A.dylib) ç¬¬ä¹æ­¥ï¼šå¯»æ‰¾ä¸»å…¥å£å‡½æ•° æ±‡ç¼–è°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°æ˜¾ç¤ºæ¥åˆ° +[ViewController load] æ–¹æ³• ç»§ç»­æ‰§è¡Œï¼Œæ¥åˆ° kcFunc çš„ C++ å‡½æ•° ç‚¹å‡»stepover,ç»§ç»­å¾€ä¸‹ï¼Œè·‘å®Œäº†æ•´ä¸ªæµç¨‹ï¼Œä¼šå›åˆ° _dyld_start,ç„¶åè°ƒç”¨main()å‡½æ•°,é€šè¿‡æ±‡ç¼–å®Œæˆmainçš„å‚æ•°èµ‹å€¼ç­‰æ“ä½œ dyldæ±‡ç¼–æºç å®ç° æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œæœ€ç»ˆdyldåŠ è½½æµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›¾ä¸­ä¹Ÿè¯ é‡Šäº†å‰æ–‡ä¸­çš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆæ˜¯loadâ€“&gt;Cxxâ€“&gt;mainçš„è°ƒç”¨é¡ºåº","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†14-3ï¼šobjc_msgSendä¹‹åŠ¨æ€æ–¹æ³•å†³è®® & æ¶ˆæ¯è½¬å‘","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-3ï¼šobjc_msgSendä¹‹åŠ¨æ€æ–¹æ³•å†³è®®&æ¶ˆæ¯è½¬å‘","date":"2020-10-06T02:13:46.000Z","updated":"2023-02-25T19:00:06.038Z","comments":true,"path":"2020/10/06/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-3ï¼šobjc_msgSendä¹‹åŠ¨æ€æ–¹æ³•å†³è®®&æ¶ˆæ¯è½¬å‘/","link":"","permalink":"https://www.bboyzj.cn/2020/10/06/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8614-3%EF%BC%9Aobjc_msgSend%E4%B9%8B%E5%8A%A8%E6%80%81%E6%96%B9%E6%B3%95%E5%86%B3%E8%AE%AE&%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/","excerpt":"","text":"å‰è¨€ åœ¨å‰é¢ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œåˆ†åˆ«åˆ†æäº† objc_msgSend çš„ å¿«é€ŸæŸ¥æ‰¾(ç¼“å­˜) å’Œ æ…¢é€ŸæŸ¥æ‰¾(æ–¹æ³•åˆ—è¡¨)ï¼Œå…¶æ•´ä¸ªæµç¨‹ï¼š objc_msgSend -&gt; æ…¢é€Ÿç¼“å­˜æŸ¥æ‰¾(æ²¡æœ‰) -&gt; æ…¢é€Ÿæ–¹æ³•åˆ—è¡¨äºŒåˆ†æŸ¥æ‰¾è‡ªå·±(æœ‰) -&gt; cache_fill -&gt; objc_msgSend æ•´ä¸ªé—­ç¯ æ…¢é€Ÿæ–¹æ³•åˆ—è¡¨äºŒåˆ†æŸ¥æ‰¾æ²¡æœ‰æ‰¾åˆ° -&gt; çˆ¶ç±»å»æŸ¥æ‰¾ï¼ˆç¼“å­˜ -&gt; æ–¹æ³•åˆ—è¡¨ï¼‰ -&gt; æ ¹ç±»ï¼ˆNSObjectï¼‰ä¹Ÿæ²¡æ‰¾åˆ° åœ¨è¿™ä¸¤ç§æ–¹æ³•éƒ½æ²¡æ‰¾åˆ°æ–¹æ³•å®ç°çš„æƒ…å†µä¸‹ï¼Œè‹¹æœç»™äº†ä¸¤æ¡å»ºè®® åŠ¨æ€æ–¹æ³•å†³è®®ï¼šæ…¢é€ŸæŸ¥æ‰¾æµç¨‹æœªèƒ½æ‰¾åˆ°ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡åŠ¨æ€æ–¹æ³•å†³è®® æ¶ˆæ¯è½¬å‘ï¼šå¦‚æœåŠ¨æ€æ–¹æ³•å†³è®®ä»ç„¶æ²¡æœ‰æ‰¾åˆ°å®ç°ï¼Œåˆ™è¿›è¡Œæ¶ˆæ¯è½¬å‘ å¦‚æœè¿™ä¸¤ä¸ªå»ºè®®éƒ½æ²¡æœ‰ä½œå‡ºä»»ä½•æ“ä½œï¼Œå°±ä¼šæŠ¥æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­å¸¸è§çš„ æ–¹æ³•æœªå®ç° çš„ å´©æºƒæŠ¥é”™ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ å®šä¹‰ ZJPerson ç±»ï¼Œå…¶ä¸­ say666 å®ä¾‹æ–¹æ³• å’Œ sayNB ç±»æ–¹æ³•å‡æ²¡æœ‰å®ç° è°ƒç”¨ç±»æ–¹æ³• sayNB çš„æŠ¥é”™ç»“æœ æ–¹æ³•æœªå®ç°æŠ¥é”™æºç æ ¹æ® æ…¢é€ŸæŸ¥æ‰¾ çš„æºç ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå…¶æŠ¥é”™æœ€åéƒ½æ˜¯èµ°åˆ° __objc_msgForward_impcache æ–¹æ³•ï¼Œæœ¬è´¨æ˜¯è°ƒç”¨çš„ objc_defaultForwardHandler æ–¹æ³• ä¸‹é¢æˆ‘ä»¬æ¥è®²è®²å¦‚ä½•åœ¨å´©æºƒå‰ï¼Œé˜²æ­¢æ–¹æ³•æœªå®ç°çš„å´©æºƒ ä¸‰æ¬¡æ–¹æ³•æŸ¥æ‰¾çš„æŒ½æ•‘æœºä¼šæ ¹æ®è‹¹æœå»ºè®®ï¼Œæˆ‘ä»¬ä¸€å…±æœ‰ä¸‰æ¬¡æŒ½æ•‘çš„æœºä¼šï¼š ã€ç¬¬ä¸€æ¬¡æœºä¼šã€‘ï¼šåŠ¨æ€æ–¹æ³•å†³è®® æ¶ˆæ¯è½¬å‘æµç¨‹ï¼š ã€ç¬¬äºŒæ¬¡æœºä¼šã€‘ï¼šå¿«é€Ÿè½¬å‘ ã€ç¬¬ä¸‰æ¬¡æœºä¼šã€‘ï¼šæ…¢é€Ÿè½¬å‘ ã€ç¬¬ä¸€æ¬¡æœºä¼šã€‘åŠ¨æ€æ–¹æ³•å†³è®®åœ¨ æ…¢é€ŸæŸ¥æ‰¾ æµç¨‹ æœªæ‰¾åˆ° æ–¹æ³•å®ç°æ—¶ï¼Œé¦–å…ˆä¼š å°è¯•ä¸€æ¬¡åŠ¨æ€æ–¹æ³•å†³è®®ï¼Œå…¶æºç å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627static NEVER_INLINE IMPresolveMethod_locked(id inst, SEL sel, Class cls, int behavior)&#123; runtimeLock.assertLocked(); ASSERT(cls-&gt;isRealized()); runtimeLock.unlock(); // å¯¹è±¡ -&gt; ç±» if (! cls-&gt;isMetaClass()) &#123; // ç±»ä¸æ˜¯å…ƒç±»ï¼Œè°ƒç”¨å¯¹è±¡çš„è§£ææ–¹æ³• // try [cls resolveInstanceMethod:sel] resolveInstanceMethod(inst, sel, cls); &#125; else &#123; // å¦‚æœæ˜¯å…ƒç±»ï¼Œè°ƒç”¨ç±»çš„è§£ææ–¹æ³•ï¼Œç±» -&gt; å…ƒç±» // try [nonMetaClass resolveClassMethod:sel] // and [cls resolveInstanceMethod:sel] resolveClassMethod(inst, sel, cls); // ä¸ºä»€ä¹ˆè¦æœ‰è¿™è¡Œä»£ç ï¼Ÿ -&gt; ç±»æ–¹æ³•åœ¨å…ƒç±»ä¸­æ˜¯å¯¹è±¡æ–¹æ³•ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æŸ¥è¯¢å…ƒç±»ä¸­å¯¹è±¡æ–¹æ³•çš„åŠ¨æ€æ–¹æ³•å†³è®® if (!lookUpImpOrNil(inst, sel, cls)) &#123; // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆ–è€…ä¸ºç©ºï¼Œåœ¨å…ƒç±»çš„å¯¹è±¡æ–¹æ³•è§£ææ–¹æ³•ä¸­æŸ¥æ‰¾ resolveInstanceMethod(inst, sel, cls); &#125; &#125; // chances are that calling the resolver have populated the cache // so attempt using it // å¦‚æœæ–¹æ³•è§£æä¸­å¥–å…¶å®ç°æŒ‡å‘å…¶ä»–æ–¹æ³•ï¼Œåˆ™ç»§ç»­èµ°æ–¹æ³•æŸ¥æ‰¾æµç¨‹ return lookUpImpOrForward(inst, sel, cls, behavior | LOOKUP_CACHE);&#125; ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ åˆ¤æ–­ç±»æ˜¯å¦æ˜¯å…ƒç±» å¦‚æœæ˜¯ ç±»ï¼Œæ‰§è¡Œ å®ä¾‹æ–¹æ³• çš„åŠ¨æ€æ–¹æ³•å†³è®® resolveInstanceMethod å¦‚æœæ˜¯ å…ƒç±»ï¼Œæ‰§è¡Œ ç±»æ–¹æ³• çš„åŠ¨æ€æ–¹æ³•å†³è®® resolveClassMethodï¼Œå¦‚æœåœ¨å…ƒç±»ä¸­ æ²¡æœ‰æ‰¾åˆ° æˆ–è€…ä¸º ç©ºï¼Œåˆ™åœ¨ å…ƒç±» çš„ å®ä¾‹æ–¹æ³• çš„åŠ¨æ€æ–¹æ³•å†³è®® resolveInstanceMethod ä¸­æŸ¥æ‰¾ï¼Œä¸»è¦æ˜¯å› ä¸º ç±»æ–¹æ³•åœ¨å…ƒç±»ä¸­æ˜¯å®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥è¿˜éœ€è¦æŸ¥æ‰¾å…ƒç±»ä¸­å®ä¾‹æ–¹æ³•çš„åŠ¨æ€æ–¹æ³•å†³è®® å¦‚æœ åŠ¨æ€æ–¹æ³•å†³è®® ä¸­ï¼Œå°†å…¶ å®ç°æŒ‡å‘äº†å…¶ä»–æ–¹æ³•ï¼Œåˆ™ç»§ç»­ æŸ¥æ‰¾æŒ‡å®šçš„impï¼Œå³ç»§ç»­æ…¢é€ŸæŸ¥æ‰¾ lookupImpOrForward å®ä¾‹æ–¹æ³•é’ˆå¯¹ å®ä¾‹æ–¹æ³• è°ƒç”¨ï¼Œåœ¨ å¿«é€Ÿã€æ…¢é€ŸæŸ¥æ‰¾ å‡æ²¡æœ‰æ‰¾åˆ° å®ä¾‹æ–¹æ³• çš„å®ç°æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸€æ¬¡æŒ½æ•‘çš„æœºä¼šï¼Œå³å°è¯•ä¸€æ¬¡ åŠ¨æ€æ–¹æ³•å†³è®®ï¼Œç”±äºæ˜¯ å®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥ä¼šèµ°åˆ° resolveInstanceMethod æ–¹æ³•ï¼Œå…¶æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637static void resolveInstanceMethod(id inst, SEL sel, Class cls)&#123; runtimeLock.assertUnlocked(); ASSERT(cls-&gt;isRealized()); SEL resolve_sel = @selector(resolveInstanceMethod:); // lookçš„æ˜¯ resolveInstanceMethod ç›¸å½“äºæ˜¯å‘é€æ¶ˆæ¯å‰çš„å®¹é”™å¤„ç† if (!lookUpImpOrNil(cls, resolve_sel, cls-&gt;ISA())) &#123; // Resolver not implemented. return; &#125; BOOL (*msg)(Class, SEL, SEL) = (typeof(msg))objc_msgSend; bool resolved = msg(cls, resolve_sel, sel); // å‘é€resolve_selæ¶ˆæ¯ // Cache the result (good or bad) so the resolver doesn&#x27;t fire next time. // +resolveInstanceMethod adds to self a.k.a. cls // æŸ¥æ‰¾say666 IMP imp = lookUpImpOrNil(inst, sel, cls); if (resolved &amp;&amp; PrintResolving) &#123; if (imp) &#123; _objc_inform(&quot;RESOLVE: method %c[%s %s] &quot; &quot;dynamically resolved to %p&quot;, cls-&gt;isMetaClass() ? &#x27;+&#x27; : &#x27;-&#x27;, cls-&gt;nameForLogging(), sel_getName(sel), imp); &#125; else &#123; // Method resolver didn&#x27;t add anything? _objc_inform(&quot;RESOLVE: +[%s resolveInstanceMethod:%s] returned YES&quot; &quot;, but no new implementation of %c[%s %s] was found&quot;, cls-&gt;nameForLogging(), sel_getName(sel), cls-&gt;isMetaClass() ? &#x27;+&#x27; : &#x27;-&#x27;, cls-&gt;nameForLogging(), sel_getName(sel)); &#125; &#125;&#125; ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ åœ¨ å‘é€resolveInstanceMethodæ¶ˆæ¯ å‰ï¼Œéœ€è¦æŸ¥æ‰¾ clsç±» ä¸­æ˜¯å¦æœ‰è¯¥æ–¹æ³•çš„ å®ç°ï¼Œå³é€šè¿‡ lookupImpOrNil æ–¹æ³•åˆä¼šè¿›å…¥ lookupImpOrForward æ…¢é€ŸæŸ¥æ‰¾æµç¨‹æŸ¥æ‰¾ resolveInstanceMethod æ–¹æ³• å¦‚æœæ²¡æœ‰ï¼Œåˆ™ç›´æ¥è¿”å› å¦‚æœæœ‰ï¼Œåˆ™å‘é€ resolveInstanceMethod æ¶ˆæ¯ å†æ¬¡æ…¢é€ŸæŸ¥æ‰¾å®ä¾‹æ–¹æ³•çš„å®ç°ï¼Œå³é€šè¿‡ lookupImpOrNil æ–¹æ³•åˆä¼šè¿›å…¥ lookupImpOrForward æ…¢é€ŸæŸ¥æ‰¾æµç¨‹æŸ¥æ‰¾ å®ä¾‹æ–¹æ³• å´©æºƒä¿®æ”¹ æ‰€ä»¥ï¼Œé’ˆå¯¹ å®ä¾‹æ–¹æ³•sya666 æœªå®ç°çš„æŠ¥é”™å´©æºƒï¼Œå¯ä»¥é€šè¿‡åœ¨ ç±» ä¸­ é‡å†™resolveInstanceMethodç±»æ–¹æ³•ï¼Œå¹¶å°†å…¶æŒ‡å‘å…¶ä»–æ–¹æ³•çš„å®ç°ï¼Œå³åœ¨ ZJPerson ä¸­ é‡å†™resolveInstanceMethodç±»æ–¹æ³•ï¼Œå°† å®ä¾‹æ–¹æ³•sya666 çš„å®ç°æŒ‡å‘ sayMaster æ–¹æ³•å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤º 1234567891011121314151617181920212223242526@interface ZJPerson : NSObject- (void)say666;- (void)sayMaster;@end@implementation ZJPerson- (void)sayMaster&#123; NSLog(@&quot;say666&quot;);&#125;// é‡å†™resolveInstanceMethod+ (BOOL)resolveInstanceMethod:(SEL)sel&#123; if (sel == @selector(say666)) &#123; NSLog(@&quot;%@ æ¥äº†&quot;,NSStringFromSelector(sel)); // è·å–sayMasteræ–¹æ³•çš„imp IMP imp = class_getMethodImplementation(self, @selector(sayMaster)); // è·å–sayMasterçš„å®ä¾‹æ–¹æ³• Method sayMethod = class_getInstanceMethod(self, @selector(sayMaster)); // è·å–sayMasterçš„ä¸°å¯Œç­¾å const char * type = method_getTypeEncoding(sayMethod); // å°†selçš„å®ç°æŒ‡å‘sayMaster return class_addMethod(self, sel, imp, type); &#125; return [super resolveInstanceMethod:sel];&#125;@end é‡æ–°è¿è¡Œï¼Œå…¶æ‰“å°ç»“æœå¦‚ä¸‹ï¼š ç±»æ–¹æ³•é’ˆå¯¹ ç±»æ–¹æ³•ï¼Œä¸å®ä¾‹æ–¹æ³•ç±»ä¼¼ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡é‡å†™ resolveClassMethod ç±»æ–¹æ³•æ¥è§£å†³å‰æ–‡çš„å´©æºƒé—®é¢˜ï¼Œå³åœ¨ ZJPerson ç±»ä¸­é‡å†™è¯¥æ–¹æ³•ï¼Œå¹¶å°† sayNB ç±»æ–¹æ³•çš„å®ç° æŒ‡å‘ç±»æ–¹æ³•zjClassMethod 123456789101112131415161718192021@interface ZJPerson : NSObject+ (void)sayNB;+ (void)zjClassMethod;@end@implementation ZJPerson+ (void)zjClassMethod&#123; NSLog(@&quot;sayNB&quot;);&#125;+ (BOOL)resolveClassMethod:(SEL)sel&#123; if (sel == @selector(sayNB)) &#123; NSLog(@&quot;%@ æ¥äº†&quot;,NSStringFromSelector(sel)); IMP imp = class_getMethodImplementation(objc_getMetaClass(&quot;ZJPerson&quot;), @selector(zjClassMethod)); Method zjClassMethod = class_getInstanceMethod(objc_getMetaClass(&quot;ZJPerson&quot;), @selector(zjClassMethod)); const char * type = method_getTypeEncoding(zjClassMethod); return class_addMethod(objc_getMetaClass(&quot;ZJPerson&quot;), sel, imp, type); &#125; return [super resolveClassMethod:sel];&#125;@end resolveClassMethod ç±»æ–¹æ³•çš„é‡å†™éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä¼ å…¥çš„ cls ä¸å†æ˜¯ç±»ï¼Œè€Œæ˜¯ å…ƒç±»ï¼Œå¯ä»¥é€šè¿‡ objc_getMetaClass æ–¹æ³• è·å–å…ƒç±»ï¼ŒåŸå› æ˜¯å› ä¸º ç±»æ–¹æ³•åœ¨å…ƒç±»ä¸­æ˜¯å®ä¾‹æ–¹æ³• ä¼˜åŒ– ä¸Šé¢çš„è¿™ç§æ–¹å¼æ˜¯å•ç‹¬å†æ¯ä¸ªç±»ä¸­é‡å†™ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„ï¼Œä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•å‘¢ï¼Ÿå…¶å®é€šè¿‡æ–¹æ³•æ…¢é€ŸæŸ¥æ‰¾æµç¨‹å¯ä»¥å‘ç°å…¶æŸ¥æ‰¾è·¯å¾„æœ‰ä¸¤æ¡ å®ä¾‹æ–¹æ³•ï¼šç±» -&gt; çˆ¶ç±» -&gt; æ ¹ç±» -&gt; nil ç±»æ–¹æ³•ï¼šå…ƒç±» -&gt; æ ¹å…ƒç±» -&gt; æ ¹ç±» -&gt; nil å®ƒä»¬çš„å…±åŒç‚¹æ˜¯å¦‚æœå‰é¢æ²¡æ‰¾åˆ°ï¼Œéƒ½ä¼šæ¥åˆ° æ ¹ç±»å³NSObjectä¸­æŸ¥æ‰¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†ä¸Šè¿°çš„ä¸¤ä¸ªæ–¹æ³•ç»Ÿä¸€æ•´åˆåœ¨ä¸€èµ·å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ å¯ä»¥çš„ï¼Œå¯ä»¥é€šè¿‡ NSObjectæ·»åŠ åˆ†ç±» çš„æ–¹å¼æ¥ å®ç°åŒæ„å¤„ç†ï¼Œè€Œä¸”ç”±äºç±»æ–¹æ³•çš„æŸ¥æ‰¾ï¼Œåœ¨å…¶é›†æˆé“¾ï¼ŒæŸ¥æ‰¾çš„ä¹Ÿæ˜¯å®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥å°† å®ä¾‹æ–¹æ³• å’Œ ç±»æ–¹æ³• çš„ç»Ÿä¸€å¤„ç†æ”¾åœ¨ resolveInstanceMethod æ–¹æ³•ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920212223@interface NSObject (ZJ)@end@implementation NSObject (ZJ)+ (BOOL)resolveInstanceMethod:(SEL)sel&#123; if (sel == @selector(say666)) &#123; NSLog(@&quot;%@ æ¥äº†&quot;,NSStringFromSelector(sel)); IMP imp = class_getMethodImplementation(self, @selector(sayMaster)); Method sayMethod = class_getInstanceMethod(self, @selector(sayMaster)); const char *type = method_getTypeEncoding(sayMethod); return class_addMethod(self, sel, imp, type); &#125;else if (sel == @selector(sayNB))&#123; NSLog(@&quot;%@ æ¥äº†&quot;,NSStringFromSelector(sel)); IMP imp = class_getMethodImplementation(objc_getMetaClass(&quot;ZJPerson&quot;), @selector(zjClassMethod)); Method zjClassMethod = class_getInstanceMethod(objc_getMetaClass(&quot;ZJPerson&quot;), @selector(zjClassMethod)); const char * type = method_getTypeEncoding(zjClassMethod); return class_addMethod(objc_getMetaClass(&quot;ZJPerson&quot;), sel, imp, type); &#125; return NO;&#125;@end è¿™æ ·æ–¹å¼çš„å®ç°ï¼Œæ­£å¥½ä¸æºç ä¸­é’ˆå¯¹ç±»æ–¹æ³•çš„å¤„ç†é€»è¾‘æ˜¯ä¸€è‡´çš„ï¼Œå³å®Œç¾é˜è¿°ä¸ºä»€ä¹ˆè°ƒç”¨äº†ç±»æ–¹æ³•åŠ¨æ€æ–¹æ³•å†³è®®ï¼Œè¿˜è¦è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠ¨æ€æ–¹æ³•å†³è®®ï¼Œå…¶æ ¹æœ¬åŸå› è¿˜æ˜¯ ç±»æ–¹æ³•åœ¨å…ƒç±»ä¸­çš„å®ä¾‹æ–¹æ³• å½“ç„¶ï¼Œä¸Šé¢è¿™ç§å†™æ³•è¿˜æ˜¯ä¼šæœ‰å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚ ç³»ç»Ÿæ–¹æ³•ä¹Ÿä¼šè¢«æ›´æ”¹ï¼Œé’ˆå¯¹è¿™ä¸€ç‚¹ï¼Œæ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œå³æˆ‘ä»¬ å¯ä»¥é’ˆå¯¹è‡ªå®šä¹‰ç±»ä¸­æ–¹æ³•åŒæ„æ–¹æ³•åçš„å‰ç¼€ï¼Œæ ¹æ®å‰ç¼€æ¥åˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå®šä¹‰æ–¹æ³•ï¼Œç„¶å ç»Ÿä¸€å¤„ç†è‡ªå®šä¹‰æ–¹æ³•ï¼Œä¾‹å¦‚å¯ä»¥åœ¨å´©æºƒå‰popåˆ°é¦–é¡µï¼Œä¸»è¦æ˜¯ç”¨äº appçº¿ä¸Šé˜²å´©æºƒçš„å¤„ç†ï¼Œæå‡ç”¨æˆ·çš„ä½“éªŒ æ¶ˆæ¯è½¬å‘æµç¨‹åœ¨æ…¢é€ŸæŸ¥æ‰¾çš„æµç¨‹ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼Œå¦‚æœå¿«é€Ÿ+æ…¢é€Ÿæ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°ï¼ŒåŠ¨æ€æ–¹æ³•å†³è®®ä¹Ÿä¸è¡Œï¼Œå°±ä½¿ç”¨ æ¶ˆæ¯è½¬å‘ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æ‰¾éäº†æºç ä¹Ÿæ²¡æœ‰å‘ç°æ¶ˆæ¯è½¬å‘çš„ç›¸å…³æºç ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥äº†è§£ï¼Œæ–¹æ³•è°ƒç”¨å´©æºƒå‰éƒ½èµ°äº†å“ªäº›æ–¹æ³• é€šè¿‡ instrumentObjcMessageSends æ–¹å¼æ‰“å°å‘å°æ¶ˆæ¯çš„æ—¥å¿— é€šè¿‡ hopper/IDAåç¼–è¯‘ é€šè¿‡ instrumentObjcMessageSends é€šè¿‡ lookUpImpOrForward -&gt; log_and_fill_cache -&gt; logMessageSendï¼Œåœ¨logMessageSendæºç ä¸‹æ–¹æ‰¾åˆ° instrumentObjcMessageSends çš„æºç å®ç°ï¼Œåœ¨mainä¸­è°ƒç”¨ instrumentObjcMessageSends æ‰“å°æ–¹æ³•è°ƒç”¨çš„æ—¥å¿—ä¿¡æ¯ï¼Œæœ‰ä»¥ä¸‹ä¸¤ç‚¹å‡†å¤‡å·¥ä½œ æ‰“å¼€ objcMsgLogEnabled å¼€å…³ï¼Œå³è°ƒç”¨ instrumentObjcMessageSends æ–¹æ³•æ—¶ï¼Œä¼ å…¥ YES åœ¨ main ä¸­é€šè¿‡ extern å£°æ˜ instrumentObjcMessageSends æ–¹æ³• 123456789101112131415extern void instrumentObjcMessageSends(BOOL flag);int main(int argc, char * argv[]) &#123; NSString * appDelegateClassName; @autoreleasepool &#123; ZJPerson * person = [ZJPerson alloc]; instrumentObjcMessageSends(YES); [person sayHello]; instrumentObjcMessageSends(NO); appDelegateClassName = NSStringFromClass([AppDelegate class]); &#125; return UIApplicationMain(argc, argv, nil, appDelegateClassName);&#125; é€šè¿‡ logMessageSend æºç ï¼Œäº†è§£åˆ°æ¶ˆæ¯å‘é€æ‰“å°ä¿¡æ¯å­˜å‚¨åœ¨ /tmp/msgSends ç›®å½•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š è¿è¡Œä»£ç ï¼Œå¹¶å‰å¾€ /tmp/msgSends/ ç›®å½•ï¼Œå‘ç°æœ‰ msgSends å¼€å¤´çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ‰“å¼€å‘ç°å´©æºƒå‰ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹æ–¹æ³•ï¼š ä¸¤æ¬¡ åŠ¨æ€æ–¹æ³•å†³è®®ï¼šresolveInstanceMethod æ–¹æ³• ä¸¤æ¬¡ æ¶ˆæ¯å¿«é€Ÿè½¬å‘ï¼šforwardingTargetForSelector æ–¹æ³• ä¸¤æ¬¡ æ¶ˆæ¯æ…¢é€Ÿè½¬å‘ï¼šmethodSignatureForSelector + resolveInvocation é€šè¿‡hopper&#x2F;IDAåç¼–è¯‘Hopper å’Œ IDA æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æˆ‘ä»¬é™æ€åˆ†æå¯è§†æ€§æ–‡ä»¶çš„å·¥å…·ï¼Œå¯ä»¥å°†æ‰§è¡Œæ–‡ä»¶åç¼–è¯‘æˆä¼ªä»£ç ã€æ§åˆ¶æµç¨‹å›¾ç­‰ï¼Œä¸‹é¢ä»¥Hopperä¸ºä¾‹ï¼ˆæ³¨ï¼šhopperé«˜çº§ç‰ˆæœ¬æ˜¯ä¸€æ¬¾æ”¶è´¹è½¯ä»¶ï¼Œé’ˆå¯¹æ¯”è¾ƒç®€å•çš„åæ±‡ç¼–éœ€æ±‚æ¥è¯´ï¼Œdemoç‰ˆæœ¬è¶³å¤Ÿä½¿ç”¨äº†ï¼‰ è¿è¡Œç¨‹åºå´©æºƒï¼ŒæŸ¥çœ‹å †æ ˆä¿¡æ¯ å‘ç° __forwarding__ æ¥è‡ª CoreFoundation é€šè¿‡ image listï¼Œè¯»å–æ•´ä¸ªé•œåƒæ–‡ä»¶ï¼Œç„¶åæœç´¢ CoreFoundationï¼ŒæŸ¥çœ‹å…¶å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ é€šè¿‡æ–‡ä»¶è·¯å¾„ï¼Œæ‰¾åˆ° CoreFoundation çš„ å¯æ‰§è¡Œæ–‡ä»¶ æ‰“å¼€hopperï¼Œé€‰æ‹©Try the Demoï¼Œç„¶åå°†ä¸Šä¸€æ­¥çš„å¯æ‰§è¡Œæ–‡ä»¶æ‹–å…¥hopperè¿›è¡Œåæ±‡ç¼–ï¼Œé€‰æ‹©x86(64 bits) ä»¥ä¸‹æ˜¯åæ±‡ç¼–åçš„ç•Œé¢ï¼Œä¸»è¦ä½¿ç”¨ä¸Šé¢çš„ä¸‰ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯ æ±‡ç¼–ã€æµç¨‹å›¾ã€ä¼ªä»£ç  é€šè¿‡å·¦ä¾§çš„æœç´¢æ¡†æœç´¢__forwarding_prep_0___ï¼Œç„¶åé€‰æ‹©ä¼ªä»£ç  ä»¥ä¸‹æ˜¯__forwarding_prep_0___çš„æ±‡ç¼–ä¼ªä»£ç ï¼Œè·³è½¬è‡³___forwarding___ ä»¥ä¸‹æ˜¯___forwarding___çš„ä¼ªä»£ç å®ç°ï¼Œé¦–å…ˆæ˜¯æŸ¥çœ‹æ˜¯å¦å®ç°forwardingTargetForSelectoræ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å“åº”ï¼Œè·³è½¬è‡³loc_6459bå³å¿«é€Ÿè½¬å‘æ²¡æœ‰å“åº”ï¼Œè¿›å…¥æ…¢é€Ÿè½¬å‘æµç¨‹ è·³è½¬è‡³loc_6459bï¼Œåœ¨å…¶ä¸‹æ–¹åˆ¤æ–­æ˜¯å¦å“åº”methodSignatureForSelectoræ–¹æ³• å¦‚æœæ²¡æœ‰å“åº”ï¼Œè·³è½¬è‡³loc_6490bï¼Œåˆ™ç›´æ¥æŠ¥é”™ å¦‚æœè·å–methodSignatureForSelectorçš„æ–¹æ³•ç­¾åä¸ºnilï¼Œä¹Ÿæ˜¯ç›´æ¥æŠ¥é”™ å¦‚æœmethodSignatureForSelectorè¿”å›å€¼ä¸ä¸ºç©ºï¼Œåˆ™åœ¨forwardInvocationæ–¹æ³•ä¸­å¯¹invocationè¿›è¡Œå¤„ç† æ‰€ä»¥ï¼Œé€šè¿‡ä¸Šé¢ä¸¤ç§æŸ¥æ‰¾æ–¹å¼å¯ä»¥éªŒè¯ï¼Œæ¶ˆæ¯è½¬å‘ çš„æ–¹æ³•æœ‰3ä¸ª ã€å¿«é€Ÿè½¬å‘ã€‘forwardingTargetForSelector ã€æ…¢é€Ÿè½¬å‘ã€‘ methodSignatureForSelector forwardInvocation æ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œæ¶ˆæ¯è½¬å‘æ•´ä½“çš„æµç¨‹å¦‚ä¸‹ æ¶ˆæ¯è½¬å‘ çš„å¤„ç†ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š ã€å¿«é€Ÿè½¬å‘ã€‘å½“æ…¢é€ŸæŸ¥æ‰¾ä»¥åŠåŠ¨æ€æ–¹æ³•å†³è®®æ²¡æœ‰æ‰¾åˆ°å®ç°æ—¶ï¼Œè¿›è¡Œæ¶ˆæ¯è½¬å‘ï¼Œé¦–å…ˆæ˜¯è¿›è¡Œ å¿«é€Ÿæ¶ˆæ¯è½¬å‘ï¼Œå³èµ°åˆ° forwardingTargetForSelector æ–¹æ³• å¦‚æœè¿”å› æ¶ˆæ¯æ¥æ”¶è€…ï¼Œåœ¨æ¶ˆæ¯æ¥æ”¶è€…ä¸­è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›å…¥å¦ä¸€ä¸ªæ–¹æ³•çš„æŸ¥æ‰¾æµç¨‹ å¦‚æœè¿”å› nilï¼Œåˆ™è¿›å…¥ æ…¢é€Ÿæ¶ˆæ¯è½¬å‘ ã€æ…¢é€Ÿè½¬å‘ã€‘æ‰§è¡Œåˆ° methodSignalForSelector æ–¹æ³• å¦‚æœè¿”å›çš„ æ–¹æ³•ç­¾å ä¸º nilï¼Œåˆ™ç›´æ¥ å´©æºƒæŠ¥é”™ å¦‚æœè¿”å›çš„æ–¹æ³•ç­¾å ä¸ä¸ºnilï¼Œèµ°åˆ° forwardInvocation æ–¹æ³•ä¸­ï¼Œå¯¹invocationäº‹åŠ¡è¿›è¡Œå¤„ç†ï¼Œå¦‚æœä¸å¤„ç†ä¹Ÿä¸ä¼šæŠ¥é”™ ã€ç¬¬äºŒæ¬¡æœºä¼šã€‘å¿«é€Ÿè½¬å‘é’ˆå¯¹å‰æ–‡çš„å´©æºƒé—®é¢˜ï¼Œå¦‚æœ åŠ¨æ€æ–¹æ³•å†³è®® ä¹Ÿæ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°ï¼Œåˆ™éœ€è¦åœ¨ ZJPerson ä¸­é‡å†™ forwardingTargetForSelector æ–¹æ³•ï¼Œå°†ZJPersonçš„å®ä¾‹æ–¹æ³•çš„ æ¥æ”¶è€…æŒ‡å®šä¸ºZJStudent çš„å¯¹è±¡ï¼ˆZJStudentç±»ä¸­æœ‰say666çš„å…·ä½“å®ç°ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤º 12345678910111213141516171819202122232425262728293031// ZJPersonç±»@interface ZJPerson : NSObject- (void)say666;@end@implementation ZJPerson- (id)forwardingTargetForSelector:(SEL)aSelector&#123; NSLog(@&quot;%s - %@&quot;,__func__,NSStringFromSelector(aSelector)); // å°†æ¶ˆæ¯æ¥æ”¶è€…æŒ‡å®šä¸ºZJStudentï¼Œåœ¨ZJStudentä¸­æŸ¥æ‰¾say666çš„å®ç° return [ZJStudent alloc];&#125;@end// ZJStudentç±»@interface ZJStudent : NSObject@end@implementation ZJStudent- (void)say666&#123; NSLog(@&quot;say666&quot;);&#125;@end// mainä¸­int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; ZJPerson * person = [ZJPerson new]; [person say666]; &#125; return 0;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ ä¹Ÿå¯ä»¥ç›´æ¥ä¸æŒ‡å®šæ¶ˆæ¯æ¥æ”¶è€…ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±»çš„è¯¥æ–¹æ³•ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ ç›´æ¥æŠ¥é”™ ã€ç¬¬ä¸‰æ¬¡æœºä¼šã€‘æ…¢é€Ÿè½¬å‘é’ˆå¯¹ ç¬¬äºŒæ¬¡æœºä¼šå³å¿«é€Ÿè½¬å‘ ä¸­è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›å…¥æœ€åçš„ä¸€æ¬¡æŒ½æ•‘æœºä¼šï¼Œå³åœ¨ ZJPerson ä¸­é‡å†™ methodSignalForSelectorï¼Œå¦‚ä¸‹æ‰€ç¤º 123456789// æ…¢é€Ÿè½¬å‘- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector&#123; NSLog(@&quot;%s - %@&quot;,__func__,NSStringFromSelector(aSelector)); return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];&#125;- (void)forwardInvocation:(NSInvocation *)anInvocation&#123; NSLog(@&quot;%s - %@&quot;,__func__,anInvocation);&#125; æ‰“å°ç»“æœå¦‚ä¸‹ï¼Œå‘ç° forwardInvocation æ–¹æ³•ä¸­ä¸å¯¹ invocation è¿›è¡Œå¤„ç†ï¼Œä¹Ÿä¸ä¼šå´©æºƒ ä¹Ÿå¯ä»¥ å¤„ç†invocation äº‹åŠ¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä¿®æ”¹ invocation çš„ target ä¸º [ZJStudent alloc]ï¼Œè°ƒç”¨ [anInvocation invoke] è§¦å‘ å³ZJPerson ç±»çš„ say666 å®ä¾‹æ–¹æ³•çš„è°ƒç”¨ä¼šè°ƒç”¨ ZJStudent çš„ say666 æ–¹æ³• 12345- (void)forwardInvocation:(NSInvocation *)anInvocation&#123; NSLog(@&quot;%s - %@&quot;,__func__,anInvocation); anInvocation.target = [ZJStudent alloc]; [anInvocation invoke];&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ https://user-images.githubusercontent.com/25925248/160738899-270d3fb2-e047-4f64-a962-23b5278f8ddd.jpg æ‰€ä»¥ï¼Œç”±ä¸Šè¿°å¯çŸ¥ï¼Œæ— è®ºåœ¨ forwardInvocation æ–¹æ³•ä¸­ æ˜¯å¦å¤„ç†invocation äº‹åŠ¡ï¼Œç¨‹åºéƒ½ä¸ä¼šå´©æºƒ æ€»ç»“åˆ°ç›®å‰ä¸ºæ­¢ï¼Œobjc_msgSend å‘é€æ¶ˆæ¯çš„æµç¨‹å°±åˆ†æå®Œæˆäº†ï¼Œåœ¨è¿™é‡Œç®€å•æ€»ç»“ä¸‹ ã€å¿«é€ŸæŸ¥æ‰¾æµç¨‹ã€‘åœ¨ç±»çš„ ç¼“å­˜cache ä¸­æŸ¥æ‰¾æŒ‡å®šæ–¹æ³•çš„å®ç° ã€æ…¢é€ŸæŸ¥æ‰¾æµç¨‹ã€‘å¦‚æœç¼“å­˜ä¸­ æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åœ¨ ç±»çš„æ–¹æ³•åˆ—è¡¨ ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å» çˆ¶ç±»çš„ç¼“å­˜å’Œæ–¹æ³•åˆ—è¡¨ä¸­ æŸ¥æ‰¾ ã€åŠ¨æ€æ–¹æ³•å†³è®®ã€‘å¦‚æœæ…¢é€ŸæŸ¥æ‰¾ è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œç¬¬ä¸€æ¬¡æŒ½æ•‘çš„æœºä¼šå°±æ˜¯ å°è¯•ä¸€æ¬¡åŠ¨æ€æ–¹æ³•å†³è®®ï¼Œå³ é‡å†™resolveInstanceMethod/resolveClassMethod æ–¹æ³• ã€æ¶ˆæ¯è½¬å‘ã€‘å¦‚æœåŠ¨æ€æ–¹æ³•å†³è®®è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œ æ¶ˆæ¯è½¬å‘ï¼Œæ¶ˆæ¯è½¬å‘ä¸­æœ‰ ä¸¤æ¬¡æŒ½æ•‘å‡ ä¼šï¼šå¿«é€Ÿè½¬å‘+æ…¢é€Ÿè½¬å‘ å¦‚æœè½¬å‘ä¹‹åä¹Ÿæ²¡æœ‰ï¼Œåˆ™ç¨‹åºç›´æ¥æŠ¥é”™å´©æºƒ unrecognized selector sent to instance","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†14-2ï¼šobjc_msgSendæ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾(å¿«é€ŸæŸ¥æ‰¾)æ±‡ç¼–åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-2ï¼šobjc_msgSendæ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾(æ…¢é€ŸæŸ¥æ‰¾)æ±‡ç¼–åˆ†æ","date":"2020-10-05T02:12:37.000Z","updated":"2023-02-25T18:21:38.843Z","comments":true,"path":"2020/10/05/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†14-2ï¼šobjc_msgSendæ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾(æ…¢é€ŸæŸ¥æ‰¾)æ±‡ç¼–åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/10/05/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8614-2%EF%BC%9Aobjc_msgSend%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%E6%9F%A5%E6%89%BE(%E6%85%A2%E9%80%9F%E6%9F%A5%E6%89%BE)%E6%B1%87%E7%BC%96%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€ä¸Šä¸€ç« æˆ‘ä»¬äº†è§£äº† objc_msgSendæ¶ˆæ¯å‘é€æ…¢é€ŸæŸ¥æ‰¾æµç¨‹ å³ ç¼“å­˜CacheLookupæŸ¥æ‰¾ è¿™ä¸€ç« æˆ‘ä»¬æ¥å­¦ä¹  objc_msgSendæ¶ˆæ¯å‘é€æ…¢é€ŸæŸ¥æ‰¾æµç¨‹ å³ MethodTableLookup(å³æŸ¥è¯¢æ–¹æ³•åˆ—è¡¨) æ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾æ±‡ç¼–åˆ†æåœ¨ ç¼“å­˜CacheLookupæŸ¥æ‰¾ è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°ï¼Œæ— è®ºæ˜¯èµ°åˆ° CheckMiss è¿˜æ˜¯ JumpMissï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ° __objc_msgSend_uncached æ±‡ç¼–å‡½æ•° åœ¨ objc-msg-ram64.s æ–‡ä»¶ä¸­æŸ¥æ‰¾ __objc_msgSend_uncached çš„æ±‡ç¼–å®ç°ï¼Œå…¶ä¸­çš„æ ¸å¿ƒæ˜¯ MethodTableLookup(å³æŸ¥è¯¢æ–¹æ³•åˆ—è¡¨) ï¼Œå…¶æºç å¦‚ä¸‹ï¼š __objc_msgSend_uncachedæºç  1234567891011STATIC_ENTRY __objc_msgSend_uncachedUNWIND __objc_msgSend_uncached, FrameWithNoSaves// THIS IS NOT A CALLABLE C FUNCTION// Out-of-band p16 is the class to search// å¼€å§‹æŸ¥è¯¢æ–¹æ³•åˆ—è¡¨MethodTableLookup TailCallFunctionPointer x17END_ENTRY __objc_msgSend_uncached æœç´¢ MethodTableLookup çš„æ±‡ç¼–å®ç°ï¼Œå…¶ä¸­çš„æ ¸å¿ƒæ˜¯ _lookUpImpOrForwardï¼Œæ±‡ç¼–æºç å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344.macro MethodTableLookup // push frame SignLR stp fp, lr, [sp, #-16]! mov fp, sp // save parameter registers: x0..x8, q0..q7 sub sp, sp, #(10*8 + 8*16) stp q0, q1, [sp, #(0*16)] stp q2, q3, [sp, #(2*16)] stp q4, q5, [sp, #(4*16)] stp q6, q7, [sp, #(6*16)] stp x0, x1, [sp, #(8*16+0*8)] stp x2, x3, [sp, #(8*16+2*8)] stp x4, x5, [sp, #(8*16+4*8)] stp x6, x7, [sp, #(8*16+6*8)] str x8, [sp, #(8*16+8*8)] // lookUpImpOrForward(obj, sel, cls, LOOKUP_INITIALIZE | LOOKUP_RESOLVER) // receiver and selector already in x0 and x1 mov x2, x16 mov x3, #3 bl _lookUpImpOrForward // æ ¸å¿ƒæºç  // IMP in x0 mov x17, x0 // restore registers and return ldp q0, q1, [sp, #(0*16)] ldp q2, q3, [sp, #(2*16)] ldp q4, q5, [sp, #(4*16)] ldp q6, q7, [sp, #(6*16)] ldp x0, x1, [sp, #(8*16+0*8)] ldp x2, x3, [sp, #(8*16+2*8)] ldp x4, x5, [sp, #(8*16+4*8)] ldp x6, x7, [sp, #(8*16+6*8)] ldr x8, [sp, #(8*16+8*8)] mov sp, fp ldp fp, lr, [sp], #16 AuthenticateLR.endmacro ç”±æ±‡ç¼–æºç å¯çŸ¥ï¼Œæœ€ç»ˆè·³è½¬åˆ° bl _lookUpImpOrForward ä¸­ éªŒè¯ ä¸Šè¿°æ±‡ç¼–çš„è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡ æ±‡ç¼–è°ƒå¼æ¥éªŒè¯ åœ¨ main ä¸­ï¼Œä¾‹å¦‚ [person sayNB] å¯¹è±¡æ–¹æ³•è°ƒç”¨å¤„åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œå¹¶ä¸”å¼€å¯æ±‡ç¼–è°ƒè¯• Debug -&gt; Debug workflow -&gt; å‹¾é€‰ Always show Disassemblyï¼Œè¿è¡Œç¨‹åº æ±‡ç¼–ä¸­ objc_msgSend åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œæ‰§è¡Œæ–­ä½ï¼ŒæŒ‰ä½ control + stepintoï¼Œè¿›å…¥ objc_msgSend çš„æ±‡ç¼– åœ¨ _objc_msgSend_uncached åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œæ‰§è¡Œæ–­ä½ï¼ŒæŒ‰ä½ control + stepintoï¼Œè¿›å…¥æ±‡ç¼– ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºæœ€åèµ°åˆ°çš„å°±æ˜¯ lookUpImpOrForward ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯æ±‡ç¼–å®ç° 123æ³¨ï¼š1ã€C/C++ä¸­è°ƒç”¨æ±‡ç¼–ï¼Œå»æŸ¥æ‰¾æ±‡ç¼–æ—¶ï¼ŒC/C++è°ƒç”¨çš„æ–¹æ³•éœ€è¦ `å¤šåŠ ä¸€ä¸ªä¸‹åˆ’çº¿`2ã€æ±‡ç¼–ä¸­è°ƒç”¨C/C++æ–¹æ³•æ—¶ï¼Œå»æŸ¥æ‰¾C/C++æ–¹æ³•ï¼Œéœ€è¦å°†æ±‡ç¼–è°ƒç”¨çš„ `æ–¹æ³•å»æ‰ä¸€ä¸ªä¸‹åˆ’çº¿` MethodTableLookup(å³æŸ¥è¯¢æ–¹æ³•åˆ—è¡¨)æ…¢é€ŸæŸ¥æ‰¾ C&#x2F;C++ éƒ¨åˆ† æ ¹æ®æ±‡ç¼–éƒ¨åˆ†çš„æç¤ºå…¨å±€æœç´¢ lookUpImpOrForwardï¼Œæœ€ååœ¨ objc-runtime-new.mm æ–‡ä»¶ä¸­æ‰¾åˆ°äº†æºç å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ª cå®ç°çš„å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192IMP lookUpImpOrForward(id inst, SEL sel, Class cls, int behavior)&#123; // å®šä¹‰çš„æ¶ˆæ¯è½¬å‘ const IMP forward_imp = (IMP)_objc_msgForward_impcache; IMP imp = nil; Class curClass; runtimeLock.assertUnlocked(); /* å¿«é€ŸæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™ç›´æ¥è¿”å›imp ç›®çš„ï¼šé˜²æ­¢å¤šçº¿ç¨‹æ“ä½œæ—¶ï¼Œåˆšå¥½è°ƒç”¨å‡½æ•°ï¼Œæ­¤æ—¶ç¼“å­˜è¿›æ¥äº† */ if (fastpath(behavior &amp; LOOKUP_CACHE)) &#123; imp = cache_getImp(cls, sel); if (imp) goto done_nolock; &#125; // åŠ é”ï¼Œç›®çš„æ˜¯ä¿è¯è¯»å–çš„çº¿ç¨‹å®‰å…¨ runtimeLock.lock(); // åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ç±»ï¼šåˆ¤æ–­å½“å‰ç±»æ˜¯å¦å·²ç»è¢«è®¤å¯çš„ç±»ï¼Œå³å·²ç»åŠ è½½çš„ç±» checkIsKnownClass(cls); // åˆ¤æ–­ç±»æ˜¯å¦å®ç°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦å…ˆå®ç°ï¼Œæ­¤æ—¶çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿çˆ¶ç±»é“¾ï¼Œæ–¹æ³•åç»­çš„å¾ªç¯ if (slowpath(!cls-&gt;isRealized())) &#123; cls = realizeClassMaybeSwiftAndLeaveLocked(cls, runtimeLock); &#125; // åˆ¤æ–­ç±»æ˜¯å¦åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦å…ˆåˆå§‹åŒ– if (slowpath((behavior &amp; LOOKUP_INITIALIZE) &amp;&amp; !cls-&gt;isInitialized())) &#123; cls = initializeAndLeaveLocked(cls, inst, runtimeLock); &#125; runtimeLock.assertLocked(); curClass = cls; /* æŸ¥æ‰¾ç±»çš„ç¼“å­˜ unreasonableClassCount è¡¨ç¤ºç±»çš„è¿­ä»£ä¸Šé™ çŒœæµ‹è¿™é‡Œé€’å½’çš„åŸå› æ˜¯attemptsåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶åšäº†å‡ä¸€æ“ä½œï¼Œç„¶åå†æ¬¡å¾ªç¯æ—¶ ä»åœ¨ä¸Šé™èŒƒå›´å†…ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­é€’å½’ */ for (unsigned attempts = unreasonableClassCount();;) &#123; // å½“å‰ç±»æ–¹æ³•åˆ—è¡¨ï¼ˆé‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼‰ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿”å›ï¼Œå°†æ–¹æ³•ç¼“å­˜åˆ°cacheä¸­ Method meth = getMethodNoSuper_nolock(curClass, sel); if (meth) &#123; imp = meth-&gt;imp; goto done; &#125; // å½“å‰ç±» = å½“å‰ç±»çš„çˆ¶ç±»ï¼Œå¹¶åˆ¤æ–­çˆ¶ç±»æ˜¯å¦ä¸ºnil if (slowpath((curClass = curClass-&gt;superclass) == nil)) &#123; // æœªæ‰¾åˆ°æ–¹æ³•å®ç°ï¼Œæ–¹æ³•è§£æå™¨ä¹Ÿä¸è¡Œï¼Œä½¿ç”¨è½¬å‘ imp = forward_imp; break; &#125; // å¦‚æœçˆ¶ç±»é“¾ä¸­å­˜åœ¨å¾ªç¯ï¼Œåˆ™åœæ­¢ if (slowpath(--attempts == 0)) &#123; _objc_fatal(&quot;Memory corruption in class list.&quot;); &#125; // çˆ¶ç±»ç¼“å­˜ imp = cache_getImp(curClass, sel); if (slowpath(imp == forward_imp)) &#123; // å¦‚æœåœ¨çˆ¶ç±»ä¸­æ‰¾åˆ°äº†forwardï¼Œåˆ™åœæ­¢æŸ¥æ‰¾ï¼Œä¸”ä¸ç¼“å­˜ï¼Œé¦–å…ˆè°ƒç”¨æ­¤ç±»çš„æ–¹æ³•è§£æå™¨ break; &#125; if (fastpath(imp)) &#123; // å¦‚æœåœ¨çˆ¶ç±»ä¸­ï¼Œæ‰¾åˆ°äº†æ­¤æ–¹æ³•ï¼Œå°†å…¶å­˜å‚¨åˆ°cacheä¸­ goto done; &#125; &#125; // å¦‚æœæ²¡æ‰¾åˆ°æ–¹æ³•ï¼Œå°è¯•ä¸€æ¬¡æ–¹æ³•è§£æ if (slowpath(behavior &amp; LOOKUP_RESOLVER)) &#123; // åŠ¨æ€æ–¹æ³•å†³è®®çš„æ§åˆ¶æ¡ä»¶ï¼Œä¾¿æ˜¯æµç¨‹åªèµ°ä¸€æ¬¡ behavior ^= LOOKUP_RESOLVER; return resolveMethod_locked(inst, sel, cls, behavior); &#125; done: // å­˜å‚¨åˆ°ç¼“å­˜ log_and_fill_cache(cls, imp, sel, inst, curClass); // è§£é” runtimeLock.unlock(); done_nolock: if (slowpath((behavior &amp; LOOKUP_NIL) &amp;&amp; imp == forward_imp)) &#123; return nil; &#125; return imp;&#125; å…¶æ•´ä½“çš„æ…¢é€ŸæŸ¥æ‰¾æµç¨‹å¦‚ä¸‹å›¾ï¼š ä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š ã€ç¬¬ä¸€æ­¥ã€‘cache ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå³ å¿«é€ŸæŸ¥æ‰¾ï¼Œæ‰¾åˆ°åˆ™ç›´æ¥è¿”å› impï¼Œåä¹‹ï¼Œåˆ™è¿›å…¥ã€ç¬¬äºŒæ­¥ã€‘ ã€ç¬¬äºŒæ­¥ã€‘åˆ¤æ–­ cls æ˜¯å¦æ˜¯ å·²çŸ¥ç±»ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ æŠ¥é”™ ç±»æ˜¯å¦ å®ç°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™éœ€è¦å…ˆå®ç°ï¼Œç¡®å®šå…¶çˆ¶ç±»é“¾ï¼Œæ­¤æ—¶å®ä¾‹åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®å®šçˆ¶ç±»é“¾ã€roã€ä»¥åŠrwç­‰ï¼Œæ–¹æ³•åç»­æ•°æ®çš„è¯»å–ä»¥åŠæŸ¥æ‰¾çš„å¾ªç¯ æ˜¯å¦ åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆå§‹åŒ– ã€ç¬¬ä¸‰æ­¥ã€‘for å¾ªç¯ï¼ŒæŒ‰ç…§ ç±»ç»§æ‰¿é“¾æˆ–è€…å…ƒç±»ç»§æ‰¿é“¾ çš„é¡ºåºæŸ¥æ‰¾ å½“å‰çš„ cls çš„æ–¹æ³•åˆ—è¡¨ä¸­ä½¿ç”¨ äºŒåˆ†æŸ¥æ‰¾ç®—æ³• æŸ¥æ‰¾æ–¹æ³•ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™ è¿›å…¥cacheå†™å…¥æµç¨‹ï¼ˆåœ¨OCåº•å±‚åŸç†13ï¼šcache_tåº•å±‚åŸç†åˆ†æ æ–‡ç« ä¸­å·²ç»è¯¦è¿°è¿‡ï¼‰ï¼Œå¹¶ è¿”å›impï¼Œå¦‚æœ æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› nil å½“å‰cls è¢«èµ‹å€¼ä¸º çˆ¶ç±»ï¼Œå¦‚æœçˆ¶ç±» ç­‰äºnilï¼Œåˆ™ imp = æ¶ˆæ¯è½¬å‘ï¼Œå¹¶ç»ˆæ­¢é€’å½’ï¼Œè¿›å…¥ã€ç¬¬å››æ­¥ã€‘ å¦‚æœ çˆ¶ç±»é“¾ ä¸­å­˜åœ¨å¾ªç¯ï¼Œåˆ™æŠ¥é”™ï¼Œç»ˆæ­¢å¾ªç¯ çˆ¶ç±»ç¼“å­˜ ä¸­æŸ¥æ‰¾æ–¹æ³• å¦‚æœ æœªæ‰¾åˆ°ï¼Œåˆ™ç›´æ¥è¿”å› nilï¼Œç»§ç»­ å¾ªç¯æŸ¥æ‰¾ å¦‚æœ æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ è¿”å›impï¼Œæ‰§è¡Œ cacheå†™å…¥æµç¨‹ ã€ç¬¬å››æ­¥ã€‘åˆ¤æ–­ æ˜¯å¦æ‰§è¡Œè¿‡ åŠ¨æ€æ–¹æ³•è§£æ å¦‚æœ æ²¡æœ‰ï¼Œæ‰§è¡Œ åŠ¨æ€æ–¹æ³•è§£æ å¦‚æœ æ‰§è¡Œè¿‡ ä¸€æ¬¡åŠ¨æ€æ–¹æ³•è§£æï¼Œåˆ™èµ°åˆ° æ¶ˆæ¯è½¬å‘æµç¨‹ ä»¥ä¸Šå°±æ˜¯æ–¹æ³•çš„ æ…¢é€ŸæŸ¥æ‰¾æµç¨‹ï¼Œä¸‹é¢åœ¨åˆ†åˆ«è¯¦ç»†è§£é‡Š äºŒåˆ†æŸ¥æ‰¾åŸç†ï¼Œä»¥åŠ çˆ¶ç±»ç¼“å­˜æŸ¥æ‰¾ è¯¦ç»†æ­¥éª¤ getMethodNoSuper_nolock æ–¹æ³•ï¼šäºŒåˆ†æŸ¥æ‰¾æ–¹æ³•æµç¨‹æŸ¥æ‰¾æ–¹æ³•åˆ—è¡¨æµç¨‹ï¼š å…¶ äºŒåˆ†æŸ¥æ‰¾ æ ¸å¿ƒçš„æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839ALWAYS_INLINE static method_t *findMethodInSortedMethodList(SEL key, const method_list_t *list)&#123; ASSERT(list); const method_t * const first = &amp;list-&gt;first; const method_t *base = first; const method_t *probe; uintptr_t keyValue = (uintptr_t)key; // key ç­‰äº say666 uint32_t count; // baseç›¸å½“äºlowï¼Œcountæ˜¯maxäº†ï¼Œprobeæ˜¯middleï¼Œè¿™å°±æ˜¯äºŒåˆ† for (count = list-&gt;count; count != 0; count &gt;&gt;= 1) &#123; // ä»é¦–åœ°å€+ä¸‹æ ‡ -&gt; ç§»åŠ¨åˆ°ä¸­é—´ä½ç½®ï¼ˆcount &gt;&gt; 1 å³ç§»1ä½ count/2 = 4ï¼‰ probe = base + (count &gt;&gt; 1); uintptr_t probeValue = (uintptr_t)probe-&gt;name; // å¦‚æœæŸ¥æ‰¾çš„keyæ˜¯keyVal ç­‰äºä¸­é—´ä½ç½®ï¼ˆprobeï¼‰çš„probeValueï¼Œåˆ™ç›´æ¥è¿”å›ä¸­é—´ä½ç½® if (keyValue == probeValue) &#123; // while å¹³ç§» æ’é™¤åˆ†ç±»é‡åæ–¹æ³• while (probe &gt; first &amp;&amp; keyValue == (uintptr_t)probe[-1].name) &#123; /* æ’é™¤åˆ†ç±»é‡åæ–¹æ³•ï¼ˆæ–¹æ³•çš„å­˜å‚¨æ˜¯å…ˆå­˜å‚¨æ–¹æ³•ï¼Œå†å­˜å‚¨åˆ†ç±»ï¼ŒæŒ‰ç…§å…ˆè¿›åå‡ºçš„åŸåˆ™ï¼Œåˆ†ç±»æ–¹æ³•æœ€å…ˆå‡ºï¼Œ è€Œæˆ‘ä»¬è¦å–çš„ç±»æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ’é™¤åˆ†ç±»æ–¹æ³• å¦‚æœæ˜¯ä¸¤ä¸ªåˆ†ç±»ï¼Œå°±çœ‹è°å…ˆè¿›è¡ŒåŠ è½½ï¼‰ */ probe--; &#125; return (method_t *)probe; &#125; // å¦‚æœkeyValue å¤§äº probeValueï¼Œå°±å¾€probeå³ä¸­é—´ä½ç½®çš„å³è¾¹æŸ¥æ‰¾ if (keyValue &gt; probeValue) &#123; base = probe + 1; count--; &#125; &#125; return nil;&#125; ç®—æ³•åŸç† ç®€è¿°ï¼šä»ç¬¬ä¸€æ¬¡æŸ¥æ‰¾å¼€å§‹ï¼Œæ¯æ¬¡éƒ½å– ä¸­é—´ä½ç½®ï¼Œä¸æƒ³æŸ¥æ‰¾çš„ keyçš„valueçš„å€¼ ä½œæ¯”è¾ƒï¼Œå¦‚æœ ç›¸ç­‰ï¼Œåˆ™éœ€è¦ æ’é™¤åˆ†ç±»æ–¹æ³•ï¼Œç„¶åå°†æŸ¥è¯¢åˆ°çš„ä½ç½®çš„æ–¹æ³•å®ç°è¿”å›ï¼Œå¦‚æœ ä¸ç›¸ç­‰ï¼Œåˆ™éœ€è¦ ç»§ç»­äºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœå¾ªç¯è‡³ count=0 è¿˜æ˜¯ æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥è¿”å› nilï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»¥æŸ¥æ‰¾ ZJPerson ç±»çš„ sayNBå®ä¾‹æ–¹æ³• ä¸ºä¾‹ï¼Œå…¶äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹ï¼š cache_getImpæ–¹æ³•ï¼šçˆ¶ç±»ç¼“å­˜æŸ¥æ‰¾cache_getImp æ–¹æ³•æ˜¯é€šè¿‡ æ±‡ç¼–_cache_getImpå®ç°ï¼Œä¼ å…¥ $0 æ˜¯ GETIMPï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚æœ çˆ¶ç±»ç¼“å­˜ ä¸­æ‰¾åˆ°äº†æ–¹æ³•å®ç°ï¼Œåˆ™è·³è½¬è‡³ CacheHit å³å‘½ä¸­ï¼Œåˆ™ç›´æ¥ è¿”å›imp å¦‚æœåœ¨ çˆ¶ç±»ç¼“å­˜ ä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ° æ–¹æ³•å®ç°ï¼Œåˆ™è·³è½¬è‡³ CheckMiss æˆ–è€… JumpMissï¼Œé€šè¿‡åˆ¤æ–­ $0 è·³è½¬è‡³ LGetImpMissï¼Œç›´æ¥è¿”å› nil æ€»ç»“ å¯¹äº å¯¹è±¡æ–¹æ³•ï¼ˆå³å®ä¾‹æ–¹æ³•ï¼‰ï¼Œå³åœ¨ ç±»ä¸­æŸ¥æ‰¾ï¼Œå…¶æ…¢é€ŸæŸ¥æ‰¾çš„ çˆ¶ç±»é“¾ æ˜¯ï¼šç±» -&gt; çˆ¶ç±» -&gt; æ ¹ç±» -&gt; nil å¯¹äº ç±»æ–¹æ³•ï¼Œå³åœ¨ å…ƒç±»ä¸­æŸ¥æ‰¾ï¼Œå…¶æ…¢é€ŸæŸ¥æ‰¾çš„ çˆ¶ç±»é“¾ æ˜¯ï¼šå…ƒç±» -&gt; æ ¹å…ƒç±» -&gt; æ ¹ç±» -&gt; nil å¦‚æœ å¿«é€ŸæŸ¥æ‰¾ã€æ…¢é€ŸæŸ¥æ‰¾ ä¹Ÿ æ²¡æœ‰æ‰¾åˆ° æ–¹æ³•å®ç°ï¼Œåˆ™å°è¯• åŠ¨æ€æ–¹æ³•å†³è®® å¦‚æœ åŠ¨æ€æ–¹æ³•å†³è®® ä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œ æ¶ˆæ¯è½¬å‘ å¸¸è§æ–¹æ³•æœªå®ç°æŠ¥é”™æºç å¦‚æœåœ¨ å¿«é€ŸæŸ¥æ‰¾ã€æ…¢é€ŸæŸ¥æ‰¾ã€æ–¹æ³•è§£ææµç¨‹ä¸­ï¼Œå‡æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•å®ç°ï¼Œåˆ™ä½¿ç”¨æ¶ˆæ¯è½¬å‘ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š æ¶ˆæ¯è½¬å‘çš„å®ç° å…¶ä¸­ _objc_msgForward_impcache æ˜¯æ±‡ç¼–å®ç°ï¼Œä¼šè·³è½¬è‡³ __objc_msgForwardï¼Œå…¶æ ¸å¿ƒæ˜¯ __objc_forward_handler 123456789101112131415STATIC_ENTRY __objc_msgForward_impcache// No stret specialization.b __objc_msgForwardEND_ENTRY __objc_msgForward_impcache ENTRY __objc_msgForwardadrp x17, __objc_forward_handler@PAGEldr p17, [x17, __objc_forward_handler@PAGEOFF]TailCallFunctionPointer x17 END_ENTRY __objc_msgForward æ±‡ç¼–å®ç°ä¸­æŸ¥æ‰¾ __objc_forward_handler ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°ï¼Œåœ¨æºç ä¸­å»æ‰ä¸€ä¸ªä¸‹åˆ’çº¿è¿›è¡Œå…¨å±€æœç´¢ _objc_forward_handler ,æœ‰å¦‚ä¸‹å®ç°ï¼Œæœ¬è´¨æ˜¯è°ƒç”¨çš„ objc_defaultForwardHandler æ–¹æ³• 12345678910// Default forward handler halts the process.__attribute__((noreturn, cold)) voidobjc_defaultForwardHandler(id self, SEL sel)&#123; _objc_fatal(&quot;%c[%s %s]: unrecognized selector sent to instance %p &quot; &quot;(no message forward handler is installed)&quot;, class_isMetaClass(object_getClass(self)) ? &#x27;+&#x27; : &#x27;-&#x27;, object_getClassName(self), sel_getName(sel), self);&#125;void *_objc_forward_handler = (void*)objc_defaultForwardHandler; çœ‹ç€ objc_defaultForwardHandler æœ‰æ²¡æœ‰å¾ˆçœ¼ç†Ÿï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æœ€å¸¸è§çš„é”™è¯¯ï¼šæ²¡æœ‰å®ç°å‡½æ•°ï¼Œè¿è¡Œç¨‹åºï¼Œå´©æºƒæ—¶çš„æŠ¥é”™æç¤º","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†13ï¼šcache_tåº•å±‚åŸç†åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†13ï¼šcache-tåº•å±‚åŸç†åˆ†æ","date":"2020-09-30T10:28:30.000Z","updated":"2022-04-22T09:23:19.000Z","comments":true,"path":"2020/09/30/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†13ï¼šcache-tåº•å±‚åŸç†åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/09/30/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8613%EF%BC%9Acache-t%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æˆ‘ä»¬åœ¨å‰é¢çš„ OCåº•å±‚åŸç†10ï¼šç±» &amp; ç±»ç»“æ„åˆ†æ ä¸­å¾—çŸ¥ ç±» éƒ½æ˜¯ä»¥ objc_class æ¨¡æ¿åˆ›å»ºçš„ï¼Œè€Œ objc_class ä¸­åŒ…å«è®¸å¤šå±æ€§ï¼Œå¦‚ Class ISAã€Class superclassã€cache_t cacheã€class_data_bits_t bitsï¼Œå¹¶åˆ†æäº† ISAã€superclassã€bitsï¼Œæœ¬æ–‡ä¸»è¦åˆ†æ cache_t ä¸­çš„ cache å±æ€§ã€‚ cache_t ç»“æ„åˆ†æ é€šè¿‡ objc4-781æºç  ï¼ŒæŸ¥çœ‹ cache_t çš„æºç ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940// cache å­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ æ€ä¹ˆå­˜çš„ï¼Ÿ// cache ç”¨æ¥ç¼“å­˜struct cache_t &#123;#if CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_OUTLINED // MacOS æˆ– æ¨¡æ‹Ÿå™¨ -- ä¸»è¦ä½œä¸ºæ¶æ„çš„åŒºåˆ† // explicit_atomic æ˜¾ç¤ºåŸå­æ€§ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿ å¢åˆ æ”¹æŸ¥æ—¶ ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ // ç­‰ä»·äº struct bucket_t * _buckets; // _buckets ä¸­æ”¾çš„æ˜¯ sel imp // _bucketsçš„è¯»å– æœ‰æä¾›ç›¸åº”åç§°çš„æ–¹æ³• buckets() explicit_atomic&lt;struct bucket_t *&gt; _buckets; // _mask æ©ç ï¼Œå³é¢å…· -- ç±»ä¼¼äºisaçš„æ©ç ï¼Œå³ä½åŸŸ explicit_atomic&lt;mask_t&gt; _mask; #elif CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_HIGH_16 // çœŸæœº &amp; 64ä½ // _maskAndBuckets æŠŠåŸæ¥çš„ä¸¤ä¸ªç»“æ„ _buckets å’Œ _mask å†™æˆä¸€ä¸ªäº†ï¼Œä½œç”¨ ä¸ºäº†ä¼˜åŒ– explicit_atomic&lt;uintptr_t&gt; _maskAndBuckets; // è‹¹æœæ²¡æœ‰å†™å®Œ mask_t _mask_unused; // é™æ€çš„çœç•¥... #elif CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_LOW_4 // çœŸæœº ä¸æ˜¯64ä½çš„ explicit_atomic&lt;uintptr_t&gt; _maskAndBuckets; mask_t _mask_unused; // é™æ€çš„çœç•¥... #else#error Unknown cache mask storage type.#endif #if __LP64__ // ä½ç½®æ ‡è®° uint16_t _flags;#endif // å ä½ uint16_t _occupied; //å…¶ä»–æ–¹æ³•çœç•¥..... åˆ†æ cache_t çš„ç»“æ„ï¼š é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹è‹¹æœè®¾å¤‡çš„ä¸åŒçš„ æ¶æ„ï¼Œå¦‚ä¸‹ï¼š MacOS æ¶æ„ï¼ši386 çœŸæœº æ¶æ„ï¼šarm64 æ¨¡æ‹Ÿå™¨ æ¶æ„ï¼šx86 é€šè¿‡ä¸Šé¢çš„ cache_t æºç å¯çŸ¥ï¼Œåˆ†ä¸º 3 ä¸ªæ¶æ„å¤„ç†ï¼š CACHE_MASK_STORAGE_OUTLINEDï¼šè¡¨ç¤ºè¿è¡Œçš„ç¯å¢ƒæ˜¯ MacOS æˆ–è€… æ¨¡æ‹Ÿå™¨ CACHE_MASK_STORAGE_HIGH_16ï¼šè¡¨ç¤ºè¿è¡Œçš„ç¯å¢ƒæ˜¯ 64ä½ çš„ çœŸæœº CACHE_MASK_STORAGE_LOW_4ï¼šè¡¨ç¤ºè¿è¡Œçš„ç¯å¢ƒæ˜¯ é64ä½ çš„ çœŸæœº æˆ‘ä»¬å¯ä»¥ç‚¹è¿› CACHE_MASK_STORAGE ä¸­æŸ¥çœ‹å…·ä½“çš„å®šä¹‰ï¼š 123456789101112#define CACHE_MASK_STORAGE_OUTLINED 1 #define CACHE_MASK_STORAGE_HIGH_16 2#define CACHE_MASK_STORAGE_LOW_4 3#if defined(__arm64__) &amp;&amp; __LP64__ // çœŸæœº &amp; 64ä½#define CACHE_MASK_STORAGE CACHE_MASK_STORAGE_HIGH_16#elif defined(__arm64__) &amp;&amp; !__LP64__ // çœŸæœº &amp; é64ä½#define CACHE_MASK_STORAGE CACHE_MASK_STORAGE_LOW_4#else // MacOS æˆ– æ¨¡æ‹Ÿå™¨#define CACHE_MASK_STORAGE CACHE_MASK_STORAGE_OUTLINED#endif explicit_atomicï¼šè¡¨ç¤º æ˜¾ç¤ºåŸå­æ€§ï¼Œç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿä¿è¯ å¢åˆ æ”¹æŸ¥æ—¶ çº¿ç¨‹çš„å®‰å…¨æ€§ _bucketsï¼šæ˜¯ä¸€ä¸ª struct bucket_t çš„ç»“æ„ä½“ï¼Œå…¶å†…éƒ¨æºç å¦‚ä¸‹ï¼š 1234567891011struct bucket_t &#123;private: // IMP-first is better for arm64e ptrauth and no worse for arm64. // SEL-first is better for armv7* and i386 and x86_64.#if __arm64__ // çœŸæœº 64ä½ explicit_atomic&lt;uintptr_t&gt; _imp; explicit_atomic&lt;SEL&gt; _sel;#else // éçœŸæœº explicit_atomic&lt;SEL&gt; _sel; explicit_atomic&lt;uintptr_t&gt; _imp;#endif ç”± bucket_t æºç å¯çŸ¥ï¼Œå…¶å†…éƒ¨ä¿å­˜çš„æ˜¯ SEL å’Œ IMP _maskï¼šæ˜¯ masK_t ç»“æ„ï¼Œæ©ç ï¼Œå³é¢å…·ï¼Œç±»ä¼¼äº isaä¸­çš„æ©ç å³ ä½åŸŸ çœŸæœº ç¯å¢ƒï¼š uint32_t ç±»å‹çš„ å…¶ä»– ç¯å¢ƒï¼šuint16_t ç±»å‹çš„ masK_t çš„å†…éƒ¨ç»“æ„å¦‚ä¸‹ï¼š 12345#if __LP64__typedef uint32_t mask_t; // x86_64 &amp; arm64 asm are less efficient with 16-bits#elsetypedef uint16_t mask_t;#endif _maskAndBucketsï¼š çœŸæœº ç¯å¢ƒæŠŠåŸæ¥çš„ä¸¤ä¸ªç»“æ„ _buckets å’Œ _mask å†™æˆä¸€ä¸ªäº†ï¼Œä½œç”¨æ˜¯ ä¸ºäº†ä¼˜åŒ– ã€æ€»ç»“ã€‘ é€šè¿‡ä¸Šé¢å‡ ä¸ªç»“æ„ä½“åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªå¦‚ä¸‹çš„ç»“æ„å›¾ï¼š ã€è¡¥å……çŸ¥è¯†ã€‘sel &amp; imp çš„å…³ç³»æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ª sel å’Œ impï¼Œsel å°±æ˜¯ æ–¹æ³•ç¼–å·ï¼Œimp å°±æ˜¯ å‡½æ•°æŒ‡é’ˆ(æ–¹æ³•å®ç°)ï¼Œæˆ‘ä»¬åœ¨æŸ¥æ‰¾æ–¹æ³•çš„æ—¶å€™æ˜¯ä¸€ä¸ªéå¸¸æ¼«é•¿çš„è¿‡ç¨‹ï¼Œoc çš„ å‡½æ•°å®ç° æ˜¯é€šè¿‡ ä¸‹å±‚c/c++ æ¥å®ç°çš„ï¼Œocä¸Šå±‚ çš„ sel å’Œ imp èµ·å§‹æ˜¯ å¯¹ä¸‹å±‚ çš„ å°è£… ã€æ–¹æ³•çš„ç»„æˆã€‘: SELï¼šæ–¹æ³•ç¼–å· IMPï¼šå‡½æ•°æŒ‡é’ˆåœ°å€ ã€ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šã€‘ï¼š SELï¼šç›¸å½“äºä¹¦æœ¬ç›®å½•çš„åç§°IMPï¼šç›¸å½“äºä¹¦æœ¬ç›®å½•çš„é¡µç  é¦–å…ˆæ˜ç™½æˆ‘ä»¬è¦æ‰¾åˆ°ä¹¦æœ¬çš„ä»€ä¹ˆå†…å®¹ï¼ˆselç›®å½•é‡Œé¢çš„åç§°ï¼‰ é€šè¿‡åç§°æ‰¾åˆ°å¯¹åº”çš„ä¹¦æœ¬é¡µç ï¼ˆimpï¼‰ é€šè¿‡é¡µç å»å®šä½å…·ä½“çš„å†…å®¹ ä¸‹é¢ç”¨ä¸€å¼ å›¾è¡¨ç¤ºï¼š cacheä¸­æŸ¥æ‰¾sel-impcache_t ä¸­æŸ¥æ‰¾å­˜å‚¨çš„ sel-impï¼Œæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ é€šè¿‡æºç æŸ¥æ‰¾ è„±ç¦»æºç åœ¨é¡¹ç›®ä¸­æŸ¥æ‰¾ ã€å‡†å¤‡å·¥ä½œã€‘ è‡ªå®šä¹‰ä¸€ä¸ª ZJPerson ç±»ï¼Œå¹¶å®šä¹‰ 2ä¸ªå±æ€§ å’Œ 5ä¸ªå®ä¾‹æ–¹æ³• åŠå…¶ å®ç° ZJPerson.h ä¸­ 123456789101112131415@interface ZJPerson : NSObject@property (nonatomic, copy) NSString *zjName;@property (nonatomic, strong) NSString *nickName;- (void)sayHello;- (void)sayCode;- (void)sayMaster;- (void)sayNB;+ (void)sayHappy;@end ZJPerson.m ä¸­ 123456789101112131415161718192021@implementation ZJPerson- (void)sayHello&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)sayCode&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)sayMaster&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)sayNB&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;+ (void)sayHappy&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;@end åœ¨ main.m ä¸­å®šä¹‰ ZJPerson ç±»çš„ å¯¹è±¡pï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„ 3ä¸ªå®ä¾‹æ–¹æ³•ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ–¹æ³•å¤„åŠ ä¸¤ä¸ª æ–­ç‚¹ ã€é€šè¿‡æºç æŸ¥æ‰¾ã€‘ è¿è¡Œæ‰§è¡Œï¼Œæ–­åœ¨ [p sayHello]; éƒ¨åˆ†ï¼Œæ­¤æ—¶æ‰§è¡Œä»¥ä¸‹lldbè°ƒè¯•æµç¨‹ï¼š ç”±ä¸Šé¢çš„è°ƒå¼æµç¨‹å¯çŸ¥ï¼š cacheå±æ€§ çš„è·å–ï¼Œéœ€è¦é€šè¿‡ pClass çš„ é¦–åœ°å€å¹³ç§»16å­—èŠ‚ï¼Œå³ é¦–åœ°å€ + 0x10 è·å– cacheçš„åœ°å€ _bucketså±æ€§ çš„è·å–ï¼Œåœ¨ cache_t ç»“æ„ä½“ä¸­æä¾›äº†è·å– _buckets å±æ€§çš„æ–¹æ³• buckets()ï¼Œåœ¨ _buckets å±æ€§ä¸­ï¼ˆç›®å‰å¤„äºmacOSç¯å¢ƒï¼‰ç¼“å­˜ç€ sel-imp sel å’Œ imp çš„è·å–ï¼Œåœ¨ _buckets ä¸­æä¾›äº† sel() å’Œ imp(pClass) æ–¹æ³•è·å– sel å’Œ imp ç”±ä¸Šå›¾å¯çŸ¥ï¼Œåœ¨æ²¡æœ‰æ‰§è¡Œæ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œæ­¤æ—¶ cache æ˜¯æ²¡æœ‰ç¼“å­˜çš„ï¼Œæ‰§è¡Œè°ƒç”¨äº†ä¸€æ¬¡ä¹‹åï¼Œcache ä¸­å°± ç¼“å­˜ äº† ä¸€æ¬¡ï¼Œå³è°ƒç”¨ä¸€æ¬¡æ–¹æ³•å°±ä¼šç¼“å­˜ä¸€æ¬¡ã€‚ æˆ‘ä»¬åœ¨å‰é¢äº†è§£äº†å¦‚ä½•è·å– cache ä¸­ sel-impï¼Œé‚£ä¹ˆå¦‚ä½•éªŒè¯æ‰“å°çš„sel-imp å°±æ˜¯æˆ‘ä»¬è°ƒç”¨çš„å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ machoView æ‰“å¼€ target çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥çœ‹å…¶ imp çš„å€¼ æ˜¯å¦æ˜¯ä¸€è‡´ çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå‘ç°æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æ‰“å°çš„è¿™ä¸ª sel-imp å°±æ˜¯ ZJPerson çš„å®ä¾‹æ–¹æ³•ï¼š ã€machoViewå›¾ã€‘ï¼š ã€impæˆªå›¾ï¼šã€‘ æ¥ç€ä¸Šé¢çš„ LLDB è°ƒè¯•æ­¥éª¤ï¼Œæˆ‘ä»¬å†è°ƒä¸€ä¸ªæ–¹æ³•ï¼Œå…¶ LLDB è°ƒè¯•å¦‚ä¸‹å›¾ï¼š ç¬¬ä¸€ä¸ªè°ƒç”¨æ–¹æ³•çš„å­˜å‚¨è·å–å¾ˆç®€å•ï¼Œç›´æ¥é€šè¿‡ _buckets çš„ é¦–åœ°å€ è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å³å¯ï¼Œé‚£ä¹ˆè·å–ç¬¬äºŒä¸ªå‘¢ï¼Ÿåœ¨ä¹‹å‰çš„ OCåº•å±‚åŸç†10ï¼šç±» &amp; ç±»ç»“æ„åˆ†æ æ–‡ç« ä¸­ï¼Œæ›¾æåŠè¿‡ä¸€ä¸ªæ¦‚å¿µ æŒ‡é’ˆåç§»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå¯ä»¥é€šè¿‡ _buckets å±æ€§çš„ é¦–åœ°å€åç§»ï¼Œå³ p *($9+1) å³å¯è·å–ç¬¬äºŒä¸ªæ–¹æ³•çš„ sel å’Œ imp å¦‚æœæœ‰å¤šä¸ªæ–¹æ³•éœ€è¦è·å–ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¾‹å¦‚ p *($9+i) ã€è„±ç¦»æºç é€šè¿‡é¡¹ç›®æŸ¥æ‰¾ã€‘ è„±ç¦»æºç ç¯å¢ƒï¼Œå°±æ˜¯å°†æ‰€éœ€çš„ æºç  çš„éƒ¨åˆ† æ‹·è´è‡³é¡¹ç›® ä¸­ï¼Œå…¶å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š ã€ZJPersonç±»ã€‘ 1234567891011121314151617181920212223242526272829303132333435363738394041//*********.h********@interface ZJPerson : NSObject@property (nonatomic, copy) NSString *zjName;@property (nonatomic, strong) NSString *nickName;- (void)say1;- (void)say2;- (void)say3;- (void)say4;- (void)say5;- (void)say6;- (void)say7;+ (void)sayHappy;@end//*********.m********@implementation ZJPerson- (void)say1&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)say2&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)say3&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)say4&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)say5&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)say6&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;- (void)say7&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;+ (void)sayHappy&#123; NSLog(@&quot;ZJPerson say : %s&quot;,__func__);&#125;@end ã€mainä¸­ä»£ç ã€‘ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#import &lt;Foundation/Foundation.h&gt;#import &quot;ZJPerson.h&quot;#import &lt;objc/runtime.h&gt;typedef uint32_t mask_t; // x86_64 &amp; arm64 asm are less efficient with 16-bitsstruct zj_bucket_t &#123; SEL _sel; IMP _imp;&#125;;struct zj_cache_t &#123; struct zj_bucket_t * _buckets; mask_t _mask; uint16_t _flags; uint16_t _occupied;&#125;;struct zj_class_data_bits_t &#123; uintptr_t bits;&#125;;struct zj_objc_class &#123; Class ISA; Class superclass; struct zj_cache_t cache; // formerly cache pointer and vtable struct zj_class_data_bits_t bits; // class_rw_t * plus custom rr/alloc flags&#125;;int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; ZJPerson *p = [ZJPerson alloc]; Class pClass = [ZJPerson class]; // objc_clas [p say1]; [p say2]; [p say3]; [p say4]; // _occupied _mask æ˜¯ä»€ä¹ˆ cup - 1 // ä¼šå˜åŒ– 2-3 -&gt; 2-7 // bucket ä¼šæœ‰ä¸¢å¤± é‡æ–°ç”³è¯· // é¡ºåºæœ‰ç‚¹é—®é¢˜ å“ˆå¸Œ // cache_t åº•å±‚åŸç† // çº¿ç´¢ : struct zj_objc_class *zj_pClass = (__bridge struct zj_objc_class *)(pClass); NSLog(@&quot;%hu - %u&quot;,zj_pClass-&gt;cache._occupied,zj_pClass-&gt;cache._mask); for (mask_t i = 0; i&lt;zj_pClass-&gt;cache._mask; i++) &#123; // æ‰“å°è·å–çš„ bucket struct zj_bucket_t bucket = zj_pClass-&gt;cache._buckets[i]; NSLog(@&quot;%@ - %p&quot;,NSStringFromSelector(bucket._sel),bucket._imp); &#125; NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125; è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œåœ¨æºç ä¸­ï¼Œobjc_class çš„ ISA å±æ€§æ—¶ç»§æ‰¿è‡ª objc_object çš„ï¼Œä½†åœ¨æˆ‘ä»¬å°†å…¶æ‹·è´è¿‡æ¥æ—¶ï¼Œå»æ‰äº† objc_class çš„ç»§æ‰¿å…³ç³»ï¼Œéœ€è¦å°†è¿™ä¸ªå±æ€§æ˜ç¡®ï¼Œå¦åˆ™æ‰“å°çš„ç»“æœæ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åŠ ä¸Š ISA å±æ€§åï¼Œå…¶æ­£ç¡®çš„æ‰“å°ç»“æœå¦‚ä¸‹ï¼š é’ˆå¯¹ä¸Šé¢çš„æ‰“å°ç»“æœï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªç–‘é—®ï¼Ÿ _mask æ˜¯ä»€ä¹ˆï¼Ÿ _occupied æ˜¯ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆéšç€æ–¹æ³•è°ƒç”¨çš„å¢å¤šï¼Œå…¶æ‰“å°çš„ occupied å’Œ mask ä¼šå˜åŒ–ï¼Ÿ bucket æ•°æ®ä¸ºä»€ä¹ˆä¼šæœ‰ ä¸¢å¤±çš„æƒ…å†µï¼Ÿä¾‹å¦‚ 2-7ä¸­ï¼Œåªæœ‰say3ã€say4æ–¹æ³•æœ‰å‡½æ•°æŒ‡é’ˆï¼Ÿ 2-7ä¸­say3ã€say4çš„æ‰“å°é¡ºåºä¸ºä»€ä¹ˆæ˜¯say4å…ˆæ‰“å°ï¼Œsay3åæ‰“å°ï¼Œä¸”è¿˜ä¸æ˜¯æŒ¨ç€çš„ï¼Œå³ é¡ºåºæœ‰é—®é¢˜ï¼Ÿ æ‰“å°çš„ cache_t ä¸­çš„ _occupied ä¸ºä»€ä¹ˆæ˜¯ä» 2 å¼€å§‹ï¼Ÿ å¸¦ç€ä¸Šè¿°çš„è¿™äº›ç–‘é—®ï¼Œä¸‹é¢æ¥è¿›è¡Œ cache åº•å±‚åŸç†çš„æ¢ç´¢ cache_t åº•å±‚åŸç†åˆ†æ é¦–å…ˆï¼Œä» cache_t ä¸­çš„ _mask å±æ€§å¼€å§‹åˆ†æï¼Œæ‰¾ cache_t ä¸­å¼•èµ·å˜åŒ–çš„å‡½æ•°ï¼Œå‘ç°äº† incrementOccupied() å‡½æ•° è¯¥å‡½æ•°çš„å…·ä½“å®ç°ä¸º 1234567void incrementOccupied(); //Occupiedè‡ªå¢//ğŸ‘‡å…·ä½“å®ç°void cache_t::incrementOccupied() &#123; _occupied++;&#125; æºç ä¸­ï¼Œå…¨å±€æœç´¢ incrementOccupied() å‡½æ•°ï¼Œå‘ç°åªåœ¨ cache_t çš„ insert æ–¹æ³•æœ‰è°ƒç”¨ insert æ–¹æ³•ï¼Œç†è§£ä¸º cache_t çš„æ’å…¥ï¼Œè€Œ cache ä¸­å­˜å‚¨çš„å°±æ˜¯ sel-impï¼Œæ‰€ä»¥ cache çš„åŸç†ä» insert æ–¹æ³•å¼€å§‹åˆ†æï¼Œä»¥ä¸‹æ˜¯ cache åŸç†åˆ†æçš„æµç¨‹å›¾ å…¨å±€æœç´¢ insert( æ–¹æ³•ï¼Œå‘ç°åªæœ‰ cache_fill æ–¹æ³•ä¸­çš„è°ƒç”¨ç¬¦åˆ å…¨å±€æœç´¢ cache_fillï¼Œå‘ç°åœ¨å†™å…¥ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€æ­¥æ“ä½œï¼Œå³ cache è¯»å–ï¼Œå³æŸ¥æ‰¾ sel-impï¼Œå¦‚ä¸‹æ‰€ç¤º ä½†æœ¬æ–‡çš„é‡ç‚¹è¿˜æ˜¯åˆ†æ cache å­˜å‚¨çš„åŸç†ï¼Œæ¥ä¸‹æ¥æ ¹æ® cache_t å†™å…¥çš„æµç¨‹å›¾ï¼Œç€é‡åˆ†æ insert æ–¹æ³• insert æ–¹æ³•åˆ†æåœ¨ insert æ–¹æ³•ä¸­ï¼Œå…¶æºç å®ç°å¦‚ä¸‹ ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š ã€ç¬¬ä¸€æ­¥ã€‘è®¡ç®— å‡ºå½“å‰çš„ ç¼“å­˜å ç”¨é‡ ã€ç¬¬äºŒæ­¥ã€‘æ ¹åŸº ç¼“å­˜å ç”¨é‡åˆ¤æ–­ æ‰§è¡Œçš„ æ“ä½œ ã€ç¬¬ä¸‰æ­¥ã€‘é’ˆå¯¹éœ€è¦å­˜å‚¨çš„ bucket è¿›è¡Œå†…éƒ¨ impå’Œsetèµ‹å€¼ 1ã€ã€ç¬¬ä¸€æ­¥ã€‘è®¡ç®—å‡ºå½“å‰çš„ç¼“å­˜å ç”¨é‡ æ ¹æ® occupied çš„å€¼è®¡ç®—å‡ºå½“å‰çš„ç¼“å­˜å ç”¨é‡ï¼Œå½“ å±æ€§æœªèµ‹å€¼åŠæ— æ³•è°ƒç”¨æ—¶ï¼Œæ­¤æ—¶çš„ occupied()ä¸º0 ï¼Œè€Œ newOccupiedä¸º1 ï¼Œå¦‚ä¸‹æ‰€ç¤º 1mask_t newOccupied = occupied() + 1; å…³äºç¼“å­˜å ç”¨é‡çš„è®¡ç®—ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š alloc ç”³è¯·ç©ºé—´æ—¶ï¼Œæ­¤æ—¶çš„ å¯¹è±¡å·²ç»åˆ›å»ºï¼Œå¦‚æœå†è°ƒç”¨ init æ–¹æ³•ï¼Œoccupiedä¹Ÿä¼š+1 å½“ æœ‰å±æ€§èµ‹å€¼ æ—¶ï¼Œä¼šéšå¼è°ƒç”¨ set æ–¹æ³•ï¼Œoccupied ä¹Ÿä¼šå¢åŠ ï¼Œå³ æœ‰å‡ ä¸ªå±æ€§èµ‹å€¼ï¼Œoccupiedå°±ä¼šåœ¨åŸæœ‰çš„åŸºç¡€ä¸ŠåŠ å‡ ä¸ª å½“ æœ‰æ–¹æ³•è°ƒç”¨ æ—¶ï¼Œoccupied ä¹Ÿä¼šå¢åŠ ï¼Œå³ æœ‰å‡ æ¬¡è°ƒç”¨ï¼Œoccupiedå°±ä¼šåœ¨åŸæœ‰çš„åŸºç¡€ä¸ŠåŠ å‡ ä¸ª 2ã€ã€ç¬¬äºŒæ­¥ã€‘æ ¹æ®ç¼“å­˜å ç”¨é‡åˆ¤æ–­æ‰§è¡Œçš„æ“ä½œ å¦‚æœæ˜¯ ç¬¬ä¸€æ¬¡åˆ›å»ºï¼Œåˆ™é»˜è®¤å¼€è¾Ÿ4ä¸ª 123456if (slowpath(isConstantEmptyCache())) &#123; //å°æ¦‚ç‡å‘ç”Ÿçš„ å³å½“ occupied() = 0æ—¶ï¼Œå³åˆ›å»ºç¼“å­˜ï¼Œåˆ›å»ºå±äºå°æ¦‚ç‡äº‹ä»¶ // Cache is read-only. Replace it. if (!capacity) capacity = INIT_CACHE_SIZE; //åˆå§‹åŒ–æ—¶ï¼Œcapacity = 4ï¼ˆ1&lt;&lt;2 -- 100ï¼‰ reallocate(oldCapacity, capacity, /* freeOld */false); //å¼€è¾Ÿç©ºé—´ //åˆ°ç›®å‰ä¸ºæ­¢ï¼Œifçš„æµç¨‹çš„æ“ä½œéƒ½æ˜¯åˆå§‹åŒ–åˆ›å»º&#125; å¦‚æœç¼“å­˜å ç”¨é‡ å°äºç­‰äº3/4ï¼Œåˆ™ä¸ä½œä»»ä½•å¤„ç† 123else if (fastpath(newOccupied + CACHE_END_MARKER &lt;= capacity / 4 * 3)) &#123; // Cache is less than 3/4 full. Use it as-is.&#125; å¦‚æœç¼“å­˜å ç”¨é‡ è¶…è¿‡3/4ï¼Œåˆ™éœ€è¦è¿›è¡Œ ä¸¤å€æ‰©å®¹ ä»¥åŠ é‡æ–°å¼€è¾Ÿç©ºé—´ 12345678910else &#123; //å¦‚æœè¶…å‡ºäº†3/4ï¼Œåˆ™éœ€è¦æ‰©å®¹ï¼ˆä¸¤å€æ‰©å®¹ï¼‰ // æ‰©å®¹ç®—æ³•ï¼š æœ‰capæ—¶ï¼Œæ‰©å®¹ä¸¤å€ï¼Œæ²¡æœ‰capå°±åˆå§‹åŒ–ä¸º4 capacity = capacity ? capacity * 2 : INIT_CACHE_SIZE; // æ‰©å®¹ä¸¤å€ 2*4 = 8 if (capacity &gt; MAX_CACHE_SIZE) &#123; capacity = MAX_CACHE_SIZE; &#125; // èµ°åˆ°è¿™é‡Œè¡¨ç¤º æ›¾ç»æœ‰ï¼Œä½†æ˜¯å·²ç»æ»¡äº†ï¼Œéœ€è¦é‡æ–°æ¢³ç† reallocate(oldCapacity, capacity, true); // å†…å­˜ æ‰©å®¹å®Œæ¯•&#125; ã€reallocæ–¹æ³•ï¼šå¼€è¾Ÿç©ºé—´ã€‘ è¯¥æ–¹æ³•ï¼Œåœ¨ ç¬¬ä¸€æ¬¡åˆ›å»º ä»¥åŠ ä¸¤å€æ‰©å®¹ æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨ï¼Œå…¶æºç å®ç°å¦‚å›¾æ‰€ç¤º ä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š allocateBuckets æ–¹æ³•ï¼šå‘ç³»ç»Ÿ ç”³è¯·å¼€è¾Ÿå†…å­˜ï¼Œå³å¼€è¾Ÿ bucketï¼Œæ­¤æ—¶çš„bucketåªæ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ setBucketsAndMask æ–¹æ³•ï¼šå°† ä¸´æ—¶ çš„ bucket å­˜å…¥ç¼“å­˜ä¸­ï¼Œæ­¤æ—¶çš„å­˜å‚¨åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š å¦‚æœæ˜¯ çœŸæœºï¼Œæ ¹æ® bucketå’Œmaskçš„ä½ç½®å­˜å‚¨ï¼Œå¹¶å°† occupied å ç”¨è®¾ç½®ä¸º 0 å¦‚æœ ä¸æ˜¯çœŸæœºï¼Œæ­£å¸¸å­˜å‚¨bucketå’Œmaskï¼Œå¹¶å°† occupied å ç”¨è®¾ç½®ä¸º 0 å¦‚æœæœ‰æ—§çš„bucketsï¼Œéœ€è¦æ¸…ç†ä¹‹å‰çš„ç¼“å­˜ï¼Œå³è°ƒç”¨ cache_collect_free æ–¹æ³•ï¼Œå…¶æºç å®ç°å¦‚ä¸‹ è¯¥æ–¹æ³•çš„å®ç°ä¸»è¦æœ‰ä»¥ä¸‹å‡ æ­¥ï¼š _garbage_make_room æ–¹æ³•ï¼šåˆ›å»ºåƒåœ¾å›æ”¶ç©ºé—´ å¦‚æœæ˜¯ ç¬¬ä¸€æ¬¡ï¼Œéœ€è¦ åˆ†é…å›æ”¶ç©ºé—´ å¦‚æœ ä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œåˆ™å°†å†…å­˜æ®µåŠ å¤§ï¼Œå³ åŸæœ‰å†…å­˜*2 è®°å½• å­˜å‚¨ è¿™æ¬¡çš„ bucket cache_collect æ–¹æ³•ï¼šåƒåœ¾å›æ”¶ï¼Œæ¸…ç†æ—§çš„bucket ã€ç¬¬ä¸‰æ­¥ã€‘é’ˆå¯¹éœ€è¦å­˜è´®çš„bucketè¿›è¡Œå†…éƒ¨impå’Œselèµ‹å€¼ è¿™éƒ¨åˆ†ä¸»è¦æ˜¯æ ¹æ® cache_hash æ–¹æ³•ï¼Œå³ å“ˆå¸Œç®—æ³• ï¼Œè®¡ç®— sel-imp å­˜å‚¨çš„ å“ˆå¸Œä¸‹æ ‡ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š å¦‚æœå“ˆå¸Œä¸‹æ ‡çš„ä½ç½® æœªå­˜å‚¨selï¼Œå³è¯¥ä¸‹æ ‡ä½ç½® è·å–selç­‰äº0ï¼Œæ­¤æ—¶å°† sel-impå­˜å‚¨ è¿›å»ï¼Œå¹¶å°† occupied å ç”¨å¤§å° åŠ 1 å¦‚æœå½“å‰å“ˆå¸Œä¸‹æ ‡å­˜å‚¨çš„sel ç­‰äº å³å°†æ’å…¥çš„selï¼Œåˆ™ç›´æ¥è¿”å› å¦‚æœå½“å‰å“ˆå¸Œä¸‹æ ‡å­˜å‚¨çš„sel ä¸ç­‰äº å³å°†æ’å…¥çš„selï¼Œåˆ™é‡æ–°ç»è¿‡ cache_nextæ–¹æ³• å³å“ˆå¸Œå†²çªç®—æ³•ï¼Œé‡æ–°è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°æ–°çš„ä¸‹æ ‡ï¼Œå†å»å¯¹æ¯”è¿›è¡Œå­˜å‚¨ å…¶ä¸­æ¶‰åŠçš„ä¸¤ç§å“ˆå¸Œç®—æ³•ï¼Œå…¶æºç å¦‚ä¸‹ï¼š cache_hashï¼šå“ˆå¸Œç®—æ³• 1234static inline mask_t cache_hash(SEL sel, mask_t mask) &#123; return (mask_t)(uintptr_t)sel &amp; mask; // é€šè¿‡sel &amp; maskï¼ˆmask = cap -1ï¼‰&#125; cache_nextï¼šå“ˆå¸Œå†²çªç®—æ³• 123456789101112131415#if __arm__ || __x86_64__ || __i386__// objc_msgSend has few registers available.// Cache scan increments and wraps at special end-marking bucket.#define CACHE_END_MARKER 1static inline mask_t cache_next(mask_t i, mask_t mask) &#123; return (i+1) &amp; mask; //ï¼ˆå°†å½“å‰çš„å“ˆå¸Œä¸‹æ ‡ +1ï¼‰ &amp; maskï¼Œé‡æ–°è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ä¸‹æ ‡&#125;#elif __arm64__// objc_msgSend has lots of registers available.// Cache scan decrements. No end marker needed.#define CACHE_END_MARKER 0static inline mask_t cache_next(mask_t i, mask_t mask) &#123; return i ? i-1 : mask; //å¦‚æœiæ˜¯ç©ºï¼Œåˆ™ä¸ºmaskï¼Œmask = cap -1ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ i-1ï¼Œå‘å‰æ’å…¥sel-imp&#125; åˆ°æ­¤ï¼Œcache_tçš„åŸç†åŸºæœ¬åˆ†æå®Œæˆäº†ï¼Œç„¶åå‰æ–‡æåŠçš„å‡ ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨å°±æœ‰ç­”æ¡ˆäº† ç–‘é—®è§£ç­”1ã€_mask æ˜¯ä»€ä¹ˆï¼Ÿ _mask æ˜¯æŒ‡ æ©ç æ•°æ®ï¼Œç”¨äºåœ¨ å“ˆå¸Œç®—æ³•æˆ–è€…å“ˆå¸Œå†²çªç®—æ³• ä¸­ è®¡ç®—å“ˆå¸Œä¸‹æ ‡ï¼Œå…¶ä¸­mask ç­‰äº capacity - 1 2ã€_occupied æ˜¯ä»€ä¹ˆï¼Ÿ _occupied è¡¨ç¤ºå“ˆå¸Œè¡¨ä¸­ sel-imp çš„å ç”¨å¤§å° (å³å¯ä»¥ç†è§£ä¸ºåˆ†é…çš„å†…å­˜ä¸­å·²ç»å­˜å‚¨äº†sel-impçš„çš„ä¸ªæ•°) init ä¼šå¯¼è‡´occupiedå˜åŒ– å±æ€§èµ‹å€¼ï¼Œä¹Ÿä¼šéšå¼è°ƒç”¨ï¼Œå¯¼è‡´occupiedå˜åŒ– æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´occupiedå˜åŒ– 3ã€ä¸ºä»€ä¹ˆéšç€æ–¹æ³•è°ƒç”¨çš„å¢å¤šï¼Œå…¶æ‰“å°çš„ occupied å’Œ mask ä¼šå˜åŒ–ï¼Ÿ å› ä¸ºåœ¨ cache åˆå§‹åŒ–æ—¶ï¼Œåˆ†é…çš„ç©ºé—´æ˜¯ 4 ä¸ªï¼Œéšç€æ–¹æ³•è°ƒç”¨çš„å¢å¤šï¼Œå½“å­˜å‚¨çš„ sel-impä¸ªæ•°ï¼Œå³ newOccupied + CACHE_END_MARKERï¼ˆç­‰äº1ï¼‰çš„å’Œ è¶…è¿‡ æ€»å®¹é‡çš„3/4,ä¾‹å¦‚æœ‰ 4 ä¸ªæ—¶ï¼Œå½“occupiedç­‰äº2æ—¶ï¼Œå°±éœ€è¦å¯¹cacheçš„å†…å­˜è¿›è¡Œä¸¤å€æ‰©å®¹ 4ã€bucket æ•°æ®ä¸ºä»€ä¹ˆä¼šæœ‰ ä¸¢å¤±çš„æƒ…å†µï¼Ÿä¾‹å¦‚ 2-7ä¸­ï¼Œåªæœ‰say3ã€say4æ–¹æ³•æœ‰å‡½æ•°æŒ‡é’ˆï¼Ÿ åŸå› æ˜¯åœ¨ æ‰©å®¹ æ—¶ï¼Œæ˜¯å°† åŸæœ‰çš„å†…å­˜å…¨éƒ¨æ¸…é™¤ äº†ï¼Œå† é‡æ–°ç”³è¯· äº†å†…å­˜ å¯¼è‡´ çš„ 5ã€2-7ä¸­say3ã€say4çš„æ‰“å°é¡ºåºä¸ºä»€ä¹ˆæ˜¯say4å…ˆæ‰“å°ï¼Œsay3åæ‰“å°ï¼Œä¸”è¿˜ä¸æ˜¯æŒ¨ç€çš„ï¼Œå³ é¡ºåºæœ‰é—®é¢˜ï¼Ÿ å› ä¸ºsel-impçš„å­˜å‚¨æ˜¯é€šè¿‡å“ˆå¸Œç®—æ³•è®¡ç®—ä¸‹æ ‡çš„ï¼Œå…¶è®¡ç®—çš„ä¸‹æ ‡æœ‰å¯èƒ½å·²ç»å­˜å‚¨äº†selï¼Œæ‰€ä»¥ åˆéœ€è¦é€šè¿‡å“ˆå¸Œå†²çªç®—æ³•é‡æ–°è®¡ç®—å“ˆå¸Œä¸‹æ ‡ï¼Œæ‰€ä»¥å¯¼è‡´ ä¸‹æ ‡æ˜¯éšæœºçš„ï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„ 6ã€æ‰“å°çš„ cache_t ä¸­çš„ _occupied ä¸ºä»€ä¹ˆæ˜¯ä» 2 å¼€å§‹ï¼Ÿ è¿™é‡Œæ˜¯å› ä¸º ZJPerson é€šè¿‡allocåˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶ å¯¹å…¶ä¸¤ä¸ªå±æ€§èµ‹å€¼çš„åŸå› ï¼Œå±æ€§èµ‹å€¼ï¼Œä¼šéšå¼è°ƒç”¨setæ–¹æ³•ï¼Œsetæ–¹æ³• çš„è°ƒç”¨ä¹Ÿä¼šå¯¼è‡´ occupiedå˜åŒ–","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†12ï¼šcopy & strong & weakåº•å±‚åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†12ï¼šcopy-strong-weakåº•å±‚åˆ†æ","date":"2020-09-28T13:58:37.000Z","updated":"2022-04-22T07:34:45.000Z","comments":true,"path":"2020/09/28/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†12ï¼šcopy-strong-weakåº•å±‚åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/09/28/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8612%EF%BC%9Acopy-strong-weak%E5%BA%95%E5%B1%82%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€å±æ€§ é€šè¿‡ clang ç¼–è¯‘çš„ cpp æ–‡ä»¶ä¸­å¯ä»¥å‘ç° copy &amp; strong &amp; weak ä¿®é¥°ï¼Œ åœ¨ç¼–è¯‘çš„åº•å±‚ä»£ç ä¸­æ˜¯æœ‰åŒºåˆ«çš„ ã€è¡¥å……çŸ¥è¯†ã€‘ï¼šType Encoding &amp; Property Type Stringã€Type encodingã€‘ï¼šç¼–ç ç±»å‹ è·å– Type encoding æœ‰ä¸¤ç§æ–¹å¼ï¼š ã€æ–¹å¼ä¸€ã€‘ï¼šé€šè¿‡ ä»£ç  è·å– åœ¨ main.m ä¸­æ·»åŠ æ·»åŠ å‡½æ•°æ–¹æ³•ï¼š ZJLogï¼šæ‰“å°ç»“æœæè¿° 12345#ifdef DEBUG#define ZJLog(format, ...) printf(&quot;%s\\n&quot;, [[NSString stringWithFormat:format, ## __VA_ARGS__] UTF8String]);#else#define ZJLog(format, ...);#endif zjTypes å‡½æ•°ï¼šæ‰“å°å„ç§ç±»å‹ç¼–ç å‡½æ•° 123456789101112131415161718192021222324252627282930313233343536#pragma mark - å„ç§ç±»å‹ç¼–ç void zjTypes()&#123; NSLog(@&quot;char --&gt; %s&quot;,@encode(char)); NSLog(@&quot;int --&gt; %s&quot;,@encode(int)); NSLog(@&quot;short --&gt; %s&quot;,@encode(short)); NSLog(@&quot;long --&gt; %s&quot;,@encode(long)); NSLog(@&quot;long long --&gt; %s&quot;,@encode(long long)); NSLog(@&quot;unsigned char --&gt; %s&quot;,@encode(unsigned char)); NSLog(@&quot;unsigned int --&gt; %s&quot;,@encode(unsigned int)); NSLog(@&quot;unsigned short --&gt; %s&quot;,@encode(unsigned short)); NSLog(@&quot;unsigned long --&gt; %s&quot;,@encode(unsigned long long)); NSLog(@&quot;float --&gt; %s&quot;,@encode(float)); NSLog(@&quot;bool --&gt; %s&quot;,@encode(bool)); NSLog(@&quot;void --&gt; %s&quot;,@encode(void)); NSLog(@&quot;char * --&gt; %s&quot;,@encode(char *)); NSLog(@&quot;id --&gt; %s&quot;,@encode(id)); NSLog(@&quot;Class --&gt; %s&quot;,@encode(Class)); NSLog(@&quot;SEL --&gt; %s&quot;,@encode(SEL)); int array[] = &#123;1,2,3&#125;; NSLog(@&quot;int[] --&gt; %s&quot;,@encode(typeof(array))); typedef struct person&#123; char *name; int age; &#125;Person; NSLog(@&quot;struct --&gt; %s&quot;,@encode(Person)); typedef union union_type&#123; char *name; int a; &#125;Union; NSLog(@&quot;union --&gt; %s&quot;,@encode(Union)); int a = 2; int *b = &#123;&amp;a&#125;; NSLog(@&quot;int[] --&gt; %s&quot;,@encode(typeof(b)));&#125; æˆ‘ä»¬åœ¨ main.m å‡½æ•°ä¸­è°ƒç”¨ä¸Šé¢çš„å‡½æ•° 1234567int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; zjTypes(); NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125; æŸ¥çœ‹è¾“å‡ºçš„æ‰“å°ç»“æœï¼š 12345678910111213141516171819202020-10-17 14:45:23.857263+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] char --&gt; c2020-10-17 14:45:23.857725+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] int --&gt; i2020-10-17 14:45:23.857763+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] short --&gt; s2020-10-17 14:45:23.857818+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] long --&gt; q2020-10-17 14:45:23.857887+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] long long --&gt; q2020-10-17 14:45:23.857936+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] unsigned char --&gt; C2020-10-17 14:45:23.857965+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] unsigned int --&gt; I2020-10-17 14:45:23.857989+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] unsigned short --&gt; S2020-10-17 14:45:23.858012+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] unsigned long --&gt; Q2020-10-17 14:45:23.858065+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] float --&gt; f2020-10-17 14:45:23.858105+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] bool --&gt; B2020-10-17 14:45:23.858143+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] void --&gt; v2020-10-17 14:45:23.858172+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] char * --&gt; *2020-10-17 14:45:23.858196+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] id --&gt; @2020-10-17 14:45:23.858222+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] Class --&gt; #2020-10-17 14:45:23.862415+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] SEL --&gt; :2020-10-17 14:45:23.862459+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] int[] --&gt; [3i]2020-10-17 14:45:23.862516+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] struct --&gt; &#123;person=*i&#125;2020-10-17 14:45:23.862591+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] union --&gt; (union_type=*i)2020-10-17 14:45:23.862647+0800 001-ç±»çš„å±æ€§ä¸å˜é‡[24305:733568] int[] --&gt; ^i ã€æ–¹å¼äºŒã€‘ï¼šæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ Type Encoding-å®˜æ–¹æ–‡æ¡£ ã€ç»“è®ºã€‘ï¼š ç”±ä¸Šé¢çš„ç»“æœæˆ‘ä»¬å¯çŸ¥ï¼š æ¯ä¸€ä¸ª å˜é‡ç±»å‹ éƒ½å¯¹åº”ä¸€ä¸ª ç¼–ç ç±»å‹ï¼Œå¦‚ char -&gt; c ç­‰ç­‰ã€‚ ã€Property Type Stringã€‘ï¼šå±æ€§ç±»å‹ç¼–ç  å±æ€§ç±»å‹ç¼–ç å¯ä»¥é€šè¿‡ä¸‹é¢çš„å®˜æ–¹æ–‡æ¡£å­¦ä¹ ï¼š Property Type String-å®˜æ–¹æ–‡æ¡£ æˆ‘ä»¬å‰é¢å­¦ä¹ äº†ï¼Œå±æ€§ é€šè¿‡ clang ç¼–è¯‘ cpp åï¼Œä¼šç”Ÿæˆå¯¹åº”çš„ æˆå‘˜å˜é‡ã€æ–¹æ³•åˆ—è¡¨ ã€å±æ€§åˆ—è¡¨ï¼Œå¦‚ä¸‹: ã€æ–¹æ³•åˆ—è¡¨ã€‘ï¼š ã€å±æ€§åˆ—è¡¨ã€‘ï¼š ã€æˆå‘˜å˜é‡åˆ—è¡¨ã€‘ï¼š æ–¹æ³•åˆ—è¡¨ä¸­@16@0:8 åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ä»¥ @16@0:8 ä¸ºä¾‹: ç¬¬ä¸€ä¸ªå‚æ•°@ï¼šè¿”å›å€¼ ç¬¬äºŒä¸ªå‚æ•°16ï¼šå…±ç”¨16å­—èŠ‚ ç¬¬ä¸‰ä¸ªå‚æ•°@ï¼šç¬¬ä¸€ä¸ªå‚æ•° ç¬¬å››ä¸ªå‚æ•°0ï¼šä»0å¼€å§‹ï¼ˆ0~8ï¼‰ ç¬¬äº”ä¸ªå‚æ•° ï¼šå·ï¼šsel ä» 8 å·ä½ç½®å¼€å§‹ ç¬¬å…­ä¸ªå‚æ•°8ï¼šä»8å¼€å§‹ï¼ˆ8~16ï¼‰ å±æ€§åˆ—è¡¨ä¸­ &quot;name&quot;,&quot;T@\\&quot;NSString\\&quot;,&amp;,N,V_name&quot; æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ä»¥ &quot;name&quot;,&quot;T@\\&quot;NSString\\&quot;,&amp;,N,V_name&quot; ä¸ºä¾‹ï¼š T è¡¨ç¤º type @ è¡¨ç¤º å˜é‡ç±»å‹ C è¡¨ç¤º copy N è¡¨ç¤º nonatomic V è¡¨ç¤º variable å˜é‡ï¼Œå³ä¸‹åˆ’çº¿å˜é‡ _nickName copy &amp; strong &amp; weak åº•å±‚åˆ†æ åœ¨ ZJPerson ä¸­å£°æ˜ä¸¤ä¸ªå±æ€§ nickName å’Œ name ,åˆ†åˆ«ç”¨ copy å’Œ strong ä¿®é¥° 1234@interface ZJPerson : NSObject@property (nonatomic, copy) NSString *nickName;@property (nonatomic, strong) NSString *name;@end é€šè¿‡ clang å°† main.m æ–‡ä»¶ç¼–è¯‘æˆ main.cpp,ç„¶åå‘ç° copy å’Œ strong ä¿®é¥°çš„å±æ€§çš„ setæ–¹æ³• æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™é‡Œå°±æœ‰äº†ç–‘é—®ï¼Œä¸ºä»€ä¹ˆ copy ä¿®é¥°çš„ nickNameå±æ€§ ä½¿ç”¨äº† objc_setProperty ï¼Œè€Œ strong çš„æ²¡æœ‰ï¼Ÿ æƒ³è¦åˆ†æ copy å’Œ strong åœ¨åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Œéœ€è¦åˆ†æ LLVMæºç  ä¸‹è½½å¥½ LLVMæºç  åï¼Œåœ¨ LLVM ä¸­æœç´¢ objc_setProperty ï¼Œæ‰¾åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ getOptimizedSetPropertyFn æ–¹æ³•ä¸­ï¼š ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡º: å¦‚æœæ˜¯ atomic &amp; copy ä¿®é¥°ï¼Œname ä¸º objc_setProperty_atomic_copy å¦‚æœæ˜¯ atomic &amp; !copy ä¿®é¥°ï¼Œname ä¸º objc_setProperty_atomic å¦‚æœæ˜¯ nonatomic &amp; copy ä¿®é¥°ï¼Œname ä¸º objc_setProperty_nonatomic_copy å…¶ä»–å‰©ä½™çš„ç»„åˆï¼Œå³ nonatomicã€nonatomic &amp; strongã€nonatomic &amp; weak ç­‰ï¼Œname ä¸º objc_setProperty_nonatomic æˆ‘ä»¬å¯ä»¥é€šè¿‡ æ±‡ç¼–è°ƒè¯• æŸ¥çœ‹æœ€ç»ˆåˆ°åº•ä¼šæ‰§è¡Œå“ªä¸ªå‘½ä»¤ï¼š æˆ‘ä»¬å‘ç° ä¸ç®¡æ˜¯ copyä¿®é¥° è¿˜æ˜¯ strongä¿®é¥° è¿˜æ˜¯ weakä¿®é¥° çš„å±æ€§ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œ objc_storeStrong objc4æºç  ä¸­æœç´¢ objc_storeStrongï¼Œå¦‚ä¸‹ï¼š 1234567891011voidobjc_storeStrong(id *location, id obj)&#123; id prev = *location; if (obj == prev) &#123; return; &#125; objc_retain(obj); // retainæ–°å€¼ *location = obj; objc_release(prev); // releaseæ—§å€¼&#125; ä¸»è¦ä¹Ÿæ˜¯ retainæ–°å€¼ï¼Œreleaseæ—§å€¼ å›åˆ° LLVM æºç ä¸­æœç´¢ objc_storeStrongï¼Œæˆ‘ä»¬å‘ç°å…¶åº•å±‚è°ƒç”¨çš„æ˜¯ EmitARCStoreStrongCall ï¼Œå¦‚ä¸‹å›¾ï¼š LLVM ä¸­æœç´¢ EmitARCStoreStrongCall æ–¹æ³•ï¼Œåœ¨GenerateCopyHelperFunction æ–¹æ³•æœ‰è°ƒç”¨ï¼Œç„¶ååœ¨è¿™é‡Œå‘ç°äº† strong å’Œ weak çš„ä¸åŒå¤„ç†","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†11ï¼šç±» & isa åº•å±‚é¢è¯•é¢˜åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†11ï¼šç±» & isa åº•å±‚é¢è¯•é¢˜åˆ†æ","date":"2020-09-26T15:37:09.000Z","updated":"2022-04-22T07:02:37.000Z","comments":true,"path":"2020/09/26/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†11ï¼šç±» & isa åº•å±‚é¢è¯•é¢˜åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/09/26/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8611%EF%BC%9A%E7%B1%BB%20&%20isa%20%E5%BA%95%E5%B1%82%E9%9D%A2%E8%AF%95%E9%A2%98%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æœ¬æ–‡çš„é¢è¯•é¢˜ä¸»è¦æ¶‰åŠ isaèµ°ä½ &amp; ç»§æ‰¿å…³ç³» &amp; ç±»ç»“æ„ ç›¸å…³çš„é¢è¯•é¢˜ä»¥åŠé’ˆå¯¹é¢è¯•é¢˜çš„åˆ†æ ã€é¢è¯•é¢˜ã€‘ç±»å­˜åœ¨å‡ ä»½ï¼Ÿç”±äº ç±»çš„ä¿¡æ¯ åœ¨å†…å­˜ä¸­æ°¸è¿œ åªå­˜åœ¨ä¸€ä»½ï¼Œæ‰€ä»¥ ç±»å¯¹è±¡åªæœ‰ä¸€ä»½ ã€ç™¾åº¦é¢è¯•é¢˜ã€‘objc_object ä¸ å¯¹è±¡ çš„å…³ç³»ï¼Ÿ æ‰€æœ‰çš„ å¯¹è±¡ éƒ½æ˜¯ä»¥ objc_object ä¸ºæ¨¡æ¿ ç»§æ‰¿ è¿‡æ¥çš„ æ‰€æœ‰çš„ å¯¹è±¡ éƒ½æ˜¯ æ¥è‡ªNSObject(æ¥è‡ªäºOCç«¯)ï¼Œä½†æ˜¯çœŸæ­£åˆ° åº•å±‚ æ˜¯ä¸€ä¸ª objc_objectï¼ˆC/C++ï¼‰ ç»“æ„ä½“ ç±»å‹çš„ ã€æ€»ç»“ã€‘ï¼šobjc_object ä¸ å¯¹è±¡ çš„å…³ç³»æ˜¯ ç»§æ‰¿ å…³ç³» ã€é¢è¯•é¢˜ã€‘ä»€ä¹ˆæ˜¯ å±æ€§ &amp; æˆå‘˜å˜é‡ &amp; å®ä¾‹å˜é‡ ï¼Ÿ å±æ€§(property)ï¼šåœ¨ OC ä¸­æ˜¯é€šè¿‡ @property å¼€å¤´ å®šä¹‰ï¼Œä¸”æ˜¯ å¸¦ä¸‹åˆ’çº¿æˆå‘˜å˜é‡ + setter + getteræ–¹æ³• çš„å˜é‡ æˆå‘˜å˜é‡(ivar)ï¼šåœ¨ OC ç±»çš„ &#123;&#125; ä¸­å®šä¹‰çš„ï¼Œä¸” æ²¡æœ‰ä¸‹åˆ’çº¿çš„å˜é‡ å®ä¾‹å˜é‡ï¼šé€šè¿‡å½“å‰å¯¹è±¡ç±»å‹ï¼Œå…·å¤‡å®ä¾‹åŒ–çš„å˜é‡ï¼Œæ˜¯ä¸€ç§ ç‰¹æ®Šçš„æˆå‘˜å˜é‡ï¼Œä¾‹å¦‚ NSObjectã€UILabelã€UIButton ç­‰ ã€é¢è¯•é¢˜ã€‘å…ƒç±» ä¸­ä¸ºä»€ä¹ˆä¼šæœ‰ ç±»å¯¹è±¡ çš„ ç±»æ–¹æ³•ï¼Ÿåœ¨ä¸Šä¸€ç«  OCåº•å±‚åŸç†10ï¼šç±» &amp; ç±»ç»“æ„åˆ†æ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº† å®ä¾‹æ–¹æ³•å­˜å‚¨åœ¨ç±»ä¸­ï¼Œç±»æ–¹æ³•å­˜å‚¨åœ¨å…ƒç±»ä¸­ ä¸ºäº†æ¢ç´¢æˆ‘ä»¬çš„é¢è¯•é¢˜ç°è±¡ï¼Œå®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼Œæ¥æ¢ç´¢æ–¹æ³•çš„å½’å±é—®é¢˜ åœ¨ZJPersonä¸­å®šä¹‰ä¸€ä¸ªå®ä¾‹æ–¹æ³•å’Œä¸€ä¸ªç±»æ–¹æ³•ï¼Œå¹¶å®ç° 1234567891011121314@interface ZJPerson : NSObject- (void)sayHello;+ (void)sayHappy;@end@implementation ZJPerson- (void)sayHello&#123; NSLog(@&quot;ZJPerson say : Hello!!!&quot;);&#125;+ (void)sayHappy&#123; NSLog(@&quot;ZJPerson say : Happy!!!&quot;);&#125;@end åœ¨ main ä¸»å‡½æ•°ï¼Œè°ƒç”¨è‡ªå®šä¹‰çš„æ–¹æ³• 12345678910111213141516int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; ZJPerson * p = [ZJPerson alloc]; Class pClass = object_getClass(p); // è·å–ç±»çš„æ–¹æ³• zjObjc_copyMethodList(pClass); // è·å–ç±»å’Œå…ƒç±»çš„å®ä¾‹æ–¹æ³• zjInstanceMethod_classToMetaclass(pClass); // è·å–ç±»å’Œå…ƒç±»çš„ç±»æ–¹æ³• zjClassMethod_classToMetaclass(pClass); // è·å–ç±»å’Œå…ƒç±»çš„æ–¹æ³•å®ç° zjIMP_classToMetaclass(pClass); NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125; zjObjc_copyMethodList ï¼šç”¨äºè·å– ç±»çš„æ–¹æ³•åˆ—è¡¨ 12345678910111213// è·å–ç±»çš„æ–¹æ³•åˆ—è¡¨void zjObjc_copyMethodList(Class pClass)&#123; unsigned int count = 0; Method *methods = class_copyMethodList(pClass, &amp;count); for (unsigned int i=0; i &lt; count; i++) &#123; Method const method = methods[i]; //è·å–æ–¹æ³•å NSString *key = NSStringFromSelector(method_getName(method)); ZJLog(@&quot;Method, name: %@&quot;, key); &#125; free(methods);&#125; æŸ¥çœ‹ä¸€ä¸‹æ‰“å°ç»“æœ: 1Method, name: sayHello ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ‰“å°ç»“æœ: ã€zjObjc_copyMethodListå‡½æ•°ã€‘ è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯æ‰“å° ç±» ä¸­å­˜åœ¨çš„ æ–¹æ³•ï¼Œç”±å‰é¢æ‰€çŸ¥ï¼Œå®ä¾‹æ–¹æ³• å­˜å‚¨åœ¨ ç±»ä¸­ï¼Œå› æ­¤æ‰“å°ç»“æœåªæœ‰ Method, name: sayHello zjInstanceMethod_classToMetaclass ï¼šç”¨äºè·å– ç±»å’Œå…ƒç±» çš„ å®ä¾‹æ–¹æ³• 12345678910111213void zjInstanceMethod_classToMetaclass(Class pClass)&#123; const char *className = class_getName(pClass); Class metaClass = objc_getMetaClass(className); Method method1 = class_getInstanceMethod(pClass, @selector(sayHello)); Method method2 = class_getInstanceMethod(metaClass, @selector(sayHello)); Method method3 = class_getInstanceMethod(pClass, @selector(sayHappy)); Method method4 = class_getInstanceMethod(metaClass, @selector(sayHappy)); ZJLog(@&quot;%s - %p-%p-%p-%p&quot;,__func__,method1,method2,method3,method4);&#125; æŸ¥çœ‹ä¸€ä¸‹æ‰“å°ç»“æœ: 1zjInstanceMethod_classToMetaclass - 0x100003100-0x0-0x0-0x100003098 ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ‰“å°ç»“æœ: ã€zjInstanceMethod_classToMetaclasså‡½æ•°ã€‘:ç”¨äºè·å– ç±»å’Œå…ƒç±» çš„ ç±»æ–¹æ³• åœ¨åˆ†æå‰å…ˆäº†è§£ä¸€ä¸‹å‡½æ•° class_getInstanceMethod :ä½œç”¨æ˜¯è·å–å®ä¾‹æ–¹æ³•ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è§£é‡Š: å…¶å¤§è‡´å«ä¹‰å°±æ˜¯ï¼šå¦‚æœåœ¨ä¼ å…¥çš„ç±»æˆ–è€…ç±»çš„çˆ¶ç±»ä¸­æ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„å®ä¾‹æ–¹æ³•ï¼Œåˆ™è¿”å›NULL ä»ä¸Šé¢çš„ä»£ç å¯çŸ¥ä¼ å…¥çš„ pClass æ˜¯ ZJPerson ç±»ï¼ŒmetaClass æ˜¯ ZJPersonå…ƒç±»,å‡½æ•°ä¸­4ä¸ªæ‰“å°ç»“æœåˆ†åˆ«æ˜¯ï¼š method1çš„åœ°å€ï¼š0x100003100 ä¼ å…¥çš„ pClass æ˜¯ ZJPersonï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯sayHelloå®ä¾‹æ–¹æ³•ï¼Œç”±äºZJPersonä¸­æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x100003100 method2çš„åœ°å€ï¼š0x0 ä¼ å…¥çš„ metaClass æ˜¯ ZJPersonå…ƒç±»ï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯sayHelloå®ä¾‹æ–¹æ³•ï¼Œç”±äºZJPersonä¸­æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x0 method3çš„åœ°å€ï¼š0x0 ä¼ å…¥çš„ pClass æ˜¯ ZJPersonï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯sayHappyå®ä¾‹æ–¹æ³•ï¼Œç”±äºZJPersonä¸­æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x0 method4çš„åœ°å€ï¼š0x100003098 ä¼ å…¥çš„ metaClass æ˜¯ ZJPersonå…ƒç±»ï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯sayHappyå®ä¾‹æ–¹æ³•ï¼Œç”±äºç±»ZJPersonä¸­ç±»æ–¹æ³•sayHappysæ˜¯ä»¥ å®ä¾‹æ–¹æ³• å­˜å‚¨åœ¨ å…ƒç±»ä¸­çš„ï¼Œå› æ­¤å…ƒç±»ZJPerson ä¸­æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x100003098 zjClassMethod_classToMetaclasså‡½æ•°ï¼šè·å–ç±»æˆ–ç±»çš„çˆ¶ç±»ä¸­çš„ç±»æ–¹æ³• 12345678910111213141516// ç±»å’Œå…ƒç±»-ç±»æ–¹æ³•void zjClassMethod_classToMetaclass(Class pClass)&#123; const char *className = class_getName(pClass); Class metaClass = objc_getMetaClass(className); Method method1 = class_getClassMethod(pClass, @selector(sayHello)); Method method2 = class_getClassMethod(metaClass, @selector(sayHello)); Method method3 = class_getClassMethod(pClass, @selector(sayHappy)); // å…ƒç±» ä¸ºä»€ä¹ˆæœ‰ sayHappy ç±»æ–¹æ³• 0 1 // Method method4 = class_getClassMethod(metaClass, @selector(sayHappy)); ZJLog(@&quot;%s-%p-%p-%p-%p&quot;,__func__,method1,method2,method3,method4);&#125; æŸ¥çœ‹ä¸€ä¸‹æ‰“å°ç»“æœ: 1zjClassMethod_classToMetaclass-0x0-0x0-0x100003098-0x100003098 ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ‰“å°ç»“æœ: class_getClassMethodï¼šç”¨äºè·å– ç±»æˆ–ç±»çš„çˆ¶ç±» çš„ ç±»æ–¹æ³•ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è§£é‡Š: å…¶å¤§è‡´å«ä¹‰å°±æ˜¯ï¼šå¦‚æœåœ¨ä¼ å…¥çš„ç±»æˆ–è€…ç±»çš„çˆ¶ç±»ä¸­æ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„ç±»æ–¹æ³•ï¼Œåˆ™è¿”å›NULL ä»ä¸Šé¢çš„ä»£ç å¯çŸ¥ä¼ å…¥çš„ pClass æ˜¯ ZJPerson ç±»ï¼ŒmetaClass æ˜¯ ZJPersonå…ƒç±»,å‡½æ•°ä¸­4ä¸ªæ‰“å°ç»“æœåˆ†åˆ«æ˜¯ï¼š method1 çš„åœ°å€ï¼š0x0 ä¼ å…¥çš„ pClass æ˜¯ ZJPersonï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯sayHelloç±»æ–¹æ³•ï¼Œç”±äºZJPersonä¸­æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x0 method2 çš„åœ°å€ï¼š0x0 ä¼ å…¥çš„ metaClass æ˜¯ ZJPersonå…ƒç±»ï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯sayHelloç±»æ–¹æ³•ï¼Œç”±äº ZJPersonå…ƒç±»ä¸­æ²¡æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x0 method3 çš„åœ°å€ï¼š0x100003098 ä¼ å…¥çš„ pClass æ˜¯ ZJPersonï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯ sayHappyç±»æ–¹æ³•ï¼Œç”±äºZJPersonä¸­æœ‰è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x100003098 method4çš„åœ°å€ï¼š0x100003098 ä¼ å…¥çš„ metaClass æ˜¯ ZJPersonå…ƒç±»ï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯ sayHappyç±»æ–¹æ³•ï¼Œç”±äºç±»ZJPersonä¸­ ç±»æ–¹æ³•sayHappys æ˜¯ä»¥ å®ä¾‹æ–¹æ³• å­˜å‚¨åœ¨ å…ƒç±»ä¸­çš„ï¼Œå› æ­¤ å…ƒç±»ZJPerson ä¸­æœ‰è¯¥ å®ä¾‹æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿”å› ç±»æ–¹æ³•sayHappy çš„åœ°å€å‘¢ï¼Ÿ ã€é—®é¢˜ã€‘ï¼šZJPersonå…ƒç±» ä¸ºä»€ä¹ˆä¼šæœ‰ ç±»æ–¹æ³•sayHappyï¼Ÿ æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æºç : 123456789101112131415//è·å–ç±»æ–¹æ³•Method class_getClassMethod(Class cls, SEL sel)&#123; if (!cls || !sel) return nil; return class_getInstanceMethod(cls-&gt;getMeta(), sel);&#125;â¬‡ï¸//è·å–å…ƒç±» // NOT identical to this-&gt;ISA when this is a metaclass åˆ¤æ–­æ˜¯å¦æ˜¯å…ƒç±»ï¼Œæ˜¯å…ƒç±»å°±ç›´æ¥è¿”å›ï¼Œåä¹‹ï¼Œç»§ç»­æ‰¾isaæŒ‡å‘Class getMeta() &#123; if (isMetaClass()) return (Class)this; else return this-&gt;ISA();&#125; ç”±æºç å¯çŸ¥ï¼šclass_getClassMethod çš„å®ç°æ˜¯è·å–ç±»çš„ç±»æ–¹æ³•ï¼Œå…¶æœ¬è´¨å°±æ˜¯ è·å–å…ƒç±»çš„å®ä¾‹æ–¹æ³•ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šèµ°åˆ° class_getInstanceMethodï¼Œä½†æ˜¯åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨ getMeta æºç ä¸­ï¼Œå¦‚æœåˆ¤æ–­å‡º cls æ˜¯ å…ƒç±»ï¼Œé‚£ä¹ˆå°± ä¸ä¼š å†ç»§ç»­å¾€ä¸‹ é€’å½’æŸ¥æ‰¾ï¼Œä¼šç›´æ¥è¿”å› this ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº† é˜²æ­¢å…ƒç±»çš„æ— é™é€’å½’æŸ¥æ‰¾ ã€ç»“è®ºã€‘ç”±æºç å¯çŸ¥ï¼š è·å–å…ƒç±»çš„ç±»æ–¹æ³•ï¼Œæœ¬è´¨æ˜¯ è·å–å…ƒç±»çš„å®ä¾‹æ–¹æ³• æ–¹æ³•method4ï¼šæ˜¯ä¼šè¿”å›åœ°å€çš„ zjIMP_classToMetaclass å‡½æ•°ï¼šç”¨äºè·å– ç±»å’Œå…ƒç±» ä¸­çš„æ–¹æ³•å®ç° 12345678910111213141516void zjIMP_classToMetaclass(Class pClass)&#123; const char *className = class_getName(pClass); Class metaClass = objc_getMetaClass(className); // - (void)sayHello; // + (void)sayHappy; IMP imp1 = class_getMethodImplementation(pClass, @selector(sayHello)); IMP imp2 = class_getMethodImplementation(metaClass, @selector(sayHello)); IMP imp3 = class_getMethodImplementation(pClass, @selector(sayHappy)); IMP imp4 = class_getMethodImplementation(metaClass, @selector(sayHappy)); NSLog(@&quot;%p-%p-%p-%p&quot;,imp1,imp2,imp3,imp4); NSLog(@&quot;%s&quot;,__func__);&#125; æŸ¥çœ‹ä¸€ä¸‹æ‰“å°ç»“æœ: 10x1000017c0-0x7fff72080580-0x7fff72080580-0x1000017f0 ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹æ‰“å°ç»“æœ: class_getMethodImplementation ï¼šç”¨äºè·å– ç±»æˆ–ç±»çš„çˆ¶ç±» çš„ æ–¹æ³•å®ç°ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è§£é‡Š: å…¶å¤§è‡´å«ä¹‰å°±æ˜¯ï¼šè¯¥å‡½æ•°åœ¨å‘ç±»å®ä¾‹å‘é€æ¶ˆæ¯æ—¶ä¼šè¢«è°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘ æ–¹æ³•å®ç°å‡½æ•°çš„æŒ‡é’ˆã€‚è¿™ä¸ªå‡½æ•°ä¼šæ¯” method_getImplementation(class_getInstanceMethod(cls, name)) æ›´å¿«ã€‚è¿”å›çš„å‡½æ•°æŒ‡é’ˆå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘ runtimeå†…éƒ¨çš„å‡½æ•°ï¼Œè€Œä¸ä¸€å®šæ˜¯æ–¹æ³•çš„å®é™…å®ç°ã€‚å¦‚æœç±»å®ä¾‹æ— æ³•å“åº” selector ï¼Œåˆ™è¿”å›çš„å‡½æ•°æŒ‡é’ˆå°†æ˜¯è¿è¡Œæ—¶ æ¶ˆæ¯è½¬å‘æœºåˆ¶ çš„ä¸€éƒ¨åˆ† ä¸‹é¢æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•çš„æºç æ¥å°è¯ä¸Šé¢çš„è¿™ä¸ªè¯´æ³•ï¼Œ 12345678910111213141516IMP class_getMethodImplementation(Class cls, SEL sel)&#123; IMP imp; if (!cls || !sel) return nil; //æŸ¥æ‰¾æ–¹æ³•å®ç° imp = lookUpImpOrNil(nil, sel, cls, LOOKUP_INITIALIZE | LOOKUP_RESOLVER); //å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œæ¶ˆæ¯è½¬å‘ if (!imp) &#123; return _objc_msgForward; &#125; return imp;&#125; ä»ä¸Šé¢çš„ä»£ç å¯çŸ¥ä¼ å…¥çš„ pClass æ˜¯ ZJPerson ç±»ï¼ŒmetaClass æ˜¯ ZJPersonå…ƒç±»,å‡½æ•°ä¸­4ä¸ªæ‰“å°ç»“æœåˆ†åˆ«æ˜¯ï¼š imp1çš„åœ°å€ï¼š0x1000017c0 ä¼ å…¥çš„ pClass æ˜¯ ZJPersonï¼ŒæŸ¥æ‰¾çš„æ˜¯sayHelloå‡½æ•°æŒ‡é’ˆï¼Œç”±äºZJPersonä¸­æœ‰è¯¥å‡½æ•°æŒ‡é’ˆï¼Œæ‰€ä»¥è¿”å›çš„åœ°å€æ˜¯ 0x1000017c0 imp2çš„åœ°å€ï¼š0x7fff72080580 ä¼ å…¥çš„ metaClass æ˜¯ ZJPersonå…ƒç±»ï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯ sayHelloç±»æ–¹æ³•ï¼Œæ ¹æ® ç±»æ–¹æ³•å­˜å‚¨åœ¨å…ƒç±»ä¸­ å¯çŸ¥ï¼ŒsayHelloæ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå¹¶ä¸å­˜å‚¨åœ¨å…ƒç±»ä¸­ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»»ä½•å®ç°ï¼Œæ‰€ä»¥è¿›è¡Œäº† æ¶ˆæ¯è½¬å‘ imp3çš„åœ°å€ï¼š0x7fff72080580 ä¼ å…¥çš„ pClass æ˜¯ ZJPersonï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯ sayHappyç±»æ–¹æ³•ï¼ŒsayHappy æ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œå¹¶ä¸å­˜å‚¨åœ¨ç±»ä¸­ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»»ä½•å®ç°ï¼Œæ‰€ä»¥è¿›è¡Œäº† æ¶ˆæ¯è½¬å‘ imp4çš„åœ°å€ï¼š0x1000017f0 ä¼ å…¥çš„ metaClass æ˜¯ ZJPersonå…ƒç±»ï¼ŒæŸ¥æ‰¾çš„æ–¹æ³•æ˜¯ sayHappyç±»æ–¹æ³•ï¼Œæ ¹æ® ç±»æ–¹æ³•å­˜å‚¨åœ¨å…ƒç±»ä¸­ï¼Œå¯ä»¥åœ¨å…ƒç±»ä¸­æŸ¥æ‰¾åˆ°sayHappy çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ª impå‡½æ•°æŒ‡é’ˆçš„åœ°å€ ã€æ€»ç»“ã€‘ class_getInstanceMethodï¼šè·å– å®ä¾‹æ–¹æ³•ï¼Œå¦‚æœæŒ‡å®šçš„ ç±»æˆ–å…¶çˆ¶ç±» ä¸åŒ…å«å¸¦æœ‰æŒ‡å®šé€‰æ‹©å™¨çš„å®ä¾‹æ–¹æ³•ï¼Œåˆ™ä¸ºNULL class_getClassMethodï¼šè·å– ç±»æ–¹æ³•ï¼Œå¦‚æœæŒ‡å®šçš„ç±»æˆ–å…¶çˆ¶ç±»ä¸åŒ…å«å…·æœ‰æŒ‡å®šé€‰æ‹©å™¨çš„ç±»æ–¹æ³•ï¼Œåˆ™ä¸ºNULLã€‚ class_getMethodImplementationï¼šè·å–æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œå¦‚æœæœªæŸ¥æ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œ æ¶ˆæ¯è½¬å‘ ã€é¢è¯•é¢˜ã€‘iskindOfClass &amp; isMemberOfClass çš„ç†è§£ iskindOfClass &amp; isMemberOfClass ç±»æ–¹æ³•è°ƒç”¨ 12345BOOL re1 = [(id)[NSObject class] isKindOfClass:[NSObject class]]; BOOL re2 = [(id)[NSObject class] isMemberOfClass:[NSObject class]];BOOL re3 = [(id)[ZJPerson class] isKindOfClass:[ZJPerson class]];BOOL re4 = [(id)[ZJPerson class] isMemberOfClass:[ZJPerson class]];NSLog(@&quot; re1 :%hhd\\n re2 :%hhd\\n re3 :%hhd\\n re4 :%hhd\\n&quot;,re1,re2,re3,re4); æŸ¥çœ‹æ‰“å°ç»“æœ: 12342020-09-16 23:45:31.732090+0800 KCObjc[41895:1261834] re1 :1 re2 :0 re3 :0 re4 :0 iskindOfClass &amp; isMemberOfClass å®ä¾‹æ–¹æ³•è°ƒç”¨ 123456BOOL re5 = [(id)[NSObject alloc] isKindOfClass:[NSObject class]]; BOOL re6 = [(id)[NSObject alloc] isMemberOfClass:[NSObject class]]; BOOL re7 = [(id)[ZJPerson alloc] isKindOfClass:[ZJPerson class]]; BOOL re8 = [(id)[ZJPerson alloc] isMemberOfClass:[ZJPerson class]]; NSLog(@&quot; re5 :%hhd\\n re6 :%hhd\\n re7 :%hhd\\n re8 :%hhd\\n&quot;,re5,re6,re7,re8); æŸ¥çœ‹æ‰“å°ç»“æœï¼š 123452020-09-16 23:45:31.733480+0800 KCObjc[41895:1261834] re5 :1 re6 :1 re7 :1 re8 :1Program ended with exit code: 0 ã€é—®é¢˜ã€‘ï¼šé‚£ä¹ˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ objc4 æºç æ¥åˆ†æä¸€ä¸‹ï¼š è¦æƒ³åˆ†ææºç ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥ç†è§£ isa æµç¨‹å›¾ï¼Œå¦‚ä¸‹ï¼š æ³¨ï¼šNSObjectç±» å’Œ NSObjectæ ¹å…ƒç±» ä¸ç›¸ç­‰ æ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥ä¸€ä¸‹ isKindOfClass è°ƒç”¨çš„æºç : æŸ¥çœ‹ ç±» è°ƒç”¨çš„æºç ï¼š 123456+ (BOOL)isKindOfClass:(Class)cls &#123; for (Class tcls = self-&gt;ISA(); tcls; tcls = tcls-&gt;superclass) &#123; if (tcls == cls) return YES; &#125; return NO;&#125; æŸ¥çœ‹ å®ä¾‹å¯¹è±¡ è°ƒç”¨çš„æºç : 123456- (BOOL)isKindOfClass:(Class)cls &#123; for (Class tcls = [self class]; tcls; tcls = tcls-&gt;superclass) &#123; if (tcls == cls) return YES; &#125; return NO;&#125; æˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹ isMemberOfClass è°ƒç”¨çš„æºç ï¼š æŸ¥çœ‹ ç±» è°ƒç”¨çš„æºç ï¼š 123+ (BOOL)isMemberOfClass:(Class)cls &#123; return self-&gt;ISA() == cls;&#125; æŸ¥çœ‹ å®ä¾‹å¯¹è±¡ è°ƒç”¨çš„æºç : 1234- (BOOL)isMemberOfClass:(Class)cls &#123; return [self class] == cls;&#125; ã€æºç åˆ†ææ€»ç»“ã€‘ isKindOfClass ç±»æ–¹æ³•ï¼šå…ƒç±»ï¼ˆisaï¼‰ --&gt; æ ¹å…ƒç±»ï¼ˆçˆ¶ç±»ï¼‰ --&gt; æ ¹ç±»ï¼ˆçˆ¶ç±»ï¼‰ --&gt; nilï¼ˆçˆ¶ç±»ï¼‰ ä¸ ä¼ å…¥ç±»çš„å¯¹æ¯” å®ä¾‹æ–¹æ³•ï¼šå¯¹è±¡çš„ç±» --&gt; çˆ¶ç±» --&gt; æ ¹ç±» --&gt; nil ä¸ ä¼ å…¥ç±»çš„å¯¹æ¯” isMemberOfClass ç±»æ–¹æ³•ï¼š ç±»çš„å…ƒç±» ä¸ ä¼ å…¥ç±» å¯¹æ¯” å®ä¾‹æ–¹æ³•ï¼šå¯¹è±¡çš„çˆ¶ç±» ä¸ ä¼ å…¥ç±» å¯¹æ¯” ç”±ä¸Šé¢çš„æºç æˆ‘ä»¬çŸ¥é“äº†å…·ä½“è°ƒç”¨çš„æºç ï¼Œç”±æ­¤æˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸ºä»€ä¹ˆæ‰“å°1000 1111è¿™ä¸ªç»“æœ: ã€ä½¿ç”¨ç±»æ–¹æ³•ç»“æœåˆ†æã€‘ re1ï¼š1ï¼Œæ˜¯ NSObject å’Œ NSObject çš„å¯¹æ¯”ï¼Œä½¿ç”¨ +isKindOfClass NSObjectï¼ˆä¼ å…¥ç±»ï¼Œå³ æ ¹ç±»ï¼‰vs NSObjectçš„å…ƒç±»ï¼ˆå³ æ ¹å…ƒç±»ï¼‰ ç›¸æ¯” â€“ ä¸ç›¸ç­‰ NSObjectï¼ˆä¼ å…¥ç±»ï¼Œå³ æ ¹ç±»ï¼‰vs æ ¹å…ƒç±»çš„çˆ¶ç±»ï¼ˆå³ æ ¹ç±»ï¼‰ç›¸æ¯” â€“ ç›¸ç­‰ [NSObject class] isKindOfClass:[NSObject class]] å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š ç”±ä¸Šé¢çš„åˆ†æå›¾å¯çŸ¥ï¼šæ‰“å°ç»“æœä¸º 1 re2ï¼š0ï¼Œæ˜¯ NSObject å’Œ NSObject çš„å¯¹æ¯”ï¼Œä½¿ç”¨ +isMemberOfClass NSObject ï¼ˆä¼ å…¥ç±»ï¼Œå³ æ ¹ç±»ï¼‰ vs NSObjectçš„å…ƒç±»ï¼ˆå³ æ ¹å…ƒç±»ï¼‰å¯¹æ¯” â€“ ä¸ç›¸ç­‰ [NSObject class] isMemberOfClass:[NSObject class] å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š re3ï¼š0ï¼Œæ˜¯ ZJPerson ä¸ ZJPerson çš„å¯¹æ¯”ï¼Œä½¿ç”¨ +isKindOfClass ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs ZJPersonçš„å…ƒç±»ï¼ˆå³ å…ƒç±»ZJPersonï¼‰ å¯¹æ¯” â€“ ä¸ç›¸ç­‰ ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs å…ƒç±»ZJPersonçš„çˆ¶ç±»ï¼ˆå³ æ ¹å…ƒç±»ï¼‰ å¯¹æ¯” â€“ ä¸ç›¸ç­‰ ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs æ ¹å…ƒç±»çš„çˆ¶ç±»ï¼ˆå³ æ ¹ç±»ï¼‰ å¯¹æ¯” â€“ ä¸ç›¸ç­‰ ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs æ ¹ç±»çš„çˆ¶ç±»ï¼ˆå³ nilï¼‰ å¯¹æ¯” â€“ ä¸ç›¸ç­‰ [ZJPerson class] isKindOfClass:[ZJPerson class] å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š re4ï¼š0ï¼Œæ˜¯ ZJPerson ä¸ ZJPerson çš„å¯¹æ¯”ï¼Œä½¿ç”¨ +isMemberOfClass ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs å…ƒç±» å¯¹æ¯” â€“ ä¸ç›¸ç­‰ [ZJPerson class] isMemberOfClass:[ZJPerson class] å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š ã€ä½¿ç”¨å®ä¾‹æ–¹æ³•ç»“æœåˆ†æã€‘ re5ï¼š1ï¼Œæ˜¯ NSObjectå¯¹è±¡ å’Œ NSObject çš„å¯¹æ¯”ï¼Œä½¿ç”¨ -isKindOfClass NSObjectï¼ˆä¼ å…¥ æ ¹ç±»ï¼‰vs å¯¹è±¡çš„ isaï¼ˆå³ NSObjectæ ¹ç±»ï¼‰ å¯¹æ¯” â€“ ç›¸ç­‰ [NSObject alloc] isKindOfClass:[NSObject class] å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š re6ï¼š1ï¼Œæ˜¯ NSObjectå¯¹è±¡ å’Œ NSObject çš„å¯¹æ¯”ï¼Œä½¿ç”¨ -isMemberOfClass NSObjectï¼ˆä¼ å…¥ æ ¹ç±»ï¼‰vs å¯¹è±¡çš„ç±»ï¼ˆå³ NSObjectæ ¹ç±»ï¼‰ å¯¹æ¯” â€“ ç›¸ç­‰ [NSObject alloc] isMemberOfClass:[NSObject class]å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š re7ï¼š1ï¼Œæ˜¯ ZJPersonå¯¹è±¡ å’Œ ZJPerson çš„å¯¹æ¯”ï¼Œä½¿ç”¨ -isKindOfClass ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs å¯¹è±¡çš„ isa ï¼ˆå³ ZJPersonï¼‰ å¯¹æ¯” â€“ ç›¸ç­‰ [ZJPerson alloc] isKindOfClass:[ZJPerson class]å†…éƒ¨è°ƒç”¨åˆ†æå›¾ï¼š re8ï¼š1ï¼Œæ˜¯ ZJPersonå¯¹è±¡ å’Œ ZJPerson çš„å¯¹æ¯”ï¼Œä½¿ç”¨ -isMemberOfClass ZJPersonï¼ˆä¼ å…¥ ç±»ï¼‰vs å¯¹è±¡çš„ç±»ï¼ˆå³ ZJPersonï¼‰ å¯¹æ¯” â€“ ç›¸ç­‰ [ZJPerson alloc] isMemberOfClass:[ZJPerson class]","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†10ï¼šç±» & ç±»ç»“æ„åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†10ï¼šç±» & ç±»ç»“æ„åˆ†æ","date":"2020-09-24T13:58:37.000Z","updated":"2022-04-22T07:42:49.000Z","comments":true,"path":"2020/09/24/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†10ï¼šç±» & ç±»ç»“æ„åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/09/24/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8610%EF%BC%9A%E7%B1%BB%20&%20%E7%B1%BB%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€æœ¬ç« ä¸»è¦çš„ç›®çš„æ˜¯åˆ†æ ç±» å’Œ ç±»ç»“æ„ objc_class å’Œ objc_objectä¸ºä»€ä¹ˆ å¯¹è±¡ å’Œ ç±» éƒ½æœ‰ isaæŒ‡é’ˆï¼Ÿ åœ¨ iOS-OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢ ä¸­ï¼Œä½¿ç”¨ clang ç¼–è¯‘è¿‡ main.m æ–‡ä»¶ï¼Œä»ç¼–è¯‘åçš„ main.cpp æ–‡ä»¶ä¸­,æˆ‘ä»¬åˆ†æäº† å¯¹è±¡ çš„ æœ¬è´¨ æ˜¯ ç»“æ„ä½“ï¼Œå¦‚ä¸‹: NSObject çš„åº•å±‚ç¼–è¯‘æ˜¯ struct objc_object ç»“æ„ä½“ 123456789typedef struct objc_object NSObject;struct NSObject_IMPL &#123; Class isa;&#125;;typedef struct objc_class *Class;struct objc_object &#123; Class _Nonnull isa __attribute__((deprecated));&#125;; ç”±ç¼–è¯‘åçš„ c++ æºç å¯çŸ¥ï¼š NSObject åº•å±‚è¢«ç¼–è¯‘æˆç»“æ„ä½“ struct objc_object ç±»å‹ï¼Œå› æ­¤ å¯¹è±¡ çš„æœ¬è´¨æ˜¯ ç»“æ„ä½“ isaæŒ‡é’ˆ æ˜¯ Class ç±»å‹çš„ï¼Œæ˜¯ç”± struct objc_calss ç»“æ„ä½“å®šä¹‰çš„ç±»å‹ï¼Œæ‰€æœ‰çš„ Class éƒ½æ˜¯ä»¥ objc_class ä¸ºæ¨¡æ¿åˆ›å»ºçš„ objc_object ç»“æ„ä½“å†…éƒ¨æœ‰ objc_class è¿™ä¸ªç»“æ„ä½“ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº† ã€é—®é¢˜ã€‘objec_class å’Œ objc_object æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ objc4æºç  æ‰¾åˆ° objc_class å’Œ objc_object çš„å®šä¹‰ï¼Œæ¥åˆ†æä¸€ä¸‹ä¸¤è€…ä¹‹é—´çš„å…³ç³»ï¼š åœ¨objc4æºç ä¸­æœç´¢ objc_classï¼Œå…¶æºç å®šä¹‰å¦‚ä¸‹: ä¸€ä¸ªä½äº runtime.h æ–‡ä»¶ä¸­ï¼Œå·²ç»è¢«åºŸå¼ƒäº† ä¸€ä¸ªä½äº objc-runtime-new.h æ–‡ä»¶ä¸­ï¼Œæ˜¯å¯ç”¨çš„ åœ¨ objc4 æºç ä¸­æœç´¢ objc_objectï¼Œå…¶æºç å®šä¹‰å¦‚ä¸‹ï¼š ä½äº objc.h æ–‡ä»¶ä¸­ é€šè¿‡ä¸Šè¿°æŸ¥æ‰¾æºç å’Œå…¶å®šä¹‰ï¼Œå¯æ€»ç»“å‡ºä»¥ä¸‹å‡ ç‚¹å†…å®¹ï¼š ç»“æ„ä½“ç±»å‹ objc_class ç»§æ‰¿è‡ª objc_object ç±»å‹ï¼Œå…¶ä¸­ objc_object ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸”æœ‰ä¸€ä¸ª isa å±æ€§ï¼Œæ‰€ä»¥ objc_class ä¹Ÿæ‹¥æœ‰äº† isa å±æ€§ mian.cpp åº•å±‚ç¼–è¯‘æ–‡ä»¶ä¸­ï¼ŒNSObject ä¸­çš„ isa åœ¨åº•å±‚æ˜¯ç”± Class å®šä¹‰çš„ï¼Œå…¶ä¸­ class çš„åº•å±‚ç¼–ç æ¥è‡ª objc_class ç±»å‹ï¼Œæ‰€ä»¥ NSObject ä¹Ÿæ‹¥æœ‰äº† isaå±æ€§ NSObject æ˜¯ä¸€ä¸ªç±»ï¼Œç”¨å®ƒåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹å¯¹è±¡ objcï¼Œobjc æ»¡è¶³ objc_object çš„ç‰¹æ€§ï¼ˆå³æœ‰isaå±æ€§ï¼‰ï¼Œä¸»è¦æ˜¯å› ä¸º isa æ˜¯ç”± NSObject ä»objc_class ç»§æ‰¿è¿‡æ¥çš„ï¼Œè€Œ objc_class ç»§æ‰¿è‡ª objc_objectï¼Œobjc_object æœ‰isaå±æ€§ã€‚æ‰€ä»¥ å¯¹è±¡ éƒ½ æœ‰ ä¸€ä¸ª isaï¼Œisaè¡¨ç¤ºæŒ‡å‘ï¼Œæ¥è‡ªäºå½“å‰çš„ objc_object objc_objectï¼ˆç»“æ„ä½“ï¼‰ æ˜¯ å½“å‰çš„ æ ¹å¯¹è±¡ï¼Œæ‰€æœ‰çš„ å¯¹è±¡ éƒ½æœ‰è¿™æ ·ä¸€ä¸ªç‰¹æ€§ objc_objectï¼Œå³æ‹¥æœ‰ isaå±æ€§ ã€ç™¾åº¦é¢è¯•é¢˜ã€‘objc_object ä¸ å¯¹è±¡çš„å…³ç³»? æ‰€æœ‰çš„ å¯¹è±¡ éƒ½æ˜¯ æ¥è‡ªNSObject(æ¥è‡ªäºOCç«¯)ï¼Œä½†æ˜¯çœŸæ­£åˆ°åº•å±‚æ˜¯ä¸€ä¸ª objc_objectï¼ˆC/c++ï¼‰ ç»“æ„ä½“ ç±»å‹çš„ æ‰€æœ‰çš„ å¯¹è±¡ éƒ½æ˜¯ ä»¥objc_object æ¨¡æ¿ ç»§æ‰¿è¿‡æ¥çš„ ã€æ€»ç»“ã€‘ï¼š æ‰€æœ‰çš„ å¯¹è±¡ + ç±» + å…ƒç±» éƒ½æœ‰ isa æ‰€æœ‰çš„ å¯¹è±¡ éƒ½æ˜¯ç”± objc_objectç»§æ‰¿ æ¥çš„ ç®€å•æ¦‚æ‹¬å°±æ˜¯ ä¸‡ç‰©çš†å¯¹è±¡ï¼Œä¸‡ç‰©çš†æ¥æºäº objc_objectï¼Œæœ‰ä»¥ä¸‹ä¸¤ç‚¹ç»“è®ºï¼š æ‰€æœ‰ä»¥ objc_object ä¸ºæ¨¡æ¿ åˆ›å»ºçš„ å¯¹è±¡ï¼Œéƒ½æœ‰ isaå±æ€§ æ‰€æœ‰ä»¥ objc_class ä¸ºæ¨¡æ¿ï¼Œåˆ›å»ºçš„ ç±»ï¼Œéƒ½æœ‰ isaå±æ€§ åœ¨ç»“æ„å±‚é¢å¯ä»¥é€šä¿—çš„ç†è§£ä¸º ä¸Šå±‚OC ä¸ åº•å±‚ çš„å¯¹æ¥ï¼š åº•å±‚æ˜¯é€šè¿‡ ç»“æ„ä½“ å®šä¹‰çš„ æ¨¡æ¿ï¼Œä¾‹å¦‚ objc_classã€objc_object ä¸Šå±‚ æ˜¯é€šè¿‡åº•å±‚çš„æ¨¡æ¿åˆ›å»ºçš„ ä¸€äº›ç±»å‹ï¼Œä¾‹å¦‚ZJPerson è¡¥å……çŸ¥è¯†-å†…å­˜åç§»åœ¨åˆ†æ ç±»ä¿¡æ¯ ä¸­å­˜å‚¨å“ªäº›ä¿¡æ¯ä¹‹å‰ï¼Œéœ€è¦å…ˆ äº†è§£å†…å­˜åç§»ï¼Œå› ä¸ºåˆ†æ ç±»ä¿¡æ¯ éœ€è¦ç”¨åˆ°å†…å­˜åç§» 1ã€ã€æ™®é€šæŒ‡é’ˆã€‘ å®šä¹‰ä¸€ä¸ªæ–¹æ³• 12345678910// æ™®é€šæŒ‡é’ˆvoid testOffset1()&#123; // a/b : å˜é‡ 10 ï¼š å€¼ int a = 10; int b = 10; // a/b : æ‰“å°å¾—å€¼ &amp;a/&amp;b : å–açš„åœ°å€æŒ‡é’ˆ NSLog(@&quot;%d---%p&quot;,a,&amp;a); NSLog(@&quot;%d---%p&quot;,b,&amp;b);&#125; åœ¨mian.mè°ƒç”¨ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœ 122020-10-04 13:41:07.378260+0800 KCObjc[23781:838866] 10---0x7ffeefbff4a82020-10-04 13:41:07.378948+0800 KCObjc[23781:838866] 10---0x7ffeefbff4ac ç”±ä¸Šè¿°çš„æ‰“å°ç»“æœå¯çŸ¥ï¼š aã€b éƒ½æ˜¯ å¸¸é‡å‹å˜é‡ï¼Œaã€b çš„ åœ°å€æŒ‡é’ˆä¸ä¸€æ ·ï¼Œåˆ†åˆ«æŒ‡å‘ å€¼10ï¼Œåœ¨å†…å­˜ä¸­ 10 æ˜¯é€šè¿‡ å€¼æ‹·è´ï¼Œåˆ†åˆ«èµ‹å€¼ç»™ aã€b a çš„åœ°å€æ˜¯ 0x7ffeefbff4a8ï¼Œb çš„åœ°å€æ˜¯ 0x7ffeefbff4acï¼Œä»–ä»¬ç›¸å·® 4å­—èŠ‚ï¼Œè¿™æ˜¯ç”± a/b æœ¬èº«ç±»å‹(Intå 4ä¸ªå­—èŠ‚) å†³å®šçš„ å…¶åœ°å€æŒ‡é’ˆæŒ‡å‘å¦‚å›¾æ‰€ç¤ºï¼š 2ã€ã€å¯¹è±¡æŒ‡é’ˆã€‘ å®šä¹‰ä¸€ä¸ªæ–¹æ³• 12345678// å¯¹è±¡æŒ‡é’ˆvoid testOffset2()&#123; // p1ï¼šæŒ‡é’ˆ ZJPerson * p1 = [ZJPerson alloc]; ZJPerson * p2 = [ZJPerson alloc]; NSLog(@&quot;%@---%p&quot;,p1,&amp;p1); NSLog(@&quot;%@---%p&quot;,p2,&amp;p2);&#125; åœ¨mian.mè°ƒç”¨ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœ 122020-10-04 14:14:59.341733+0800 KCObjc[24079:859357] &lt;ZJPerson: 0x101035830&gt;---0x7ffeefbff4a02020-10-04 14:14:59.341901+0800 KCObjc[24079:859357] &lt;ZJPerson: 0x101035980&gt;---0x7ffeefbff4a8 ç”±ä¸Šè¿°çš„æ‰“å°ç»“æœå¯çŸ¥ï¼š p1ã€p2 æ˜¯ ä¸€çº§åœ°å€æŒ‡é’ˆï¼Œp1ã€p2 æ˜¯æŒ‡å‘ [ZJPerson alloc] ç”³è¯·å†…å­˜ç©ºé—´ &amp;p1ã€&amp;p2 æ˜¯ äºŒçº§æŒ‡é’ˆï¼Œ &amp;p1ã€&amp;p2 æŒ‡å‘ p1ã€p2 å¯¹è±¡çš„ ä¸€çº§åœ°å€æŒ‡é’ˆ å…¶åœ°å€æŒ‡é’ˆæŒ‡å‘å¦‚å›¾æ‰€ç¤ºï¼š 3ã€ã€æ•°ç»„æŒ‡é’ˆã€‘ å®šä¹‰ä¸€ä¸ªæ–¹æ³• 12345678// æ•°ç»„æŒ‡é’ˆvoid testOffset3()&#123; int c[4] = &#123;1,2,3,4&#125;; int *d = c; NSLog(@&quot;%p -- %p - %p&quot;, &amp;c, &amp;c[0], &amp;c[1]); NSLog(@&quot;%p -- %p - %p&quot;, d, d+1, d+2);&#125; åœ¨mian.mè°ƒç”¨ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœ 122020-10-04 14:38:14.720430+0800 KCObjc[24171:872712] 0x7ffeefbff490 -- 0x7ffeefbff490 - 0x7ffeefbff4942020-10-04 14:38:14.720522+0800 KCObjc[24171:872712] 0x7ffeefbff490 -- 0x7ffeefbff494 - 0x7ffeefbff498 ç”±ä¸Šè¿°çš„æ‰“å°ç»“æœå¯çŸ¥ï¼š &amp;c å’Œ &amp;c[0] éƒ½æ˜¯å– é¦–åœ°å€ï¼Œå³æ•°ç»„åç­‰äºé¦–åœ°å€ &amp;c ä¸ &amp;c[1] ç›¸å·® 4ä¸ªå­—èŠ‚ï¼Œåœ°å€ä¹‹é—´ç›¸å·®çš„å­—èŠ‚æ•°ï¼Œä¸»è¦ å–å†³äº å­˜å‚¨çš„ æ•°æ®ç±»å‹ *d ä»£è¡¨å– c çš„åœ°å€ï¼Œå¯ä»¥é€šè¿‡ lldb è°ƒè¯• p *(d+1)ã€*(d+2) è·å– åœ°å€ æ‰€å¯¹åº”çš„å€¼ 2ã€4 å¯ä»¥é€šè¿‡ é¦–åœ°å€+åç§»é‡ å–å‡ºæ•°ç»„ä¸­çš„å…¶ä»–å…ƒç´ ï¼Œå…¶ä¸­åç§»é‡ æ˜¯ æ•°ç»„çš„ ä¸‹æ ‡ï¼Œå†…å­˜ä¸­é¦–åœ°å€å®é™…ç§»åŠ¨çš„ å­—èŠ‚æ•° ç­‰äº åç§»é‡ * æ•°æ®ç±»å‹å­—èŠ‚æ•° å…¶åœ°å€æŒ‡é’ˆæŒ‡å‘å¦‚å›¾æ‰€ç¤ºï¼š æ¢ç´¢ç±»ä¿¡æ¯ä¸­éƒ½æœ‰å“ªäº›å†…å®¹ç”±å‰æ–‡å¯çŸ¥ï¼Œæ‰€æœ‰çš„ ç±» éƒ½æ˜¯ä»¥ objc_class æ¨¡æ¿åˆ›å»ºçš„ï¼Œé€šè¿‡ objc4 æºç å¯çŸ¥ï¼Œobjc_class ä¸­åŒ…å«è®¸å¤šå±æ€§ï¼Œå¦‚ä¸‹ï¼š 12345678910111213struct objc_class : objc_object &#123; // Class ISA; // ç»§æ‰¿è‡ªobjc_object çš„isaæŒ‡é’ˆ Class superclass; // Class ç±»å‹çš„ superclass cache_t cache; // formerly cache pointer and vtable class_data_bits_t bits; // class_rw_t * plus custom rr/alloc flags // è·å–data class_rw_t *data() const &#123; return bits.data(); &#125; //...æ­¤å¤„çœç•¥è®¸å¤šæ–¹æ³•&#125; ã€è¿™äº›å±æ€§çš„å®šä¹‰ã€‘ï¼š isa å±æ€§ï¼šç»§æ‰¿è‡ª objc_object çš„isaï¼Œå  8 å­—èŠ‚ superclass å±æ€§ï¼šClass ç±»å‹ï¼ŒClassæ˜¯ç”± objc_object å®šä¹‰çš„ï¼Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå  8 å­—èŠ‚ cache å±æ€§ï¼šç®€å•ä»ç±»å‹ class_data_bits_t ç›®å‰æ— æ³•å¾—çŸ¥ï¼Œè€Œclass_data_bits_t æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹ï¼Œç»“æ„ä½“çš„ å†…å­˜å¤§å° éœ€è¦æ ¹æ® å†…éƒ¨çš„å±æ€§ æ¥ç¡®å®šï¼Œè€Œ ç»“æ„ä½“æŒ‡é’ˆæ‰æ˜¯8å­—èŠ‚ bitså±æ€§ï¼šåªæœ‰ é¦–åœ°å€ ç»è¿‡ä¸Šé¢ 3ä¸ªå±æ€§ çš„ å†…å­˜å¤§å°æ€»å’Œ çš„ å¹³ç§»ï¼Œæ‰èƒ½è·å–åˆ° bits æˆ‘ä»¬çŸ¥é“äº† objc_class ä¸­ å­˜å‚¨ äº† ç±» çš„ ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚ä½•å»éªŒè¯å‘¢? ã€éªŒè¯æ–¹æ³•ã€‘lldb è°ƒè¯•éªŒè¯ï¼š è‡ªå®šä¹‰ä¸€ä¸ªZJPersonç±»ï¼Œç»§æ‰¿è‡ªNSObject 1234@interface ZJPerson : NSObject@end@implementation ZJPerson@end åœ¨ main.m ä¸­åˆå§‹åŒ– ZJPerson ç±»å’Œ NSObject ç±» 12345678910int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // insert code here... NSObject * obj = [NSObject alloc]; ZJPerson * p = [ZJPerson alloc]; NSLog(@&quot;Hello, World! %@ - %@&quot;,obj,p); &#125; return 0;&#125; ä¸‹æ–­ç‚¹åˆ° NSObject... è¡Œï¼Œé€šè¿‡ lldb è°ƒè¯•ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š è®¡ç®—cache_tçš„å†…å­˜å¤§å°ç”±ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“äº† cache_t å†…å­˜å¤§å° å’Œ å†…éƒ¨å±æ€§ æœ‰å…³ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›å…¥ objc4-781æ–°ç‰ˆæœ¬ å†…éƒ¨æºç å»åˆ†æ è¿›å…¥ cache ç±» cache_t çš„å®šä¹‰ï¼ˆåªè´´å‡ºäº†ç»“æ„ä½“ä¸­ éstatic ä¿®é¥°çš„ å±æ€§ï¼Œä¸»è¦æ˜¯å› ä¸º staticç±»å‹ çš„å±æ€§ ä¸å­˜åœ¨ç»“æ„ä½“ çš„å†…å­˜ä¸­ï¼‰ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªå±æ€§ï¼š 1234567891011121314151617181920212223242526struct cache_t &#123;#if CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_OUTLINED // æ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆç±»å‹ï¼Œå 8å­—èŠ‚ explicit_atomic&lt;struct bucket_t *&gt; _buckets; // æ˜¯mask_t ç±»å‹ï¼Œè€Œ mask_t æ˜¯ unsigned int çš„åˆ«åï¼Œå 4å­—èŠ‚ explicit_atomic&lt;mask_t&gt; _mask;#elif CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_HIGH_16 ...æ­¤å¤„çœç•¥ #elif CACHE_MASK_STORAGE == CACHE_MASK_STORAGE_LOW_4 ...æ­¤å¤„çœç•¥ #else#error Unknown cache mask storage type.#endif #if __LP64__ // å†…éƒ¨æ˜¯ unsigned short ç±»å‹çš„ 2å­—èŠ‚ uint16_t _flags; // 2#endif // å†…éƒ¨æ˜¯ unsigned short ç±»å‹çš„ 2å­—èŠ‚ uint16_t _occupied; // 2 &#125; è®¡ç®— cache_t å†…éƒ¨å±æ€§çš„å¤§å°ï¼Œæœ€åçš„å†…å­˜å¤§å°æ€»å’Œéƒ½æ˜¯ 16 å­—èŠ‚ _buckets ç±»å‹æ˜¯ struct bucket_t *ï¼Œæ˜¯ç»“æ„ä½“æŒ‡é’ˆç±»å‹ï¼Œå 8å­—èŠ‚ mask æ˜¯ mask_t ç±»å‹ï¼Œè€Œ mask_t æ˜¯ unsigned int çš„ç±»å‹ï¼Œå 4å­—èŠ‚ _flags æ˜¯ uint16_t ç±»å‹ï¼Œuint16_tæ˜¯ unsigned short çš„ç±»å‹ï¼Œå  2ä¸ªå­—èŠ‚ _occupied æ˜¯ uint16_t ç±»å‹ï¼Œuint16_tæ˜¯ unsigned short çš„ç±»å‹ï¼Œå  2ä¸ªå­—èŠ‚ æ€»ç»“ï¼šæ‰€ä»¥æœ€åè®¡ç®—å‡º cache_t ç±»çš„å†…å­˜å¤§å° = 8 + 4 + 2 + 2 = 16å­—èŠ‚ è·å–bitsç”±ä¸Šè¿°è®¡ç®— Classç±»å‹ ISA æ˜¯ 8å­—èŠ‚ã€Class superclass æ˜¯ 8 å­—èŠ‚ã€cache_t cache æ˜¯ 16å­—èŠ‚; å¯çŸ¥ï¼Œæƒ³è¦è·å– bits çš„ä¸­çš„å†…å®¹ï¼Œåªéœ€é€šè¿‡ ç±»çš„ é¦–åœ°å€å¹³ç§» 32å­—èŠ‚ï¼ˆ8 + 8 + 16ï¼‰ å³å¯ ã€éªŒè¯ã€‘ï¼šé€šè¿‡lldbå‘½ä»¤è°ƒè¯• è‡ªå®šä¹‰ä¸¤ä¸ªç±» ZJPerson å’Œç»§æ‰¿è‡ªZJPersonçš„ ZJStudent ç±»ï¼š 1234567891011121314151617@interface ZJPerson : NSObject// åå­—@property (nonatomic,copy)NSString * name;// æ–¹æ³•- (void)test;@end@implementation ZJPerson// æ–¹æ³•- (void)test&#123; NSLog(@&quot;æ¥äº†!&quot;);&#125;@end@interface ZJStudent : ZJPerson@end@implementation ZJStudent@end main.mä¸­å®šä¹‰ä¸¤ä¸ªç±» 1234ZJPerson * person = [ZJPerson alloc];ZJStudent * student = [ZJStudent alloc];// class_data_bits_tNSLog(@&quot;hello world :%@ %@&quot;,person,student); ä¸‹æ–­ç‚¹åˆ° NSLogï¼Œlldb å‘½ä»¤è°ƒè¯• bits æµç¨‹å¦‚ä¸‹: ç”±è°ƒè¯•ç»“æœå¯çŸ¥: é€šè¿‡ p/x ZJPerson.class è·ç±»çš„ä¿¡æ¯ï¼Œå³ é¦–åœ°å€ ä¿¡æ¯ é€šè¿‡ x/4gx 0x0000000100002188 æ‹¿åˆ° é¦–åœ°å€ 0x100002188ï¼Œç»è¿‡ 32ä½å¹³ç§» å¾—åˆ° bits åœ°å€ 0x1000021a8 é€šè¿‡ p (class_data_bits_t *)0x1000021a8 è·å– bits é€šè¿‡ p $1-&gt;data() è·å– class_rw_t å¦‚æœ class_data_bits_t * æ˜¯ * å·ï¼Œè¯´æ˜æ˜¯å¯¹è±¡ï¼Œè®¿é—®å¯¹è±¡ç”¨ -&gt; å¦‚æœ class_data_bits_t æ˜¯ ç»“æ„ä½“ï¼Œç”¨ . å· é€šè¿‡ p *$2 æ‰“å° bits ä¸­ class_rw_t å†…éƒ¨ä¿¡æ¯ï¼ŒfirstSubclass = ZJStudent,è¡¨ç¤ºç¬¬ä¸€ä¸ªç»§æ‰¿å­ç±» ZJStudent class_rw_té€šè¿‡æŸ¥çœ‹ class_rw_t å®šä¹‰çš„æºç å‘ç°ï¼Œç»“æ„ä½“ä¸­æœ‰æä¾›ç›¸åº”çš„æ–¹æ³•å»è·å– å±æ€§åˆ—è¡¨ã€æ–¹æ³•åˆ—è¡¨ ç­‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å±æ€§åˆ—è¡¨ï¼ˆproperty_listï¼‰ã€å‡†å¤‡å·¥ä½œã€‘ï¼šåœ¨ZJPersonä¸­å¢åŠ ä¸€ä¸ª å±æ€§ å’Œä¸€ä¸ª æˆå‘˜å˜é‡ 12345678@interface ZJPerson : NSObject&#123; NSString * sex; // æ€§åˆ«&#125;// åå­—@property (nonatomic,copy)NSString * name;@end@implementation ZJPerson ã€æ¢ç´¢ã€‘ ç”±ä¸Šå›¾å¯çŸ¥ properties æ˜¯ property_array_t ç±»å‹çš„ï¼Œå…¶å†…éƒ¨æºç å¦‚ä¸‹ï¼š æˆ‘ä»¬é€šè¿‡ lldb è°ƒè¯•å±æ€§åˆ—è¡¨ï¼Œå¦‚ä¸‹: ç”±lldbè°ƒè¯•å¯çŸ¥: p $3.properties() å‘½ä»¤ä¸­çš„ propertoes æ–¹æ³•æ˜¯ç”± class_rw_t æä¾›çš„,æ–¹æ³•ä¸­è¿”å›çš„å®é™…ç±»å‹ä¸º property_array_t ç”±äº list çš„ç±»å‹æ˜¯ property_list_t ï¼Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥é€šè¿‡ p *$4 è·å–å†…å­˜ä¸­çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿè¯æ˜ bits ä¸­å­˜å‚¨äº† property_listï¼Œå³å±æ€§åˆ—è¡¨ p $6.get(0)ï¼Œè·å–ZJPersonä¸­çš„ç¬¬ä¸€ä¸ªå±æ€§ name p $6.get(1)ï¼Œæƒ³è¦è·å– ZJPerson ä¸­çš„æˆå‘˜å˜é‡ sexï¼Œ å‘ç°ä¼šæŠ¥é”™ï¼Œæç¤ºæ•°ç»„è¶Šç•Œäº†ï¼Œè¯´æ˜ property_list ä¸­åªæœ‰ ä¸€ä¸ªå±æ€§ name ã€é—®é¢˜ã€‘æ¢ç´¢æˆå‘˜å˜é‡çš„å­˜å‚¨ ç”±æ­¤å¯å¾—å‡º property_list ä¸­åªæœ‰ å±æ€§ï¼Œæ²¡æœ‰ æˆå‘˜å˜é‡ ï¼Œå±æ€§ä¸æˆå‘˜å˜é‡çš„åŒºåˆ«å°±æ˜¯æœ‰æ²¡æœ‰setã€getæ–¹æ³•ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æ˜¯å±æ€§ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ˜¯æˆå‘˜å˜é‡ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆå‘˜å˜é‡ å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§æƒ…å†µï¼Ÿè¯·ç§»è‡³æ–‡æœ«çš„åˆ†æä¸æ¢ç´¢ æ–¹æ³•åˆ—è¡¨ï¼ˆmethods_listï¼‰ã€å‡†å¤‡å·¥ä½œã€‘ åœ¨ZJPersonä¸­å¢åŠ ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå¯¹è±¡æ–¹æ³•å’Œä¸€ä¸ªç±»æ–¹æ³• 123456789101112@interface ZJPerson : NSObject- (void)sayHello;+ (void)sayBye;@end@implementation ZJPerson- (void)sayHello&#123; NSLog(@&quot;hello&quot;);&#125;+ (void)sayBye&#123; NSLog(@&quot;bye&quot;);&#125;@end ã€å¼€å§‹æ¢ç´¢ã€‘é€šè¿‡ lldb è°ƒè¯•æ¥è·å–æ–¹æ³•åˆ—è¡¨ï¼Œæ­¥éª¤å¦‚å›¾æ‰€ç¤ºï¼š ç”±lldbè°ƒè¯•å¯çŸ¥: ç³»ç»Ÿåœ¨ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨å¸®ä½ ç”Ÿæˆ é€šè¿‡ p $4.methods() è·å¾—å…·ä½“çš„æ–¹æ³•åˆ—è¡¨çš„listç»“æ„ï¼Œå…¶ä¸­ methods ä¹Ÿæ˜¯class_rw_t æä¾›çš„æ–¹æ³• é€šè¿‡ p *$6. æ‰“å°çš„ count = 4 å¯çŸ¥ï¼Œå­˜å‚¨äº† 4 ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ syaHello æ˜¯ è‡ªå·± å£°æ˜çš„æ–¹æ³•ï¼Œcxx_destructã€nameã€setName: æ˜¯ ç³»ç»Ÿ ç”Ÿæˆçš„æ–¹æ³• å¯ä»¥é€šè¿‡p $7.get(i)å†…å­˜åç§» çš„æ–¹å¼è·å–å•ä¸ªæ–¹æ³•,i çš„èŒƒå›´æ˜¯ 0-3 å¦‚æœåœ¨æ‰“å° p $7.get(4)ï¼Œè·å–ç¬¬äº”ä¸ªæ–¹æ³•ï¼Œä¹Ÿä¼šæŠ¥é”™ï¼Œæç¤º æ•°ç»„è¶Šç•Œ è¡¥å……çŸ¥è¯†-å±æ€§ã€æˆå‘˜å˜é‡ã€å®ä¾‹å˜é‡æˆ‘ä»¬é€šå¸¸éƒ½çŸ¥é“ @property æ˜¯ å±æ€§ çš„æ„æ€ï¼Œä½†æ˜¯ä»€ä¹ˆæ˜¯ æˆå‘˜å˜é‡ å’Œ å®ä¾‹å˜é‡ å‘¢ï¼Ÿæˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹ï¼š 1ã€é¦–å…ˆæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªç±» ZJPersonï¼Œæ”¾åœ¨ main.m ä¸­ï¼š 1234567891011121314151617181920// æˆå‘˜å˜é‡ vs å±æ€§@interface ZJPerson : NSObject&#123; NSString *hobby; NSObject *objc;&#125;@property (nonatomic, copy) NSString *nickName;@property (nonatomic, strong) NSString *name;@end@implementation ZJPerson@endint main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // å±æ€§&amp;æˆå‘˜å˜é‡&amp;å®ä¾‹å˜é‡ ZJPerson * P = [ZJPerson alloc]; NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125; 2ã€æˆ‘ä»¬é€šè¿‡ clang ç¼–è¯‘ä¸€ä¸‹è¿™ä¸ª main.m ä¸º main.cpp ,æ¥æŸ¥çœ‹ C çš„åº•å±‚å®ç°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š 1ï¼‰æˆ‘ä»¬æ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°ä½ è¦ç¼–è¯‘æ–‡ä»¶çš„æ–‡ä»¶å¤¹ä¸‹ï¼š 1mac@192 ~ % cd /Users/mac/Desktop/é€»è¾‘æ•™è‚²/LG-OCåº•å±‚å¤§å¸ˆç­ä¸Šè¯¾èµ„æ–™/20200914-å¤§å¸ˆç­ç¬¬5å¤©-ç±»åŸç†åˆ†æ-èµ„æ–™/01--è¯¾å ‚ä»£ç /001-ç±»çš„å±æ€§ä¸å˜é‡/001-ç±»çš„å±æ€§ä¸å˜é‡ 2ï¼‰è¾“å…¥ç¼–è¯‘å‘½ä»¤clang -x objective-c -rewrite-objc -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk xxxx.mç¼–è¯‘ä½ çš„ç›®æ ‡æ–‡ä»¶ï¼š 1mac@192 001-ç±»çš„å±æ€§ä¸å˜é‡ % clang -x objective-c -rewrite-objc -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk main.m 3ï¼‰ç„¶åä½ ç›®å½•ä¸‹å°±ä¼šé‡å†™ä¸€ä¸ª cpp æ–‡ä»¶ï¼Œå†…å®¹æ¯”è¾ƒå¤šä½ å¯ä»¥æœç´¢å…³é”®ç±» ZJPerson å¯¹ç…§æŸ¥çœ‹ï¼š 3.æˆ‘ä»¬æ‰“å¼€ main.cpp æŸ¥æ‰¾ ZJPerson æ¥æŸ¥çœ‹ä¸€ä¸‹ï¼š hobby å’Œ objc æ²¡æœ‰ä¸‹åˆ’çº¿ _ï¼Œæ˜¯ æˆå‘˜å˜é‡ nickName å’Œ name æœ‰ä¸‹åˆ’çº¿ _ï¼Œæ˜¯ å±æ€§ ç»§ç»­å¾€ä¸‹çœ‹ï¼š hobby å’Œ objc æ²¡æœ‰æ²¡æœ‰ç”Ÿæˆ setter å’Œ getter æ–¹æ³•ï¼Œæ˜¯ æˆå‘˜å˜é‡ nickName å’Œ name æœ‰ç”Ÿæˆ setter å’Œ getter æ–¹æ³•ï¼Œæ˜¯ å±æ€§ 4ã€ç”±ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯æˆå‘˜å˜é‡å’Œå±æ€§ï¼Œé‚£ä¹ˆå®ä¾‹å˜é‡å‘¢ï¼Ÿ hobby ä¸èƒ½è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ˜¯ æˆå‘˜å˜é‡ objc èƒ½è¿›è¡Œå®ä¾‹åŒ–ï¼Œæ˜¯ å®ä¾‹å˜é‡ ï¼Œä¹Ÿå¯ä»¥ç§°ç‰¹æ®Šçš„æˆå‘˜å˜é‡,å¦‚: objc = [NSObject alloc] ; 5ã€æˆ‘ä»¬ç”¨ä¸€ä¸‹å›¾è¡¨ç¤º æˆå‘˜å˜é‡&amp;å®ä¾‹å˜é‡&amp;å±æ€§ çš„å…³ç³»ï¼š 6ã€ç”±ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¾—çŸ¥äº†ï¼Œä»€ä¹ˆæ˜¯ å±æ€§ã€æˆå‘˜å˜é‡å’Œå®ä¾‹å˜é‡ ç”±ä¸Šé¢çš„æ¢ç´¢æˆ‘ä»¬äº†è§£äº†ä»€ä¹ˆæ˜¯ å±æ€§ å’Œ æˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥éªŒè¯ä¸€ä¸‹å±æ€§åˆ—è¡¨å’Œæˆå‘˜å˜é‡åˆ—è¡¨æ˜¯ä¸æ˜¯æ­£ç¡®çš„ï¼Œå¦‚ä¸‹ï¼š zjObjc_copyIvar_copyProperies å‡½æ•°ï¼šæ‰“å° å˜é‡ å’Œ å±æ€§ å 123456789101112131415161718192021222324void zjObjc_copyIvar_copyProperies(Class pClass)&#123; unsigned int count = 0; Ivar *ivars = class_copyIvarList(pClass, &amp;count); for (unsigned int i=0; i &lt; count; i++) &#123; Ivar const ivar = ivars[i]; // è·å–å®ä¾‹å˜é‡å const char*cName = ivar_getName(ivar); NSString *ivarName = [NSString stringWithUTF8String:cName]; ZJLog(@&quot;class_copyIvarList:%@&quot;,ivarName); &#125; free(ivars); unsigned int pCount = 0; objc_property_t *properties = class_copyPropertyList(pClass, &amp;pCount); for (unsigned int i=0; i &lt; pCount; i++) &#123; objc_property_t const property = properties[i]; // è·å–å±æ€§å NSString *propertyName = [NSString stringWithUTF8String:property_getName(property)]; // è·å–å±æ€§å€¼ ZJLog(@&quot;class_copyProperiesList:%@&quot;,propertyName); &#125; free(properties);&#125; åœ¨main.mä¸­è°ƒç”¨ 123456789101112int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; //å±æ€§&amp;æˆå‘˜å˜é‡&amp;å®ä¾‹å˜é‡ ZJPerson * P = [ZJPerson alloc]; // æ‰“å° Class pClass = object_getClass(P); zjTypes(); zjObjc_copyIvar_copyProperies(pClass); NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125; æŸ¥çœ‹æ‰“å°ç»“æœï¼š 123456class_copyIvarList:hobbyclass_copyIvarList:objcclass_copyIvarList:_nickNameclass_copyIvarList:_nameclass_copyProperiesList:nickNameclass_copyProperiesList:name ç”±ç»“æœå¯çŸ¥ï¼š æˆå‘˜å˜é‡åˆ—è¡¨æœ‰4ä¸ªï¼šhobbyã€objcã€_nickNameã€_name ã€‚ å±æ€§åˆ—è¡¨æœ‰2ä¸ªï¼š nickNameã€nameã€‚ æˆå‘˜å˜é‡çš„å­˜å‚¨ï¼ˆivarsï¼‰ç”±ä¸Šé¢çš„å±æ€§åˆ—è¡¨åˆ†æå¯å¾—å‡º property_list ä¸­åªæœ‰ å±æ€§ï¼Œæ²¡æœ‰ æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆå‘˜å˜é‡ å­˜å‚¨åœ¨å“ªé‡Œ ï¼Ÿä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§æƒ…å†µï¼Ÿ é€šè¿‡ objc4-781æœ€æ–°æºç  æŸ¥çœ‹ objc_class ä¸­ bitså±æ€§ ä¸­å­˜å‚¨æ•°æ®çš„ç±» class_rw_t çš„ç»“æ„å‘ç°ï¼Œé™¤äº† methodsã€propertiesã€protocols æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ª ro æ–¹æ³•ï¼Œå…¶è¿”å›ç±»å‹æ˜¯ class_ro_t ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: ç‚¹å‡»è¿›å»æŸ¥çœ‹ class_ro_t å®šä¹‰ï¼Œå¦‚ä¸‹å›¾ï¼š å‘ç°å…¶ä¸­æœ‰ä¸€ä¸ª ivarså±æ€§ ï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹çŒœæµ‹ï¼šæ˜¯å¦æˆå‘˜å˜é‡å°±å­˜å‚¨åœ¨è¿™ä¸ª ivar_list_t ç±»å‹çš„ ivars å±æ€§ä¸­å‘¢ï¼Ÿ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ lldb çš„è°ƒè¯•æ¥éªŒè¯ä¸€ä¸‹ï¼š ç”±ä¸Šå›¾lldè°ƒè¯•å¯çŸ¥ï¼š é€šè¿‡ p *$7 æ‰“å°æˆå‘˜å˜é‡åˆ—è¡¨ï¼Œcount = 2ï¼Œæˆ‘ä»¬çŸ¥é“ class_ro_t ä¸­åŒ…å«ä¸¤ä¸ª æˆå‘˜å˜é‡ sex å’Œ name é€šè¿‡ bits --&gt; data() --&gt;ro() --&gt; ivars è·å– æˆå‘˜å˜é‡ åˆ—è¡¨ï¼Œé™¤äº†åŒ…æ‹¬æˆå‘˜å˜é‡ï¼Œè¿˜åŒ…æ‹¬ å±æ€§ å®šä¹‰çš„ æˆå‘˜å˜é‡ é€šè¿‡ @property å®šä¹‰çš„å±æ€§ï¼Œä¹Ÿä¼šå­˜å‚¨åœ¨ bits å±æ€§ä¸­ï¼Œé€šè¿‡ bits --&gt; data() --&gt; properties() --&gt; list è·å–å±æ€§åˆ—è¡¨ï¼Œå…¶ä¸­åªå­˜å‚¨ å±æ€§ ç±»æ–¹æ³•çš„å­˜å‚¨æˆ‘ä»¬ç”±å‰æ–‡æ¢ç´¢æ–¹æ³•åˆ—è¡¨å¯çŸ¥ï¼Œåœ¨ method_list ä¸­ æ²¡æœ‰ç±»æ–¹æ³•ï¼Œåªæœ‰å®ä¾‹æ–¹æ³•ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç±»æ–¹æ³•å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§æƒ…å†µï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸‹ æˆ‘ä»¬åœ¨ OCåº•å±‚åŸç†09ï¼šisaèµ°å‘&amp;ç»§æ‰¿åˆ†æ ä¸­ï¼Œæ›¾æåŠäº† å…ƒç±»ï¼Œç±»å¯¹è±¡çš„ isa æŒ‡å‘å°±æ˜¯ å…ƒç±»ï¼Œå…ƒç±»æ˜¯ç”¨æ¥ å­˜å‚¨ç±» çš„ ç›¸å…³ä¿¡æ¯ çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çŒœæµ‹ï¼šæ˜¯å¦ ç±»æ–¹æ³• æ˜¯å¦å­˜å‚¨åœ¨ æºç±»bitsæ–¹æ³• ä¸­å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ lldb å‘½ä»¤æ¥éªŒè¯æˆ‘ä»¬çš„çŒœæµ‹ã€‚ä¸‹å›¾æ˜¯ lldb å‘½ä»¤çš„è°ƒè¯•æµç¨‹ï¼š ç”±ä¸Šå›¾lldè°ƒè¯•å¯çŸ¥ï¼š ç±»çš„ å®ä¾‹æ–¹æ³• å­˜å‚¨åœ¨ ç±»çš„bitså±æ€§ ä¸­ï¼Œé€šè¿‡ bits --&gt; methods() --&gt; list è·å–å®ä¾‹æ–¹æ³•åˆ—è¡¨ï¼Œä¾‹å¦‚ ZJPersonç±» çš„ å®ä¾‹æ–¹æ³• sayHello å°±å­˜å‚¨åœ¨ZJPersonç±» çš„ bitså±æ€§ ä¸­ï¼Œç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨é™¤äº† åŒ…æ‹¬å®ä¾‹æ–¹æ³•ï¼Œè¿˜åŒ…æ‹¬ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆçš„ å±æ€§ çš„ setæ–¹æ³• ã€ getæ–¹æ³• å’Œ cxx_destructæ–¹æ³•ï¼Œ ç±»çš„ ç±»æ–¹æ³• å­˜å‚¨ åœ¨å…ƒç±» çš„ bitså±æ€§ ä¸­ï¼Œé€šè¿‡å…ƒç±» bits --&gt; methods() --&gt; list è·å–ç±»æ–¹æ³•åˆ—è¡¨ï¼Œä¾‹å¦‚ZJPersonä¸­çš„ç±»æ–¹æ³• sayBye å°±å­˜å‚¨åœ¨ZJPersonç±»çš„ å…ƒç±»ï¼ˆåç§°ä¹Ÿæ˜¯ZJPersonï¼‰çš„ bitså±æ€§ ä¸­","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†09ï¼šisaèµ°å‘&ç»§æ‰¿åˆ†æ","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†09ï¼šisaèµ°å‘&ç»§æ‰¿åˆ†æ","date":"2020-09-22T13:57:52.000Z","updated":"2022-04-22T02:33:43.000Z","comments":true,"path":"2020/09/22/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†09ï¼šisaèµ°å‘&ç»§æ‰¿åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/09/22/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8609%EF%BC%9Aisa%E8%B5%B0%E5%90%91&%E7%BB%A7%E6%89%BF%E5%88%86%E6%9E%90/","excerpt":"","text":"æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯åˆ†æ isaèµ°å‘ å’Œ ç»§æ‰¿ çš„åˆ†æ å‡†å¤‡å·¥ä½œå®šä¹‰ä¸¤ä¸ªç±» : ç»§æ‰¿è‡ª NSObject çš„ ZJPerson ç±» 1234@interface ZJPerson : NSObject@end@implementation ZJPerson@end ç»§æ‰¿è‡ª ZJPerson çš„ ZJStudent ç±» 1234@interface ZJStudent : ZJPerson@end@implementation ZJStudent@end åœ¨ main.m ä¸­ åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼šperson &amp; student 123456789int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // ISA_MASK 0x00007ffffffffff8ULL ZJPerson * person = [ZJPerson alloc]; ZJStudent * student = [ZJStudent alloc]; NSLog(@&quot;Hello World:%@ - %@&quot;,person,student); &#125; return 0;&#125; å…ƒç±»é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹çš„ lldb è°ƒè¯•å¼•å…¥ å…ƒç±» æ¦‚å¿µ åœ¨ main ä¸­ NSLog(@&quot;Hello World:%@ - %@&quot;,person,student); å¤„ä¸‹ä¸€ä¸ª æ–­ç‚¹ï¼Œè¿è¡Œç¨‹åºï¼Œå¼€å¯ lldb è°ƒè¯•ï¼Œè°ƒè¯•çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š x/4gx person ï¼šæŸ¥çœ‹ person çš„å†…å­˜åˆ†å¸ƒæƒ…å†µï¼Œæ‹¿åˆ° isa çš„æŒ‡é’ˆåœ°å€ 0x001d8001000021d1 p/x person ï¼šæ‹¿åˆ° 0x0000000101159370 åœ°å€ï¼Œè¿™ä¸ªåœ°å€é¦–å…ˆä»£è¡¨ é¦–åœ°å€ï¼Œå…¶æ¬¡ä»£è¡¨ å½“å‰å¯¹è±¡ï¼Œä¹Ÿä»£è¡¨ isaï¼Œ é‚£ä¹ˆä¸ºä»€ä¹ˆå³ä»£è¡¨å½“å‰å¯¹è±¡ï¼Œåˆä»£è¡¨ isa å‘¢ï¼Ÿ ä»»ä½•è‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚ZJPersonï¼Œå‡ç»§æ‰¿è‡ªNSObjectï¼ŒNSObject é»˜è®¤ç¬¬ä¸€ä¸ªå‚æ•°ä¸º Class isaï¼Œæ‰€ä»¥é¦–åœ°å€ä¼šæŒ‡å‘ isaï¼Œisa åˆä»£è¡¨å½“å‰çš„ç±» p/x 0x001d8001000021d1 &amp; 0x00007ffffffffff8ULLï¼šè·å– ç±»ZJPerson çš„æŒ‡é’ˆåœ°å€ 0x00000001000021d0 po 0x00000001000021d0ï¼šæ ¹æ® ç±» çš„æŒ‡é’ˆåœ°å€ 0x00000001000021d0 æ‰“å° ç±»ä¿¡æ¯ï¼Œå¾—åˆ° ç±» ZJPerson æŸ¥çœ‹ç±»çš„å†…å­˜åˆ†å¸ƒæœ‰ä¸‰ç§æ–¹å¼ï¼š é€šè¿‡ ç±» çš„ æŒ‡é’ˆåœ°å€: x 0x00000001000021d0 é€šè¿‡ class çš„ API: x ZJPerson.class é€šè¿‡ runtime çš„ API: x object_getClass(person) x/4gx 0x00000001000021d0ï¼šæŸ¥çœ‹ ç±»ZJPerson çš„ å†…å­˜åˆ†å¸ƒ æƒ…å†µï¼Œæ‹¿åˆ° isa æŒ‡é’ˆåœ°å€ 0x00000001000021a8 po 0x00000001000021a8ï¼šæ‰“å°ZJPersonç±»çš„isaæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œå³ å…ƒç±»ï¼Œå…¶å…ƒç±»ä¹Ÿæ˜¯ZJPerson p/x 0x00000001000021a8 &amp; 0x00007ffffffffff8ULLï¼šé€šè¿‡ ç±»isa &amp; mask è·å–å…ƒç±»çš„isaæŒ‡é’ˆåœ°å€0x00000001000021a8 po 0x00000001000021a8ï¼šæ‰“å° å…ƒç±» çš„æŒ‡é’ˆä¿¡æ¯ï¼Œæ‹¿åˆ° ZJPerson æ ¹æ®è°ƒè¯•è¿‡ç¨‹ï¼Œæˆ‘ä»¬äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆå›¾ä¸­çš„ p/x 0x001d8001000021d1 &amp; 0x00007ffffffffff8ULL ä¸ p/x 0x00000001000021a8 &amp; 0x00007ffffffffff8ULL ä¸­çš„ç±»ä¿¡æ¯æ‰“å°å‡ºæ¥éƒ½æ˜¯ ZJPersonï¼Ÿ 0x001d8001000021d1 æ˜¯ personå¯¹è±¡çš„ isaæŒ‡é’ˆåœ°å€ï¼Œå…¶ &amp; mask åå¾—åˆ°çš„ç»“æœæ˜¯è·å–å¯¹è±¡ person çš„ ç±»ZJPerson 0x00000001000021a8 æ˜¯ å…ƒç±»çš„isaæŒ‡é’ˆåœ°å€ï¼Œå³ ZJPersonç±»çš„ç±» çš„isaæŒ‡é’ˆåœ°å€ï¼Œåœ¨Appleä¸­ï¼Œæˆ‘ä»¬ç®€ç§° ZJPersonç±»çš„ç±» ä¸º å…ƒç±» æ‰€ä»¥ï¼Œä¸¤ä¸ªæ‰“å°éƒ½æ˜¯ ZJPerson çš„æ ¹æœ¬åŸå› å°±æ˜¯å› ä¸º å…ƒç±» å¯¼è‡´çš„ å…ƒç±»çš„è¯´æ˜: ä¸‹é¢æ¥è§£é‡Šä»€ä¹ˆæ˜¯å…ƒç±»ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹è¯´æ˜ï¼š æˆ‘ä»¬çŸ¥é“ å¯¹è±¡çš„isa æ˜¯ æŒ‡å‘ç±»ï¼Œç±» å…¶å® ä¹Ÿæ˜¯ ä¸€ä¸ª å¯¹è±¡ï¼Œå¯ä»¥ç§°ä¸º ç±»å¯¹è±¡ï¼Œå…¶ isa çš„ä½åŸŸ æŒ‡å‘ è‹¹æœå®šä¹‰çš„ å…ƒç±» å…ƒç±» æ˜¯ ç³»ç»Ÿç”Ÿæˆ çš„ï¼Œå…¶å®šä¹‰å’Œåˆ›å»ºéƒ½æ˜¯ç”±ç¼–è¯‘å™¨å®Œæˆï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç±» çš„å½’å± æ¥è‡ª äº å…ƒç±» å…ƒç±» æ˜¯ ç±»å¯¹è±¡ çš„ ç±»ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å…ƒç±»ç”¨æ¥å­˜å‚¨ ç±»æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯ã€‚ å…ƒç±»æœ¬èº«æ˜¯æ²¡æœ‰åç§°çš„ï¼Œç”±äºä¸ç±»ç›¸å…³è”ï¼Œæ‰€ä»¥ä½¿ç”¨äº†åŒç±»åä¸€æ ·çš„åç§° isaèµ°å‘ä¸‹é¢é€šè¿‡ lldb å‘½ä»¤æ¥æ¢ç´¢isaæŒ‡é’ˆçš„èµ°å‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: ç”±ä¸Šå›¾ lldb æ¢ç´¢å¯ä»¥å¾—å‡ºä¸€ä¸ªå…³ç³»é“¾ï¼šå¯¹è±¡ --&gt; ç±» --&gt; å…ƒç±» --&gt; NSobject --&gt; æŒ‡å‘è‡ªå·± ä¸‹é¢ç”¨ä¸€å¼ å›¾è¡¨ç¤º isaèµ°å‘ æµç¨‹ï¼š ç”±ä¸Šé¢çš„åˆ†æç»“æœæˆ‘ä»¬å¯çŸ¥ï¼š å®ä¾‹å¯¹è±¡ çš„ isa æŒ‡é’ˆæŒ‡å‘ ç±» ç±»å¯¹è±¡ çš„ isa æŒ‡é’ˆæŒ‡å‘ å…ƒ ç±» å…ƒç±» çš„ isa æŒ‡é’ˆæŒ‡å‘ æ ¹å…ƒç±» æ ¹å…ƒç±» çš„ isa æŒ‡é’ˆæŒ‡å‘ è‡ªå·± NSObjectåˆ°åº•æœ‰å‡ ä¸ªï¼Ÿç”±ä¸Šå›¾å¯çŸ¥ï¼Œæœ€åçš„æ ¹å…ƒç±»æ˜¯NSObjectï¼Œè¿™å’Œæˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æ‰€çŸ¥é“çš„NSObjectæ˜¯åŒä¸€ä¸ªå—ï¼Ÿ æœ‰ä»¥ä¸‹ä¸¤ç§éªŒè¯æ–¹å¼ ã€æ–¹æ³•ä¸€ã€‘lldbå‘½ä»¤éªŒè¯ ã€æ–¹æ³•äºŒã€‘ä»£ç éªŒè¯ ã€æ–¹æ³•ä¸€ã€‘lldbå‘½ä»¤éªŒè¯ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œç”±å®ä¾‹å¯¹è±¡ person æœ€ç»ˆ isa æ‰¾åˆ°çš„æ ¹æºä¸ª NSObjectï¼Œä¸ä¸‹é¢ å¼€å‘ä¸­ä½¿ç”¨çš„ NSobject ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½æ ¹å…ƒç±»NSObjectï¼Œæ ¹å…ƒç±»çš„å…ƒç±»æ˜¯æŒ‡å‘å®ƒè‡ªå·± ã€æ–¹æ³•äºŒã€‘ä»£ç éªŒè¯ é€šè¿‡ä¸‰ç§ä¸åŒçš„æ–¹å¼è·å–ç±»ï¼Œçœ‹ä»–ä»¬æ‰“å°çš„åœ°å€æ˜¯å¦ç›¸åŒ 1234567// MARK: -åˆ†æç±»å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜åœ¨å‡ ä»½void testClassNum()&#123; Class class1 = [ZJPerson class]; Class class2 = [ZJPerson alloc].class; Class class3 = object_getClass([ZJPerson alloc]); NSLog(@&quot;\\n%p-\\n%p-\\n%p&quot;, class1, class2, class3);&#125; ä»¥ä¸Šä»£ç çš„è¿è¡Œç»“æœæ˜¯ 12342020-10-02 22:46:53.183944+0800 ZJObjc[21320:623345] 0x100002190-0x100002190-0x100002190 ä»æ‰“å°ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæ‰“å°çš„ åœ°å€ éƒ½æ˜¯ åŒä¸€ä¸ª ï¼Œæ‰€ä»¥ ç±»å¯¹è±¡ åœ¨å†…å­˜ä¸­ åªå­˜åœ¨ä¸€ä»½ã€‚ ã€é¢è¯•é¢˜ã€‘ é—®ï¼šç±»å¯¹è±¡åœ¨å†…å­˜ä¸­å­˜åœ¨å‡ ä»½ï¼Ÿ ç­”ï¼šç”±äºç±»ä¿¡æ¯åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œæ‰€ä»¥ ç±»å¯¹è±¡åªå­˜åœ¨ä¸€ä»½ ç»§æ‰¿ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸¤é“é¢è¯•é¢˜æ¥äº†è§£ä¸€ä¸‹ç»§æ‰¿å…³ç³» 1ã€ã€é¢è¯•é¢˜1ã€‘ï¼š æˆ‘ä»¬çŸ¥é“ ç±»ZJTeacher ç»§æ‰¿è‡ª ç±»ZJPerson ï¼Œé‚£ä¹ˆ å®ä¾‹å¯¹è±¡tearher å’Œ å®ä¾‹å¯¹è±¡person æœ‰å…³ç³»ä¹ˆï¼Ÿ ç­”ï¼šæ²¡æœ‰å…³ç³» åˆ†æï¼š ç»§æ‰¿å…³ç³»ä¹‹æ¥æºä¸ ç±» å®ä¾‹å¯¹è±¡æ²¡æœ‰å…³ç³» 2ã€ã€é¢è¯•é¢˜2ã€‘ï¼š ZJTearher ç»§æ‰¿è‡ª ZJPersonï¼ŒZJPerson ç»§æ‰¿è‡ª NSObject,é‚£ä¹ˆ NSObject ç»§æ‰¿è‡ªè°å‘¢ï¼Ÿ ç­”ï¼šNSObject ç»§æ‰¿è‡ª nil ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹ç»§æ‰¿å…³ç³»: ZJTeacher å’Œ NSObject isa èµ°ä½å›¾ç”±ä¸Šé¢ ç»§æ‰¿ å’Œ isaèµ°ä½å›¾ åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º ZJTeacher å’Œ NSObject çš„ isaèµ°ä½ å›¾ï¼š ç»§æ‰¿ å’Œ isaèµ°ä½å›¾æ ¹æ®ä¸Šé¢çš„æ¢ç´¢ä»¥åŠå„ç§éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è‘—åçš„ ç»§æ‰¿ &amp; isaèµ°ä½å›¾ï¼š isaèµ°ä½é“¾ä¸‰æ¡ï¼š teacherï¼ˆå®ä¾‹å¯¹è±¡ï¼‰ -&gt; ZJTeacherï¼ˆç±»ï¼‰ -&gt; ZJTeacherï¼ˆå…ƒç±»ï¼‰-&gt; NSObjectï¼ˆæ ¹å…ƒç±»ï¼‰-&gt; NSObjectï¼ˆæ ¹æ ¹å…ƒç±»ï¼‰ personï¼ˆå®ä¾‹å¯¹è±¡ï¼‰ -&gt; ZJPersonï¼ˆç±»ï¼‰ -&gt; ZJPersonï¼ˆå…ƒç±»ï¼‰-&gt; NSObjectï¼ˆæ ¹å…ƒç±»ï¼‰-&gt; NSObjectï¼ˆæ ¹æ ¹å…ƒç±»ï¼‰ objectï¼ˆå®ä¾‹å¯¹è±¡ï¼‰ -&gt; NSObjectï¼ˆç±»ï¼‰ -&gt; NSObjectï¼ˆå…ƒç±»ï¼‰-&gt; NSObjectï¼ˆæ ¹å…ƒç±»ï¼‰-&gt; NSObjectï¼ˆæ ¹æ ¹å…ƒç±»ï¼‰ ç»§æ‰¿é“¾ä¸¤æ¡ï¼š ZJTeacherï¼ˆå­ç±»ï¼‰-&gt; ZJPersonï¼ˆçˆ¶ç±»ï¼‰-&gt; NSObject(æ ¹ç±») -&gt; nil ZJTeacherï¼ˆå­å…ƒç±»ï¼‰-&gt; ZJPersonï¼ˆçˆ¶å…ƒç±»ï¼‰-&gt; NSObject(æ ¹å…ƒç±») -&gt; NSObjectï¼ˆæ ¹ç±»ï¼‰-&gt; nil","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢","date":"2020-09-18T07:04:23.000Z","updated":"2023-02-25T07:33:42.588Z","comments":true,"path":"2020/09/18/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/09/18/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8608%EF%BC%9Aisa%E5%92%8C%E7%B1%BB%E5%85%B3%E8%81%94%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"å‰è¨€æœ¬æ–‡çš„ä¸»è¦ç›®çš„æ˜¯ç†è§£ ç±»ä¸isa æ˜¯å¦‚ä½• å…³è” çš„ åœ¨ä»‹ç»æ­£æ–‡ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ç†è§£ä¸€ä¸ªæ¦‚å¿µï¼šOCå¯¹è±¡ çš„ æœ¬è´¨ æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨æ¢ç´¢ocå¯¹è±¡æœ¬è´¨å‰ï¼Œå…ˆäº†è§£ä¸€ä¸ªç¼–è¯‘å™¨ï¼šclang Clang1ã€ä»‹ç» Clang æ˜¯â¼€ä¸ªç”± Apple ä¸»å¯¼ç¼–å†™ï¼ŒåŸºäº LLVMçš„C/C++/Objective-C ç¼–è¯‘å™¨ ä¸»è¦æ˜¯ç”¨äº åº•å±‚ç¼–è¯‘ï¼Œå°†ä¸€äº›æ–‡ä»¶è¾“å‡ºæˆ c++ æ–‡ä»¶ï¼Œä¾‹å¦‚ main.m è¾“å‡ºæˆ main.cppï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„è§‚å¯Ÿ åº•å±‚ çš„ä¸€äº› ç»“æ„ åŠ å®ç° çš„é€»è¾‘ï¼Œæ–¹ä¾¿ç†è§£åº•å±‚åŸç†ã€‚ 2ã€ å¸¸ç”¨ç¼–è¯‘å‘½ä»¤ï¼š æŠŠâ½¬æ ‡â½‚ä»¶ç¼–è¯‘æˆ c++ â½‚ä»¶ï¼Œç»ˆç«¯è¾“å…¥ clang -rewrite-objc main.m -o main.cpp 3ã€ xcodeå®‰è£…çš„æ—¶å€™é¡ºå¸¦å®‰è£…äº† xcrun å‘½ä»¤ï¼Œxcrun å‘½ä»¤åœ¨ clang çš„åŸºç¡€ä¸Šè¿›â¾äº†â¼€äº›å°è£…ï¼Œè¦æ›´å¥½â½¤â¼€äº›ï¼š xcrun -sdk iphonesimulator clang -arch arm64 -rewrite-objc main.m -o main-arm64.cpp (æ¨¡æ‹Ÿå™¨) xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m -o main\u0002arm64.cpp (â¼¿æœº) å¯¹è±¡çš„æœ¬è´¨**1ã€ ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰ä¸€ä¸ª ZJPerson ç±»ï¼Œæ·»åŠ ä¸€ä¸ªå±æ€§ name ** 2ã€ é€šè¿‡ç»ˆç«¯ï¼Œåˆ©ç”¨ clang å°† main.m ç¼–è¯‘æˆ main.cppï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç¼–è¯‘å‘½ä»¤ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ç§: 12345678910111213// 1ã€å°† main.m ç¼–è¯‘æˆ main.cppclang -rewrite-objc main.m -o main.cpp// 2ã€å°† main.m ç¼–è¯‘æˆ main.cppclang -rewrite-objc -fobjc-arc -fobjc-runtime=ios-13.0.0 -isysroot / /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator13.7.sdk main.m// ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ˜¯é€šè¿‡æŒ‡å®šæ¶æ„æ¨¡å¼çš„å‘½ä»¤è¡Œï¼Œä½¿ç”¨xcodeå·¥å…· xcrun// 3ã€æ¨¡æ‹Ÿå™¨æ–‡ä»¶ç¼–è¯‘xcrun -sdk iphonesimulator clang -arch arm64 -rewrite-objc main.m -o main-arm64.cpp // 4ã€çœŸæœºæ–‡ä»¶ç¼–è¯‘xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m -o main\u0002arm64.cpp 3ã€æ‰“å¼€ç¼–è¯‘å¥½çš„ main.cppï¼Œæ‰¾åˆ° ZJPerson çš„å®šä¹‰ï¼Œå‘ç° ZJPerson åœ¨åº•å±‚ä¼šè¢«ç¼–è¯‘æˆ struct ç»“æ„ä½“: 123456789101112131415161718192021// ğŸ‘‡NSObjectçš„å®šä¹‰@interface NSObject &lt;NSObject&gt; &#123;#pragma clang diagnostic push#pragma clang diagnostic ignored &quot;-Wobjc-interface-ivars&quot; Class isa OBJC_ISA_AVAILABILITY;#pragma clang diagnostic pop&#125;// ğŸ‘‡NSObjectçš„åº•å±‚ç¼–è¯‘struct NSObject_IMPL &#123; Class isa;&#125;;// ğŸ‘‡ZJPersonçš„åº•å±‚ç¼–è¯‘struct ZJPerson_IMPL &#123; // NSObject_IVARSæ˜¯isa // ç»“æ„ä½“åœ¨c/c++å¯ä»¥ç»§æ‰¿çš„ï¼Œç»§æ‰¿è‡ªNSObject_IMPL struct NSObject_IMPL NSObject_IVARS; NSString *_name;&#125;; å¦‚ä¸‹å›¾ï¼š ZJPerson ç»§æ‰¿è‡ª NSObjectï¼Œå±äº ä¼ªç»§æ‰¿ ï¼Œä¼ªç»§æ‰¿ çš„æ–¹å¼æ˜¯ç›´æ¥å°†NSObject ç»“æ„ä½“å®šä¹‰ä¸º ZJPerson ä¸­çš„ç¬¬ä¸€ä¸ªå±æ€§ï¼Œæ„å‘³ç€ ZJPerson æ‹¥æœ‰ NSObject ä¸­çš„æ‰€æœ‰ æˆå‘˜å˜é‡ã€‚ ZJPerson ä¸­çš„ç¬¬ä¸€ä¸ªå±æ€§å°±æ˜¯ Class isaã€‚ 4ã€ æ€»ç»“ OCå¯¹è±¡ çš„ æœ¬è´¨ å…¶å®å°±æ˜¯ ç»“æ„ä½“ ZJPerson ä¸­çš„ isa æ˜¯ ç»§æ‰¿ è‡ª NSObject ä¸­çš„ isa objc_setPropertyç”±ä¸Šé¢å¯çŸ¥ ZJPerson è¢«ç¼–è¯‘æˆ ç»“æ„ä½“ï¼Œå±æ€§ name è¢«ç¼–è¯‘æˆå¯¹åº”çš„ set å’Œ get æ–¹æ³•ï¼Œå…¶ä¸­ set æ–¹æ³•çš„å®ç°æ˜¯ä¾èµ– runtime API objc_setProperty å®ç°çš„ã€‚ 1ã€æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥æ‰¾ objc4 æºç æ¥æŸ¥çœ‹ objc_setProperty åº•å±‚çš„è¿›ä¸€æ­¥å®ç°ï¼š 1ï¼‰å…¨å±€æœç´¢ objc_setPropertyï¼ŒæŸ¥æ‰¾æ‰€åœ¨ä½ç½® 2ï¼‰ç‚¹å‡»è¿›å…¥ objc_setProperty å†…éƒ¨æŸ¥çœ‹æºç å®ç° 3ï¼‰ç‚¹å‡» reallySetProperty æŸ¥çœ‹å†…éƒ¨æºç å®ç° 2ã€æ€»ç»“ é€šè¿‡å¯¹ objc_setProperty åº•å±‚æºç æ¢ç´¢ï¼Œæˆ‘ä»¬å¯å¾—å‡ºä»¥ä¸‹å‡ ä¸ªç»“è®ºï¼š æ‰€æœ‰ çš„ set æ–¹æ³•æœ€ç»ˆéƒ½å°†ä¼š æ‰¾åˆ°objc_setProperty LLVMä¸­é—´ éš”ç¦»å±‚ å‡½æ•°å» è°ƒç”¨ objc_setProperty ç”¨äº å…³è”ä¸Šå±‚ çš„ set æ–¹æ³• å’Œ ä¸‹å±‚ çš„reallySetProperty çš„ä¸€ä¸ª æ¥å£éš”ç¦»å±‚ å‡½æ•° è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ï¼Œå¦‚æœä¸Šå±‚æœ‰ å¾ˆå¤šset æ–¹æ³•ï¼Œå¦‚æœä½ ç›´æ¥è°ƒç”¨ ä¸‹å±‚ çš„ LLVM æ–¹æ³•ï¼Œä¼š äº§ç”Ÿå¾ˆå¤šä¸­é—´å±‚å˜é‡ï¼Œéå¸¸æ¶å¿ƒï¼Œå¾ˆéš¾ å»å¤„ç†ï¼ˆå¾ˆéš¾æ‰¾ï¼‰ é‚£ä¹ˆå¦‚ä½•åŒºåˆ†å‘¢ï¼Œç³»ç»Ÿæ ¹æ® cmd å»æŸ¥æ‰¾ï¼Œå°±æ˜¯è¯´æ— è®ºä½  ä¸Šå±‚ æ€ä¹ˆå˜åŒ–ï¼Œæˆ‘ä¸‹å±‚reallySetProperty éƒ½ ä¸ç”¨å˜åŒ–ï¼Œä½  ä¸‹å±‚ æ€ä¹ˆ å˜åŒ– ï¼Œä¸Šå±‚ éƒ½ ä¸ä¼šè¢«å½±å“ 3ã€ä¸Šå±‚ã€éš”ç¦»å±‚ã€åº•å±‚ä¹‹é—´çš„å…³ç³»å›¾ï¼š è”åˆä½“å’Œç»“æ„ä½“åœ¨ iOS-OCåº•å±‚åŸç†03ï¼šalloc&amp;init&amp;newæ¢ç´¢ å’Œ iOS-OCåº•å±‚åŸç†07ï¼šmallocæºç æ¢ç´¢ ä¸­æˆ‘ä»¬åˆ†åˆ«æ¢ç´¢äº†allocæ ¸å¿ƒæºç ä¸­çš„å‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ cls-&gt;instanceSize å’Œ calloc ï¼Œä»Šå¤©æˆ‘ä»¬æ¥æ¢ç´¢æœ€åä¸€ä¸ª obj-&gt;initInstanceIsa åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»€ä¹ˆæ˜¯ è”åˆä½“ï¼Œå®ƒå’Œ ç»“æ„ä½“ çš„åŒºåˆ«ï¼Ÿ 1ã€æ„é€ æ•°æ®ç±»å‹çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š ç»“æ„ä½“ï¼ˆstructï¼‰ è”åˆä½“ï¼ˆunionï¼Œä¹Ÿç§°ä¸ºå…±ç”¨ä½“ï¼‰ 2ã€ ç»“æ„ä½“å’Œè”åˆä½“ å†™æ³•ï¼š 1234567891011121314151617181920// ç»“æ„ä½“:sè¡¨ç¤ºç»“æ„ä½“ç±»å‹åstruct s&#123; // a,b,cè¡¨ç¤ºç»“æ„ä½“æˆå‘˜å char a; //å 1ä¸ªå­—èŠ‚ ï¼ˆ0ï¼‰ int b; //å 4ä¸ªå­—èŠ‚ ï¼ˆ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼‰ short c; //å 2ä¸ªå­—èŠ‚ ï¼ˆ8ï¼Œ9ï¼‰&#125;s1;// s1è¡¨ç¤ºç»“æ„ä½“å˜é‡å// è®¿é—®è¯¥ç»“æ„ä½“å†…éƒ¨æˆå‘˜æ—¶å¯ä»¥é‡‡ç”¨s1.a=1;å…¶ä¸­&quot;ç‚¹&quot;è¡¨ç¤ºç»“æ„ä½“æˆå‘˜è¿ç®—ç¬¦// è”åˆä½“// u1è¡¨ç¤ºè”åˆä½“ç±»å‹åunion u1&#123; // a,b,cè¡¨ç¤ºè”åˆä½“æˆå‘˜å char a; //å 1ä¸ªå­—èŠ‚ int b; //å 4ä¸ªå­—èŠ‚ short c;//å 2ä¸ªå­—èŠ‚&#125;u1; åœ¨main.mä¸­æ‰“å°ä¸€ä¸‹ 12345678910111213int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; printf(&quot;%lu\\n&quot;,sizeof(s1)); printf(&quot;%lu\\n&quot;,sizeof(u1)); NSLog(@&quot;Hello, World!&quot;); &#125; return 0;&#125;******æŸ¥çœ‹æ‰“å°ç»“æœ******124(lldb) ç”±ç»“æœå¯çŸ¥ï¼š ç»“æ„ä½“ çš„å¤§å°ä¸º 12 ï¼Œæœ€å¤§æˆå‘˜å˜é‡çš„å€æ•° 4*3 = 12 è”åˆä½“ çš„å¤§å°ä¸º 4 ï¼Œæœ€å¤§æˆå‘˜å˜é‡ 4 3ã€ç»“æ„ä½“ï¼ˆstructï¼‰ ç»“æ„ä½“ï¼šå„æˆå‘˜å„è‡ªæ‹¥æœ‰ è‡ªå·±çš„å†…å­˜ï¼Œå„è‡ªä½¿ç”¨ äº’ä¸å¹²æ¶‰ï¼ŒåŒæ—¶å­˜åœ¨çš„ï¼Œéµå¾ª å†…å­˜å¯¹é½ åŸåˆ™ã€‚ä¸€ä¸ª struct å˜é‡çš„ æ€»é•¿åº¦ ç­‰äº æ‰€æœ‰æˆå‘˜ çš„ é•¿åº¦ä¹‹å’Œã€‚ ç¼ºç‚¹ï¼šæ‰€æœ‰å±æ€§éƒ½åˆ†é…å†…å­˜ï¼Œæ¯”è¾ƒæµªè´¹å†…å­˜ï¼Œå‡è®¾æœ‰ 4ä¸ªint æˆå‘˜ï¼Œä¸€å…±åˆ†é…äº† 4*4=16 å­—èŠ‚çš„å†…å­˜ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨æ—¶ï¼Œä½ åªä½¿ç”¨äº†4å­—èŠ‚ï¼Œå‰©ä½™çš„12å­—èŠ‚å°±æ˜¯å±äºå†…å­˜çš„æµªè´¹ ä¼˜ç‚¹ï¼šå­˜å‚¨å®¹é‡è¾ƒå¤§ï¼ŒåŒ…å®¹æ€§å¼ºï¼Œä¸”æˆå‘˜ä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ 4ã€è”åˆä½“ï¼ˆunionï¼‰ è”åˆä½“ï¼šå„æˆå‘˜ å…±ç”¨ ä¸€å— å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”åŒæ—¶åªæœ‰ä¸€ä¸ªæˆå‘˜å¯ä»¥å¾—åˆ°è¿™å—å†…å­˜çš„ ä½¿ç”¨æƒ(å¯¹è¯¥å†…å­˜çš„è¯»å†™)ï¼Œå„å˜é‡ å…±ç”¨ä¸€ä¸ªå†…å­˜ é¦–åœ°å€ã€‚å› è€Œï¼Œè”åˆä½“æ¯”ç»“æ„ä½“æ›´ èŠ‚çº¦å†…å­˜ã€‚ä¸€ä¸ª union å˜é‡çš„æ€»é•¿åº¦è‡³å°‘èƒ½å®¹çº³ æœ€å¤§ çš„æˆå‘˜å˜é‡ï¼Œè€Œä¸”è¦æ»¡è¶³æ˜¯æ‰€æœ‰ æˆå‘˜å˜é‡ ç±»å‹å¤§å°çš„ æ•´æ•°å€ã€‚ ç¼ºç‚¹ï¼šï¼ŒåŒ…å®¹æ€§å¼± ä¼˜ç‚¹ï¼šæ‰€æœ‰æˆå‘˜å…±ç”¨ä¸€æ®µå†…å­˜ï¼Œä½¿å†…å­˜çš„ä½¿ç”¨æ›´ä¸ºç²¾ç»†çµæ´»ï¼ŒåŒæ—¶ä¹ŸèŠ‚çº¦å†…å­˜ 5ã€ä¸¤è€…çš„åŒºåˆ« 1ï¼‰å†…å­˜å ç”¨æƒ…å†µ ç»“æ„ä½“ çš„å„ä¸ªæˆå‘˜ä¼š å ç”¨ä¸åŒ çš„ å†…å­˜ ï¼Œäº’ç›¸ä¹‹é—´æ²¡æœ‰å½±å“ å…±ç”¨ä½“ çš„æ‰€æœ‰æˆå‘˜ å ç”¨åŒä¸€æ®µ å†…å­˜ï¼Œä¿®æ”¹ä¸€ä¸ªæˆå‘˜ä¼šå½±å“å…¶ä½™æ‰€æœ‰æˆå‘˜ 2ï¼‰å†…å­˜åˆ†é…å¤§å° ç»“æ„ä½“ å†…å­˜ &gt;&#x3D; æ‰€æœ‰æˆå‘˜å ç”¨çš„å†…å­˜æ€»å’Œï¼ˆæˆå‘˜ä¹‹é—´å¯èƒ½ä¼šæœ‰ç¼éš™ï¼‰ å…±ç”¨ä½“å ç”¨çš„å†…å­˜ç­‰äºæœ€å¤§çš„æˆå‘˜å ç”¨çš„å†…å­˜ isaçš„ç±»å‹1ã€æˆ‘ä»¬çŸ¥é“ isa çš„ç±»å‹æ˜¯ isa_t çš„ è”åˆä½“ ï¼Œisa_t ç±»å‹ä½¿ç”¨ è”åˆä½“ çš„åŸå›  ä¹Ÿæ˜¯åŸºäº å†…å­˜ä¼˜åŒ– çš„è€ƒè™‘ï¼›è¿™é‡Œçš„å†…å­˜ä¼˜åŒ–æ˜¯æŒ‡åœ¨ isa æŒ‡é’ˆä¸­é€šè¿‡ char + ä½åŸŸï¼ˆå³äºŒè¿›åˆ¶ä¸­æ¯ä¸€ä½å‡å¯è¡¨ç¤ºä¸åŒçš„ä¿¡æ¯ï¼‰çš„åŸç†å®ç°ã€‚é€šå¸¸æ¥è¯´ï¼Œisa æŒ‡é’ˆå ç”¨çš„å†…å­˜ å¤§å°æ˜¯ 8 å­—èŠ‚(1å­—èŠ‚&#x3D;8ä½)ï¼Œå³ 8*8=64 ä½ï¼Œå·²ç»è¶³å¤Ÿå­˜å‚¨å¾ˆå¤šçš„ä¿¡æ¯äº†ï¼Œè¿™æ ·å¯ä»¥æå¤§çš„ èŠ‚çœå†…å­˜ï¼Œä»¥ æé«˜æ€§èƒ½ã€‚ isa_tæºç ï¼š 1234567891011121314// è”åˆä½“union isa_t &#123; // isaçš„ä¸¤ç§åˆå§‹åŒ–æ–¹æ³• isa_t() &#123; &#125; isa_t(uintptr_t value) : bits(value) &#123; &#125; // æä¾›äº† cls å’Œ bits ï¼Œä¸¤è€…æ˜¯äº’æ–¥å…³ç³» Class cls; // å­˜å‚¨clsä¿¡æ¯ uintptr_t bits; // å­˜å‚¨å¤šä½çš„ä¿¡æ¯#if defined(ISA_BITFIELD) struct &#123; ISA_BITFIELD; // defined in isa.h &#125;;#endif&#125;; 2ã€ä» isa_t çš„å®šä¹‰ä¸­å¯ä»¥çœ‹å‡ºï¼š æä¾›äº†ä¸¤ä¸ªæˆå‘˜ï¼Œcls å’Œ bitsï¼Œç”±è”åˆä½“çš„å®šä¹‰æ‰€çŸ¥ï¼Œè¿™ä¸¤ä¸ªæˆå‘˜æ˜¯äº’æ–¥çš„ï¼Œä¹Ÿå°±æ„å‘³ç€ï¼Œå½“åˆå§‹åŒ–isaæŒ‡é’ˆæ—¶ï¼Œæœ‰ä¸¤ç§åˆå§‹åŒ–æ–¹å¼ï¼š å¦‚æœä¸æ˜¯ nonpointerï¼Œé€šè¿‡ isa_t(uintptr_t value) : bits(value) &#123; &#125;å®ç°åˆå§‹åŒ– 12345// å¦‚æœä¸æ˜¯nonpointer,åˆå§‹åŒ–isaï¼Œè¿”å›clsä¿¡æ¯if (!nonpointer) &#123; // åˆå§‹åŒ–isa isa = isa_t((uintptr_t)cls);&#125; å¦‚æœæ˜¯ nonpointer ,é€šè¿‡ isa_t() åˆå§‹åŒ– 12345678910111213141516171819202122232425262728293031323334// å¦‚æœæ˜¯nonpointerçš„åˆå§‹åŒ–æ–¹å¼else &#123; ASSERT(!DisableNonpointerIsa); ASSERT(!cls-&gt;instancesRequireRawIsa()); // åˆå§‹åŒ–isa isa_t newisa(0); // è¿”å›0#if SUPPORT_INDEXED_ISA ASSERT(cls-&gt;classArrayIndex() &gt; 0); newisa.bits = ISA_INDEX_MAGIC_VALUE; // isa.magic is part of ISA_MAGIC_VALUE // isa.nonpointer is part of ISA_MAGIC_VALUE newisa.has_cxx_dtor = hasCxxDtor; newisa.indexcls = (uintptr_t)cls-&gt;classArrayIndex(); // 64ä½èµ°è¿™ä¸ªåœ°æ–¹#else // èµ‹å€¼bits newisa.bits = ISA_MAGIC_VALUE; // èµ‹å€¼cxx newisa.has_cxx_dtor = hasCxxDtor; // èµ‹å€¼ç±»ä¿¡æ¯ newisa.shiftcls = (uintptr_t)cls &gt;&gt; 3;#endif // èµ‹å€¼isa isa = newisa; &#125; 3ã€SUPPORT_INDEXED_ISA ï¼šè¡¨ç¤º isa_t ä¸­å­˜æ”¾çš„ Class ä¿¡æ¯æ˜¯ Class çš„åœ°å€ï¼Œè¿˜æ˜¯ä¸€ä¸ªç´¢å¼•(æ ¹æ®è¯¥ ç´¢å¼• å¯åœ¨ ç±»ä¿¡æ¯è¡¨ ä¸­æŸ¥æ‰¾è¯¥ç±»ç»“æ„åœ°å€)ã€‚ç›®å‰æ¥è§¦åˆ°çš„iOSçš„è®¾å¤‡ä¸Š SUPPORT_INDEXED_ISA ä¸º 0 ï¼Œå¦‚ä¸‹ä»£ç : 12345678// å¦‚æœä¸æ˜¯64ä½#if __ARM_ARCH_7K__ &gt;= 2 || (__arm64__ &amp;&amp; !__LP64__)# define SUPPORT_INDEXED_ISA 1// å¦‚æœæ˜¯64ä½#else# define SUPPORT_INDEXED_ISA 0#endif 4ã€isa_t è¿˜æä¾›äº†ä¸€ä¸ªç»“æ„ä½“å®šä¹‰çš„ ä½åŸŸ ï¼Œç”¨äºå­˜å‚¨ç±»ä¿¡æ¯åŠå…¶ä»–ä¿¡æ¯ï¼Œç»“æ„ä½“çš„æˆå‘˜ ISA_BITFIELD ï¼Œè¿™æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œæœ‰ä¸¤ä¸ª æ¶æ„__arm64__ï¼ˆçœŸæœºï¼‰ å’Œ __x86_64__ï¼ˆmacOS/æ¨¡æ‹Ÿå™¨ï¼‰ï¼Œä»¥ä¸‹æ˜¯å®ƒä»¬çš„ä¸€äº›å®å®šä¹‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š nonpointerï¼šè¡¨ç¤ºæ˜¯å¦å¯¹ isa æŒ‡é’ˆ å¼€å¯æŒ‡é’ˆä¼˜åŒ– 0ï¼šå¦‚æœæ²¡æœ‰ nonpointer å°±æ˜¯çº¯isaæŒ‡é’ˆ 1ï¼šå¦‚æœæœ‰ nonpointerï¼Œä¸â½Œæœ‰ ç±»å¯¹è±¡åœ°å€ ,isa ä¸­åŒ…å«äº† ç±»ä¿¡æ¯ã€å¯¹è±¡çš„ å¼•â½¤è®¡æ•° ç­‰ has_assocï¼šå…³è”å¯¹è±¡æ ‡å¿—ä½ 0æ²¡æœ‰ 1å­˜åœ¨ has_cxx_dtorï¼šè¯¥å¯¹è±¡æ˜¯å¦æœ‰C++æˆ–è€… Objc çš„ææ„å™¨,å¦‚æœæœ‰ææ„å‡½æ•°,åˆ™éœ€è¦åšææ„é€»è¾‘, å¦‚æœæ²¡æœ‰,åˆ™å¯ä»¥æ›´å¿«çš„é‡Šæ”¾å¯¹è±¡ shiftcls: å­˜å‚¨ç±»æŒ‡é’ˆçš„å€¼ã€‚å¼€å¯æŒ‡é’ˆä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼š åœ¨ __arm64__ æ¶æ„ä¸­æœ‰ 33 ä½â½¤æ¥å­˜å‚¨ ç±»æŒ‡é’ˆã€dealloc å‡½æ•° åœ¨ __x86_64__ æ¶æ„ä¸­æœ‰ 44 ä½ç”¨æ¥å­˜å‚¨ç±»æŒ‡é’ˆã€‚ magicï¼šâ½¤äºè°ƒè¯•å™¨åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯ çœŸçš„å¯¹è±¡ è¿˜æ˜¯ æ²¡æœ‰åˆå§‹åŒ– çš„ ç©ºé—´ weakly_referencedï¼šæŒ‡å¯¹è±¡æ˜¯å¦è¢« æŒ‡å‘ æˆ–è€… æ›¾ç»æŒ‡å‘ â¼€ä¸ª ARC çš„å¼±å˜é‡ å¦‚æœ æœ‰ï¼Œåˆ™åœ¨è°ƒç”¨ delloc è¿›è¡Œ é‡Šæ”¾ å¦‚æœ æ²¡æœ‰ï¼Œå¼±å¼•â½¤çš„å¯¹è±¡å¯ä»¥ æ›´å¿«é‡Šæ”¾ã€‚ deallocatingï¼šæ ‡å¿—å¯¹è±¡æ˜¯å¦ æ­£åœ¨é‡Šæ”¾ å†…å­˜ has_sidetable_rcï¼šå½“å¯¹è±¡ å¼•â½¤è®¡æ•°â¼¤äº 10 æ—¶ï¼Œåˆ™éœ€è¦å€Ÿâ½¤è¯¥å˜é‡ å­˜å‚¨è¿›ä½ extra_rcï¼šå½“è¡¨ç¤ºè¯¥å¯¹è±¡çš„ å¼•â½¤è®¡æ•°å€¼ï¼Œå®é™…ä¸Šæ˜¯å¼•â½¤è®¡æ•°å€¼ å‡ 1 å¦‚æœå¯¹è±¡çš„å¼•â½¤è®¡æ•°ä¸º 10ï¼Œé‚£ä¹ˆ extra_rc ä¸º 9ã€‚ å¦‚æœå¼•â½¤è®¡æ•°â¼¤äº 10ï¼Œåˆ™éœ€è¦ä½¿â½¤åˆ° ä¸Šâ¾¯ çš„ has_sidetable_rcã€‚ é’ˆå¯¹ä¸¤ç§ä¸åŒå¹³å°ï¼Œå…¶isaçš„å­˜å‚¨æƒ…å†µå¦‚å›¾æ‰€ç¤ºï¼š ç”±ä¸Šé¢çš„åˆ†æå¾—å‡ºï¼Œå¤§éƒ¨åˆ† è‡ªå®šä¹‰çš„ç±» éƒ½æ˜¯å±äº nonpointer_isaï¼Œä¸å…‰å­˜å‚¨äº†isaï¼Œè¿˜å­˜å‚¨äº†å…¶ä»–ä¸€äº› ä¿¡æ¯ã€‚ deallocé‡Šæ”¾æˆ‘ä»¬é€šè¿‡ deallocé‡Š æŸ¥çœ‹ é€šè¿‡ ä¸­ dealloc é‡Šæ”¾æµç¨‹ï¼š 1ã€deallocè°ƒç”¨_objc_rootDeallocï¼š 1234// Replaced by NSZombies- (void)dealloc &#123; _objc_rootDealloc(self);&#125; 2ã€_objc_rootDeallocè°ƒç”¨rootDealloc: 12345678void_objc_rootDealloc(id obj)&#123; ASSERT(obj); obj-&gt;rootDealloc();&#125; 3ã€rootDeallocå†…éƒ¨è¿›è¡Œä¸€äº›åˆ¤æ–­ï¼Œé‡Šæ”¾ isa ç›¸å…³ä¿¡æ¯ï¼š 1234567891011121314151617181920inline voidobjc_object::rootDealloc()&#123; if (isTaggedPointer()) return; // fixme necessary? // isaæœ‰nonpointerï¼Œæ›´å¿«é‡Šæ”¾ if (fastpath(isa.nonpointer &amp;&amp; !isa.weakly_referenced &amp;&amp; !isa.has_assoc &amp;&amp; !isa.has_cxx_dtor &amp;&amp; !isa.has_sidetable_rc)) &#123; assert(!sidetable_present()); free(this); &#125; // æ²¡æœ‰nonpointer,è°ƒç”¨object_dispose else &#123; object_dispose((id)this); &#125;&#125; 4ã€object_disposeå†…éƒ¨è°ƒç”¨objc_destructInstance 12345678910id object_dispose(id obj)&#123; if (!obj) return nil; objc_destructInstance(obj); free(obj); return nil;&#125; 5ã€objc_destructInstance å†…éƒ¨è°ƒç”¨ clearDeallocating æ¸…é™¤ 1234567891011121314151617181920void *objc_destructInstance(id obj) &#123; if (obj) &#123; // Read all of the flags at once for performance. // æ˜¯å¦æœ‰c++/ocææ„å‡½æ•° bool cxx = obj-&gt;hasCxxDtor(); // æ˜¯å¦æœ‰å…³è”å¯¹è±¡ bool assoc = obj-&gt;hasAssociatedObjects(); // This order is important. // ææ„å‡½æ•° if (cxx) object_cxxDestruct(obj); // ç§»é™¤å…³è”å¯¹è±¡ if (assoc) _object_remove_assocations(obj); // æ¸…é™¤ obj-&gt;clearDeallocating(); &#125; return obj;&#125; å…·ä½“ç»†èŠ‚å¾…å®Œå–„â€¦ isa å’Œ ç±»å…³è”isa ä¸ cls å…³è” åŸç† å°±æ˜¯ isa æŒ‡é’ˆä¸­çš„ shiftclsä½åŸŸä¸­å­˜å‚¨äº†ç±»ä¿¡æ¯ ï¼Œå…¶ä¸­ initInstanceIsa çš„è¿‡ç¨‹æ˜¯å°† calloc æŒ‡é’ˆå’Œå½“å‰çš„ ç±»cls å…³è”èµ·æ¥ï¼Œæœ‰ä»¥ä¸‹å‡ ç§éªŒè¯æ–¹å¼ï¼š ã€æ–¹å¼ä¸€ã€‘é€šè¿‡ initIsa æ–¹æ³•ä¸­çš„ newisa.shiftcls = (uintptr_t)cls &gt;&gt; 3éªŒè¯ ã€æ–¹å¼äºŒã€‘é€šè¿‡ isaæŒ‡é’ˆ åœ°å€ä¸ ISA_MSAK çš„å€¼ &amp; æ¥éªŒè¯ ã€æ–¹å¼ä¸‰ã€‘é€šè¿‡ runtime çš„æ–¹æ³• object_getClass éªŒè¯ ã€æ–¹å¼å››ã€‘é€šè¿‡ ä½è¿ç®— éªŒè¯ ã€æ–¹æ³•ä¸€ã€‘é€šè¿‡ initIsa æ–¹æ³•ä¸­çš„ newisa.shiftcls = (uintptr_t)cls &gt;&gt; 3éªŒè¯1ã€é¦–å…ˆé€šè¿‡mainä¸­çš„ZJPerson æ–­ç‚¹ â€“&gt; initInstanceIsa â€“&gt; initIsa â€“&gt; èµ°åˆ°elseä¸­çš„ newisa.bits = ISA_MAGIC_VALUEè¿™ä¸€è¡Œ: 2ã€ é€šè¿‡lldbè°ƒè¯•æ‰“å° p newisa åˆå§‹åŒ–çš„ä¿¡æ¯: è¿™æ—¶ isa é€šè¿‡ newisa è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œä½†æ˜¯è¿˜æœªè¢«èµ‹å€¼ 3ã€å¾€ä¸‹èµ°ä¸€æ­¥ï¼Œèµ°åˆ°ä¸‹ä¸€è¡Œnewisa.has_cxx_dtor = hasCxxDtor ï¼š ç»§ç»­æ–­ç‚¹è°ƒè¯•ï¼Œåœ¨ä¸Šä¸€è¡Œ newisa.bits = ISA_MAGIC_VALUE å·²ç»ä¸º isa çš„ bits æˆå‘˜èµ‹å€¼ï¼Œæ‰§è¡Œlldbå‘½ä»¤ p newisaï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹: é€šè¿‡ä¸å‰ä¸€ä¸ª newisa å¯¹æ¯”æˆ‘ä»¬å‘ç°ï¼Œisa æŒ‡é’ˆä¸­æœ‰ä¸€äº›å˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š èµ‹å€¼ bits ä¼šå¯¹ cls è¿›è¡Œè¿½åŠ  0x001d800000000001 é»˜è®¤å€¼ èµ‹å€¼ bits é‡Œé¢çš„ ISA_BITFIELD å®ä¸­æ‰€æœ‰çš„ä¿¡æ¯ã€‘ nonpointer = 1ï¼Œä»£è¡¨æ˜¯nonpointer magic = 59 ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¾€ä¸‹çœ‹ 4ã€æ‰“å¼€ è®¡ç®—å™¨ æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ 16 è¿›åˆ¶ 0x001d800000000001 è½¬åŒ–ä¸º äºŒè¿›åˆ¶ï¼Œå’Œ 10è¿›åˆ¶59 è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ï¼Œè¿›è¡Œå¯¹æ¯”ä¸€ä¸‹ï¼š ç”±å¯¹æ¯”å¯çŸ¥ï¼Œ0x001d800000000001è½¬åŒ–ä¸ºäºŒè¿›åˆ¶ ï¼Œä» 47ï¼ˆå› ä¸ºå‰é¢æœ‰4ä¸ªä½åŸŸï¼Œå…±å ç”¨46ä½ï¼‰ ä½å¼€å§‹å¾€åæ•°6ä½æ˜¯ 110111ï¼› å’Œ 10 è¿›åˆ¶ magic = 59 è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œä» 0 å¼€å§‹ å¾€åæ•° 6 ä½çš„ å€¼ç›¸ç­‰ï¼› 5ã€ç»§ç»­å¾€ä¸‹æ‰§è¡Œæ–­ç‚¹åˆ°newisa.shiftcls = (uintptr_t)cls &gt;&gt; 3ï¼š shiftcls å­˜çš„æ˜¯ ç±»çš„ä¿¡æ¯ cls æ˜¯ ZJPerson è¿›è¡Œ ç¼–ç  ä¹‹åå¾€ å³ç§»3ä½ 1234(lldb) p (uintptr_t)cls(uintptr_t) $2 = 4294975720(lldb) p $2 &gt;&gt; 3(uintptr_t) $3 = 536871965 6ã€ç»§ç»­å¾€ä¸‹èµ°ä¸€åˆ° æ‰§è¡Œæ–­ç‚¹åˆ°isa = newisaï¼š æˆ‘ä»¬é€šè¿‡ lldb è°ƒè¯•ä¸€ä¸‹ newisaï¼š æˆ‘ä»¬çœ‹åˆ° cls = ZJPersonï¼Œè€Œ shiftcls = 536871965 ä¸ ä¸Šé¢çš„ $3 = 536871965 åˆšå¥½å»åˆ 7ã€æœ€åç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºä¸€ä¸‹å…·ä½“æµç¨‹: 8ã€ä¸ºä»€ä¹ˆåœ¨shiftclsèµ‹å€¼æ—¶éœ€è¦ç±»å‹å¼ºè½¬ï¼Ÿ å› ä¸ºå†…å­˜çš„å­˜å‚¨ä¸èƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œæœºå™¨ç  åªèƒ½è¯†åˆ« 0 ã€1 è¿™ä¸¤ç§æ•°å­—ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶è½¬æ¢ä¸º uintptr_t æ•°æ®ç±»å‹ï¼Œè¿™æ · shiftcls ä¸­å­˜å‚¨çš„ç±»ä¿¡æ¯æ‰èƒ½è¢« æœºå™¨ç ç†è§£ï¼Œ å…¶ä¸­ uintptr_t æ˜¯long 9ã€ä¸ºä»€ä¹ˆéœ€è¦å³ç§»3ä½ï¼Ÿ ä¸»è¦æ˜¯ç”±äº shiftcls å¤„äº isa æŒ‡é’ˆåœ°å€çš„ ä¸­é—´ éƒ¨åˆ†ï¼Œå‰é¢è¿˜æœ‰ 3 ä¸ªä½åŸŸï¼Œä¸ºäº†ä¸å½±å“å‰é¢çš„3ä¸ªä½åŸŸçš„æ•°æ®ï¼Œéœ€è¦ å³ç§» å°†å…¶ æŠ¹é›¶ã€‚ ã€æ–¹æ³•äºŒã€‘ï¼šé€šè¿‡ isa æŒ‡é’ˆåœ°å€ä¸ ISA_MSAK çš„å€¼ &amp; æ¥éªŒè¯1ã€åœ¨æ–¹æ³•ä¸€æ‰§è¡Œå®Œåï¼Œå›åˆ° _class_createInstanceFromZoneä¸­ï¼Œæ­¤æ—¶ isa ä¸ cls å·²ç»å…³è”å®Œæˆï¼Œæˆ‘ä»¬èµ°åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼š 2ã€æ‰§è¡Œ po obj,è¾“å‡ºå¯¹åº”çš„å€¼ï¼Œå†æ‰§è¡Œ x/4gx 0x10181ba70 å¾—åˆ° isa æŒ‡é’ˆçš„åœ°å€ 0x001d8001000020e9,å°† isa æŒ‡é’ˆåœ°å€ &amp; ISA_MASK ï¼Œå³ po 0x001d8001000020e9 &amp; 0x0000000ffffffff8ULL æˆ– po 0x001d8001000020e9 &amp; 0x00007ffffffffff8ULL ï¼Œå¾—å‡º ZJPerson __arm64__ä¸­ï¼ŒISA_MASK å®å®šä¹‰çš„å€¼ä¸º 0x0000000ffffffff8ULL __x86_64__ä¸­ï¼ŒISA_MASK å®å®šä¹‰çš„å€¼ä¸º 0x00007ffffffffff8ULL ã€æ–¹æ³•ä¸‰ã€‘ï¼šé€šè¿‡ object_getClassé€šè¿‡æŸ¥çœ‹ object_getClass çš„æºç å®ç°ï¼ŒåŒæ ·å¯ä»¥éªŒè¯ isa ä¸ ç±» å…³è”çš„åŸç†ï¼Œæœ‰ä»¥ä¸‹å‡ æ­¥ï¼š 1ã€mainä¸­å¯¼å…¥#import &lt;objc/runtime.h&gt; 2ã€é€šè¿‡ runtime çš„ apiï¼Œå³ object_getClass å‡½æ•°è·å–ç±»ä¿¡æ¯ 1object_getClass(&lt;#id _Nullable obj#&gt;) 3ã€æŸ¥çœ‹object_getClasså‡½æ•° æºç çš„å®ç° 4ã€ç‚¹å‡»è¿›å…¥object_getClass åº•å±‚å®ç° 5ã€ç‚¹å‡»getIsa è¿›å…¥æŸ¥çœ‹åº•å±‚å®ç°: 6ã€ç‚¹å‡» ISA è¿›å…¥æŸ¥çœ‹åº•å±‚å®ç°ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœæ˜¯ SUPPORT_INDEXED_ISA ç±»å‹ï¼Œæ‰§è¡Œ if æµç¨‹ï¼Œåä¹‹ æ‰§è¡Œçš„æ˜¯ else æµç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œèµ°çš„æ˜¯ else: åœ¨elseæµç¨‹ä¸­ï¼Œæ‹¿åˆ° isa çš„ bits è¿™ä¸ªä½ï¼Œå† &amp; ISA_MASKï¼Œè¿™ä¸æ–¹å¼äºŒä¸­çš„åŸç†æ˜¯ä¸€è‡´çš„ï¼Œè·å¾—å½“å‰çš„ç±»ä¿¡æ¯ ä»è¿™é‡Œä¹Ÿå¯ä»¥å¾—å‡º isa ä¸ cls å·²ç»å®Œç¾å…³è” ã€æ–¹æ³•å››ã€‘ï¼šé€šè¿‡ä½è¿ç®—1ã€å›åˆ° _class_createInstanceFromZone æ–¹æ³•ã€‚é€šè¿‡ x/4gx obj å¾—åˆ° objçš„ å†…å­˜åˆ†å¸ƒæƒ…å†µ ï¼Œå½“å‰ç±»çš„ä¿¡æ¯å­˜å‚¨åœ¨ isa æŒ‡é’ˆä¸­ï¼Œä¸” isa ä¸­çš„ shiftcls æ­¤æ—¶å  44 ä½ï¼ˆå› ä¸ºå¤„äºmacOSç¯å¢ƒï¼‰ 2ã€æƒ³è¦è¯»å–ä¸­é—´çš„ 44 ä½ ç±»ä¿¡æ¯(shiftcls)ï¼Œå°±éœ€è¦ç»è¿‡ ä½è¿ç®— ï¼Œå°† å³è¾¹3ä½ï¼Œå’Œ å·¦è¾¹17 ä½ é™¤å»ï¼Œ44ä½ä»¥å¤– çš„éƒ¨åˆ†éƒ½ æŠ¹é›¶ï¼Œå…¶ ç›¸å¯¹ä½ç½®æ˜¯ä¸å˜çš„ã€‚å…¶ä½è¿ç®—è¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼Œå…¶ä¸­shiftclså³ä¸ºéœ€è¦è¯»å–çš„ç±»ä¿¡æ¯ï¼š **3ã€å°†isaåœ°å€å³ç§»3ä½ï¼šp/x 0x001d8001000020e9 &gt;&gt; 3 ï¼Œå¾—åˆ°0x0003b0002000041d ** åœ¨å°†å¾—åˆ°çš„ 0x0003b0002000041d å·¦ç§»20ä½ï¼šp/x 0x0003b0002000041d &lt;&lt; 20 ,å¾—åˆ° 0x0002000041d00000 ä¸ºä»€ä¹ˆæ˜¯å·¦ç§»20ä½ï¼Ÿå› ä¸ºå…ˆå³ç§»äº†3ä½ï¼Œç›¸å½“äºå‘å³åç§»äº†3ä½ï¼Œè€Œå·¦è¾¹éœ€è¦æŠ¹é›¶çš„ä½æ•°æœ‰17ä½ï¼Œæ‰€ä»¥ä¸€å…±éœ€è¦ç§»åŠ¨20ä½ å°†å¾—åˆ°çš„0x0002000041d00000 å†å³ç§»17ä½ï¼šp/x 0x0002000041d00000 &gt;&gt; 17 å¾—åˆ°æ–°çš„0x00000001000020e8 è·å–clsçš„åœ°å€ ä¸ ä¸Šé¢çš„è¿›è¡ŒéªŒè¯ ï¼šp/x cls ä¹Ÿå¾—å‡º0x00000001000020e8ï¼Œæ‰€ä»¥ç”±æ­¤å¯ä»¥è¯æ˜ isa ä¸ cls æ˜¯å…³è”çš„ 4ã€ä¸ºä»€ä¹ˆå³ç§»3ä½ï¼Œå·¦ç§»20ä½ï¼Œå†å³ç§»17ä½ï¼Ÿ å› ä¸º initIsaï¼ˆåˆå§‹åŒ–isaï¼‰ ä¼ å…¥çš„æ˜¯ clsï¼ˆå³ZJPersonï¼‰ï¼Œåªæœ‰ä¸­é—´ shiftcls æ‰ å­˜å‚¨ç€ç±»çš„ä¿¡æ¯ ï¼Œåœ¨ __x86_64__ æ¶æ„æ˜¯ 44 ä½ï¼Œåœ¨ __arm64__ æ¶æ„æ˜¯ 33 ä½ï¼Œåªæœ‰åœ¨ 33ä½/44ä½ æ‰å­˜ å‚¨ç€ç±»ä¿¡æ¯ï¼Œå½“å³ç§»3ä½ï¼Œå·¦ç§»20ä½ï¼Œå†å³ç§»17ä½ï¼Œç›¸å½“äºå¤ä½ï¼Œä¸è¶³64ä½ ç³»ç»Ÿ è‡ªåŠ¨å¸®æˆ‘ä»¬ ç”¨0è¡¥å…¨ã€‚ isaè¿”å›Classç±»å‹çš„éªŒè¯1ã€æˆ‘ä»¬åœ¨å‰é¢æ¢ç´¢äº† å¯¹è±¡ çš„ æœ¬è´¨ æ˜¯ ç»“æ„ä½“ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ª å±æ€§ æ˜¯ ç»§æ‰¿ è‡ª NSObject çš„ isa æ˜¯ Class ç±»å‹çš„ï¼Œè€Œåé¢æˆ‘ä»¬é€šè¿‡ã€æ–¹æ³•ä¸‰ã€‘object_getClass éªŒè¯ isa ä¸ cls å…³è”æµç¨‹å¾—çŸ¥ï¼Œ isa æ˜¯ isa_t ç±»å‹çš„: 2ã€é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ å¤–å±‚ å¾—åˆ°çš„æ˜¯ Class çš„ isa å‘¢? æˆ‘ä»¬å…¶å®åœ¨ä¸Šé¢çš„ã€æ–¹æ³•ä¸‰ã€‘ï¼Œå·²ç»éªŒè¯äº†å…¶åŸå› ï¼Œçœ‹æºç  return (Class)(isa.bits &amp; ISA_MASK); è¿™ä¸€å¥ä»£ç å°†å…¶ å¼ºè½¬ ä¸º Class ç±»å‹æä¾›ç»™å¤–å±‚ä½¿ç”¨ã€‚","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†07ï¼šmallocæºç æ¢ç´¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†07ï¼šmallocæºç æ¢ç´¢","date":"2020-09-15T18:06:06.000Z","updated":"2022-04-21T09:34:17.000Z","comments":true,"path":"2020/09/16/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†07ï¼šmallocæºç æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/09/16/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8607%EF%BC%9Amalloc%E6%BA%90%E7%A0%81%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"å‰è¨€æˆ‘ä»¬åœ¨ OCåº•å±‚åŸç†03ï¼šalloc&amp;init&amp;newæ¢ç´¢ æ–‡ç« ä¸­ï¼Œåˆ†åˆ«å¾—çŸ¥allocæœ€æ ¸å¿ƒçš„ä¸‰ä¸ªæ“ä½œï¼š ç¬¬ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šcls-&gt;instanceSize,æˆ‘ä»¬å¾—çŸ¥æ˜¯ç”³è¯·å†…å­˜å¤§å°ï¼Œç³»ç»Ÿé»˜è®¤æ˜¯ 16 å­—èŠ‚å¯¹é½ã€‚ ç¬¬äºŒä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šcallocï¼Œå³ç”³è¯·å†…å­˜ï¼Œå³ä»Šå¤©è¦ æ¢ç´¢ çš„å†…å®¹ï¼Œå…¶å®æ¢ç´¢çš„æœ¬è´¨ä¹Ÿæ˜¯ä¸ºäº†éªŒè¯iosä¸­å¯¹è±¡ä¸­å®é™…çš„å¯¹é½æ–¹å¼æ˜¯ 8 å­—èŠ‚å¯¹é½ objc4ä¸­åˆ†æcalloc æºç ç”± OCåº•å±‚åŸç†03ï¼šalloc&amp;init&amp;newæ¢ç´¢ æ–‡ç« ä¸­å¯çŸ¥ï¼Œobj = (id)calloc(1, size)è°ƒç”¨çš„æºç ä¸åœ¨objc4ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š å®é™…ä¸Š calloc çš„æºç éœ€è¦æŸ¥çœ‹ libmallocæºç  ä¸­ï¼Œå¯ä»¥åœ¨ è¿™é‡Œ ä¸‹è½½æœ€æ–°ç‰ˆï¼Œç„¶åå»æ¢ç´¢ libmallocä¸­åˆ†æcallocæºç 1ã€ç¬¬ä¸€æ­¥:åœ¨mainä¸­ä½¿ç”¨ calloc åˆ›å»ºä¸€ä¸ªæŒ‡é’ˆ 2ã€ç¬¬äºŒæ­¥ï¼šè¿›å…¥ calloc çš„æºç å®ç°ï¼Œå…¶ä¸­çš„å…³é”®ä»£ç æ˜¯ malloc_zone_calloc å…¶ä¸­ default_zone æ˜¯ malloc_zone_t ç±»å‹ï¼š 1static malloc_zone_t *default_zone = &amp;virtual_default_zone.malloc_zone; 3ã€ç¬¬ä¸‰æ­¥:è¿›å…¥ malloc_zone_calloc çš„æºç å®ç°ï¼Œå…¶ä¸­å…³é”®ä»£ç æ˜¯ zone-&gt;calloc åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç‚¹å‡» calloc å‘ç°ï¼Œæ‰¾ä¸åˆ°ä¸‹é¢è¦æ‰§è¡Œçš„æºç äº†ï¼Œæˆ‘ä»¬é€šè¿‡ç»ˆç«¯ p zone-&gt;calloc å»æŸ¥çœ‹ä¸€ä¸‹åº•å±‚è°ƒç”¨ï¼š ç”±æ­¤å¯å‘ç°ï¼Œå†…éƒ¨èµ·å§‹è°ƒç”¨çš„æ˜¯ default_zone_calloc 4ã€ç¬¬å››æ­¥:æ–­ç‚¹è°ƒè¯•æŸ¥çœ‹ default_zone_calloc å†…éƒ¨æºç  ä¸ä¸Šé¢ä¸€æ ·ï¼Œç»ˆç«¯ p zone-&gt;calloc å»æŸ¥çœ‹ä¸€ä¸‹åº•å±‚è°ƒç”¨ï¼š ç”±æ­¤å¯å‘ç°ï¼Œå†…éƒ¨èµ·å§‹è°ƒç”¨çš„æ˜¯ nano_calloc 5ã€ç¬¬äº”æ­¥:æ–­ç‚¹è°ƒè¯•æŸ¥çœ‹ nano_calloc å†…éƒ¨æºç  å¦‚æœè¦å¼€è¾Ÿçš„ç©ºé—´å°äº NANO_MAX_SIZE åˆ™è¿›è¡Œï¼Œæˆ‘ä»¬é€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œå‘ç°æ‰§è¡Œçš„æ˜¯è¿™ä¸ªæµç¨‹ å¦åˆ™å°±è¿›è¡Œ helper_zone çš„æµç¨‹ 6ã€ç¬¬å…­æ­¥:ç‚¹è¿› _nano_malloc_check_clear æŸ¥çœ‹å†…éƒ¨æºç  7ã€ç¬¬ä¸ƒæ­¥ï¼šç‚¹è¿›å…³é”®ä»£ç  segregated_size_to_fit æŸ¥çœ‹æºç  ç”±ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ size ä¸ºä¼ å…¥ 24 ï¼Œä½†æ˜¯æœ€åè¿”å›çš„ slot_bytes å®é™…ä¸Šæ˜¯ 32ï¼Œè¯´æ˜æ˜¯ 16 ä½çš„å€æ•°ï¼Œè®¡ç®—æ–¹æ³•å›¾ä¸Šå·²ç»è¯´æ˜ 8ã€ç¬¬å…«æ­¥ï¼šå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ segregated_next_block å‡½æ•°ï¼Œband ä¸å­˜åœ¨ï¼Œç¼“å­˜ä¹Ÿä¸ä¼šå­˜åœ¨ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨segregated_band_growã€‚æ¥å¼€è¾Ÿæ–°çš„ band","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†06ï¼šå†…å­˜å¯¹é½æ¢ç´¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†06ï¼šå†…å­˜å¯¹é½æ¢ç´¢","date":"2020-09-13T18:05:22.000Z","updated":"2022-04-21T09:18:18.000Z","comments":true,"path":"2020/09/14/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†06ï¼šå†…å­˜å¯¹é½æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/09/14/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8606%EF%BC%9A%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"æŸ¥çœ‹å†…å­˜åœ°å€çš„æ–¹æ³•1ã€ã€æ–¹æ³•ä¸€ã€‘ï¼šDebug-&gt;Debug Workflow-&gt;Alway View Memory 2ã€ã€æ–¹æ³•äºŒã€‘ï¼šx åœ°å€&#x2F;x å¯¹è±¡ 1ï¼‰ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç å…·ä½“æŸ¥çœ‹ä¸€ä¸‹ä½¿ç”¨ï¼š 123456789101112@interface ZJPerson : NSObject@property (nonatomic, copy) NSString *name;@property (nonatomic, assign) int age;@end// å†…å­˜å¯¹é½ZJPerson * p = [ZJPerson alloc];p.name = @&quot;ZJ&quot;; // NSStringp.age = 30; // int NSLog(@&quot;%@&quot;,p); 2ï¼‰é€šè¿‡LLDBç¼–è¯‘å‘½ä»¤æŸ¥çœ‹å†…å­˜æƒ…å†µï¼š x 0x100867a60 ï¼šä»¥16è¿›åˆ¶æ‰“å°å½“å‰åœ°å€çš„å†…å­˜æƒ…å†µï¼ŒæŸ¥çœ‹ä¸æ–¹ä¾¿ x/4gx 0x100867a60ï¼šä»¥16è¿›åˆ¶å½¢å¼æ‰“å°4ä¸ªåœ°å€ï¼ŒæŸ¥çœ‹æ–¹ä¾¿ 0x100867a60 ï¼š å†…å­˜åœ°å€ 0x001d80010000220dï¼šisa 0x000000000000001eï¼š30 0x0000000100001010ï¼šZJ 3ï¼‰é‚£ä¹ˆ 0x100867a60ã€0x102038770 å’Œ 0x001d80010000220d 0x000000000000001e 0x0000000100001010 0x0000000000000000æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºä¸€ä¸‹ï¼š 4ï¼‰å¦‚æœæœ‰ä¸€ä¸ª double/float ç±»å‹çš„ height å‘¢ï¼Ÿ æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š 123@property (nonatomic, assign) double height;p.height = 170; // double é€šè¿‡ x/4gx p æŸ¥çœ‹æ‰“å°çš„ç»“æœ: 12(lldb) po 0x40654000000000004640185359819341824 æˆ‘ä»¬å‘ç°ç«Ÿç„¶æ²¡æœ‰æ‰“å°170ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åŸå› ï¼š16è¿›åˆ¶å’Œdouble/floatç±»å‹çš„è½¬æ¢éªŒè¯ï¼š 12(lldb) p/x (double)170(double) $7 = 0x4065400000000000 æˆ‘ä»¬å¯ä»¥å¾—åˆ°å’Œä¸Šé¢çš„åœ°å€ä¸€æŠ¹æŠ¹ä¸€æ ·æ ·ï¼Œè¿˜æœ‰è°? 5ï¼‰ä»æ‰“å°ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¸€ä¸ªé—®é¢˜ï¼Œä¸¤ä¸ªå±æ€§å ç”¨å†…å­˜ä¸æ˜¯æŒ‰ç…§å®šä¹‰å±æ€§çš„é¡ºåºï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…¶å®è¿™å°±æ˜¯ iOSä¸­çš„å†…å­˜å­—èŠ‚å¯¹é½ç°è±¡ å†…å­˜å¯¹é½çš„åŸå› å¯¹äºå¤§éƒ¨åˆ†ç¨‹åºå‘˜æ¥è¯´ï¼Œå†…å­˜å¯¹é½ å¯¹ä»–ä»¬æ¥è¯´éƒ½åº”è¯¥æ˜¯ é€æ˜çš„ã€‚ å¹³å°åŸå› (ç§»æ¤åŸå› )ï¼šä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶å¹³å°éƒ½èƒ½è®¿é—®ä»»æ„åœ°å€ä¸Šçš„ä»»æ„æ•°æ®çš„ï¼›æŸäº›ç¡¬ä»¶å¹³å°åªèƒ½åœ¨æŸäº›åœ°å€å¤„å–æŸäº›ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™æŠ›å‡ºç¡¬ä»¶å¼‚å¸¸ã€‚ æ€§èƒ½åŸå› ï¼šæ•°æ®ç»“æ„(å°¤å…¶æ˜¯æ ˆ)åº”è¯¥å°½å¯èƒ½åœ°åœ¨è‡ªç„¶è¾¹ç•Œä¸Šå¯¹é½ã€‚åŸå› åœ¨äºï¼Œä¸ºäº†è®¿é—® æœªå¯¹é½ çš„å†…å­˜ï¼Œå¤„ç†å™¨éœ€è¦ä½œ ä¸¤æ¬¡ å†…å­˜è®¿é—®ï¼›è€Œ å¯¹é½ çš„å†…å­˜ è®¿é—® ä»…éœ€è¦ ä¸€æ¬¡ è®¿é—®ã€‚ å†…å­˜å¯¹é½ä¸‰å¤§åŸåˆ™æ¯ä¸ªç‰¹å®šå¹³å°ä¸Šçš„ç¼–è¯‘å™¨éƒ½æœ‰è‡ªå·±çš„é»˜è®¤ â€œå¯¹é½ç³»æ•°â€(ä¹Ÿå«å¯¹é½æ¨¡æ•°)ã€‚ç¨‹åºå‘˜å¯ä»¥é€šè¿‡é¢„ç¼–è¯‘å‘½ä»¤#pragma pack(n)ï¼Œn&#x3D;1,2,4,8,16æ¥æ”¹å˜è¿™ä¸€ç³»æ•°ï¼Œå…¶ä¸­çš„nå°±æ˜¯ä½ è¦æŒ‡å®šçš„ â€œå¯¹é½ç³»æ•°â€ã€‚åœ¨ ios ä¸­ï¼ŒXcodeé»˜è®¤ä¸º #pragma pack(8)ï¼Œå³ 8å­—èŠ‚å¯¹é½ æ•°æ®æˆå‘˜å¯¹é½è§„åˆ™ï¼šç»“æ„(struct)æˆ–è”åˆ(union)çš„æ•°æ®æˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜æ”¾åœ¨offset ä¸º0çš„åœ°æ–¹ï¼Œä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜å­˜å‚¨çš„èµ·å§‹ä½ç½®è¦ä»è¯¥æˆå‘˜çš„å¤§å°æˆ–å­æˆå‘˜å¤§å°çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨ï¼ˆæ¯”å¦‚ int ä¸º4å­—èŠ‚ï¼Œé‚£ä¹ˆä»–çš„èµ·å§‹ä½ç½®åˆ™ä¸º 4*n ï¼‰ ç»“æ„ä½“ä½œä¸ºæˆå‘˜:å¦‚æœâ¼€ä¸ªç»“æ„â¾¥æœ‰æŸäº›ç»“æ„ä½“æˆå‘˜,åˆ™ç»“æ„ä½“æˆå‘˜è¦ä»å…¶å†…éƒ¨æœ€â¼¤å…ƒç´ â¼¤â¼©çš„æ•´æ•°å€åœ°å€å¼€å§‹å­˜å‚¨.(struct a â¾¥å­˜æœ‰ struct b ,b â¾¥æœ‰char,int ,doubleç­‰å…ƒç´ ,é‚£ b åº”è¯¥ä» 8 çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨.) ç»“æ„ä½“æ€»ä½“å¤§å°ï¼Œå¿…é¡»æ˜¯å…¶å†…éƒ¨æœ€å¤§æˆå‘˜çš„æ•´æ•°å€ï¼Œä¸è¶³è¦è¡¥é½ æ•°æ®ç±»å‹æ‰€å å­—èŠ‚ è·å–å†…å­˜çš„ä¸‰ä¸ªæ–¹æ³• sizeof æ˜¯è¿ç®—ç¬¦ï¼Œç¼–è¯‘çš„æ—¶å€™å°±æ›¿æ¢ä¸ºå¸¸æ•°ï¼Œè¿”å›çš„æ˜¯ ä¸€ä¸ªç±»å‹æ‰€å å†…å­˜çš„å¤§å° class_getInstanceSize ä¼ å…¥ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè¿”å› ä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹è‡³å°‘éœ€è¦å¤šå°‘å†…å­˜,å®ƒç­‰ä»·äºsizeofï¼Œéœ€è¦å¯¼å…¥#import &lt;objc/runtime.h&gt; malloc_sizeè¿”å› ç³»ç»Ÿå®é™…åˆ†é…çš„å†…å­˜å¤§å°ï¼Œéœ€è¦å¯¼å…¥#import &lt;malloc/malloc.h&gt; å¯¹è±¡å±æ€§å†…å­˜å¯¹é½1ã€é¦–å…ˆé€šè¿‡ä¸€ä¸ªç±»çš„å†…å­˜æ®µæ¥åˆ†æ 2ã€ç„¶åæˆ‘ä»¬ä¸‹æ–­ç‚¹ï¼Œåˆ†æä¸€ä¸‹å¯¹è±¡çš„å†…å­˜æƒ…å†µ po pï¼šæŸ¥çœ‹å½“å‰çš„å¯¹è±¡ä¿¡æ¯&lt;ZJPerson: 0x60000072f870&gt; ZJPersonä¸ºå½“å‰çš„ç±»ï¼Œ0x60000072f870 ä¸ºå½“å‰å¯¹è±¡çš„ é¦–åœ°å€ iOSä¸º å°ç«¯ æ¨¡å¼,å†…å­˜è¦ å€’ç€è¯»ï¼Œå³ 0x0000 0001 0950 2730,ä¸è¶³16ä½è¦è¡¥0ï¼Œè€Œ 0x0000 000109502730 æ˜¯æŒ‡é’ˆ isa ï¼ŒæŒ‡å‘å†…å­˜çš„é¦–åœ°å€ 0x60000072f870 x pï¼šæ„æ€æ˜¯æŸ¥çœ‹è¿™ä¸ªåœ°å€çš„å†…å­˜æƒ…å†µï¼Œå³å†…å­˜æ®µ ç”±äºå°ç«¯æ¨¡å¼ä¸å¥½è¯»å–ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªå‘½ä»¤è‡ªåŠ¨å¸®æˆ‘ä»¬æ•´ç†å¥½ x/6gx ç­‰ç­‰ x/6xg pï¼šæ„æ€å°±æ˜¯æŒ‰ç…§16è¿›åˆ¶,ä»¥6æ•´æ®µæ‰“å°å½“å‰på¯¹è±¡ æˆ‘ä»¬å‘ç°OCä¸ºæˆ‘ä»¬åšäº†ä¸€äº›ä¼˜åŒ–,æˆ‘ä»¬å‘ç°0x0000001200006261è¿™ä¸ªå†…å­˜æ®µå­˜å‚¨äº†age,char1,char2,ä¸‰ä¸ªå±æ€§ æˆ‘ä»¬ po 0x00000012 æ‰“å° 30,ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ age å±æ€§å€¼ po 0x61 0x62 æ‰“å°çš„åˆ†åˆ«ä¸º 97 98 ä¹Ÿå°±æ˜¯æˆ‘ä»¬ aå’Œbå¯¹åº”çš„ASCII ç  3ã€ä¸ºä»€ä¹ˆ ageã€c1ã€c2 ä¸‰ä¸ªå±æ€§æ”¾åœ¨ä¸€ä¸ª 8å­—èŠ‚ å†…å­˜ä¸­å‘¢? iOSç³»ç»Ÿä¸æ˜¯å¯¹æ¯ä¸€ä¸ªå±æ€§éƒ½å¼€è¾Ÿ8ä¸ªå­—èŠ‚å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ¯ä¸€ä¸ªå±æ€§éƒ½å¼€è¾Ÿ8ä¸ªå­—èŠ‚ï¼Œä¼šé€ æˆå†…å­˜æµªè´¹iOSç³»ç»Ÿé€šè¿‡å†…å­˜å¯¹é½æ–¹å¼ï¼Œå¯¹ å±æ€§é‡æ’ï¼Œå†…å­˜ä¼˜åŒ– ï¼Œ ç»“æ„ä½“å†…å­˜å¯¹é½ ç»“æ„ä½“æŒ‡é’ˆçš„å†…å­˜å¤§å°8 ç»“æ„ä½“å¤§å°æ ¹æ®å†…éƒ¨å¤§å°æ¥è®¡ç®— æˆ‘ä»¬éƒ½çŸ¥é“ å¯¹è±¡ çš„ æœ¬è´¨ æ˜¯ ç»“æ„ä½“ ï¼Œå› æ­¤ å¯¹è±¡ çš„ å†…å­˜å¯¹é½ æ¥è‡ª ç»“æ„ä½“ ï¼Œå› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸€ä¸‹æœºæ„ä½“æ˜¯å¦‚ä½•å†…å­˜å¯¹é½çš„ï¼š 1ã€struct1 1234567891011// æ™®é€šç»“æ„ä½“struct ZJStruct1 &#123; double a; // å 8ä¸ªå­—èŠ‚ èµ·å§‹ä½ç½®(0-7) char b; // å 1ä¸ªå­—èŠ‚ 8æ˜¯1çš„æ•´æ•°å€[8 1] èµ·å§‹ä½ç½®(8) int c; // å 4ä¸ªå­—èŠ‚ 9ä¸æ˜¯4çš„æ•´æ•°å€ï¼Œå¾€ä¸‹æ‰¾[9 4] 9 10 11 èµ·å§‹ä½ç½®(12 13 14 15) short d; // å 2ä¸ªå­—èŠ‚ 16æ˜¯2çš„æ•´æ•°å€[16 2] èµ·å§‹ä½ç½®(16 17)&#125;struct1;// å†…éƒ¨éœ€è¦çš„å¤§å°ä¸º: 17ä¸ªå­—èŠ‚// æœ€å¤§å±æ€§ : 8ä¸ªå­—èŠ‚// ç»“æ„ä½“æ•´æ•°å€: æœ€å¤§æˆå‘˜çš„æ•´æ•°å€ 8*3 = 24ä¸ªå­—èŠ‚ æˆ‘ä»¬é€šè¿‡å›¾æ¥åˆ†æä¸€ä¸‹struct1çš„å†…å­˜å­˜å‚¨æƒ…å†µï¼š æ ¹æ®å†…å­˜å¯¹é½è§„åˆ™ï¼Œåˆ†æZJStruct1çš„å†…å­˜è®¡ç®—ï¼š å˜é‡aï¼šå 8ä¸ªå­—èŠ‚ï¼Œä»0å¼€å§‹ï¼Œæ­¤æ—¶ 0 å­˜å‚¨ a å˜é‡bï¼šå 1ä¸ªå­—èŠ‚ï¼Œä»8å¼€å§‹ï¼Œæ­¤æ—¶8å¯ä»¥æ•´é™¤8ï¼Œå³ 8-15 å­˜å‚¨ b å˜é‡cï¼šå 4ä¸ªå­—èŠ‚ï¼Œä»9å¼€å§‹ï¼Œæ­¤æ—¶9ä¸å¯ä»¥æ•´é™¤8ï¼Œå¾€åç§»åŠ¨åˆ°12ï¼Œ12å¯ä»¥æ•´é™¤4ï¼Œå³ 12-15 å­˜å‚¨ c å˜é‡dï¼šå 2ä¸ªå­—èŠ‚ï¼Œä»16å¼€å§‹ï¼Œæ­¤æ—¶16å¯ä»¥æ•´é™¤2ï¼Œå³ 16-17 å­˜å‚¨ d å› æ­¤ZJStruct1çš„éœ€è¦çš„å†…å­˜å¤§å°ä¸º 18 å­—èŠ‚ï¼Œè€ŒZJStruct1ä¸­æœ€å¤§å˜é‡çš„å­—èŠ‚æ•°ä¸º 8ï¼Œæ‰€ä»¥ ZJStruct1 å®é™…çš„å†…å­˜å¤§å°å¿…é¡»æ˜¯ 8 çš„æ•´æ•°å€ï¼Œ18 å‘ä¸Šå–æ•´åˆ° 24ï¼Œä¸»è¦æ˜¯å› ä¸º 24 æ˜¯ 8 çš„æ•´æ•°å€ï¼Œæ‰€ä»¥ sizeof(ZJStruct1) çš„ç»“æœæ˜¯ 24 2ã€struct2 123456789101112// æ™®é€šç»“æ„ä½“struct ZJStruct2 &#123; char a; //å 1ä¸ªå­—èŠ‚ èµ·å§‹ä½ç½®(0) int b; //å 4ä¸ªå­—èŠ‚ 1ä¸æ˜¯4çš„æ•´æ•°å€ èµ·å§‹ä½ç½®(4~7) short c; //å 2ä¸ªå­—èŠ‚ 8æ˜¯2çš„å€æ•°ï¼Œèµ·å§‹ä½ç½®(8 9) double c; //å 8ä¸ªå­—èŠ‚ 10ä¸æ˜¯8çš„å€æ•° èµ·å§‹ä½ç½®(16~23) &#125;struct2;// å†…éƒ¨éœ€è¦çš„å¤§å°ä¸ºï¼š23ä¸ªå­—èŠ‚// æœ€å¤§å±æ€§ï¼š8ä¸ªå­—èŠ‚// ç»“æ„ä½“æ•´æ•°å€ï¼š8*3 = 24ä¸ªå­—èŠ‚ æˆ‘ä»¬é€šè¿‡å›¾æ¥åˆ†æä¸€ä¸‹struct1çš„å†…å­˜å­˜å‚¨æƒ…å†µï¼š æ ¹æ®å†…å­˜å¯¹é½è§„åˆ™ï¼Œåˆ†æZJStruct2çš„å†…å­˜è®¡ç®—ï¼š å˜é‡aï¼šå 1ä¸ªå­—èŠ‚ï¼Œä»0å¼€å§‹ï¼Œæ­¤æ—¶ 0 å­˜å‚¨ a å˜é‡bï¼šå 4ä¸ªå­—èŠ‚ï¼Œä»1å¼€å§‹ï¼Œæ­¤æ—¶1ä¸å¯ä»¥æ•´é™¤4ï¼Œå¾€åç§»åŠ¨åˆ°4ï¼Œæ­¤æ—¶4å¯ä»¥æ•´é™¤4ï¼Œå³ 4-7 å­˜å‚¨ b å˜é‡cï¼šå 2ä¸ªå­—èŠ‚ï¼Œä»8å¼€å§‹ï¼Œæ­¤æ—¶8å¯ä»¥æ•´é™¤2ï¼Œå³ 8-9 å­˜å‚¨ c å˜é‡dï¼šå 8ä¸ªå­—èŠ‚ï¼Œä»10å¼€å§‹ï¼Œæ­¤æ—¶10ä¸å¯ä»¥æ•´é™¤2ï¼Œå¾€åç§»åŠ¨åˆ°16ï¼Œ16å¯ä»¥æ•´é™¤8ï¼Œå³ 16-23 å­˜å‚¨ d å› æ­¤ ZJStruct2 çš„éœ€è¦çš„å†…å­˜å¤§å°ä¸º 24 å­—èŠ‚ï¼Œè€ŒZJStruct1ä¸­æœ€å¤§å˜é‡çš„å­—èŠ‚æ•°ä¸º 8ï¼Œæ‰€ä»¥ ZJStruct1 å®é™…çš„å†…å­˜å¤§å°å¿…é¡»æ˜¯ 8 çš„æ•´æ•°å€ï¼Œ24 å‘ä¸Šå–æ•´åˆ° 24ï¼Œä¸»è¦æ˜¯å› ä¸º 24 æ˜¯ 8 çš„æ•´æ•°å€ï¼Œæ‰€ä»¥ sizeof(ZJStruct2) çš„ç»“æœæ˜¯ 24 3ã€struct3 12345678910111213141516// åµŒå¥—ç»“æ„ä½“struct ZJStruct3 &#123; char a; //å 1ä¸ªå­—èŠ‚ int b; //å 4ä¸ªå­—èŠ‚ short c; //å 2ä¸ªå­—èŠ‚&#125;struct3;struct ZJStruct4 &#123; double a; //å 8ä¸ªå­—èŠ‚ èµ·å§‹ä½ç½®(0~7) int b; //å 4ä¸ªå­—èŠ‚ 8æ˜¯4çš„æ•´æ•°å€[8 4] èµ·å§‹ä½ç½®(8 9 10 11) struct ZJStruct3 s3; // char(12) int(16,17,18,19) short(20,21) ç»“æ„ä½“å†…éƒ¨è¦å¯¹é½ï¼ˆ4*3=12ï¼‰è¡¥22,23 short c; //å 2ä¸ªå­—èŠ‚ 24æ˜¯2çš„æ•´æ•°å€ (24,25)&#125;struct4;// å†…éƒ¨éœ€è¦çš„å¤§å°ï¼š25ä¸ªå­—èŠ‚// æœ€å¤§å±æ€§ï¼š8ä¸ªå­—èŠ‚// ç»“æ„ä½“æ•´æ•°å€ï¼š8*4 = 32ä¸ªå­—èŠ‚ æˆ‘ä»¬é€šè¿‡å›¾æ¥åˆ†æä¸€ä¸‹struct3çš„å†…å­˜å­˜å‚¨æƒ…å†µï¼š æ ¹æ®å†…å­˜å¯¹é½è§„åˆ™ï¼Œåˆ†æZJStruct3çš„å†…å­˜è®¡ç®—ï¼š å˜é‡aï¼šå 8ä¸ªå­—èŠ‚ï¼Œä»0å¼€å§‹ï¼Œæ­¤æ—¶ 0-7 å­˜å‚¨ a å˜é‡bï¼šå 4ä¸ªå­—èŠ‚ï¼Œä»8å¼€å§‹ï¼Œæ­¤æ—¶8å¯ä»¥æ•´é™¤4ï¼Œå³ 8-11 å­˜å‚¨ b ç»“æ„ä½“æˆå‘˜s1ï¼šs1æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ ¹æ®å†…å­˜å¯¹é½åŸåˆ™äºŒï¼Œç»“æ„ä½“æˆå‘˜è¦ä»å…¶å†…éƒ¨æœ€å¤§æˆå‘˜å¤§å°çš„æ•´æ•°å€å¼€å§‹å­˜å‚¨ï¼Œè€ŒZJStruct3ä¸­æœ€å¤§çš„æˆå‘˜å¤§å°ä¸º4ï¼Œæ‰€ä»¥s3è¦ä»4çš„æ•´æ•°å€å¼€å§‹ï¼Œå½“å‰æ˜¯ä»12å¼€å§‹ï¼Œæ‰€ä»¥ç¬¦åˆè¦æ±‚ï¼Œ12æ˜¯4çš„æ•´æ•°å€ï¼Œç¬¦åˆå†…å­˜å¯¹é½åŸåˆ™ï¼Œæ‰€ä»¥ 12å¼€å§‹ å˜é‡aï¼šå 1ä¸ªå­—èŠ‚ï¼Œä»12å¼€å§‹ï¼Œæ­¤æ—¶12å¯ä»¥æ•´é™¤4ï¼Œå³ 12 å­˜å‚¨ a å˜é‡bï¼šå 4ä¸ªå­—èŠ‚ï¼Œä»13å¼€å§‹ï¼Œæ­¤æ—¶13ä¸å¯ä»¥æ•´é™¤4ï¼Œå¾€åç§»åŠ¨åˆ°16ï¼Œæ­¤æ—¶16å¯ä»¥æ•´é™¤4ï¼Œå³ 16-19 å­˜å‚¨ b å˜é‡cï¼šå 2ä¸ªå­—èŠ‚ï¼Œä»20å¼€å§‹ï¼Œ20å¯ä»¥æ•´é™¤2ï¼Œå³ 20-21 å­˜å‚¨ c ç”±äºç»“æ„ä½“å†…éƒ¨çš„å­—èŠ‚å¯¹é½åŸåˆ™4çš„æ•´æ•°å€ï¼Œåé¢è¦è¡¥ä¸Š22ï¼Œ23ï¼Œæ­¤æ—¶12-23æ­£å¥½æ˜¯4çš„æ•´æ•°å€ï¼Œå³4*3 å˜é‡cï¼šå 2ä¸ªå­—èŠ‚ï¼Œä»24å¼€å§‹ï¼Œ24å¯ä»¥æ•´é™¤2ï¼Œå³ 24-25 å­˜å‚¨ c å› æ­¤ZJStruct4çš„éœ€è¦çš„å†…å­˜å¤§å°ä¸º 26 å­—èŠ‚ï¼Œè€ŒZJStruct4ä¸­æœ€å¤§å˜é‡çš„å­—èŠ‚æ•°ä¸º 8ï¼Œæ‰€ä»¥ ZJStruct4 å®é™…çš„å†…å­˜å¤§å°å¿…é¡»æ˜¯ 8 çš„æ•´æ•°å€ï¼Œ26 å‘ä¸Šå–æ•´åˆ° 32ï¼Œä¸»è¦æ˜¯å› ä¸º 32 æ˜¯ 8 çš„æ•´æ•°å€ï¼Œæ‰€ä»¥ sizeof(ZJStruct4) çš„ç»“æœæ˜¯ 32 4ã€æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„åˆ†ææ¥å®é™…éªŒè¯ä¸€ä¸‹ç»“æœï¼š 12345// æ‰“å°ç»“æ„ä½“å†…å­˜å¤§å°NSLog(@&quot;%lu-%lu-%lu-%lu&quot;,sizeof(struct1),sizeof(struct2),sizeof(struct4),sizeof(struct4.s3)); *******æ‰“å°ç»“æœ******2020-09-15 20:23:52.275929+0800 001-å†…å­˜å¯¹é½åŸåˆ™[25197:515659] 24-16-32-12 ç»“æœæ˜¾ç¤ºæˆ‘ä»¬åˆ†æçš„ç»“æœæ˜¯æ­£ç¡®çš„ å†…å­˜ä¼˜åŒ–ï¼ˆå±æ€§é‡æ’ï¼‰ å¦‚æœæ˜¯ç»“æ„ä½“ä¸­æ•°æ®æˆå‘˜æ˜¯æ ¹æ®å†…å­˜ ä»å°åˆ°å¤§çš„é¡ºåºå®šä¹‰ çš„ï¼Œæ ¹æ®å†…å­˜å¯¹é½è§„åˆ™æ¥è®¡ç®—ç»“æ„ä½“å†…å­˜å¤§å°ï¼Œéœ€è¦å¢åŠ æœ‰è¾ƒå¤§çš„å†…å­˜paddingå³å†…å­˜å ä½ç¬¦ï¼Œæ‰èƒ½æ»¡è¶³å†…å­˜å¯¹é½è§„åˆ™ï¼Œæ¯”è¾ƒ æµªè´¹å†…å­˜ å¦‚æœæ˜¯ç»“æ„ä½“ä¸­æ•°æ®æˆå‘˜æ˜¯æ ¹æ®å†…å­˜ ä»å¤§åˆ°å°çš„é¡ºåºå®šä¹‰ çš„ï¼Œæ ¹æ®å†…å­˜å¯¹é½è§„åˆ™æ¥è®¡ç®—ç»“æ„ä½“å†…å­˜å¤§å°ï¼Œæˆ‘ä»¬åªéœ€è¦è¡¥é½å°‘é‡å†…å­˜paddingå³å¯æ»¡è¶³å †å­˜å¯¹é½è§„åˆ™ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯è‹¹æœä¸­é‡‡ç”¨çš„ï¼Œåˆ©ç”¨ ç©ºé—´æ¢æ—¶é—´ ï¼Œå°†ç±»ä¸­çš„å±æ€§è¿›è¡Œé‡æ’ï¼Œæ¥è¾¾åˆ°ä¼˜åŒ–å†…å­˜çš„ç›®çš„ ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¿›è¡Œè¯´æ˜ è‹¹æœä¸­å±æ€§é‡æ’ï¼Œå³å†…å­˜ä¼˜åŒ–ï¼š 1ã€æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ªç±»ZJPersonï¼Œå¹¶å®šä¹‰å‡ ä¸ªå±æ€§ï¼Œæ¥åˆ†æä¸€ä¸‹ 12345678@interface ZJPerson : NSObject@property (nonatomic, copy) NSString * name;@property (nonatomic, copy) NSString *nickName;@property (nonatomic, assign) int age;@property (nonatomic, assign) long height;@property (nonatomic) char c1;@property (nonatomic) char c2;@end 2ã€åœ¨mainä¸­åˆ›å»ºZJPersonçš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶å¯¹å…¶ä¸­çš„å‡ ä¸ªå±æ€§èµ‹å€¼ 12345678910111213141516171819202122232425#import &lt;Foundation/Foundation.h&gt;#import &lt;objc/runtime.h&gt;#import &lt;malloc/malloc.h&gt;#import &quot;ZJPerson.h&quot;int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // insert code here... // å¯¹è±¡çš„å†…å­˜å¯¹é½ - å¯¹è±¡çš„å†…å­˜å¯¹é½æ¥è‡ªç»“æ„ä½“ ZJPerson * p = [ZJPerson alloc]; //å 8å­—èŠ‚ p.name = @&quot;ZJ&quot;; //å 8ä¸ªå­—èŠ‚ p.nickName = @&quot;å°J&quot;; //å 8ä¸ªå­—èŠ‚ p.age = 30; //å 4ä¸ªå­—èŠ‚ p.c1 = &#x27;a&#x27;; //å 1ä¸ªå­—èŠ‚ p.c2 = &#x27;b&#x27;; //å 1ä¸ªå­—èŠ‚ NSLog(@&quot;%@ - %lu - %lu - %lu&quot;,p,sizeof(p),class_getInstanceSize([p class]),malloc_size((__bridge const void *)(p))); &#125; return 0;&#125;********æ‰“å°ç»“æœ******2020-09-13 23:48:30.357717+0800 KCObjc[84742:2078708] &lt;ZJPerson: 0x100660120&gt; - 8 - 40 - 48 3ã€æ–­ç‚¹è°ƒè¯•pï¼Œæ ¹æ®ZJPersonçš„å¯¹è±¡åœ°å€ï¼ŒæŸ¥æ‰¾å‡ºå±æ€§çš„å€¼ï¼š å½“æˆ‘ä»¬å‘é€šè¿‡ 0x0000001e00006261 åœ°å€æ‰¾å‡º age ç­‰æ•°æ®æ—¶ï¼Œå‘ç°æ˜¯ ä¹±ç ï¼Œè¿™é‡Œæ— æ³•æ‰¾å‡ºå€¼çš„åŸå› æ˜¯è‹¹æœä¸­é’ˆå¯¹ ageã€c1ã€c2 å±æ€§çš„å†…å­˜è¿›è¡Œäº†é‡æ’ï¼Œå› ä¸º age ç±»å‹å  4 ä¸ªå­—èŠ‚ï¼Œc1 å’Œ c2 ç±»å‹ char åˆ†åˆ«å  1 ä¸ªå­—èŠ‚ï¼Œé€šè¿‡ 4+1+1 çš„æ–¹å¼ï¼ŒæŒ‰ç…§ 8 å­—èŠ‚å¯¹é½ï¼Œä¸è¶³è¡¥é½çš„æ–¹å¼å­˜å‚¨åœ¨åŒä¸€å—å†…å­˜ä¸­ æˆ‘ä»¬é€šè¿‡po 0x000000010d671058æ‰¾å‡ºnameçš„å€¼ZJï¼Œé€šè¿‡po 0x000000010d671078æ‰¾å‡ºnickNameçš„å€¼å°J 4ã€æ‰€ä»¥ï¼Œè¿™é‡Œå¯ä»¥æ€»ç»“ä¸‹è‹¹æœä¸­çš„å†…å­˜å¯¹é½æ€æƒ³ï¼š å¤§éƒ¨åˆ†çš„å†…å­˜éƒ½æ˜¯é€šè¿‡å›ºå®šçš„å†…å­˜å—è¿›è¡Œè¯»å–ï¼Œå°½ç®¡æˆ‘ä»¬åœ¨å†…å­˜ä¸­é‡‡ç”¨äº†å†…å­˜å¯¹é½çš„æ–¹å¼ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å†…å­˜éƒ½å¯ä»¥è¿›è¡Œæµªè´¹çš„ï¼Œè‹¹æœä¼šè‡ªåŠ¨ å¯¹å±æ€§è¿›è¡Œé‡æ’ï¼Œä»¥æ­¤æ¥ ä¼˜åŒ–å†…å­˜ å­—èŠ‚å¯¹é½åˆ°åº•é‡‡ç”¨å¤šå°‘å­—èŠ‚å¯¹é½ï¼Ÿåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åœ¨å‰æ–‡æ—¢æåˆ°äº† 8 å­—èŠ‚å¯¹é½ï¼Œä¹ŸæåŠäº† 16 å­—èŠ‚å¯¹é½ï¼Œé‚£æˆ‘ä»¬åˆ°åº•é‡‡ç”¨å“ªç§å­—èŠ‚å¯¹é½å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡ objc4 ä¸­çš„æºç æ¥è¿›è¡Œåˆ†æ 1ã€å®ä¾‹å¯¹è±¡å¼€è¾Ÿå†…å­˜çš„æµç¨‹å¦‚ä¸‹ï¼š 1ï¼‰class_getInstanceSizeå†…éƒ¨å®ç°å¦‚ä¸‹: 1234567891011/** * Returns the size of instances of a class. * * @param cls A class object. * * @return The size in bytes of instances of the class \\e cls, or \\c 0 if \\e cls is \\c Nil. */OBJC_EXPORT size_tclass_getInstanceSize(Class _Nullable cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_getInstanceSizeå†…éƒ¨è°ƒç”¨alignedInstanceSize 1234// Class&#x27;s ivar size rounded up to a pointer-size boundary. uint32_t alignedInstanceSize() const &#123; return word_align(unalignedInstanceSize()); &#125; word_alignå†…éƒ¨è°ƒç”¨å¦‚ä¸‹ï¼š 12345678910111213#ifdef __LP64__# define WORD_SHIFT 3UL# define WORD_MASK 7UL# define WORD_BITS 64#else# define WORD_SHIFT 2UL# define WORD_MASK 3UL# define WORD_BITS 32#endifstatic inline uint32_t word_align(uint32_t x) &#123; return (x + WORD_MASK) &amp; ~WORD_MASK;&#125; ç”±æºç å¯çŸ¥ï¼š(x + WORD_MASK) &amp; ~WORD_MASKæ˜¯ä¸€ä¸ªè¿ç®—ï¼Œä»£è¡¨ 8 å­—èŠ‚å¯¹é½ 2ã€ä¸ºä»€ä¹ˆå¯¹è±¡çœŸæ­£å¼€è¾Ÿå†…å­˜æ˜¯8å­—èŠ‚å¯¹é½ï¼Ÿç³»ç»Ÿä¸ºå¯¹è±¡å¼€è¾Ÿçš„æ˜¯16å­—èŠ‚å¯¹é½? appleç³»ç»Ÿä¸ºäº† é˜²æ­¢ä¸€åˆ‡çš„å®¹é”™ï¼Œé‡‡ç”¨çš„æ˜¯ 16 å­—èŠ‚å¯¹é½çš„å†…å­˜ï¼Œä¸»è¦æ˜¯å› ä¸ºé‡‡ç”¨ 8 å­—èŠ‚å¯¹é½æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜ä¼šç´§æŒ¨ç€ï¼Œæ˜¾å¾— æ¯”è¾ƒç´§å‡‘ï¼Œè€Œ 16 å­—èŠ‚ æ¯”è¾ƒå®½æ¾ï¼Œåˆ©äºè‹¹æœä»¥åçš„æ‰©å±•ã€‚ 8å­—èŠ‚å†…å­˜è®¡ç®—ç”±æ–­ç‚¹å¯çŸ¥æ­¤æ—¶çš„xä¸º40ï¼ŒWORD_MASKä¸º7ï¼Œæˆ‘ä»¬æ¥è®¡ç®—ä¸€ä¸‹ï¼š(x + WORD_MASK) &amp; ~WORD_MASK 1234567891011121314152^5 = 32 2^4 = 16 2^3 = 8 2^2 = 4 2^1 = 2 2^0 = 140 + 7 = 47 = 32 + 8 + 4 + 2 + 1 16è¿›åˆ¶è¡¨ç¤º0000 0000 0010 1111 70000 0000 0000 01117å–å~1111 1111 1111 1000 47 &amp; ~70000 0000 0010 11111111 1111 1111 1000-----------------------0000 0000 0010 1000 = 40 ç”±ç»“æœ40å¯çŸ¥ï¼Œä¸class_getInstanceSizeè·å–å®ä¾‹å¯¹è±¡çš„å¤§å°40å¦‚ä½•å»åˆï¼Œè¿˜æœ‰è°ï¼Ÿ æ€»ç»“ class_getInstanceSizeï¼šæ˜¯é‡‡ç”¨ 8 å­—èŠ‚å¯¹é½ï¼Œå‚ç…§çš„å¯¹è±¡çš„å±æ€§å†…å­˜å¤§å° malloc_sizeï¼šé‡‡ç”¨ 16 å­—èŠ‚å¯¹é½ï¼Œå‚ç…§çš„æ•´ä¸ªå¯¹è±¡çš„å†…å­˜å¤§å°ï¼Œå¯¹è±¡å®é™…åˆ†é…çš„å†…å­˜å¤§å°å¿…é¡»æ˜¯ 16 çš„æ•´æ•°å€","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†05ï¼šobjc_allocæ¢ç´¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†05ï¼šobjc-allocæ¢ç´¢","date":"2020-09-11T18:04:27.000Z","updated":"2022-04-21T08:50:42.000Z","comments":true,"path":"2020/09/12/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†05ï¼šobjc-allocæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/09/12/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8605%EF%BC%9Aobjc-alloc%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"å‰è¨€æœ¬ç« ä¸»è¦æ¢ç´¢ç»§æ‰¿è‡ª NSObject çš„ç±» ZJPerson å’Œ NSObject è°ƒç”¨ alloc çš„åŒºåˆ« å‡†å¤‡å·¥ä½œ1ã€ä¸‹è½½objc4-781 æºç ã€‚ 2ã€ç¼–è¯‘æºç ï¼Œå¯å‚è€ƒiOS-OCåº•å±‚åŸç†02ï¼šObjc4æºç ç¼–è¯‘ NSObjectè°ƒç”¨allocæ¢ç´¢1ã€ç¬¬ä¸€æ­¥ï¼šåœ¨mainå‡½æ•°ä¸­å®ç°ä¸‹é¢çš„ä»£ç ï¼Œå¹¶ä¸‹æ–­ç‚¹ï¼š 2ã€ç¬¬äºŒæ­¥ï¼šåˆ°æºç ä¸‹æ–­ç‚¹åˆ° + (id)allocï¼Œå…ˆ å–æ¶ˆæ–­ç‚¹ï¼Œç­‰ç¨‹åºè¿è¡Œåˆ°ç›®æ ‡è¡Œåœ¨å»è·Ÿè¸ªæ–­ç‚¹ï¼ŒåŸå› åœ¨å‰é¢æŸ¥æ‰¾æºç å·²ç»è®²è¿‡ï¼Œåœ¨æ­¤ä¸åœ¨è¯´æ˜ï¼š æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰è¿›æ¥ï¼Œæˆ‘æ»´å¤©å‘ï¼Œè¯´æ˜è°ƒç”¨çš„ä¸æ˜¯ alloc 3ã€ç¬¬ä¸‰æ­¥ï¼šæˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼å»æŸ¥çœ‹æºç ï¼Œæ‰“å¼€Debug-&gt;Debug WorkFlow-&gt;Debug-&gt;Debug Workflow-&gt;Alway Show DisassemblyæŸ¥çœ‹æ±‡ç¼–ï¼š æˆ‘ä»¬å‘ç°åº•å±‚æºç è°ƒç”¨çš„æ˜¯ objc_alloc ï¼Œåˆ°åº•æ˜¯ä¸æ˜¯å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬ äºŒæ¬¡éªŒè¯ ä¸€ä¸‹ **4ã€ç¬¬å››æ­¥:äºŒæ¬¡éªŒè¯-&gt;å…ˆå–æ¶ˆDebugæŸ¥çœ‹æ–¹å¼ï¼Œåˆ°æºç ä¸­ä¸‹æ–­ç‚¹åˆ° objc_alloc ** æˆ‘ä»¬å‘ç° Class cls è¿™ä¸ªç±»ç¡®å®æ˜¯ NSObject ,éªŒè¯äº†æˆ‘ä»¬ä¸Šé¢çš„è°ƒç”¨è¿‡ç¨‹ 5ã€ç¬¬äº”æ­¥ï¼šç»§ç»­å¾€ä¸‹èµ°ï¼ŒcallAlloc å†…éƒ¨è°ƒç”¨æµç¨‹ æˆ‘ä»¬å‘ç° callAlloc å†…éƒ¨æœ€ç»ˆè°ƒç”¨çš„æ˜¯ _objc_rootAllocWithZone æœ€ç»ˆå’ŒiOS-OCåº•å±‚åŸç†03ï¼šalloc&amp;init&amp;newæ¢ç´¢allocè°ƒç”¨æµç¨‹ä¸è°‹è€Œåˆ 6ã€ç»“è®ºï¼šæˆ‘ä»¬ç”¨æµç¨‹å›¾å»è¡¨è¾¾ä¸€ä¸‹è°ƒç”¨æµç¨‹ ç»§æ‰¿ç±»ZPersonè°ƒç”¨allocçœŸå®è°ƒç”¨æµç¨‹1ã€ç¬¬ä¸€æ­¥ï¼šåœ¨ main å‡½æ•°ä¸­å®ç° ZJPerson ç±»çš„ alloc æ–¹æ³•è¿›å…¥allocæ–¹æ³•ï¼Œå¹¶ä¸‹æ–­ç‚¹ï¼š 2ã€ç¬¬äºŒæ­¥ï¼šæ‰“å¼€ Debug-&gt;Debug WorkFlow-&gt;Debug-&gt;Debug Workflow-&gt;Alway Show Disassembly æŸ¥çœ‹æ±‡ç¼–ï¼š 3ã€ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡åœ¨æºç ä¸­ä¸‹æ–­ç‚¹ objc_alloc å’Œ alloc å»è·Ÿè¸ªå…·ä½“å…ˆæ‰§è¡Œè¿‡ç¨‹ï¼š 1234567è·³è½¬è‡³objc_allocçš„æºç å®ç°// Calls [cls alloc].idobjc_alloc(Class cls)&#123; return callAlloc(cls, true/*checkNil*/, false/*allocWithZone*/);&#125; 4ã€ç¬¬å››æ­¥ï¼šè·³è½¬è‡³ callAlloc çš„æºç å®ç° 12345678910111213141516171819202122// Call [cls alloc] or [cls allocWithZone:nil], with appropriate // shortcutting optimizations.static ALWAYS_INLINE idcallAlloc(Class cls, bool checkNil, bool allocWithZone=false)&#123;#if __OBJC2__ // checkNil:true if (slowpath(checkNil &amp;&amp; !cls)) return nil; if (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) &#123; // cls NSObject return _objc_rootAllocWithZone(cls, nil); &#125;#endif // No shortcuts available. // allocWithZone : false if (allocWithZone) &#123; return ((id(*)(id, SEL, struct _NSZone *))objc_msgSend)(cls, @selector(allocWithZone:), nil); &#125; return ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc));&#125; 5ã€ç¬¬äº”æ­¥ï¼šè·³è½¬è‡³ return ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc)); çš„å†…éƒ¨æºç å®ç° 12objc_msgSend(void /* id self, SEL op, ... */ ) OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); ç³»ç»Ÿé€šè¿‡ç‰¹æ®Šæ¶ˆæ¯å‘é€ï¼šsel - imp åšäº†ä¸€å±‚å¤„ç†ï¼Œæœ€ç»ˆæ‰§è¡Œåˆ° allocï¼Œæ ¹æœ¬å°±æ˜¯ç³»ç»Ÿé€šè¿‡LLVMç‰¹æ®Šæ¶ˆæ¯å‘é€åšçš„å¤„ç†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡LLVMæºç å»æ¢ç´¢ä¸€ä¸‹ 6ã€ç¬¬å…­æ­¥ï¼šè·³è½¬è‡³ alloc æºç å®ç° 123+ (id)alloc &#123; return _objc_rootAlloc(self);&#125; 7ã€ç¬¬ä¸ƒæ­¥ï¼šè·³è½¬è‡³ _objc_rootAlloc æºç å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯ cls æ˜¯ZJPerson 8ã€ç¬¬å…«æ­¥ï¼šè·³è½¬è‡³ _objc_rootAllocWithZone æºç å®ç° 123456789101112131415161718192021// Call [cls alloc] or [cls allocWithZone:nil], with appropriate // shortcutting optimizations.static ALWAYS_INLINE idcallAlloc(Class cls, bool checkNil, bool allocWithZone=false)&#123;#if __OBJC2__ // checkNil:true if (slowpath(checkNil &amp;&amp; !cls)) return nil; if (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) &#123; // cls NSObject return _objc_rootAllocWithZone(cls, nil); &#125;#endif // No shortcuts available. // allocWithZone : false if (allocWithZone) &#123; return ((id(*)(id, SEL, struct _NSZone *))objc_msgSend)(cls, @selector(allocWithZone:), nil); &#125; return ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc));&#125; 9ã€ç¬¬ä¹æ­¥ï¼šè·³è½¬è‡³ _class_createInstanceFromZone æºç å®ç° 12345678NEVER_INLINEid_objc_rootAllocWithZone(Class cls, malloc_zone_t *zone __unused)&#123; // allocWithZone under __OBJC2__ ignores the zone parameter return _class_createInstanceFromZone(cls, 0, nil, OBJECT_CONSTRUCT_CALL_BADALLOC);&#125; 10ã€ç¬¬åæ­¥ï¼šå†…éƒ¨è°ƒç”¨ cls-&gt;instanceSizeã€callocã€obj-&gt;initInstanceIsa(cls, hasCxxDtor)ã€return obj æ–¹æ³•è¿”å›å¯¹è±¡ï¼Œå…·ä½“æµç¨‹ä¸å†èµ˜è¿° 11ã€æ€»ç»“:ZJPersonçš„allocè°ƒç”¨æµç¨‹å›¾: ZJPersonçš„allocå’ŒNSObjectçš„allocåŒºåˆ« ZJPerson ä¼šèµ°ä¸¤æ¬¡ objc_alloc -&gt; alloc NSObject åªèµ°ä¸€æ¬¡ objc_alloc","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†04ï¼šOptimization-Level-ä¼˜åŒ–ç­‰çº§","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†04ï¼šOptimization-Level-ä¼˜åŒ–ç­‰çº§","date":"2020-09-08T17:30:34.000Z","updated":"2022-04-21T09:25:29.000Z","comments":true,"path":"2020/09/09/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†04ï¼šOptimization-Level-ä¼˜åŒ–ç­‰çº§/","link":"","permalink":"https://www.bboyzj.cn/2020/09/09/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8604%EF%BC%9AOptimization-Level-%E4%BC%98%E5%8C%96%E7%AD%89%E7%BA%A7/","excerpt":"","text":"å‰è¨€Optimization Level æ˜¯ç¼–è¯‘å™¨çš„ä¼˜åŒ–ç¨‹åº¦ã€‚æ¯”è¾ƒæ—©æœŸçš„æ—¶å€™ï¼Œç¡¬ä»¶èµ„æºæ˜¯æ¯”è¾ƒç¼ºä¹çš„ã€‚ä¸ºäº† æé«˜æ€§èƒ½ï¼Œå¼€å‘ç¼–è¯‘å™¨çš„å¤§å¸ˆä»¬ï¼Œéƒ½ä¼šå¯¹ç¼–è¯‘å™¨(ä»cåˆ°æ±‡ç¼–çš„ç¼–è¯‘è¿‡ç¨‹)åŠ ä¸Šä¸€å®šçš„ä¼˜åŒ–ç­–ç•¥ã€‚ä¼˜åŒ–åçš„ä»£ç æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯å¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œä¸”ç¼–è¯‘æ—¶é—´æ›´é•¿ã€‚ Optimization Levelä¸‹é¢æˆ‘ç”¨ä¸€å¼ æˆªå›¾è¡¨ç¤ºè®¾ç½®çš„ä½ç½® ç¼–è¯‘å™¨ä¼˜åŒ–è®¾ç½®åœ¨target-&gt;Build Settings-&gt;Optimization Levelä¸‹,å¦‚å›¾: 1ï¼‰ä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼Debugå’ŒRelease Debugä¸‹é»˜è®¤æ˜¯å…³é—­ é»˜è®¤æ˜¯ None[-O0] Releaseæ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸€äº›ä»£ç ,è¿™æ ·ç”Ÿæˆçš„ç¨‹åºæ€§èƒ½æ˜¯æœ€ä¼˜çš„ã€‚é»˜è®¤æ˜¯ Fastest,Smallest[-Os] 2ï¼‰Optimization Levelå¯ä»¥è®¾ç½®ä»£ç çš„ä¼˜åŒ–ç­‰çº§ã€‚ Noneï¼šä¸ä¼˜åŒ–ã€‚[-O0]ä¸æ­¤è®¾ç½®,ç¼–è¯‘å™¨çš„ç›®æ ‡æ˜¯é™ä½æˆæœ¬çš„ç¼–è¯‘å’Œè°ƒè¯•äº§ç”Ÿé¢„æœŸçš„ç»“æœã€‚è¯­å¥æ˜¯ç‹¬ç«‹çš„:å¦‚æœä½ åœæ­¢ç¨‹åºè¯­å¥ä¹‹é—´æœ‰ä¸€ä¸ªæ–­ç‚¹,ç„¶åæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªæ–°å€¼çš„ä»»ä½•å˜é‡æˆ–ä»»ä½•å…¶ä»–å£°æ˜æ”¹å˜ç¨‹åºè®¡æ•°å™¨çš„åŠŸèƒ½å’Œå¾—åˆ°ä½ æœŸæœ›çš„ç»“æœä»æºä»£ç ã€‚ Fastï¼šä¼˜åŒ–ç¼–è¯‘éœ€è¦æ›´å¤šçš„æ—¶é—´,å’Œæ›´å¤šçš„å†…å­˜å¤§çš„åŠŸèƒ½ã€‚[-O,O1]ä¸æ­¤è®¾ç½®,ç¼–è¯‘å™¨è¯•å›¾å‡å°‘ä»£ç å¤§å°å’Œæ‰§è¡Œæ—¶é—´,æ²¡æœ‰æ‰§è¡Œä»»ä½•ä¼˜åŒ–,éœ€è¦å¤§é‡çš„ç¼–è¯‘æ—¶é—´ã€‚åœ¨è‹¹æœçš„ç¼–è¯‘å™¨,ä¸¥æ ¼çš„æ··å ,é˜»æŒ¡é‡æ–°æ’åº,å¹¶å†…åµŒè°ƒåº¦ä¼˜åŒ–æ—¶é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚ Fasterï¼šç¼–è¯‘å™¨æ‰§è¡Œå‡ ä¹æ‰€æœ‰æ”¯æŒä¼˜åŒ–,ä¸æ¶‰åŠspace-speedæƒè¡¡ã€‚[-O2]ä¸æ­¤è®¾ç½®,ç¼–è¯‘å™¨ä¸æ‰§è¡Œå¾ªç¯å±•å¼€æˆ–å†…è”å‡½æ•°,æˆ–å¯„å­˜å™¨é‡å‘½åã€‚ç›¸æ¯”â€œå¿«é€Ÿâ€çš„è®¾ç½®,è¯¥è®¾ç½®å¢åŠ ç¼–è¯‘æ—¶é—´å’Œç”Ÿæˆçš„ä»£ç çš„æ€§èƒ½ã€‚ Fastestï¼šæ‰“å¼€ æ›´å¿« æŒ‡å®šçš„ä¼˜åŒ–è®¾ç½®,ä¹Ÿå–å†³äºå‡½æ•°å†…è”å’Œå¯„å­˜å™¨é‡å‘½åé€‰é¡¹ã€‚æ­¤è®¾ç½®å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªæ›´å¤§çš„äºŒè¿›åˆ¶ã€‚ Fastest [-O3]ï¼šæœ€å°çš„ä¼˜åŒ–å°ºå¯¸ã€‚è¿™ä¸ªè®¾ç½®å…è®¸æ‰€æœ‰ æ›´å¿« çš„ä¼˜åŒ–é€šå¸¸ä¸å¢åŠ ä»£ç å¤§å°ã€‚å®ƒè¿˜æ—¨åœ¨å‡å°‘ä»£ç çš„å¤§å°è¿›è¡Œè¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚ é€šè¿‡ä¸‹é¢çš„ä»£ç æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾æ–¹å¼å»åˆ‡æ¢Debugå’ŒReleaseæ¨¡å¼è¿è¡Œåœ¨çœŸæœºï¼š 1ã€åœ¨çœŸæœºDebugæ¨¡å¼ä¸‹è¿è¡Œï¼ŒæŸ¥çœ‹å †æ ˆä¿¡æ¯ æ³¨:xä»£è¡¨çš„æ˜¯arm64æ“ä½œç³»ç»Ÿï¼Œwä»£è¡¨çš„æ˜¯arm32ä½æ“ä½œç³»ç»Ÿï¼Œä¸ºäº†èŠ‚çœèµ„æºï¼Œæ‰€ä»¥åœ¨çœŸæœºä¸‹ç”¨çš„æ˜¯arm32ä¸ºwæ¥å­˜å‚¨æ•°æ® æˆ‘ä»¬é€šè¿‡LLDBè°ƒè¯•å…·ä½“æ‰“å°ï¼š 12345678910111213warning: failed to set breakpoint site at 0x104336290 for breakpoint 3.1: error: 0 sending the breakpoint request(lldb) po 0xa10(lldb) po 0x1420(lldb) register read w8 w8 = 0x0000001e(lldb) po 0x0000001e30(lldb) po(print object): å¸¸ç”¨äºæŸ¥çœ‹å¯¹è±¡ä¿¡æ¯ register readï¼šè¯»å–æ‰€æœ‰å¯„å­˜å™¨å€¼ 2ã€åœ¨çœŸæœºReleaseæ¨¡å¼ä¸‹è¿è¡Œï¼ŒæŸ¥çœ‹å †æ ˆä¿¡æ¯ æˆ‘ä»¬æ¥è¯»å–ä¸€ä¸‹å¯„å­˜å™¨ä¸­çš„æ•°æ®ï¼š 123456(lldb) register read w8 w8 = 0x0000001e(lldb) po 0x0000001e30(lldb) 3ã€Debugå’ŒReleaseçš„åŒºåˆ«ï¼š è¡Œæ•°ä¸Šçœ‹ï¼Œdebugæ˜¯28è¡Œï¼Œreleaseæ˜¯14è¡Œï¼Œå·®è·å¾ˆå¤§,è¿™å½“ç„¶æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–çš„ç»“æœã€‚ debugç‰ˆåœ¨0x104a725b8åœ¨è°ƒç”¨NSLogä¹‹å‰åšäº†å¥½å¤šå¤šä½™åŠ¨ä½œï¼Œå¾€è¿”è®¿é—®xmmå¯„å­˜å™¨ã€‚è€Œreleaseç‰ˆéƒ½æ˜¯ç«‹å³æ•°ï¼Œæ²¡æœ‰åšå¤šä½™çš„åŠ¨ä½œã€‚ 4ã€ç¼–è¯‘å™¨ä¼˜åŒ–ä½œç”¨ å°†å˜é‡å­˜å‚¨åˆ°å¯„å­˜å™¨ä¸­ï¼Œæé«˜è¯»å–é€Ÿåº¦ï¼Œè¿›è€Œæé«˜æ€§èƒ½ã€‚","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†03ï¼šalloc&init&newæ¢ç´¢","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†03ï¼šalloc&init&newæºç åˆ†æ","date":"2020-09-06T17:05:36.000Z","updated":"2022-11-01T09:29:16.000Z","comments":true,"path":"2020/09/07/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†03ï¼šalloc&init&newæºç åˆ†æ/","link":"","permalink":"https://www.bboyzj.cn/2020/09/07/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8603%EF%BC%9Aalloc&init&new%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/","excerpt":"","text":"å‰è¨€ åœ¨åˆ†æalloc&amp;init&amp;newæºç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314- (void)viewDidLoad &#123; [super viewDidLoad]; // ç†Ÿæ‚‰çš„å…¥æ‰‹ - å¯¹è±¡ // alloc åšäº†ä»€ä¹ˆï¼Ÿ // init åšäº†ä»€ä¹ˆï¼Ÿ ZJPerson *p1 = [ZJPerson alloc]; ZJPerson *p2 = [p1 init]; ZJPerson *p3 = [p1 init]; ZJNSLog(@&quot;%@ - %p - %p&quot;,p1,p1,&amp;p1); ZJNSLog(@&quot;%@ - %p - %p&quot;,p2,p2,&amp;p2); ZJNSLog(@&quot;%@ - %p - %p&quot;,p3,p3,&amp;p3);&#125; æŸ¥çœ‹æ‰“å°ç»“æœï¼Œåˆ†åˆ«è¾“å‡º3ä¸ªå¯¹è±¡çš„å†…å®¹ã€å†…å­˜åœ°å€ã€æŒ‡é’ˆåœ°å€ï¼š 123&lt;ZJPerson: 0x600001316130&gt; - 0x600001316130 - 0x7ffee10e6188&lt;ZJPerson: 0x600001316130&gt; - 0x600001316130 - 0x7ffee10e6180&lt;ZJPerson: 0x600001316130&gt; - 0x600001316130 - 0x7ffee10e6178 ç”±ä¸Šè¿°æ‰“å°ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š p1,p2,p3å¯¹è±¡ çš„ å†…å­˜åœ°å€ æ˜¯ç›¸åŒçš„ è¿”å›çš„ æŒ‡é’ˆå˜é‡p1,p2,p3 æŒ‡å‘å¯¹è±¡çš„ å†…å­˜åœ°å€ ä¹Ÿæ˜¯ç›¸åŒçš„ è€Œ æŒ‡é’ˆpçš„åœ°å€&amp;p æ˜¯ä¸åŒçš„ ç»“è®ºï¼š è¯´æ˜ allocå¼€è¾Ÿäº†å†…å­˜ç©ºé—´ï¼Œè€Œ initæ²¡æœ‰å¼€è¾Ÿå†…å­˜ç©ºé—´ p1,p2,p3æŒ‡é’ˆå˜é‡æŒ‡å‘äº†åŒä¸€ä¸ªå†…å­˜ç©ºé—´ZJPerson ä¸‹é¢ç”¨ä¸€å¼ å›¾è¯´æ˜ä¸€ä¸‹: è¿™å°±æ˜¯æœ¬æ–‡éœ€è¦æ¢ç´¢çš„å†…å®¹ï¼Œallocåšäº†ä»€ä¹ˆï¼Ÿinitåšäº†ä»€ä¹ˆï¼Ÿï¼Œalloc&amp;init&amp;newåˆ°åº•å¹²äº†ä»€ä¹ˆ? å‡†å¤‡å·¥ä½œ1ã€ä¸‹è½½ objc4-781 æºç  2ã€ç¼–è¯‘æºç ï¼Œå¯å‚è€ƒiOS-OCåº•å±‚åŸç†02ï¼šObjc4æºç ç¼–è¯‘ allocæºç æ¢ç´¢1ã€ åˆ›å»ºä¸€ä¸ªZJPersonè‡ªå®šä¹‰ç±»ï¼Œæ¥åˆ†æä¸€ä¸‹åº•å±‚è°ƒç”¨æµç¨‹ 2ã€è·Ÿè¸ªallocè°ƒç”¨æµç¨‹ é€šè¿‡æ–­ç‚¹è°ƒè¯•allocè°ƒç”¨_objc_rootAlloc 123+ (id)alloc &#123; return _objc_rootAlloc(self);&#125; é€šè¿‡æ–­ç‚¹è°ƒè¯•_objc_rootAllocè°ƒç”¨callAlloc 1234_objc_rootAlloc(Class cls)&#123; return callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/);&#125; é€šè¿‡æ–­ç‚¹è°ƒè¯•callAllocè°ƒç”¨_objc_rootAllocWithZone 1234567891011121314151617181920static ALWAYS_INLINE idcallAlloc(Class cls, bool checkNil, bool allocWithZone=false)// alloc æºç  ç¬¬ä¸‰æ­¥&#123;#if __OBJC2__ //æœ‰å¯ç”¨çš„ç¼–è¯‘å™¨ä¼˜åŒ– // checkNil ä¸ºfalseï¼Œ!cls ä¹Ÿä¸ºfalse ï¼Œæ‰€ä»¥slowpath ä¸º falseï¼Œå‡å€¼åˆ¤æ–­ä¸ä¼šèµ°åˆ°ifé‡Œé¢ï¼Œå³ä¸ä¼šè¿”å›nil if (slowpath(checkNil &amp;&amp; !cls)) return nil; //hasCustomAWZå®é™…æ„ä¹‰æ˜¯hasCustomAllocWithZoneâ€”â€”è¿™é‡Œè¡¨ç¤ºæœ‰æ²¡æœ‰alloc / allocWithZoneçš„å®ç° if (fastpath(!cls-&gt;ISA()-&gt;hasCustomAWZ())) &#123; //ç»§æ‰¿è‡ªNSObject/NSProxyçš„ç±»æ‰èƒ½èµ°åˆ°è¿™é‡Œï¼Œåœ¨ocä¸­åŸºæœ¬éƒ½ç»§æ‰¿è‡ªè¿™ä¸¤ä¸ªç±» return _objc_rootAllocWithZone(cls, nil); &#125;#endif // No shortcuts available. // æ²¡æœ‰å¯ç”¨çš„ç¼–è¯‘å™¨ä¼˜åŒ– if (allocWithZone) &#123; return ((id(*)(id, SEL, struct _NSZone *))objc_msgSend)(cls, @selector(allocWithZone:), nil); &#125; return ((id(*)(id, SEL))objc_msgSend)(cls, @selector(alloc));&#125; è¿™é‡Œè¡¥å……ä¸€ä¸‹cls-&gt;ISA()-&gt;hasCustomAWZ()æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ å…¶ä¸­fastpathä¸­çš„ cls-&gt;ISA()-&gt;hasCustomAWZ() è¿™é‡Œè¡¨ç¤ºhasCustomAWZå®é™…æ„ä¹‰æ˜¯hasCustomAllocWithZoneâ€”â€”è¿™é‡Œè¡¨ç¤ºæœ‰æ²¡æœ‰alloc &#x2F; allocWithZoneçš„å®ç°ï¼ˆåªæœ‰ä¸æ˜¯ç»§æ‰¿NSObject&#x2F;NSProxyçš„ç±»æ‰ä¸ºtrueï¼‰ï¼Œè¿™é‡Œé€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œæ˜¯æ²¡æœ‰è‡ªå®šä¹‰çš„å®ç°ï¼Œæ‰€ä»¥ä¼šæ‰§è¡Œåˆ° if é‡Œé¢çš„ä»£ç ï¼Œå³èµ°åˆ° _objc_rootAllocWithZone è¿™é‡Œè¡¥å……ä¸€ä¸‹ slowpath &amp; fastpath æ˜¯ä»€ä¹ˆï¼Ÿ å…¶ä¸­å…³äºslowpathå’Œfastpathè¿™é‡Œéœ€è¦ç®€è¦è¯´æ˜ä¸‹ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯objcæºç ä¸­å®šä¹‰çš„å®ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 1234// xå¾ˆå¯èƒ½ä¸ºçœŸï¼Œ fastpath å¯ä»¥ç®€ç§°ä¸º çœŸå€¼åˆ¤æ–­#define fastpath(x) (__builtin_expect(bool(x), 1)) // xå¾ˆå¯èƒ½ä¸ºå‡ï¼Œslowpath å¯ä»¥ç®€ç§°ä¸º å‡å€¼åˆ¤æ–­#define slowpath(x) (__builtin_expect(bool(x), 0)) å…¶ä¸­çš„__builtin_expectæŒ‡ä»¤æ˜¯ç”±gccå¼•å…¥çš„ï¼Œ 1234567891011ç›®çš„ï¼šç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥å‡å°‘æŒ‡ä»¤è·³è½¬å¸¦æ¥çš„æ€§èƒ½ä¸‹é™ã€‚å³æ€§èƒ½ä¼˜åŒ–ä½œç”¨ï¼šå…è®¸ç¨‹åºå‘˜å°†æœ€æœ‰å¯èƒ½æ‰§è¡Œçš„åˆ†æ”¯å‘Šè¯‰ç¼–è¯‘å™¨ã€‚æŒ‡ä»¤çš„å†™æ³•ä¸ºï¼š`__builtin_expect(EXP, N)`ã€‚è¡¨ç¤º EXP==Nçš„æ¦‚ç‡å¾ˆå¤§ã€‚fastpathå®šä¹‰ä¸­__builtin_expect((x),1)è¡¨ç¤º x çš„å€¼ä¸ºçœŸçš„å¯èƒ½æ€§æ›´å¤§ï¼›å³ æ‰§è¡Œif é‡Œé¢è¯­å¥çš„æœºä¼šæ›´å¤§slowpathå®šä¹‰ä¸­çš„__builtin_expect((x),0)è¡¨ç¤º x çš„å€¼ä¸ºå‡çš„å¯èƒ½æ€§æ›´å¤§ã€‚å³æ‰§è¡Œ else é‡Œé¢è¯­å¥çš„æœºä¼šæ›´å¤§åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æ¥ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œè¾¾åˆ°æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ï¼Œè®¾ç½®çš„è·¯å¾„ä¸ºï¼š`Build Setting --&gt; Optimization Level --&gt; Debug --&gt;` å°†None æ”¹ä¸º fastest æˆ–è€… smallestï¼Œå³ç¼–è¯‘å™¨ä¼˜åŒ– é€šè¿‡æ–­ç‚¹è°ƒè¯•_objc_rootAllocWithZoneè°ƒç”¨_class_createInstanceFromZone 123456_objc_rootAllocWithZone(Class cls, malloc_zone_t *zone __unused)&#123; // allocWithZone under __OBJC2__ ignores the zone parameter return _class_createInstanceFromZone(cls, 0, nil, OBJECT_CONSTRUCT_CALL_BADALLOC);&#125; é€šè¿‡æ–­ç‚¹è°ƒè¯•_class_createInstanceFromZoneå†…éƒ¨è°ƒç”¨cls-&gt;instanceSizeã€callocã€obj-&gt;initInstanceIsaï¼Œæœ€åè¿”å›å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051_class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone, int construct_flags = OBJECT_CONSTRUCT_NONE, bool cxxConstruct = true, size_t *outAllocatedSize = nil)&#123; ASSERT(cls-&gt;isRealized()); // Read class&#x27;s info bits all at once for performance // hasCxxCtor()æ˜¯åˆ¤æ–­å½“å‰classæˆ–è€…superclassæ˜¯å¦æœ‰.cxx_construct æ„é€ æ–¹æ³•çš„å®ç° bool hasCxxCtor = cxxConstruct &amp;&amp; cls-&gt;hasCxxCtor(); // hasCxxDtor()æ˜¯åˆ¤æ–­åˆ¤æ–­å½“å‰classæˆ–è€…superclassæ˜¯å¦æœ‰.cxx_destruct ææ„æ–¹æ³•çš„å®ç° bool hasCxxDtor = cls-&gt;hasCxxDtor(); // canAllocNonpointer()æ˜¯å…·ä½“æ ‡è®°æŸä¸ªç±»æ˜¯å¦æ”¯æŒä¼˜åŒ–çš„isa bool fast = cls-&gt;canAllocNonpointer(); size_t size; //1.è¿”å›å¼€è¾Ÿå†…å­˜å¤§å° size = cls-&gt;instanceSize(extraBytes); if (outAllocatedSize) *outAllocatedSize = size; id obj; if (zone) &#123; obj = (id)malloc_zone_calloc((malloc_zone_t *)zone, 1, size); &#125; else &#123; //2.å¼€è¾Ÿå†…å­˜ obj = (id)calloc(1, size); &#125; if (slowpath(!obj)) &#123; if (construct_flags &amp; OBJECT_CONSTRUCT_CALL_BADALLOC) &#123; return _objc_callBadAllocHandler(cls); &#125; return nil; &#125; //3.åˆå§‹åŒ–æŒ‡é’ˆå…³è”åˆ°ç›¸åº”çš„ç±» if (!zone &amp;&amp; fast) &#123; obj-&gt;initInstanceIsa(cls, hasCxxDtor); &#125; else &#123; // Use raw pointer isa on the assumption that they might be // doing something weird with the zone or RR. obj-&gt;initIsa(cls); &#125; //4.ç¼–è¯‘å™¨ä¼˜åŒ–è¿”å›å¯¹è±¡ if (fastpath(!hasCxxCtor)) &#123; return obj; &#125; construct_flags |= OBJECT_CONSTRUCT_FREE_ONFAILURE; return object_cxxConstructFromClass(obj, cls, construct_flags);&#125; è°ƒç”¨çš„æµç¨‹å›¾ 3ã€cls-&gt;instanceSize å®ä¾‹å¯¹è±¡è¿”å›å¼€è¾Ÿå†…å­˜çš„å¤§å°ï¼Ÿ ç‚¹å‡»instanceSizeè·Ÿè¸ªæ–­ç‚¹å»çœ‹æºç æ¥åˆ†æï¼š 1ï¼‰è°ƒç”¨çš„æ˜¯ä¸‹é¢ä¸¤ä¸ªå‡½æ•° 1234size_t size = _flags &amp; FAST_CACHE_ALLOC_MASK;// remove the FAST_CACHE_ALLOC_DELTA16 that was added// by setFastInstanceSizereturn align16(size + extra - FAST_CACHE_ALLOC_DELTA16); 123#define FAST_CACHE_ALLOC_MASK 0x1ff8#define FAST_CACHE_ALLOC_MASK16 0x1ff0#define FAST_CACHE_ALLOC_DELTA16 0x0008 sizeå¾—åˆ°çš„å€¼æ˜¯16 extraå¾—åˆ°çš„å€¼æ˜¯0 FAST_CACHE_ALLOC_DELTA16å¾—åˆ°çš„å€¼ä¸º = 16 - 0 - 8 = 8 123(lldb) po 0x00088 2ï¼‰ç„¶åæˆ‘ä»¬è®¡ç®—ä¸€ä¸‹ 16 å­—èŠ‚å¯¹é½ align16 åˆ°åº•è¿”å›å¤šå°‘å­—èŠ‚ï¼Ÿ è®¡ç®—ä¸€ä¸‹(x + size_t(15))) &amp; ~size_t(15)çš„å€¼ 1234567891011121314158 + 15 = 230000 0000 0001 0111 150000 0000 0000 1111~1111 1111 1111 0000 23 &amp; ~150000 0000 0001 01111111 1111 1111 0000-----------------------0000 0000 0001 0000 æœ€åçš„å€¼ä¸º160000 0000 0001 0000 ç»“è®ºï¼šç•™ä¸‹äº†16çš„å€æ•°ï¼Œç³»ç»Ÿè¿”å›äº†16å­—èŠ‚çš„å†…å­˜ 3ï¼‰ä¸ºä»€ä¹ˆæ˜¯16å­—èŠ‚çš„å¯¹é½ï¼Ÿ æ–¹ä¾¿å¿«æ· 16å­—èŠ‚æ›´åŠ å®‰å…¨ çœ‹èµ·æ¥ä¸åƒ 8å­—èŠ‚ é‚£ä¹ˆç´§å‡‘ï¼Œå¹¶æ»¡è¶³ä»¥åå‘å±• 4ã€calloc 1ï¼‰è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•å»å¼€è¾Ÿå†…å­˜ 12//å¼€è¾Ÿå†…å­˜obj = (id)calloc(1, size); 2)ä¸‹æ–­ç‚¹åˆ°obj &#x3D; (id)calloc(1, size);åœ¨è¿™ä¸ªåœ°æ–¹æ‰“å°poï¼š 12(lldb) po obj0x000000010241e660 æ‰“å°çš„æ˜¯æŒ‡é’ˆå˜é‡çš„åœ°å€ï¼Œæ²¡æœ‰æ‰“å°å‡ºå¯¹è±¡ï¼Œè¯´æ˜è¿™ä¸ªåœ°æ–¹è¿˜æ²¡æœ‰è¿”å›å¯¹è±¡ 5ã€obj-&gt;initInstanceIsa 1ï¼‰æ–­ç‚¹æŸ¥çœ‹ä¸‹é¢çš„æºç  12345678// 3.åˆå§‹åŒ–æŒ‡é’ˆå…³è”åˆ°ç›¸åº”çš„ç±»if (!zone &amp;&amp; fast) &#123; obj-&gt;initInstanceIsa(cls, hasCxxDtor);&#125; else &#123; // Use raw pointer isa on the assumption that they might be // doing something weird with the zone or RR. obj-&gt;initIsa(cls);&#125; 2ï¼‰ä¸‹æ–­ç‚¹åˆ° obj-&gt;initInstanceIsa(cls, hasCxxDtor); åˆ°è¿™è¡Œæ‰“å° po ï¼š 1234(lldb) po obj&lt;ZJPerson: 0x10241e660&gt;(lldb) è¯´æ˜åœ¨è¿™ä¸ªä½ç½®æ‰æ˜¯ å°†åˆå§‹åŒ–çš„æŒ‡é’ˆå…³è”åˆ°å¯¹è±¡ 3ï¼‰è¿”å›å¯¹è±¡ 1234// 4.ç¼–è¯‘å™¨ä¼˜åŒ–è¿”å›å¯¹è±¡if (fastpath(!hasCxxCtor)) &#123; return obj;&#125; å¯¹è±¡å¼€è¾Ÿå†…å­˜çš„å½±å“å› ç´ 1ã€ç»™å¯¹è±¡æ·»åŠ å±æ€§ ZJPerson.hæ–‡ä»¶ 1234@interface ZJPerson : NSObject@property (nonatomic, copy) NSString *name;@property (nonatomic, assign) int age;@end main.hæ–‡ä»¶ 123456789101112int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // insert code here... ZJPerson * p = [ZJPerson alloc]; p.name = @&quot;zj&quot;; //8 p.age = 30; //4 NSLog(@&quot;ç”³è¯·å†…å­˜å¤§å°ä¸ºï¼š%luâ€”â€”-ç³»ç»Ÿå¼€è¾Ÿå†…å­˜å¤§å°ä¸ºï¼š%lu&quot;,class_getInstanceSize([p class]),malloc_size((__bridge const void *)(p))); &#125; return 0;&#125; 2ã€åˆ†æç»“æœï¼š 12345678910åˆ†æç»“æœï¼š1. æˆå‘˜å˜é‡åº”è¯¥åˆ†é…å†…å­˜ï¼š8å­—èŠ‚ + 4å­—èŠ‚ = 12å­—èŠ‚2. å†åŠ ä¸Šisaçš„8å­—èŠ‚ = 20å­—èŠ‚3. æ ¹æ®å¯¹è±¡8å­—èŠ‚å¯¹é½åŸåˆ™æœ€å¤§8å­—èŠ‚ï¼Œæ‰€ä»¥20å¾€å¤§èµ°è¡¥å……åˆ°24å­—èŠ‚4. æ‰€ä»¥å†…å­˜ç©ºé—´åº”è¯¥åˆ†é…24å­—èŠ‚5. æ³¨æ„ï¼šå¯¹è±¡å¼€è¾Ÿç©ºé—´çš„æ—¶å€™æˆå‘˜å˜é‡å°±ä¼šç¼–è¯‘è¿›æ¥ï¼Œæ‰€ä»¥æˆå‘˜å˜é‡æœªèµ‹å€¼ä¹Ÿä¼šåˆ†é…å†…å­˜6. ç³»ç»Ÿç”±äºæ˜¯16å­—èŠ‚å¯¹é½åŸåˆ™ï¼Œæ‰€ä»¥ç³»ç»Ÿå¼€è¾Ÿçš„å†…å­˜å¤§å°ä¸º16çš„å€æ•° = 16 * 2 = 32,è€Œ24å¤§äº16å°äº32ï¼Œæ‰€ä»¥ä¸º32å­—èŠ‚å®é™…æ‰“å°ç»“æœ : 2020-09-06 15:28:31.072150+0800 ZJObjc[15774:988136] ç”³è¯·å†…å­˜å¤§å°ä¸ºï¼š24â€”â€”-ç³»ç»Ÿå¼€è¾Ÿå†…å­˜å¤§å°ä¸ºï¼š32 3ã€åˆ†æå†…å­˜æƒ…å†µ 1ï¼‰æ‰“æ–­ç‚¹åœ¨ ZJPerson * p = [ZJPerson alloc]; è¡Œï¼Œç»ˆç«¯è¾“å…¥: 1234(lldb) x p0x1006414b0: 35 22 00 00 01 80 1d 00 00 00 00 00 00 00 00 00 5&quot;..............0x1006414c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................(lldb) 0x1006414b0 ä¸ºé¦–åœ°å€ï¼Œåœ¨iOSä¸­å†…å­˜æ˜¯å°ç«¯æ¨¡å¼ï¼Œç”±äºæ²¡æœ‰èµ‹å€¼nameå’Œageæ‰€ä»¥ 35 22 00 00 01 80 1d 00 åé¢çš„00 00 00 00 00 00 00 00æ˜¯æ²¡å€¼çš„ 2ï¼‰å½“æˆ‘ä»¬æ‰“æ–­ç‚¹åœ¨NSLog(@â€ç”³è¯·å†…å­˜å¤§å°ä¸ºâ€¦è¡Œæ—¶ï¼Œç»ˆç«¯è¾“å…¥: 1234(lldb) x/4gx p0x1006414b0: 0x001d800100002235 0x000000000000001e0x1006414c0: 0x0000000100001018 0x0000000000000000(lldb) æ­¤æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°0x000000000000001eå’Œ0x0000000100001018æ˜¯æœ‰å€¼çš„ï¼Œåˆ†åˆ«ä»£è¡¨age=30å’Œname=zj 12345(lldb) po 0x000000000000001e30(lldb) po 0x0000000100001018zj initæ¢ç´¢1ã€æŸ¥çœ‹æºç ï¼š 1234567891011- (id)init &#123; return _objc_rootInit(self);&#125;_objc_rootInit(id obj)&#123; // In practice, it will be hard to rely on this function. // Many classes do not properly chain -init calls. return obj;&#125; ç”±æºç å¯çŸ¥ï¼šinitä»€ä¹ˆéƒ½æ²¡åšï¼Œåªæ˜¯è°ƒç”¨äº† _objc_rootInit é‡å†™ initï¼Œå³æ„é€ æ–¹æ³•ï¼Œç»™ç”¨æˆ·æä¾›å…¥å£å»å®ç°å·¥å‚è®¾è®¡ã€‚ newæŸ¥çœ‹æºç  123+ (id)new &#123; return [callAlloc(self, false/*checkNil*/) init];&#125; å‘ç° å’Œ alloc è°ƒç”¨ callAlloc æ˜¯ä¸€ä¸ªæµç¨‹ï¼Œå³ç­‰åŒäº new = alloc + initï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«æ²¡æœ‰è‡ªå®šä¹‰çš„æ„é€ æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€èˆ¬è‡ªå®šä¹‰çš„ç±»ä¼šç”¨alloc initï¼Œç³»ç»Ÿçš„ç±»ç”¨newã€‚ æ€»ç»“æœ¬äººå°ç™½ï¼Œå¾ˆå¤šç»†èŠ‚é—®é¢˜å¾…è¡¥å……ï¼Œå¸Œæœ›å¤šå¤šæŒ‡ç‚¹ã€‚","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†02ï¼šObjc4æºç ç¼–è¯‘","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†02ï¼šObjc4æºç ç¼–è¯‘","date":"2020-09-05T14:45:38.000Z","updated":"2023-02-25T18:03:10.676Z","comments":true,"path":"2020/09/05/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†02ï¼šObjc4æºç ç¼–è¯‘/","link":"","permalink":"https://www.bboyzj.cn/2020/09/05/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8602%EF%BC%9AObjc4%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/","excerpt":"","text":"ç®€ä»‹OCçš„ä¸€ä¸ªä¸»è¦ç‰¹æ€§Runtimeè¿è¡Œæ—¶ç‰¹æ€§ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°çš„éƒ½æ˜¯ä¸å¯è§çš„ï¼Œè¿˜å¥½å®˜æ–¹æä¾›äº† Runtimeï¼ˆobjc4ï¼‰ æºç ä¾›å¼€å‘è€…ç ”ç©¶ï¼Œæˆ‘æ˜¯ ZJï¼Œä¸‹é¢å°±å¼€å§‹è¿ˆå‡ºæºç æ¢ç´¢çš„ç¬¬ä¸€æ­¥ï¼Œæºç ç¼–è¯‘ã€‚ ä¸‹è½½objc4-781 è¿›å…¥æºç åŒº æ‰“å¼€æºç é“¾æ¥ é€‰æ‹© macOS ï¼Œæœç´¢ objc4- ï¼Œç„¶åä¸‹è½½åˆ°æ¡Œé¢ é¦–å…ˆç¼–è¯‘ target objc unable to find sdk â€˜macosx.internalâ€™ è§£å†³åŠæ³•ï¼š PROJECTS â€“&gt; objc â€“&gt; Build Settings, å°† Base SDK æ”¹æˆ macOS TARGETS â€“&gt; objc â€“&gt; Build Settings, å°† Base SDK æ”¹æˆ macOS â€˜sys&#x2F;reason.hâ€™ file not found è§£å†³åŠæ³•ï¼š è¿˜æ˜¯åœ¨ macOS ç›®å½•ä¸‹ï¼Œä¸‹è½½ xnu-8020.101.41, æŠŠ xnu-8020.101.41/bsd/sys/reason.h æ–‡ä»¶å¤åˆ¶åˆ°æ¡Œé¢åˆ›å»ºçš„æ–°æ–‡ä»¶å¤¹ comm_ifl/sys ç›®å½•ä¸‹ å°†æ–‡ä»¶ ZJCommon æ”¾åœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹ï¼Œå¹¶åœ¨å·¥ç¨‹è®¾ç½®æ–‡ä»¶çš„ç´¢å¼•è·¯å¾„ target -&gt; objc -&gt; Build Settings -&gt; Header Search Paths -&gt; æ·»åŠ  $(SRCROOT)/ZJCommon æ³¨é‡Šé”™è¯¯ å¯ä»¥æœ€åå†å¼„Unknown type name â€˜uint32_tâ€™ æ·»åŠ  #include &lt;stdint.h&gt; â€˜mach-o&#x2F;dyld_priv.hâ€™ file not found åŸç†åŒä¸Šï¼Œä¸‹è½½ dyld-960 æ–‡ä»¶ï¼Œå°† dyld_priv.h æ–‡ä»¶ï¼Œæ‹·è´åˆ° comm_ifl/mach-o/dyld_priv.h ä¸‹ â€˜os&#x2F;lock_private.hâ€™ file not found åŸç†åŒä¸Šï¼Œä¸‹è½½ libplatform-273.100.5 æ–‡ä»¶ï¼Œå°† libplatform-273.100.5/private/os/lock_private.h ä¸­ lock_private.h æ–‡ä»¶ï¼Œæ‹·è´åˆ° comm_ifl/os/lock_private.h ä¸‹ extern dyld_platform_t dyld_get_active_platform(void) __API_AVAILABLE(macos(10.14), ios(12.0), watchos(5.0), tvos(12.0), bridgeos(3.0)); â€”- æŠ¥é”™ Expected â€˜,â€™ ç”±äºè°ƒè¯•ä¸»è¦åŸºäº macosï¼Œåˆ é™¤ , bridgeos(3.0) æ‰¹é‡åŒä¸Šå‡åˆ é™¤ , bridgeos(3.0) bridgeos(4.0) é—®é¢˜ å»é™¤ , bridgeos(4.0) â€˜os&#x2F;base_private.hâ€™ file not found åœ¨ xnu-8020.101.41/libken/os/base_private.h ä¸­ï¼Œ æŠŠ base_private.h æ–‡ä»¶ï¼Œ æ‹·è´åˆ° comm_ifl/os/base_private.h â€˜pthread&#x2F;tsd_private.hâ€™ file not found ä¸‹è½½ libpthread-libpthread-486.100.11 æ–‡ä»¶ï¼Œå°† libpthread-libpthread-486.100.11/private/pthread/tsd_private.h æ‹·è´åˆ° comm_ifl/pthread/tsd_private.h â€˜os&#x2F;feature_private.hâ€™ file not found æ³¨é‡Šæ‰ â€˜os&#x2F;variant_private.hâ€™ file not found æ‹·è´ Libc-Libc-1507.100.9/os/variant_private.h è‡³ comm_ifl/os/variant_private.h â€˜os&#x2F;tsd.hâ€™ file not found æ‹·è´ xnu-xnu-8020.101.4/libsyscall/os/tsd.h è‡³ comm_ifl/os/tsd.h â€˜pthread&#x2F;spinlock_private.hâ€™ file not found æ‹·è´ libpthread-libpthread-486.100.11/private/pthread/spinlock_private.h è‡³ comm_ifl/pthread/spinlock_private.h Expected function body after function declarator â€˜System&#x2F;pthread_machdep.hâ€™ file not foundâ€˜System&#x2F;pthread_machdep.hâ€™æ–‡ä»¶åªæœ‰åœ¨Libc-825.40.1åŠä»¥ä¸‹ç‰ˆæœ¬æ‰æœ‰ åœ¨ https://opensource.apple.com/source/Libc/Libc-583/pthreads/ ä¸Šä¸‹è½½ pthread_machdep.hï¼Œæ‹·è´ pthread_machdep.h è‡³ comm_ifl/System/pthread_machdep.h â€˜CrashReporterClient.hâ€™ file not found åœ¨ è¿™é‡Œä¸‹è½½ æ‹·è´ CrashReporterClient.h è‡³ comm_ifl/CrashReporterClient.h #include_next&lt;CrashReporterClient.h&gt; æ”¹ä¸º#include &lt;CrashReporterClient.h&gt; ä¾ç„¶æŠ¥é”™ï¼šåœ¨ Build Settings -&gt; Preprocessor Macros ä¸­åŠ å…¥: LIBC_NO_LIBCRASHREPORTERCLIENT Typedef redefinition with different types (â€˜intâ€™ vs â€˜volatile OSSpinLockâ€™ (aka â€˜volatile intâ€™)) æ³¨é‡Šæ‰ Unexpected character &lt;U+1F92F&gt; æ³¨é‡Šæ‰ Use of undeclared identifier â€˜dyld_platform_version_macOS_10_13â€™ æ³¨é‡Šæ‰ â€˜os&#x2F;reason_private.hâ€™ file not found æ‹·è´ xnu-xnu-8020.101.4/libkern/os/reason_private.h è‡³ comm_ifl/os/reason_private.h â€˜os&#x2F;bsd.hâ€™ file not found ç›´æ¥æ³¨é‡Š â€˜objc-shared-cache.hâ€™ file not found æ‹·è´ dyld-dyld-960/include/objc-shared-cache.h è‡³ comm_ifl/objc-shared-cache.h â€˜os&#x2F;linker_set.hâ€™ file not found æ‹·è´ Libc-Libc-1507.100.9/os/linker_set.h è‡³ comm_ifl/os/linker_set.h â€˜_simple.hâ€™ file not found å…¨å±€æœç´¢ _simple.h æ‹·è´è‡³ comm_ifl/_simple.h Use of undeclared identifier â€˜dyld_fall_2020_os_versionsâ€™ æ³¨é‡Šæ‰ Use of undeclared identifier â€˜objc4â€™ æ³¨é‡Šæ‰ Use of undeclared identifier â€˜preoptimizedCachesâ€™ æ³¨é‡Šæ‰ Use of undeclared identifier â€˜CRGetCrashLogMessageâ€™ æ³¨é‡Šæ‰ â€˜Cambria&#x2F;Traps.hâ€™ file not found å’Œ â€˜Cambria&#x2F;Cambria.hâ€™ file not found æ³¨é‡Šæ‰ Use of undeclared identifier â€˜objc_thread_get_ripâ€™ â€˜kern&#x2F;restartable.hâ€™ file not found xnu-xnu-8020.101.4/osfmk/kern/restartable.h æ‹·è´åˆ° comm_ifl/kern/restartable.h Use of undeclared identifier â€˜oah_is_current_process_translatedâ€™ æ³¨é‡Šæ‰ â€˜Block_private.hâ€™ file not found libclosure-libclosure-79.1/Block_private.h æ‹·è´åˆ° comm_ifl/Block_private.h Use of undeclared identifier â€˜os_parse_boot_arg_stringâ€™ æ³¨é‡Šæ‰ Use of undeclared identifier â€˜dyld_platform_version_macOS_10_11â€™ æ³¨é‡Šæ‰ Use of undeclared identifier â€˜dyld_fall_2018_os_versionsâ€™ Use of undeclared identifier â€˜dyld_platform_version_macOS_10_12â€™ â€˜_static_assertâ€™ declared as an array with a negative size æ³¨é‡Šæ‰ æœ€åè¿™å‡ æ­¥å¾ˆé‡è¦åœ¨ dyld_priv.h æ–‡ä»¶é¡¶éƒ¨åŠ å…¥å®1234#define DYLD_MACOSX_VERSION_10_11 0x000A0B00#define DYLD_MACOSX_VERSION_10_12 0x000A0C00#define DYLD_MACOSX_VERSION_10_13 0x000A0D00#define DYLD_MACOSX_VERSION_10_14 0x000A0E00 CrashReporterClientå¼‚å¸¸ library not found for -loah â€˜macosx.internalâ€™ cannot be located. æ¥ä¸‹æ¥objcè¿›è¡Œç¼–è¯‘è°ƒè¯•æ–°å»ºtarget ï¼šZJDemo å»ºç«‹ä¾èµ– åˆ›å»ºä¸€ä¸ªmacOSç±»ZJPerson ç»‘å®šåˆ°ZJDemoçš„targetä¸Š æ³¨é‡Šæ–‡ä»¶æ‰§è¡Œé¡ºåº ç¼–è¯‘è°ƒè¯•target ä¸‹ç¬¦å·è°ƒè¯•","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†01ï¼šæŸ¥æ‰¾æºç æœ‰ä¸‰ç§æ–¹å¼","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†01ï¼šæŸ¥æ‰¾æºç æœ‰ä¸‰ç§æ–¹å¼","date":"2020-09-02T17:35:35.000Z","updated":"2023-02-25T06:43:11.614Z","comments":true,"path":"2020/09/03/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†01ï¼šæŸ¥æ‰¾æºç æœ‰ä¸‰ç§æ–¹å¼/","link":"","permalink":"https://www.bboyzj.cn/2020/09/03/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8601%EF%BC%9A%E6%9F%A5%E6%89%BE%E6%BA%90%E7%A0%81%E6%9C%89%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/","excerpt":"","text":"å‰è¨€æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸‹æºç æ¢ç´¢çš„ä¸‰ç§æ–¹æ³•ï¼š 1ã€ç¬¦å·æ–­ç‚¹ç›´æ¥è·Ÿæµç¨‹ 2ã€é€šè¿‡æŒ‰ä½ control+step into 3ã€æ±‡ç¼–è·Ÿæµç¨‹ ä¸‹ç¬¦å·æ–­ç‚¹çš„å½¢å¼ç›´æ¥è·Ÿæµç¨‹ åˆ‡æ¢åˆ°Show the breakpoing navigatoræ ï¼Œæ‰“å‡»å·¦ä¸‹è§’â€œ+â€å·create a breakpointåˆ›å»ºä¸€ä¸ªæ–­ç‚¹ æ·»åŠ è¦æŸ¥çœ‹çš„ç¬¦å·alloc è®¾ç½®åœ°å€æ–­ç‚¹ï¼Œå¹¶å–æ¶ˆä¹‹å‰è®¾ç½®çš„ç¬¦å·æ–­ç‚¹4ï¼Œä»¥ä¾¿æ‰§è¡Œç›®æ ‡è¡Œï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨allocçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä½ ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½æ‰§è¡Œåˆ°ç›®æ ‡ä½ç½® command + Rç¼–è¯‘å¹¶è¿è¡Œå·¥ç¨‹ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°3æ—¶ï¼Œå°†ç¬¦å·æ–­ç‚¹4é€‰ä¸­ï¼ŒæŸ¥çœ‹æ‰§è¡Œçš„åº•å±‚æºç  é€šè¿‡æ‘ä½control - step into command + Rç¼–è¯‘å¹¶è¿è¡Œå·¥ç¨‹ï¼Œä»£ç æ‰§è¡Œåˆ°ç›®æ ‡è¡Œï¼ŒæŒ‰ä½control + step intoå•æ­¥è¿è¡Œç®­å¤´ æŒ‰ä¸Šé¢çš„æ–¹å¼ï¼Œè¿›å…¥æ±‡ç¼–å¯å¾—ä¸‹å›¾ï¼š æ³¨:jmpqæ˜¯è®¾ä¹ˆæ„æ€ï¼Ÿjmpq å°±æ˜¯jmp æŒ‡ä»¤ã€‚qæ˜¯gnuæ±‡ç¼–çš„ç”¨æ³•ã€‚qè¡¨ç¤ºè·³è½¬åˆ°64ä½åœ°å€ã€‚lè¡¨ç¤º32ä½åœ°å€ã€‚ ç„¶åæ‰“ä¸€ä¸ªobjc_allocçš„ç¬¦å·æ–­ç‚¹ï¼Œè·³è½¬åˆ°æ±‡ç¼–ä»£ç å¯å¾—ä¸‹å›¾: ç”±ä¸Šå›¾å¯çŸ¥objc_allocæ˜¯åœ¨libobjc.A.dylibè¿™ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸Šæ³¨ï¼š.dylibæ˜¯OSXä¸Šçš„åŠ¨æ€åº“æ‰©å±• æŸ¥çœ‹è¿è¡Œæ—¶çš„æ±‡ç¼–ä»£ç  Xcodeç‚¹å‡»Debug-&gt;Debug Workflow-&gt;Alway Show DisassemblyæŸ¥çœ‹è¿è¡Œæ—¶çš„æ±‡ç¼–ä»£ç  è¿è¡ŒæˆåŠŸåçš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ å¯çŸ¥åº•å±‚è°ƒç”¨çš„æ–¹æ³•æ˜¯objc_alloc æ³¨ï¼šcallqï¼šè°ƒç”¨å‡½æ•°çš„æ„æ€ï¼Œå³è°ƒç”¨å‡½æ•°æ—¶çš„å‹æ ˆå‡ºæ ˆ åœ¨ä¸‹ä¸€ä¸ªç¬¦å·æ–­ç‚¹objc_alloc,ç»§ç»­æ‰§è¡Œå’Œä¸Šé¢çš„å°±ä¸€æ ·äº† æ€»ç»“ç”±ä¸Šé¢çš„æ–¹æ³•æˆ‘ä»¬å¯çŸ¥ alloc åº•å±‚è°ƒç”¨çš„æ˜¯ objc_allocï¼Œæ‰€åœ¨çš„ä½ç½®æ˜¯libobjc.A.dylib è¿™ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œç”¨ä¸€å¼ æµç¨‹å›¾æ€»ç»“ï¼š","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCåº•å±‚åŸç†00ï¼šLLDBå¸¸ç”¨å‘½ä»¤","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†00ï¼šLLDBå¸¸ç”¨å‘½ä»¤","date":"2020-09-01T15:31:27.000Z","updated":"2022-04-21T06:04:50.000Z","comments":true,"path":"2020/09/01/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†00ï¼šLLDBå¸¸ç”¨å‘½ä»¤/","link":"","permalink":"https://www.bboyzj.cn/2020/09/01/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%8600%EF%BC%9ALLDB%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","excerpt":"","text":"x å¯¹è±¡ï¼šä»¥ 16 è¿›åˆ¶ï¼Œæ‰“å°å¯¹è±¡çš„å†…å­˜åˆ†å¸ƒï¼Œä½æ•°ä¸º 16123(lldb) x p0x100792110: 75 32 00 00 01 80 1d 00 00 00 00 00 00 00 00 00 u2..............0x100792120: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ memory read å¯¹è±¡ï¼šä»¥ 16 è¿›åˆ¶ï¼Œæ‰“å°å¯¹è±¡çš„å†…å­˜åˆ†å¸ƒï¼Œå’Œ1ä¸€æ ·ï¼Œä½æ•°ä¸º 16123(lldb) memory read p0x100792110: 75 32 00 00 01 80 1d 00 00 00 00 00 00 00 00 00 u2..............0x100792120: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................ x/4gx å¯¹è±¡ï¼šä»¥16è¿›åˆ¶ï¼Œæ‰“å°4æ®µå¯¹è±¡çš„å†…å­˜åˆ†å¸ƒæƒ…å†µï¼Œä½æ•°ä¸º16123(lldb) x/4gx p0x100792110: 0x001d800100003275 0x00000000000000000x100792120: 0x0000000000000000 0x0000000000000000 x/4gw å¯¹è±¡ï¼šä»¥16è¿›åˆ¶ï¼Œæ‰“å°4æ®µå¯¹è±¡çš„å†…å­˜åˆ†å¸ƒæƒ…å†µï¼Œä½æ•°ä¸º1612(lldb) x/4gw p0x100792110: 0x00003275 0x001d8001 0x00000000 0x00000000 po å¯¹è±¡ï¼šè¾“å‡ºå¯¹åº”çš„å€¼12(lldb) po p&lt;LGPerson: 0x100792110&gt; p å¯¹è±¡ï¼šè¿”å›å€¼çš„ç±»å‹ä»¥åŠå‘½ä»¤ç»“æœçš„å¼•ç”¨åï¼Œå°†åœ°å€0x0000000100792110æ”¾åˆ°å¯„å­˜å™¨$5ä¸­12(lldb) p p(LGPerson *) $5 = 0x0000000100792110 p/xï¼šä»¥16è¿›åˆ¶çš„å½¢å¼ï¼Œæ‰“å°ç±»ä¿¡æ¯12(lldb) p/x p(LGPerson *) $6 = 0x0000000100792110","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"iOSå¼€å‘è€…è´¦å·03ï¼šè‹¹æœå¼€å‘è€…è¯ä¹¦åˆ›å»º","slug":"å¼€å‘è€…è´¦å·ç”³è¯·æµç¨‹/iOSå¼€å‘è€…è´¦å·03ï¼šè‹¹æœå¼€å‘è€…è¯ä¹¦åˆ›å»º","date":"2020-08-29T08:03:09.000Z","updated":"2023-03-08T22:03:06.052Z","comments":true,"path":"2020/08/29/å¼€å‘è€…è´¦å·ç”³è¯·æµç¨‹/iOSå¼€å‘è€…è´¦å·03ï¼šè‹¹æœå¼€å‘è€…è¯ä¹¦åˆ›å»º/","link":"","permalink":"https://www.bboyzj.cn/2020/08/29/%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E7%94%B3%E8%AF%B7%E6%B5%81%E7%A8%8B/iOS%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B703%EF%BC%9A%E8%8B%B9%E6%9E%9C%E5%BC%80%E5%8F%91%E8%80%85%E8%AF%81%E4%B9%A6%E5%88%9B%E5%BB%BA/","excerpt":"","text":"å‰è¨€åœ¨ Certificates, Identifiers &amp; Profiles ä¸­ï¼Œæœ‰å‡ ä¸ªé€‰é¡¹ï¼Œè€Œå‰é¢å››ä¸ªæ˜¯è‹¹æœå¼€å‘è€…è´¦å·è¯ä¹¦é…ç½®åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š ç”³è¯· Identifiersï¼šå³ APP IDs ,è®¾å¤‡å”¯ä¸€æ ‡è¯† åˆ›å»ºè¯ä¹¦ Certificates ï¼šå¼€å‘ã€å‘å¸ƒè¯ä¹¦(åŒ…æ‹¬æ¨é€è¯ä¹¦) Devicesï¼šæµ‹è¯•è®¾å¤‡æ³¨å†Œ Profilesï¼šåº”ç”¨æè¿°é…ç½® ç”³è¯·Identifiers é€‰æ‹© APP IDs ï¼Œç‚¹å‡» Continueï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªé¡µé¢ æ¥åˆ° Select a typeï¼Œé»˜è®¤é€‰ä¸­ App ï¼Œç‚¹å‡» Continue ç»§ç»­å¾€ä¸‹ä¸ªé¡µé¢èµ° æ¥åˆ°è®¾ç½® Budle ID çš„é¡µé¢ï¼Œå¡«å†™ æè¿°ä¿¡æ¯å’ŒBudle id å¡«å†™ï¼š Descriptionï¼š å¡«å†™APP æè¿° Bundle IDï¼šå…¬å¸ç½‘å€é¢ å€’ + APPåå­—ï¼Œä¾‹å¦‚ epod.cn.xxxxã€‚ Explocitï¼šæ˜¾ç¤ºçš„ï¼Œé»˜è®¤é€‰ä¸­ã€‚ Wildcardï¼šé€šé…ç¬¦æ ·å¼ Capabilities : åœ¨ä¸‹é¢è¿˜æœ‰ä¸€äº›å¯é€‰åŠŸèƒ½ æ ¹æ®APPéœ€æ±‚ï¼Œå‹¾é€‰éœ€è¦çš„æƒé™ï¼Œä¸€èˆ¬æ¨é€ï¼Œå†…è´­ä¹°ã€‚ ç‚¹å‡»Register å¾—åˆ°çš„ Idenifiers å¦‚ä¸‹ï¼š Macç”ŸæˆCSR æ‰“å¼€é’¥åŒ™ä¸²-&gt;è¯ä¹¦åŠ©ç†-&gt;ä»è¯ä¹¦é¢å‘æœºæ„è¯·æ±‚è¯ä¹¦ æ³¨ï¼šä¸ç®¡æ˜¯ç”³è¯· å¼€å‘(Development)è¯ä¹¦ è¿˜æ˜¯ å‘å¸ƒ(Distribution)è¯ä¹¦ ï¼Œéƒ½éœ€è¦ä½¿ç”¨ è¯ä¹¦è¯·æ±‚(.certSigningRequest)æ–‡ä»¶ æ‰“å¼€Macä¸Šçš„é’¥åŒ™ä¸²ï¼Œä»è¯ä¹¦åŠ©æ‰‹é‚£é‡Œè¯·æ±‚è¯ä¹¦ã€‚ å¡«å†™è¯ä¹¦ä¿¡æ¯ ç‚¹å‡»ç»§ç»­ä¿å­˜åˆ°ä½ è¦ä¿å­˜çš„ä½ç½® è¯ä¹¦é…ç½® Software ä¸‹è¯ä¹¦åˆ†ç±»ä¸¤ç§: iOS App Developmentï¼š ä¸ºå¼€å‘è¯ä¹¦ï¼Œç”¨äºçœŸæœºæµ‹è¯•ã€‚ iOS Distribution (App Store and Ad Hoc)ï¼šä¸º APPå‘å¸ƒè¯ä¹¦ï¼Œç”¨äºä¸Šæ¶APPåˆ° APP Store æˆ–è€… Ad Hoc ä¸Šä¼ åŒ…åˆ°è’²å…¬è‹±ã€‚ Services ä¸‹æ¨é€è¯ä¹¦ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼š Apple Push Notification service SSL (Sandbox) ï¼šå¼€å‘ç¯å¢ƒä¸‹çš„æ¨é€è¯ä¹¦ Apple Push Notification service SSL (Sandbox &amp; Production)ï¼šç”Ÿäº§ç¯å¢ƒçš„æ¨é€è¯ä¹¦ å¼€å‘è¯ä¹¦iOS App Developmentçš„åˆ›å»ºæµç¨‹: é€‰ä¸­ Software ä¸‹çš„ iOS App Development å’Œ Services ä¸‹çš„ Apple Push Notification service SSL (Sandbox)ï¼Œç„¶åç‚¹å‡» continue æ¥åˆ° Creat New Certificate é¡µé¢ï¼Œéœ€è¦ä¸Šä¼  CSR æ–‡ä»¶ ç”±ä¸Šå›¾å¯çŸ¥ï¼Œä¸Šä¼ è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œæ‚¨éœ€è¦Macä¸Šçš„è¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰æ–‡ä»¶ï¼Œè¦æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦ã€‚ ç‚¹å‡» Choose file å¯¼å…¥ CSR æ–‡ä»¶ ç‚¹å‡» download å¹¶ åŒå‡» è¿è¡Œåˆ°é¡¹ç›®ä¸­ æ¥ä¸‹æ¥å°±æ˜¯é…ç½®å¼€å‘ç¯å¢ƒçš„ æ¨é€è¯ä¹¦ æŒ‰åºå·æ“ä½œï¼Œè¿›å…¥ æ‰¾åˆ° Services ç‚¹å‡» Continue æŒ‰ä¸‹é¢çš„åºå·ä¾æ¬¡æ“ä½œ ä¹‹åè¿˜æ˜¯é…ç½®CSRæ–‡ä»¶ ä¸‹è½½æ¨é€è¯ä¹¦ ç”Ÿäº§ç¯å¢ƒè¯ä¹¦ å’Œ ç”Ÿäº§ç¯å¢ƒæ¨é€è¯ä¹¦ ç±»ä¼¼äº å¼€å‘ç¯å¢ƒï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº† æœ€åç”Ÿäº§å››ç§ç±»å‹çš„è¯ä¹¦ é¡¹ç›®ä¸­ä½¿ç”¨ é¡¹ç›®ä¸­é€‰æ‹©TARGETï¼Œæ·»åŠ ä¸€ä¸ªè´¦æˆ· Add an Account: è¾“å…¥ä½ çš„ Apple ID è´¦å· å‘é€ç»™è‡ªå·±æ‰‹æœºéªŒè¯ç  é€‰ä¸­ä½ æ·»åŠ çš„è´¦å·å ç¡®ä¿Bundle ID å’Œ ä½ å¼€å‘è€…è´¦å·ä¸Šçš„ä¸€è‡´","categories":[{"name":"iOS-å¼€å‘è€…è´¦å·æ¢ç´¢ç¯‡","slug":"iOS-å¼€å‘è€…è´¦å·æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/iOS-%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://www.bboyzj.cn/tags/iOS/"}],"keywords":[{"name":"iOS-å¼€å‘è€…è´¦å·æ¢ç´¢ç¯‡","slug":"iOS-å¼€å‘è€…è´¦å·æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/iOS-%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"iOSå¼€å‘è€…è´¦å·02ï¼šå¼€å‘è€…è´¦å·å‘ç¥¨ä¿®æ”¹æŠ¬å¤´æµç¨‹","slug":"å¼€å‘è€…è´¦å·ç”³è¯·æµç¨‹/iOSå¼€å‘è€…è´¦å·02ï¼šå¼€å‘è€…è´¦å·å‘ç¥¨ä¿®æ”¹æŠ¬å¤´æµç¨‹","date":"2020-08-29T03:25:08.000Z","updated":"2023-03-08T21:50:35.018Z","comments":true,"path":"2020/08/29/å¼€å‘è€…è´¦å·ç”³è¯·æµç¨‹/iOSå¼€å‘è€…è´¦å·02ï¼šå¼€å‘è€…è´¦å·å‘ç¥¨ä¿®æ”¹æŠ¬å¤´æµç¨‹/","link":"","permalink":"https://www.bboyzj.cn/2020/08/29/%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E7%94%B3%E8%AF%B7%E6%B5%81%E7%A8%8B/iOS%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B702%EF%BC%9A%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E5%8F%91%E7%A5%A8%E4%BF%AE%E6%94%B9%E6%8A%AC%E5%A4%B4%E6%B5%81%E7%A8%8B/","excerpt":"","text":"èƒŒæ™¯ç”±äºå…¬å¸ä¹‹å‰æœ‰äººæ³¨å†Œè¿‡å¼€å‘è€…è´¦å·ï¼Œä½†æ˜¯å·²ç»å¾ˆä¹…å¾ˆä¹…æ²¡æœ‰ç”¨äº†ï¼Œæ‰€ä»¥å…å»äº†æˆ‘ä»å¤´æ³¨å†Œçš„éº»çƒ¦ï¼Œæˆ‘åªè¦ç”¨ visaå¡ å»ç»­è´¹å°±å¯ä»¥äº† å‘ç¥¨å¡«å†™é”™è¯¯å¤„ç†æµç¨‹ ç™»å½• å¼€å‘è€…ç½‘ç«™ ï¼Œç‚¹å‡» Account ç™»å½•è´¦å·ï¼Œç‚¹å‡»ç»­è´¹ï¼Œå…·ä½“æµç¨‹å¾ˆç®€å•ï¼ŒæŒ‰ç…§æç¤ºèµ°å°±è¡Œäº†ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼€å‘ç¥¨ï¼Œé€‰æ‹© ä¼ä¸šå‘ç¥¨ï¼Œéœ€è¦å¡«å†™ å…¬å¸æŠ¬å¤´ å’Œ çº³ç¨äººè¯†åˆ«å·ã€‚æˆ‘å°±æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹æŠŠå…¬å¸çš„æŠ¬å¤´å¡«å†™é”™çš„ã€‚ ç»­è´¹æ–¹æ³•æœ‰ä¸¤ç§ï¼š APPå†…è´­ ç»­è´¹ï¼šä¸‹è½½ Developerï¼Œ é€šè¿‡APPå»ä»˜è´¹ ç½‘é¡µ ç»­è´¹ï¼šä¸€èˆ¬è®¢å•å·ä»¥ Wå¼€å¤´ ååŠ  9ä½æ•°å­— å¦‚ä½•è§£å†³ å‘ç¥¨ é—®é¢˜ï¼š APPå†…è´­ä¹° ç»­è´¹ï¼šé€šè¿‡ å¼€å‘è€…ç½‘ç«™ -&gt; è”ç³»æˆ‘ä»¬ -&gt; ä¼šå‘˜èµ„æ ¼å’Œè´¦æˆ· -&gt; è®¡åˆ’è´­ä¹°å’Œç»­è®¢ -&gt; ç”µè¯ ç½‘é¡µ ç»­è´¹ï¼šé€šè¿‡æ‹¨æ‰“ 400-666-8800 æŒ‰æç¤ºéŸ³ -&gt; æ‰¾åˆ° è´¦æˆ·è´­ä¹°æŠ€æœ¯æ”¯æŒï¼Œå»è§£å†³ï¼Œæˆ‘æ˜¯åºŸäº†å¥½é•¿æ—¶é—´æ‰å¼„æ˜ç™½ï¼Œå› ä¸ºæˆ‘çš„è®¢å•å·æ˜¯ W å¼€å¤´çš„ï¼Œä¸èƒ½èµ° å†…è´­ä¹° æµç¨‹ã€‚","categories":[{"name":"iOS-å¼€å‘è€…è´¦å·","slug":"iOS-å¼€å‘è€…è´¦å·","permalink":"https://www.bboyzj.cn/categories/iOS-%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://www.bboyzj.cn/tags/iOS/"}],"keywords":[{"name":"iOS-å¼€å‘è€…è´¦å·","slug":"iOS-å¼€å‘è€…è´¦å·","permalink":"https://www.bboyzj.cn/categories/iOS-%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7/"}]},{"title":"iOSå¼€å‘è€…è´¦å·01ï¼šå¼€å‘è€…è´¦å·ä»‹ç»","slug":"å¼€å‘è€…è´¦å·ç”³è¯·æµç¨‹/iOSå¼€å‘è€…è´¦å·01ï¼šå¼€å‘è€…è´¦å·ä»‹ç»","date":"2020-08-29T02:54:02.000Z","updated":"2023-03-08T21:48:14.902Z","comments":true,"path":"2020/08/29/å¼€å‘è€…è´¦å·ç”³è¯·æµç¨‹/iOSå¼€å‘è€…è´¦å·01ï¼šå¼€å‘è€…è´¦å·ä»‹ç»/","link":"","permalink":"https://www.bboyzj.cn/2020/08/29/%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E7%94%B3%E8%AF%B7%E6%B5%81%E7%A8%8B/iOS%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B701%EF%BC%9A%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"å¼€å‘è€…è´¦å·è‹¹æœå¼€å‘è€…è´¦å·å¯åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šä¸ªäººã€å…¬å¸ã€ä¼ä¸šï¼Œä¸”ä¸‰è€…çš„è´¹ç”¨ä»¥åŠæƒé™ç­‰ä¸å°½ç›¸åŒã€‚ ä¸ªäººè´¦å· è´¹ç”¨ï¼š99 ç¾å…ƒ&#x2F;å¹´åä½œäººæ•°ï¼šä»…é™å¼€å‘è€…è‡ªå·±ä¸éœ€è¦å¡«å†™å…¬å¸çš„é‚“ç™¾æ°ç¼–ç ï¼ˆ D-U-N-S Numberï¼‰æ”¯æŒè´¦å·ä¸‹çš„ app ä¸Šçº¿ App Storeéœ€è¦åˆ›å»º Apple ID å…¬å¸è´¦å· è´¹ç”¨ï¼š99 ç¾å…ƒ&#x2F;å¹´å…è®¸å¤šä¸ªå¼€å‘è€…åä½œå¼€å‘éœ€è¦å¡«å†™å…¬å¸çš„é‚“ç™¾æ°ç¼–ç ï¼ˆ D-U-N-S Numberï¼‰è¯¥è´¦å·ä¸‹çš„ app å¯ä¸Šçº¿è‡³ App Storeéœ€è¦åˆ›å»º Apple ID è‹¹æœä¼ä¸šå¼€å‘è€…è´¦å· è´¹ç”¨ï¼š299 ç¾å…ƒ&#x2F;å¹´å…è®¸å¤šä¸ªå¼€å‘è€…åä½œå¼€å‘éœ€è¦å¡«å†™å…¬å¸çš„é‚“ç™¾æ°ç¼–ç ï¼ˆ D-U-N-S Numberï¼‰è¯¥è´¦å·ä¸‹çš„ app ä¸èƒ½å‘å¸ƒåˆ° App Store ä¸­éœ€è¦åˆ›å»º Apple ID å¼€å‘è€…è´¦å·ä»˜æ¬¾æ–¹å¼è‹¹æœå…¬å¸åªæ¥å—2ç§ä»˜æ¬¾æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯ VISA å¡ï¼Œå¦å¤–ä¸€ç§æ˜¯ ä¸‡äº‹è¾¾å¡ï¼ˆMasterCardï¼‰ï¼Œéƒ½å¯ä»¥åœ¨å›½å†…é“¶è¡ŒåŠç† ä»‹äºæˆ‘æœ¬äººå»åŠç†VISAå¡çš„æµæˆï¼š å¸¦ç€è‡ªå·±çš„èº«ä»½è¯ï¼ŒçŸ¥é“å…¬å¸åœ°å€ã€å…¬å¸åº§æœºç”µè¯ï¼Œè¿™ä¸‰ä¸ªæœ€ä¸»è¦ï¼Œå…¶ä»–çš„æ ¹æ®é“¶è¡ŒåŠå¡è¦æ±‚å»å¡«å†™ã€‚ åŠå¡é€‰æ‹©ä¸­ç¾åŒæ±‡å¸VISAå¡ï¼Œå…·ä½“ä½ å»é“¶è¡ŒåŠç†å°±çŸ¥é“äº†ã€‚ MasterCard ä¸ VISA å¡çš„åŒºåˆ«æœ‰ï¼š ç›®å‰å›½é™…ä¸Šæœ‰å…­å¤§ä¿¡ç”¨å¡å“ç‰Œï¼Œåˆ†åˆ«æ˜¯ å¨å£«å›½é™…ç»„ç»‡ï¼ˆVISA Internationalï¼‰ åŠ ä¸‡äº‹è¾¾å¡å›½é™…ç»„ç»‡ï¼ˆMasterCard Internationalï¼‰ ä¸¤å¤§ç»„ç»‡åŠ ç¾å›½è¿é€šå›½é™…è‚¡ä»½æœ‰é™å…¬å¸ï¼ˆAmerica Expressï¼‰ã€ä¸­å›½é“¶è”è‚¡ä»½æœ‰é™å…¬å¸ï¼ˆChina UnionPay Co.,Ltd.ï¼‰ã€å¤§æ¥ä¿¡ç”¨å¡æœ‰é™å…¬å¸ï¼ˆDiners Clubï¼‰ã€JCBæ—¥æœ¬å›½é™…ä¿¡ç”¨å¡å…¬å¸ï¼ˆJCBï¼‰å››å®¶ä¸“ä¸šä¿¡ç”¨å¡å…¬å¸ã€‚ VISA(å¨å£«å¡ï¼‰ã€Mastercardï¼ˆä¸‡äº‹è¾¾å¡ï¼‰ã€China UnionPayï¼ˆé“¶è”å¡ï¼‰åœ¨å…¨çƒèŒƒå›´æ„å»ºäº†ä¸€ä¸ªåˆ·å¡æ¶ˆè´¹çš„è”ç›Ÿï¼Œå›½å†…é“¶è¡Œä¸ä»–ä»¬åˆä½œä»¥åï¼Œå›½å†…é“¶è¡Œå‘è¡Œçš„ä¿¡ç”¨å¡å°±èƒ½åœ¨ä»–ä»¬è”ç›ŸèŒƒå›´å†…åˆ·å¡æ¶ˆè´¹ï¼Œåœ¨éƒ¨åˆ†å›½å®¶åœ°åŒºç”šè‡³å¯ä»¥æŒé“¶è”å¡ç›´æ¥æ¶ˆè´¹ã€‚ä½ å¯ä»¥åœ¨ç”³è¯·ä¿¡ç”¨å¡çš„æ—¶å€™é€‰æ‹©ç”³è¯·VISA(å¨å£«ï¼‰ä¿¡ç”¨å¡è¿˜æ˜¯Mastercardï¼ˆä¸‡äº‹è¾¾ï¼‰ä¿¡ç”¨å¡ã€‚ å°±ç›®å‰æ¥è®²ä¸¤å®¶å›½é™…ç»„ç»‡åœ¨å›½å†…åŒºåˆ«ä¸å¤§ï¼ŒåŒºåˆ«æ¯”è¾ƒå¤§çš„æ˜¯é“¶è”å¡ï¼Œé€‰æ‹©å“ªä¸€ä¸ªå®Œå…¨å¯ä»¥å‡­è‡ªå·±çš„å–œå¥½ã€‚å¦‚æœä½ ç»å¸¸åœ¨ äºšæ´²ã€æ¾³å¤§åˆ©äºšæ—…æ¸¸ æˆ–è€… åˆ·å¡æ¶ˆè´¹çš„è¯ï¼Œé‚£ä¹ˆå»ºè®®ä½ é€‰æ‹© VISAï¼Œå› ä¸ºVISAåœ¨äºšæ´²å’Œæ¾³å¤§åˆ©äºšå—ç†çš„å•†æˆ·æ•°é‡æ¯”è¾ƒå¤šï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ã€‚ Mastercardçš„ä¼˜åŠ¿åœ¨äº æ¬§æ´² å’Œ åŒ—ç¾ã€‚ç»å¸¸å»è¿™æ¬§æ´²å’Œç¾æ´²çš„æœ‹å‹å¯ä»¥é€‰æ‹© Mastercardï¼ˆä¸‡äº‹è¾¾ï¼‰","categories":[{"name":"iOS-å¼€å‘è€…è´¦å·","slug":"iOS-å¼€å‘è€…è´¦å·","permalink":"https://www.bboyzj.cn/categories/iOS-%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://www.bboyzj.cn/tags/iOS/"}],"keywords":[{"name":"iOS-å¼€å‘è€…è´¦å·","slug":"iOS-å¼€å‘è€…è´¦å·","permalink":"https://www.bboyzj.cn/categories/iOS-%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7/"}]},{"title":"OCæ•°æ®ç»“æ„02ï¼šäºŒå‰æ ‘æ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCæ•°æ®ç»“æ„02ï¼šäºŒå‰æ ‘æ¢ç´¢","date":"2020-08-26T08:35:40.000Z","updated":"2023-03-06T10:16:16.075Z","comments":true,"path":"2020/08/26/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCæ•°æ®ç»“æ„02ï¼šäºŒå‰æ ‘æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/26/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%8402%EF%BC%9A%E4%BA%8C%E5%8F%89%E6%A0%91%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"ä»€ä¹ˆæ˜¯äºŒå‰æ ‘æ ‘å½¢ç»“æ„ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ ä»¥å†…å‡ç§°ä¸º äºŒå‰æ ‘ï¼Œåˆ†ä¸º å·¦å­æ ‘ å’Œ å³å­æ ‘ï¼Œæœ‰é¡ºåºï¼Œä¸èƒ½é¢ å€’ï¼›æ¯”å¦‚æŠŠäººçœ‹åšæ ‘ï¼šå¤´æ˜¯æ ‘æ ¹ï¼Œå·¦å³æ˜¯åå­æ ‘ï¼Œå³æ‰‹æ˜¯å³å­æ ‘ã€‚ äºŒå‰æ ‘éå†ç±»å‹ æ·±åº¦ä¼˜å…ˆéå†ï¼šé‡‡ç”¨æ ˆ å…ˆåºéå†ï¼šå¯¹ä»»ä¸€å­æ ‘ï¼Œå…ˆè®¿é—®æ ¹ï¼Œç„¶åéå†å·¦å­æ ‘ï¼Œæœ€åéå†å…¶å³å­æ ‘ ä¸­åºéå†ï¼šå¯¹ä»»ä¸€å­æ ‘ï¼Œå…ˆéå†å·¦å­æ ‘ï¼Œç„¶åè®¿é—®æ ¹ï¼Œæœ€åéå†å…¶å³å­æ ‘ ååºéå†ï¼šå¯¹ä»»ä¸€å­æ ‘ï¼Œå…ˆéå†å…¶å·¦å­æ ‘ï¼Œç„¶åéå†å…¶å³å­æ ‘ï¼Œæœ€åè®¿é—®æ ¹ å¹¿åº¦ä¼˜å…ˆéå†ï¼šé‡‡ç”¨é˜Ÿåˆ— å±‚æ¬¡éå†ï¼Œä»ä¸Šå¾€ä¸‹ å¯¹æ¯ä¸€å±‚ä¾æ¬¡è®¿é—®ï¼Œæ¯ä¸€å±‚ä» å·¦å¾€å³ï¼ˆæˆ–ä»å³å¾€å·¦ï¼‰è®¿é—®èŠ‚ç‚¹ï¼Œè®¿é—®å®Œä¸€å±‚å°±è¿›å…¥ä¸‹ä¸€å±‚ï¼Œç›´åˆ°æ²¡æœ‰èŠ‚ç‚¹å¯ä»¥è®¿é—®ä¸ºæ­¢ã€‚ åŒºåˆ«ï¼š æ·±åº¦ä¼˜å…ˆç®—æ³•ï¼šä¸å…¨éƒ¨ä¿ç•™èŠ‚ç‚¹ï¼Œå ç”¨ç©ºé—´å°ï¼Œæœ‰å›æº¯æ“ä½œï¼Œè¿è¡Œé€Ÿåº¦æ…¢ï¼Œç”¨æ—¶é—´æ¢ç©ºé—´ å¹¿åº¦ä¼˜å…ˆç®—æ³•ï¼šä¿ç•™å…¨éƒ¨èŠ‚ç‚¹ï¼Œå ç”¨ç©ºé—´å¤§ï¼Œæ— å›æº¯æ“ä½œï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ äºŒå‰æ’åºæ ‘çš„å¥½å¤„ï¼ŸäºŒå‰æ ‘æ˜¯ä¸€ç§æ¯”è¾ƒæŠ˜ä¸­çš„æ–¹æ¡ˆï¼›æ•°ç»„çš„æœç´¢æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸‹æ ‡ï¼Œä½†åˆ é™¤æˆ–æ’å…¥æ¯”è¾ƒè€—æ—¶ï¼›é“¾è¡¨ä¸ä¹‹ç›¸åï¼Œåˆ é™¤æˆ–æ’å…¥å¾ˆå¿«ï¼Œä½†æŸ¥æ‰¾å¾ˆæ…¢ï¼›äºŒå‰æ’åºæ ‘æ—¢æœ‰é“¾è¡¨çš„å¥½å¤„ï¼Œä¹Ÿæœ‰æ•°ç»„çš„å¥½å¤„ï¼Œåœ¨å¤„ç†å¤§æ‰¹é‡çš„åŠ¨æ€æ•°æ®æ˜¯æ¯”è¾ƒæœ‰ç”¨çš„ äºŒå‰æ’åºæ ‘èŠ‚ç‚¹å®šä¹‰é‡‡ç”¨å•é¡¹é“¾è¡¨çš„å½¢å¼ï¼Œåªä»æ ¹èŠ‚ç‚¹æŒ‡å‘å­©å­èŠ‚ç‚¹ï¼Œä¸ä¿å­˜çˆ¶èŠ‚ç‚¹ã€‚ å¯¹äºäºŒå‰æœç´¢æ ‘è¿™ç§æ•°æ®ç±»å‹ï¼Œç”¨ç®€å•çš„æ•°ç»„æ¥è¡¨ç¤ºæ˜¯ä¸é€‚åˆçš„ã€‚æ‰€ä»¥è¦å»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼š å€¼ï¼šå°±ç”¨æœ€ç®€å•çš„æ•´æ•°æ¥è¡¨ç¤ºï¼Œå®é™…ä½¿ç”¨ä¸­ï¼Œè¿™ä¸ªæ•´å‹å€¼ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¯ä»¥å½“åškeyæ¥ç”¨ï¼Œè¿™æ˜¯äºŒå‰æœç´¢æ ‘æ’åºçš„å‡­è¯ã€‚ å·¦å­æ ‘ï¼šç”¨ä¸€ä¸ªåŒç±»å‹çš„æŒ‡é’ˆè¡¨ç¤º å³å­æ ‘ï¼šç”¨ä¸€ä¸ªåŒç±»å‹çš„æŒ‡é’ˆè¡¨ç¤º ä»¥ä¸Š3ä¸ªæ˜¯äºŒå‰æœç´¢æ ‘å¿…ä¸å¯å°‘çš„å±æ€§ 123456789// äºŒå‰æ’åºæ ‘èŠ‚ç‚¹@interface BinaryTreeNode : NSObject// å€¼@property (nonatomic, assign) NSInteger value;// å·¦èŠ‚ç‚¹@property (nonatomic, strong) BinaryTreeNode *leftNode;// å³èŠ‚ç‚¹@property (nonatomic, strong) BinaryTreeNode *rightNode;@end å¦‚ä½•éªŒè¯ä¸¤ä¸ªäºŒå‰æ ‘æ˜¯å®Œå…¨ç›¸ç­‰çš„ï¼Ÿé€’å½’ å»åˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹çš„ å€¼ æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå‡ç›¸ç­‰ï¼Œåˆ™ä¸¤ä¸ªäºŒå‰æ ‘å®Œå…¨ç›¸ç­‰ 123456789101112- (void)isSameTree:(TreeNode *)root1 tree:(TreeNode *)root2&#123; if (root1 == null &amp;&amp; root2 == null) &#123; return true; &#125; if ((root1 == null &amp;&amp; root2 != null) || (root1 != null &amp;&amp; root2 == null))&#123; return false; &#125; if (root1.val != root2.val) &#123; // åˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå»é™¤æ­¤åˆ¤æ–­ï¼Œåˆ™åˆ¤æ–­ä¸¤ä¸ªäºŒå‰æ ‘æ˜¯å¦ç»“æ„ç›¸ç­‰ return false; &#125; return [self isSameTree:root1.left tree:root2.left] &amp;&amp; [self isSameTree:root1.right tree:root2.right];&#125; åˆ›å»ºäºŒå‰æ’åºæ ‘ äºŒå‰æ ‘ä¸­å·¦å³èŠ‚ç‚¹å€¼æœ¬èº«æ²¡æœ‰å¤§å°ä¹‹åˆ†ï¼Œæ‰€ä»¥å¦‚æœè¦åˆ›å»ºäºŒå‰æ ‘ï¼Œå°±éœ€è¦è€ƒè™‘å¦‚ä½•å¤„ç†æŸä¸ªèŠ‚ç‚¹æ˜¯å·¦èŠ‚ç‚¹è¿˜æ˜¯å³èŠ‚ç‚¹ï¼Œå¦‚ä½•ç»ˆæ­¢æŸä¸ªå­æ ‘è€Œåˆ‡æ¢åˆ°å¦ä¸€ä¸ªå­æ ‘ã€‚ å› æ­¤æˆ‘é€‰æ‹©äº† äºŒå‰æ’åºæ ‘ï¼ŒäºŒå‰æ’åºæ ‘ä¸­å¯¹äºå·¦å³èŠ‚ç‚¹æœ‰æ˜ç¡®çš„è¦æ±‚ï¼Œç¨‹åºå¯ä»¥è‡ªåŠ¨æ ¹æ®é”®å€¼å¤§å°è‡ªåŠ¨é€‰æ‹©æ˜¯å·¦èŠ‚ç‚¹è¿˜æ˜¯å³èŠ‚ç‚¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142/** * åˆ›å»ºäºŒå‰æ’åºæ ‘ * äºŒå‰æ’åºæ ‘ï¼šå·¦èŠ‚ç‚¹å€¼å…¨éƒ¨å°äºæ ¹èŠ‚ç‚¹å€¼ï¼Œå³èŠ‚ç‚¹å€¼å…¨éƒ¨å¤§äºæ ¹èŠ‚ç‚¹å€¼ * @param values æ•°ç»„ * @return äºŒå‰æ ‘æ ¹èŠ‚ç‚¹ */+ (BinaryTreeNode *)createTreeWithValues:(NSArray *)values &#123; BinaryTreeNode *root = nil; for (NSInteger i=0; i&lt;values.count; i++) &#123; NSInteger value = [(NSNumber *)[values objectAtIndex:i] integerValue]; root = [BinaryTree addTreeNode:root value:value]; &#125; return root;&#125;/** * å‘äºŒå‰æ’åºæ ‘èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ * * @param treeNode æ ¹èŠ‚ç‚¹ * @param value å€¼ * * @return æ ¹èŠ‚ç‚¹ */+ (BinaryTreeNode *)addTreeNode:(BinaryTreeNode *)treeNode value:(NSInteger)value &#123; //æ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ›å»ºèŠ‚ç‚¹ if (!treeNode) &#123; treeNode = [BinaryTreeNode new]; treeNode.value = value; NSLog(@&quot;node:%@&quot;, @(value)); &#125; else if (value &lt;= treeNode.value) &#123; NSLog(@&quot;to left&quot;); // å€¼å°äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æ’å…¥åˆ°å·¦å­æ ‘ treeNode.leftNode = [BinaryTree addTreeNode:treeNode.leftNode value:value]; &#125;else &#123; NSLog(@&quot;to right&quot;); // å€¼å¤§äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æ’å…¥åˆ°å³å­æ ‘ treeNode.rightNode = [BinaryTree addTreeNode:treeNode.rightNode value:value]; &#125; return treeNode;&#125; å®é™…ä½¿ç”¨ 1ï¼‰åˆ›å»ºä¸€ä¸ªäºŒå‰æ ‘ç±»BinaryTreeNodeï¼Œåœ¨ç±»ä¸­å®ç°å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516171819#import &lt;Foundation/Foundation.h&gt;NS_ASSUME_NONNULL_BEGIN@interface BinaryTreeNode : NSObject// å€¼ï¼šå½“åškeyæ¥ç”¨ï¼Œæ˜¯æ’åºç”¨çš„å‡­è¯@property (nonatomic,assign)NSInteger value;// å·¦å­æ ‘@property (nonatomic,strong)BinaryTreeNode * leftChild;// å³å­æ ‘@property (nonatomic,strong)BinaryTreeNode * rightChild;// åˆ›å»ºäºŒå‰æ’åºæ ‘+ (BinaryTreeNode *)createBinaryTreeWithValues:(NSArray *)values;// å‘äºŒå‰æ’åºæ ‘ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹+ (BinaryTreeNode *)addNode:(BinaryTreeNode *)rootNode value:(NSInteger)value;@endNS_ASSUME_NONNULL_END 12345678910111213141516171819202122232425262728293031323334353637383940/* åˆ›å»ºäºŒå‰æ’åºæ ‘ äºŒå‰æ’åºæ ‘ï¼šå·¦èŠ‚ç‚¹å€¼å…¨éƒ¨å°äºæ ¹èŠ‚ç‚¹å€¼ï¼Œå³èŠ‚ç‚¹å€¼å…¨éƒ¨å¤§äºæ ¹èŠ‚ç‚¹å€¼ @param valuesï¼šæ•°ç»„ @return äºŒå‰æ’åºæ ‘æ ¹èŠ‚ç‚¹ */+ (BinaryTreeNode *)createBinaryTreeWithValues:(NSArray *)values&#123; BinaryTreeNode * rootNode = nil; for (NSNumber * number in values) &#123; NSInteger value = [number integerValue]; rootNode = [BinaryTreeNode addNode:rootNode value:value]; &#125; return rootNode;&#125;/* å‘äºŒå‰æ’åºæ ‘èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ @param rootNode æ ¹èŠ‚ç‚¹ @param value å€¼ @return æ ¹èŠ‚ç‚¹ */+ (BinaryTreeNode *)addNode:(BinaryTreeNode *)rootNode value:(NSInteger)value&#123; // æ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ›å»ºèŠ‚ç‚¹ if (rootNode == nil) &#123; rootNode = [[BinaryTreeNode alloc] init]; rootNode.value = value; NSLog(@&quot;node:%@&quot;,@(value)); &#125;else if (value &lt;= rootNode.value) &#123; NSLog(@&quot;to left&quot;); // å€¼å°äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æ’å…¥åˆ°å·¦å­æ ‘ï¼›è¿™æ˜¯é€’å½’ï¼Œå·¦å­æ ‘å°†åšåŒæ ·çš„äº‹å„¿ rootNode.leftChild = [self addNode:rootNode.leftChild value:value]; &#125;else if (value &gt; rootNode.value) &#123; NSLog(@&quot;to right&quot;); // å€¼å¤§äºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æ’å…¥åˆ°å³å­æ ‘ï¼›è¿™æ˜¯é€’å½’ï¼Œå³å­æ ‘å°†åšåŒæ ·çš„äº‹å„¿ rootNode.rightChild = [self addNode:rootNode.rightChild value:value]; &#125;else &#123; NSLog(@&quot;äºŒå‰æ’åºæ ‘æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ï¼Œå€¼%@å·²å­˜åœ¨ï¼Œä¸èƒ½æ’å…¥&quot;,@(value)); &#125; return rootNode;&#125; 2ï¼‰åœ¨controllerä¸­ï¼Œç”¨ä¸€ä¸ªå±æ€§æŒæœ‰è¿™ä¸ªäºŒå‰æœç´¢æ ‘ã€‚ 12345678#import &quot;ViewController.h&quot;//äºŒå‰æ ‘#import &quot;BinaryTreeNode.h&quot;@interface ViewController ()// äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä»£è¡¨ä¸€æ£µæ ‘@property (strong, nonatomic) BinaryTreeNode *rootNode;@end è¾“å…¥ç”¨ä¸€ä¸²å€¼ï¼Œå¾—åˆ°ä¸€é¢—äºŒå‰æœç´¢æ ‘ 1234567- (void)viewDidLoad &#123; [super viewDidLoad]; //åˆ›å»ºä¸€ä¸ªäºŒå‰æ ‘ NSArray *values = @[@200, @23, @456, @89, @23, @670, @5674, @15]; self.rootNode = [BinaryTreeNode createBinaryTreeWithValues:values]; &#125; 3ï¼‰ç”¨æ–­ç‚¹ï¼ŒæŸ¥çœ‹â€œé“¾å¼â€ç»“æ„ï¼ŒåŒæ—¶é€šè¿‡logå¯ä»¥çœ‹å‡ºåˆ›å»ºè¿‡ç¨‹ã€‚ 4ï¼‰ç”Ÿæˆçš„äºŒå‰æ ‘å›¾ å…ˆåºéå† å…ˆè®¿é—®æ ¹ï¼Œå†éå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘ã€‚å…¸å‹çš„é€’å½’æ€æƒ³ã€‚ 123456789101112131415161718/** * å…ˆåºéå† * å…ˆè®¿é—®æ ¹ï¼Œå†éå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘ * * @param rootNode æ ¹èŠ‚ç‚¹ * @param handler è®¿é—®èŠ‚ç‚¹å¤„ç†å‡½æ•° */+ (void)preOrderTraverseTree:(BinaryTreeNode *)rootNode handler:(void(^)(BinaryTreeNode *treeNode))handler &#123; if (rootNode) &#123; // å…ˆæ ¹ if (handler) &#123; handler(rootNode); &#125; // å†å·¦ [self preOrderTraverseTree:rootNode.leftNode handler:handler]; // æœ€åå³ [self preOrderTraverseTree:rootNode.rightNode handler:handler]; &#125;&#125; å®é™…ä½¿ç”¨ 12345678// å…ˆåºéå†- (void)preOrderTraverse&#123; NSMutableArray * preArr = [NSMutableArray array]; [BinaryTreeNode preOrderTraverseTree:self.rootNode handler:^(BinaryTreeNode * _Nonnull treeNode) &#123; [preArr addObject:[NSNumber numberWithInteger:treeNode.value]]; &#125;]; NSLog(@&quot;å…ˆåºéå†ï¼š%@&quot;, preArr);&#125; æŸ¥çœ‹æ‰“å°ç»“æœï¼š 1234567892020-08-26 22:45:09.310234+0800 OC-äºŒå‰æ ‘[50561:2829401] å…ˆåºéå†ï¼š( 200, 23, 15, 89, 456, 670, 5674) ä¸­åºéå† å…ˆéå†å·¦å­æ ‘ï¼Œå†è®¿é—®æ ¹ï¼Œå†éå†å³å­æ ‘ã€‚å¯¹äºäºŒå‰æ’åºæ ‘æ¥è¯´ï¼Œä¸­åºéå†å¾—åˆ°çš„åºåˆ—æ˜¯ä¸€ä¸ªä»å°åˆ°å¤§æ’åºå¥½çš„åºåˆ—ã€‚ 12345678910111213141516/** * ä¸­åºéå† * å…ˆéå†å·¦å­æ ‘ï¼Œå†è®¿é—®æ ¹ï¼Œå†éå†å³å­æ ‘ * * @param rootNode æ ¹èŠ‚ç‚¹ * @param handler è®¿é—®èŠ‚ç‚¹å¤„ç†å‡½æ•° */+ (void)inOrderTraverseTree:(BinaryTreeNode *)rootNode handler:(void(^)(BinaryTreeNode *treeNode))handler &#123; if (rootNode) &#123; [self inOrderTraverseTree:rootNode.leftNode handler:handler]; if (handler) &#123; handler(rootNode); &#125; [self inOrderTraverseTree:rootNode.rightNode handler:handler]; &#125;&#125; å®é™…ä½¿ç”¨ 12345678//ä¸­åºéå†- (void)inOrderTraverse&#123; NSMutableArray * inArr = [NSMutableArray array]; [BinaryTreeNode inOrderTraverseTree:self.rootNode handler:^(BinaryTreeNode * _Nonnull treeNode) &#123; [inArr addObject:[NSNumber numberWithInteger:treeNode.value]]; &#125;]; NSLog(@&quot;ä¸­åºéå†ï¼š%@&quot;, inArr);&#125; æŸ¥çœ‹æ‰“å°ç»“æœ 1234567892020-08-26 22:49:26.310344+0800 OC-äºŒå‰æ ‘[50591:2832806] ä¸­åºéå†ï¼š( 15, 23, 89, 200, 456, 670, 5674) åç»­éå† å…ˆéå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘ï¼Œå†è®¿é—®æ ¹ 12345678910111213141516/** * ååºéå† * å…ˆéå†å·¦å­æ ‘ï¼Œå†éå†å³å­æ ‘ï¼Œå†è®¿é—®æ ¹ * * @param rootNode æ ¹èŠ‚ç‚¹ * @param handler è®¿é—®èŠ‚ç‚¹å¤„ç†å‡½æ•° */+ (void)afterOrderTraverseTree:(BinaryTreeNode *)rootNode handler:(void(^)(BinaryTreeNode *treeNode))handler &#123; if (rootNode) &#123; [self afterOrderTraverseTree:rootNode.leftNode handler:handler]; [self afterOrderTraverseTree:rootNode.rightNode handler:handler]; if (handler) &#123; handler(rootNode); &#125; &#125;&#125; å®é™…ä½¿ç”¨ 12345678//ååºéå†- (void)afterOrderTraverse&#123; NSMutableArray * afterArr = [NSMutableArray array]; [BinaryTreeNode afterOrderTraverseTree:self.rootNode handler:^(BinaryTreeNode * _Nonnull treeNode) &#123; [afterArr addObject:[NSNumber numberWithInteger:treeNode.value]]; &#125;]; NSLog(@&quot;ååºéå†ï¼š%@&quot;, afterArr);&#125; æŸ¥çœ‹æ‰“å°ç»“æœ 123456789102020-08-26 22:51:50.637367+0800 OC-äºŒå‰æ ‘[50628:2835309] ååºéå†ï¼š( 15, 89, 23, 5674, 670, 456, 200) ç¿»è½¬äºŒå‰æ ‘ ä½ ä¼šç¿»è½¬äºŒå‰æ ‘å—ï¼Ÿå¦‚æœä¸ä¼šï¼Œé‚£å¯¹ä¸èµ·ï¼Œæˆ‘ä»¬ä¸ä¼šå½•ç”¨ä½ ï¼ ç¿»è½¬äºŒå‰æ ‘ï¼Œåˆå«æ±‚äºŒå‰æ ‘çš„é•œåƒï¼Œå°±æ˜¯æŠŠäºŒå‰æ ‘çš„å·¦å³å­æ ‘å¯¹è°ƒï¼ˆå½“ç„¶æ˜¯é€’å½’çš„ï¼‰ 1234567891011121314151617181920212223242526272829/* ç¿»è½¬äºŒå‰æ ‘ï¼ˆåˆå«ï¼šäºŒå‰æ ‘çš„é•œåƒï¼‰ @param rootNode æ ¹èŠ‚ç‚¹ @return ç¿»è½¬åçš„æ ‘æ ¹èŠ‚ç‚¹ï¼ˆå…¶å®å°±æ˜¯åŸäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼‰ */// ç¿»è½¬äºŒå‰æ ‘+ (BinaryTreeNode *)flipBinaryTree:(BinaryTreeNode *)rootNode&#123; // åˆ¤ç©º if(!rootNode)&#123; return nil; &#125; // æ²¡æœ‰å­èŠ‚ç‚¹ if(!rootNode.leftNode &amp;&amp; !rootNode.rightNode)&#123; return rootNode; &#125; // å·¦å³å­æ ‘é€’å½’ [self flipBinaryTree:rootNode.leftNode]; [self flipBinaryTree:rootNode.rightNode]; // å·¦å³èŠ‚ç‚¹äº¤æ¢ BinaryTreeNode * tempNode = rootNode.leftNode; rootNode.leftNode = rootNode.rightNode; rootNode.rightNode = tempNode.leftNode; return rootNode;&#125; å®é™…ä½¿ç”¨ 1234// ç¿»è½¬äºŒå‰æ ‘- (void)invertBinaryTree&#123; self.rootNode = [BinaryTreeNode invertBinaryTree:self.rootNode];&#125; æŸ¥çœ‹æ‰“å°ç»“æœ ç”ŸæˆäºŒå‰æ ‘çš„å›¾ æŸ¥æ‰¾äºŒå‰æ ‘ä¸­æŸä¸ªä½ç½®çš„ç»“ç‚¹ç±»ä¼¼ç´¢å¼•æ“ä½œï¼ŒæŒ‰ å±‚æ¬¡ éå†ï¼Œä½ç½®ä»0å¼€å§‹ç®—ã€‚ 12345678910111213141516171819202122232425262728293031323334353637/* æŸ¥æ‰¾äºŒå‰æ ‘æŸä¸ªä½ç½®çš„ç»“ç‚¹ @param index æŒ‰å±‚æ¬¡ä¾¿åˆ©æ ‘æ˜¯çš„ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰ @param rootNode æ ‘æ ¹ç»“ç‚¹ @return ç»“ç‚¹ */// æŒ‡å®šä½ç½®æŸ¥æ‰¾èŠ‚ç‚¹+ (BinaryTreeNode *)findTreeNodeAtIndex:(int)index withRootTree:(BinaryTreeNode *)rootNode&#123; // å¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼ŒæŸ¥æ‰¾ä½ç½®ä¸ç¬¦åˆè§„èŒƒ if (!rootNode || index &lt; 0)&#123; return nil; &#125; NSMutableArray * queueArr = [NSMutableArray arrayWithCapacity:0]; // å‹å…¥æ ¹èŠ‚ç‚¹ [queueArr addObject:rootNode]; while (queueArr.count &gt; 0) &#123; BinaryTreeNode * node = [queueArr firstObject]; // å¦‚æœæ˜¯æ ¹èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥è¿”å› if(index == 0)&#123; return node; &#125; // ä»¿ç…§é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºFIFOï¼Œç§»é™¤æœ€å‰é¢çš„èŠ‚ç‚¹ [queueArr removeObjectAtIndex:0]; index --; // æŒ‰ç…§ä»å·¦å¾€å³ä¾æ¬¡å‹å…¥èŠ‚ç‚¹ if(node.leftNode)&#123; [queueArr addObject:node.leftNode]; &#125; if(node.rightNode)&#123; [queueArr addObject:node.rightNode]; &#125; &#125; // éå†å®Œï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°ä½ç½®ï¼Œè¿”å›nil return nil;&#125; åœ¨controllerä¸­è°ƒç”¨ 12345678// æŸ¥æ‰¾æŸä¸ªä½ç½®çš„èŠ‚ç‚¹- (void)searchNode&#123; BinaryTreeNode * node = [BinaryTreeNode findTreeNodeAtIndex:4 withTree:self.rootNode]; NSLog(@&quot;node-------%@&quot;,[NSNumber numberWithInteger:node.value]);&#125;********æ‰“å°ç»“æœ******2020-08-27 11:29:47.724120+0800 OC-äºŒå‰æ ‘[51450:2892148] node-------89 å±‚æ¬¡éå† æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³çš„æ¬¡åºè¿›è¡Œéå†ã€‚å…ˆéå†å®Œä¸€å±‚ï¼Œå†éå†ä¸‹ä¸€å±‚ï¼Œå› æ­¤åˆå«å¹¿åº¦ä¼˜å…ˆéå†ã€‚éœ€è¦ç”¨åˆ°é˜Ÿåˆ—ï¼Œåœ¨OCé‡Œå¯ä»¥ç”¨å¯å˜æ•°ç»„æ¥å®ç°ã€‚ æ ¹æ”¹äº†ï¼šNSArray *values &#x3D; @[@100, @23, @45, @89, @23, @67, @54, @15]; 1234567891011121314151617181920212223242526272829303132333435/*å±‚æ¬¡éå†ï¼ˆå¹¿åº¦ä¼˜å…ˆï¼‰@param rootNode æ ‘æ ¹èŠ‚ç‚¹@param handler è®¿é—®èŠ‚ç‚¹å¤„ç†å‡½æ•°*/// å±‚æ¬¡éå†+ (void)levelTraverseTree:(BinaryTreeNode *)rootNode handler:(void(^)(BinaryTreeNode *))handler&#123; // ç©ºèŠ‚ç‚¹ if(!rootNode)&#123; return; &#125; // æ•°ç»„å½“æˆé˜Ÿåˆ— NSMutableArray * queueArr = [NSMutableArray array]; // å‹å…¥æ ¹èŠ‚ç‚¹ [queueArr addObject:rootNode]; // å½“é˜Ÿåˆ—æœ‰æ•°æ®çš„æ—¶å€™å»éå† while (queueArr.count &gt; 0) &#123; BinaryTreeNode * node = [queueArr firstObject]; if (handler)&#123; handler(node); &#125; // ä»¿ç…§é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºFIFOï¼Œç§»é™¤æœ€å‰é¢çš„èŠ‚ç‚¹ [queueArr removeObjectAtIndex:0]; // æŒ‰ç…§ä»å·¦å¾€å³ä¾æ¬¡å‹å…¥èŠ‚ç‚¹ if(node.leftNode)&#123; [queueArr addObject:node.leftNode]; &#125; if(node.rightNode)&#123; [queueArr addObject:node.rightNode]; &#125; &#125;&#125; åœ¨controllerä¸­è°ƒç”¨ 12345678//å±‚æ¬¡éå†- (void)levelTraverse&#123; NSMutableArray * levelArr = [NSMutableArray array]; [BinaryTreeNode levelTraverseTree:self.rootNode handler:^(BinaryTreeNode * _Nonnull treeNode) &#123; NSLog(@&quot;value:%ld&quot;,treeNode.value); [levelArr addObject:treeNode]; &#125;];&#125; æ¬¡éå†ï¼šæŸ¥çœ‹æ‰“å°ç»“æœ 12345672020-08-31 17:18:50.185983+0800 OC-äºŒå‰æ ‘[59736:4179500] value:1002020-08-31 17:18:50.186414+0800 OC-äºŒå‰æ ‘[59736:4179500] value:232020-08-31 17:18:50.186896+0800 OC-äºŒå‰æ ‘[59736:4179500] value:152020-08-31 17:18:50.187158+0800 OC-äºŒå‰æ ‘[59736:4179500] value:452020-08-31 17:18:50.187479+0800 OC-äºŒå‰æ ‘[59736:4179500] value:892020-08-31 17:18:50.187753+0800 OC-äºŒå‰æ ‘[59736:4179500] value:672020-08-31 17:18:50.188040+0800 OC-äºŒå‰æ ‘[59736:4179500] value:54 äºŒå‰æ ‘çš„æ·±åº¦ äºŒå‰æ ‘çš„æ·±åº¦å®šä¹‰ä¸ºï¼šä»æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹ä¾æ¬¡ç»è¿‡çš„ç»“ç‚¹å½¢æˆæ ‘çš„ä¸€æ¡è·¯å¾„,æœ€é•¿è·¯å¾„çš„é•¿åº¦ä¸ºæ ‘çš„æ·±åº¦ã€‚1ï¼‰å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™æ·±åº¦ä¸º0ï¼›2ï¼‰å¦‚æœå·¦å³èŠ‚ç‚¹éƒ½æ˜¯ç©ºï¼Œåˆ™æ·±åº¦ä¸º1ï¼›3ï¼‰é€’å½’æ€æƒ³ï¼šäºŒå‰æ ‘çš„æ·±åº¦&#x3D;maxï¼ˆå·¦å­æ ‘çš„æ·±åº¦ï¼Œå³å­æ ‘çš„æ·±åº¦ï¼‰+ 1 12345678910111213141516171819202122/* äºŒå‰æ ‘çš„æ·±åº¦ @param rootNode äºŒå‰æ ‘æ ¹èŠ‚ç‚¹ @return äºŒå‰æ ‘çš„æ·±åº¦ */// äºŒå‰æ ‘çš„æ·±åº¦+ (NSInteger)depthOfTree:(BinaryTreeNode *)rootNode&#123; if (!rootNode)&#123; return 0; &#125; if (!rootNode.leftNode &amp;&amp; !rootNode.rightNode)&#123; return 1; &#125; // å·¦å­æ ‘æ·±åº¦ NSInteger leftDepth = [self depthOfTree:rootNode.leftNode]; // å³å­æ ‘æ·±åº¦ NSInteger rightDepth = [self depthOfTree:rootNode.rightNode]; // äºŒå‰æ ‘æ·±åº¦ NSInteger totalDepth = MAX(leftDepth, rightDepth) + 1; return totalDepth;&#125; åœ¨controllerä¸­è°ƒç”¨ 12345//æ ‘çš„æ·±åº¦- (void)depthTree&#123; NSInteger depth = [BinaryTreeNode depthOfTree:self.rootNode]; NSLog(@&quot;depth:%ld&quot;,depth);&#125; æŸ¥çœ‹ç»“æœ 12020-08-31 17:29:49.989752+0800 OC-äºŒå‰æ ‘[59816:4186549] depth:6 äºŒå‰æ ‘çš„å®½åº¦äºŒå‰æ ‘çš„ å®½åº¦ å®šä¹‰ä¸ºå„å±‚èŠ‚ç‚¹æ•°çš„æœ€å¤§å€¼ã€‚ 12345678910111213141516171819202122232425262728293031323334353637/** * äºŒå‰æ ‘çš„å®½åº¦ * @param rootNode äºŒå‰æ ‘æ ¹èŠ‚ç‚¹ * @return äºŒå‰æ ‘å®½åº¦ */+ (NSInteger)widthOfTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return 0; &#125; NSMutableArray * queueArray = [NSMutableArray array]; [queueArray addObject:rootNode]; // å‹å…¥æ ¹èŠ‚ç‚¹ NSInteger maxWidth = 1; // æœ€å¤§çš„å®½åº¦ï¼Œåˆå§‹åŒ–ä¸º1ï¼ˆå› ä¸ºå·²ç»æœ‰æ ¹èŠ‚ç‚¹ï¼‰ NSInteger curWidth = 0; // å½“å‰å±‚çš„å®½åº¦ while (queueArray.count &gt; 0) &#123; curWidth = queueArray.count; //ä¾æ¬¡å¼¹å‡ºå½“å‰å±‚çš„èŠ‚ç‚¹ for (NSInteger i=0; i&lt;curWidth; i++) &#123; BinaryTreeNode * node = [queueArray firstObject]; // å¼¹å‡ºæœ€å‰é¢çš„èŠ‚ç‚¹ï¼Œä»¿ç…§é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºåŸåˆ™ [queueArray removeObjectAtIndex:0]; // å‹å…¥å·¦å­æ•° if (node.leftNode) &#123; [queueArray addObject:node.leftNode]; &#125; // å‹å…¥å³å­æ ‘ if (node.rightNode) &#123; [queueArray addObject:node.rightNode]; &#125; &#125; // å®½åº¦ = å½“å‰å±‚èŠ‚ç‚¹æ•° maxWidth = MAX(maxWidth, queueArray.count); &#125; return maxWidth;&#125; vcå®ç° 123// äºŒå‰æ ‘å®½åº¦NSInteger width = [BinaryTreeNode widthOfTree:self.rootNode];NSLog(@&quot;width-%ld&quot;,width); æ‰“å°ç»“æœ 12022-11-26 16:21:36.767352+0800 äºŒå‰æ ‘[4523:170689] width-2 äºŒå‰æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ•°é€’å½’æ€æƒ³ï¼šäºŒå‰æ ‘æ‰€æœ‰èŠ‚ç‚¹æ•° &#x3D; å·¦å­æ ‘èŠ‚ç‚¹æ•° + å³å­æ ‘èŠ‚ç‚¹æ•° + 1 1234567891011121314151617/** * äºŒå‰æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ•° * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return æ‰€æœ‰èŠ‚ç‚¹æ•° */// äºŒå‰æ ‘æ‰€æœ‰èŠ‚ç‚¹æ•°+ (NSInteger)numberOfNodesInTree:(BinaryTreeNode *)rootNode&#123; if (!rootNode)&#123; return 0; &#125; // æ€»èŠ‚ç‚¹æ•° = å·¦å­æ ‘èŠ‚ç‚¹æ•° + å³å­æ ‘èŠ‚ç‚¹æ•° + 1 NSInteger totalNode = [self numberOfNodesInTree:rootNode.leftNode] + [self numberOfNodesInTree:rootNode.rightNode] + 1; return totalNode;&#125; vcå®ç° 123// äºŒå‰æ ‘èŠ‚ç‚¹æ•°NSInteger totalNode = [BinaryTreeNode numberOfNodesInTree:self.rootNode];NSLog(@&quot;totalNode-%ld&quot;,totalNode); æ‰“å°ç»“æœ 12022-11-26 16:10:38.371816+0800 äºŒå‰æ ‘[4369:160462] totalNode-5 äºŒå‰æ ‘æŸå±‚ä¸­çš„èŠ‚ç‚¹æ•°1ï¼‰æ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™èŠ‚ç‚¹æ•°ä¸º0ï¼› 2ï¼‰å±‚ä¸º1ï¼Œåˆ™èŠ‚ç‚¹æ•°ä¸º1ï¼ˆå³æ ¹èŠ‚ç‚¹ï¼‰ 3ï¼‰é€’å½’æ€æƒ³ï¼šäºŒå‰æ ‘ç¬¬kå±‚èŠ‚ç‚¹æ•° &#x3D; å·¦å­æ ‘ç¬¬k-1å±‚èŠ‚ç‚¹æ•° + å³å­æ ‘ç¬¬k-1å±‚èŠ‚ç‚¹æ•° 12345678910111213141516171819202122/** * äºŒå‰æ ‘æŸå±‚ä¸­çš„èŠ‚ç‚¹æ•° * * @param level å±‚ * @param rootNode æ ¹èŠ‚ç‚¹ * * @return å±‚ä¸­çš„èŠ‚ç‚¹æ•° */// äºŒå‰æ ‘æŸå±‚ä¸­çš„èŠ‚ç‚¹æ•°+ (NSInteger)numberOfNodesOnLevel:(NSInteger)level inTree:(BinaryTreeNode *)rootNode&#123; // æ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ æˆ– level &lt; 0 if (!rootNode || level &lt; 1) &#123; return 0; &#125; // level = 1ï¼Œè¿”å›1ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ if (level == 1) &#123; return 1; &#125; // é€’å½’ï¼šlevelå±‚èŠ‚ç‚¹æ•° = å·¦å­æ ‘level-1å±‚èŠ‚ç‚¹æ•° + å³å­æ ‘level-1å±‚èŠ‚ç‚¹æ•° NSInteger levelNode = [self numberOfNodesOnLevel:level-1 inTree:rootNode.leftNode] + [self numberOfNodesOnLevel:level-1 inTree:rootNode.rightNode]; return levelNode;&#125; vcå®ç° 123// æŸå±‚èŠ‚ç‚¹æ•°NSInteger levelNode = [BinaryTreeNode numberOfNodesOnLevel:1 inTree:self.rootNode];NSLog(@&quot;levelNode-%ld&quot;,levelNode); æ‰“å°ç»“æœ 12022-11-26 16:27:02.360866+0800 äºŒå‰æ ‘[4593:175705] levelNode-1 äºŒå‰æ ‘å¶å­èŠ‚ç‚¹æ•°å¶å­èŠ‚ç‚¹ï¼Œåˆå«ç»ˆç«¯èŠ‚ç‚¹ï¼Œæ˜¯å·¦å³å­æ ‘éƒ½æ˜¯ç©ºçš„èŠ‚ç‚¹ã€‚ 123456789101112131415161718/** * äºŒå‰æ ‘å¶å­èŠ‚ç‚¹æ•° * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return å¶å­èŠ‚ç‚¹æ•° */+ (NSInteger)numberOfLeafsInTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return 0; &#125; // å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯ç©ºï¼Œè¯´æ˜æ˜¯å¶å­èŠ‚ç‚¹ if (!rootNode.leftNode &amp;&amp; !rootNode.rightNode) &#123; return 1; &#125; // é€’å½’ï¼šå¶å­æ•° = å·¦å­æ ‘å¶å­æ•° + å³å­æ ‘å¶å­æ•° return [self numberOfLeafsInTree:rootNode.leftNode] + [self numberOfLeafsInTree:rootNode.rightNode];&#125; äºŒå‰æ ‘æœ€å¤§è·ç¦»ï¼ˆäºŒå‰æ ‘çš„ç›´å¾„ï¼‰äºŒå‰æ ‘ä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸”ä»…æœ‰ä¸€æ¡è·¯å¾„ï¼Œè¿™ä¸ªè·¯å¾„çš„é•¿åº¦å«è¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„è·ç¦»ã€‚äºŒå‰æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»çš„æœ€å¤§å€¼å°±æ˜¯äºŒå‰æ ‘çš„ç›´å¾„ã€‚ æœ‰ä¸€ç§è§£æ³•ï¼ŒæŠŠè¿™ä¸ªæœ€å¤§è·ç¦»åˆ’åˆ†äº†3ç§æƒ…å†µï¼š 1ï¼‰è¿™2ä¸ªèŠ‚ç‚¹åˆ†åˆ«åœ¨æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ä¸Šï¼Œä»–ä»¬ä¹‹é—´çš„è·¯å¾„è‚¯å®šç»è¿‡æ ¹èŠ‚ç‚¹ï¼Œè€Œä¸”ä»–ä»¬è‚¯å®šæ˜¯æ ¹èŠ‚ç‚¹å·¦å³å­æ ‘ä¸Šæœ€è¿œçš„å¶å­èŠ‚ç‚¹ï¼ˆä»–ä»¬åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»&#x3D;å·¦å³å­æ ‘çš„æ·±åº¦ï¼‰ã€‚ 2ï¼‰è¿™2ä¸ªèŠ‚ç‚¹éƒ½åœ¨å·¦å­æ ‘ä¸Š 3ï¼‰è¿™2ä¸ªèŠ‚ç‚¹éƒ½åœ¨å³å­æ ‘ä¸Š ç»¼ä¸Šï¼Œåªè¦å–è¿™3ç§æƒ…å†µä¸­çš„æœ€å¤§å€¼ï¼Œå°±æ˜¯äºŒå‰æ ‘çš„ç›´å¾„ã€‚ 12345678910111213141516171819202122/** * äºŒå‰æ ‘æœ€å¤§è·ç¦»ï¼ˆç›´å¾„ï¼‰ * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return æœ€å¤§è·ç¦» */+ (NSInteger)maxDistanceOfTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return 0; &#125;// æ–¹æ¡ˆä¸€ï¼šï¼ˆé€’å½’æ¬¡æ•°è¾ƒå¤šï¼Œæ•ˆç‡è¾ƒä½ï¼‰ //åˆ†3ç§æƒ…å†µï¼š //1ã€æœ€è¿œè·ç¦»ç»è¿‡æ ¹èŠ‚ç‚¹ï¼šè·ç¦» = å·¦å­æ ‘æ·±åº¦ + å³å­æ ‘æ·±åº¦ NSInteger distance = [self depthOfTree:rootNode.leftNode] + [self depthOfTree:rootNode.rightNode]; //2ã€æœ€è¿œè·ç¦»åœ¨æ ¹èŠ‚ç‚¹å·¦å­æ ‘ä¸Šï¼Œå³è®¡ç®—å·¦å­æ ‘æœ€è¿œè·ç¦» NSInteger disLeft = [self maxDistanceOfTree:rootNode.leftNode]; //3ã€æœ€è¿œè·ç¦»åœ¨æ ¹èŠ‚ç‚¹å³å­æ ‘ä¸Šï¼Œå³è®¡ç®—å³å­æ ‘æœ€è¿œè·ç¦» NSInteger disRight = [self maxDistanceOfTree:rootNode.rightNode]; return MAX(MAX(disLeft, disRight), distance);&#125; è¿™ä¸ªæ–¹æ¡ˆæ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºè®¡ç®—å­æ ‘çš„æ·±åº¦å’Œæœ€è¿œè·ç¦»æ˜¯åˆ†å¼€é€’å½’çš„ï¼Œå­˜åœ¨é‡å¤é€’å½’éå†çš„æƒ…å†µã€‚å…¶å®ä¸€æ¬¡é€’å½’ï¼Œå°±å¯ä»¥åˆ†åˆ«è®¡ç®—å‡ºæ·±åº¦å’Œæœ€è¿œè·ç¦»ï¼Œäºæ˜¯æœ‰äº†ç¬¬äºŒç§æ–¹æ¡ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839/** * äºŒå‰æ ‘æœ€å¤§è·ç¦»ï¼ˆç›´å¾„ï¼‰ * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return æœ€å¤§è·ç¦» */+ (NSInteger)maxDistanceOfTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return 0; &#125;// æ–¹æ¡ˆ2ï¼šå°†è®¡ç®—èŠ‚ç‚¹æ·±åº¦å’Œæœ€å¤§è·ç¦»æ”¾åˆ°ä¸€æ¬¡é€’å½’ä¸­è®¡ç®—ï¼Œæ–¹æ¡ˆä¸€æ˜¯åˆ†åˆ«å•ç‹¬é€’å½’è®¡ç®—æ·±åº¦å’Œæœ€è¿œè·ç¦» TreeNodeProperty *p = [self propertyOfTreeNode:rootNode]; return p.distance;&#125;/** * è®¡ç®—æ ‘èŠ‚ç‚¹çš„æœ€å¤§æ·±åº¦å’Œæœ€å¤§è·ç¦» * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return TreeNodeProperty */+ (TreeNodeProperty *)propertyOfTreeNode:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return nil; &#125; TreeNodeProperty *left = [self propertyOfTreeNode:rootNode.leftNode]; TreeNodeProperty *right = [self propertyOfTreeNode:rootNode.rightNode]; TreeNodeProperty *p = [TreeNodeProperty new]; //èŠ‚ç‚¹çš„æ·±åº¦depth = å·¦å­æ ‘æ·±åº¦ã€å³å­æ ‘æ·±åº¦ä¸­æœ€å¤§å€¼+1ï¼ˆ+1æ˜¯å› ä¸ºæ ¹èŠ‚ç‚¹å äº†1ä¸ªdepthï¼‰ p.depth = MAX(left.depth, right.depth) + 1; //æœ€è¿œè·ç¦» = å·¦å­æ ‘æœ€è¿œè·ç¦»ã€å³å­æ ‘æœ€è¿œè·ç¦»å’Œæ¨ªè·¨å·¦å³å­æ ‘æœ€è¿œè·ç¦»ä¸­æœ€å¤§å€¼ p.distance = MAX(MAX(left.distance, right.distance), left.depth+right.depth); return p;&#125; äºŒå‰æ ‘ä¸­æŸä¸ªèŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„æ—¢æ˜¯å¯»è·¯é—®é¢˜ï¼Œåˆæ˜¯æŸ¥æ‰¾èŠ‚ç‚¹é—®é¢˜ã€‚ å®šä¹‰ä¸€ä¸ªå­˜æ”¾è·¯å¾„çš„æ ˆï¼ˆä¸æ˜¯é˜Ÿåˆ—äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ç”¨å¯å˜æ•°ç»„æ¥å®ç°çš„ï¼‰ 1ï¼‰å‹å…¥æ ¹èŠ‚ç‚¹ï¼Œå†ä»å·¦å­æ ‘ä¸­æŸ¥æ‰¾ï¼ˆé€’å½’è¿›è¡Œçš„ï¼‰ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œå†ä»å³å­æ ‘ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¹Ÿæœªæ‰¾åˆ°ï¼Œåˆ™å¼¹å‡ºæ ¹èŠ‚ç‚¹ï¼Œå†éå†æ ˆä¸­ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚ 2ï¼‰å¦‚æœæ‰¾åˆ°ï¼Œåˆ™æ ˆä¸­å­˜æ”¾çš„èŠ‚ç‚¹å°±æ˜¯è·¯å¾„æ‰€ç»è¿‡çš„èŠ‚ç‚¹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/** * äºŒå‰æ ‘ä¸­æŸä¸ªèŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ * * @param treeNode èŠ‚ç‚¹ * @param rootNode æ ¹èŠ‚ç‚¹ * * @return å­˜æ”¾è·¯å¾„èŠ‚ç‚¹çš„æ•°ç»„ */+ (NSArray *)pathOfTreeNode:(BinaryTreeNode *)treeNode inTree:(BinaryTreeNode *)rootNode &#123; NSMutableArray *pathArray = [NSMutableArray array]; [self isFoundTreeNode:treeNode inTree:rootNode routePath:pathArray]; return pathArray;&#125;/** * æŸ¥æ‰¾æŸä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨æ ‘ä¸­ * * @param treeNode å¾…æŸ¥æ‰¾çš„èŠ‚ç‚¹ * @param rootNode æ ¹èŠ‚ç‚¹ * @param path æ ¹èŠ‚ç‚¹åˆ°å¾…æŸ¥æ‰¾èŠ‚ç‚¹çš„è·¯å¾„ * * @return YESï¼šæ‰¾åˆ°ï¼ŒNOï¼šæœªæ‰¾åˆ° */+ (BOOL)isFoundTreeNode:(BinaryTreeNode *)treeNode inTree:(BinaryTreeNode *)rootNode routePath:(NSMutableArray *)path &#123; if (!rootNode || !treeNode) &#123; return NO; &#125; //æ‰¾åˆ°èŠ‚ç‚¹ if (rootNode == treeNode) &#123; [path addObject:rootNode]; return YES; &#125; //å‹å…¥æ ¹èŠ‚ç‚¹ï¼Œè¿›è¡Œé€’å½’ [path addObject:rootNode]; //å…ˆä»å·¦å­æ ‘ä¸­æŸ¥æ‰¾ BOOL find = [self isFoundTreeNode:treeNode inTree:rootNode.leftNode routePath:path]; //æœªæ‰¾åˆ°ï¼Œå†ä»å³å­æ ‘æŸ¥æ‰¾ if (!find) &#123; find = [self isFoundTreeNode:treeNode inTree:rootNode.rightNode routePath:path]; &#125; //å¦‚æœ2è¾¹éƒ½æ²¡æŸ¥æ‰¾åˆ°ï¼Œåˆ™å¼¹å‡ºæ­¤æ ¹èŠ‚ç‚¹ if (!find) &#123; [path removeLastObject]; &#125; return find;&#125; äºŒå‰æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹æœ€è¿‘çš„å…¬å…±çˆ¶èŠ‚ç‚¹é¦–å…ˆéœ€è¦æ˜ç™½ï¼Œæ ¹èŠ‚ç‚¹è‚¯å®šæ˜¯äºŒå‰æ ‘ä¸­ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹çš„å…¬å…±çˆ¶èŠ‚ç‚¹ï¼ˆä¸ä¸€å®šæ˜¯æœ€è¿‘çš„ï¼‰ï¼Œå› æ­¤äºŒå‰æ ‘ä¸­2ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±çˆ¶èŠ‚ç‚¹ä¸€å®šåœ¨ä»æ ¹èŠ‚ç‚¹åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ä¸Šã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å…ˆåˆ†åˆ«æ‰¾åˆ°ä»æ ¹èŠ‚ç‚¹åˆ°è¿™2ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ï¼Œå†ä»è¿™ä¸¤ä¸ªè·¯å¾„ä¸­æ‰¾åˆ°æœ€è¿‘çš„å…¬å…±çˆ¶èŠ‚ç‚¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435/** * äºŒå‰æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹æœ€è¿‘çš„å…¬å…±çˆ¶èŠ‚ç‚¹ * * @param nodeA ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ * @param nodeB ç¬¬äºŒä¸ªèŠ‚ç‚¹ * @param rootNode äºŒå‰æ ‘æ ¹èŠ‚ç‚¹ * * @return æœ€è¿‘çš„å…¬å…±çˆ¶èŠ‚ç‚¹ */+ (BinaryTreeNode *)parentOfNode:(BinaryTreeNode *)nodeA andNode:(BinaryTreeNode *)nodeB inTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode || !nodeA || !nodeB) &#123; return nil; &#125; if (nodeA == nodeB) &#123; return nodeA; &#125; //ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹Açš„è·¯å¾„ NSArray *pathA = [self pathOfTreeNode:nodeA inTree:rootNode]; //ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹Bçš„è·¯å¾„ NSArray *pathB = [self pathOfTreeNode:nodeB inTree:rootNode]; //å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸åœ¨æ ‘ä¸­ï¼Œåˆ™æ²¡æœ‰å…¬å…±çˆ¶èŠ‚ç‚¹ if (pathA.count == 0 || pathB == 0) &#123; return nil; &#125; //ä»åå¾€å‰æ¨ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„å…¬å…±èŠ‚ç‚¹ for (NSInteger i = pathA.count-1; i&gt;=0; i--) &#123; for (NSInteger j = pathB.count - 1; j&gt;=0; j--) &#123; if ([pathA objectAtIndex:i] == [pathB objectAtIndex:j]) &#123; //æ‰¾åˆ° return [pathA objectAtIndex:i]; &#125; &#125; &#125; return nil;&#125; äºŒå‰æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„ä»æŸ¥æ‰¾æœ€è¿‘å…¬å…±çˆ¶èŠ‚ç‚¹è¡ç”Ÿå‡ºæ¥çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * äºŒå‰æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„ * * @param nodeA ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ * @param nodeB ç¬¬äºŒä¸ªèŠ‚ç‚¹ * @param rootNode äºŒå‰æ ‘æ ¹èŠ‚ç‚¹ * * @return ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„è·¯å¾„ */+ (NSArray *)pathFromNode:(BinaryTreeNode *)nodeA toNode:(BinaryTreeNode *)nodeB inTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode || !nodeA || !nodeB) &#123; return nil; &#125; NSMutableArray *path = [NSMutableArray array]; if (nodeA == nodeB) &#123; [path addObject:nodeA]; [path addObject:nodeB]; return path; &#125; //ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹Açš„è·¯å¾„ NSArray *pathA = [self pathOfTreeNode:nodeA inTree:rootNode]; //ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹Bçš„è·¯å¾„ NSArray *pathB = [self pathOfTreeNode:nodeB inTree:rootNode]; //å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸åœ¨æ ‘ä¸­ï¼Œåˆ™æ²¡æœ‰è·¯å¾„ if (pathA.count == 0 || pathB == 0) &#123; return nil; &#125; //ä»åå¾€å‰æ¨ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„å…¬å…±èŠ‚ç‚¹ for (NSInteger i = pathA.count-1; i&gt;=0; i--) &#123; [path addObject:[pathA objectAtIndex:i]]; for (NSInteger j = pathB.count - 1; j&gt;=0; j--) &#123; //æ‰¾åˆ°å…¬å…±çˆ¶èŠ‚ç‚¹ï¼Œåˆ™å°†pathBä¸­åé¢çš„èŠ‚ç‚¹å‹å…¥path if ([pathA objectAtIndex:i] == [pathB objectAtIndex:j]) &#123; j++; //j++æ˜¯ä¸ºäº†é¿å¼€å…¬å…±çˆ¶èŠ‚ç‚¹ while (j&lt;pathB.count) &#123; [path addObject:[pathB objectAtIndex:j]]; j++; &#125; return path; &#125; &#125; &#125; return nil;&#125; äºŒå‰æ ‘ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»å¯ä»¥ä»ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·¯å¾„è¡ç”Ÿå‡ºæ¥ã€‚ 123456789101112131415161718192021222324252627282930313233343536/** * äºŒå‰æ ‘ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦» * * @param nodeA ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ * @param nodeB ç¬¬äºŒä¸ªèŠ‚ç‚¹ * @param rootNode äºŒå‰æ ‘æ ¹èŠ‚ç‚¹ * * @return ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„è·ç¦»ï¼ˆ-1ï¼šè¡¨ç¤ºæ²¡æœ‰æ‰¾åˆ°è·¯å¾„ï¼‰ */+ (NSInteger)distanceFromNode:(BinaryTreeNode *)nodeA toNode:(BinaryTreeNode *)nodeB inTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode || !nodeA || !nodeB) &#123; return -1; &#125; if (nodeA == nodeB) &#123; return 0; &#125; //ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹Açš„è·¯å¾„ NSArray *pathA = [self pathOfTreeNode:nodeA inTree:rootNode]; //ä»æ ¹èŠ‚ç‚¹åˆ°èŠ‚ç‚¹Bçš„è·¯å¾„ NSArray *pathB = [self pathOfTreeNode:nodeB inTree:rootNode]; //å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸åœ¨æ ‘ä¸­ï¼Œåˆ™æ²¡æœ‰è·¯å¾„ if (pathA.count == 0 || pathB == 0) &#123; return -1; &#125; //ä»åå¾€å‰æ¨ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„å…¬å…±èŠ‚ç‚¹ for (NSInteger i = pathA.count-1; i&gt;=0; i--) &#123; for (NSInteger j = pathB.count - 1; j&gt;=0; j--) &#123; //æ‰¾åˆ°å…¬å…±çˆ¶èŠ‚ç‚¹ if ([pathA objectAtIndex:i] == [pathB objectAtIndex:j]) &#123; //è·ç¦»=è·¯å¾„èŠ‚ç‚¹æ•°-1 ï¼ˆè¿™é‡Œè¦-2ï¼Œå› ä¸ºå…¬å…±çˆ¶èŠ‚ç‚¹é‡å¤äº†ä¸€æ¬¡ï¼‰ return (pathA.count - i) + (pathB.count - j) - 2; &#125; &#125; &#125; return -1;&#125; åˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦å®Œå…¨äºŒå‰æ ‘å®Œå…¨äºŒå‰æ ‘å®šä¹‰ä¸ºï¼šè‹¥è®¾äºŒå‰æ ‘çš„é«˜åº¦ä¸ºhï¼Œé™¤ç¬¬hå±‚å¤–ï¼Œå…¶å®ƒå„å±‚çš„ç»“ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§ä¸ªæ•°ï¼Œç¬¬hå±‚æœ‰å¶å­ç»“ç‚¹ï¼Œå¹¶ä¸”å¶å­ç»“ç‚¹éƒ½æ˜¯ä»å·¦åˆ°å³ä¾æ¬¡æ’å¸ƒã€‚ å®Œå…¨äºŒå‰æ ‘å¿…é¡»æ»¡è¶³2ä¸ªæ¡ä»¶ï¼š 1ï¼‰å¦‚æœæŸä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å®ƒçš„å·¦å­æ ‘å¿…é¡»ä¸ä¸ºç©º 2ï¼‰å¦‚æœæŸä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸ºç©ºï¼Œåˆ™æ’åœ¨å®ƒåé¢çš„èŠ‚ç‚¹å¿…é¡»æ²¡æœ‰å­©å­èŠ‚ç‚¹ è¿™é‡Œè¿˜éœ€è¦ç†è§£â€œæ’åœ¨å®ƒåé¢çš„èŠ‚ç‚¹â€ï¼Œå›å¤´çœ‹çœ‹å±‚æ¬¡éå†ç®—æ³•ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“åœ¨å±‚æ¬¡éå†æ—¶ï¼Œæ˜¯ä»ä¸Šåˆ°ä¸‹ä»å·¦åˆ°å³éå†çš„ï¼Œå…ˆå°†æ ¹èŠ‚ç‚¹å¼¹å‡ºé˜Ÿåˆ—ï¼Œå†å‹å…¥å­©å­èŠ‚ç‚¹ï¼Œå› æ­¤â€œæ’åœ¨å®ƒåé¢çš„èŠ‚ç‚¹â€æœ‰2ç§æƒ…å†µï¼š 1ï¼‰åŒå±‚æ¬¡çš„åé¢çš„èŠ‚ç‚¹ 2ï¼‰åŒå±‚æ¬¡çš„å‰é¢çš„èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ï¼ˆå› ä¸ºéå†å‰é¢çš„èŠ‚ç‚¹æ—¶ï¼Œä¼šå¼¹å‡ºèŠ‚ç‚¹ï¼ŒåŒæ—¶å°†å­©å­èŠ‚ç‚¹å‹å…¥é˜Ÿåˆ—ï¼‰ é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½flagï¼Œå½“å­æ ‘æ»¡è¶³å®Œå…¨äºŒå‰æ ‘æ—¶ï¼Œè®¾ç½®flag&#x3D;YESã€‚å½“flag&#x3D;YESè€ŒèŠ‚ç‚¹åˆç ´åäº†å®Œå…¨äºŒå‰æ ‘çš„æ¡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°±ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * æ˜¯å¦å®Œå…¨äºŒå‰æ ‘ * å®Œå…¨äºŒå‰æ ‘ï¼šè‹¥è®¾äºŒå‰æ ‘çš„é«˜åº¦ä¸ºhï¼Œé™¤ç¬¬hå±‚å¤–ï¼Œå…¶å®ƒå„å±‚çš„ç»“ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§ä¸ªæ•°ï¼Œç¬¬hå±‚æœ‰å¶å­ç»“ç‚¹ï¼Œå¹¶ä¸”å¶å­ç»“ç‚¹éƒ½æ˜¯ä»å·¦åˆ°å³ä¾æ¬¡æ’å¸ƒ * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return YESï¼šæ˜¯å®Œå…¨äºŒå‰æ ‘ï¼ŒNOï¼šä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ */+ (BOOL)isCompleteBinaryTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return NO; &#125; //å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯ç©ºï¼Œåˆ™æ˜¯å®Œå…¨äºŒå‰æ ‘ if (!rootNode.leftNode &amp;&amp; !rootNode.rightNode) &#123; return YES; &#125; //å·¦å­æ ‘æ˜¯ç©ºï¼Œå³å­æ ‘ä¸æ˜¯ç©ºï¼Œåˆ™ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ if (!rootNode.leftNode &amp;&amp; rootNode.rightNode) &#123; return NO; &#125; //æŒ‰å±‚æ¬¡éå†èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ»¡è¶³å®Œå…¨äºŒå‰æ ‘çš„æ¡ä»¶ï¼š //æ¡ä»¶1ï¼šå¦‚æœæŸä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™å®ƒçš„å·¦å­æ ‘å¿…é¡»ä¸ä¸ºç©º //æ¡ä»¶2ï¼šå¦‚æœæŸä¸ªèŠ‚ç‚¹çš„å³å­æ ‘ä¸ºç©ºï¼Œåˆ™æ’åœ¨å®ƒåé¢çš„èŠ‚ç‚¹å¿…é¡»æ²¡æœ‰å­©å­èŠ‚ç‚¹ //æ’åœ¨è¯¥èŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹æœ‰2ç§ï¼š1ï¼‰åŒå±‚æ¬¡çš„åé¢çš„èŠ‚ç‚¹ 2ï¼‰åŒå±‚æ¬¡çš„å‰é¢çš„èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ï¼ˆå› ä¸ºéå†å‰é¢çš„èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šå°†èŠ‚ç‚¹ä»é˜Ÿåˆ—é‡Œpopï¼ŒåŒæ—¶æŠŠå®ƒçš„å­©å­èŠ‚ç‚¹pushåˆ°é˜Ÿåˆ—é‡Œï¼‰ NSMutableArray *queue = [NSMutableArray array]; [queue addObject:rootNode]; BOOL isComplete = NO; //æ˜¯å¦å·²ç»æ»¡è¶³å®Œå…¨äºŒå‰æ ‘ while (queue.count &gt; 0) &#123; BinaryTreeNode *node = [queue firstObject]; [queue removeObjectAtIndex:0]; //å·¦å­æ ‘ä¸ºç©ºä¸”å³å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ if (!node.leftNode &amp;&amp; node.rightNode) &#123; return NO; &#125; if (isComplete &amp;&amp; (node.leftNode || node.rightNode)) &#123; //å‰é¢çš„èŠ‚ç‚¹å·²æ»¡è¶³å®Œå…¨äºŒå‰æ ‘,å¦‚æœè¿˜æœ‰å­©å­èŠ‚ç‚¹ï¼Œåˆ™ä¸æ˜¯å®Œå…¨äºŒå‰æ ‘ return NO; &#125; //å³å­æ ‘ä¸ºç©ºï¼Œåˆ™å·²ç»æ»¡è¶³å®Œå…¨äºŒå‰æ ‘ if (!node.rightNode) &#123; isComplete = YES; &#125; //å‹å…¥ if (node.leftNode) &#123; [queue addObject:node.leftNode]; &#125; if (node.rightNode) &#123; [queue addObject:node.rightNode]; &#125; &#125; return isComplete;&#125; åˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦æ»¡äºŒå‰æ ‘ æ»¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼šé™¤äº†å¶ç»“ç‚¹å¤–æ¯ä¸€ä¸ªç»“ç‚¹éƒ½æœ‰å·¦å³å­å¶ä¸”å¶å­ç»“ç‚¹éƒ½å¤„åœ¨æœ€åº•å±‚çš„äºŒå‰æ ‘ æ»¡äºŒå‰æ ‘çš„ä¸€ä¸ªç‰¹æ€§æ˜¯ï¼šå¶å­æ•°&#x3D;2^(æ·±åº¦-1)ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªç‰¹æ€§æ¥åˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦æ˜¯æ»¡äºŒå‰æ ‘ã€‚ 123456789101112131415161718192021222324/** * æ˜¯å¦æ»¡äºŒå‰æ ‘ * æ»¡äºŒå‰æ ‘ï¼šé™¤äº†å¶ç»“ç‚¹å¤–æ¯ä¸€ä¸ªç»“ç‚¹éƒ½æœ‰å·¦å³å­å¶ä¸”å¶å­ç»“ç‚¹éƒ½å¤„åœ¨æœ€åº•å±‚çš„äºŒå‰æ ‘ * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return YESï¼šæ»¡äºŒå‰æ ‘ï¼ŒNOï¼šéæ»¡äºŒå‰æ ‘ */+ (BOOL)isFullBinaryTree:(BinaryTreeNode *)rootNode &#123; if (!rootNode) &#123; return NO; &#125; //äºŒå‰æ ‘æ·±åº¦ NSInteger depth = [self depthOfTree:rootNode]; //äºŒå‰æ ‘å¶å­èŠ‚ç‚¹æ•° NSInteger leafNum = [self numberOfLeafsInTree:rootNode]; //æ»¡äºŒå‰æ ‘ç‰¹æ€§ï¼šå¶å­æ•°=2^(æ·±åº¦-1) if (leafNum == pow(2, (depth - 1))) &#123; return YES; &#125; return NO;&#125; åˆ¤æ–­äºŒå‰æ ‘æ˜¯å¦å¹³è¡¡äºŒå‰æ ‘å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼šå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚å¹³è¡¡äºŒå‰æ ‘åˆå«AVLæ ‘ã€‚ 12345678910111213141516171819202122232425262728293031/** * æ˜¯å¦å¹³è¡¡äºŒå‰æ ‘ * å¹³è¡¡äºŒå‰æ ‘ï¼šå³AVLæ ‘ï¼Œå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ * * @param rootNode æ ¹èŠ‚ç‚¹ * * @return YESï¼šå¹³è¡¡äºŒå‰æ ‘ï¼ŒNOï¼šéå¹³è¡¡äºŒå‰æ ‘ */+ (BOOL)isAVLBinaryTree:(BinaryTreeNode *)rootNode &#123; static NSInteger height; if (!rootNode) &#123; height = 0; return YES; &#125; if (!rootNode.leftNode &amp;&amp; !rootNode.rightNode) &#123; height = 1; return YES; &#125; BOOL isAVLLeft = [self isAVLBinaryTree:rootNode.leftNode]; NSInteger heightLeft = height; BOOL isAVLRight = [self isAVLBinaryTree:rootNode.rightNode]; NSInteger heightRight = height; height = MAX(heightLeft, heightRight)+1; if (isAVLLeft &amp;&amp; isAVLRight &amp;&amp; ABS(heightLeft-heightRight) &lt;= 1) &#123; return YES; &#125; return NO;&#125; æ€»ç»“ ä»¥ä¸Šå°±æ˜¯æˆ‘ç›®å‰æ•´ç†çš„ä¸€äº›äºŒå‰æ ‘ç›¸å…³çš„ç®—æ³•ï¼Œç®—æ³•èµ„æ–™å’Œæ€æƒ³éƒ½æ¥æºäºç½‘ç»œï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼åç»­å¦‚æœæœ‰æ–°çš„ç®—æ³•ï¼Œæˆ‘ä¹Ÿä¼šæ›´æ–°è¿›å»ã€‚","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.bboyzj.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"OC-æ•°æ®ç»“æ„æ¢ç´¢ç¯‡","slug":"OC-æ•°æ®ç»“æ„æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.bboyzj.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"OCç®—æ³•04ï¼šäºŒåˆ†æŸ¥æ‰¾æ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•04ï¼šäºŒåˆ†æŸ¥æ‰¾æ¢ç´¢","date":"2020-08-26T08:34:46.000Z","updated":"2023-03-06T10:17:20.158Z","comments":true,"path":"2020/08/26/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•04ï¼šäºŒåˆ†æŸ¥æ‰¾æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/26/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E7%AE%97%E6%B3%9504%EF%BC%9A%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"äºŒåˆ†æŸ¥æ‰¾ ç®€ä»‹ äºŒåˆ†æŸ¥æ‰¾(ä¹Ÿç§°æŠ˜åŠæŸ¥æ‰¾)æ˜¯å¾ˆå¸¸è§çš„ä¸€ç§åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æ•°æ®çš„ç®—æ³•,ä½œä¸ºä¸€åç¨‹åºå‘˜æ˜¯åº”è¯¥å¿…é¡»ä¼šçš„ã€‚ åŸºæœ¬æ€æƒ³ è·å–æ•°ç»„çš„ä¸­é—´å€¼ï¼Œå°†æ•°ç»„åˆ†å‰²æˆä¸¤ä»½ï¼Œåˆ©ç”¨æŸ¥æ‰¾çš„å€¼è·Ÿä¸­é—´å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæŸ¥æ‰¾çš„å€¼å¤§äºä¸­é—´å€¼ï¼Œå°±åœ¨æ•°ç»„çš„å³è¾¹è¿›è¡ŒæŸ¥æ‰¾ï¼›å¦‚æœæŸ¥æ‰¾çš„å€¼å°äºä¸­é—´å€¼ï¼Œå°±åœ¨æ•°ç»„çš„å·¦è¾¹è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æ­¤å¾ªç¯çš„æ‰§è¡Œä¸‹å»ï¼Œæœ€ç»ˆæ‰¾åˆ°ç¬¦åˆçš„å€¼ã€‚ ä¼˜ç¼ºç‚¹ 1ï¼‰ä¼˜ç‚¹ï¼š é€Ÿåº¦å¿« æ¯”è¾ƒæ¬¡æ•°å°‘ æ€§èƒ½å¥½ 2ï¼‰ç¼ºç‚¹ï¼š å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰åºçš„æ•°ç»„ï¼ˆå‡åºæˆ–è€…é™åºï¼‰ é€‚ç”¨èŒƒå›´ï¼šé€‚ç”¨ä¸ç»å¸¸å˜åŠ¨çš„æ•°ç»„ å¤æ‚åº¦ æ—¶é—´å¤æ‚åº¦å°±å˜æˆäº†O(logN) å…·ä½“ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748- (void)viewDidLoad &#123; [super viewDidLoad]; NSArray * arr = @[@1,@3,@5,@6,@8,@15,@20]; NSInteger result = [self binarySearchTarget:@1 inArray:arr]; NSLog(@&quot;%ld&quot;,(long)result);&#125;// åœ¨æŸä¸ªæ•°ç»„ä¸­æœç´¢ç›®æ ‡- (NSInteger)binarySearchTarget:(NSNumber *)target inArray:(NSArray *)arr&#123; //å¦‚æœæ•°ç»„æ— å…ƒç´ ï¼Œåˆ™è¿”å› if (arr.count &lt; 1) &#123; return -1; &#125; //å¦‚æœæ•°ç»„æœ‰å…ƒç´  //å®šä¹‰ä¸‰ä¸ªå˜é‡ ç¬¬ä¸€ä¸ªå€¼ä¸‹æ ‡ã€æœ€åä¸€ä¸ªå€¼ä¸‹æ ‡ã€ä¸­é—´å€¼ä¸‹æ ‡ NSInteger start = 0; NSInteger end = arr.count - 1; NSInteger mid = 0; //å¦‚æœå¼€å§‹å’Œç»“æŸä¸­é—´è¿˜æœ‰å…ƒç´ ï¼Œåˆ™å¾ªç¯ while (start &lt; end - 1) &#123; //ä¼šæœ‰ä¸€äº›æœ‹å‹çœ‹åˆ°æœ‰äº›äººæ˜¯( start + end ) / 2è¿™æ ·å†™çš„,ä½†æ˜¯è¿™æ ·å†™æœ‰ä¸€ç‚¹ä¸å¥½,å°±æ˜¯start+endä¼šå‡ºç°æ•´æ•°æº¢å‡ºçš„æƒ…å†µ,å¦‚æœå­˜åœ¨æº¢å‡º,ä½ å†é™¤ä»¥2ä¹Ÿæ˜¯æ²¡æœ‰ç”¨çš„,æ‰€ä»¥ä¸èƒ½è¿™ä¹ˆå†™ mid = start + (end - start) / 2; //å¦‚æœä¸­é—´å€¼å¤§äºç›®æ ‡å€¼ if ([arr[mid] intValue] &gt; [target intValue]) &#123; //ä¸­é—´å€¼åšä¸ºæœ€åä¸€ä¸ªå€¼ï¼Œåœ¨å‰åŠæ®µå†è¿›è¡Œç›¸åŒçš„æœç´¢ end = mid; &#125; //å¦‚æœä¸­é—´å€¼å°äºæˆ–ç­‰äºç›®æ ‡å€¼ else &#123; start = mid; &#125; &#125; //è€ƒè™‘åˆ°è¾¹ç•Œé—®é¢˜ï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¿©ä¸ªå¿…é¡»å†™ //å¦‚æœç¬¬ä¸€ä¸ªå€¼å’Œç›®æ ‡å€¼ç›¸ç­‰åˆ™è·å–ç¬¬ä¸€ä¸ªå€¼çš„ä¸‹æ ‡ if ([arr[start] intValue] == [target intValue]) &#123; return start; &#125; //å¦‚æœæœ€åä¸€ä¸ªå€¼å’Œç›®æ ‡å€¼ç›¸ç­‰åˆ™è·å–æœ€åä¸€ä¸ªå€¼çš„ä¸‹æ ‡ if ([arr[end] intValue] == [target intValue]) &#123; return end; &#125; return -1;&#125; æŸ¥çœ‹æ‰“å°ç»“æœ 122020-08-26 18:06:44.754180+0800 iOS-OCä¹‹äºŒåˆ†æŸ¥æ‰¾[49535:2738585] 0","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"OC-ç®—æ³•æ¢ç´¢ç¯‡","slug":"OC-ç®—æ³•æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E7%AE%97%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}]},{"title":"OCç®—æ³•05ï¼šé€‰æ‹©æ’åºæ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•05ï¼šé€‰æ‹©æ’åºæ¢ç´¢","date":"2020-08-26T04:20:18.000Z","updated":"2023-03-06T10:17:23.942Z","comments":true,"path":"2020/08/26/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•05ï¼šé€‰æ‹©æ’åºæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/26/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E7%AE%97%E6%B3%9505%EF%BC%9A%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"é€‰æ‹©æ’åº åŸºæœ¬æ€è·¯ï¼šé€‰æ‹©æ’åºï¼ˆSelection sortï¼‰æ˜¯æœ€åŸºæœ¬çš„ O(n^2) çš„æ’åºç®—æ³•ï¼Œå®ƒçš„åŸç†æ˜¯æ¯ä¸€æ¬¡ä»å¾…æ’åºçš„æ•°æ®å…ƒç´ ä¸­ é€‰å‡ºæœ€å°æˆ–æœ€å¤§ çš„ä¸€ä¸ªå…ƒç´ ï¼Œå­˜æ”¾åœ¨åºåˆ—çš„èµ·å§‹ä½ç½®ï¼Œç„¶åï¼Œå†ä» å‰©ä½™æœªæ’åºçš„å…ƒç´ å½“ä¸­ç»§ç»­å¯»æ‰¾æœ€å°æˆ–å¤§çš„å…ƒç´ ï¼Œ ç„¶åæ”¾åˆ°æœªæ’åºçš„æœ«å°¾ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°å…¨éƒ¨å¾…æ’åºçš„æ•°æ®å…ƒç´ æ’å®Œã€‚ ç¨³å®šæ€§ é€‰æ‹©æ’åºæ˜¯ä¸ç¨³å®šçš„æ’åºæ–¹æ³•ã€‚ ä¸»è¦æµç¨‹ï¼šä»å°åˆ°å¤§ ç¬¬1è¶Ÿï¼Œåœ¨å¾…æ’åºè®°å½•r[0]~r[n-1]ä¸­é€‰å‡ºæœ€å°çš„è®°å½•ï¼Œå°†å®ƒä¸r[0]äº¤æ¢ï¼› ç¬¬2è¶Ÿï¼Œåœ¨å¾…æ’åºè®°å½•r[1]~r[n-1]ä¸­é€‰å‡ºæœ€å°çš„è®°å½•ï¼Œå°†å®ƒä¸r[1]äº¤æ¢ï¼› ä»¥æ­¤ç±»æ¨ï¼Œç¬¬iè¶Ÿåœ¨å¾…æ’åºè®°å½•r[i-1]~r[n-1]ä¸­é€‰å‡ºæœ€å°çš„è®°å½•ï¼Œå°†å®ƒä¸r[i-1]äº¤æ¢ï¼Œä½¿æœ‰åºåºåˆ—ä¸æ–­å¢é•¿ç›´åˆ°å…¨éƒ¨æ’åºå®Œæ¯•ã€‚ å…·ä½“ä»£ç  123456789101112131415161718192021222324252627- (void)viewDidLoad &#123; [super viewDidLoad]; [self selectionSortWithArr:[NSMutableArray arrayWithArray:@[@3,@1,@2,@5,@4]]];&#125;// é€‰æ‹©æ’åº- (void)selectionSortWithArr:(NSMutableArray *)arr&#123; // å¼€å§‹æ—¶é—´ double startTime = CFAbsoluteTimeGetCurrent(); // å¤–å±‚éå† for (int i = 0; i&lt; arr.count; i++) &#123; int minIndex = i; // å†…å±‚éå† for (int j = i + 1; j &lt; arr.count; j++) &#123; // è·å–æœ€å°ä¸‹æ ‡ if ([arr[j] intValue]&lt; [arr[minIndex] intValue]) &#123; minIndex = j; &#125; &#125; //äº¤æ¢ä½ç½® [arr exchangeObjectAtIndex:i withObjectAtIndex:minIndex]; &#125; double endTime = CFAbsoluteTimeGetCurrent(); NSLog(@&quot;%@&quot;,arr); NSLog(@&quot;é€‰æ‹©æ’åºç”¨æ—¶:%f s&quot;,endTime - startTime);&#125; æŸ¥çœ‹æ‰“å°ç»“æœ 1234567892020-08-26 17:11:21.653476+0800 OC-é€‰æ‹©æ’åº[48845:2694230] ( 1, 2, 3, 4, 5)2020-08-26 17:11:21.653672+0800 OC-é€‰æ‹©æ’åº[48845:2694230] é€‰æ‹©æ’åºç”¨æ—¶:0.000003 s","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"OC-ç®—æ³•æ¢ç´¢ç¯‡","slug":"OC-ç®—æ³•æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E7%AE%97%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}]},{"title":"Swiftå­¦ä¹ ï¼šOCé¡¹ç›®å¼•å…¥swift","slug":"Swift/Swiftå­¦ä¹ ï¼šOCé¡¹ç›®å¼•å…¥swift","date":"2020-08-22T14:33:06.000Z","updated":"2023-03-08T22:16:57.810Z","comments":true,"path":"2020/08/22/Swift/Swiftå­¦ä¹ ï¼šOCé¡¹ç›®å¼•å…¥swift/","link":"","permalink":"https://www.bboyzj.cn/2020/08/22/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9AOC%E9%A1%B9%E7%9B%AE%E5%BC%95%E5%85%A5swift/","excerpt":"","text":"åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤šäººåˆä½œæ—¶ï¼Œæœ‰å¯èƒ½é‡åˆ°åŒäº‹æ˜¯ä¸» swift å¼€å‘ï¼Œè€Œè‡ªå·±æ˜¯ä¸» OC å¼€å‘ï¼Œè¿™æ—¶å¦‚æœæ˜¯ä»¥ OC è¯­è¨€ä¸ºä¸»ï¼Œswift è¯­è¨€ä¸ºè¾…ï¼Œé‚£ä¹ˆå°±éœ€è¦äº†è§£å¦‚ä½•è®© OC å¼•å…¥ swift åˆ›å»ºæ¡¥æ¥æ–‡ä»¶ æ³¨ï¼šåœ¨é¡¹ç›®ä¸­æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ›å»º swift æ–‡ä»¶æ—¶ï¼Œxcode ä¼šæç¤ºæˆ‘ä»¬åˆ›å»ºï¼Œç‚¹å‡»åˆ›å»ºå³å¯ æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ swift file æ–‡ä»¶åˆ æ‰ï¼Œç„¶ååˆ›å»ºè‡ªå·±éœ€è¦çš„æ–‡ä»¶ï¼Œ æ­¤æ—¶æˆ‘ä»¬çœ‹åˆ—è¡¨ï¼Œå‘ç°æ¡¥æ¥æ–‡ä»¶ é¡¹ç›®å-Bridging-Header.h é…ç½® builder setting é™¤äº†ä¸Šè¿°æ¡¥æ¥æ–‡ä»¶ï¼Œè¿˜æœ‰ä¸€ä¸ªéšè—æ–‡ä»¶ é¡¹ç›®å-Swiftï¼Œåœ¨ OC è°ƒç”¨ swift çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œåœ¨åˆ—è¡¨ä¸­ä¸æ˜¾ç¤º æ³¨ï¼šè¿™ä¸ªåå­—å¯ä»¥æ”¹å†™æˆè‡ªå·±æƒ³è¦çš„ Swift.h åˆ›å»ºswiftæ–‡ä»¶ï¼Œä¾›OCè°ƒç”¨ åˆ›å»ºswiftæ–‡ä»¶ï¼ŒTestç»§æ‰¿NSObject å’Œ TestViewControllerç»§æ‰¿UIViewController åˆ†åˆ«æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨swiftæ–‡ä»¶ä¸­ï¼Œæ–¹æ³•å‰è¦åŠ ä¸Š @objcï¼Œä¸ç„¶ OC æ— æ³•è°ƒç”¨ è°ƒç”¨åœ¨ OC çš„ pch æ–‡ä»¶ä¸‹ï¼Œå¯¼å…¥éšè—ç”Ÿæˆçš„ swift.hï¼Œè¿™æ ·å°±å¯ä»¥å…¨å±€ä½¿ç”¨ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½å¯¼å…¥ åœ¨ ViewController ä¸­ä½¿ç”¨","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ 00ï¼šç®€ä»‹","slug":"Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 00ï¼šç®€ä»‹","date":"2020-08-22T13:17:43.000Z","updated":"2023-03-09T07:21:13.177Z","comments":true,"path":"2020/08/22/Swiftè¯¾ç¨‹/Swiftå­¦ä¹ 00ï¼šç®€ä»‹/","link":"","permalink":"https://www.bboyzj.cn/2020/08/22/Swift%E8%AF%BE%E7%A8%8B/Swift%E5%AD%A6%E4%B9%A000%EF%BC%9A%E7%AE%80%E4%BB%8B/","excerpt":"","text":"Swiftä»‹ç»Swiftæ˜¯Appleåœ¨2014å¹´6æœˆWWDCå‘å¸ƒçš„å…¨æ–°çš„ç¼–ç¨‹è¯­è¨€ã€‚ Swiftæ˜¯ä¸€ç§é«˜æ€§èƒ½ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œæä¾›äº†å¯¹ç°æœ‰Cå’ŒOCä»£ç æ¡†æ¶çš„æ— ç¼è®¿é—®ï¼Œå¹¶ä¸”æ˜¯å†…å­˜å®‰å…¨çš„ã€‚ Swiftè¯­è¨€æ›´åŠ ç®€æ´ï¼Œæ˜¯ä¸€é—¨ç±»å‹å®‰å…¨çš„è¯­è¨€ã€‚ Swiftå’ŒOCçš„åŒºåˆ« ç¼–ç¨‹èŒƒå¼ Swiftå¯ä»¥ é¢è¯•åè®®ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ OCä»¥ é¢å‘å¯¹è±¡ç¼–ç¨‹ ä¸ºä¸»ï¼Œå½“ç„¶ä½ å¯ä»¥å¼•å…¥ Reactive Cocoa çš„ç±»åº“æ¥è¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹ ç±»å‹å®‰å…¨ Swiftæ˜¯ä¸€é—¨ ç±»å‹å®‰å…¨çš„è¯­è¨€ã€‚é¼“åŠ±ç¨‹åºå‘˜åœ¨ä»£ç ä¸­æ¸…æ¥šæ˜ç¡®å€¼çš„ç±»å‹ã€‚å¦‚æœä»£ç ä¸­ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²Stringï¼Œé‚£ä¹ˆä½ ä¸èƒ½é”™è¯¯åœ°ä¼ é€’ä¸€ä¸ªæ•´å‹Intç»™å®ƒã€‚å› ä¸ºSwiftæ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå®ƒä¼šåœ¨ä»£ç ç¼–è¯‘çš„æ—¶å€™åšç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸”æŠŠæ‰€æœ‰ä¸åŒ¹é…çš„ç±»å‹ä½œä¸ºä¸€ä¸ªé”™è¯¯æ ‡è®°å‡ºæ¥ã€‚è¿™æ ·ä½¿å¾—ç¨‹åºå‘˜åœ¨å¼€å‘ä¸­å°½å¯èƒ½æ—©åœ°å‘ç°å’Œä¿®æ­£é”™è¯¯ã€‚ è€ŒOCåˆ™ ä¸æ˜¯ç±»å‹å®‰å…¨çš„è¯­è¨€ï¼Œä½ å£°æ˜ä¸€ä¸ªNSStringå˜é‡ï¼Œä»ç„¶å¯ä»¥ä¼ é€’ä¸€ä¸ªNSNumberç»™å®ƒï¼Œå°½ç®¡ç¼–è¯‘å™¨ä¼šæŠ±æ€¨ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥ä½œä¸ºNSNumberæ¥ä½¿ç”¨å®ƒã€‚ å€¼ç±»å‹çš„å¢å¼º åœ¨Swiftä¸­ï¼Œå…¸å‹çš„æœ‰ structã€enum ä»¥åŠ å…ƒç¥–tuple éƒ½æ˜¯å€¼ç±»å‹ã€‚è€Œå¹³æ—¶ä½¿ç”¨çš„Intã€Doubleã€Float ã€String ã€Array ã€Dictionaryã€Setå…¶å®éƒ½æ˜¯ç”¨ç»“æ„ä½“å®ç°çš„ï¼Œä¹Ÿæ˜¯ å€¼ç±»å‹ã€‚ OCä¸­ï¼ŒNSNumberã€NSStringä»¥åŠé›†åˆç±»å¯¹è±¡éƒ½æ˜¯æŒ‡é’ˆç±»å‹ã€‚ æšä¸¾å¢å¼º Swiftçš„æšä¸¾å¯ä»¥ä½¿ç”¨ æ•´å‹ã€æµ®ç‚¹å‹ã€å­—ç¬¦ä¸²ç­‰ï¼Œè¿˜èƒ½æ‹¥æœ‰ å±æ€§å’Œæ–¹æ³•ï¼Œç”šè‡³æ”¯æŒ æ³›å‹ã€åè®®ã€æ‰©å±•ç­‰ã€‚ OCé‡Œé¢çš„æšä¸¾åˆ™é¸¡è‚‹å¾ˆå¤šã€‚ æ³›å‹ Swiftä¸­ æ”¯æŒæ³›å‹ï¼Œä¹Ÿæ”¯æŒæ³›å‹çš„ç±»å‹çº¦æŸç­‰ç‰¹æ€§ è‹¹æœæ¨å‡ºäº†Swift2.0ç‰ˆæœ¬ï¼Œä¸ºäº†è®©å¼€å‘è€…ä»OCæ›´å¥½çš„å›½åº¦åˆ°Swiftä¸Šï¼Œè‹¹æœä¹Ÿä¸ºOCå¸¦æ¥äº†Gennericsæ³›å‹æ”¯æŒï¼Œä¸è¿‡OCçš„æ³›å‹çº¦æŸä¹Ÿä»…åœç•™åœ¨ç¼–è¯‘å™¨è­¦å‘Šé˜¶æ®µã€‚ åè®®å’Œæ‰©å±• Swiftå¯¹åè®®çš„æ”¯æŒæ›´åŠ ä¸°å¯Œï¼Œé…åˆæ‰©å±•ï¼ˆextensionï¼‰ã€æ³›å‹ã€å…³è”ç±»å‹ç­‰å¯ä»¥å®ç°é¢å‘åè®®ç¼–ç¨‹ï¼Œä»è€Œå¤§å¤§æé«˜ä»£ç çš„çµæ´»æ€§ã€‚åŒæ—¶swiftä¸­çš„protocolè¿˜å¯ä»¥ç”¨äºå€¼ç±»å‹ï¼Œå¦‚ç»“æ„ä½“å’Œæšä¸¾ OCçš„åè®®å´åå¼ºçº¦æŸï¼Œæä¾›optionalç‰¹æ€§å¾€å¾€æˆä¸ºå¾ˆå¤šé—®é¢˜å¾—æ¥æºï¼Œè€Œå¦‚æœæ”¾å¼ƒoptionalåˆä¼šè®©å®ç°ä»£ä»·è¿‡å¤§ã€‚ å‡½æ•°å’Œé—­åŒ… Swiftå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰å‡½æ•°ç±»å‹å˜é‡ï¼Œå¯ä»¥ä½œä¸ºå…¶ä»–å‡½æ•°å‚æ•°ä¼ é€’ï¼Œå¯ä»¥ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚ OCé‡Œé¢å‡½æ•°ä»ç„¶æ˜¯æ¬¡ç­‰å…¬æ°‘ï¼Œéœ€è¦selectorå°è£…æˆ–è€…ä½¿ç”¨blockæ‰èƒ½æ¨¡æ‹ŸSwiftä¸­ç±»ä¼¼çš„æ•ˆæœã€‚","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-è¯¾ç¨‹ç¯‡","slug":"Swift-è¯¾ç¨‹ç¯‡","permalink":"https://www.bboyzj.cn/tags/Swift-%E8%AF%BE%E7%A8%8B%E7%AF%87/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"Swiftå­¦ä¹ ï¼šSnapkitä½¿ç”¨æ¢ç´¢","slug":"Swift/Swiftå­¦ä¹ ï¼šSnapkitä½¿ç”¨æ¢ç´¢","date":"2020-08-10T16:51:26.000Z","updated":"2023-03-08T22:13:33.535Z","comments":true,"path":"2020/08/11/Swift/Swiftå­¦ä¹ ï¼šSnapkitä½¿ç”¨æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/11/Swift/Swift%E5%AD%A6%E4%B9%A0%EF%BC%9ASnapkit%E4%BD%BF%E7%94%A8%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"Snapkitç®€ä»‹SnapKitæ˜¯ä¸€ä¸ªä¼˜ç§€çš„ ç¬¬ä¸‰æ–¹è‡ªé€‚åº”å¸ƒå±€åº“ï¼Œå®ƒå¯ä»¥è®©iOSã€OS Xåº”ç”¨æ›´ç®€å•åœ°å®ç°è‡ªåŠ¨å¸ƒå±€ SnapKité›†æˆä½¿ç”¨podsæ–¹å¼å¼•å…¥ç±»åº“ï¼Œpod &#39;SnapKit&#39; å¼•å…¥å¤´æ–‡ä»¶ import SnapKit Snapkitä½¿ç”¨æ–¹æ³• é€šè¿‡ snp.makeConstraints æ–¹æ³•ç»™ view æ·»åŠ çº¦æŸï¼Œçº¦æŸæœ‰å‡ ç§ï¼Œåˆ†åˆ«æ˜¯ è¾¹è·ã€å®½ã€é«˜ã€å·¦ä¸Šå³ä¸‹ æ·»åŠ çº¦æŸåä¿®æ­£ offetã€insetã€multipliedBy è¯­æ³•ä¸€èˆ¬ä¸ºï¼š make.equalToï¼šç­‰äº make.lessThanOrEqualToï¼šå°äºç­‰äº make.greaterThanOrEqaulToï¼šå¤§äºç­‰äº åœºæ™¯ åœºæ™¯1ï¼šå®½é«˜200 make.width.height.equal(200) åœºæ™¯2ï¼šè·ç¦»box1 30 make.top.equalTo(box1.snp.top).offset(30) åœºæ™¯3ï¼šä¸€åŠ make.size.equalTo(box1).multipliedBy(0.5) åœºæ™¯4ï¼šè¾¹è· make.edges.equalTo(box1).inset(UIEdgeInsets(10,20,30,40)) SnapKitæ³¨æ„ ä½¿ç”¨SnapKitæ·»åŠ çº¦æŸä¹‹å‰ï¼Œéœ€è¦åœ¨addSubviewä¹‹åæ‰èƒ½ä½¿ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å´©æºƒ åœ¨æ·»åŠ çº¦æŸæ—¶å¸¸ä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œçº¦æŸå‡ºç°é—®é¢˜çš„åŸå› ä¸€èˆ¬å°±æ˜¯ä¸¤ç§ï¼šçº¦æŸå†²çªå’Œç¼ºå°‘çº¦æŸã€‚å¯¹äºè¿™ä¸¤ç§é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è°ƒè¯•å’Œlogæ’æŸ¥","categories":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}],"tags":[{"name":"Swift-å¸¸ç”¨","slug":"Swift-å¸¸ç”¨","permalink":"https://www.bboyzj.cn/tags/Swift-%E5%B8%B8%E7%94%A8/"}],"keywords":[{"name":"Swift","slug":"Swift","permalink":"https://www.bboyzj.cn/categories/Swift/"}]},{"title":"OCç®—æ³•01ï¼šå†’æ³¡æ’åºæ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•01ï¼šå†’æ³¡æ’åºæ¢ç´¢","date":"2020-08-10T11:48:48.000Z","updated":"2023-03-06T10:16:59.351Z","comments":true,"path":"2020/08/10/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•01ï¼šå†’æ³¡æ’åºæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/10/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E7%AE%97%E6%B3%9501%EF%BC%9A%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"å†’æ³¡æ’åº åŸºæœ¬æ€è·¯ï¼š é‡å¤åœ°èµ°è®¿è¦æ’åºçš„å…ƒç´ åˆ—ï¼Œä¾æ¬¡æ¯”è¾ƒä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„ é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚ ç®—æ³•æ€æƒ³ï¼š 1ï¼‰æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚2ï¼‰å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ åšåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚åœ¨è¿™ä¸€ç‚¹ï¼Œæœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚3ï¼‰é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚4ï¼‰æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚ ä¸»è¦æµç¨‹ï¼š é¦–å…ˆæˆ‘ä»¬éœ€è¦ åŒå±‚å¾ªç¯ï¼Œå¤–å±‚å¾ªç¯æ§åˆ¶æ’åºè¶Ÿæ•°ï¼Œå†…å­˜å¾ªç¯æ§åˆ¶æ¯è¶Ÿæ¯”è¾ƒæ¬¡æ•°ä»¥åŠæ˜¯å¦éœ€è¦äº¤æ¢ä½ç½®ï¼Œæˆ‘ä»¬å…ˆä¸å…³å¿ƒæ˜¯å¦äº¤æ¢ä½ç½®ï¼Œæˆ‘ä»¬å†…å±‚å¾ªç¯æ¯æ¬¡æ¯”è¾ƒéƒ½æ˜¯å– array[j] å’Œ array[j+1] ç›¸æ¯”è¾ƒï¼Œæ ¹æ®æ¯”è¾ƒç»“æœæ¥åˆ¤æ–­æ˜¯å¦äº¤æ¢ä½ç½®ã€‚ æ—¶é—´å¤æ‚åº¦ æœ€å¥½çš„æƒ…å†µï¼šå†’æ³¡æ’åºä¸­æœ€å¥½çš„æƒ…å†µæ˜¯æ•°ç»„æœ¬èº«å°±æ˜¯æ­£åºæ’åˆ—çš„ï¼Œå¹¶ä¸éœ€è¦äº¤æ¢ï¼Œä¾‹å¦‚ï¼š@[1,2,3,4,5]; å½“æ­£åºæ•°ç»„æ”¾å…¥å†’æ³¡æ’åºä¸­çš„æ—¶å€™ï¼Œåªä¼šè¿›è¡Œ4æ¬¡æ¯”è¾ƒï¼Œåˆ†åˆ«æ˜¯1å’Œ2ï¼Œ2å’Œ3ï¼Œ3å’Œ4ï¼Œ4å’Œ5ã€‚æ¯”è¾ƒå®Œåå‘ç°æ²¡æœ‰ä»»ä½•æ•°éœ€è¦äº¤æ¢ï¼Œé‚£ä¹ˆè¯´æ˜æ•°ç»„å·²ç»æ’åºæ­£ç¡®ï¼Œä¸è¦åœ¨è¿›è¡Œæœ€å¤–å±‚å¾ªç¯ã€‚å½“æ­£åºæ•°ç»„ä¸­æœ‰ N ä¸ªæ•°çš„æ—¶å€™ï¼Œé‚£ä¹ˆåªéœ€è¦ N-1 æ¬¡æ¯”è¾ƒã€‚ è€Œæ­£åºæ•°ç»„åœ¨å†’æ³¡æ’åºä¸­çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå› ä¸ºn-1ä¸­ï¼Œåœ¨nçš„åŸºæ•°å¾ˆå¤§çš„æƒ…å†µï¼Œæ¯”å¦‚nä¸º1000æ—¶ï¼Œ1å…¶å®å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚æ‰€ä»¥ å†’æ³¡æ’åºä¸­æœ€çŸ­çš„æ—¶é—´**å¤æ‚åº¦ä¸ºO(n)**ã€‚ å†’æ³¡æ’åºä¸­æœ€åçš„æƒ…å†µæ˜¯æ•°ç»„æœ¬èº«å°±æ˜¯é€†åºæ’åˆ—çš„ï¼Œéœ€è¦æ¯ä¸¤ä¸ªæ•°éƒ½è¿›è¡Œäº¤æ¢ï¼Œä¾‹å¦‚ï¼š@[5,4,3,2,1]ï¼›å½“é€†åºæ•°ç»„æ”¾å…¥å†’æ³¡æ’åºä¸­ï¼Œæœ€å¤–å±‚çš„æ¯ä¸€æ¬¡å¾ªç¯éƒ½è¦è¿›è¡Œn-1æ¬¡æ¯”è¾ƒï¼Œè€Œé€†åºæ•°ç»„éœ€è¦è¿›è¡Œnæ¬¡æœ€å¤–å±‚å¾ªç¯æ‰èƒ½æ­£ç¡®æ’åºï¼Œæœ€ç»ˆæ¯”è¾ƒæ¬¡æ•°ä¸º(n-1)n&#x2F;2ï¼Œæ‰€ä»¥å†’æ³¡æ’åºä¸­æœ€é•¿çš„æ—¶é—´**å¤æ‚åº¦ä¸º(nÂ²)**ï¼Œå› ä¸ºå½“nåŸºæ•°å¾ˆå¤§æ—¶ï¼Œ(n-1)n&#x2F;2 &#x3D; (nÂ² - n)&#x2F;2ï¼› nÂ²ä¸nã€1&#x2F;2çš„å·®è·è¶Šå¤§ï¼Œnä¸1&#x2F;2å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ å†’æ³¡æ’åºä¾‹å­ï¼šå…ƒæ•°æ®ï¼š@[@â€1â€,@â€3â€,@â€2â€,@â€5â€,@â€4â€] 123456789101112NSMutableArray * arr = [NSMutableArray arrayWithArray:@[@&quot;1&quot;,@&quot;3&quot;,@&quot;2&quot;,@&quot;5&quot;,@&quot;4&quot;]]; // å¤–å¾ªç¯æ§åˆ¶æ’åºè¶Ÿæ•°,è¿›è¡Œ array.count-1 è¶Ÿ for (int i = 0; i &lt; arr.count; i ++) &#123; // è®°å½•æ˜¯å¦è¿›è¡Œäº†äº¤æ¢ï¼Œå¦‚æœæ²¡æœ‰äº¤æ¢ï¼Œæ•°ç»„é¡ºåºä¸ºé¡ºåºï¼Œåˆ™ç›´æ¥è·³å‡ºå¤–å±‚å¾ªç¯ç»“æŸæ’åº for (int j = 0; j &lt; arr.count - i - 1; j++) &#123; // ç›¸é‚»å…ƒç´ æ¯”è¾ƒï¼Œè‹¥é€†åºåˆ™äº¤æ¢ if ([arr[j] intValue] &gt; [arr[j + 1] intValue]) &#123; [arr exchangeObjectAtIndex:j withObjectAtIndex:j + 1]; &#125; &#125; &#125; æ‰“å°ç»“æœï¼š 12345672020-08-10 20:29:10.492517+0800 OCå†’æ³¡æ’åº[27771:1528609] ( 1, 2, 3, 4, 5) æœ‰åºæ•°ç»„å†’æ³¡æ’åºçš„ä¼˜åŒ–å¦‚æœæ•°æ®æ˜¯æœ‰åºçš„ï¼š ç¬¬ä¸€ç§ä¼˜åŒ–æ–¹å¼æ˜¯è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½æ¥æ ‡è®°æ˜¯å¦å‘ç”Ÿäº†äº¤æ¢ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿäº¤æ¢å°±æå‰ç»“æŸï¼› 12345678910111213141516171819NSMutableArray * arr = [NSMutableArray arrayWithArray:@[@&quot;5&quot;,@&quot;4&quot;,@&quot;3&quot;,@&quot;2&quot;,@&quot;1&quot;]]; int flag = 0; // å¤–å¾ªç¯æ§åˆ¶æ’åºè¶Ÿæ•°,è¿›è¡Œ array.count-1 è¶Ÿ for (int i = 0; i &lt; arr.count; i ++) &#123; // è®°å½•æ˜¯å¦è¿›è¡Œäº†äº¤æ¢ï¼Œå¦‚æœæ²¡æœ‰äº¤æ¢ï¼Œæ•°ç»„é¡ºåºä¸ºé¡ºåºï¼Œåˆ™ç›´æ¥è·³å‡ºå¤–å±‚å¾ªç¯ç»“æŸæ’åº for (int j = 0; j &lt; arr.count - i - 1; j++) &#123; //ç›¸é‚»å…ƒç´ æ¯”è¾ƒï¼Œè‹¥é€†åºåˆ™äº¤æ¢ if ([arr[j] intValue] &gt; [arr[j + 1] intValue]) &#123; flag = 1; id temp = arr[j]; arr[j] = arr[j+1]; arr[j+1] = temp; &#125; &#125; if (flag == 0) &#123; break; &#125; &#125; NSLog(@&quot;%@&quot;,arr); æ‰“å°ç»“æœ 12345672020-08-10 20:45:33.770139+0800 OCå†’æ³¡æ’åº[28047:1546936] ( 1, 2, 3, 4, 5) ä¸¤ä¸ªæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæ•°æ®ï¼Œå¹¶æ’åº1234567891011121314151617NSArray * ary1 = @[@1,@3,@4,@5,@9];NSArray * ary2 = @[@2,@4,@6,@8];NSMutableArray * res = [NSMutableArray arrayWithCapacity:[ary1 count] + [ary2 count]]; int i = 0, j = 0; // i è¡¨ç¤ºary1çš„ä¸‹æ ‡ jè¡¨ç¤ºary2çš„ä¸‹æ ‡ while (i &lt; ary1.count &amp;&amp; j &lt; ary2.count) &#123; int a1 = [ary1[i] intValue]; int a2 = [ary2[j] intValue]; if (a1 &lt;= a2) &#123; [res addObject:ary1[i++]]; &#125;else &#123; [res addObject:ary2[j++]]; &#125; &#125; NSLog(@&quot;%@&quot;,res); æ‰“å° 123456789102020-08-10 21:11:11.311203+0800 OCå†’æ³¡æ’åº[28372:1568516] ( 1, 2, 3, 4, 4, 5, 6, 8)","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"OC-ç®—æ³•æ¢ç´¢ç¯‡","slug":"OC-ç®—æ³•æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E7%AE%97%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}]},{"title":"OCæ•°æ®ç»“æ„01ï¼šé“¾è¡¨çš„æ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCæ•°æ®ç»“æ„01ï¼šé“¾è¡¨çš„æ¢ç´¢","date":"2020-08-09T14:39:22.000Z","updated":"2023-03-06T10:15:00.063Z","comments":true,"path":"2020/08/09/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCæ•°æ®ç»“æ„01ï¼šé“¾è¡¨çš„æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/09/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%8401%EF%BC%9A%E9%93%BE%E8%A1%A8%E7%9A%84%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"æ•°æ®ç»“æ„é¡ºåºå­˜å‚¨ç»“æ„ ä¸¾ä¸ªä¾‹å­ï¼Œæ•°ç»„ï¼š1-2-3-4-5-6-7-8-9-10ï¼Œè¿™ä¸ªå°±æ˜¯ä¸€ä¸ªé¡ºåºå­˜å‚¨ç»“æ„ï¼Œå­˜å‚¨æ˜¯æŒ‰é¡ºåºçš„ã€‚ æ¯”å¦‚ æ ˆï¼Œå…ˆè¿›åå‡ºï¼Œæ¯”å¦‚ hello world åœ¨æ ˆé‡Œé¢æ˜¯ä» æ ˆåº•åˆ°æ ˆé¡¶çš„é€»è¾‘ï¼Œä¾æ¬¡æ˜¯ h-e-l-l-o-w-o-r-l-d è¿™ä¸ªé¡ºåºå­˜å‚¨ å†æ¯”å¦‚ é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡ºï¼Œä»å¤´åˆ°å°¾ h-e-l-l-o-w-o-r-l-d è¿™ä¸ªé¡ºåºæ’åº é“¾å¼å­˜å‚¨ç»“æ„-é“¾è¡¨é“¾è¡¨æ˜¯ä¸€ç§ ç‰©é‡Œå­˜å‚¨å•å…ƒä¸Šéè¿ç»­ã€éé¡ºåºçš„å­˜å‚¨ç»“æ„ï¼Œæ•°æ®å…ƒç´ çš„é¡ºåºæ˜¯é€šè¿‡é“¾è¡¨ä¸­çš„ æŒ‡é’ˆ é“¾æ¥æ¬¡åºå®ç°çš„ã€‚é“¾è¡¨ç”± ä¸€ç³»åˆ—èŠ‚ç‚¹ç»„æˆï¼Œåœ¨ è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯ æ•°æ®åŸŸï¼Œä¸€ä¸ªæ˜¯ æŒ‡é’ˆåŸŸã€‚ é“¾è¡¨é“¾è¡¨çš„ç»„æˆ é“¾è¡¨çš„æ•°æ®å…ƒç´ çš„ç»„æˆéƒ¨åˆ†ï¼šæŒ‡é’ˆåŸŸ å’Œ æ•°æ®åŸŸ æŒ‡é’ˆåŸŸ ç”¨æ¥å­˜æ”¾æŒ‡ç¤ºæ•°æ®å…ƒç´ ä¹‹é—´çš„é€»è¾‘å…³ç³»çš„æŒ‡é’ˆã€‚ æ•°æ®åŸŸ ç”¨æ¥å­˜æ”¾æ•°æ®ä¿¡æ¯ã€‚ æ•°æ®å…ƒç´ è¿™ç§ç‰¹æ®Šçš„å­˜å‚¨æ–¹å¼ç§°ä¹‹ä¸º ç»“ç‚¹ï¼ˆNodeï¼‰ã€‚ é“¾è¡¨çš„åˆ†ç±»é“¾è¡¨åˆ†ä¸º4ç±»ï¼š å•é“¾è¡¨ï¼šä¸€ä¸ªæ•°æ®åŸŸdataã€ä¸€ä¸ªåç»§æŒ‡é’ˆåŸŸnextã€‚ä¹Ÿå³ï¼šä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°¾èŠ‚ç‚¹nextæŒ‡å‘nilï¼Œé¦–èŠ‚ç‚¹preæŒ‡å‘nilã€‚ åŒå‘é“¾è¡¨ï¼šä¸€ä¸ªæ•°æ®åŸŸdataã€ä¸€ä¸ªå‰é©±æŒ‡é’ˆåŸŸpreviousã€ä¸€ä¸ªåç»§æŒ‡é’ˆåŸŸnextã€‚ä¹Ÿå³ï¼šä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹äº’ç›¸æŒ‡å‘ï¼Œå°¾èŠ‚ç‚¹nextæŒ‡å‘nilï¼Œé¦–èŠ‚ç‚¹preæŒ‡å‘nilã€‚ å¾ªç¯é“¾è¡¨ï¼šä¸€ä¸ªæ•°æ®åŸŸdataã€ä¸€ä¸ªåç»§æŒ‡é’ˆåŸŸnextã€‚ä¹Ÿå³ï¼šä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°¾èŠ‚ç‚¹nextæŒ‡å‘é¦–èŠ‚ç‚¹ã€‚ åŒå‘å¾ªç¯é“¾è¡¨ï¼šä¸€ä¸ªæ•°æ®åŸŸdataã€ä¸€ä¸ªå‰é©±æŒ‡é’ˆåŸŸpreviousã€ä¸€ä¸ªåç»§æŒ‡é’ˆåŸŸnextã€‚ä¹Ÿå³ï¼šä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹äº’ç›¸æŒ‡å‘ï¼Œå°¾èŠ‚ç‚¹å’Œé¦–èŠ‚ç‚¹ä¹Ÿäº’ç›¸æŒ‡å‘ã€‚ é“¾è¡¨çš„ä¼˜ç¼ºç‚¹ æ•°ç»„ï¼š æˆ‘ä»¬çŸ¥é“ï¼Œç”¨æ•°ç»„å­˜æ”¾æ•°æ®æ—¶ï¼Œå¿…é¡»äº‹å…ˆå®šä¹‰å›ºå®šçš„é•¿åº¦ï¼ˆå³å…ƒç´ ä¸ªæ•°ï¼‰ã€‚å¦‚æœäº‹å…ˆéš¾ä»¥ç¡®å®šå…ƒç´ ä¸ªæ•°ï¼Œåˆ™å¿…é¡»æŠŠæ•°ç»„å®šä¹‰çš„è¶³å¤Ÿå¤§ï¼Œä»¥ä¾¿å­˜æ”¾ï¼Œæ˜¾ç„¶è¿™æ ·ä¼šæµªè´¹å†…å­˜ã€‚ è€Œé“¾è¡¨å¯æ ¹æ®éœ€è¦å¼€è¾Ÿå†…å­˜å•å…ƒï¼Œä¸ä¼šæµªè´¹å†…å­˜ã€‚ æ•°ç»„ å’Œ é“¾è¡¨ çš„åŒºåˆ«ï¼Ÿ æ•°ç»„ï¼šæ•°ç»„ é™æ€åˆ†é… å†…å­˜ï¼›æ•°ç»„å…ƒç´ åœ¨å†…å­˜ä¸Šæ˜¯è¿ç»­çš„ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ ‡æŸ¥æ‰¾å…ƒç´ ï¼›æ’å…¥ã€åˆ é™¤éœ€è¦ç§»åŠ¨å¤§é‡å…ƒç´ ï¼Œæ¯”è¾ƒä½¿ç”¨å…ƒç´ å¾ˆå°‘å˜åŒ–çš„æƒ…å†µï¼›æ•°ç»„æ’å…¥åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæ•°ç»„æŸ¥è¯¢æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1) é“¾è¡¨ï¼šé“¾è¡¨ åŠ¨æ€åˆ†é… å†…å­˜ï¼›é“¾è¡¨å…ƒç´ åœ¨å†…å­˜ä¸­ä¸æ˜¯é¡ºåºå­˜å‚¨çš„ï¼ŒæŸ¥æ‰¾æ…¢ï¼›æ’å…¥ã€åˆ é™¤åªéœ€è¦å¯¹å…ƒç´ æŒ‡é’ˆé‡æ–°èµ‹å€¼ï¼Œæ•ˆç‡é«˜ï¼›é“¾è¡¨æ’å…¥åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œé“¾è¡¨æŸ¥è¯¢æ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯ O(n) å¦‚ä½•æ£€æµ‹å•é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ï¼Ÿ ç©·ä¸¾éå† é¦–å…ˆä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ¯éå†åˆ°ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå°±ä»å¤´èŠ‚ç‚¹é‡æ–°éå†æ–°èŠ‚ç‚¹ä¹‹å‰çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå½“ æ–°èŠ‚ç‚¹çš„ID å’Œ æ­¤èŠ‚ç‚¹ä¹‹å‰çš„æ‰€æœ‰èŠ‚ç‚¹ID ä¾æ¬¡æ¯”è¾ƒï¼Œå¦‚æœå‘ç° IDç›¸åŒï¼Œåˆ™è¯æ˜é“¾è¡¨æœ‰ç¯ã€‚ å“ˆå¸Œè¡¨ç¼“å­˜ é¦–å…ˆåˆ›å»ºä¸€ä¸ªä»¥ èŠ‚ç‚¹IDä¸ºé”® çš„HashSeté›†åˆï¼Œç”¨æ¥å­˜å‚¨æ›¾ç»éå†è¿‡çš„èŠ‚ç‚¹ã€‚ç„¶ååŒæ ·æ˜¯ä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡éå†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“æ–°èŠ‚ç‚¹å’ŒHashSeté›†åˆå½“ä¸­å­˜å‚¨çš„èŠ‚ç‚¹IDç›¸åŒï¼Œåˆ™è¯´æ˜é“¾è¡¨å³ç¯ã€‚ å¿«æ…¢æŒ‡é’ˆ é¦–å…ˆåˆ›å»ºä¸¤ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆ1å’ŒæŒ‡é’ˆ2ï¼ŒåŒæ—¶æŒ‡å‘è¿™ä¸ªå¤´èŠ‚ç‚¹ï¼ŒæŒ‡é’ˆ1æ¯æ¬¡å‘ä¸‹ç§»åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡é’ˆ2å‘ä¸‹ç§»åŠ¨2ä¸ªèŠ‚ç‚¹ï¼Œæ¯”è¾ƒèŠ‚ç‚¹æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™è¯´æ˜é“¾è¡¨æœ‰ç¯ã€‚å¦‚æœä¸åŒæ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ å•å‘é“¾è¡¨ä»£ç å®ç° å®šä¹‰èŠ‚ç‚¹ 12345678910111213141516// å•é“¾è¡¨èŠ‚ç‚¹@interface SingleLinkNode : NSObject@property (nonatomic,strong)id data; // æ•°æ®åŸŸ@property (nonatomic,strong,nullable)SingleLinkNode * next; // åç»§æŒ‡é’ˆåŸŸ+ (instancetype)constructNodeWithData:(id)data;@end@interface SingleLinkNode ()@end@implementation SingleLinkNode+ (instancetype)constructNodeWithData:(id)data&#123; SingleLinkNode * node = [[SingleLinkNode alloc] init]; node.data = data; node.next = nil; return node;&#125; æ„å»ºé“¾è¡¨ 12// æ„å»ºä¸€ä¸ªå•é“¾è¡¨SingleLinkNode * headNode = [[SingleLinkNode alloc] init]; å¯¹å¤–æ¥å£ç±» 123456789101112131415161718192021222324@interface LinkInterface : NSObject// å•é“¾è¡¨ï¼šåœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹+ (void)insertNewNodeToHead:(SingleLinkNode *)newNode headNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šåœ¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹+ (void)insertNewNodeToTail:(SingleLinkNode *)newNode headNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šåœ¨æŒ‡å®šä½ç½®æ’å…¥èŠ‚ç‚¹+ (void)insertNodeAtIndex:(int)index node:(SingleLinkNode *)newNode headNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šåˆ é™¤æŒ‡å®šä½ç½®èŠ‚ç‚¹+ (void)deleteNodeAtIndex:(int)index headNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šæŸ¥è¯¢æŒ‡å®šä½ç½®èŠ‚ç‚¹+ (SingleLinkNode *)queryNodeAtIndex:(int)index headNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šæ­£åºéå†é“¾è¡¨+ (NSArray *)printFromHeadWithNode:(SingleLinkNode *)headNode printPrefixText:(NSString *)text;// å•é“¾è¡¨ï¼šå€’å™éå†é“¾è¡¨+ (NSMutableArray *)printFromTailWithNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šåè½¬é“¾è¡¨+ (SingleLinkNode *)reverseWithNode:(SingleLinkNode *)headNode;// å•é“¾è¡¨ï¼šä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨+ (SingleLinkNode *)combineWithNode:(SingleLinkNode *)headNode otherNode:(SingleLinkNode *)otherNode;// å•é“¾è¡¨ï¼šåˆ¤æ–­ä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸äº¤+ (BOOL)intersectWithNode:(SingleLinkNode *)headNode otherNode:(SingleLinkNode *)otherNode;// å•é“¾è¡¨ï¼šåˆ¤æ–­é“¾è¡¨æ˜¯å¦æ„æˆç¯ï¼Œå¦‚æœæˆç¯ï¼Œæ±‚å‡ºç¯çš„å…¥å£èŠ‚ç‚¹+ (SingleLinkNode *)circleWithNode:(SingleLinkNode *)headNode;@end æ’å…¥èŠ‚ç‚¹ åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹ 12345678910111213141516// åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹+ (void)insertNewNodeToHead:(SingleLinkNode *)newNode headNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if (!headNode)&#123; return; &#125; // å…ˆæŠŠæ–°èŠ‚ç‚¹æŒ‡å‘å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†è®©å¤´ç»“ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹ï¼ˆæ¯”è¾ƒå¸¸ç”¨ï¼‰ if (headNode.next == nil) &#123; headNode.next = newNode; &#125;else &#123; // å°†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹èµ‹å€¼ç»™æ–°èŠ‚ç‚¹ newNode.next = headNode.next; // å†å°†å¤´èŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹ headNode.next = newNode; &#125;&#125; vcå®ç°ï¼š 12345// æ’å…¥èŠ‚ç‚¹åˆ°å¤´éƒ¨SingleLinkNode * newHeadNode = [SingleLinkNode constructNodeWithData:@1];[LinkInterface insertNewNodeToHead:newHeadNode headNode:headNode];// æ­£åºæ‰“å°èŠ‚ç‚¹[LinkInterface printFromHeadWithNode:headNode printPrefixText:@&quot;æ„é€ å•é“¾è¡¨ä¸ºï¼š&quot;]; æ‰“å°ç»“æœï¼š 12022-11-23 16:44:46.140163+0800 å•é“¾è¡¨[39792:20769651] å•é“¾è¡¨ä¸º:1 åœ¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹ 123456789101112131415161718// åœ¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹+ (void)insertNewNodeToTail:(SingleLinkNode *)newNode headNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode)&#123; return; &#125; // å¦‚æœå¤´èŠ‚ç‚¹å°±æ˜¯å°¾èŠ‚ç‚¹ if(headNode.next == nil) &#123; headNode.next = newNode; &#125;else &#123; // è®¾ç½®ä¸­é—´å˜é‡ SingleLinkNode * pNode = headNode; while (pNode.next != nil) &#123; // æœªéå†åˆ°å°¾èŠ‚ç‚¹ pNode = pNode.next; &#125; pNode.next = newNode; &#125;&#125; vcå®ç°ï¼š 123456789// æ’å…¥èŠ‚ç‚¹åˆ°å°¾éƒ¨SingleLinkNode * newTailNode = [SingleLinkNode constructNodeWithData:@2];SingleLinkNode * newTailNode1 = [SingleLinkNode constructNodeWithData:@3];SingleLinkNode * newTailNode2 = [SingleLinkNode constructNodeWithData:@5];[LinkInterface insertNewNodeToTail:newTailNode headNode:headNode];[LinkInterface insertNewNodeToTail:newTailNode1 headNode:headNode];[LinkInterface insertNewNodeToTail:newTailNode2 headNode:headNode];// æ­£åºæ‰“å°èŠ‚ç‚¹[LinkInterface printFromHeadWithNode:headNode printPrefixText:@&quot;å•é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-23 16:46:42.287876+0800 å•é“¾è¡¨[39960:20772937] å•é“¾è¡¨ä¸º:1-&gt;2-&gt;3-&gt;5 åœ¨æŒ‡å®šä½ç½®æ’å…¥ 123456789101112131415161718192021// å•é“¾è¡¨ï¼šåœ¨æŒ‡å®šä½ç½®æ’å…¥èŠ‚ç‚¹+ (void)insertNodeAtIndex:(int)index node:(SingleLinkNode *)newNode headNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode)&#123; return; &#125; // å¦‚æœå¤´èŠ‚ç‚¹å³å°¾èŠ‚ç‚¹ if (headNode.next == nil)&#123; headNode.next = newNode; &#125;else &#123; SingleLinkNode * pNode = headNode; int i = 1; while (i &lt; index &amp;&amp; pNode.next != nil) &#123; pNode = pNode.next; i ++; &#125; newNode.next = pNode.next; pNode.next = newNode; &#125; &#125; vcå®ç°ï¼š 12345// æ’å…¥æŒ‡å®šä½ç½®èŠ‚ç‚¹SingleLinkNode * newIndexNode = [SingleLinkNode constructNodeWithData:@4];[LinkInterface insertNodeAtIndex:4 node:newIndexNode headNode:headNode];// æ­£åºæ‰“å°èŠ‚ç‚¹[LinkInterface printFromHeadWithNode:headNode printPrefixText:@&quot;å•é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-23 16:47:38.507939+0800 å•é“¾è¡¨[40048:20774861] æ„é€ å•é“¾è¡¨ä¸ºï¼š:1-&gt;2-&gt;3-&gt;4-&gt;5 åˆ é™¤èŠ‚ç‚¹ 12345678910111213141516171819202122// å•é“¾è¡¨ï¼šåˆ é™¤æŒ‡å®šä½ç½®èŠ‚ç‚¹+ (void)deleteNodeAtIndex:(int)index headNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(headNode == nil || !headNode.next || index &lt;= 0)&#123; NSLog(@&quot;%@&quot;,[NSString stringWithFormat:@&quot;æ²¡æœ‰è¦åˆ é™¤çš„ç¬¬%dä¸ªèŠ‚ç‚¹&quot;,index]); return; &#125; SingleLinkNode * pNode = headNode; SingleLinkNode * p = pNode; // ç§»åŠ¨æŒ‡é’ˆ int i = 0; while (i &lt; index &amp;&amp; pNode.next != nil) &#123; p = pNode; pNode = pNode.next; i ++; &#125; if(pNode != nil)&#123; p.next = p.next.next; return; &#125; NSLog(@&quot;%@&quot;,[NSString stringWithFormat:@&quot;æ²¡æœ‰è¦åˆ é™¤çš„ç¬¬%dä¸ªèŠ‚ç‚¹&quot;,index]);&#125; vcå®ç°ï¼š 1234// åˆ é™¤æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹[LinkInterface deleteNodeAtIndex:1 headNode:headNode];// æ­£åºæ‰“å°èŠ‚ç‚¹[LinkInterface printFromHeadWithNode:headNode printPrefixText:@&quot;å•é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-23 16:50:48.638460+0800 å•é“¾è¡¨[40345:20779532] å•é“¾è¡¨ä¸º:2-&gt;3-&gt;4-&gt;5 æŸ¥è¯¢èŠ‚ç‚¹ 12345678910111213141516171819// å•é“¾è¡¨ï¼šæŸ¥è¯¢æŒ‡å®šä½ç½®èŠ‚ç‚¹+ (SingleLinkNode *)queryNodeAtIndex:(int)index headNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if (!headNode || !headNode.next) &#123; NSLog(@&quot;%@&quot;,[NSString stringWithFormat:@&quot;æ²¡æœ‰æŸ¥è¯¢åˆ°çš„ç¬¬%dä¸ªèŠ‚ç‚¹&quot;,index]); return nil; &#125; SingleLinkNode * pNode = headNode.next; int i = 1; while (i &lt; index &amp;&amp; pNode != nil) &#123; pNode = pNode.next; i ++; &#125; if(pNode != nil)&#123; return pNode; &#125; NSLog(@&quot;%@&quot;,[NSString stringWithFormat:@&quot;æ²¡æœ‰æŸ¥è¯¢åˆ°çš„ç¬¬%dä¸ªèŠ‚ç‚¹&quot;,index]); return nil;&#125; vcå®ç°ï¼š 1234// æŸ¥è¯¢æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹[LinkInterface queryNodeAtIndex:3 headNode:headNode];// æ­£åºæ‰“å°èŠ‚ç‚¹[LinkInterface printFromHeadWithNode:headNode printPrefixText:@&quot;å•é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-23 16:55:10.563221+0800 å•é“¾è¡¨[40694:20785389] å•é“¾è¡¨ä¸º:2-&gt;3-&gt;4-&gt;5 éå†é“¾è¡¨ æ­£å‘éå† 1234567891011121314151617// æ­£åºéå†é“¾è¡¨+ (NSArray *)printFromHeadWithNode:(SingleLinkNode *)headNode printPrefixText:(NSString *)text&#123; // åˆ¤ç©ºå¤„ç† if (!headNode || !headNode.next) &#123; return nil; &#125; // è®¾ç½®åç§»æŒ‡é’ˆ SingleLinkNode * pNode = headNode.next; NSMutableArray * dataArr = [NSMutableArray array]; while (pNode != nil) &#123; [dataArr addObject:pNode.data]; pNode = pNode.next; // æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ &#125; NSLog(@&quot;%@:%@&quot;,text,[dataArr componentsJoinedByString:@&quot;-&gt;&quot;]); return dataArr;&#125; vcå®ç°ï¼š 12// æ­£åºæ‰“å°èŠ‚ç‚¹[LinkInterface printFromHeadWithNode:headNode printPrefixText:@&quot;å•é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-23 16:55:10.563221+0800 å•é“¾è¡¨[40694:20785389] å•é“¾è¡¨ä¸º:2-&gt;3-&gt;4-&gt;5 åå‘éå† 123456789101112131415161718192021// å•é“¾è¡¨ï¼šå€’å™éå†é“¾è¡¨+ (NSMutableArray *)printFromTailWithNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode || !headNode.next)&#123; return nil; &#125; // éå†æŒ‡é’ˆåç§»ï¼Œæ¯æ¬¡éå†å®Œä¸€æ¬¡åï¼Œè¦è®°å½•æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå°†éå†æŒ‡é’ˆç§»åŠ¨åˆ°å¼€å¤´é‡æ–°å¼€å§‹ï¼Œä¸è®°å½•çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ä½œæ¯”è¾ƒ NSMutableArray * items = [NSMutableArray array]; SingleLinkNode * pNode = headNode; SingleLinkNode * lastNode = nil; while (pNode != nil &amp;&amp; lastNode != pNode) &#123; pNode = pNode.next; if (pNode.next == nil || pNode.next == lastNode) &#123; lastNode = pNode; pNode = headNode; [items addObject:lastNode.data]; &#125; &#125; return items;&#125; vcå®ç°ï¼š 123// å€’å™æ‰“å°èŠ‚ç‚¹NSMutableArray * tailArr = [LinkInterface printFromTailWithNode:headNode];NSLog(@&quot;tail:%@&quot;,tailArr); æ‰“å°ç»“æœï¼š 1234562022-11-23 17:00:09.521947+0800 å•é“¾è¡¨[41100:20791055] tail:( 5, 4, 3, 2) åè½¬é“¾è¡¨ 1234567891011121314151617181920212223242526// å•é“¾è¡¨ï¼šåè½¬é“¾è¡¨+ (SingleLinkNode *)reverseWithNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode|| !headNode.next)&#123; return nil; &#125; // é‡‡ç”¨å¤´èŠ‚ç‚¹æ’å…¥çš„æ–¹å¼åè½¬ // å®šä¹‰éå†æŒ‡é’ˆ SingleLinkNode * p = headNode.next; // å®šä¹‰åè½¬åå¤´èŠ‚ç‚¹ SingleLinkNode * newHead = [[SingleLinkNode alloc] init]; while (p != nil) &#123; // è®°å½•ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç”¨æ¥å¾€ä¸‹å¾ªç¯ SingleLinkNode * temp = p.next; // æ›¿æ¢å½“å‰èŠ‚ç‚¹çš„nextä¸ºæ–°å¤´next p.next = newHead.next; // æ›´æ–°æ–°å¤´èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹å³å¯åè½¬ newHead.next = p; // ç§»åŠ¨pæŒ‡é’ˆ p = temp; &#125; return newHead;&#125; vcå®ç°ï¼š 12// åè½¬é“¾è¡¨SingleLinkNode * reverseNode = [LinkInterface reverseWithNode:headNode]; åˆå¹¶æœ‰åºé“¾è¡¨ï¼ˆæœ‰é—®é¢˜ï¼Œæ’åºä¸å¯¹ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// ä¸¤ä¸ªæœ‰åºé“¾è¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºé“¾è¡¨+ (SingleLinkNode *)combineWithNode:(SingleLinkNode *)headNode otherNode:(SingleLinkNode *)otherNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode || !headNode.next)&#123; return otherNode; &#125; if(!otherNode || !otherNode.next)&#123; return headNode; &#125; // ä¸€èµ·éå† SingleLinkNode * p1 = headNode.next; SingleLinkNode * p2 = otherNode.next; // å®šä¹‰ä¸€ä¸ªæ–°å¤´èŠ‚ç‚¹ SingleLinkNode * newHead = [[SingleLinkNode alloc] init]; while (p1 != nil &amp;&amp; p2 != nil) &#123; if([p1.data integerValue] &gt; [p2.data integerValue])&#123; // ç§»åŠ¨otherNodeèŠ‚ç‚¹æŒ‡å‘otherNodeå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ otherNode.next = p2.next; // å°†å½“å‰otherNodeèŠ‚ç‚¹é“¾è¡¨æ–­æ‰ p2.next = nil; // å°†å½“å‰otherNodeèŠ‚ç‚¹æ’å…¥åˆ°æ–°èŠ‚ç‚¹newHeadé“¾è¡¨çš„å°¾éƒ¨ [self insertNewNodeToTail:p2 headNode:newHead]; // è·å–otherNodeé“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ p2 = otherNode.next; &#125;else &#123; headNode.next = p1.next; p1.next = nil; [self insertNewNodeToTail:p1 headNode:newHead]; p1 = headNode.next; &#125; &#125; // å¤„ç†æ²¡æ‰«æç»“æŸçš„é“¾è¡¨ while (p1 != nil) &#123; headNode.next = p1.next; p1.next = nil; [self insertNewNodeToTail:p1 headNode:newHead]; p1 = headNode.next; &#125; while (p2 != nil) &#123; otherNode.next = p2.next; p2.next = nil; [self insertNewNodeToTail:p2 headNode:newHead]; p2 = otherNode.next; &#125; return newHead;&#125; åˆ¤æ–­ä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸äº¤ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// å•é“¾è¡¨ï¼šåˆ¤æ–­ä¸¤ä¸ªé“¾è¡¨æ˜¯å¦ç›¸äº¤+ (BOOL)intersectWithNode:(SingleLinkNode *)headNode otherNode:(SingleLinkNode *)otherNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode || !headNode.next || !otherNode || !otherNode.next)&#123; return NO; &#125; // æ€è·¯ï¼šåˆ†åˆ«è·å–ä¸¤ä¸ªé“¾è¡¨çš„é•¿åº¦ï¼Œåˆ¤æ–­è°çš„é“¾è¡¨æ›´é•¿ï¼Œé“¾è¡¨æ›´é•¿çš„å…ˆèµ°å®Œç›¸å·®çš„æ­¥æ•°ï¼Œç„¶åå†é½æ­¥èµ° SingleLinkNode * p1 = headNode.next; SingleLinkNode * p2 = otherNode.next; int L1 = 1; int L2 = 1; while (p1 != nil) &#123; L1 ++; p1 = p1.next; &#125; while (p2 != nil) &#123; L2 ++; p2 = p2.next; &#125; p1 = headNode.next; // å°†p1éå†æŒ‡é’ˆç§»åŠ¨åˆ°é¦–èŠ‚ç‚¹ p2 = headNode.next; // å°†p2éå†æŒ‡é’ˆç§»åŠ¨åˆ°é¦–èŠ‚ç‚¹ int i = 0; if (L1 &gt; L2) &#123; while (i &lt; L1 - L2 &amp;&amp; p1 != nil) &#123; // p1å…ˆèµ° p1 = p1.next; i ++; &#125; &#125;else &#123; while (i &lt; L2 - L1 &amp;&amp; p2 != nil) &#123; // p2å…ˆèµ° p2 = p2.next; i ++; &#125; &#125; // p1ã€p2é½æ­¥èµ° if(i == ABS(L1 - L2))&#123; while (p1 != nil &amp;&amp; p2 != nil) &#123; if(p1.next == p2.next) return YES; p1 = p1.next; p2 = p2.next; &#125; &#125; return NO;&#125; åˆ¤æ–­é“¾è¡¨æ˜¯å¦å¤´ç¨‹è¿˜ï¼Œå¦‚æœæˆç¯ï¼Œæ±‚å‡ºç¯çš„å…¥å£èŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829// å•é“¾è¡¨ï¼šåˆ¤æ–­é“¾è¡¨æ˜¯å¦æ„æˆç¯ï¼Œå¦‚æœæˆç¯ï¼Œæ±‚å‡ºç¯çš„å…¥å£èŠ‚ç‚¹+ (SingleLinkNode *)circleWithNode:(SingleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode || !headNode.next)&#123; return nil; &#125; // æ€è·¯ï¼šé‡‡ç”¨å¿«æ…¢æŒ‡é’ˆ // å¿«æŒ‡é’ˆå…ˆèµ°ä¸¤æ­¥ï¼Œæ»¡æŒ‡é’ˆèµ°ä¸€æ­¥ï¼Œå¦‚æœæˆç¯ï¼Œå¿…ç„¶é‡åˆã€‚ // èµ°åˆ°ç¬¬ä¸€æ¬¡é‡åˆçš„åœ°ç‚¹åï¼Œé‡æ–°è®¾ç½®ä¸€ä¸ªæŒ‡é’ˆpæŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¹¶ä¸æ…¢èŠ‚ç‚¹åŒæ­¥ä¼é½æ­¥èµ° // èµ°åˆ°ç¬¬äºŒæ¬¡ç›¸é‡çš„åœ°æ–¹ï¼Œå³ä¸ºæ„æˆç¯çš„èŠ‚ç‚¹ SingleLinkNode * quick = headNode.next; SingleLinkNode * slow = headNode.next; SingleLinkNode * p = headNode.next; while (quick != nil &amp;&amp; slow != nil) &#123; quick = quick.next.next; slow = slow.next; if (quick == slow) &#123; // ç¬¬ä¸€æ¬¡é‡åˆï¼Œç»“æŸå¾ªç¯ break; &#125; &#125; while (p != nil &amp;&amp; slow != nil) &#123; p = p.next; slow = slow.next; if (p == slow) &#123; // ç¬¬äºŒæ¬¡é‡åˆï¼Œæ‰¾åˆ°æˆç¯çš„å…¥å£èŠ‚ç‚¹ return p; &#125; &#125; return nil;&#125; åŒå‘é“¾è¡¨åŒå‘é“¾è¡¨ï¼šæ¯ä¸€ä¸ªèŠ‚ç‚¹å‰åæŒ‡é’ˆåŸŸéƒ½å’Œä»–çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹äº’ç›¸æŒ‡å‘ï¼Œå°¾èŠ‚ç‚¹çš„nextæŒ‡å‘nilï¼Œé¦–èŠ‚ç‚¹çš„preæŒ‡å‘nil å®šä¹‰èŠ‚ç‚¹ 12345678910111213141516@interface DoubleLinkNode : NSObject@property (nonatomic,strong)id data; // æ•°æ®åŸŸ@property (nonatomic,weak,nullable)DoubleLinkNode * pre; // å‰é©±æŒ‡é’ˆåŸŸï¼ˆé˜²æ­¢å¾ªç¯å¼•ç”¨ï¼‰@property (nonatomic,strong,nullable)DoubleLinkNode * next; // åç»§æŒ‡é’ˆåŸŸ+ (instancetype)constructNodeWithData:(id)data;@end@implementation DoubleLinkNode+ (instancetype)constructNodeWithData:(id)data&#123; DoubleLinkNode * node = [[DoubleLinkNode alloc] init]; node.data = data; node.pre = nil; node.next = nil; return node;&#125;@end æ„å»ºä¸€ä¸ªåŒå‘é“¾è¡¨ 123456789// æ„é€ ä¸€ä¸ªåŒå‘é“¾è¡¨DoubleLinkNode * head = [[DoubleLinkNode alloc] init];DoubleLinkNode * node1 = [DoubleLinkNode constructNodeWithData:@1];DoubleLinkNode * node2 = [DoubleLinkNode constructNodeWithData:@2];head.next = node1;node1.pre = head;node1.next = node2;node2.pre = node1;[LinkInterface printDoubleFromHeadWithNode:head printPrefixText:@&quot;åŒé“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-24 13:38:50.045234+0800 å•é“¾è¡¨[50291:20937675] åŒé“¾è¡¨ä¸º:1â‡„2 åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹ 123456789101112131415161718// åŒå‘é“¾è¡¨ï¼šå‘å¤´éƒ¨æ’å…¥èŠ‚ç‚¹+ (void)insertDoubleNewNodeToHead:(DoubleLinkNode *)newNode headNode:(DoubleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode)&#123; return; &#125; // å¦‚æœåªæœ‰ä¸€ä¸ªå¤´èŠ‚ç‚¹ if(headNode.next == nil)&#123; headNode.next = newNode; newNode.pre = headNode; &#125;else &#123; newNode.next = headNode.next; // å½“å‰èŠ‚ç‚¹çš„åç»§æŒ‡å‘å¤´èŠ‚ç‚¹çš„åç»§ headNode.next.pre = newNode; // å¤´ç»“ç‚¹åç»§çš„å‰é©±æŒ‡å‘å½“å‰èŠ‚ç‚¹ newNode.pre = headNode; // å½“å‰èŠ‚ç‚¹çš„å‰é©±æŒ‡å‘å¤´ç»“ç‚¹ headNode.next = newNode; // å¤´ç»“ç‚¹çš„åç»§æŒ‡å‘å½“å‰èŠ‚ç‚¹ &#125;&#125; vcå®ç° 1234// åœ¨å¤´éƒ¨æ’å…¥èŠ‚ç‚¹DoubleLinkNode * node0 = [DoubleLinkNode constructNodeWithData:@0];[LinkInterface insertDoubleNewNodeToHead:node0 headNode:head];[LinkInterface printDoubleFromHeadWithNode:head printPrefixText:@&quot;åŒé“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœï¼š 12022-11-24 13:53:01.240605+0800 å•é“¾è¡¨[51484:20953802] åŒé“¾è¡¨ä¸º:0â‡„1â‡„2 åœ¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹ 1234567891011121314// åŒå‘é“¾è¡¨ï¼šå‘å°¾éƒ¨æ’å…¥èŠ‚ç‚¹+ (void)insertDoubleNewNodeToTail:(DoubleLinkNode *)newNode headNode:(DoubleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode)&#123; return; &#125; // è®¾ç½®åç§»æŒ‡é’ˆ DoubleLinkNode * pNode = headNode.next; while (pNode.next != nil) &#123; pNode = pNode.next; &#125; pNode.next = newNode; newNode.pre = pNode;&#125; vcå®ç° 1234// åœ¨å°¾éƒ¨æ’å…¥èŠ‚ç‚¹DoubleLinkNode * node4 = [DoubleLinkNode constructNodeWithData:@4];[LinkInterface insertDoubleNewNodeToTail:node4 headNode:head];[LinkInterface printDoubleFromHeadWithNode:head printPrefixText:@&quot;åŒå‘é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœ 12022-11-24 13:59:04.853558+0800 å•é“¾è¡¨[52038:20962187] åŒå‘é“¾è¡¨ä¸º:0â‡„1â‡„2â‡„4 åœ¨æŒ‡å®šä½ç½®æ’å…¥èŠ‚ç‚¹ 1234567891011121314151617181920212223242526272829// åŒå‘é“¾è¡¨ï¼šåœ¨æŒ‡å®šä½ç½®æ’å…¥èŠ‚ç‚¹+(void)insertDoubleNewNodeToIndex:(int)index newNode:(DoubleLinkNode *)newNode headNode:(DoubleLinkNode *)headNode&#123; if(!headNode)&#123; return; &#125; // å¦‚æœå¤´ç»“ç‚¹å³å°¾èŠ‚ç‚¹ if (headNode.next == nil)&#123; headNode.next = newNode; newNode.pre = headNode; &#125;else &#123; &#125; // å¦‚æœå¤´èŠ‚ç‚¹å³å°¾èŠ‚ç‚¹ if (headNode.next == nil)&#123; headNode.next = newNode; &#125;else &#123; // è®¾ç½®åç§»æŒ‡é’ˆ DoubleLinkNode * pNode = headNode.next; int i = 1; while (i &lt; index &amp;&amp; pNode.next != nil) &#123; pNode = pNode.next; i ++; &#125; newNode.next = pNode.next; pNode.next.pre = newNode; newNode.pre = pNode; pNode.next = newNode; &#125;&#125; vcå®ç° 1234// åœ¨æŒ‡å®šä½ç½®æ’å…¥èŠ‚ç‚¹DoubleLinkNode * node3 = [DoubleLinkNode constructNodeWithData:@3];[LinkInterface insertDoubleNewNodeToIndex:3 newNode:node3 headNode:head];[LinkInterface printDoubleFromHeadWithNode:head printPrefixText:@&quot;åŒå‘é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœ 12022-11-24 14:08:41.539116+0800 å•é“¾è¡¨[52850:20973592] åŒå‘é“¾è¡¨ä¸º:0â‡„1â‡„2â‡„3â‡„4 åˆ é™¤æŒ‡å®šä½ç½®èŠ‚ç‚¹ 1234567891011121314151617181920// åŒå‘é“¾è¡¨ï¼šåˆ é™¤æŒ‡å®šä½ç½®èŠ‚ç‚¹+ (DoubleLinkNode *)deleteDoubleNodeAtIndex:(int)index headNode:(DoubleLinkNode *)headNode&#123; // åˆ¤ç©ºå¤„ç† if(!headNode)&#123; return nil; &#125; // è®¾ç½®åç§»æŒ‡é’ˆ DoubleLinkNode * pNode = headNode.next; int i = 1; while (i &lt; index &amp;&amp; pNode.next != nil) &#123; pNode = pNode.next; i ++; &#125; if(i == index)&#123; pNode.pre.next = pNode.next; pNode.next.pre = pNode.pre; return pNode; &#125; return nil;&#125; vcå®ç° 123// åˆ é™¤æŒ‡å®šä½ç½®èŠ‚ç‚¹[LinkInterface deleteDoubleNodeAtIndex:1 headNode:head];[LinkInterface printDoubleFromHeadWithNode:head printPrefixText:@&quot;åŒå‘é“¾è¡¨ä¸º&quot;]; æ‰“å°ç»“æœ 12022-11-24 14:15:01.766124+0800 å•é“¾è¡¨[53365:20980542] åŒå‘é“¾è¡¨ä¸º:1â‡„2â‡„3â‡„4 éå†å¹¶æ‰“å°é“¾è¡¨ // åŒå‘é“¾è¡¨ï¼šéå†å¹¶æ‰“å°é“¾è¡¨ + (void)printDoubleFromHeadWithNode:(DoubleLinkNode *)headNode printPrefixText:(NSString *)text&#123; if(!headNode)&#123; return; &#125; DoubleLinkNode * pNode = headNode.next; NSMutableArray * items = [NSMutableArray array]; while (pNode != nil) &#123; [items addObject:pNode.data]; pNode = pNode.next; &#125; NSLog(@&quot;%@:%@&quot;,text,[items componentsJoinedByString:@&quot;â‡„&quot;]); &#125;","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.bboyzj.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"OC-æ•°æ®ç»“æ„æ¢ç´¢ç¯‡","slug":"OC-æ•°æ®ç»“æ„æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://www.bboyzj.cn/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"OCç®—æ³•03ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•03ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æ¢ç´¢","date":"2020-08-09T05:56:16.000Z","updated":"2023-03-06T10:44:55.267Z","comments":true,"path":"2020/08/09/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•03ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—æ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/09/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E7%AE%97%E6%B3%9503%EF%BC%9A%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"ç®€ä»‹æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆFibonacci sequenceï¼‰ï¼Œåˆç§°é»„é‡‘åˆ†å‰²æ•°åˆ—ã€å› æ•°å­¦å®¶è±æ˜‚çº³å¤šÂ·æ–æ³¢é‚£å¥‘ï¼ˆLeonardoda Fibonacciï¼‰ä»¥å…”å­ç¹æ®–ä¸ºä¾‹å­è€Œå¼•å…¥ï¼Œæ•…åˆç§°ä¸ºâ€œå…”å­æ•°åˆ—â€ï¼ŒæŒ‡çš„æ˜¯è¿™æ ·ä¸€ä¸ªæ•°åˆ—ï¼š0ã€1ã€1ã€2ã€3ã€5ã€8ã€13ã€21ã€34ã€â€¦â€¦åœ¨æ•°å­¦ä¸Šï¼Œæ–æ³¢é‚£å¥‘æ•°åˆ—ä»¥å¦‚ä¸‹è¢«ä»¥é€’æ¨çš„æ–¹æ³•å®šä¹‰ï¼šF(1)&#x3D;1ï¼ŒF(2)&#x3D;1, F(n)&#x3D;F(n - 1)+F(n - 2)ï¼ˆn â‰¥ 3ï¼Œn âˆˆ N*ï¼‰ï¼Œç”¨æ–‡å­—æ¥è¯´ï¼Œå°±æ˜¯æ–æ³¢é‚£å¥‘æ•°åˆ—ç”± 0 å’Œ 1 å¼€å§‹ï¼Œä¹‹åçš„æ–æ³¢é‚£å¥‘æ•°åˆ—ç³»æ•°å°±ç”± ä¹‹å‰çš„ä¸¤æ•°ç›¸åŠ ã€‚ æ’åˆ—ç»„åˆé—®ï¼šæœ‰ä¸€æ®µæ¥¼æ¢¯æœ‰10çº§å°é˜¶ï¼Œè§„å®šæ¯ä¸€æ­¥åªèƒ½è·¨ä¸€çº§æˆ–ä¸¤çº§ï¼Œè¦ç™»ä¸Šç¬¬ 10 çº§å°é˜¶æœ‰å‡ ç§ä¸åŒçš„èµ°æ³•? åˆ†æï¼šè¿™å°±æ˜¯ä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—ï¼šç™»ä¸Šç¬¬ä¸€çº§å°é˜¶æœ‰ä¸€ç§ç™»æ³•ï¼›ç™»ä¸Šä¸¤çº§å°é˜¶ï¼Œæœ‰ä¸¤ç§ç™»æ³•ï¼›ç™»ä¸Šä¸‰çº§å°é˜¶ï¼Œæœ‰ä¸‰ç§ç™»æ³•ï¼›ç™»ä¸Šå››çº§å°é˜¶ï¼Œæœ‰äº”ç§ç™»æ³•â€¦â€¦1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ8ï¼Œ13â€¦â€¦ æ‰€ä»¥ï¼Œç™»ä¸Šåçº§ï¼Œæœ‰ 89 ç§èµ°æ³•ã€‚ ç­”ï¼š 123456789101112131415161718192021- (void)demo&#123; // æœ‰10çº§å°é˜¶ NSInteger tjNum = 10; NSInteger total = [self getTotalNumOfMethods:tjNum]; NSLog(@&quot;total:%ld&quot;,total);&#125;- (NSInteger)getTotalNumOfMethods:(NSInteger)num&#123; if (num == 0) &#123; return 0; &#125; if (num == 1) &#123; return 1; &#125; if (num == 2) &#123; return 2; &#125; return [self getTotalNumOfMethods:num-1] + [self getTotalNumOfMethods:num - 2];&#125; æ‰“å°ç»“æœï¼š89 å…”å­ç¹æ®–é—®é¢˜æ–æ³¢é‚£å¥‘æ•°åˆ—åˆå› æ•°å­¦å®¶è±æ˜‚çº³å¤šÂ·æ–æ³¢é‚£å¥‘ä»¥å…”å­ç¹æ®–ä¸ºä¾‹å­è€Œå¼•å…¥ï¼Œæ•…åˆç§°ä¸ºâ€œå…”å­æ•°åˆ—â€ã€‚ é—®ï¼šä¸€èˆ¬è€Œè¨€ï¼Œå…”å­åœ¨å‡ºç”Ÿä¸¤ä¸ªæœˆåï¼Œå°±æœ‰ç¹æ®–èƒ½åŠ›ï¼Œä¸€å¯¹å…”å­æ¯ä¸ªæœˆèƒ½ç”Ÿå‡ºä¸€å¯¹å°å…”å­æ¥ã€‚å¦‚æœæ‰€æœ‰å…”å­éƒ½ä¸æ­»ï¼Œé‚£ä¹ˆä¸€å¹´ä»¥åå¯ä»¥ç¹æ®–å¤šå°‘å¯¹å…”å­ï¼Ÿ åˆ†æï¼šæˆ‘ä»¬ä¸å¦¨æ‹¿æ–°å‡ºç”Ÿçš„ä¸€å¯¹å°å…”å­åˆ†æä¸€ä¸‹ï¼šç¬¬ä¸€ä¸ªæœˆå°å…”å­æ²¡æœ‰ç¹æ®–èƒ½åŠ›ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸€å¯¹ ä¸¤ä¸ªæœˆåï¼Œç”Ÿä¸‹ä¸€å¯¹å°å…”å¯¹æ•°å…±æœ‰ä¸¤å¯¹ ä¸‰ä¸ªæœˆä»¥åï¼Œè€å…”å­åˆç”Ÿä¸‹ä¸€å¯¹ï¼Œå› ä¸ºå°å…”å­è¿˜æ²¡æœ‰ç¹æ®–èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸€å…±æ˜¯ä¸‰å¯¹ï¼ï¼ï¼ï¼ï¼ï¼ä¾æ¬¡ç±»æ¨å¯ä»¥åˆ—å‡ºä¸‹è¡¨ï¼š å¹¼ä»”å¯¹æ•°&#x3D;å‰æœˆæˆå…”å¯¹æ•°æˆå…”å¯¹æ•°&#x3D;å‰æœˆæˆå…”å¯¹æ•°+å‰æœˆå¹¼ä»”å¯¹æ•°æ€»ä½“å¯¹æ•°&#x3D;æœ¬æœˆæˆå…”å¯¹æ•°+æœ¬æœˆå¹¼ä»”å¯¹æ•°å¯ä»¥çœ‹å‡ºå¹¼ä»”å¯¹æ•°ã€æˆå…”å¯¹æ•°ã€æ€»ä½“å¯¹æ•°éƒ½æ„æˆäº†ä¸€ä¸ªæ•°åˆ—ã€‚è¿™ä¸ªæ•°åˆ—æœ‰å…³ååˆ†æ˜æ˜¾çš„ç‰¹ç‚¹ï¼Œé‚£æ˜¯ï¼šå‰é¢ç›¸é‚»ä¸¤é¡¹ä¹‹å’Œï¼Œæ„æˆäº†åä¸€é¡¹ã€‚ ç­”ï¼š 1234567891011121314151617181920- (void)demo1&#123; NSInteger month = 12; NSInteger tuTotal = [self getTuTotalNum:month]; NSLog(@&quot;tuTotal:%ld&quot;,tuTotal);&#125;- (NSInteger)getTuTotalNum:(NSInteger)month&#123; if (month == 0) &#123; return 1; &#125; if (month == 1) &#123; return 1; &#125; if (month == 2) &#123; return 2; &#125; return [self getTuTotalNum:month-1] + [self getTuTotalNum:month - 2];&#125; æ‰“å°ç»“æœï¼š233","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"OC-ç®—æ³•æ¢ç´¢ç¯‡","slug":"OC-ç®—æ³•æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E7%AE%97%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}]},{"title":"OCç®—æ³•02ï¼šæ’å…¥æ’åºæ¢ç´¢","slug":"OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•02ï¼šæ’å…¥æ’åºæ¢ç´¢","date":"2020-08-07T11:28:01.000Z","updated":"2023-03-06T10:39:36.281Z","comments":true,"path":"2020/08/07/OCæ•°æ®ç»“æ„å’Œç®—æ³•/OCç®—æ³•02ï¼šæ’å…¥æ’åºæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/07/OC%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/OC%E7%AE%97%E6%B3%9502%EF%BC%9A%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"åŸºæœ¬æ€æƒ³æ¯æ­¥å°†ä¸€ä¸ªå¾…æ’åºçš„å¯¹è±¡ï¼ŒæŒ‰å…¶å…³é”®ç å¤§å°ï¼Œæ’å…¥åˆ°å‰é¢å·²ç»æ’å¥½åºçš„ä¸€ç»„å¯¹è±¡çš„é€‚å½“ä½ç½®ä¸Šï¼Œç›´åˆ°å…¨éƒ¨å¯¹è±¡éƒ½æ’å…¥ä¸ºæ­¢ã€‚å³è¾¹æ’å…¥è¾¹æ’åºï¼Œä¿è¯å­åºåˆ—ä¸­éšæ—¶éƒ½æ˜¯æ’å¥½åºçš„ã€‚ åŸºæœ¬æ“ä½œæœ‰åºæ’å…¥ åœ¨æœ‰åºåˆ—åºåˆ—ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œä¿æŒåºåˆ—æœ‰åºï¼Œæœ‰åºé•¿åº¦ä¸æ–­å¢åŠ ã€‚ å¯ä»¥æ’å…¥åœ¨ä¸­é—´ã€æœ€å‰é¢å’Œæœ€åé¢ æ’å…¥æ’åºç§ç±» é¡ºåºæ³•å®šä½æ’å…¥ä½ç½® â€“ ç›´æ¥æ’å…¥æ’åº ç¼©å°å¢é‡å¤šéæ’å…¥æ’åº â€“ å¸Œå°”æ’åº ç›´æ¥æ’å…¥æ’åº åŸºæœ¬æ€è·¯ï¼šæ¯è½®æ’åºæŠŠæ•°ç»„åˆ†ä¸º2éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå·²æ’åºå¥½çš„æ•°ç»„ï¼Œä¸€éƒ¨åˆ†ä¸ºè¿˜æœªæ’åºå¥½çš„æ•°ç»„ã€‚æ¯æ¬¡å–å‡ºè¿˜æœªæ’åºå¥½çš„æ•°ç»„ä¸­é¦–å…ƒç´ ä¸å·²æ’åºå¥½çš„æ•°ç»„ä»å³å¾€å·¦æ¯”è¾ƒã€‚å¦‚æœå‘ç°ä»æœªæ’åºä¸­å–å‡ºçš„å…ƒç´ æ¯”ä»å·²æ’åºä¸­å–å‡ºçš„å…ƒç´ å¤§ï¼Œå°±æŠŠè¯¥æœªæ’åºçš„å…ƒç´ æ’å…¥åˆ°ä»å·²æ’åºä¸­å–å‡ºå…ƒç´ çš„åé¢ã€‚è¿™æ ·æ¯ä¸€è½®å°±èƒ½ç¡®å®šä¸€ä¸ªæœªæ’åºå…ƒç´ åœ¨å·²æ’åºæ•°ç»„ä¸­çš„å‡†ç¡®ä½ç½® ç®—æ³•æ€æƒ³ ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åº å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æ å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½® é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½® å°†æ–°å…ƒç´ æ’å…¥åˆ°ä¸‹ä¸€ä½ç½®ä¸­ é‡å¤æ­¥éª¤2~5 ç›´æ¥æ’å…¥æ’åºçš„æµç¨‹æ¼”ç¤º æµç¨‹ä¸¾ä¾‹: çº¢è‰²çš„ä¸ºå·²æ’åºéƒ¨åˆ†ï¼Œè“è‰²çš„ä¸ºæœªæ’åºéƒ¨åˆ† 1ï¼‰åŸå§‹æ•°æ®ï¼šé¦–å…ˆæŠŠåŸæ•°ç»„ä»ä¸‹åæ ‡1å¼€å§‹æ‹†åˆ†ä¸º2éƒ¨åˆ†ï¼Œ å·²æ’åºéƒ¨åˆ†(çº¢è‰²)ï¼Œæœªæ’åºéƒ¨åˆ†(è“è‰²)ã€‚é»˜è®¤åŸæ•°ç»„é¦–å…ƒç´ ä¸ºå·²æ’åºå…ƒç´ ã€‚ 2ï¼‰ç¬¬ä¸€è½®ï¼šæ¥ç€ç”¨åé¢æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å·²æ’åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè¿™é‡Œå‘ç°å·²æ’åºæœ€æœ«å°¾å…ƒç´ 5å°äºæœªæ’åºå…ƒç´ ç¬¬ä¸€ä¸ªå…ƒç´ 9.ä¸”å…ƒç´ 5ä½™å…ƒç´ 9çš„ä½ç½®æ˜¯ç›¸é‚»çš„ã€‚ä¸å‘ç”Ÿæ’å…¥ã€‚æŠŠå…ƒç´ 9åˆ—å…¥å·²æ’åºæ•°ç»„ä¸­ã€‚æ­¤æ—¶å·²æ’åºå¥½çš„å…ƒç´ å¤šäº†ä¸€ä¸ªã€‚ 3ï¼‰ç¬¬äºŒè½®ï¼šç„¶åæ¥ç€ç”¨åé¢æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å·²æ’åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè¿™é‡Œå‘ç°å·²æ’åºæœ€æœ«å°¾å…ƒç´ 9å¤§äºæœªæ’åºå…ƒç´ ç¬¬ä¸€ä¸ªå…ƒç´ 2ã€‚å¹¶ä¸”9ä¸æ˜¯å·²æ’åºå…ƒç´ æœ€å‰é¢ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å¿½ç•¥æœ¬æ¬¡æ“ä½œï¼Œè®©å…ƒç´ 2ä¸å·²æ’åºå…ƒç´ ä»å³å¾€å·¦çš„ä¸‹ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œæ­¤æ—¶å‘ç°å·²æ’åºå…ƒç´ 5å¤§äºå…ƒç´ 2ï¼Œä½†å‘ç°å…ƒç´ 5æ˜¯å·²æ’åºå…ƒç´ ä¸­é¦–ä¸ªå…ƒç´ ã€‚åˆ™ç›´æ¥æŠŠå…ƒç´ 2æ’å…¥åˆ°å…ƒç´ 5å‰é¢ã€‚ 4ï¼‰ç¬¬ä¸‰è½®æ’åºï¼šç”¨åé¢æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å·²æ’åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè¿™é‡Œå‘ç°å·²æ’åºæœ€æœ«å°¾å…ƒç´ 9å°äºæœªæ’åºå…ƒç´ ç¬¬ä¸€ä¸ªå…ƒç´ 15ã€‚ä¸”ä¸¤ä¸ªå…ƒç´ ç›¸é‚»ã€‚ä¸å‘ç”Ÿæ’å…¥ï¼ŒæŠŠå…ƒç´ 15åŠ å…¥å·²æ’åºéƒ¨åˆ†ã€‚ 5ï¼‰ç¬¬å››è½®æ’åºï¼šç”¨åé¢æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å·²æ’åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè¿™é‡Œå‘ç°å·²æ’åºæœ€æœ«å°¾å…ƒç´ 15å°äºæœªæ’åºå…ƒç´ ç¬¬ä¸€ä¸ªå…ƒç´ 46ã€‚ä¸”ä¸¤ä¸ªå…ƒç´ ç›¸é‚»ã€‚ä¸å‘ç”Ÿæ’å…¥ï¼ŒæŠŠå…ƒç´ 46åŠ å…¥å·²æ’åºéƒ¨åˆ†ã€‚ 6ï¼‰æœ€åï¼šä¾æ¬¡æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼é€’å½’æ’åºã€‚ç›´åˆ°æ‰€æœ‰å…ƒç´ æ’åºå®Œæˆã€‚ åˆ—å­: ä»£ç å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132- (void)viewDidLoad &#123; [super viewDidLoad]; NSMutableArray * arr = [NSMutableArray arrayWithArray:@[@15,@2,@5,@10,@20]]; // æ’å…¥æ’åºçš„åŸç†ï¼šå§‹ç»ˆå®šä¹‰ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæœ‰åºçš„ï¼Œå°†å…ƒç´ é€ä¸ªæ’å…¥åˆ°æœ‰åºçš„æ’åˆ—ä¸­ // å…¶ç‰¹ç‚¹æ˜¯ï¼šä¸æ–­çš„ç§»åŠ¨æ•°æ®ï¼Œç©ºå‡ºä¸€ä¸ªé€‚å½“çš„ä½ç½®ï¼ŒæŠŠå¾…æ’å…¥çš„å…ƒç´ æ”¾åˆ°é‡Œé¢å» for (int i = 0 ; i &lt; arr.count; i ++) &#123; // tempä¸ºå¾…æ’å…ƒç´ iä¸ºå…¶ä½ç½® NSNumber * temp = arr[i]; // jä¸ºå·²æ’å…ƒç´ æœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½® int j = i - 1; // å½“j&gt;=0æ—¶ï¼Œiä¸ºç¬¬ä¸€ä¸ªå¾…æ’å…ƒç´ ï¼Œå–å·²æ’å…ƒç´ å’Œå¾…æ’å…ƒç´ æ¯”è¾ƒï¼Œåœ¨å·²ç»æ’å¥½åºä¸­ä»åå‘å‰æ‰«æ while (j &gt;= 0 &amp;&amp; [arr[j] integerValue] &gt; [temp integerValue]) &#123; // å¦‚æœå·²ç»æ’å¥½åºçš„åºåˆ—ä¸­å…ƒç´ å¤§äºæ–°å…ƒç´ ï¼Œåˆ™å°†è¯¥å…ƒç´ å¾€å³ç§»åŠ¨ä¸€ä¸ªä½ç½® [arr replaceObjectAtIndex:j+1 withObject:arr[j]]; j --; &#125; // è·³å‡ºå¾ªç¯æ—¶ï¼Œjå·²æ’å…ƒç´ å°äºæˆ–ç­‰äºiçš„å…ƒç´ ï¼ˆå¾…æ’å…ƒç´ ï¼‰ã€‚æ’å…¥æ–°å…ƒç´ a[j+1] = tempï¼Œå³ç©ºå‡ºæ¥çš„ä½ç½®æ’å…¥å¾…æ’åºçš„å€¼ [arr replaceObjectAtIndex:j+1 withObject:temp]; NSLog(@&quot;æ’å…¥æ’åºæ’åºä¸­:%@&quot;,[self getArrayStr:arr]); &#125;&#125;// å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‹¼æ¥æˆå­—ç¬¦ä¸² - æ–¹ä¾¿æ‰“å°- (NSString *)getArrayStr:(NSArray *)array &#123; NSMutableString *strM = [NSMutableString string]; for (NSNumber *num in array) &#123; [strM appendString:[NSString stringWithFormat:@&quot;%@,&quot;,num]]; &#125; return strM.copy;&#125; æ‰“å°ç»“æœ: 123452020-08-07 21:30:38.316438+0800 C-ç›´æ¥æ’å…¥æ’åºç®—æ³•[3671:1382925] æ’å…¥æ’åºæ’åºä¸­:15,2,5,10,20,2020-08-07 21:30:38.316483+0800 C-ç›´æ¥æ’å…¥æ’åºç®—æ³•[3671:1382925] æ’å…¥æ’åºæ’åºä¸­:2,15,5,10,20,2020-08-07 21:30:38.316502+0800 C-ç›´æ¥æ’å…¥æ’åºç®—æ³•[3671:1382925] æ’å…¥æ’åºæ’åºä¸­:2,5,15,10,20,2020-08-07 21:30:38.316519+0800 C-ç›´æ¥æ’å…¥æ’åºç®—æ³•[3671:1382925] æ’å…¥æ’åºæ’åºä¸­:2,5,10,15,20,2020-08-07 21:30:38.316535+0800 C-ç›´æ¥æ’å…¥æ’åºç®—æ³•[3671:1382925] æ’å…¥æ’åºæ’åºä¸­:2,5,10,15,20, ç®—æ³•åˆ†æ ç›´æ¥æ’å…¥æ’åºçš„ç®—æ³•æ€§èƒ½ æ—¶é—´å¤æ‚åº¦ æœ€å¥½çš„æƒ…å†µï¼ˆå…³é”®å­—åœ¨è®°å½•ä¸­é¡ºåºæœ‰åºï¼‰ï¼š å½“å…ƒç´ çš„åˆå§‹åºåˆ—ä¸ºæ­£åºæ—¶ï¼Œä»…å¤–å¾ªç¯è¦è¿›è¡Œn-1è¶Ÿæ’åºä¸”æ¯ä¸€è¶Ÿåªè¿›è¡Œä¸€æ¬¡æ¯”è¾ƒï¼Œæ²¡æœ‰è¿›å…¥ifè¯­å¥ä¸å­˜åœ¨å…ƒç´ ä¹‹é—´çš„äº¤æ¢(ç§»åŠ¨)ã€‚æ­¤æ—¶æ¯”è¾ƒæ¬¡æ•°(Cmin)å’Œç§»åŠ¨æ¬¡æ•°(Mmin)è¾¾åˆ°æœ€å°å€¼ã€‚ æ­¤æ—¶æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚ 12æ¯”è¾ƒæ¬¡æ•°ï¼šCmin = n-1;ç§»åŠ¨æ¬¡æ•°ï¼šMmin = 0; ä¸¾ä¾‹ï¼š å¦‚ï¼š1 2 3 4 5æ¯”è¾ƒï¼š æ¬¡æ•° ç§»åŠ¨ç¬¬2ä¸ªå…ƒç´ å’Œç¬¬ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒ 1 0ç¬¬3ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªå…ƒç´ æ¯”è¾ƒ 1 0â€¦ç¬¬nä¸ªå…ƒç´ å’Œç¬¬n-1ä¸ªå…ƒç´ æ¯”è¾ƒ 1 0æ¯”è¾ƒçš„æ¬¡æ•°ï¼šn-1ç§»åŠ¨çš„æ¬¡æ•°ï¼š0 æœ€åçš„æƒ…å†µï¼ˆå…³é”®å­—åœ¨è®°å½•åºåˆ—ä¸­é€†åºæœ‰åºï¼‰ï¼š æœ€å·®å°±æ˜¯é€†åºã€‚æ¯è¶Ÿæ’åºä¸­å¾…æ’å…¥çš„å…ƒç´ éƒ½è¦å’Œ[0,i-1]ä¸­çš„iä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒä¸”è¦å°†è¿™iä¸ªå…ƒç´ åç§»ï¼Œiä¸ªå…ƒç´ åç§»ç§»åŠ¨æ¬¡æ•°å½“ç„¶ä¹Ÿå°±ä¸ºiäº†ï¼Œå†åŠ ä¸Štemp &#x3D; arr[i]ä¸arr[j+1] &#x3D; tempçš„ä¸¤æ¬¡ç§»åŠ¨ï¼Œæ¯è¶Ÿç§»åŠ¨çš„æ¬¡æ•°ä¸ºi+2,æ­¤æ—¶æ¯”è¾ƒæ¬¡æ•°(Cmin)å’Œç§»åŠ¨æ¬¡æ•°(Mmin)è¾¾åˆ°æœ€å°å€¼ã€‚ æ­¤æ—¶æ—¶é—´å¤æ‚åº¦ä¸ºO(n2)ã€‚ 12Cmax = 1+2+...+(n-1) = n*(n-1)/2 = O(n2)Mmax = (1+2)+(2+2)+...+(n-1+2) = (n-1)*(n+4)/2 = O(n2) (iå–å€¼èŒƒå›´1~n-1) ä¾‹å­ï¼š å¦‚ï¼š5 4 3 2 1æ¯”è¾ƒï¼š æ¬¡æ•° ç§»åŠ¨ç¬¬2ä¸ªå…ƒç´ å’Œç¬¬1ä¸ªå…ƒç´ æ¯”è¾ƒ 1 1+2ç¬¬3ä¸ªå…ƒç´ å’Œå‰2ä¸ªå…ƒç´ æ¯”è¾ƒ 2 2+2â€¦ç¬¬nä¸ªå…ƒç´ å’Œå‰n-1ä¸ªæ¯”è¾ƒ n-1 n-1+2æœ€åï¼š æŠŠ1+2+â€¦+n-1åŠ èµ·æ¥æ±‚å¹³å‡å€¼æ¯”è¾ƒçš„æ¬¡æ•°ï¼š1+2+â€¦+n-1 &#x3D; (n+2)(n-1)&#x2F;2ç§»åŠ¨çš„æ¬¡æ•°ï¼š(1+2)+(2+2)+â€¦+(n-1+2) &#x3D; (n-1)*(n+4)&#x2F;2 &#x3D; O(n2) (iå–å€¼èŒƒå›´1~n-1) äº‹ä»¶å¤æ‚åº¦ç»“è®ºï¼šåŸå§‹æ•°æ®è¶Šæ¥è¿‘æœ‰åºï¼Œæ’åºé€Ÿåº¦è¶Šå¿« 1ï¼‰æœ€å¥½çš„æƒ…å†µä¸‹ï¼ˆé¡ºåºæœ‰åºï¼‰ï¼šO(n)2ï¼‰æœ€åçš„æƒ…å†µä¸‹ï¼ˆé€†åºæœ‰åºï¼‰ï¼šO(n^2)3ï¼‰å¹³å‡æƒ…å†µä¸‹ï¼Œè€—æ—¶å·®ä¸å¤šæ˜¯æœ€åæƒ…å†µçš„ä¸€èˆ¬ï¼šO(n^2)4ï¼‰è¦æé«˜æŸ¥æ‰¾é€Ÿåº¦ å‡å°‘å…ƒç´ çš„æ¯”è¾ƒæ¬¡æ•°å‡å°‘å…ƒç´ çš„ç§»åŠ¨æ¬¡æ•° ç©ºé—´å¤æ‚åº¦ ç”±ç›´æ¥æ’å…¥æ’åºç®—æ³•å¯çŸ¥ï¼Œæˆ‘ä»¬åœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸€ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨è¦æ’å…¥çš„å€¼ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸º O(1) ã€‚ ç®—æ³•ç¨³å®šæ€§ ç›´æ¥æ’å…¥æ’åºçš„è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦æ”¹å˜ç›¸ç­‰æ•°å€¼å…ƒç´ çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒæ˜¯ç¨³å®šçš„ç®—æ³•ã€‚ æ’å…¥æ’åºå’Œé€‰æ‹©æ’åºçš„åŒºåˆ« æ’å…¥æ’åºå’Œé€‰æ‹©æ’åºéƒ½æœ‰ä¸¤å±‚å¾ªç¯ï¼Œå¤–å¾ªç¯éå†æ•´ä¸ªæ•°ç»„ å†…å¾ªç¯ç¨æœ‰åŒºåˆ«ï¼š é€‰æ‹©æ’åºçš„å†…å¾ªç¯æ˜¯éå†ä¸€ç»„æœªæ’è¿‡åºçš„æ•°ç»„ã€‚ æ’å…¥æ’åºçš„å†…å¾ªç¯æ˜¯éå†ä¸€ç»„å·²æ’è¿‡åºçš„æ•°ç»„ã€‚ å¸Œå°”æ’åº ç®€ä»‹ å¸Œå°”æ’åº(Shell Sort)ï¼Œä¸€å¬è¿™åå­—å°±çŸ¥é“æ˜¯ä¸€ä¸ªå«å¸Œå°”çš„å¤–å›½äººå‘æ˜çš„æ’åºã€‚æ²¡é”™ï¼Œä»–å°±æ˜¯å”çº³å¾· å¸Œå°”ï¼ˆDonald Shellï¼‰ï¼Œä¸€ä½ç¾å›½çš„è®¡ç®—æœºç§‘å­¦å®¶ï¼Œä»–äº1959å¹´å‘æ˜çš„å¸Œå°”æ’åºç®—æ³•ã€‚ å¸Œå°”æ’åºæ€è·¯ å¸Œå°”æ’åºç›¸å½“äº ç›´æ¥æ’å…¥æ’åºçš„åŠ å¼ºç‰ˆï¼Œåœ¨ç›´æ¥æ’å…¥æ’åºçš„æ¦‚å¿µä¹‹ä¸ŠåŠ å…¥äº† å¢é‡ è¿™ä¸ªæ¦‚å¿µã€‚ ä»€ä¹ˆæ˜¯å¢é‡ï¼Ÿ æ’å…¥æ’åºåªèƒ½ä¸ç›¸é‚»çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè€Œå¸Œå°”æ’åºåˆ™æ˜¯è¿›è¡Œ è·³è·ƒ æ¯”è¾ƒï¼Œè€Œ å¢é‡ å°±æ˜¯ è·³è·ƒçš„ é—´éš”æ•°ã€‚ æ‰€è°“å¢é‡å³æ˜¯æŠŠæ•°ç»„æŒ‰ç…§ä¸€å®šé—´éš”æ•°åˆ†ç»„æˆä¸åŒçš„æ•°ç»„ã€‚ä¾‹å¦‚:@{1,2,3,4,5,6,7},ä¸€å…±æœ‰6ä¸ªå…ƒç´ ï¼Œå‡è®¾æŠŠæ•°ç»„æŒ‰ç…§å¢é‡3è¿›è¡Œåˆ†ç»„ï¼Œé‚£ä¹ˆå°±æ˜¯@{1,4,7},@{2,5},@{3,6}å„åˆ†ä¸ºä¸€ç»„ã€‚å› ä¸ºå¢é‡æ˜¯3ï¼Œæ‰€ä»¥æ¯é—´éš”3ä¸ªä¸‹åæ ‡ä¸ºä¸€ç»„ã€‚ æŒ‰ç…§å¢é‡åˆ†ç»„åï¼ŒæŠŠæ¯ä¸€ç»„çš„å…ƒç´ æŒ‰ç…§æ’å…¥æ’åºè¿›è¡Œæ’åºã€‚å½“æŒ‰ç…§ä¸€ä¸ªå¢é‡åˆ†ç»„å®Œæˆå¹¶æ¯ç»„æ•°æ®æŒ‰ç…§æ’å…¥æ’åºå®Œæˆåï¼Œå°†å¢é‡è®¾ä¸ºåŸæœ¬çš„äºŒåˆ†ä¹‹ä¸€ï¼Œç„¶åé‡å¤ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œæ’å…¥æ’åºã€‚ç›´åˆ°å¢é‡ä¸º1ï¼ŒæŒ‰ç…§å¢é‡ä¸º1çš„æœ€åä¸€æ¬¡è¿›è¡Œåˆ†ç»„æ’å…¥æ’åºã€‚å³å®Œæˆäº†æ’åºã€‚ å¸Œå°”æ’åºçš„æµç¨‹æ¼”ç¤º åŸå§‹æ•°æ®ï¼š@[@(11),@(10),@(9),@(8),@(7),@(6),@(5),@(4),@(3),@(2),@(1)] ç¬¬ä¸€æ¬¡åˆ†ç»„ï¼š ç¬¬ä¸€æ­¥ï¼Œæ•°ç»„ä¸­æœ‰11ä¸ªå…ƒç´ ï¼ŒæŠŠæ•°ç»„é™¤ä»¥äºŒï¼Œå¾—åˆ°5(11&#x2F;2å®é™…æ˜¯ç­‰äº5ä½™1ï¼Œç”±äºå–æ­£æ‰€ä»¥ä¸º5ï¼Œç”±äºæœ‰ä½™æ•°ï¼Œæ‰€ä»¥æŒ‰ç…§å¢é‡å–å‡ºæ¥çš„æ•°ç»„çš„ ç»„æ•° æœ‰ å¢é‡+1 å³ 5 + 1 = 6ç»„ã€‚å¦‚æœæ²¡æœ‰ä½™æ•°åˆ™ç»„æ•°å°±æ˜¯å¢é‡æ•°ã€‚)ï¼Œä»¥5ä¸ºå¢é‡ï¼Œä»æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯é—´éš”5ä¸ªæ•°å–å‡ºæ¥çš„æ‰€æœ‰å…ƒç´ åˆ†ä¸ºä¸€ç»„ï¼Œåˆ†ä¸º6ç»„ï¼Œåˆ†åˆ«æ˜¯ï¼š@{11,7}ã€@{10,4}ã€@{9,3}ã€@{8,2}ã€@{5,1}ã€@{6} ç¬¬ä¸€æ¬¡æ’åºï¼šæ¯ç§é¢œè‰²ä¸ºä¸€ç»„ã€‚æ¥ç€å¯¹æ¯ç»„è¿›è¡Œæ’å…¥æ’åº(å…·ä½“æ¯”è¾ƒè¿‡ç¨‹å°±ä¸è¯´äº†ï¼Œçœ‹è¿‡ä¸Šé¢æ’å…¥æ’åºçš„åº”è¯¥æ‡‚)ï¼Œæ’åºç»“æœä¸ºä¸‹å›¾(å…±äº¤æ¢5æ¬¡):@{7,11}ã€@{4,10}ã€@{3,9}ã€@{2,8}ã€@{1,5}ã€@{6} 2)ç¬¬äºŒæ¬¡åˆ†ç»„ï¼šå°†å¢é‡5å†æ¬¡é™¤ä»¥2ï¼Œå¾—åˆ°2(å®é™…5&#x2F;2æ˜¯ç­‰äº2ä½™1ï¼Œæœ‰ä½™æ•°æ‰€ä»¥ç»„æ•°ä¸º3)ã€‚åˆ†ä¸º3ç»„åˆ†åˆ«æ˜¯:@{7,2,11,8}ã€@{4,1,10,5}ã€@{3,6,9} ç¬¬äºŒæ¬¡æ’åºï¼šæ¯ç§é¢œè‰²ä¸ºä¸€ç»„ï¼Œå¯¹æ¯ç»„å…ƒç´ è¿›è¡Œæ’å…¥æ’åºã€‚æ’åºç»“æœä¸º(å…±äº¤æ¢4æ¬¡)@{2,7,8,11}ã€@{1,4,5,10}ã€@{3,6,9} 3)ç¬¬ä¸‰æ¬¡åˆ†ç»„ï¼šå°†å¢é‡2å†æ¬¡é™¤ä»¥1ï¼Œå¾—åˆ°1(å®é™…2&#x2F;2ç­‰1ï¼Œæ²¡æœ‰ä½™æ•°ï¼Œæ‰€ä»¥åˆ†ä¸º1ç»„)ã€‚åˆ†ç»„åæ˜¯@{2,1,3,7,4,6,8,5,9,11,10} ç¬¬ä¸‰æ¬¡æ’åºï¼šæœ€åå¯¹æ•´ç»„æ•°ç»„è¿›è¡Œæ’å…¥æ’åºï¼Œæ’åºç»“æœä¸º(å…±äº¤æ¢7æ¬¡)ï¼š å¸Œå°”æ’åºçš„ç‰¹ç‚¹ 1ï¼‰ä¸€æ¬¡ç§»åŠ¨ï¼Œç§»åŠ¨ä½ç½®æ¯”è¾ƒå¤§ï¼Œè·³è·ƒå¼åœ°æ¥è¿‘æ’åºåçš„æœ€ç»ˆä½ç½®2ï¼‰æœ€åä¸€æ¬¡åªéœ€è¦å°‘é‡ç§»åŠ¨3ï¼‰å¢é‡åºåˆ—å¿…é¡»æ˜¯é€’å‡çš„ï¼Œæœ€åä¸€ä¸ªå¿…é¡»æ˜¯14ï¼‰å¢é‡åºåˆ—åº”è¯¥æ˜¯äº’è´¨çš„ å®ä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940- (void)viewDidLoad &#123; [super viewDidLoad]; NSMutableArray * arr = [NSMutableArray arrayWithArray:@[@(9),@(3),@(8),@(5),@(2),@(4),@(7),@(6),@(1)]]; [self shellSort:arr];&#125;- (void)shellSort:(NSMutableArray *)list&#123; // èµ·å§‹é—´éš”å€¼gapè®¾ç½®ä¸ºæ€»æ•°çš„ä¸€åŠ int gap = (int)list.count / 2; // ç›´åˆ°gap==1ç»“æŸ while (gap &gt;= 1) &#123; //iä¸ºå¾…æ’å…ƒç´ ï¼Œä»¥æ­¥è·gapä»åå‘å‰æ‰«æ for(int i = gap ; i &lt; [list count]; i++)&#123; //tempä¸ºå¾…æ’å…ƒç´ iä¸ºå…¶ä½ç½® NSInteger temp = [[list objectAtIndex:i] intValue]; //è·å–å½“å‰ä½ç½® int j = i; //ç„¶åå°†æ­¤ä½ç½®ä¹‹å‰çš„å…ƒç´ ï¼ŒæŒ‰ç…§å¢é‡è¿›è¡Œè·³è·ƒå¼æ¯”è¾ƒ while (j &gt;= gap &amp;&amp; temp &lt; [[list objectAtIndex:(j - gap)] intValue]) &#123; [list replaceObjectAtIndex:j withObject:[list objectAtIndex:j-gap]]; j -= gap; &#125; //è·³å‡ºå¾ªç¯æ—¶ï¼Œjå…ƒç´ å°äºiçš„å…ƒç´ ï¼ˆå¾…æ’å…ƒç´ ï¼‰ã€‚æ’å…¥æ–°å…ƒç´ a[j] = tempï¼Œå³ç©ºå‡ºæ¥çš„ä½ç½®æ’å…¥å¾…æ’åºçš„å€¼ [list replaceObjectAtIndex:j withObject:[NSNumber numberWithInteger:temp]]; &#125; NSLog(@&quot;æ­¥é•¿ï¼š%d --- å¸Œå°”æ’åº:%@&quot;,gap,[self getArrayStr:list]); //æ­¥é•¿ gap = gap / 2; &#125;&#125;// å°†æ•°ç»„ä¸­çš„å…ƒç´ æ‹¼æ¥æˆå­—ç¬¦ä¸² - æ–¹ä¾¿æ‰“å°- (NSString *)getArrayStr:(NSArray *)array &#123; NSMutableString *strM = [NSMutableString string]; for (NSNumber *num in array) &#123; [strM appendString:[NSString stringWithFormat:@&quot;%@,&quot;,num]]; &#125; return strM.copy;&#125; æ‰“å°ç»“æœ 1232020-08-09 22:02:14.160098+0800 OC-å“ˆå¸Œæ’åº[23997:1116332] æ­¥é•¿ï¼š4 --- å¸Œå°”æ’åº:1,3,7,5,2,4,8,6,9,2020-08-09 22:02:14.160373+0800 OC-å“ˆå¸Œæ’åº[23997:1116332] æ­¥é•¿ï¼š2 --- å¸Œå°”æ’åº:1,3,2,4,7,5,8,6,9,2020-08-09 22:02:14.160620+0800 OC-å“ˆå¸Œæ’åº[23997:1116332] æ­¥é•¿ï¼š1 --- å¸Œå°”æ’åº:1,2,3,4,5,6,7,8,9, å¸Œå°”æ’åºç®—æ³•åˆ†æï¼š 1ï¼‰å¸Œå°”æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸å¢é‡çš„é€‰å–æœ‰å…³ã€‚ä¾‹å¦‚ï¼Œå½“å¢é‡ä¸º1æ—¶ï¼Œå¸Œå°”æ’åºé€€åŒ–æˆäº†ç›´æ¥æ’å…¥æ’åºï¼Œæ­¤æ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(NÂ²)ï¼Œè€ŒHibbardå¢é‡çš„å¸Œå°”æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N3&#x2F;2)ã€‚2ï¼‰ç©ºé—´å¤æ‚åº¦ï¼šO(1)3ï¼‰æ˜¯ä¸€ç§ä¸ç¨³å®šçš„æ’åºç®—æ³•ï¼š","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"OC-ç®—æ³•æ¢ç´¢ç¯‡","slug":"OC-ç®—æ³•æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/tags/OC-%E7%AE%97%E6%B3%95%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"keywords":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://www.bboyzj.cn/categories/%E7%AE%97%E6%B3%95/"}]},{"title":"OCä¸‰æ–¹æ¡†æ¶05ï¼šMLeaksFinderå†…å­˜æ³„éœ²æ¢ç´¢","slug":"OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–01.1ï¼šMLeaksFinderå†…å­˜æ³„éœ²æ£€æµ‹","date":"2020-08-05T09:08:27.000Z","updated":"2023-03-08T22:57:45.466Z","comments":true,"path":"2020/08/05/OCæ€§èƒ½ä¼˜åŒ–/æ€§èƒ½ä¼˜åŒ–01.1ï¼šMLeaksFinderå†…å­˜æ³„éœ²æ£€æµ‹/","link":"","permalink":"https://www.bboyzj.cn/2020/08/05/OC%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%9601.1%EF%BC%9AMLeaksFinder%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E6%A3%80%E6%B5%8B/","excerpt":"","text":"å‰è¨€ è…¾è®¯å¼€æºäº†ä¸šç•Œé¦–åˆ› iOSè‡ªåŠ¨å†…å­˜æ³„éœ²æ£€æµ‹å·¥å…· MLeaksFinderï¼ŒMLeaksFinder æ˜¯ iOS å¹³å°çš„è‡ªåŠ¨å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ï¼Œå¼•è¿›MLeaksFinder åï¼Œå°±å¯ä»¥åœ¨æ—¥å¸¸çš„å¼€å‘ï¼Œè°ƒè¯•ä¸šåŠ¡é€»è¾‘çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨åœ°å‘ç°å¹¶è­¦å‘Šå†…å­˜æ³„æ¼ã€‚ å¹³å¸¸æˆ‘ä»¬éƒ½ä¼šç”¨ Instrument çš„ Leaks / Allocations æˆ–å…¶ä»–ä¸€äº›å¼€æºåº“è¿›è¡Œå†…å­˜æ³„éœ²çš„æ’æŸ¥ï¼Œä½†å®ƒä»¬éƒ½å­˜åœ¨å„ç§é—®é¢˜å’Œä¸ä¾¿ï¼Œæˆ‘ä»¬é€ä¸ªæ¥çœ‹è¿™äº›å·¥å…·çš„ä½¿ç”¨å’Œå­˜åœ¨çš„é—®é¢˜ã€‚ æ— éœ€ä¿®æ”¹ä»»ä½•ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œè€Œä¸”åªåœ¨ debug ä¸‹å¼€å¯ï¼Œå®Œå…¨ä¸å½±å“ä½ çš„ release åŒ…ã€‚ ç®€ä»‹MLeaksFinder æ˜¯ iOS å¹³å°çš„è‡ªåŠ¨å†…å­˜æ³„æ¼æ£€æµ‹å·¥å…·ï¼Œå¼•è¿› MLeaksFinder åï¼Œå°±å¯ä»¥åœ¨æ—¥å¸¸çš„å¼€å‘ï¼Œè°ƒè¯•ä¸šåŠ¡é€»è¾‘çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨åœ°å‘ç°å¹¶è­¦å‘Šå†…å­˜æ³„æ¼ã€‚å¼€å‘è€…æ— éœ€æ‰“å¼€ instrument ç­‰å·¥å…·ï¼Œä¹Ÿæ— éœ€ä¸ºäº†æ‰¾å†…å­˜æ³„æ¼è€Œå»è·‘é¢å¤–çš„æµç¨‹ã€‚å¹¶ä¸”ï¼Œç”±äºå¼€å‘è€…æ˜¯åœ¨ä¿®æ”¹ä»£ç ä¹‹åä¸€è·‘ä¸šåŠ¡é€»è¾‘å°±èƒ½å‘ç°å†…å­˜æ³„æ¼çš„ï¼Œè¿™ä½¿å¾—å¼€å‘è€…èƒ½å¾ˆå¿«åœ°æ„è¯†åˆ°æ˜¯å“ªé‡Œçš„ä»£ç å†™å¾—é—®é¢˜ã€‚è¿™ç§åŠæ—¶çš„å†…å­˜æ³„æ¼çš„å‘ç°åœ¨å¾ˆå¤§çš„ç¨‹åº¦ä¸Šé™ä½äº†ä¿®å¤å†…å­˜æ³„æ¼çš„æˆæœ¬ã€‚ Leakså…ˆçœ‹çœ‹ Leaksï¼Œä»è‹¹æœçš„å¼€å‘è€…æ–‡æ¡£é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ª app çš„å†…å­˜åˆ†ä¸‰ç±»ï¼š Leaked memory: Memory unreferenced by your application that cannot be used again or freed (also detectable by using the Leaks instrument). çœŸæ­£çš„å†…å­˜æ³„æ¼:åœ¨ç¬¬ä¸€æ¬¡ pop çš„æ—¶å€™æŠ¥ Memory Leakï¼Œåœ¨ä¹‹åçš„é‡å¤ push å¹¶ pop åŒä¸€ä¸ª ViewController è¿‡ç¨‹ä¸­ï¼Œä¸æŠ¥ Object Deallocatedï¼Œä½†æ¯æ¬¡ pop ä¹‹ååˆæŠ¥ Memory Leakã€‚è¿™ç§æƒ…å†µä¸‹æ¯å›è¿›å…¥å¹¶é€€å‡ºä¸€ä¸ªé¡µé¢åï¼Œå°±æŠ¥æœ‰æ–°çš„å†…å­˜æ³„æ¼ï¼ŒåŒæ—¶è¢«æŠ¥æ³„æ¼çš„å¯¹è±¡åˆä»æ¥æ²¡æœ‰é‡Šæ”¾è¿‡ï¼Œå¯ä»¥ç¡®å®šæ˜¯çœŸæ­£çš„å†…å­˜æ³„æ¼ã€‚ Abandoned memory: Memory still referenced by your application that has no useful purpose. é‡Šæ”¾ä¸åŠæ—¶ï¼šåœ¨ç¬¬ä¸€æ¬¡ pop çš„æ—¶å€™æŠ¥ Memory Leakï¼Œåœ¨ä¹‹åçš„é‡å¤ push å¹¶ pop åŒä¸€ä¸ª ViewController è¿‡ç¨‹ä¸­ï¼Œå¯¹äºåŒä¸€ä¸ªç±»ä¸æ–­åœ°æŠ¥ Object Deallocated å’Œ Memory Leakã€‚è¿™ç§æƒ…å†µå±äºé‡Šæ”¾ä¸åŠæ—¶çš„æƒ…å†µã€‚ Cached memory: Memory still referenced by your application that might be used again for better performance. å•ä¾‹æˆ–è€…è¢« cache èµ·æ¥å¤ç”¨ï¼šåœ¨ç¬¬ä¸€æ¬¡ pop çš„æ—¶å€™æŠ¥ Memory Leakï¼Œåœ¨ä¹‹åçš„é‡å¤ push å¹¶ pop åŒä¸€ä¸ª ViewController è¿‡ç¨‹ä¸­ï¼Œå³ä¸æŠ¥ Object Deallocatedï¼Œä¹Ÿä¸æŠ¥ Memory Leakã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ç¡®å®šè¯¥å¯¹è±¡è¢«è®¾è®¡æˆå•ä¾‹æˆ–è€… cache èµ·æ¥äº†ã€‚ æ€»ç»“ï¼šå…¶ä¸­ Leaked memory å’Œ Abandoned memory éƒ½å±äºåº”è¯¥é‡Šæ”¾è€Œæ²¡é‡Šæ”¾çš„å†…å­˜ï¼Œéƒ½æ˜¯å†…å­˜æ³„éœ²ï¼Œè€Œ Leaks å·¥å…·åªè´Ÿè´£æ£€æµ‹ Leaked memoryï¼Œè€Œä¸ç®¡ Abandoned memoryã€‚åœ¨ MRC æ—¶ä»£ Leaked memory å¾ˆå¸¸è§ï¼Œå› ä¸ºå¾ˆå®¹æ˜“å¿˜äº†è°ƒç”¨ releaseï¼Œä½†åœ¨ ARC æ—¶ä»£æ›´å¸¸è§çš„å†…å­˜æ³„éœ²æ˜¯å¾ªç¯å¼•ç”¨å¯¼è‡´çš„ Abandoned memoryï¼ŒLeaks å·¥å…·æŸ¥ä¸å‡ºè¿™ç±»å†…å­˜æ³„éœ²ï¼Œåº”ç”¨æœ‰é™ã€‚ Allocationså¯¹äº Abandoned memoryï¼Œå¯ä»¥ç”¨ Instrument çš„ Allocations æ£€æµ‹å‡ºæ¥ã€‚æ£€æµ‹æ–¹æ³•æ˜¯ç”¨ Mark Generation çš„æ–¹å¼ï¼Œå½“ä½ æ¯æ¬¡ç‚¹å‡» Mark Generation æ—¶ï¼ŒAllocations ä¼šç”Ÿæˆå½“å‰ App çš„å†…å­˜å¿«ç…§ï¼Œè€Œä¸” Allocations ä¼šè®°å½•ä»ä¸Šå›å†…å­˜å¿«ç…§åˆ°è¿™æ¬¡å†…å­˜å¿«ç…§è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œæ–°åˆ†é…çš„å†…å­˜ä¿¡æ¯ã€‚ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š æˆ‘ä»¬å¯ä»¥ä¸æ–­é‡å¤ push å’Œ pop åŒä¸€ä¸ª UIViewControllerï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œpush ä¹‹å‰è·Ÿ pop ä¹‹åï¼Œapp ä¼šå›åˆ°ç›¸åŒçš„çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨ push è¿‡ç¨‹ä¸­æ–°åˆ†é…çš„å†…å­˜ï¼Œåœ¨ pop ä¹‹ååº”è¯¥è¢« dealloc æ‰ï¼Œé™¤äº†å‰å‡ æ¬¡ push å¯èƒ½æœ‰é¢„çƒ­æ•°æ®å’Œ cache æ•°æ®çš„æƒ…å†µã€‚å¦‚æœåœ¨æ•°æ¬¡ push è·Ÿ pop ä¹‹åï¼Œå†…å­˜è¿˜ä¸æ–­å¢é•¿ï¼Œåˆ™æœ‰å†…å­˜æ³„éœ²ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ¯å› push ä¹‹å‰è·Ÿ pop ä¹‹åï¼Œéƒ½ Mark Generation ä¸€ä¸‹ï¼Œä»¥æ­¤è§‚å¯Ÿå†…å­˜æ˜¯ä¸æ˜¯æ— é™åˆ¶å¢é•¿ã€‚ ç”¨è¿™ç§æ–¹æ³•æ¥å‘ç°å†…å­˜æ³„éœ²è¿˜æ˜¯å¾ˆä¸æ–¹ä¾¿çš„ï¼š é¦–å…ˆï¼Œä½ å¾—æ‰“å¼€ Allocations å…¶æ¬¡ï¼Œä½ å¾—ä¸€ä¸ªä¸ªåœºæ™¯å»é‡å¤çš„æ“ä½œ æ— æ³•åŠæ—¶å¾—çŸ¥æ³„éœ²ï¼Œå¾—ä¸“é—¨åšä¸€éä¸Šè¿°æ“ä½œï¼Œååˆ†ç¹ç MLeaksFinderä»‹ç»MLeaksFinder æä¾›äº†å†…å­˜æ³„éœ²æ£€æµ‹æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚åªéœ€è¦å¼•å…¥ MLeaksFinderï¼Œå°±å¯ä»¥è‡ªåŠ¨åœ¨ App è¿è¡Œè¿‡ç¨‹æ£€æµ‹åˆ°å†…å­˜æ³„éœ²çš„å¯¹è±¡å¹¶ç«‹å³æé†’ï¼Œæ— éœ€æ‰“å¼€é¢å¤–çš„å·¥å…·ï¼Œä¹Ÿæ— éœ€ä¸ºäº†æ£€æµ‹å†…å­˜æ³„éœ²è€Œä¸€ä¸ªä¸ªåœºæ™¯å»é‡å¤åœ°æ“ä½œã€‚MLeaksFinder ç›®å‰èƒ½è‡ªåŠ¨æ£€æµ‹ UIViewController å’Œ UIView å¯¹è±¡çš„å†…å­˜æ³„éœ²ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥æ‰©å±•ä»¥æ£€æµ‹å…¶å®ƒç±»å‹çš„å¯¹è±¡ã€‚ å½“å‘ç”Ÿå†…å­˜æ³„éœ²æ—¶ï¼ŒMLeaksFinder ä¼šä¸­æ–­è¨€ï¼Œå¹¶å‡†ç¡®çš„å‘Šè¯‰ä½ å“ªä¸ªå¯¹è±¡æ³„éœ²äº†ã€‚è¿™é‡Œè®¾è®¡ä¸ºä¸­æ–­è¨€è€Œä¸æ˜¯æ‰“æ—¥å¿—è®©ç¨‹åºç»§ç»­è·‘ï¼Œæ˜¯å› ä¸ºå¾ˆå¤šäººä¸ä¼šå»çœ‹æ—¥å¿—ï¼Œæ–­è¨€åˆ™èƒ½å¼ºåˆ¶å¼€å‘è€…æ³¨æ„åˆ°å¹¶å»ä¿®æ”¹ï¼Œè€Œä¸æ˜¯çŠ¯æ‹–å»¶ç—‡ã€‚ ä¸­æ–­è¨€æ—¶ï¼Œæ§åˆ¶å°ä¼šæœ‰å¦‚ä¸‹æç¤ºï¼ŒView-ViewController stack ä»ä¸Šå¾€ä¸‹çœ‹ï¼Œè¯¥ stack å‘Šè¯‰ä½ ï¼ŒMyTableViewController çš„ UITableView çš„ subview UITableViewWrapperView çš„ subview MyTableViewCell æ²¡è¢«é‡Šæ”¾ã€‚è€Œä¸”ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥è‚¯å®šçš„æ˜¯ MyTableViewControllerï¼ŒUITableViewï¼ŒUITableViewWrapperView è¿™ä¸‰ä¸ªå·²ç»æˆåŠŸé‡Šæ”¾äº†ã€‚ 12345678*** Terminating app due to uncaught exception &#x27;NSInternalInconsistencyException&#x27;, reason: &#x27;Possibly Memory Leak.In case that MyTableViewCell should not be dealloced, override -willDealloc in MyTableViewCell by returning NO.View-ViewController stack: ( MyTableViewController, UITableView, UITableViewWrapperView, MyTableViewCell)&#x27; MLeaksFinder çš„ä¼˜ç‚¹ï¼š ä½¿ç”¨ç®€å•ï¼Œä¸ä¾µå…¥ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œä¸ç”¨æ‰“å¼€ Instrument ä¸éœ€è¦é¢å¤–çš„æ“ä½œï¼Œä½ åªéœ€å¼€å‘ä½ çš„ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨ä½ è¿è¡Œè°ƒè¯•æ—¶å°±èƒ½å¸®ä½ æ£€æµ‹ å†…å­˜æ³„éœ²å‘ç°åŠæ—¶ï¼Œæ›´æ”¹å®Œä»£ç åä¸€è¿è¡Œå³èƒ½å‘ç°ï¼ˆè¿™ç‚¹å¾ˆé‡è¦ï¼Œä½ é©¬ä¸Šå°±èƒ½æ„è¯†åˆ°å“ªé‡Œå†™é”™äº†ï¼‰ ç²¾å‡†ï¼Œèƒ½å‡†ç¡®åœ°å‘Šè¯‰ä½ å“ªä¸ªå¯¹è±¡æ²¡è¢«é‡Šæ”¾ MLeaksFinderæµç¨‹ å…ˆé€šè¿‡ MLeaksFinder æ‰¾åˆ°å†…å­˜æ³„æ¼çš„å¯¹è±¡ã€‚ åšæ³•ï¼šMLeaksFinder ä¸€å¼€å§‹ä» UIViewController å…¥æ‰‹ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå½“ä¸€ä¸ª UIViewController è¢« pop æˆ– dismiss åï¼Œè¯¥ UIViewController åŒ…æ‹¬å®ƒçš„ viewï¼Œview çš„ subviews ç­‰ç­‰å°†å¾ˆå¿«è¢«é‡Šæ”¾ï¼ˆé™¤éä½ æŠŠå®ƒè®¾è®¡æˆå•ä¾‹ï¼Œæˆ–è€…æŒæœ‰å®ƒçš„å¼ºå¼•ç”¨ï¼Œä½†ä¸€èˆ¬å¾ˆå°‘è¿™æ ·åšï¼‰ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬åªéœ€åœ¨ä¸€ä¸ª ViewController è¢« pop æˆ– dismiss ä¸€å°æ®µæ—¶é—´åï¼Œçœ‹çœ‹è¯¥ UIViewControllerï¼Œå®ƒçš„ ç„¶åå†è¿‡ FBRetainCycleDetector æ£€æµ‹è¯¥å¯¹è±¡æœ‰æ²¡æœ‰å¾ªç¯å¼•ç”¨ã€‚ åšæ³•:å½“ä¼ å…¥å†…å­˜ä¸­çš„ä»»æ„ä¸€ä¸ª OC å¯¹è±¡ï¼ŒFBRetainCycleDetector ä¼šé€’å½’éå†è¯¥å¯¹è±¡çš„æ‰€æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡ï¼Œä»¥æ£€æµ‹ä»¥è¯¥å¯¹è±¡ä¸ºæ ¹ç»“ç‚¹çš„å¼ºå¼•ç”¨æ ‘æœ‰æ²¡æœ‰å¾ªç¯å¼•ç”¨ã€‚ MLeaksFinderåŸç†åŸç†ï¼š ä¸ºåŸºç±» NSObject æ·»åŠ ä¸€ä¸ªæ–¹æ³• -willDealloc æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼Œå…ˆç”¨ä¸€ä¸ªå¼±æŒ‡é’ˆæŒ‡å‘ selfï¼Œå¹¶åœ¨ä¸€å°æ®µæ—¶é—´(3ç§’)åï¼Œé€šè¿‡è¿™ä¸ªå¼±æŒ‡é’ˆè°ƒç”¨ -assertNotDeallocï¼Œè€Œ -assertNotDealloc ä¸»è¦ä½œç”¨æ˜¯ç›´æ¥ä¸­æ–­è¨€ã€‚å½“ä¸€ä¸ª UIViewController è¢« pop æˆ– dismiss æ—¶ï¼ˆæˆ‘ä»¬è®¤ä¸ºå®ƒåº”è¯¥è¦è¢«é‡Šæ”¾äº†ï¼‰ï¼Œæˆ‘ä»¬éå†è¯¥ UIViewController ä¸Šçš„æ‰€æœ‰ viewï¼Œä¾æ¬¡è°ƒ -willDeallocï¼Œè‹¥3ç§’åæ²¡è¢«é‡Šæ”¾ï¼Œå°±ä¼šä¸­æ–­è¨€ã€‚ 12345678910- (BOOL)willDealloc &#123; __weak id weakSelf = self; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; [weakSelf assertNotDealloc]; &#125;); return YES;&#125;- (void)assertNotDealloc &#123; NSAssert(NO, @â€œâ€);&#125; åœ¨è¿™é‡Œï¼Œæœ‰å‡ ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š ä¸å…¥ä¾µå¼€å‘ä»£ç è¿™é‡Œä½¿ç”¨äº† AOP æŠ€æœ¯ï¼Œhook æ‰ UIViewController å’Œ UINavigationController çš„ pop è·Ÿ dismiss æ–¹æ³•ã€‚ éå†ç›¸å…³å¯¹è±¡åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å‘ç°æœ‰æ—¶å€™ä¸€ä¸ª UIViewController è¢«é‡Šæ”¾äº†ï¼Œä½†å®ƒçš„ view æ²¡è¢«é‡Šæ”¾ï¼Œæˆ–è€…ä¸€ä¸ª UIView è¢«é‡Šæ”¾äº†ï¼Œä½†å®ƒçš„æŸä¸ª subview æ²¡è¢«é‡Šæ”¾ã€‚è¿™ç§å†…å­˜æ³„éœ²çš„æƒ…å†µå¾ˆå¸¸è§ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¿…è¦éå†åŸºäº UIViewController çš„æ•´æ£µ View-ViewController æ ‘ã€‚æˆ‘ä»¬é€šè¿‡ UIViewController çš„ presentedViewController å’Œ view å±æ€§ï¼ŒUIView çš„ subviews å±æ€§ç­‰é€’å½’éå†ã€‚å¯¹äºæŸäº› ViewControllerï¼Œå¦‚ UINavigationControllerï¼ŒUISplitViewController ç­‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦éå† viewControllers å±æ€§ã€‚ æ„å»ºå †æ ˆä¿¡æ¯éœ€è¦æ„å»º View-ViewController stack ä¿¡æ¯ä»¥å‘Šè¯‰å¼€å‘è€…æ˜¯å“ªä¸ªå¯¹è±¡æ²¡è¢«é‡Šæ”¾ã€‚åœ¨é€’å½’éå† View-ViewController æ ‘æ—¶ï¼Œå­èŠ‚ç‚¹çš„ stack ä¿¡æ¯ç”±çˆ¶èŠ‚ç‚¹çš„ stack ä¿¡æ¯åŠ ä¸Šå­ç»“ç‚¹ä¿¡æ¯å³å¯ã€‚ ä¾‹å¤–æœºåˆ¶å¯¹äºæœ‰äº› ViewControllerï¼Œåœ¨è¢« pop æˆ– dismiss åï¼Œä¸ä¼šè¢«é‡Šæ”¾ï¼ˆæ¯”å¦‚å•ä¾‹ï¼‰ï¼Œå› æ­¤éœ€è¦æä¾›æœºåˆ¶è®©å¼€å‘è€…æŒ‡å®šå“ªä¸ªå¯¹è±¡ä¸ä¼šè¢«é‡Šæ”¾ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡é‡è½½ä¸Šé¢çš„ -willDealloc æ–¹æ³•ï¼Œç›´æ¥ return NO å³å¯ã€‚ ç‰¹æ®Šæƒ…å†µå¯¹äºæŸäº›ç‰¹æ®Šæƒ…å†µï¼Œé‡Šæ”¾çš„æ—¶æœºä¸å¤§ä¸€æ ·ï¼ˆæ¯”å¦‚ç³»ç»Ÿæ‰‹åŠ¿è¿”å›æ—¶ï¼Œåœ¨åˆ’åˆ°ä¸€åŠæ—¶ hold ä½ï¼Œè™½ç„¶å·²è¢« popï¼Œä½†è¿™æ—¶è¿˜ä¸ä¼šè¢«é‡Šæ”¾ï¼ŒViewController è¦ç­‰åˆ°å®Œå…¨ disappear åæ‰é‡Šæ”¾ï¼‰ï¼Œéœ€è¦åšç‰¹æ®Šå¤„ç†ï¼Œå…·ä½“çš„ç‰¹æ®Šå¤„ç†è§†å…·ä½“æƒ…å†µè€Œå®šã€‚ ç³»ç»ŸViewæŸäº›ç³»ç»Ÿçš„ç§æœ‰ Viewï¼Œä¸ä¼šè¢«é‡Šæ”¾ï¼ˆå¯èƒ½æ˜¯ç³»ç»Ÿ bug æˆ–è€…æ˜¯ç³»ç»Ÿå‡ºäºæŸäº›åŸå› æ•…æ„è¿™æ ·åšçš„ï¼Œè¿™é‡Œå°±ä¸å»æ·±ç©¶äº†ï¼‰ï¼Œå› æ­¤éœ€è¦å»ºç«‹ç™½åå• æ‰‹åŠ¨æ‰©å±•MLeaksFinderç›®å‰åªæ£€æµ‹ ViewController è·Ÿ View å¯¹è±¡ã€‚ä¸ºæ­¤ï¼ŒMLeaksFinder æä¾›äº†ä¸€ä¸ªæ‰‹åŠ¨æ‰©å±•çš„æœºåˆ¶ï¼Œä½ å¯ä»¥ä» UIViewController è·Ÿ UIView å‡ºå‘ï¼Œå»æ£€æµ‹å…¶å®ƒç±»å‹çš„å¯¹è±¡çš„å†…å­˜æ³„éœ²ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹ UIViewController åº•ä¸‹çš„ View Modelï¼š 12345678- (BOOL)willDealloc &#123; if (![super willDealloc]) &#123; return NO; &#125; MLCheck(self.viewModel); return YES;&#125; è¿™é‡Œçš„åŸç†è·Ÿä¸Šé¢çš„æ˜¯ä¸€æ ·çš„ï¼Œå® MLCheck() åšçš„äº‹å°±æ˜¯ä¸ºä¼ è¿›æ¥çš„å¯¹è±¡å»ºç«‹ View-ViewController stack ä¿¡æ¯ï¼Œå¹¶å¯¹ä¼ è¿›æ¥çš„å¯¹è±¡è°ƒç”¨ -willDealloc æ–¹æ³•ã€‚ MLeaksFinderæºç 1ã€MLeaksFinder.hMLeaksFinder.hå®šä¹‰äº†MLeaksFinderä¸­ä½¿ç”¨çš„å® 123456789101112131415161718192021222324#ifdef MEMORY_LEAKS_FINDER_ENABLED //_INTERNAL_MLF_ENABLED å®ç”¨æ¥æ§åˆ¶ MLLeaksFinderåº“ //ä»€ä¹ˆæ—¶å€™å¼€å¯æ£€æµ‹ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªæ—¶æœºï¼Œé»˜è®¤åˆ™æ˜¯åœ¨DEBUGæ¨¡å¼ä¸‹ä¼šå¯åŠ¨ï¼ŒRELEASEæ¨¡å¼ä¸‹ä¸å¯åŠ¨//å®ƒæ˜¯é€šè¿‡é¢„ç¼–è¯‘æ¥å®ç°çš„#define _INTERNAL_MLF_ENABLED MEMORY_LEAKS_FINDER_ENABLED #else #define _INTERNAL_MLF_ENABLED DEBUG #endif //_INTERNAL_MLF_RC_ENABLED å®ç”¨æ¥æ§åˆ¶ æ˜¯å¦å¼€å¯å¾ªç¯å¼•ç”¨çš„æ£€æµ‹#ifdef MEMORY_LEAKS_FINDER_RETAIN_CYCLE_ENABLED #define _INTERNAL_MLF_RC_ENABLED MEMORY_LEAKS_FINDER_RETAIN_CYCLE_ENABLED //COCOAPODS å› ä¸ºMLLeaksFinderå¼•ç”¨äº†ç¬¬ä¸‰åº“ç”¨æ¥æ£€æŸ¥å¾ªç¯å¼•ç”¨ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯å½“å‰é¡¹ç›®ä¸­ä½¿ç”¨äº†COCOAPODSï¼Œæ‰èƒ½ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚#elif COCOAPODS #define _INTERNAL_MLF_RC_ENABLED COCOAPODS #endif 2.MLeakedObjectProxyMLeakedObjectProxyç”¨æ¥å¯¹æ³„æ¼å¯¹è±¡æ£€æŸ¥å¾ªç¯å¼•ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130//ç”¨æ¥æ£€æŸ¥å½“å‰æ³„æ¼å¯¹è±¡æ˜¯å¦å·²ç»æ·»åŠ åˆ°æ³„æ¼å¯¹è±¡é›†åˆä¸­ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä¸å†æ·»åŠ ä¹Ÿä¸å†æç¤ºå¼€å‘è€…+ (BOOL)isAnyObjectLeakedAtPtrs:(NSSet *)ptrs&#123; NSAssert([NSThread isMainThread], @&quot;Must be in main thread.&quot;); static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; //å…¨å±€ç”¨äºä¿å­˜æ³„æ¼å¯¹è±¡çš„é›†åˆ leakedObjectPtrs = [[NSMutableSet alloc] init]; &#125;); if (!ptrs.count) &#123; return NO; &#125; //NSSetæ±‚äº¤é›† if ([leakedObjectPtrs intersectsSet:ptrs]) &#123; return YES; &#125; else &#123; return NO; &#125;&#125;+ (void)addLeakedObject:(id)object &#123; NSAssert([NSThread isMainThread], @&quot;Must be in main thread.&quot;); //åˆ›å»ºç”¨äºæ£€æŸ¥å¾ªç¯å¼•ç”¨çš„objectProxyå¯¹è±¡ MLeakedObjectProxy *proxy = [[MLeakedObjectProxy alloc] init]; proxy.object = object; proxy.objectPtr = @((uintptr_t)object); proxy.viewStack = [object viewStack]; static const void *const kLeakedObjectProxyKey = &amp;kLeakedObjectProxyKey; objc_setAssociatedObject(object, kLeakedObjectProxyKey, proxy, OBJC_ASSOCIATION_RETAIN); [leakedObjectPtrs addObject:proxy.objectPtr]; #if _INTERNAL_MLF_RC_ENABLED //å¸¦æœ‰å¾ªç¯å¼•ç”¨æ£€æŸ¥åŠŸèƒ½çš„æç¤ºæ¡† [MLeaksMessenger alertWithTitle:@&quot;Memory Leak&quot; message:[NSString stringWithFormat:@&quot;%@&quot;, proxy. viewStack] delegate:proxy additionalButtonTitle:@&quot;Retain Cycle&quot;]; #else //æ™®é€šæç¤ºæ¡† [MLeaksMessenger alertWithTitle:@&quot;Memory Leak&quot; message:[NSString stringWithFormat:@&quot;%@&quot;, proxy. viewStack]]; #endif &#125;- (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex &#123; #if _INTERNAL_MLF_RC_ENABLED dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; FBRetainCycleDetector *detector = [FBRetainCycleDetector new]; [detector addCandidate:self.object]; NSSet *retainCycles = [detector findRetainCyclesWithMaxCycleLength:20]; BOOL hasFound = NO; //retainCyclesä¸­æ˜¯æ‰¾åˆ°çš„æ‰€æœ‰å¾ªç¯å¼•ç”¨çš„é“¾ for (NSArray *retainCycle in retainCycles) &#123; NSInteger index = 0; for (FBObjectiveCGraphElement *element in retainCycle) &#123; //æ‰¾åˆ°å½“å‰å†…å­˜æ³„æ¼å¯¹è±¡æ‰€åœ¨çš„å¾ªç¯å¼•ç”¨çš„é“¾ if (element.object == object) &#123; //æŠŠå½“å‰å¯¹è±¡è°ƒæ•´åˆ°ç¬¬ä¸€ä¸ªçš„ä½ç½®ï¼Œæ–¹ä¾¿æŸ¥çœ‹ NSArray *shiftedRetainCycle = [self shiftArray:retainCycle toIndex:index]; dispatch_async(dispatch_get_main_queue(), ^&#123; [MLeaksMessenger alertWithTitle:@&quot;Retain Cycle&quot; message:[NSString stringWithFormat:@&quot;%@&quot;, shiftedRetainCycle]]; &#125;); hasFound = YES; break; &#125; ++index; &#125; if (hasFound) &#123; break; &#125; &#125; if (!hasFound) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; [MLeaksMessenger alertWithTitle:@&quot;Retain Cycle&quot; message:@&quot;Fail to find a retain cycle&quot;]; &#125;); &#125; &#125;); #endif &#125; 3.NSObject+MemoryLeak NSObject+MemoryLeakä¸»è¦åŠŸèƒ½å­˜å‚¨å¯¹è±¡çš„çˆ¶å­èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„ï¼Œmethod swizzleé€»è¾‘ ï¼Œç™½åå•ä»¥åŠåˆ¤æ–­å¯¹è±¡æ˜¯å¦å‘ç”Ÿå†…å­˜æ³„æ¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122- (BOOL)willDealloc &#123; NSString *className = NSStringFromClass([self class]); //é€šè¿‡ç™½åå•å¯ä»¥é…ç½®å“ªäº›å¯¹è±¡ä¸çº³å…¥æ£€æŸ¥ï¼Œä¾‹å¦‚ä¸€äº›å•ä¾‹ if ([[NSObject classNamesInWhiteList] containsObject:className]) return NO; NSNumber *senderPtr = objc_getAssociatedObject([UIApplication sharedApplication], kLatestSenderKey); if ([senderPtr isEqualToNumber:@((uintptr_t)self)]) return NO; __weak id weakSelf = self; //åœ¨ç‰¹å®šæ—¶é—´æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²ç»å‘ç”Ÿå†…å­˜æ³„æ¼ dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC) ), dispatch_get_main_queue(), ^&#123; __strong id strongSelf = weakSelf; //å¦‚æœå¯¹è±¡å·²ç»è¢«é‡Šæ”¾ï¼ŒstrongSelfä¸ºnil è°ƒç”¨è¯¥æ–¹æ³•ä»€ä¹ˆä¹Ÿä¸å‘ç”Ÿ [strongSelf assertNotDealloc]; &#125;); return YES;&#125; //æ”¹æ–¹æ³•è¢«è°ƒç”¨è¯´æ˜æ”¹å¯¹è±¡å·²ç»å‘ç”Ÿå†…å­˜æ³„æ¼- (void)assertNotDealloc &#123; //æ£€æŸ¥æ˜¯å¦å·²ç»è®°å½•ï¼Œå¦‚æœæ˜¯ï¼Œä¸å†æç¤ºç”¨æˆ· if ([MLeakedObjectProxy isAnyObjectLeakedAtPtrs:[self parentPtrs]]) &#123; return; &#125; [MLeakedObjectProxy addLeakedObject:self]; NSString *className = NSStringFromClass([self class]); NSLog(@&quot;Possibly Memory Leak.\\nIn case that %@ should not be dealloced, override -willDealloc in %@ by returning NO.\\nView-ViewController stack: %@ &quot;, className, className, [self viewStack]); &#125; //ä¸»è¦é€šè¿‡é€’å½’æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹åœ¨æ ‘å½¢ç»“æ„ä¸­çš„ä½ç½®ï¼Œä»¥åŠçˆ¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆ- (void)willReleaseChildren:(NSArray *)children &#123; NSArray *viewStack = [self viewStack]; NSSet *parentPtrs = [self parentPtrs]; for (id child in children) &#123; NSString *className = NSStringFromClass([child class]); [child setViewStack:[viewStack arrayByAddingObject:className]]; [child setParentPtrs:[parentPtrs setByAddingObject:@((uintptr_t)child)]]; [child willDealloc]; &#125;&#125;+ (void)swizzleSEL:(SEL)originalSEL withSEL:(SEL)swizzledSEL &#123; //é€šè¿‡é¢„ç¼–è¯‘æ§åˆ¶æ˜¯å¦hookæ–¹æ³•#if _INTERNAL_MLF_ENABLED //é€šè¿‡é¢„ç¼–è¯‘æ§åˆ¶æ˜¯å¦æ£€æŸ¥å¾ªç¯å¼•ç”¨#if _INTERNAL_MLF_RC_ENABLED // Just find a place to set up FBRetainCycleDetector. static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; dispatch_async(dispatch_get_main_queue(), ^&#123; [FBAssociationManager hook]; &#125;); &#125;); #endif Class class = [self class]; Method originalMethod = class_getInstanceMethod(class, originalSEL); Method swizzledMethod = class_getInstanceMethod(class, swizzledSEL); BOOL didAddMethod = //class_addMethodä¸»è¦æ˜¯ç”¨æ¥ç»™æŸä¸ªç±»æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼ŒoriginalSELç›¸å½“äºæ˜¯æ–¹æ³•åç§°,method_getIm //plementtationæ˜¯æ–¹æ³•å®ç°, å®ƒè¿”å›ä¸€ä¸ªBOOLç±»å‹çš„å€¼ //åœ¨å½“å‰classä¸­æ²¡æœ‰å«originalSELçš„æ–¹æ³•( //å…·ä½“ä¸æ˜¯çœ‹interfaceé‡Œæ²¡æœ‰æ²¡æœ‰å£°æ˜ï¼Œè€Œæ˜¯çœ‹implementaionæ–‡ä»¶é‡Œæœ‰æ²¡æœ‰æ–¹æ³•å®ç°)ï¼Œ // å¹¶ä¸”æœ‰swizzledMethodæ–¹æ³•çš„å®ç° //è¿™ä¸ªæ—¶å€™è¯¥å‡½æ•°ä¼šè¿”å›trueï¼Œå…¶ä»–æƒ…å†µå‡è¿”å›false class_addMethod(class, originalSEL, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); if (didAddMethod) &#123; //didAddMethodä¸ºtrue è¯´æ˜swizzledMethodä¹‹å‰ä¸å­˜åœ¨ï¼Œé€šè¿‡class_addMethodå‡½æ•°æ·»åŠ äº†ä¸€ä¸ªåå­—å«origninalSELï¼Œå®ç°æ˜¯swizzledMoethodå‡½æ•°ã€‚ class_replaceMethod(class, swizzledSEL, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)); &#125; else &#123; //didAddMethodä¸ºfalse è¯´æ˜swizzledMethodæ–¹æ³•å·²ç»å­˜åœ¨ï¼Œç›´æ¥äº¤æ¢äºŒè€…å®ç° method_exchangeImplementations(originalMethod, swizzledMethod); &#125; #endif &#125; 4.UINavigationController + MemoryLeak UINavigationController + MemoryLeak ä¸»è¦æ˜¯é€šè¿‡UINavigationControllerçš„æ–¹æ³•å»æ£€æµ‹å­UIViewControlleré¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼ŒUIViewControllerçš„ç”Ÿå‘½å‘¨æœŸç”±UINavigationControllerçš„æ–¹æ³•å’ŒUIViewControllerè‡ªèº«çš„ä¸€äº›æ–¹æ³•å…±åŒå†³å®šçš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091//ç°åœ¨åœ¨å…·ä½“çš„ç±»å‹ä¸­æ·»åŠ æ–¹æ³•hookï¼ŒåŠ è½½loadä¸­å¹¶ä¸”è°ƒç”¨dspatch_onceæ¥ä¿è¯åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œloadæ˜¯å¿…ç„¶ä¼šè°ƒç”¨çš„ï¼Œå¹¶ä¸”categoryçš„loadæ–¹æ³•è°ƒç”¨å’Œç±»è‡ªèº«çš„loadæ–¹æ³•è°ƒç”¨æ˜¯åˆ†å¼€çš„ï¼Œäº’ä¸å¹²æ‰°ã€‚+ (void)load &#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; [self swizzleSEL:@selector(pushViewController:animated:) withSEL:@ selector(swizzled_pushViewController:animated:)]; [self swizzleSEL:@selector(popViewControllerAnimated:) withSEL:@ selector(swizzled_popViewControllerAnimated:)]; [self swizzleSEL:@selector(popToViewController:animated:) withSEL:@ selector(swizzled_popToViewController:animated:)]; [self swizzleSEL:@selector(popToRootViewControllerAnimated:) withSEL:@ selector(swizzled_popToRootViewControllerAnimated:)]; &#125;);&#125; - (void)swizzled_pushViewController:(UIViewController *)viewController animated:(BOOL)animated &#123; if (self.splitViewController) &#123; //è¿™é‡Œä¸»è¦æ˜¯è€ƒè™‘åˆ°appä¸­æœ‰ä½¿ç”¨splitViewControllerçš„æƒ…å†µçš„æ—¶å€™ï¼Œä¸‹ä¸€ä¸ªæ ¹é¡µé¢pushä¹‹åï¼Œ //ä¹‹å‰è¢«popçš„æ ¹é¡µé¢æ‰ä¼šå›æ”¶ id detailViewController = objc_getAssociatedObject(self, kPoppedDetailVCKey); if ([detailViewController isKindOfClass:[UIViewController class]]) &#123; //å›æ”¶ä¹‹å‰è¢«popçš„æ ¹é¡µé¢ [detailViewController willDealloc]; objc_setAssociatedObject(self, kPoppedDetailVCKey, nil, OBJC_ASSOCIATION_RETAIN); &#125; &#125; [self swizzled_pushViewController:viewController animated:animated]; &#125;- (UIViewController *)swizzled_popViewControllerAnimated:(BOOL)animated &#123; UIViewController *poppedViewController = [self swizzled_popViewControllerAnimated:animated]; if (!poppedViewController) &#123; return nil; &#125; //å½“å‰é¡µé¢æ˜¯spliteViewControlleræ ¹é¡µé¢ if (self.splitViewController &amp;&amp; self.splitViewController.viewControllers.firstObject == self &amp;&amp; self.splitViewController == poppedViewController.splitViewController) &#123; objc_setAssociatedObject(self, kPoppedDetailVCKey, poppedViewController , OBJC_ASSOCIATION_RETAIN); return poppedViewController; &#125; // VC is not dealloced until disappear when popped using a left-edge swipe gesture extern const void *const kHasBeenPoppedKey; objc_setAssociatedObject(poppedViewController, kHasBeenPoppedKey, @(YES), OBJC_ASSOCIATION_RETAIN); return poppedViewController; &#125; - (NSArray&lt;UIViewController *&gt; *)swizzled_popToViewController:( UIViewController *)viewController animated:(BOOL)animated &#123; NSArray&lt;UIViewController *&gt; *poppedViewControllers = [self swizzled_popToViewController:viewController animated:animated]; //ä¸€æ¬¡æ€§popå¤šä¸ªé¡µé¢çš„æ—¶å€™ï¼Œè¿™äº›é¡µé¢çš„viewDidDisappearä¼°è®¡éƒ½æ²¡æœ‰è¢«è°ƒç”¨ï¼Œç›´æ¥å›æ”¶äº† for (UIViewController *viewController in poppedViewControllers) &#123; [viewController willDealloc]; &#125; return poppedViewControllers; &#125; 5.UIViewController + MemoryLeak 12345678910111213141516171819202122232425262728293031- (void)swizzled_viewDidDisappear:(BOOL)animated &#123; [self swizzled_viewDidDisappear:animated]; //ä»…ä»…å½“æ˜¯popå¼•èµ·viewDidDisappearçš„æ—¶å€™æ‰é‡Šæ”¾(å½“è¢«æŒ¡ä½ä¹‹åä¹Ÿä¼šè°ƒç”¨ViewDidDisappear) if ([objc_getAssociatedObject(self, kHasBeenPoppedKey) boolValue]) &#123; [self willDealloc]; &#125; &#125; - (void)swizzled_dismissViewControllerAnimated:(BOOL)flag completion:(void (^)(void))completion &#123; [self swizzled_dismissViewControllerAnimated:flag completion:completion]; //dismissæ‰presentedViewControllerï¼Œé‡Šæ”¾å®ƒ (ä½†æ˜¯ä»€ä¹ˆæ—¶å€™å½“å‰viewControllerè¢«é‡Šæ”¾å‘¢) UIViewController *dismissedViewController = self.presentedViewController; if (!dismissedViewController &amp;&amp; self.presentingViewController) &#123; //é‡Šæ”¾è‡ªå·± dismissedViewController = self; &#125; if (!dismissedViewController) return; //ä»¥presentå‡ºæ¥çš„viewcontrollerï¼Œä¸é€šè¿‡DidDisappearå»åˆ¤æ–­æ˜¯å¦é‡Šæ”¾äº† [dismissedViewController willDealloc]; &#125; å®é™…é¡¹ç›®ä¸­ä½¿ç”¨cocoapodsé›†æˆåªéœ€è¦åœ¨podfileæ–‡ä»¶ä¸­åŠ å…¥ç›¸å…³åº“å³å¯ã€‚pod &#39;MLeaksFinder&#39;","categories":[{"name":"OC-ä¸‰æ–¹æ¡†æ¶æ¢ç´¢ç¯‡","slug":"OC-ä¸‰æ–¹æ¡†æ¶æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-ä¸‰æ–¹æ¡†æ¶æ¢ç´¢ç¯‡","slug":"OC-ä¸‰æ–¹æ¡†æ¶æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]},{"title":"OCå­¦ä¹ 14ï¼šcocoapodsæ¢ç´¢","slug":"OCå­¦ä¹ /OCå­¦ä¹ 14ï¼šcocoapodsæ¢ç´¢","date":"2020-08-01T08:33:41.000Z","updated":"2023-03-08T23:03:05.125Z","comments":true,"path":"2020/08/01/OCå­¦ä¹ /OCå­¦ä¹ 14ï¼šcocoapodsæ¢ç´¢/","link":"","permalink":"https://www.bboyzj.cn/2020/08/01/OC%E5%AD%A6%E4%B9%A0/OC%E5%AD%A6%E4%B9%A014%EF%BC%9Acocoapods%E6%8E%A2%E7%B4%A2/","excerpt":"","text":"CocoaPods ç®€ä»‹æ¯ç§è¯­è¨€å‘å±•åˆ°ä¸€ä¸ªé˜¶æ®µï¼Œå°±ä¼šå‡ºç°å“åº”çš„ ä¾èµ–ç®¡ç†å·¥å…·,ä¾‹å¦‚Javaçš„Mavenï¼Œnodejsçš„nmpï¼Œéšç€iOSå¼€å‘è€…çš„å¢å¤šï¼Œä¸šç•Œå‡ºç°äº†ä¸ºiOSç¨‹åºæä¾›ä¾èµ–ç®¡ç†å·¥å…·ï¼Œå®ƒçš„åå­—å«åšï¼šCocoapods ã€‚ Cocoapodsé¡¹ç›®æºç  å­˜æ”¾åœ¨Githubä¸Šè¿›è¡Œç®¡ç†ï¼Œæˆ‘ä»¬åœ¨å¼€å‘iOSé¡¹ç›®æ—¶ï¼Œä¸å¯é¿å…çš„è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹å¼€æºåº“ï¼ŒCocoapodsçš„å‡ºç°ä½¿æˆ‘ä»¬èŠ‚çœäº†è®¾ç½®å’Œæ›´æ–°ç¬¬ä¸‰æ–¹å¼€æºåº“çš„æ—¶é—´ã€‚ ä»Githubä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ç”¨Rubyå†™çš„ï¼Œä¸»è¦ä¾èµ–äºRubyç¯å¢ƒï¼ŒRuby æ˜¯ä¸€ç§çœŸæ­£çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ˜¯ç”±æ—¥æœ¬çš„æ¾æœ¬è¡Œå¼˜ï¼ˆã¾ã¤ã‚‚ã¨ã‚†ãã²ã‚/Yukihiro Matsumotoï¼‰åˆ›å»ºäº1993å¹´ï¼Œä¸Perlã€Pythonç­‰ç±»ä¼¼ï¼Œæ˜¯ä¸€ç§è„šæœ¬è¯­è¨€ã€‚ RubyæŸ¥çœ‹åœ¨å®‰è£…Cocoapodsç®¡ç†ä¾èµ–å·¥å…·å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯Rubyç¯å¢ƒæ˜¯æœ€æ–°çš„ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸€äº›å®‰è£…é—®é¢˜ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMacOS ç³»ç»Ÿå·²ç»å®‰è£…å¥½ Rubyï¼Œé»˜è®¤å®‰è£…åœ¨/System/Library/Frameworks/Ruby.framework/Versions/Current ç›®å½•ä¸‹ï¼Œä½†ä¸æ˜¯æœ€æ–°çš„ç¯å¢ƒ åœ¨ç»ˆç«¯å¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œç¡®è®¤ç³»ç»Ÿçš„Rubyçš„ç‰ˆæœ¬ä¿¡æ¯: 12mac@MacdeMBP ~ % ruby -vruby 2.6.3p62 (2019-04-16 revision 67580) [universal.x86_64-darwin19] ä½†æ˜¯ï¼Œç”±äºé»˜è®¤çš„ Ruby å®‰è£…åœ¨ /System ç›®å½•ä¸‹ï¼Œè¿‡æ·±çš„ã€ä¸ linux çº¦å®šä¸åŒçš„ç›®å½•ç»“æ„å¯¹æ—¥å¸¸çš„å¼€å‘ã€ç»´æŠ¤éƒ½å¸¦æ¥è®¸å¤šä¸ä¾¿ã€‚ æ‰€ä»¥ï¼Œåœ¨ MacOS ä¸Šæ¨èä½¿ç”¨ homebrew æ¥å®‰è£…ã€ç®¡ç† Ruby çš„ç‰ˆæœ¬ã€‚ homebrew å®‰è£… Ruby1.å®‰è£… homebrew åœ¨ç»ˆç«¯ä¸‹ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå³å¯å®Œæˆhomebrewçš„å®‰è£…ï¼ˆæ³¨:å®‰è£…è¿‡ç¨‹ä¸­æç¤ºè¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç ï¼‰ï¼š 1ruby -e &quot;$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)&quot; è¯¥å‘½ä»¤å°†ä¼šä» homebrew çš„ GitHub ä»“åº“æŠ“å–æœ€æ–°ç‰ˆæœ¬å¹¶è‡ªåŠ¨å®Œæˆå®‰è£…ã€‚å®‰è£…æˆåŠŸåï¼Œå³å¯ä½¿ç”¨ brew å‘½ä»¤æ¥å®‰è£… Ruby çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥åŠå…¶ä»–å·¥å…·ã€‚ homebrew çš„é»˜è®¤å®‰è£…ç›®å½•ä¸º /usr/localï¼Œæ‰€æœ‰é€šè¿‡ brew å®‰è£…çš„ç¨‹åºéƒ½ä¼šé»˜è®¤å®‰è£…åˆ° /usr/local/Cellars/ç¨‹åºå/ç‰ˆæœ¬å·/ ç›®å½•ä¸‹ã€‚ 2.é€šè¿‡ brew å®‰è£… Ruby æœ€æ–°ç‰ˆæœ¬åœ¨ç»ˆç«¯ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯è‡ªåŠ¨å®Œæˆæœ€æ–°ç‰ˆæœ¬Rubyçš„å®‰è£…ï¼š 12brew updatebrew install ruby è¯´æ˜: brew update å°†ä¼šä» GitHub ä¸Šæ›´æ–° brew æ‰€æ”¯æŒçš„æ‰€æœ‰è½¯ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¿è¯ä½ èƒ½å¤Ÿå®‰è£…åˆ°æœ€æ–°çš„ç‰ˆæœ¬ brew install ruby å°†ä¼šä» Ruby çš„ GitHub ä»“åº“æŠ“å–æœ€æ–°ç‰ˆæœ¬çš„ä»£ç ï¼Œå¹¶ç¼–è¯‘å®‰è£… 3.å®‰è£…æˆåŠŸåï¼Œé‡æ–°æ‰§è¡Œ ruby -v ç¡®è®¤å·²æˆåŠŸå®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ Rubyï¼š 12ruby -vruby 2.6.3p62 (2019-04-16 revision 67580) [universal.x86_64-darwin19] æ›¿æ¢é•œåƒæºé»˜è®¤çš„é•œåƒèµ„æºæœåŠ¡å™¨è¢«å¤©æœç»™å¢™äº†ã€‚æ‰€ä»¥éœ€è¦å…ˆæ›´æ¢æºåœ°å€ï¼Œç„¶åå†å®‰è£…ã€‚ 1.ç§»é™¤åŸå…ˆçš„ Ruby æºï¼š 1$ gem sources --remove https://rubygems.org/ 2.æŒ‡å®šä¸º Ruby China çš„é•œåƒæºï¼š 1$ gem sources --add https://gems.ruby-china.com/ 3.éªŒè¯æ–°æºæ˜¯å¦æ›¿æ¢æˆåŠŸ 1234$ gem sources -l*** CURRENT SOURCES ***https://gems.ruby-china.com/ Cocoapods å®‰è£…ä½¿ç”¨ ruby çš„ gem å‘½ä»¤ä¸‹è½½å¹¶å®‰è£… CocoaPodsã€‚ 1.macOS Catalinaç³»ç»Ÿç‰ˆæœ¬ä¹‹å‰ç”¨ï¼š$sudo gem install cocoapodsï¼›macOS Catalinaç³»ç»Ÿç‰ˆæœ¬ä¹‹å‰ç‰ˆæœ¬åéœ€è¦æ”¹ä¸º : $ sudo gem install -n /usr/local/bin cocoapods 2.å®‰è£…$ pod setup æ‰€æœ‰é¡¹ç›®çš„ Podspec æ–‡ä»¶éƒ½æ‰˜ç®¡åœ¨ https://github.com/CocoaPods/Specs ä¸­ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œ pod setup æ—¶ï¼ŒCocoaPods ä¼šå°†è¿™äº› Podspec ç´¢å¼•æ–‡ä»¶æ›´æ–°åˆ°æœ¬åœ°çš„ ~/.cocoapods/ç›®å½•ä¸‹ï¼Œè¯¥ç´¢å¼•æ–‡ä»¶è¾ƒå¤§ä¸”æ›´æ–°éå¸¸ç¼“æ…¢ã€‚ å¯ä»¥æ›¿æ¢é•œåƒï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼šgitcafe æˆ–è€… occhina é•œåƒï¼š 123pod repo remove masterpod repo add master https://gitcafe.com/akuandev/Specs.gitpod repo update ä¹Ÿå¯ä»¥å°†ä»¥ä¸Šä»£ç ä¸­çš„ https://gitcafe.com/akuandev/Specs.git æ›¿æ¢æˆ http://git.oschina.net/akuandev/Specs.git å³å¯ä½¿ç”¨ occhina ä¸Šçš„é•œåƒã€‚ æœç´¢ç›¸å…³æ¡†æ¶æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼špod search æ¡†æ¶åï¼Œå¦‚æœç´¢ç½‘ç»œæ¡†æ¶ AFNetworking 1$ pod search AFNetworking ç§»é™¤ trunk æºå¦‚æœæ‰§è¡Œ pod ç›¸å…³å‘½ä»¤æ—¶ï¼Œæ˜¾ç¤º CDN æ— æ³•è¿æ¥ã€è¿æ¥è¶…æ—¶ä¹‹ç±»çš„æƒ…å†µï¼Œå¯ä»¥ç§»é™¤ trunk æºï¼Œç„¶ååœ¨ Podfile æ–‡ä»¶ä¸­ç¬¬ä¸€è¡ŒæŒ‡æ˜ä¾èµ–åº“çš„æ¥æºåœ°å€ï¼Œä¸ä½¿ç”¨é»˜è®¤ CDNã€‚ 1$ pod repo remove trunk é¡¹ç›®ä¸­çš„ä½¿ç”¨1ã€åˆ›å»ºPodfileæ–‡ä»¶ æ–°å»º Xcode é¡¹ç›®ï¼Œåœ¨ç»ˆç«¯é‡Œ cd åˆ°é¡¹ç›®çš„ä¸»æ–‡ä»¶å¤¹(å°±æ˜¯åŒ…å« é¡¹ç›®.xcodeproj çš„æ–‡ä»¶)ã€‚æ‰§è¡Œå‘½ä»¤ï¼š 123# 1. åˆ›å»º Podfile æ–‡ä»¶$ pod init 2.ç¼–è¾‘ Podfile æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼š ã€æ–¹æ³•ä¸€ã€‘ï¼šç»ˆç«¯ç¼–è¾‘ vim Podfileæ‰§è¡Œ vim Podfile å‘½ä»¤åï¼Œä¼šæ‰“å¼€ä¸Šä¸€æ­¥éª¤åˆ›å»ºçš„ Podfile æ–‡ä»¶ï¼Œä½ éœ€è¦é€šè¿‡ vim ç¼–è¾‘æ­¤æ–‡ä»¶ï¼Œé»˜è®¤è¿›å…¥å‘½ä»¤æ¨¡å¼ã€‚ é”®ç›˜å‘½ä»¤ i :inputï¼Œè¾“å…¥æ¨¡å¼ é”®ç›˜å‘½ä»¤ ESC : ä»è¾“å…¥æ¨¡å¼é€€å‡ºåˆ°å‘½ä»¤æ¨¡å¼ é”®ç›˜å‘½ä»¤ shift + : : åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œè¾“å…¥è¯¥é”®ç›˜ç»„åˆå‘½ä»¤ï¼Œå°±ä¼šè¿›å…¥æœ«è¡Œæ¨¡å¼ é”®ç›˜å‘½ä»¤ wq : åœ¨æœ«è¡Œæ¨¡å¼ä¸‹ï¼Œè¾“å…¥ wq ï¼Œå³ write and quitï¼Œä¿å­˜å¹¶é€€å‡ºï¼ ã€æ–¹æ³•äºŒã€‘ï¼šç›´æ¥æ‰“å¼€é¡¹ç›®æ–‡ä»¶ Podfile 3.ä¿å­˜æ–‡ä»¶åï¼Œå®‰è£…ç¬¬ä¸‰æ–¹åº“ æ›´æ–°ä¾èµ–åº“ï¼Œæ‰§è¡Œ pod updateï¼ˆè®°å¾—cd åˆ°é¡¹ç›®ä¸»æ–‡ä»¶ä¸‹ï¼‰ã€‚ å®‰è£…ä¾èµ–åº“ï¼Œæ‰§è¡Œ pod installã€‚ 4.å®‰è£…å®Œæˆï¼Œæ­¤æ—¶é¡¹ç›®æ–‡ä»¶ä¸­ä¼šå¤šå‡º .xcworkspace æ–‡ä»¶ï¼Œä»¥åå°±é€šè¿‡å®ƒæ¥æ‰“å¼€é¡¹ç›®ã€‚ Podfile æ–‡ä»¶ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253# æŒ‡æ˜ä¾èµ–åº“çš„æ¥æºåœ°å€ï¼Œä¸ä½¿ç”¨é»˜è®¤ CDNsource &#x27;[https://github.com/CocoaPods/Specs.git](https://github.com/CocoaPods/Specs.git)&#x27;# Uncomment this line to define a global platform for your projectplatform :ios, &#x27;9.0&#x27;# å±è”½æ‰€æœ‰ç¬¬ä¸‰æ–¹æ¡†æ¶è­¦å‘Šinhibit_all_warnings! target &#x27;ProjectName&#x27; do # Uncomment this line if you&#x27;re using Swift or would like to use dynamic frameworks # use_frameworks! # Pods for ProjectName # ç½‘ç»œåº“ pod &#x27;AFNetworking&#x27; pod &#x27;SDWebImage&#x27; pod &#x27;Reachability&#x27; # æœåŠ¡ç±» pod &#x27;Bugly&#x27; # UI pod &#x27;Masonry&#x27; pod &#x27;MBProgressHUD&#x27; pod &#x27;MJRefresh&#x27; pod &#x27;EAIntroView&#x27; pod &#x27;SDCycleScrollView&#x27; pod &#x27;DZNEmptyDataSet&#x27; pod &#x27;XLForm&#x27; pod &#x27;SHSPhoneComponent&#x27; pod &#x27;BEMCheckBox&#x27; pod &#x27;SCLAlertView-Objective-C&#x27; # å·¥å…·ç»„ä»¶ç±» pod &#x27;ChameleonFramework&#x27; pod &#x27;FDFullscreenPopGesture&#x27; pod &#x27;IQKeyboardManager&#x27; pod &#x27;YYKit&#x27; pod &#x27;UIAlertController+Blocks&#x27; pod &#x27;LBXScan/LBXNative&#x27; pod &#x27;LBXScan/UI&#x27; pod &#x27;UITableView+FDTemplateLayoutCell&#x27;endtarget &#x27;ProjectNameTests&#x27; do inherit! :search_pathsend&quot;Podfile&quot; 52L, 999C ä¸‰æ–¹åº“å¸¸ç”¨å‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354###### å®‰è£… Cocoapods ####### æ›´æ–° gem ç‰ˆæœ¬$ sudo gem update --system# æŸ¥çœ‹å·²å®‰è£…çš„ Ruby ç‰ˆæœ¬$ gem -v# æ›¿æ¢ Ruby æº$ gem sources --remove [https://rubygems.org/](https://rubygems.org/)$ gem sources -add [https://gems.ruby-china.com/](https://gems.ruby-china.com/)# æŸ¥çœ‹éªŒè¯é•œåƒæº$ gem sources -l# å¸è½½ Cocoapods$ sudo gem uninstall cocoapods# é‡æ–°å®‰è£… Cocoapods åˆ°æŒ‡å®šç›®å½•$ sudo gem install cocoapods -n /usr/local/bin# æŸ¥çœ‹å½“å‰ Cocoapods ç‰ˆæœ¬$ pod --version# æ›´æ–°æœ¬åœ°çš„ Cocoapods åˆ—è¡¨$ pod repo update# ç§»é™¤ trunk æº$ pod repo remove trunk###### é¡¹ç›®ä¸­ä½¿ç”¨ ####### æœç´¢æ¡†æ¶$ pod search æ¡†æ¶å# ç»ˆç«¯å¯¼èˆªåˆ°é¡¹ç›®ç›®å½•ä¸‹$ cd [Project]# åˆ›å»º Podfile æ–‡ä»¶$ pod init# ç¼–è¾‘ Podfile æ–‡ä»¶$ vim Podfile# å®‰è£…$ pod install# æ›´æ–°æ‰€æœ‰ä¾èµ–çš„å¼€æºåº“$ pod update$ pod install --no-repo-update$ pod update --no-repo-update# æŸ¥çœ‹ä¾èµ–åº“ç‰ˆæœ¬ä¿¡æ¯$ pod install --verbose --no-repo-update","categories":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}],"tags":[{"name":"OC-åŸºç¡€","slug":"OC-åŸºç¡€","permalink":"https://www.bboyzj.cn/tags/OC-%E5%9F%BA%E7%A1%80/"}],"keywords":[{"name":"OC","slug":"OC","permalink":"https://www.bboyzj.cn/categories/OC/"}]},{"title":"OCåº•å±‚åŸç†ï¼šæˆ‘çš„ä¸­çº§åˆ°é«˜çº§è¿›é˜¶ä¹‹è·¯","slug":"OCåº•å±‚åŸç†/OCåº•å±‚åŸç†ï¼šæˆ‘çš„ä¸­çº§åˆ°é«˜çº§è¿›é˜¶ä¹‹è·¯","date":"2020-07-12T08:56:40.000Z","updated":"2022-04-21T05:58:06.000Z","comments":true,"path":"2020/07/12/OCåº•å±‚åŸç†/OCåº•å±‚åŸç†ï¼šæˆ‘çš„ä¸­çº§åˆ°é«˜çº§è¿›é˜¶ä¹‹è·¯/","link":"","permalink":"https://www.bboyzj.cn/2020/07/12/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%EF%BC%9A%E6%88%91%E7%9A%84%E4%B8%AD%E7%BA%A7%E5%88%B0%E9%AB%98%E7%BA%A7%E8%BF%9B%E9%98%B6%E4%B9%8B%E8%B7%AF/","excerpt":"","text":"æºç å’Œå¼€å‘æ–‡æ¡£ OCæºç ä¸‹è½½åœ°å€ è‹¹æœå¼€å‘æ–‡æ¡£åœ°å€ OC åº•å±‚æ¢ç´¢ç¯‡ åº•å±‚åˆ†æï¼šLLDB &amp; æŸ¥æ‰¾æºç ä¸‰ç§æ–¹å¼ OCåº•å±‚åŸç†00ï¼šLLDBå¸¸ç”¨å‘½ä»¤ OCåº•å±‚åŸç†01ï¼šæŸ¥æ‰¾æºç æœ‰ä¸‰ç§æ–¹å¼ åº•å±‚åˆ†æï¼šæºç  &amp; alloc OCåº•å±‚åŸç†02ï¼šObjc4æºç ç¼–è¯‘ OCåº•å±‚åŸç†03ï¼šalloc&amp;init&amp;newæºç åˆ†æ OCåº•å±‚åŸç†04ï¼šOptimization-Level-ä¼˜åŒ–ç­‰çº§ OCåº•å±‚åŸç†05ï¼šobjc-allocæ¢ç´¢ OCåº•å±‚åŸç†06ï¼šå†…å­˜å¯¹é½æ¢ç´¢ OCåº•å±‚åŸç†07ï¼šmallocæºç æ¢ç´¢ åº•å±‚åˆ†æï¼šisa &amp; ç±» &amp; ç»“æ„ä½“ OCåº•å±‚åŸç†08ï¼šisaå’Œç±»å…³è”æ¢ç´¢ OCåº•å±‚åŸç†09ï¼šisaèµ°å‘&amp;ç»§æ‰¿åˆ†æ OCåº•å±‚åŸç†10ï¼šç±» &amp; ç±»ç»“æ„åˆ†æ OCåº•å±‚åŸç†11ï¼šç±» &amp; isa åº•å±‚é¢è¯•é¢˜åˆ†æ OCåº•å±‚åŸç†12ï¼šcopy-strong-weakåº•å±‚åˆ†æ åº•å±‚åˆ†æï¼šcache-t &amp; æ¶ˆæ¯æµç¨‹ OCåº•å±‚åŸç†13ï¼šcache-tåº•å±‚åŸç†åˆ†æ OCåº•å±‚åŸç†14-1ï¼šæ¶ˆæ¯æµç¨‹åˆ†æä¹‹å¿«é€ŸæŸ¥æ‰¾ OCåº•å±‚åŸç†14-2ï¼šæ¶ˆæ¯æµç¨‹åˆ†æä¹‹å¿«é€ŸæŸ¥æ‰¾ OCåº•å±‚åŸç†14-3ï¼šæ¶ˆæ¯æµç¨‹åˆ†æä¹‹åŠ¨æ€æ–¹æ³•å†³è®®&amp;æ¶ˆæ¯è½¬å‘ åº•å±‚åˆ†æï¼šdyld &amp; ç±» OCåº•å±‚åŸç†15ï¼šdyldæºç åˆ†æ OCåº•å±‚åŸç†16ï¼šdyldä¸objcçš„å…³è” OCåº•å±‚åŸç†17ï¼šç±»çš„åŠ è½½ï¼ˆä¸Šï¼‰ OCåº•å±‚åŸç†18ï¼šç±»çš„åŠ è½½ï¼ˆä¸‹ï¼‰ OCåº•å±‚åŸç†19ï¼šç±»æ‰©å±•ä¸å…³è”å¯¹è±¡ OCåº•å±‚åŸç†20ï¼šOCåº•å±‚é¢è¯•é¢˜è§£æ OCåº•å±‚åŸç†21ï¼šMethod-Swizzlingæ–¹æ³•äº¤æ¢ åº•å±‚åˆ†æï¼šKVC &amp; KVO * å†…å­˜äº”å¤§åŒº OCåº•å±‚åŸç†22ï¼šKVCåº•å±‚åŸç†åˆ†æ OCåº•å±‚åŸç†23ï¼šKVOåº•å±‚åŸç†åˆ†æ OCåº•å±‚åŸç†24ï¼šå†…å­˜äº”å¤§åŒº åº•å±‚åˆ†æï¼šå¤šçº¿ç¨‹ &amp; é” * Block OCåº•å±‚åŸç†25ï¼šå¤šçº¿ç¨‹åŸç†æ¢ç´¢ OCåº•å±‚åŸç†26ï¼šGCDä¹‹å‡½æ•°ä¸é˜Ÿåˆ— OCåº•å±‚åŸç†27ï¼šGCDä¹‹ NSThread &amp; GCD &amp; NSOperation OCåº•å±‚åŸç†28ï¼šGCDä¹‹åº•å±‚åŸç†åˆ†æ OCåº•å±‚åŸç†29ï¼šé”çš„åŸç† OCåº•å±‚åŸç†30ï¼šBlockåº•å±‚åŸç† åº•å±‚åˆ†æï¼šå¯åŠ¨ä¼˜åŒ– OCåº•å±‚åŸç†31ï¼šLLVMç¼–è¯‘æµç¨‹-Clandæ’ä»¶å¼€å‘ OCåº•å±‚åŸç†32ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸€ï¼‰åŸºæœ¬æ¦‚å¿µ OCåº•å±‚åŸç†33ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆäºŒï¼‰ä¼˜åŒ–å»ºè®® OCåº•å±‚åŸç†34ï¼šå¯åŠ¨ä¼˜åŒ–ï¼ˆä¸‰ï¼‰äºŒè¿›åˆ¶é‡æ’ åº•å±‚åˆ†æï¼šå†…å­˜ç®¡ç† OCåº•å±‚åŸç†35ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸€ï¼‰TaggedPointer-retain-release-dealloc-retainCount-åº•å±‚åˆ†æ OCåº•å±‚åŸç†36ï¼šå†…å­˜ç®¡ç†ï¼ˆäºŒï¼‰å¼·å¼•ç”¨åˆ†æ OCåº•å±‚åŸç†37ï¼šå†…å­˜ç®¡ç†ï¼ˆä¸‰ï¼‰AutoReleasePool-NSRunLoop-åº•å±‚åˆ†æ åº•å±‚åˆ†æï¼šAppä¼˜åŒ– OCåº•å±‚åŸç†38ï¼šç•Œé¢ä¼˜åŒ–æ–¹æ¡ˆ OCåº•å±‚åŸç†39ï¼šç»„ä»¶åŒ–ï¼ˆä¸€ï¼‰æ–¹æ¡ˆ OCåº•å±‚åŸç†40ï¼šç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ç»„ä»¶é—´é€šè®¯æ–¹å¼ OCåº•å±‚åŸç†41ï¼šå†…å­˜ä¼˜åŒ–ï¼ˆä¸€ï¼‰é‡æŒ‡é’ˆæ¢æµ‹","categories":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}],"tags":[{"name":"iOS-OC","slug":"iOS-OC","permalink":"https://www.bboyzj.cn/tags/iOS-OC/"}],"keywords":[{"name":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","slug":"OC-åº•å±‚åŸç†æ¢ç´¢ç¯‡","permalink":"https://www.bboyzj.cn/categories/OC-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E6%8E%A2%E7%B4%A2%E7%AF%87/"}]}]}